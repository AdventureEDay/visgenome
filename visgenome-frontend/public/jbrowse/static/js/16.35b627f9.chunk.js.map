{"version":3,"sources":["../../../packages/core/util/calculateStaticBlocks.ts","../../../packages/core/pluggableElementTypes/renderers/CircularChordRendererType.ts","../../../packages/core/util/layouts/MultiLayout.ts","../../../packages/core/util/io/ElectronLocalFile.ts","../../../packages/core/util/compositeMap.ts","../../../plugins/wiggle/src/BigWigAdapter/BigWigAdapter.ts","../../../packages/core/util/types/mst.ts","../../../packages/core/util/tracks.ts","../../../packages/core/ui/theme.ts","../../../packages/core/ui/Logo.tsx","../../../packages/core/ui/ResizeHandle.tsx","../../../packages/core/ui/Drawer.js","../../../packages/core/ui/DrawerWidget.js","../../../packages/core/ui/DropDownMenu.tsx","../../../packages/core/ui/EditableTypography.tsx","../../../packages/core/ui/Snackbar.tsx","../../../packages/core/ui/ViewContainer.tsx","../../../packages/core/ui/App.js","../../../packages/core/ui/PrerenderedCanvas.tsx","../../../packages/core/ui/FactoryResetDialog.tsx","../../../packages/core/ui/Tooltip.tsx","../../../packages/core/ui/FatalErrorDialog.tsx","../../../plugins/variants/src/ChordVariantDisplay/models/ChordVariantDisplay.js","../../../plugins/variants/src/ChordVariantDisplay/index.ts","../../../plugins/variants/src/LinearVariantDisplay/model.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/ReactComponent.js","../../../plugins/variants/src/StructuralVariantChordRenderer/index.js","../../../plugins/variants/src/VariantFeatureWidget/index.js","../../../plugins/variants/src/VcfTabixAdapter/configSchema.ts","../../../plugins/variants/src/index.ts","../../../plugins/variants/src/LinearVariantDisplay/configSchema.ts","../../../plugins/data-management/src/PluginStoreWidget/components/InstalledPlugin.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/InstalledPluginsList.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/PluginCard.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/CustomPluginForm.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/PluginStoreWidget.tsx","../../../packages/core/ReExports/modules.ts","../../../packages/core/ReExports/list.ts","../../../packages/core/ReExports/index.ts","../../../packages/core/Plugin.ts","../../../packages/core/data_adapters/BaseAdapter.ts","../../../packages/core/util/io/rangeFetcher.ts","../../../packages/core/util/io/index.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/baseLinearDisplayConfigSchema.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/LinearBlocks.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BaseLinearDisplay.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/serverSideRenderedBlock.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/BaseLinearDisplayModel.tsx","../../../plugins/linear-genome-view/src/LinearBareDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/index.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/configSchema.ts","../../../packages/core/util/simpleFeature.ts","../../../packages/core/util/rxjs.ts","../../../packages/core/pluggableElementTypes/models/baseConnectionConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseConnectionModelFactory.js","../../../packages/core/pluggableElementTypes/models/BaseDisplayModel.tsx","../../../packages/core/pluggableElementTypes/models/BaseTrackModel.ts","../../../packages/core/pluggableElementTypes/models/baseTrackConfig.ts","../../../packages/core/util/io/ElectronRemoteFile.ts","../../../packages/core/PluginLoader.ts","../../../plugins/alignments/src/SNPCoverageAdapter/SNPCoverageAdapter.ts","rpc.worker.ts","../../../packages/core/pluggableElementTypes/AdapterType.ts","../../../packages/core/pluggableElementTypes/DisplayType.ts","../../../packages/core/pluggableElementTypes/ConnectionType.ts","../../../packages/core/rpc/remoteAbortSignals.ts","../../../packages/core/pluggableElementTypes/RpcMethodType.ts","../../../packages/core/BaseFeatureWidget/index.ts","../../../packages/core/data_adapters/dataAdapterCache.ts","../../../packages/core/rpc/coreRpcMethods.ts","../../../packages/core/CorePlugin.ts","../../../packages/core/PluginManager.ts","../../../packages/core/util/analytics.ts","sessionSharing.ts","../../../packages/core/util/offscreenCanvasUtils.tsx","../../../plugins/wiggle/src/WiggleBaseRenderer.tsx","../../../plugins/wiggle/src/WiggleRendering.tsx","../../../plugins/wiggle/src/BigWigAdapter/configSchema.ts","../../../plugins/wiggle/src/util.ts","../../../plugins/wiggle/src/configSchema.ts","../../../plugins/wiggle/src/DensityRenderer/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/components/Tooltip.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/WiggleDisplayComponent.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/models/model.tsx","../../../plugins/wiggle/src/XYPlotRenderer/XYPlotRenderer.ts","../../../plugins/wiggle/src/XYPlotRenderer/index.ts","../../../plugins/wiggle/src/LinePlotRenderer/LinePlotRenderer.js","../../../plugins/wiggle/src/LinePlotRenderer/index.js","../../../plugins/wiggle/src/WiggleRPC/rpcMethods.ts","../../../plugins/wiggle/src/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/models/configSchema.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/index.js","../../../plugins/alignments/src/BamAdapter/configSchema.ts","../../../plugins/alignments/src/BamAdapter/index.ts","../../../plugins/alignments/src/CramAdapter/configSchema.ts","../../../plugins/alignments/src/CramAdapter/index.ts","../../../plugins/alignments/src/HtsgetBamAdapter/configSchema.ts","../../../plugins/alignments/src/HtsgetBamAdapter/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/configSchema.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/model.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/components/AlignmentsDisplay.tsx","../../../plugins/alignments/src/LinearPileupDisplay/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/LinearPileupDisplayBlurb.tsx","../../../plugins/alignments/src/shared.ts","../../../plugins/alignments/src/LinearPileupDisplay/model.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/components/Tooltip.tsx","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/model.ts","../../../plugins/alignments/src/PileupRenderer/components/PileupRendering.tsx","../../../plugins/alignments/src/PileupRenderer/configSchema.ts","../../../plugins/alignments/src/PileupRenderer/PileupLayoutSession.ts","../../../plugins/alignments/src/PileupRenderer/PileupRenderer.tsx","../../../plugins/alignments/src/PileupRenderer/sortUtil.ts","../../../plugins/alignments/src/SNPCoverageAdapter/configSchema.ts","../../../plugins/alignments/src/SNPCoverageAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageRenderer/configSchema.js","../../../plugins/alignments/src/SNPCoverageRenderer/SNPCoverageRenderer.ts","../../../plugins/alignments/src/SNPCoverageRenderer/index.js","../../../plugins/alignments/src/PileupRPC/rpcMethods.ts","../../../plugins/alignments/src/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/configSchema.ts","../../../plugins/bed/src/BigBedAdapter/configSchema.ts","../../../plugins/bed/src/BedTabixAdapter/configSchema.ts","../../../plugins/bed/src/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointAlignmentsFeatureDetail/index.js","../../../plugins/breakpoint-split-view/src/model.ts","../../../plugins/breakpoint-split-view/src/util.ts","../../../plugins/breakpoint-split-view/src/components/AlignmentConnections.tsx","../../../plugins/breakpoint-split-view/src/components/Breakends.tsx","../../../plugins/breakpoint-split-view/src/components/Header.tsx","../../../plugins/breakpoint-split-view/src/components/Translocations.tsx","../../../plugins/breakpoint-split-view/src/components/BreakpointSplitView.tsx","../../../plugins/breakpoint-split-view/src/BreakpointSplitView.ts","../../../plugins/breakpoint-split-view/src/index.ts","../../../plugins/data-management/src/ucsc-trackhub/configSchema.js","../../../plugins/data-management/src/ucsc-trackhub/ucscAssemblies.js","../../../plugins/data-management/src/ucsc-trackhub/ucscTrackHub.js","../../../plugins/data-management/src/ucsc-trackhub/model.js","../../../plugins/data-management/src/AddTrackWidget/model.ts","../../../plugins/data-management/src/AddTrackWidget/index.js","../../../plugins/data-management/src/AddConnectionWidget/model.js","../../../plugins/data-management/src/AddConnectionWidget/index.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/model.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/index.js","../../../plugins/data-management/src/PluginStoreWidget/model.ts","../../../plugins/data-management/src/PluginStoreWidget/index.js","../../../plugins/data-management/src/index.ts","../../../plugins/dotplot-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/components/DotplotDisplay.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/components/DotplotRendering.tsx","../../../plugins/dotplot-view/src/DotplotRenderer/configSchema.ts","../../../packages/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType.ts","../../../plugins/dotplot-view/src/DotplotView/model.ts","../../../plugins/dotplot-view/src/DotplotRenderer/DotplotRenderer.ts","../../../plugins/dotplot-view/src/PAFAdapter/PAFAdapter.ts","../../../plugins/dotplot-view/src/PAFAdapter/configSchema.ts","../../../plugins/dotplot-view/src/DotplotRenderer/ComparativeRenderRpc.ts","../../../plugins/dotplot-view/src/index.ts","../../../plugins/filtering/src/LinearFilteringDisplay/model.js","../../../plugins/filtering/src/LinearFilteringDisplay/components/FilterControls.js","../../../plugins/filtering/src/LinearFilteringDisplay/components/LinearFilteringDisplay.js","../../../plugins/filtering/src/index.ts","../../../plugins/filtering/src/LinearFilteringDisplay/index.js","../../../plugins/gff3/src/Gff3TabixAdapter/configSchema.ts","../../../plugins/gff3/src/index.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/util.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigParse.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigLoad.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ToJb2.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/model.js","../../../plugins/legacy-jbrowse/src/index.ts","../../../plugins/linear-comparative-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/components/LinearComparativeDisplay.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/model.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/util.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/components/LinearSyntenyRendering.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/configSchema.js","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/LinearSyntenyRenderer.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/index.ts","../../../plugins/linear-comparative-view/src/MCScanAnchorsAdapter/MCScanAnchorsAdapter.ts","../../../plugins/linear-comparative-view/src/MCScanAnchorsAdapter/configSchema.ts","../../../plugins/linear-comparative-view/src/index.tsx","../../../plugins/lollipop/src/LinearLollipopDisplay/model.ts","../../../plugins/lollipop/src/LollipopRenderer/components/Lollipop.js","../../../plugins/lollipop/src/LollipopRenderer/components/Stick.js","../../../plugins/lollipop/src/LollipopRenderer/components/LollipopRendering.js","../../../plugins/lollipop/src/LollipopRenderer/configSchema.ts","../../../plugins/lollipop/src/LollipopRenderer/Layout.ts","../../../plugins/lollipop/src/LollipopRenderer/LollipopRenderer.js","../../../plugins/lollipop/src/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/configSchema.ts","../../../plugins/menus/src/AboutWidget/index.js","../../../plugins/menus/src/HelpWidget/index.js","../../../plugins/menus/src/ImportSessionWidget/index.ts","../../../plugins/menus/src/SessionManager/index.js","../../../plugins/menus/src/index.ts","../../../plugins/rdf/src/SPARQLAdapter/SPARQLAdapter.ts","../../../plugins/rdf/src/SPARQLAdapter/configSchema.ts","../../../plugins/rdf/src/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/configSchema.ts","../../../plugins/sequence/src/ChromSizesAdapter/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/components/DivSequenceRendering.tsx","../../../plugins/sequence/src/DivSequenceRenderer/configSchema.ts","../../../plugins/sequence/src/IndexedFastaAdapter/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/configSchema.ts","../../../plugins/sequence/src/TwoBitAdapter/configSchema.ts","../../../plugins/sequence/src/GCContentAdapter/configSchema.ts","../../../plugins/sequence/src/GCContentAdapter/index.ts","../../../plugins/sequence/src/index.ts","../../../plugins/sequence/src/referenceSeqTrackConfig.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/model.ts","../../../packages/core/util/layouts/SceneGraph.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureLabel.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureGlyph.js","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgOverlay.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Box.js","../../../plugins/svg/src/SvgFeatureRenderer/components/Chevron.js","../../../plugins/svg/src/SvgFeatureRenderer/components/Segments.js","../../../plugins/svg/src/SvgFeatureRenderer/components/ProcessedTranscript.js","../../../plugins/svg/src/SvgFeatureRenderer/components/Subfeatures.js","../../../plugins/svg/src/SvgFeatureRenderer/components/util.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgFeatureRendering.js","../../../plugins/svg/src/SvgFeatureRenderer/configSchema.ts","../../../plugins/svg/src/index.ts","../../../plugins/trackhub-registry/src/trackhub-registry/configSchema.js","../../../plugins/trackhub-registry/src/trackhub-registry/tracks.js","../../../plugins/trackhub-registry/src/trackhub-registry/model.js","../../../plugins/trackhub-registry/src/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/MakeSpreadsheetColumnType.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocString.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Text.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocRef.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Number.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocStart.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocEnd.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Row.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/StaticRowSet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Spreadsheet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ImportWizard.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/FilterControls.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/SpreadsheetView.ts","../../../plugins/spreadsheet-view/src/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/components/SvInspectorView.js","../../../plugins/sv-inspector/src/SvInspectorView/models/adhocFeatureUtils.js","../../../plugins/sv-inspector/src/SvInspectorView/models/breakpointSplitViewFromTableRow.js","../../../plugins/sv-inspector/src/SvInspectorView/models/SvInspectorView.js","../../../plugins/sv-inspector/src/SvInspectorView/SvInspectorViewType.js","../../../plugins/sv-inspector/src/index.ts","../../../plugins/hic/src/HicRenderer/components/HicRendering.tsx","../../../plugins/hic/src/HicRenderer/configSchema.ts","../../../plugins/hic/src/HicRenderer/HicRenderer.tsx","../../../plugins/hic/src/LinearHicDisplay/configSchema.ts","../../../plugins/hic/src/LinearHicDisplay/model.ts","../../../plugins/hic/src/HicAdapter/configSchema.ts","../../../plugins/hic/src/index.ts","corePlugins.ts","ShareButton.tsx","AdminComponent.tsx","JBrowse.js","../../../packages/core/assemblyManager/assembly.ts","../../../packages/core/assemblyManager/assemblyManager.ts","../../../packages/core/assemblyManager/assemblyConfigSchemas.ts","../../../packages/core/rpc/configSchema.ts","../../../packages/core/rpc/BaseRpcDriver.ts","../../../packages/core/rpc/WebWorkerRpcDriver.ts","../../../packages/core/rpc/MainThreadRpcDriver.ts","../../../packages/core/rpc/ElectronRpcDriver.ts","../../../packages/core/rpc/RpcManager.ts","jbrowseModel.js","sessionModelFactory.ts","rootModel.ts","factoryReset.ts","Loader.tsx","../../../packages/core/pluggableElementTypes/TrackType.ts","../../../packages/core/pluggableElementTypes/WidgetType.ts","../../../packages/core/ui/Icons.tsx","../../../packages/core/pluggableElementTypes/PluggableElementBase.ts","../../../packages/core/ui/Menu.tsx","../../../plugins/alignments/src/BamAdapter/MismatchParser.ts","../../../packages/core/pluggableElementTypes/ViewType.ts","../../../packages/core/util/types/index.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ExportSvgDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ReturnToImportFormDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/index.tsx","../../../packages/core/configuration/configurationSlot.ts","../../../packages/core/configuration/configurationSchema.ts","../../../packages/core/util/color/cssColorsLevel4.ts","../../../packages/core/util/color/index.ts","../../../packages/core/util/mst-reflection.js","../../../packages/core/util/range.ts","../../../packages/core/util/blockTypes.ts","../../../packages/core/util/Base1DViewModel.ts","../../../packages/core/util/layouts/GranularRectLayout.ts","../../../packages/core/util/layouts/PrecomputedLayout.ts","../../../packages/core/pluggableElementTypes/renderers/BoxRendererType.ts","../../../packages/core/BaseFeatureWidget/SequenceFeatureDetails.tsx","../../../packages/core/BaseFeatureWidget/BaseFeatureDetail.tsx","../../../packages/core/pluggableElementTypes/renderers/ServerSideRenderedContent.tsx","../../../packages/core/pluggableElementTypes/renderers/ServerSideRendererType.tsx","../../../packages/core/util/aborting.ts","../../../packages/core/util/jexlStrings.ts","../../../packages/core/ui/SanitizedHTML.tsx","../../../packages/core/pluggableElementTypes/models/BaseViewModel.ts","../../../packages/core/pluggableElementTypes/renderers/util/serializableFilterChain.ts","../../../packages/core/pluggableElementTypes/renderers/FeatureRendererType.ts","../../../packages/core/util/QuickLRU.js","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewRubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ZoomControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Header.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/VerticalGuides.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/CenterLine.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TracksContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ImportForm.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/MiniControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SequenceDialog.tsx","../../../packages/core/util/formatFastaStrings.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Ruler.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeView.tsx","../../../packages/core/configuration/util.ts","../../../packages/core/util/calculateDynamicBlocks.ts","../../../packages/core/ui/FileSelector.tsx","../../../packages/core/util/offscreenCanvasPonyfill.js","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Block.tsx","../../../plugins/alignments/src/util.ts","../../../plugins/config/src/ConfigurationEditorWidget/components/JsonEditor.js","../../../plugins/variants/src/VcfTabixAdapter/VcfFeature.ts","../../../packages/core/configuration/index.ts","../../../packages/core/util/index.ts","../../../plugins/circular-view/src/CircularView/models/viewportVisibleRegion.ts","../../../plugins/circular-view/src/CircularView/models/slices.ts","../../../plugins/circular-view/src/CircularView/models/CircularView.ts","../../../plugins/circular-view/src/BaseChordDisplay/components/Loading.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/DisplayError.js","../../../plugins/circular-view/src/BaseChordDisplay/components/RpcRenderedSvgGroup.js","../../../plugins/circular-view/src/BaseChordDisplay/components/BaseChordDisplay.tsx","../../../plugins/circular-view/src/BaseChordDisplay/models/renderReaction.js","../../../plugins/circular-view/src/BaseChordDisplay/models/BaseChordDisplayModel.ts","../../../plugins/circular-view/src/BaseChordDisplay/models/baseChordDisplayConfig.ts","../../../plugins/circular-view/src/index.ts","../../../plugins/config/src/ConfigurationEditorWidget/model.js","../../../plugins/config/src/ConfigurationEditorWidget/index.js","../../../plugins/config/src/FromConfigAdapter/FromConfigAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigRegionsAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigSequenceAdapter.ts","../../../plugins/config/src/FromConfigAdapter/configSchema.ts","../../../plugins/config/src/RefNameAliasAdapter/RefNameAliasAdapter.ts","../../../plugins/config/src/RefNameAliasAdapter/configSchema.ts","../../../plugins/config/src/index.ts","../../../packages/core/pluggableElementTypes/renderers/RendererType.ts","../../../packages/core/util/when.ts","../../../packages/core/util/jexl.ts","../../../packages/core/util/stats.ts"],"names":["calculateStaticBlocks","model","padding","elision","extra","width","window","innerWidth","offsetPx","displayedRegions","bpPerPx","minimumBlockWidth","interRegionPaddingWidth","windowLeftBp","windowRightBp","blockSizePx","blockSizeBp","Math","ceil","regionBpOffset","blocks","BlockSet","forEach","region","regionNumber","assemblyName","refName","regionStart","start","regionEnd","end","reversed","regionBlockCount","windowRightBlockNum","floor","windowLeftBlockNum","regionWidthPx","blockNum","isLeftEndOfDisplayedRegion","isRightEndOfDisplayedRegion","max","min","blockData","parentRegion","widthPx","key","assembleLocString","push","InterRegionPaddingBlock","variant","ElidedBlock","ContentBlock","length","CircularChordRendererType","FeatureRenderer","MultiLayout","SubLayoutClass","layoutArgs","subLayouts","Map","subLayoutConstructorArgs","this","layoutName","subLayout","get","undefined","set","id","left","right","height","data","getSublayout","addRect","layout","discardRange","entries","sublayout","toJSON","electron","ElectronLocalFile","source","ipcRenderer","filename","fd","Error","invoke","buffer","a","offset","position","fetchLength","getFd","res","Buffer","from","copy","result","byteLength","Symbol","iterator","CompositeMap","submaps","values","has","submap","keys","Set","add","f","value","k","BigWigAdapter","config","bigwig","BigWig","filehandle","openLocation","readConfObject","opts","statusCallback","getHeader","setup","header","Object","refsByName","refId","h","refsByNumber","name","rectifyStats","totalSummary","signal","resolution","ObservableCreate","observer","getFeatureStream","basesPerSpan","pipe","mergeAll","map","record","SimpleFeature","subscribe","BaseFeatureDataAdapter","capabilities","adapterCapabilities","ElementId","types","optional","identifier","shortid","generate","PropTypes","Region","propTypes","shape","string","isRequired","number","ConfigSchema","MxPropTypes","objectOrObservableObject","Feature","func","NoAssemblyRegion","boolean","actions","self","setRefName","newRefName","compose","LocalPathLocation","localPath","BlobLocation","blobId","UriLocationRaw","uri","baseUri","maybe","UriLocation","snapshotProcessor","postProcessor","snap","rest","FileLocation","union","getTrackAssemblyNames","track","trackConf","configuration","trackAssemblyNames","parent","getParent","getRpcSessionId","thisNode","highestRpcSessionId","node","isRoot","rpcSessionId","getParentRenderProps","currentNode","renderProps","UNKNOWN","UNSUPPORTED","blobMap","getBlob","getBlobMap","setBlobMap","storeBlobLocation","location","Date","now","blob","guessAdapter","file","index","getFileName","adapterHint","makeIndex","suffix","fileName","indexName","makeIndexType","typeA","typeB","toUpperCase","endsWith","test","type","bamLocation","indexType","cramLocation","craiLocation","gffGzLocation","vcfGzLocation","bedGzLocation","bigBedLocation","bigWigLocation","fastaLocation","faiLocation","gziLocation","twoBitLocation","rootUrlTemplate","endpoint","hicLocation","pafLocation","guessTrackType","adapterType","BamAdapter","CramAdapter","BgzipFastaAdapter","IndexedFastaAdapter","TwoBitAdapter","VcfTabixAdapter","HicAdapter","PAFAdapter","generateUnsupportedTrackConf","trackName","trackUrl","categories","conf","description","category","trackId","objectHash","generateUnknownTrackConf","refTheme","createMuiTheme","jbrowseDefaultPalette","primary","main","secondary","tertiary","palette","augmentColor","quaternary","stopCodon","startCodon","bases","A","green","C","blue","G","amber","T","red","createJBrowseDefaultProps","MuiButton","size","MuiFilledInput","margin","MuiFormControl","MuiFormHelperText","MuiIconButton","MuiInputBase","MuiList","dense","MuiListItem","MuiOutlinedInput","MuiFab","MuiTable","MuiTextField","MuiToolbar","MuiSvgIcon","fontSize","MuiToggleButtonGroup","MuiCheckbox","MuiLink","underline","createJBrowseDefaultOverrides","generatedPalette","deepmerge","colorSecondary","color","textSecondary","backgroundColor","root","MuiAccordionSummary","background","minHeight","contrastText","content","expanded","MuiMenuItem","paddingTop","paddingBottom","MuiListItemIcon","minWidth","MuiListItemText","inset","paddingLeft","jbrowseBaseTheme","typography","spacing","props","overrides","createJBrowseTheme","theme","getColors","midnight","forrest","grape","mandarin","gray","Logomark","viewBox","Icon","LogoFull","Text","colors","style","fill","d","aria-label","transform","useStyles","makeStyles","horizontalHandle","cursor","verticalHandle","flexbox_verticalHandle","alignSelf","flexbox_horizontalHandle","ResizeHandle","className","onDrag","vertical","flexbox","originalClassName","useState","mouseDragging","setMouseDragging","prevPos","useRef","classes","useEffect","mouseMove","event","preventDefault","distance","current","actualDistance","mouseUp","addEventListener","removeEventListener","data-resizer","onMouseDown","pos","role","clsx","paper","overflowY","zIndex","outline","default","resizeHandle","top","Drawer","children","session","elevation","square","drawerActions","float","fade","drawerToolbar","spacer","flexGrow","drawerSelect","drawerLoading","dropDownIcon","DrawerHeader","setToolbarHeight","visibleWidget","activeWidgets","useTheme","ref","disableGutters","data-testid","icon","renderValue","selected","getEnv","HeadingComp","headingText","onChange","option","handleChange","Array","widget","onClick","drawerCloseButton","ReactComponent","pluginManager","toolbarHeight","open","Boolean","fallback","display","buttonRoot","action","hoverOpacity","menuTitle","menuItems","setOpen","anchorEl","handleClose","Button","Menu","anchorOrigin","horizontal","onMenuItemClick","_event","callback","onClose","input","inputBase","whiteSpace","visibility","inputRoot","inputFocused","borderStyle","borderRadius","borderWidth","EditableTypography","React","forwardRef","setValue","other","editedValue","setEditedValue","setWidth","sizerNode","setSizerNode","inputNode","setInputNode","blur","setBlur","clientWidth","Typography","component","InputBase","inputRef","inputProps","focused","target","onKeyDown","onBlur","snackbarMessage","setSnackbarMessage","popSnackbarMessage","snackbarMessages","latestMessage","timeoutId","setTimeout","clearTimeout","reason","message","level","Snackbar","IconButton","Alert","severity","viewContainer","overflow","grow","iconRoot","listItemIconRoot","listItemInset","menuItemDense","paddingRight","secondaryActionRoot","light","borderColor","ViewMenu","IconButtonProps","IconProps","setAnchorEl","aria-controls","aria-haspopup","currentTarget","withContentRect","view","contentRect","measureRef","padWidth","bounds","isAlive","scrollRef","scrollIntoView","block","Paper","edge","title","arrow","displayName","assemblyNames","join","val","setDisplayName","html","fab","marginTop","bottom","menuBarAndComponents","gridColumn","gridTemplateRows","menuBar","gridRow","components","appBar","HeaderButtons","drawerWidth","minimized","savedSessionNames","menus","views","gridTemplateColumns","menu","maxHeight","viewType","getTrackType","PrerenderedCanvas","highResolutionScaling","imageData","showSoftClip","featureCanvas","canvas","context","getContext","commands","command","strokeStyle","fillStyle","font","args","ImageBitmapType","drawImage","dataURL","img","Image","onload","src","softClipString","defaultProps","onFactoryReset","handleDialogClose","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","hoverLabel","border","pointerEvents","offsetX","offsetY","feature","timeout","shown","setShown","handle","text","ResetComponent","resetButtonText","dialogOpen","setDialogOpen","FactoryResetDialog","FatalErrorDialog","componentStack","error","toString","reload","jbrequire","ConfigurationSchema","ConfigurationReference","getContainingView","configSchema","renderer","baseConfiguration","explicitlyTyped","stateModel","rpcDriverName","displayModel","bezierRadius","radius","blockDefinitions","onChordClick","lib","load","DisplayType","ChordVariantDisplay","trackType","BaseChordDisplayComponentFactory","linearBasicDisplayModelFactory","literal","selectFeature","getSession","isSessionModelWithWidgets","rpcManager","sessionId","getContainingTrack","adapterConfig","getConf","call","featureWidget","addWidget","featureData","descriptions","showWidget","setSelection","useMemo","polarToCartesian","blockStart","blockEnd","bpOffset","Chord","blocksForRefs","startBlock","svType","matePosition","breakendSpecification","endPosition","parseInt","endBlock","chr2","mate","startPos","startRadians","bpToRadians","endRadians","startXY","endXY","controlXY","strokeColor","hoverStrokeColor","stroke","evt","onMouseOver","onMouseOut","features","selectedFeatureId","blocksForRefsMemo","regions","chords","String","trackStyleId","dangerouslySetInnerHTML","__html","StructuralVariantChords","ChordRendererType","defaultValue","contextVariable","strokeColorSelected","strokeColorHover","stateModelFactory","setFeatureData","clearFeatureData","enumeration","VariantsPlugin","addAdapterType","AdapterType","vcfTabixAdapterConfigSchema","getAdapterClass","then","r","addRendererType","StructuralVariantChordRendererFactory","addTrackType","createBaseTrackConfig","TrackType","createBaseTrackModel","addDisplayType","linearBasicDisplayConfigSchemaFactory","linearVariantDisplayConfigSchemaFactory","linearVariantDisplayModelFactory","BaseLinearDisplayComponent","addWidgetType","WidgetType","heading","variantFeatureWidgetConfigSchema","variantFeatureWidgetStateModelFactory","lazy","Plugin","closeDialog","dialogContainer","LockedPlugin","Tooltip","marginRight","plugin","sessionPlugins","getSnapshot","isSessionPlugin","some","p","rootModel","jbrowse","adminMode","ListItem","justifyContent","removePlugin","isSessionWithSessionPlugins","removeSessionPlugin","plugins","corePlugins","filter","pluginMetadata","isCore","externalPlugins","includes","List","toLowerCase","filterText","card","marginLeft","bold","fontWeight","dataField","alignItems","isInstalled","hasPlugin","tempDisabled","setTempDisabled","disableButton","Card","CardContent","Link","href","rel","authors","CardActions","disabled","startIcon","addPlugin","url","addSessionPlugin","flexDirection","formInput","setFormInput","getRoot","TextField","label","multiline","accordion","expandIcon","searchBox","marginBottom","adminBadge","alignContent","customPluginButton","pluginArray","setPluginArray","customPluginFormOpen","setCustomPluginFormOpen","killed","fetch","fetchResult","ok","json","array","isElectron","setFilterText","fullWidth","InputProps","endAdornment","InputAdornment","clearFilterText","Accordion","defaultExpanded","AccordionSummary","libs","mobx","mst","react","ReactDom","mxreact","MUICore","MUISvgIcon","MUIUtils","MUILab","MUIDataGrid","MUIColors","MUIStyles","MUIBox","MUIButton","MUIButtonGroup","MUICard","MUICardContent","MUIContainer","MUICheckbox","MUIDialog","MUIFormGroup","MUIFormLabel","MUIFormControl","MUIFormControlLabel","MUIGrid","MUIIcon","MUIIconButton","MUIInputAdornment","MUILinearProgress","MUIListItemIcon","MUIListItemText","MUIMenu","MUIMenuItem","MUIRadioGroup","MUIRadio","MUISelect","MUISnackbar","MUISnackbarContent","MUITextField","MUITooltip","MUITypography","ToggleButton","ToggleButtonGroup","ViewType","pluggableElementTypeModels","ServerSideRendererType","BoxRendererType","Configuration","mstTypes","coreUi","coreUtil","coreColor","trackUtils","Base1DView","coreIo","coreMstReflection","rxjs","BaseFeatureDetail","BaseAdapterExports","modules","version","configurationSchema","_pluginManager","idMaker","i","hashCode","BaseAdapter","create","getSubAdapter","jest","isStateTreeNode","_opts","hasDataForRefName","hasData","checkAbortSignal","getFeatures","takeUntil","observeAbortSignal","complete","obs","merge","getRefNames","refNames","feats","scoresToStats","blankStats","Promise","all","getRegionStats","scoreMax","s","reduce","acc","curr","scoreMin","scoreSum","b","scoreSumSquares","featureCount","basesCovered","isSequenceAdapter","thing","isRegionsAdapter","isFeatureAdapter","isRefNameAliasAdapter","getfetch","method","credentials","options","requestDate","requestHeaders","headers","range","responseDate","status","v","arrayBuffer","globalRangeCache","HttpRangeFetcher","chunkSize","maxFetchSize","minimumTTL","globalCacheFetch","Headers","isArray","find","rangeParse","exec","e","getRange","response","Response","navigator","userAgent","openUrl","arg","ElectronRemoteFile","RemoteFile","isUriLocation","isLocalPathLocation","URL","LocalFile","isBlobLocation","BlobFile","baseLinearDisplayConfigSchema","maxDisplayedBpPerPx","Number","MAX_VALUE","explicitIdentifier","linearBlocks","textAlign","heightOverflowed","borderBottom","textShadow","boxSizing","RenderedBlocks","blockState","state","maxHeightReached","getTotalHeight","boundary","viewModel","mouseCoord","featureUnderMouse","mouseover","placement","BaseLinearDisplay","setMouseCoord","contextCoord","setContextCoord","TooltipComponent","DisplayMessageComponent","contextMenuItems","setContextMenuFeature","onContextMenu","clientX","clientY","onMouseMove","rect","getBoundingClientRect","_","onExit","anchorReference","anchorPosition","tooltip","loading","disabledBackground","backgroundImage","blockMessage","blockError","blockReactNodeMessage","dots","animation","Repeater","LoadingMessage","blockStatus","BlockMessage","messageContent","BlockError","displayHeight","ServerSideRenderedBlockContent","filled","reactElement","volatile","renderInProgress","afterAttach","getContainingDisplay","makeAbortableReaction","renderBlockData","renderBlockEffect","delay","renderDelay","fireImmediately","setLoading","setRendered","setError","setStatus","abortController","aborted","abort","setMessage","messageText","console","beforeDestroy","rendererType","renderArgs","cast","freeResourcesInClient","JSON","parse","stringify","catch","warn","optDisplay","assemblyManager","displayError","parentTrack","regionAsm","hasName","cannotBeRenderedReason","regionCannotBeRendered","blockKey","notReady","renderInClient","BaseDisplay","refinement","n","BlockState","userBpPerPxLimit","featureIdUnderMouse","contextMenuFeature","additionalContextMenuItemCallbacks","scrollTop","blockType","initialized","selection","isFeature","stale","rbush","featureMaps","layoutMaps","rectangles","getRectangles","blockLayoutFeatures","layoutFeatures","RBush","insert","minX","minY","maxX","maxY","getFeatureOverlapping","x","y","rtree","collides","search","blockWatchDisposer","autorun","blocksPresent","contentBlocks","addBlock","deleteBlock","addDisposer","setHeight","resizeHeight","oldHeight","setScrollTop","setUserBpPerPxLimit","limit","toRegion","delete","isSelectionContainer","clearFeatureSelection","clearSelection","setFeatureIdUnderMouse","temp","addAdditionalContextMenuItemCallback","regionCannotBeRenderedText","_region","maxViewBpPerPx","MenuOpenIcon","onFeatureClick","featureId","onFeatureContextMenu","onMouseLeave","composedRenderProps","renderSvg","overrideHeight","viewOffsetPx","dynamicBlocks","roundedDynamicBlocks","exportSVG","renderings","rendering","clipid","Fragment","clipPath","isValidElement","postProcessSnapshot","SetMaxHeightDlg","trackShowLabels","trackDisplayMode","trackMaxHeight","showLabels","displayMode","configBlob","toggleShowLabels","setDisplayMode","setMaxHeight","trackMenuItems","rendererConfig","VisibilityIcon","checked","subMenu","setDialogComponent","configSchemaFactory","pluggableConfigSchemaType","LinearGenomeViewPlugin","exports","linearBareDisplayConfigSchemaFactory","LinearBareDisplayStateModelFactory","addViewType","linearGenomeViewStateModelFactory","isAbstractMenuManager","appendToSubMenu","LineStyleIcon","addView","isSimpleFeatureSerialized","parentHandle","uniqueId","aliases","subfeatures","strand","parentId","c","child","Observable","ret","tracks","addTrackConf","addTrackConfs","trackConfs","setTrackConfs","clear","rendererTypeName","getDisplayType","RendererType","getRendererType","setRpcDriverName","baseTrackConfig","displays","pluggableMstType","pm","getAdapterType","viewMenuActions","isSessionModelWithConfigEditing","sessionTracks","activateConfigurationUI","editTrackConfiguration","hideTrack","showTrack","showDisplay","displayId","initialSnapshot","displayTypeConfigSchema","resolveIdentifier","displayType","hideDisplay","shownDisplays","transaction","remove","replaceDisplay","oldDisplayId","newDisplayId","displayIdx","findIndex","splice","displayChoices","compatibleDisplayTypes","getViewType","displayTypes","compatibleDisplays","displayConf","shownId","metadata","adapter","preProcessSnapshot","addDisplayConf","ElectronRemoteFileError","_stat","baseOverrides","nodeFetchFallback","nodeFetch","init","serializedResponse","statusText","startsWith","path","uri2path","TypeError","localFile","read","bind","readFile","stat","fetcharg","resp","myfetch","requestOptions","redirect","mode","isAbortException","getFetch","contentRange","sizeMatch","contentLength","Infinity","getBufferFromResponse","responseData","bytesCopied","bytesRead","encoding","err","headFetch","allocUnsafe","PluginLoader","pluginDefinitions","definitions","scriptUrl","document","getElementsByTagName","domLoadScript","importScripts","resolve","reject","definition","parsedUrl","protocol","loadScript","moduleName","umdName","scope","global","constructor","JBrowseExports","ReExports","module","loadPlugin","mismatchLen","mismatch","isInterbase","inc","bin","field","total","strands","dec","SNPCoverageAdapter","subadapterConfig","sequenceConf","dataAdapter","sequenceAdapter","subadapter","configure","stream","filters","passes","generateCoverageBins","next","score","snpinfo","colorBy","binMax","initBins","lowqual","cov","delskips","noncov","toArray","toPromise","feat","regionSeq","bins","cigar","fstart","fend","fstrand","cigarOps","parseCigar","j","seq","mm","getTagAlt","ml","probabilities","split","charCodeAt","elt","probIndex","getModificationPositions","positions","mod","getNextRefPos","epos","methBins","l2","l1","mismatches","mstart","base","interbase","Worker","stuff","AdapterClass","PluggableElementBase","getDefaultValue","ConnectionType","configEditorComponent","abortSignalCounter","abortSignalIds","WeakMap","surrogateAbortControllers","deserializeAbortSignal","abortSignalId","surrogateAbortController","AbortController","RpcMethodType","_rpcDriverClassName","serializedArgs","originalReturn","_args","serializedReturn","frozen","safeReference","adapterConfigCacheKey","jsonStableStringify","adapterCache","getAdapter","adapterConfigSnapshot","cacheKey","dataAdapterType","CLASS","sessionIds","cacheEntry","freeAdapterResources","specification","deleteCount","specKeys","freeResources","CoreGetRefNames","rpcDriverClassName","deserializeArguments","deserializedArgs","CoreGetFileInfo","CoreGetMetadata","getMetadata","CoreGetFeatures","CoreFreeResources","getRendererTypes","count","CoreRender","renameRegionsIfNeeded","renamedArgs","validateRendererType","serializeArgsInClient","render","renderInWorker","deserializeResultsInClient","CorePlugin","coreRpcMethods","RpcMethod","addRpcMethod","PhasedScheduler","phaseCallbacks","phaseOrder","phase","phaseName","TypeRecord","typeName","elementType","registeredTypes","baseClass","t","PluginManager","initialPlugins","jexl","createJexlInstance","runtimePluginDefinitions","elementCreationSchedule","rendererTypes","adapterTypes","trackTypes","connectionTypes","viewTypes","widgetTypes","rpcMethods","configured","jbrequireCache","pack","configurationSchemas","install","getPlugin","run","groupName","creationCallback","typeRecord","getElementTypeRecord","newElement","typeGroup","fieldName","null","pluggableTypes","isType","isModelType","isBareConfigurationSchemaType","methodName","addElementType","getElementTypesInGroup","newView","initialTimeStamp","sessionQuery","multiAssemblyTracks","savedSessionCount","localStorage","ver","assemblies","stats","screen","innerHeight","loadTime","jb2","qs","pluginNames","analyticsScript","gaData","metric1","round","analyticsScriptNode","createElement","innerHTML","appendChild","generateUID","Uint8Array","encrypt","AES","decrypt","bytes","getErrorMsg","sess","toUrlSafeB64","password","encryptedSession","body","sessionQueryParam","renderToAbstractCanvas","cb","rasterizeLayers","fakeCanvas","PonyfillOffscreenCanvas","fakeCtx","getSerializedSvg","createCanvas","ctx","scale","convertToBlob","blobToDataURL","toDataURL","xlinkHref","createImageBitmap","WiggleBaseRenderer","supportsSVG","draw","results","FeatureRendererType","getFeatureUnderMouse","eventClientX","px","clientBp","getScale","domain","scaleType","pivotValue","inverted","scaleLinear","scaleLog","scaleQuantize","nice","rangeMin","rangeMax","slice","reverse","getOrigin","getNiceDomain","minScore","maxScore","MIN_VALUE","getScaleType","posColor","negColor","highlightColor","clipColor","renderType","bicolorPivot","bicolorPivotValue","summaryScoreMode","displayCrossHatches","DensityRenderer","colorCallback","colorScale","scaleOpts","pivot","featureSpanPx","leftPx","w","fillRect","toP","parseFloat","toPrecision","popper","hoverVertical","TooltipContents","displayRef","toLocaleString","coord","loc","YSCALEBAR_LABEL_OFFSET","YScaleBar","orientation","ticks","format","orient","LEFT","RIGHT","LinearWiggleDisplay","ready","needsScalebar","SetMinMaxDlg","SetColorDlg","logb","log","pow","abs","selectedRendering","rendererTypeNameState","autoscale","constraints","observable","statsFetchInProgress","updateStats","setColor","aborter","statsFetch","setResolution","setFill","toggleLogScale","setScaleType","setSummaryScoreMode","setAutoscale","setMaxScore","setRendererType","setMinScore","toggleCrossHatches","setCrossHatches","cross","viewName","oldDomain","headroom","autoscaleType","axisPropsFromTickScale","adapterTypeName","hasResolution","canHaveFill","displayCrossHatchesSetting","hasGlobalStats","composedTrackMenuItems","superReload","superRenderSvg","getStats","nd","params","scoreMean","scoreStdDev","when","XYPlotRenderer","unadjustedHeight","originY","niceMin","niceMax","toY","toHeight","_score","moveTo","lineTo","crossingOrigin","rightPx","maxr","minr","lowClipping","highClipping","summary","Color","lighten","mix","darken","lineWidth","tick","beginPath","LinePlotRenderer","rawscore","lastVal","WiggleGetGlobalStats","l","SerializableFilterChain","getGlobalStats","WiggleGetMultiRegionStats","getMultiRegionStats","WigglePlugin","LinearWiggleDisplayReactComponent","XYPlotRendererReactComponent","xyPlotRendererConfigSchema","utils","linearWiggleDisplayModelFactory","XYPlotRendererConfigSchema","DensityRendererConfigSchema","LinePlotRendererConfigSchema","numStdDev","defaultRendering","renderers","linearWiggleDisplayConfigSchemaFactory","bigWigAdapterConfigSchema","DensityRendererReactComponent","densityRendererConfigSchema","LinePlotRendererReactComponent","linePlotRendererConfigSchema","late","chunkSizeLimit","fetchSizeLimit","configSchemaF","htsgetBase","htsgetTrackId","configModelFactory","PileupDisplayConfigSchema","SNPCoverageDisplayConfigSchema","pileupDisplay","snpCoverageDisplay","PileupDisplay","SNPCoverageDisplay","snpCovHeight","showCoverage","showPileup","toggleCoverage","togglePileup","setSNPCoverageHeight","DisplayBlurb","sortedBy","sortedByPosition","sortedByRefName","extraTrackMenuItems","setSNPCoverageDisplay","displayConfig","setPileupDisplay","deepEqual","snpCoverageDisplayConfig","setConfig","pileupDisplayConfig","filterBy","setFilterBy","setColorBy","pileupHeight","RenderingComponent","delta","PileupConfigFactory","PileupRendererConfigSchema","SvgFeatureRendererConfigSchema","PileupRenderer","SvgFeatureRenderer","colorScheme","getUniqueTagValues","tag","getUniqueModificationValues","ColorByTagDlg","FilterByTagDlg","SortByTagDlg","SetFeatureHeightDlg","ModificationsDlg","showSoftClipping","featureHeight","noSpacing","fadeLikelihood","mismatchAlpha","flagInclude","flagExclude","readName","tagFilter","colorTagMap","modificationTagMap","currBpPerPx","setReady","flag","setCurrBpPerPx","setFeatureHeight","setNoSpacing","setColorScheme","updateModificationColorMap","uniqueModifications","colorPalette","totalKeys","newColor","updateColorTagMap","uniqueTag","staticBlocks","uniqueTagSet","uniqueModificationsSet","clearSelected","copyFeatureToClipboard","copiedFeature","notify","toggleSoftClipping","toggleMismatchAlpha","setSortedBy","centerLineInfo","centerBp","centerRefName","ContentCopyIcon","LinearPileupDisplayBlurb","SortIcon","PaletteIcon","FilterListIcon","mismatchAlphaSetting","info","entry","drawInterbaseCounts","drawIndicators","modificationsReady","toggleDrawIndicators","drawIndicatorsSetting","toggleDrawInterbaseCounts","drawInterbaseCountsSetting","vals","highlightOverlayCanvas","mouseIsDown","setMouseIsDown","movedDuringLastMouseDown","setMovedDuringLastMouseDown","featIdUnderMouse","callMouseHandler","handlerName","featureHandler","canvasHandler","blockLayout","clearRect","leftBp","topPx","rightBp","bottomPx","bpSpanPx","rectTop","rectHeight","shadowColor","shadowBlur","lineJoin","strokeRect","highlightedFeature","canvasWidth","onMouseEnter","onMouseUp","onFocus","orientationType","minSubfeatureWidth","maxClippingSize","largeInsertionIndicatorScale","PileupLayoutSession","cachedLayout","cachedLayoutIsValid","makeLayout","LayoutSession","getColorBaseMap","deletion","alignmentColoring","color_fwd_strand_not_proper","color_rev_strand_not_proper","color_fwd_strand","color_rev_strand","color_fwd_missing_mate","color_rev_missing_mate","color_fwd_diff_chr","color_rev_diff_chr","color_pair_lr","color_pair_rr","color_pair_rl","color_pair_ll","color_nostrand","color_interchrom","color_longinsert","color_shortinsert","shouldDrawMismatches","charWidth","measureText","charHeight","expansionBefore","expansionAfter","cliplen","heightPx","len","bpExpansion","getOrientation","LR","RR","RL","LL","orientationTypes","_config","flags","flipper","scores","op","m","layoutFeature","modifications","col","readPos","alpha","hsl","regionSequence","rstart","rend","flip","closePath","colorType","colorByInsertSize","colorByOrientation","colorByStranded","tags","foundValue","drawRect","colorByPerBaseQuality","colorByModifications","colorByMethylation","colorForBase","drawSNPs","drawIndels","getCharWidthHeight","minFeatWidth","insertionScale","pxPerBp","heightLim","getAlphaColor","baseColor","qual","mismatchLeftPx","mismatchRightPx","mismatchWidthPx","getContrastText","fillText","txt","softClipLength","softClipStart","charAt","softClipLeftPx","softClipRightPx","softClipWidthPx","layoutRecords","configTheme","drawAlignmentRect","drawMismatches","drawSoftClipping","featureMap","featureArray","featuresInCenterLine","featuresOutsideCenter","innerArray","doesIntersect2","isCram","sort","getTag","localeCompare","baseSortArray","baseMap","aMismatch","bMismatch","acode","bcode","concat","sortFeature","iterMap","createLayoutInWorker","layoutFeats","makeImageData","indicatorThreshold","SNPCoverageRenderer","cfg","viewScale","snpViewScale","snpOriginY","snpToY","snpToHeight","insertion","softclip","hardclip","meth","unmeth","totalScore","replace","interbaseEvents","accum","maxBase","PileupGetGlobalValueForTag","getFeaturesInMultipleRegions","featuresArray","uniqueValues","PileupGetVisibleModifications","getModificationTypes","AlignmentsPlugin","linearAlignmentsDisplay","linearPileupDisplayConfigSchemaFactory","linearPileupDisplayModelFactory","SNPCoverageRendererConfigSchema","linearSNPCoverageDisplayConfigSchemaFactory","linearSNPCoverageDisplayModelFactory","linearAligmentsDisplayConfigSchemaFactory","linearAlignmentsDisplayModelFactory","LinearAlignmentsDisplayReactComponent","alignmentsFeatureDetailConfigSchema","alignmentsFeatureDetailStateModelFactory","BamAdapterF","SNPCoverageAdapterF","CramAdapterF","HtsgetBamAdapterF","PileupRendererReactComponent","pileupRendererConfigSchema","SNPCoverageRendererReactComponent","columnNames","scoreColumn","autoSql","BedPlugin","bigBedAdapterConfigSchema","bedTabixAdapterConfigSchema","intersect","a1","a2","a12","jbrequiredTypes","onAction","getPath","BaseViewModel","headerHeight","trackSelectorType","showIntraviewLinks","linkViews","interactToggled","idx","getMatchedTracks","trackConfigId","getTrack","hasPairedReads","getTrackFeatures","hasTranslocations","getMatchedTranslocationFeatures","alreadySeen","getMatchedBreakendFeatures","candidates","cur","isObject","alt","MatePosition","getMatchedAlignmentFeatures","unmapped","getBadlyPairedAlignments","correctlyPaired","getMatchedFeaturesInLayout","calc","onSubviewAction","actionName","lastIndexOf","newWidth","removeView","closeView","setHeaderHeight","toggleInteract","toggleIntraviewLinks","toggleLinkViews","TOP","BOTTOM","getPxFromCoordinate","bpToPx","yPos","chunk","clamp","trackRefs","heightFromSpecificLevel","useNextFrame","variable","setNextFrameState","AlignmentConnections","parentRef","assembly","totalFeatures","layoutMatches","mouseoverElt","setMouseoverElt","yOffset","c1","f1","level1","c2","f2","level2","f1origref","f2origref","f1ref","getCanonicalRefName","f2ref","x1","x2","reversed1","pxToBp","reversed2","y1","y2","Path","curveTo","strokeWidth","feature1","feature2","Breakends","yoff","relevantAlt","feat1","feat2","findMatchingAlt","Join","MateDirection","headerBar","gridArea","iconButton","emphasis","hovered","InteractWithSquiggles","LinkViews","Sync","Header","withSize","monitorHeight","Translocations","CHR2","end2","END","STRANDS","myDirection","mateDirection","breakpointMarker","viewDivider","container","overlay","Overlay","BreakpointSplitView","viewComponent","matchedTracks","BreakpointSplitViewType","endPos","mateRefName","featureRefName","topRegion","startMod","endMod","INFO","bottomRegion","topMarkedRegion","bottomMarkedRegion","hideHeader","BreakpointSplitViewModel","BreakpointSplitViewComponent","BreakpointSplitViewPlugin","BreakpointSplitViewFactory","alignmentsFeatureDetailStateModel","hubTxtLocation","baseConnectionConfig","hubFileText","genomesFileText","trackDbFileText","generateTracks","trackDb","trackKeys","parentTrackKeys","parentTracks","currentTrackName","baseTrackType","bigDataLocation","trackDbFileLocation","bigDataIndexLocation","makeTrackConfig","UCSCTrackHubConnection","BaseConnectionModelFactory","connect","connectionName","hubFileLocation","fetchHubFile","hubFile","genomesFileLocation","fetchGenomesFile","genomesFile","trackDbData","genomeName","genome","assemblyConf","fetchTrackDbFile","trackDbFile","isAbsoluteUrl","trackSource","trackData","indexTrackData","altAssemblyName","altTrackName","altTrackType","setAdapterHint","obj","setTrackSource","str","setTrackData","setIndexTrackData","setAssembly","setTrackName","setTrackType","clearData","isRelativeIndexUrl","isRelativeTrackUrl","trackHttp","indexHttp","trackAdapter","isFtp","isRelativeUrl","wrongProtocol","hasAnyOverlap","getTrackName","generateHierarchy","trackConfigurations","collapsed","hierarchy","regexp","RegExp","cat","passesFilter","currLevel","collapsedCategories","setView","toggleCategory","getRefSeqTrackConf","refseq","trackConfAssemblies","allAliases","trackDisplays","connectionTrackConfigurations","connection","hier","conns","conn","configAssemblyNames","connectionHierarchy","allTracksInCategoryPath","currentHier","pathItem","contents","newText","SetDefaultSession","AssemblyManager","addConnectionType","ucscConfigSchema","ucscModelFactory","HierarchicalTrackSelectorConfigSchema","HierarchicalTrackSelectorStateModelFactory","AddTrackConfigSchema","AddTrackStateModelFactory","AddConnectionConfigSchema","AddConnectionStateModel","PluginStoreConfigSchema","PluginStoreStateModelFactory","appendToMenu","NoteAddIcon","InputIcon","ExtensionIcon","wordWrap","LinearProgress","DotplotDisplay","vview","hview","ReactComponent2","renderingComponent","viewWidth","viewHeight","borderSize","borderX","borderY","drawMode","ComparativeServerSideRenderer","deserialized","requestRegions","requestRegion","featureObservable","featurePassesFilters","ServerSideRenderer","approxPixelStringLen","Dotplot1DView","extend","scaleFactor","box","calculateDynamicBlocks","setScaleFactor","DotplotHView","DotplotVView","tickSize","vtextRotation","htextRotation","viewTrackConfigs","viewAssemblyConfigs","volatileWidth","axis","regionsSnapshot","setDisplayedRegions","setBpPerPx","totalBp","setBorderY","setBorderX","newHeight","zoomOutButton","zoomOut","zoomInButton","zoomIn","activateTrackSelector","selector","trackConfigSchema","shownTracks","toggleTrack","setAssemblyNames","setViews","arr","getCoords","mousedown","mouseup","minmax","xmin","xmax","ymin","ymax","onDotplotView","d1","d2","setVolatileWidth","zoomTo","viewSnapshot","MismatchParser","DotplotRenderer","db1","db2","mateRef","b10","b20","e10","e20","b1","b2","e1","e2","currX","currY","prevX","prevY","dimensions","realizedViews","setFeatures","ComparativeServerSideRendererType","cache","AbortablePromiseCache","QuickLRU","maxSize","pafRecords","line","chr1","start1","end1","start2","numMatches","blockLen","mappingQual","fields","fromEntries","indexOf","records","syntenyId","ComparativeRender","getLength","getLengthSansClipping","DotplotPlugin","dotplotDisplayConfigSchemaFactory","dotplotDisplayStateModelFactory","DotplotDisplayReactComponent","dotplotRendererConfigSchema","DotplotRendererReactComponent","PAFAdapterConfigSchema","TimelineIcon","AddIcon","clipPos","SA","readAssembly","trackAssembly","supplementaryAlignments","aln","saRef","saStart","saStrand","saCigar","saLengthOnRef","lengthOnRef","getLengthOnRef","saLength","saLengthSansClipping","saStrandNormalized","saClipPos","match","getClip","saRealStart","seqLength","CIGAR","totalLength","refLength","sequence","addContextMenu","hideExpressions","filterControlsHeight","dragHandleHeight","filterOut","attrName","makeFilters","setFilterControlsHeight","resizeFilterControls","toggleFilter","styles","flexWrap","AttributeFilter","withStyles","formControl","row","control","ReactPropTypes","FilterControls","seenAttributes","reaction","newSeenAttributes","visibleValues","gutterBottom","Component","innerDisplay","overflowX","filterControls","innerDisplayHeight","borderTop","filterAttributes","linearFilteringDisplayConfigSchemaFactory","linearFilteringDisplayModelFactory","LinearFilteringDisplayReactComponent","dontRedispatch","gff3TabixAdapterConfigSchema","dataDirLocation","isTrack","deepUpdate","prop","clone","prototype","nodeType","cloneNode","getTime","dest","copyFunc","empty","mixin","parseJB1Json","parsedConf","regularizeConf","parseJB1Conf","keyPath","operation","lineNumber","section","recordVal","parsedValue","existing","getValue","textLine","trim","varName","isAlwaysArray","meta","trackMetadata","sources","sourceDef","newSourceDef","typeMatch","sourceUrl","baseUrl","addBase","stores","names","refSeqs","nameUrl","trackConfig","trackClassName","store","regularizeClass","synthesizeTrackStoreConfig","histograms","mainConf","storeClass","urlTemplate","backendVersion","guessStoreClass","storeConf","useAsRefSeqStore","refseqs","dataRoot","baseConfig","include","baseConfigRoot","dataRootReg","dataRootLocation","baseProtocol","baseConfigLocation","newConfig","fetchedConfig","fetchConfigFile","mergeConfigs","createFinalConfig","defaults","configDefaults","configWithDefaults","loadIncludes","fillTemplates","finalConfig","validateConfig","parseJb1","aTracks","bTracks","mergeTrackConfigs","bT","aT","inputConfig","loadRecur","upstreamConf","newUpstreamConf","regularizeIncludes","loads","cacheBuster","includedData","subconfig","sub","template","fillWith","fillTemplate","containerID","show_tracklist","show_nav","show_menu","show_overview","show_fullviewlink","update_browser_title","updateBrowserURL","datasets","_DEFAULT_EXAMPLES","volvox","modencode","yeast","highlightSearchedRegions","highResolutionMode","convertTrackConfig","jb1TrackConfig","jb2TrackConfig","Description","trackIdentifier","jb2Features","jb2Feature","seq_id","generateFromConfigTrackConfig","resolveUrlTemplate","baiUrlTemplate","csiUrlTemplate","craiUrlTemplate","tbiUrlTemplate","faiUrlTemplate","gziUrlTemplate","fetchJb1","jb2Tracks","jb1Track","jb2Track","LegacyJBrowsePlugin","ncListAdapterConfigSchema","jbrowse1ConfigSchema","jbrowse1ModelFactory","LinearComparativeDisplay","flat","param","removeAssembly","supportedDisplays","TrackSelectorIcon","modelFactory","baseModelFactory","parentView","generateMatches","interstitialYPos","cond","trackIds","matches","offsets","ref1","ref2","v1","v2","length1","length2","x11","x12","x21","x22","currX1","currX2","rev1","rev2","prevX1","prevX2","LinearSyntenyRenderer","serializedFeatures","_level","baseModel","MCScanAnchorsAdapter","geneNameToRows","rowToGeneName","subadapters","mcscanAnchorsLocation","name1","name2","tap","closeButton","grey","WindowSizeDlg","preFeature","setWindowSize","windowSize","primaryFeature","setPrimaryFeature","qualTrack","setQualTrack","done","primaryAln","primaryFeat","aria-labelledby","aria-describedby","featSeq","configFeatureStore","expand","seqTrackId","sequenceTrackConf","lgvRegions","addAssembly","noAssemblyManager","random","showReverse","showTranslation","CircularProgress","LinearComparativeViewFactory","LinearSyntenyViewFactory","linearComparativeDisplayConfigSchemaFactory","linearComparativeDisplayStateModelFactory","LinearComparativeDisplayReactComponent","middle","baseConfigFactory","linearSyntenyDisplayConfigSchemaFactory","linearSyntenyDisplayStateModelFactory","MCScanAnchorsConfigSchema","linearSyntenyRendererConfigSchema","LinearSyntenyRendererReactComponent","CalendarIcon","checkCallback","addCallback","ScoreText","layoutRecord","anchorX","radiusPx","innerColor","scoreString","fontHeight","contrastingTextColor","textAnchor","dominantBaseline","Lollipop","onFeatureMouseDown","handler","onFeatureMouseEnter","onFeatureMouseOut","onFeatureMouseOver","onFeatureMouseUp","onFeatureMouseLeave","onFeatureMouseMove","anchorLocation","styleOuter","styleInner","cx","cy","Stick","LollipopRendering","centerPx","sticksRendered","lollipopsRendered","layoutFeat","caption","minStickLength","stickColor","stickWidth","FloatingLayout","totalHeight","items","layoutDirty","sorted","maxBottom","layoutEntries","currentItem","previouslyLayedOutItem","prevStart","prevTop","prevEnd","prevBottom","pairs","getLayout","PrecomputedFloatingLayout","FloatingLayoutSession","LollipopRenderer","LollipopRendererReactComponent","lollipopRendererConfigSchema","linearLollipopDisplayConfigSchemaFactory","LinearLollipopDisplayStateModelFactory","aboutConfigSchema","aboutStateModel","helpConfigSchema","helpStateModel","importSessionConfigSchema","importSessionStateModel","sessionManagerConfigSchema","sessionManagerStateModel","InfoIcon","HelpIcon","insertInMenu","GetAppIcon","sessionBlob","Blob","saveAs","PublishIcon","FolderOpenIcon","SaveIcon","saveSessionToLocalStorage","FileCopyIcon","duplicateCurrentSession","SPARQLAdapter","queryTemplate","refNamesQueryTemplate","additionalQueryParams","configRefNames","encodeURIComponent","querySparql","resultsToRefNames","query","filledTemplate","resultsToFeatures","accept","rows","bindings","head","vars","requiredField","seenFeatures","rawData","rd","parentUniqueId","pid","sf","found","subfeature","seenFeature","RdfPlugin","sparqlAdapterConfigSchema","SPARQLAdapterClass","chromSizesLocation","Translation","codonTable","frame","tilt","effectiveFrame","seqSliced","translated","codon","normalizedCodon","revcom","aminoAcid","letter","drop","element","defaultStarts","defaultStops","DNA","SequenceSVG","showForward","generateCodonTable","defaultCodonTable","complement","Wrapper","divSequenceRendererConfigSchema","DivSequenceRenderer","SequencePlugin","twoBitAdapterConfigSchema","chromSizesAdapterConfigSchema","indexedFastaAdapterConfigSchema","bgzipFastaAdapterConfigSchema","GCContentAdapterF","createReferenceSeqTrackConfig","linearReferenceSequenceDisplayConfigSchema","toggleShowForward","toggleShowReverse","toggleShowTranslation","DivSequenceRendererReactComponent","SceneGraph","absoluteCache","inDevelopment","isNaN","dirty","nameOrSceneGraph","absolute","childLeft","childRight","childTop","childBottom","newLeft","newRight","newTop","newBottom","diff","walkParents","walkChildren","xOffset","Label","featureWidth","allowedWidthExpansion","fontWidthScaleFactor","fontWidth","totalWidth","FeatureGlyph","rootLayout","shouldShowName","shouldShowDescription","featureLayout","GlyphComponent","glyphComponents","OverlayRect","rectProps","screenWidth","leftWithinBlock","widthWithinBlock","handlers","mouseoverFeatureId","fillOpacity","stopPropagation","Box","color1","emphasizedColor1","emphasize","color2","Chevron","isUTR","direction","emphasizedColor","points","Segments","emphasizedColor2","subfeatureId","subfeatureLayout","ProcessedTranscript","getSubparts","filterSubpart","confKey","typeNames","makeSubpartsFilter","hasUTRs","isTranscript","subs","subparts","codeStart","codeEnd","exons","haveLeftUTR","haveRightUTR","makeUTRs","layOutFeature","layOutSubfeatures","Subfeatures","topOffset","SubfeatureGlyphComponent","chooseGlyphComponent","subfeatureHeight","subSubLayout","layOut","parentFeature","layoutParent","addChild","renderingStyle","RenderedFeatureGlyph","startPx","labelsAllowed","expansion","nameWidth","descriptionWidth","aboveLayout","RenderedFeatures","featuresRendered","SvgFeatureRendering","mouseDown","useCallback","mouseEnter","mouseLeave","mouseOver","mouseOut","featureIdCurrentlyUnderMouse","click","color3","labels","nameColor","descriptionColor","maxFeatureGlyphExpansion","subParts","impliedUTRs","SVGPlugin","SvgFeatureRendererReactComponent","svgFeatureRendererConfigSchema","trackDbId","trackPath","subTrack","getSubtracks","members","bigDataUrl","trackDbUrl","bigDataIndex","connectionConf","rawResponse","TrackHubRegistryPlugin","DataCellReactComponent","FilterModelType","compare","categoryName","getType","getPropertyType","getEnumerationValues","getSubType","compareLocs","parseLocString","MakeSpreadsheetColumnType","MenuItem","Select","textFilterControlAdornment","textFilterControl","FilterReactComponent","filterModel","operationChoices","placeholder","OPERATIONS","OPERATION_PREDICATES","cellLocation","specifiedLocation","isContainedWithin","spreadsheet","cell","canonicalRefName","newDisplayedRegion","newViewId","cellA","cellB","columnNumber","locString","parsed","parsedLocString","sheet","parsedCellText","predicate","setLocString","setOperation","locationLinkClick","contains","textInCell","equals","stringToFind","ColumnTextFilter","setString","TextColumn","NumberFilterModel","numberInCell","between","firstNumber","secondNumber","setFirstNumber","setSecondNumber","NumberColumn","ColumnTypes","NumberFactory","TextFactory","LocString","LocStringFactory","LocRef","LocRefFactory","LocStart","LocStartFactory","LocEnd","LocEndFactory","allColumnTypes","AnyColumnType","freeze","AnyFilterModelType","columnType","properties","CellModel","extendedData","cells","isSelected","toggleSelect","unSelect","select","setExtendedData","columns","column","isDerived","expr","evalSync","StaticRowSetComponentF","RowModel","Row","isLoaded","sortedFilteredRows","selectedRows","selectedFilteredRows","rowSortingComparisonFunction","rowPassesFilters","unselectAll","SpreadsheetModelF","ColumnDataTypes","StaticRowSetModel","StaticRowSetF","ColumnDefinition","dataType","derivationFunctionText","stringToJexlExpression","rowSet","columnDisplayOrder","hasColumnNames","sortColumns","descending","switchDirection","defaultDataType","rowMenuPosition","asm","hideRowSelection","rowA","rowB","cellsWithDerived","waitForAssembly","setLoaded","setRowMenuPosition","newPosition","setSortColumns","newSort","setColumnType","newTypeName","IMPORT_SIZE_LIMIT","fileTypes","fileTypeParsers","CSV","parseCsvBuffer","TSV","parseTsvBuffer","VCF","parseVcfBuffer","BED","parseBedBuffer","BEDPE","parseBedPEBuffer","parseSTARFusionBuffer","fileTypesRegexp","fileType","hasColumnNameLine","columnNameLineNumber","selectedAssemblyIdx","fileSource","readyToDisplay","isValidRefName","setFileSource","newSource","setSelectedAssemblyIdx","toggleHasColumnNameLine","setColumnNameLineNumber","newnumber","setFileType","cancelButton","import","typeParser","unzip","requiresUnzip","displaySpreadsheet","AnyColumnFilter","RowFullTextFilter","_sheet","rowFullText","columnFilters","setRowFullTextFilter","addBlankColumnFilter","removeColumnFilter","clearAllFilters","defaultRowMenuItems","DoneIcon","_view","rowNumber","SpreadsheetViewModelF","SpreadsheetModel","Spreadsheet","ImportWizardModel","ImportWizard","FilterControlsModel","hideViewControls","hideVerticalResizeHandle","hideFilterControls","importWizard","rowMenuItems","setRowMenuItems","newItems","resizeWidth","oldWidth","setImportMode","SpreadsheetViewPlugin","ViewComfyIcon","Grid","FormControlLabel","Checkbox","viewControls","viewsContainer","spreadsheetViewContainer","borderRight","circularViewOptions","ViewControls","item","CircularViewOptions","svInspector","circularViewOptionsBarHeight","SpreadsheetViewReactComponent","CircularViewReactComponent","showCircularView","spreadsheetView","ret1","circularView","otherData","columnsAlreadyUsedInLocations","loc1","loc2","locationColumnNumbers","makeAdHocFeature","textOf","colno","locRefColumnNumbers","locStartColumnNumbers","locEndColumnNumbers","makeAdHocSvFeature","columnTypes","columnDefinition","makeAdHocSvFeatureFromTwoLocations","makeAdHocSvFeatureFromTwoRefStartEndSets","adhocFeature","getSerializedFeatureForRow","svInspectorView","breakpointSplitViewSnapshotFromTableRow","canOpenBreakpointSplitViewFromTableRow","openBreakpointSplitViewFromTableRow","defaultOnChordClick","chordTrack","SpreadsheetViewType","CircularViewType","onlyDisplayRelevantRegionsInCircularView","hideTrackSelectorButton","disableImportForm","FromConfigAdapter","spreadsheetWidth","circularViewWidth","featuresRefNamesP","assemblyRegions","featureRefNames","canonicalFeatureRefNames","generatedTrackConf","setOnlyDisplayRelevantRegionsInCircularView","SvInspectorViewPlugin","SvInspectorViewTypeFactory","TableChartIcon","HicRenderer","getResolution","sqrt","bin1","minBin","maxBin","abortBreakPoint","bin2","counts","rotate","PI","HicTrackConfigFactory","HicRendererConfigSchema","HicPlugin","hicAdapterConfigSchema","HicRendererReactComponent","hicRendererConfigSchema","linearHicdisplayConfigSchemaFactory","linearHicdisplayModelFactory","addTransform","shareDiv","shareButton","loadingMessage","SHARE_URL_LOCALSTORAGE_KEY","SettingsDialog","currentSetting","setting","setSetting","infoDialogOpen","setInfoDialogOpen","InfoDialog","ShareDialog","shortUrl","setShortUrl","settingsDialogOpen","setSettingsDialogOpen","cancelled","locationUrl","shareSessionToDynamo","URLSearchParams","longUrl","longParams","maxWidth","readOnly","autoFocus","DataManagementPlugin","isAssemblyEditing","isDefaultSessionEditing","setDefaultSessionEditing","setAssemblyEditing","currentDefault","deleteBaseUris","useQueryParam","adminKey","adminServer","setSessionId","currentSessionId","onSnapshot","payload","refNameColors","loadRefNameMap","adapterConf","refNameAliases","refNameMap","checkRefName","canon","canonicalName","adapterName","forwardMap","reverseMap","assemblyFactory","assemblyConfigType","adapterLoads","abortSignal","MSTRegion","getRefNameColor","adapterRegionsWithAssembly","setRegions","setRefNameAliases","sequenceAdapterConfig","refNameAliasesAdapterConfig","makeLoadAssemblyData","loadAssemblyReaction","getAdapterMapEntry","adapterId","getAdapterId","getRefNameMapForAdapter","getReverseRefNameMapForAdapter","getRegions","adapterRegions","adapterRegion","refAliasAdapterType","RefAdapterClass","getRefAdapterClass","REFCLASS","refNameAliasAdapter","getRefNameAliases","alias","assemblyManagerFactory","Assembly","sessionAssemblies","allRefNames","allPossibleRefNames","assemblyList","assemblyConfigs","assemblyConfig","replaceAssembly","BaseAssemblyConfigSchema","AssemblyConfigSchema","assemblyConfigSchemas","dispatcher","snapshot","MainThreadRpcDriverConfigSchema","WebWorkerRpcDriverConfigSchema","ElectronRpcDriverConfigSchema","defaultDriver","drivers","MainThreadRpcDriver","addDriverConfig","configName","configSnapshot","isClonable","worker","pingTime","_resolve","LazyWorker","driver","makeWorker","watchWorker","maxPingTime","destroy","BaseRpcDriver","lastWorkerAssignment","workerAssignments","workerCount","workerPool","workerCheckFrequency","filterArgs","AbortSignal","callfunc","signalId","serializeAbortSignal","remoteAbort","File","objectFromEntries","functionName","getWorker","hardwareConcurrency","mainThread","canDetect","detectHardwareConcurrency","createWorkerPool","workers","getWorkerPool","workerNumber","workerAssignment","rpcMethod","getRpcMethodType","serializeArguments","filteredAndSerializedArgs","callP","killedP","killedCheckInterval","setInterval","finally","clearInterval","resultP","race","deserializeReturn","WebWorkerHandle","terminate","channel","listener","on","off","Rpc","Client","WebWorkerRpcDriver","workerBootConfiguration","WorkerClass","postMessage","DummyHandle","_functionName","_filteredArgs","execute","electronBetterIpc","wait","ms","WindowWorkerHandle","readyForConfig","callRenderer","filteredArgs","removeListener","DriverClasses","ElectronRpcDriver","bootConfig","workerCreationChannel","electronRemote","remote","workerId","sendSync","BrowserWindow","fromId","RpcManager","mainConfiguration","backendConfigurations","driverObjects","backendName","backendConfiguration","DriverClassImpl","newDriver","_sessionId","getDriver","getDriverForCall","rpcConfigSchema","JBrowseWeb","JBrowseModel","rpc","shareURL","featureDetails","sequenceTypes","disableAnalytics","connections","defaultSession","afterCreate","seen","addAssemblyConf","removeAssemblyConf","toRemove","addConnectionConf","deleteConnectionConf","deleteTrackConf","setDefaultSessionConf","newDefault","sessionConf","toJS","removeAttr","AboutDialog","sessionModelFactory","assemblyConfigSchemasType","minDrawerWidth","sessionModel","widgets","connectionInstances","sessionConnections","task","DialogComponent","DialogProps","getReferring","refs","walk","getMembers","isReferenceType","setName","makeConnection","connectionType","connectionData","removeReferring","referring","dereferenced","callbacks","dereferenceTypeCount","prepareToBreakConnection","callbacksToDereferenceTrack","breakConnection","deleteConnection","deletedConn","connectionId","updateDrawerWidth","newDrawerWidth","resizeDrawer","oldDrawerWidth","initialState","typeDefinition","hideWidget","addLinearGenomeViewOfAssembly","addViewOfAssembly","addViewFromAnotherView","otherView","hasWidget","minimizeWidgetDrawer","showWidgetDrawer","hideAllWidgets","clearConnections","addSavedSession","removeSavedSession","renameCurrentSession","activateSession","setDefaultSession","loadAutosaveSession","setSession","pushSnackbarMessage","editConfiguration","isConfigurationModel","editableConfigSession","editor","getTrackActionMenuItems","canEdit","isRefSeqTrack","SettingsIcon","DeleteIcon","trackSnapshot","CopyIcon","preProcessor","filterSessionInPlace","isArrayType","childType","getChildType","isValidReference","el","isMapType","getPropertyMembers","pname","ptype","RootModel","AssemblyConfigSchemasFactory","Session","assemblyManagerType","jbrowseWebFactory","configPath","pluginsUpdated","RenderWorker","savedSessionsVolatile","localStorageId","alert","sessionStorage","oldSession","setPluginsUpdated","newSession","newSnapshotName","newSnapshotCopyNumber","localId","newSessionSnapshot","previousAutosave","autosavedSession","history","lastAutosave","setHistory","setMenus","appendMenu","insertMenu","insertPosition","menuItem","topMenu","menuPath","pathSoFar","menuName","sm","mi","insertInSubMenu","SessionWarningDialog","ConfigWarningDialog","StartScreen","NoConfigMessage","link","queryString","checkPlugins","allowedPluginUrls","pluginsToCheck","SessionLoader","blankSession","sessionTriaged","shareWarningOpen","sessionSnapshot","runtimePlugins","sessionError","configError","bc1","bc2","setSessionQuery","setConfigError","setSessionError","setRuntimePlugins","setSessionPlugins","setConfigSnapshot","setBlankSession","setSessionTriaged","setSessionSnapshotSuccess","fetchPlugins","pluginLoader","fetchSessionPlugins","setSessionSnapshot","origin","fetchConfig","configUri","addRelativeUris","configPlugins","fetchSessionStorageSession","sessionStr","sessionSnap","msg","fetchSharedSession","readConf","readSessionFromDynamo","decryptedSession","fromUrlSafeB64","decodeEncodedUrlSession","decodeJsonUrlSession","localSession","encodedSession","sharedSession","jsonSession","Loader","initialTimestamp","loader","initialSessionQuery","Renderer","setPassword","setPluginManager","snapshotError","setSnapshotError","P","JBrowseRootModel","JBrowseRootModelFactory","packagedef","errorMessage","defaultJBrowseSession","writeAWSAnalytics","writeGAAnalytics","onConfirm","onCancel","factoryReset","PlatformSpecificFatalErrorDialog","FallbackComponent","HeadingComponent","ContentCopy","TrackSelector","menuItemEndDecoration","MenuItemEndDecoration","MenuPage","subMenuAnchorEl","setSubMenuAnchorEl","openSubMenuIdx","setOpenSubMenuIdx","isSubMenuOpen","setIsSubMenuOpen","selectedMenuItemIdx","setSelectedMenuItemIdx","setPosition","paperRef","timer","shouldSubMenuBeOpen","hasEndDecoration","hasIcon","menuItemStyle","ListContents","autoFocusItem","priority","endDecoration","activeElement","focus","currentIdx","findLastIndex","findPreviousValidIdx","findNextValidIdx","subLabel","in","transformOrigin","transitionDuration","BackdropProps","invisible","cigarToMismatches","ops","currOffset","seqOffset","q","mdToMismatches","mdstring","cigarMismatches","mismatchRecords","skips","lastCigar","lastTemplateOffset","lastRefOffset","lastSkipPos","nextRecord","getTemplateCoordLocal","refCoord","templateOffset","refOffset","md","token","substring","substr","qualScore","altbase","getTemplateCoord","getMismatches","cigarString","mdString","generateMD","queryOffset","targetOffset","lengthMD","tmp","cigarIdx","refPos","basemod","isViewContainer","isSessionModel","isViewModel","isTrackModel","isDisplayModel","isTrackViewModel","ExportSvgDlg","OffscreenCanvas","setRasterizeLayers","exportSvg","Divider","clearView","calculateVisibleLocStrings","isSingleAssemblyName","every","HEADER_BAR_HEIGHT","HEADER_OVERVIEW_HEIGHT","SCALE_BAR_HEIGHT","RESIZE_HANDLE_HEIGHT","MUIRegion","hideHeaderOverview","trackLabels","showCenterLine","draggingTrackId","afterDisplayedRegionsSetCallbacks","coarseDynamicBlocks","coarseTotalBp","leftOffset","rightOffset","assembliesInitialized","trackHeights","trackHeightsWithResizeHandles","scaleBarHeight","totalbp","displayedRegionsTotalPx","wholeRefSeqs","wholeSequence","alreadyExists","displayedParentRegions","offsetBp","interRegionPaddingBp","minimumBlockBp","bpSoFar","bp","oob","rewriteOnClicks","holdOnClick","apply","allActions","toggleHeader","toggleHeaderOverview","scrollTo","newOffsetPx","minOffset","maxOffset","newBpPerPx","minBpPerPx","maxBpPerPx","oldBpPerPx","setOffsets","setNewView","horizontallyFlip","moveTrack","movingTrackId","targetTrackId","oldIndex","newIndex","setTrackLabels","toggleCenterLine","navToLocString","optAssemblyName","locStrings","locations","ls","navToMultiple","defaultRefName","changedAssembly","newAssembly","newRegions","displayedRegion","navTo","firstLocation","refNameMatched","lastIndex","previousIndex","locationIndex","locationStart","locationEnd","startDisplayedRegion","endDisplayedRegion","zoomToDisplayedRegions","startOffset","endOffset","getSelectedRegions","simView","afterDisplayedRegionsSet","targetBpPerPx","extraBp","bpToStart","horizontalScroll","oldOffsetPx","centerAt","regionIndex","center","showAllRegions","showAllRegionsInAssembly","setDraggingTrackId","factor","cancelLastAnimation","slide","viewWidths","springAnimate","animate","cancelAnimation","zoom","currentlyCalculatedStaticBlocks","stringifiedCurrentlyCalculatedStaticBlocks","ReturnToImportFormDlg","SyncAltIcon","LabelIcon","trackTypeActions","sret","setCoarseDynamicBlocks","renderToSvg","typeModels","stringArray","stringArrayMap","numberMap","integer","fileLocation","fallbackDefaults","literalJSON","objectJSON","typeModelExtensions","removeAtIndex","setAtIndex","addToKey","ar","removeAtKeyIndex","setAtKeyIndex","JexlStringType","makeConfigurationSchemaModel","modelName","schemaDefinition","modelDefinition","implicitIdentifier","volatileConstants","isJBrowseConfigurationSchema","jbrowseSchema","slotName","slotDefinition","isLateType","isConfigurationSchemaType","configSlotModelName","slot","isCallback","newVal","reset","convertToCallback","valueJSON","convertToValue","funcResult","defineProperty","ConfigSlot","completeModel","setSubschema","newSchema","newSnap","isEmptyArray","identifierDefault","inputSchemaDefinition","inputOptions","jbrowseSchemaDefinition","jbrowseSchemaOptions","preprocessConfigurationSchemaArguments","schemaType","reference","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","namedColorToHex","isNamedColor","getLuminance","convertedColor","muiGetLuminance","coefficient","muiEmphasize","makeContrasting","foreground","minContrastRatio","convertedForeground","convertedBackground","backgroundLuminance","contrastRatio","getContrastRatio","originalColor","isOptionalType","getUnionSubTypes","unionType","isUnionType","propertyName","resolveLateType","maybeLate","intersection2","left1","right1","left2","right2","lastBlock","thisarg","BaseBlock","assign","otherBlock","elidedBlockCount","scroll","minSizeToBotherWith","segmentsIntersect","LayoutRow","allFilled","widthLimit","rowState","bits","getItemAt","rectWidth","initialize","oLeft","oRight","currLength","additionalLength","leftTrimAmount","rightTrimAmount","trimAmount","desiredLength","GranularRectLayout","pitchX","pitchY","hardRowLimit","bitmap","pTotalHeight","ObservableMap","storedRec","addRectToBitmap","pLeft","pRight","pHeight","rectangle","originalHeight","maxTop","isRangeClear","yEnd","autovivifyRow","setAllFilled","pY","pX","regionRectangles","PrecomputedLayout","_rect","_top","_data","_left","_right","update","sessions","createSession","freed","deserializeLayoutInClient","getWorkerSession","serialized","serializeRegion","getExpandedRegion","stitch","subfeats","filterId","dedupe","list","ary","revlist","seqlen","cdsColor","updownstreamColor","GeneCDS","cds","GeneProtein","protein","GenecDNA","utr","upstream","downstream","includeIntrons","collapseIntron","chunks","intron","SequencePanel","firstCds","lastCds","firstCdsIdx","exon","lastCdsIdx","lastCdsExon","firstCdsExon","fiveUTRs","threeUTRs","calculateUTRs","SequenceFeatureDetails","hasCDS","seqPanelRef","useInView","inView","setSequence","setMode","copied","setCopied","finished","fetchSeq","fontFamily","globalOmit","coreDetails","expansionPanelDetails","paperRoot","fieldDescription","wordBreak","fieldValue","fieldSubvalue","accordionBorder","BaseCard","TransitionProps","unmountOnExit","AccordionDetails","FieldName","prefix","BasicValue","SanitizedHTML","SimpleValue","ArrayValue","attributes","CoreDetails","strandMap","strandStr","displayStart","displayEnd","displayedDetails","BaseCoreDetails","DataGridDetails","unionKeys","colNames","disableSelectionOnClick","rowHeight","rowsPerPageOptions","hideFooterRowCount","hideFooterSelectedRowCount","hideFooter","Attributes","omit","formatter","omits","accessNested","BaseAttributes","FeatureDetails","depth","slug","shortName","BaseFeatureDetails","ServerSideRenderedContent","ssrContainerNode","jbrowseTheme","domNode","unmountComponentAtNode","rIC","hydrate","ThemeProvider","data-html-size","renderToString","deserializeArgsInWorker","updateStatus","serializeResultsInWorker","freedRpc","AbortError","code","makeAbortError","DOMException","fromEvent","exception","compilationCache","compiled","compile","full","escapeHTML","dompurify","sanitize","filterChain","inputFilter","deserializedFeatures","fromJSON","_renderArgs","ignoreElements","_size","oldCache","deleted","oldCacheSize","createFilterOptions","onSelect","TextFieldProps","coarseVisibleLocStrings","loaded","Autocomplete","disableListWrap","disableClearable","freeSolo","includeInputInList","clearOnBlur","selectOnFocus","groupBy","filterOptions","possibleOptions","filtered","inputValue","newOption","ListboxProps","newRegion","newRegionName","newRegionValue","renderInput","helperText","TextFieldInputProps","renderOption","noWrap","getOptionLabel","chooseGridPitch","minMajorPitchPx","minMinorPitchPx","minMajorPitchBp","majorMagnitude","toExponential","majorPitch","majorPitchPx","minorPitch","makeTicks","emitMajor","emitMinor","gridPitch","minBase","iterPitch","rubberBand","rubberBandControl","rubberBandText","popover","mouseEvents","guide","OverviewRubberBand","overview","ControlComponent","startX","setStartX","currentX","setCurrentX","guideX","setGuideX","controlsRef","rubberBandRef","globalMouseMove","relativeX","globalMouseUp","clickedAt","globalKeyDown","leftBpOffset","rightBpOffset","Popover","keepMounted","disableRestoreFocus","scaleBarColor","scaleBar","scaleBarContig","borderBottomColor","scaleBarContigForward","backgroundRepeat","scaleBarContigReverse","scaleBarRegionIncompleteLeft","backgroundSize","borderTopLeftRadius","borderBottomLeftRadius","scaleBarRegionIncompleteRight","borderTopRightRadius","borderBottomRightRadius","scaleBarRefName","lineHeight","scaleBarLabel","scaleBarVisibleRegion","overviewSvg","Polygon","totalWidthPxWithoutBorders","polygonColor","firstBlock","topLeft","topRight","endPx","ScaleBar","visibleRegions","overviewVisibleRegions","firstOverviewPx","lastOverviewPx","refNameColor","regionLength","tickLabels","offsetLabel","tickLabel","labelIdx","slider","log2","Slider","onChangeCommitted","headerForm","headerRefName","panButton","toggleButton","buttonSpacer","Controls","PanControls","RegionWidth","LinearGenomeViewHeader","setDisplayedRegion","controls","FormGroup","transition","transitions","duration","shortest","dragHandle","dragHandleIcon","verticalAlign","TrackLabel","draggable","onDragStart","parentNode","dataTransfer","setDragImage","onDragEnd","renderingComponentContainer","trackLabel","trackLabelInline","trackLabelOverlap","trackRenderingContainer","debouncedOnDragEnter","useDebouncedCallback","dimmed","onScroll","onDragEnter","onHorizontalScroll","VerticalGuide","coordX","RubberBand","setAnchorPosition","ZoomInIcon","zoomToRegion","getSequence","numOfBpSelected","scaleBarContainer","scaleBarZoomContainer","majorTickLabel","refLabel","RenderedRefNameLabels","lastLeftBlock","RenderedScaleBarLabels","baseNumber","offsetLeft","totalWidthPx","verticalGuidesZoomContainer","verticalGuidesContainer","majorTick","hint","minorTick","divider","RenderedVerticalGuides","centerLineContainer","centerLineText","startingPosition","tracksContainer","scheduled","cleanup","requestAnimationFrame","onWheel","origEvent","normalizeWheel","ctrlKey","pixelY","pixelX","dataset","resizer","button","importFormContainer","importFormEntry","ImportForm","selectedRegion","setSelectedRegion","setAssemblyRegions","hasError","handleSelectedRegion","Container","justify","onKeyPress","disableShrink","MiniControls","dialogContent","textAreaFont","fetchSequence","selectedRegions","regionsSelected","active","formatSequence","seqChunks","sequenceChunks","incompleteSeqErrs","chunkSeq","chunkRefName","chunkStart","chunkEnd","chunkLocstring","trimEnd","sequenceTooLarge","rowsMax","seqFastaFile","mathPower","num","Ruler","major","minor","data-bp","LinearGenomeView","hasDisplayedRegions","isSeqDialogDisplayed","displayBp","x0","SVGRuler","rulerHeight","renderRuler","SVGHeader","SVGRegionSeparators","strokeOpacity","SVGTracks","displayResults","shift","renderToStaticMarkup","xmlns","xmlnsXlink","confObject","slotPath","appliedFunc","newPath","subConf","getTypeNamesFromExplicitlyTypedUnion","maybeUnionType","isConfigurationSlotType","displayedRegionLeftPx","windowLeftPx","windowRightPx","displayedRegionRightPx","blockOffsetPx","FileLocationEditor","fileOrUrl","fileOrUrlState","setFileOrUrlState","shrink","htmlFor","exclusive","newValue","UrlChooser","LocalFileChooser","setLocation","needToReload","opacity","files","weHave","PonyfillOffscreenContext","nx","nw","currentFont","splitColor","hex","currentPath","nodes","fontStyle","fontVariant","elements","outer","parts","parseFont","currentFill","currentStroke","ny","nh","rotation","require","nodeCreateCanvas","dataUri","contentBlock","elidedBlock","interRegionPaddingBlock","boundaryPaddingBlock","fr","F1R2","F2R1","F1F2","F2F1","R1R2","R2R1","R1F2","R2F1","rf","ff","SyntaxHighlighter","callbackEditor","syntaxHighlighter","setContents","debouncedJson","useDebounce","onValueChange","highlight","newCode","language","customStyle","VCFFeature","parser","_id","dataFromVariant","SAMPLES","REF","ALT","POS","CHROM","ID","_getSOTermAndDescription","SO_term","isTRA","soTerms","_getSOAndDescFromAltDefs","soTerm","_getSOAndDescByExamination","prefixes","desc","new_descs","suffixes","_altTypeToSO","metaDescription","_makeDescriptionString","modAlt","samples","DEL","INS","DUP","INV","INVDUP","CNV","TRA","NON_REF","shim","process","inProduction","TextEncoder","encode","deflated","deflate","encoded","fromByteArray","b64","originalB64","repeat","b64PadSuffix","toByteArray","inflated","inflate","TextDecoder","decode","debouncedValue","setDebouncedValue","argsRef","findParentThat","hasParent","fromValue","toValue","animationFrameId","onFinish","precision","tension","friction","mass","time","lastPosition","lastTime","velocity","lastVelocity","numSteps","isVelocity","isDisplacement","cancelAnimationFrame","findParentThatIs","startString","endString","assemblyNameString","parseLocStringOneBased","assemblyMatch","lastColonIdx","rangeMatch","singleMatch","separator","locA","locB","assemblyComp","refComp","startComp","endComp","compareLocStrings","roundToNearestPointOne","oneEightyOverPi","piOverOneEighty","radToDeg","radians","degToRad","degrees","rho","theta","cos","sin","cartesianToPolar","atan","iterable","sizeHint","counter","B","merged","dataFunction","asyncReactionFunction","reactionOptions","startedFunction","successFunction","errorFunction","inProgress","handleError","reactionDisposer","mobxReactionHandle","thisInProgress","renameRegionIfNeeded","newRef","originalRefName","newArgs","seqString","complementRegex","complementTable","S","N","K","Y","V","M","g","W","X","H","D","R","FileReader","readAsDataURL","requestIdleCallback","widths","avg","TCA","TCC","TCG","TCT","TTC","TTT","TTA","TTG","TAC","TAT","TAA","TAG","TGC","TGT","TGA","TGG","CTA","CTC","CTG","CTT","CCA","CCC","CCG","CCT","CAC","CAT","CAA","CAG","CGA","CGC","CGG","CGT","ATA","ATC","ATT","ATG","ACA","ACC","ACG","ACT","AAC","AAT","AAA","AAG","AGC","AGT","AGA","AGG","GTA","GTC","GTG","GTT","GCA","GCC","GCG","GCT","GAC","GAT","GAA","GAG","GGA","GGC","GGG","GGT","table","tempCodonTable","aa","nucs","nuc","n0","n1","n2","statusMsg","fn","hash","findCircleIntersectionX","resultArray","solution","findCircleIntersectionY","cartesianToTheta","twoPi","Slice","currentRadianOffset","radianWidth","offsetRadians","bpPerRadian","flipped","widthBp","totalRadians","elided","sliceIsVisible","r1start","r1length","r2start","r2length","visibleSection","visibleThetaMin","visibleThetaMax","CircularView","lockedFitToWindow","minimumRadiusPx","spacingPx","paddingPx","lockedPaddingPx","minVisibleWidth","scrollX","scrollY","slices","elidedRegions","pxPerRadian","calculateStaticSlices","staticSlices","viewSides","circleCenter","circleRadius","viewL","viewR","viewT","viewB","vertices","maxRho","reflect","rhoMin","rhoMax","thetaMin","thetaMax","vx","vy","viewportVisibleSection","centerXY","elidedBp","circumferencePx","minCircumferencePx","maxCircumferencePx","maximumRadiusPx","figureDimensions","visible","lastVisible","setModelViewWhenAdjust","tooSmallToLock","rotateClockwiseButton","rotateClockwise","rotateCounterClockwiseButton","rotateCounterClockwise","secondCondition","previouslyEmpty","toggleFitToWindowLock","atMinBpPerPx","strokeDasharray","strokeDashoffset","patternTransform","patternUnits","strokeLinecap","errorBackground","errorText","mainThreadRendering","Loading","ChordDisplayLoadingFactory","DisplayError","ChordDisplayErrorFactory","RpcRenderedSvgGroup","RpcRenderedSvgGroupF","renderReactionData","renderReactionEffect","BaseChordDisplayModel","bezierRadiusRatio","origSlices","renamed","ThisRendererType","isCompatibleWithRenderer","renderStarted","renderSuccess","renderError","setRefNameMap","renderReactionFactory","baseChordDisplayConfig","CircularViewPlugin","DataUsageIcon","setTarget","makeFeatures","SVTYPE","fdata","makeFeature","bucket","FromConfigRegionsAdapter","currentRegion","FromSequenceConfigAdapter","superGetFeatures","featureClass","regionsConfigSchema","sequenceConfigSchema","RefNameAliasAdapter","promise","downloadResults","ConfigurationEditorComponent","fromConfigAdapterConfigSchema","FromConfigAdapterClass","fromConfigRegionsAdapterConfigSchema","FromConfigRegionsAdapterClass","fromConfigSequenceAdapterConfigSchema","FromConfigSequenceAdapterClass","refNameAliasAdapterConfigSchema","RefNameAliasAdapterClass","ConfigurationEditorHeadingComponent","ConfigurationEditorConfigSchema","ConfigurationEditorStateModelFactory","getter","whenPromise","mobxWhen","finishTimeout","cancel","whenPresent","Jexl","addFunction","char","codePointAt","searchStr","targetLength","padString","padEnd","fillString","padStart","newSubStr","replaceAll","trimStart","addBinaryOp","calcStdFromSums","sum","sumSquares","variance","population","featureDensity","seed"],"mappings":"sHAAA,uDAkBe,SAASA,EACtBC,GAUA,IATAC,IASA,yDARAC,IAQA,yDAPAC,EAOA,uDAPQ,EAMRC,EACA,uDAD2B,qBAAXC,QAA0BA,OAAOC,YAAeN,EAAMI,MAGpEG,EAKEP,EALFO,SACAC,EAIER,EAJFQ,iBACAC,EAGET,EAHFS,QACAC,EAEEV,EAFFU,kBACAC,EACEX,EADFW,wBAGIC,EAAeL,EAAWE,EAC1BI,GAAiBN,EAAWH,GAASK,EACrCK,EAAcV,EACdW,EAAcC,KAAKC,KAAKH,EAAcL,GAExCS,EAAiB,EACfC,EAAS,IAAIC,IAqHnB,OApHAZ,EAAiBa,SAAQ,SAACC,EAAQC,GAAiB,IAI/CC,EAKEF,EALFE,aACAC,EAIEH,EAJFG,QACOC,EAGLJ,EAHFK,MACKC,EAEHN,EAFFO,IACAC,EACER,EADFQ,SAEIC,EAAmBf,KAAKC,MAAMW,EAAYF,GAAeX,GAE3DiB,EACFhB,KAAKiB,OAAOpB,EAAgBK,GAAkBH,GAAeZ,EAC3D6B,GAAuBD,IACzBC,EAAsBD,EAAmB,GAG3C,IAAIG,EACFlB,KAAKiB,OAAOrB,EAAeM,GAAkBH,GAAeZ,EAC1D+B,EAAqB,IACvBA,EAAqB,GAKvB,IAFA,IAAMC,GAAiBP,EAAYF,GAAejB,EAG5C2B,EAAWF,EACfE,GAAYJ,EACZI,GAAY,EACZ,CACA,IAAIT,OAAa,EACbE,OAAW,EACXQ,OAAmC,EACnCC,OAAoC,EACpCR,GACFH,EAAQX,KAAKuB,IAAIb,EAAaE,GAAaQ,EAAW,GAAKrB,GAE3DsB,GADAR,EAAMD,EAAYQ,EAAWrB,KACQa,EACrCU,EAA8BX,IAAUD,IAIxCW,GAFAV,EAAQD,EAAcU,EAAWrB,KAEMW,EACvCY,GAFAT,EAAMb,KAAKwB,IAAIZ,EAAWF,GAAeU,EAAW,GAAKrB,MAEnBa,GAExC,IACMa,EAAY,CAChBjB,eACAC,UACAE,QACAE,MACAC,WACAvB,UAAWW,EAAiBkB,EAAWrB,GAAeN,EACtDiC,aAAcpB,EACdC,eACAoB,SAVed,EAAMF,GAASlB,EAW9B4B,6BACAC,8BACAM,IAAK,IAEPH,EAAUG,IAAV,UAAmBC,4BAAkBJ,GAArC,YAAmDlB,GAAnD,OACEO,EAAW,YAAc,IAGvB7B,GAA4B,IAAjBsB,GAAmC,IAAba,GACnCjB,EAAO2B,KACL,IAAIC,IAAwB,CAC1BH,IAAK,GAAF,OAAKH,EAAUG,IAAf,sBACHD,QAASvC,EACTG,SAAUkC,EAAUlC,SAAWH,EAC/B4C,QAAS,cAKX9C,GAAWiC,EAAgBzB,EAC7BS,EAAO2B,KAAK,IAAIG,IAAYR,IAE5BtB,EAAO2B,KAAK,IAAII,IAAaT,IAG3BxC,IAGAkC,GAAiBzB,GACjB+B,EAAUH,6BACVf,EAAef,EAAiB2C,OAAS,IAEzCjC,GAAkBP,EAA0BF,EAC5CU,EAAO2B,KACL,IAAIC,IAAwB,CAC1BH,IAAK,GAAF,OAAKH,EAAUG,IAAf,aACHD,QAAShC,EACTJ,SAAUkC,EAAUlC,SAAWkC,EAAUE,YAK7CpB,IAAiBf,EAAiB2C,OAAS,GAC3CV,EAAUH,8BAEVpB,GAAkBP,EAA0BF,EAC5CU,EAAO2B,KACL,IAAIC,IAAwB,CAC1BH,IAAK,GAAF,OAAKH,EAAUG,IAAf,oBACHD,QAASvC,EACTG,SAAUkC,EAAUlC,SAAWkC,EAAUE,QACzCK,QAAS,gBAMnB9B,GAAkBU,EAAYF,KAEzBP,I,gGC/JYiC,E,mIAAkCC,I,yGCClCC,E,WAYnB,WACEC,GAEA,IADAC,EACA,uDADkC,GAClC,yBAdFC,WAA4C,IAAIC,IAc9C,KAZFH,oBAYE,OAVFI,yBAAgD,GAW9CC,KAAKH,WAAa,IAAIC,IACtBE,KAAKL,eAAiBA,EACtBK,KAAKD,yBAA2BH,E,gDAGlC,SAAaK,GACX,IAAIC,EAAYF,KAAKH,WAAWM,IAAIF,GACpC,YAAkBG,IAAdF,GACFA,EAAY,IAAIF,KAAKL,eAAeK,KAAKD,0BACzCC,KAAKH,WAAWQ,IAAIJ,EAAYC,GACzBA,GAGFA,I,qBAGT,SACED,EACAK,EACAC,EACAC,EACAC,GAEA,IADAC,EACA,uDAD0B,GAE1B,OAAOV,KAAKW,aAAaV,GAAYW,QAAQN,EAAIC,EAAMC,EAAOC,EAAQC,K,0BAGxE,SAAaT,EAAoBM,EAAcC,GAC7C,IAAMK,EAASb,KAAKH,WAAWM,IAAIF,GACnC,OAAOY,GAAUA,EAAOC,aAAaP,EAAMC,K,oBAG7C,WACE,IADO,EACDE,EAAyC,GADxC,cAE+BV,KAAKH,WAAWkB,WAF/C,IAEP,2BAAiE,8BAArDd,EAAqD,KAAzCe,EAAyC,KAC/DN,EAAKT,GAAce,EAAUC,UAHxB,8BAKP,OAAOP,M,oIC/CHQ,GAA+B,qBAAXzE,OAAyBA,OAAU,IAAvDyE,SAKaC,E,WAOnB,WAAYC,GACV,IAAIC,EAIJ,GAL4B,yBANtBC,cAMsB,OAJtBC,QAIsB,OAFtBF,iBAEsB,EAExBH,IACFG,EAAcH,EAASG,cAEpBA,EACH,MAAM,IAAIG,MACR,kEAGJxB,KAAKqB,YAAcA,EACnBrB,KAAKsB,SAAWF,E,gFAGlB,iFACOpB,KAAKsB,SADZ,sBAEU,IAAIE,MAAM,0BAFpB,cAIOxB,KAAKuB,KACRvB,KAAKuB,GAAKvB,KAAKqB,YAAYI,OAAO,OAAQzB,KAAKsB,SAAU,MAL7D,kBASStB,KAAKuB,IATd,gD,+GAYA,WACEG,GADF,qCAAAC,EAAA,6DAEEC,EAFF,+BAEW,EACTrC,EAHF,uBAIEsC,EAJF,+BAIa,EAELC,EAAc1E,KAAKwB,IAAI8C,EAAOnC,OAASqC,EAAQrC,GANvD,SAOmBS,KAAK+B,QAPxB,cAOQR,EAPR,gBAQqBvB,KAAKqB,YAAYI,OAClC,OACAF,EACAG,EACAE,EACAE,EACAD,GAdJ,cAQQG,EARR,QAkBMN,OAASO,EAAOC,KAAKF,EAAIN,QAE7BM,EAAIN,OAAOS,KAAKT,GApBlB,kBAqBSM,GArBT,iD,oHAwBA,wCAAAL,EAAA,wFAAsC,GAC/B3B,KAAKsB,SADZ,sBAEU,IAAIE,MAAM,0BAFpB,uBAKuBxB,KAAKqB,YAAYI,OAAO,WAAYzB,KAAKsB,UALhE,cAKQc,EALR,8BAO+BhC,IAAtBgC,EAAOC,WAA2BJ,EAAOC,KAAKE,GAAUA,GAPjE,gD,+GAWA,sBAAAT,EAAA,kEACS3B,KAAKqB,YADd,SAC+CrB,KAAK+B,QADpD,iDAC0BN,OAD1B,UACiC,OADjC,uD,+MCzBEa,OAAOC,S,IAvDUC,E,WAGnB,WAAYC,GAAsB,yBAF1BA,aAE0B,EAChCzC,KAAKyC,QAAUA,E,uCAGjB,SAAInC,GAAO,oBACYN,KAAKyC,QAAQC,UADzB,IACT,2BAA4C,CAC1C,GAD0C,QAC/BC,IAAIrC,GACb,OAAO,GAHF,8BAMT,OAAO,I,iBAGT,SAAIA,GAAO,oBACYN,KAAKyC,QAAQC,UADzB,IACT,2BAA4C,KAAjCE,EAAiC,QAC1C,GAAIA,EAAOD,IAAIrC,GACb,OAAOsC,EAAOzC,IAAIG,IAHb,iC,8BASX,sGACoBN,KAAK6C,QADzB,wDAEI,OADS7D,EADb,iBAEUgB,KAAKG,IAAInB,GAFnB,qM,4BAMA,oGACQ6D,EAAO,IAAIC,IADnB,cAEuB9C,KAAKyC,QAAQC,UAFpC,IAEE,2BAA4C,CAAjCE,EAAiC,sBACxBA,EAAOC,QADiB,IAC1C,2BAAW7D,EAAsB,QAC/B6D,EAAKE,IAAI/D,GAF+B,gCAF9C,4CAOoB6D,GAPpB,yDAQI,OADS7D,EAPb,kBAQUA,EARV,uM,kBAYA,SAAQgE,GAAmB,oBACJhD,KAAKyC,QAAQC,UADT,IACzB,2BAA4C,OAAjCE,EAAiC,sBACtBA,EAAOF,UADe,IAC1C,2BAAqC,KAA1BO,EAA0B,QAEnC,GADcD,EAAEC,GAEd,OAAOA,GAJ+B,gCADnB,iC,uBAY3B,sGACoBjD,KAAK6C,QADzB,wDAEI,OADS7D,EADb,iBAEU,CAACA,EAAKgB,KAAKG,IAAInB,IAFzB,qM,+BAMA,sGACkBgB,KAAK6C,QADvB,wDAEI,OADSK,EADb,iBAEU,CAACA,EAAGlD,KAAKG,IAAI+C,IAFvB,uM,iSC3CmBC,E,kDASnB,WAAmBC,GAAuC,kCACxD,cAAMA,IATAC,YAQkD,EAExD,EAAKA,OAAS,IAAIC,SAAO,CACvBC,WAAYC,uBAAaC,yBAAeL,EAAQ,qBAHM,E,gFAO1D,WAAoBM,GAApB,qFACwCA,GAAQ,IAAtCC,uBADV,MAC2B,aAD3B,GAEiB,6BAFjB,SAGuB3D,KAAKqD,OAAOO,UAAUF,GAH7C,cAGQtB,EAHR,OAIEuB,EAAe,IAJjB,kBAKSvB,GALT,gD,uHAQA,WAAyBsB,GAAzB,uFACuB1D,KAAK6D,MAAMH,GADlC,cACQI,EADR,yBAESC,OAAOlB,KAAKiB,EAAOE,aAF5B,gD,uHAKA,WAAyBC,GAAzB,uFACkBjE,KAAK6D,QADvB,cACQK,EADR,0BAEUA,EAAEC,aAAaF,IAAU,CAAEG,UAAMhE,IAAagE,MAFxD,gD,0HAKA,WAA4BV,GAA5B,uFACuB1D,KAAK6D,MAAMH,GADlC,cACQI,EADR,yBAESO,YAAaP,EAAOQ,eAF7B,gD,gFAKA,SAAmB5G,GAAoD,WAA1BgG,EAA0B,uDAAJ,GACzD7F,EAAwBH,EAAxBG,QAASE,EAAeL,EAAfK,MAAOE,EAAQP,EAARO,IAD6C,EAOjEyF,EAJF7G,eAHmE,MAGzD,EAHyD,EAInE0H,EAGEb,EAHFa,OAJmE,EAOjEb,EAFFc,kBALmE,MAKtD,EALsD,IAOjEd,EADFC,sBANmE,MAMlD,aANkD,EAQrE,OAAOc,2BAAgB,uCAAU,WAAMC,GAAN,SAAA/C,EAAA,6DAC/BgC,EAAe,2BADgB,SAEd,EAAKN,OAAOsB,iBAAiB9G,EAASE,EAAOE,EAA7C,2BACZyF,GADY,IAEfkB,aAAc/H,EAAU2H,KAJK,cAM5BK,KACDC,cACAC,aAAI,SAACC,GACH,OAAO,IAAIC,IAAc,CACvB3E,GAAI,GAAF,OAAKzC,EAAL,YAAgBmH,EAAOjH,MAAvB,YAAgCiH,EAAO/G,KACzCyC,KAAM,2BAAKsE,GAAP,IAAenH,kBAGvBqH,UAAUR,GAdmB,2CAAV,sDAepBH,K,2BAGL,gB,GAjEyCY,0BAAtBhC,EAGLiC,aAAe,CAC3B,gBACA,gBACA,kBA6DJ,IAAMC,EAAsBlC,EAAciC,c,2fClF7BE,EAAYC,QAAMC,SAASD,QAAME,WAAYC,IAAQC,UAGrDC,EAAY,CACvBC,OAAQC,IAAUC,MAAM,CACtBlI,QAASiI,IAAUE,OAAOC,WAC1BlI,MAAO+H,IAAUI,OAAOD,WACxBhI,IAAK6H,IAAUI,OAAOD,aAExBE,aAAcC,YAAYC,yBAC1BC,QAASR,IAAUC,MAAM,CACvB5F,IAAK2F,IAAUS,KAAKN,WACpB3F,GAAIwF,IAAUS,KAAKN,cAIVO,EAAmBjB,QAC7BnJ,MAAM,mBAAoB,CACzByB,QAAS0H,QAAMS,OACfjI,MAAOwH,QAAMW,OACbjI,IAAKsH,QAAMW,OACXhI,SAAUqH,QAAMC,SAASD,QAAMkB,SAAS,KAEzCC,SAAQ,SAAAC,GAAI,MAAK,CAChBC,WADgB,SACLC,GACTF,EAAK9I,QAAUgJ,OAIRhB,EAASN,QAAMuB,QAC1B,SACAN,EACAjB,QAAMnJ,MAAM,CACVwB,aAAc2H,QAAMS,UAIXe,EAAoBxB,QAAMnJ,MAAM,oBAAqB,CAChE4K,UAAWzB,QAAMS,SAGNiB,EAAe1B,QAAMnJ,MAAM,eAAgB,CACtDgI,KAAMmB,QAAMS,OACZkB,OAAQ3B,QAAMS,SAGHmB,EAAiB5B,QAAMnJ,MAAM,cAAe,CACvDgL,IAAK7B,QAAMS,OACXqB,QAAS9B,QAAM+B,MAAM/B,QAAMS,UAGhBuB,EAAchC,QAAMiC,kBAAkBL,EAAgB,CACjEM,cAAe,SAAAC,GAAQ,IACbL,EAAqBK,EAArBL,QAAYM,EADC,YACQD,EADR,aAErB,OAAKL,EAGEK,EAFEC,KAMAC,EAAerC,QAAMsC,MAChCd,EACAQ,EACAN,I,iCCrEF,opBAQO,SAASa,EACdC,GAEA,IAAMC,EAAYD,EAAME,cAClBC,EAAqBzE,yBAAeuE,EAAW,iBACrD,IAAKE,EAAoB,CAGvB,IAAMC,EAASC,oBAAeL,EAAME,eACpC,GAAI,aAAcE,EAChB,MAAO,CAAC1E,yBAAe0E,EAAQ,SAGnC,OAAOD,EAKF,SAASG,EAAgBC,GAK9B,IADA,IAAIC,EACKC,EAAOF,GAAWG,iBAAOD,GAAOA,EAAOJ,oBAAUI,GACpD,iBAAkBA,IACpBD,EAAuBC,EAA8BE,cAGzD,IAAKH,EACH,MAAM,IAAI/G,MACR,4FAGJ,OAAO+G,EASF,SAASI,EAAqBH,GACnC,IACE,IAAII,EAAcR,oBAAUI,IAC3BC,iBAAOG,GACRA,EAAcR,oBAAUQ,GAExB,GAAI,gBAAiBA,EACnB,OAAOA,EAAYC,YAIvB,MAAO,GAGF,IAAMC,EAAU,UACVC,EAAc,cAEvBC,EAAmC,GAGhC,SAASC,EAAQ3I,GACtB,OAAO0I,EAAQ1I,GAIV,SAAS4I,IACd,OAAOF,EAIF,SAASG,EAAWpE,GACzBiE,EAAUjE,EAIL,SAASqE,EAAkBC,GAChC,GAAIA,GAAY,SAAUA,EAAU,CAIlC,IAAMnC,EAAS,IAAH,QAAQoC,KAAKC,OAEzB,OADAP,EAAQ9B,GAAUmC,EAASG,KACpB,CAAEpF,KAAI,OAAEiF,QAAF,IAAEA,OAAF,EAAEA,EAAUG,KAAKpF,KAAM8C,UAEtC,OAAOmC,EAGF,SAASI,EACdC,EACAC,EACAC,EACAC,GAEA,SAASC,EAAUT,EAAwBU,GACzC,MAAI,QAASV,EACJ,CAAEjC,IAAKiC,EAASjC,IAAM2C,GAE3B,cAAeV,EACV,CAAErC,UAAWqC,EAASrC,UAAY+C,GAEpCV,EAGT,IAAMW,EAAWJ,EAAYF,GACvBO,EAAYN,GAASC,EAAYD,GACvC,SAASO,EACP9F,EACA+F,EACAC,GAEA,OAAW,OAAJhG,QAAI,IAAJA,OAAA,EAAAA,EAAMiG,cAAcC,SAASH,IAASA,EAAQC,EAGvD,MAAI,UAAUG,KAAKP,IAA6B,eAAhBH,EACvB,CACLW,KAAM,aACNC,YAAaf,EACbC,MAAO,CACLN,SAAUM,GAASG,EAAUJ,EAAM,QACnCgB,UAAWR,EAAcD,EAAW,MAAO,SAK7C,WAAWM,KAAKP,IAA6B,gBAAhBH,EACxB,CACLW,KAAM,cACNG,aAAcjB,EACdkB,aAAcjB,GAASG,EAAUJ,EAAM,UAIvC,YAAYa,KAAKP,GACZ,CACLQ,KAAM,eAIN,kBAAkBD,KAAKP,IAA6B,qBAAhBH,EAC/B,CACLW,KAAM,mBACNK,cAAenB,EACfC,MAAO,CACLN,SAAUM,GAASG,EAAUJ,EAAM,QACnCgB,UAAWR,EAAcD,EAAW,MAAO,SAK7C,WAAWM,KAAKP,IAMhB,UAAUO,KAAKP,GALV,CACLQ,KAAM,eAUN,gBAAgBD,KAAKP,IAA6B,oBAAhBH,EAC7B,CACLW,KAAM,kBACNM,cAAepB,EACfC,MAAO,CACLN,SAAUM,GAASG,EAAUJ,EAAM,OACnCgB,UAAWR,EAAcD,EAAW,MAAO,SAK7C,eAAeM,KAAKP,IAMpB,UAAUO,KAAKP,GALV,CACLQ,KAAM,eAUN,gBAAgBD,KAAKP,IAA6B,oBAAhBH,EAC7B,CACLW,KAAM,kBACNO,cAAerB,EACfC,MAAO,CACLN,SAAUM,GAASG,EAAUJ,EAAM,QACnCgB,UAAWR,EAAcD,EAAW,MAAO,SAK7C,kBAAkBM,KAAKP,IAA6B,kBAAhBH,EAC/B,CACLW,KAAM,gBACNQ,eAAgBtB,GAIhB,kBAAkBa,KAAKP,IAA6B,kBAAhBH,EAC/B,CACLW,KAAM,gBACNS,eAAgBvB,GAKlB,6BAA6Ba,KAAKP,IAClB,wBAAhBH,EAEO,CACLW,KAAM,sBACNU,cAAexB,EACfyB,YAAaxB,GAASG,EAAUJ,EAAM,SAKxC,mCAAmCa,KAAKP,IACxB,sBAAhBH,EAEO,CACLW,KAAM,oBACNU,cAAexB,EACfyB,YAAarB,EAAUJ,EAAM,QAC7B0B,YAAatB,EAAUJ,EAAM,SAI7B,WAAWa,KAAKP,IAA6B,kBAAhBH,EACxB,CACLW,KAAM,gBACNa,eAAgB3B,GAIhB,YAAYa,KAAKP,GACZ,CACLQ,KAAM,eAKR,uBAAuBD,KAAKP,IACZ,kBAAhBH,EAEO,CACLW,KAAM,gBACNc,gBAAiB5B,GAIjB,aAAaa,KAAKP,IAA6B,kBAAhBH,EAC1B,CACLW,KAAM,gBACNe,SAAU7B,GAIV,SAASa,KAAKP,IAA6B,eAAhBH,EACtB,CACLW,KAAM,aACNgB,YAAa9B,GAIb,SAASa,KAAKP,IAA6B,eAAhBH,EACtB,CACLW,KAAM,aACNiB,YAAa/B,GAIV,CACLc,KAAM1B,GAIH,SAAS4C,EAAeC,GAY7B,MAXqD,CACnDC,WAAY,kBACZC,YAAa,kBACbC,kBAAmB,yBACnB3I,cAAe,oBACf4I,oBAAqB,yBACrBC,cAAe,yBACfC,gBAAiB,eACjBC,WAAY,WACZC,WAAY,gBAEDR,IAAgB,eAGxB,SAASS,EACdC,EACAC,EACAC,GAEA,IAAMC,EAAO,CACXhC,KAAM,eACNpG,KAAM,GAAF,OAAKiI,EAAL,kBACJI,YAAa,oCAAF,OAAsCH,EAAtC,KACXI,SAAUH,EACVI,QAAS,IAGX,OADAH,EAAKG,QAAUC,qBAAWJ,GACnBA,EAGF,SAASK,EACdR,EACAC,EACAC,GAEA,IAAMC,EAAO,CACXhC,KAAM,eACNpG,KAAM,GAAF,OAAKiI,EAAL,cACJI,YAAa,uCAAF,OAAyCH,EAAzC,KACXI,SAAUH,EACVI,QAAS,IAGX,OADAH,EAAKG,QAAUC,qBAAWJ,GACnBA,I,q6BC1UHM,EAAWC,cA4CJC,EAAwB,CAEnCC,QAAS,CAAEC,KAPI,WAQfC,UAAW,CAAED,KAPD,WAQZE,SAAUN,EAASO,QAAQC,aAAa,CAAEJ,KAP7B,YAQbK,WAAYT,EAASO,QAAQC,aAAa,CAAEJ,KAP7B,YAQfM,UAAW,OACXC,WAAY,OACZC,MAAO,CACLC,EAAGb,EAASO,QAAQC,aAAaM,KACjCC,EAAGf,EAASO,QAAQC,aAAaQ,KACjCC,EAAGjB,EAASO,QAAQC,aAAaU,KACjCC,EAAGnB,EAASO,QAAQC,aAAaY,OAI9B,SAASC,IACd,MAAO,CACLC,UAAW,CACTC,KAAM,SAERC,eAAgB,CACdC,OAAQ,SAEVC,eAAgB,CACdD,OAAQ,SAEVE,kBAAmB,CACjBF,OAAQ,SAEVG,cAAe,CACbL,KAAM,SAERM,aAAc,CACZJ,OAAQ,SAEVK,QAAS,CACPC,OAAO,GAETC,YAAa,CACXD,OAAO,GAETE,iBAAkB,CAChBR,OAAQ,SAEVS,OAAQ,CACNX,KAAM,SAERY,SAAU,CACRZ,KAAM,SAERa,aAAc,CACZX,OAAQ,QACRF,KAAM,SAERc,WAAY,CACV/P,QAAS,SAEXgQ,WAAY,CACVC,SAAU,SAEZC,qBAAsB,CACpBjB,KAAM,SAERkB,YAAa,CACXlB,KAAM,SAERmB,QAAS,CACPC,UAAW,WAKV,SAASC,IAA4D,IAA9BrC,EAA8B,uDAAJ,GAChEsC,EAAmBC,IAAU5C,EAAuBK,GAC1D,MAAO,CACLqB,cAAe,CACbmB,eAAgB,CACdC,MAAOH,EAAiBvC,SAASF,OAGrCkB,UAAW,CACT2B,cAAe,CACbD,MAAOH,EAAiBvC,SAASF,OAGrC8B,OAAQ,CACN7B,UAAW,CACT6C,gBAAiBL,EAAiBpC,WAAWL,OAGjDsC,QAAS,CACPS,KAAM,CACJH,MAAOH,EAAiBvC,SAASF,OAGrCgD,oBAAqB,CACnBD,KAAM,CACJE,WAAYR,EAAiBvC,SAASF,KACtC,aAAc,CAEZkD,UAAW,EACX7B,OAAQ,EACRuB,MAAOH,EAAiBvC,SAASiD,cAEnC9B,OAAQ,EACR6B,UAAW,EACX/T,QAAS,YAEXiU,QAAS,CACP,aAAc,CACZ/B,OAAQ,WAEVA,OAAQ,UACRuB,MAAOH,EAAiBvC,SAASiD,cAEnCE,SAAU,IAKZC,YAAa,CACXP,KAAM,CACJQ,WAAY,EACZC,cAAe,IAKnBC,gBAAiB,CACfV,KAAM,CACJW,SAAU,KAGdC,gBAAiB,CACfC,MAAO,CACLC,YAAa,MAMd,IAAMC,EAAiC,CAC5C3D,QAASL,EACTiE,WAAY,CAAE5B,SAAU,IACxB6B,QAAS,EACTC,MAjIO,CACL/C,UAAW,CACTC,KAAM,SAERC,eAAgB,CACdC,OAAQ,SAEVC,eAAgB,CACdD,OAAQ,SAEVE,kBAAmB,CACjBF,OAAQ,SAEVG,cAAe,CACbL,KAAM,SAERM,aAAc,CACZJ,OAAQ,SAEVK,QAAS,CACPC,OAAO,GAETC,YAAa,CACXD,OAAO,GAETE,iBAAkB,CAChBR,OAAQ,SAEVS,OAAQ,CACNX,KAAM,SAERY,SAAU,CACRZ,KAAM,SAERa,aAAc,CACZX,OAAQ,QACRF,KAAM,SAERc,WAAY,CACV/P,QAAS,SAEXgQ,WAAY,CACVC,SAAU,SAEZC,qBAAsB,CACpBjB,KAAM,SAERkB,YAAa,CACXlB,KAAM,SAERmB,QAAS,CACPC,UAAW,WA+Ef2B,UAAW1B,KAGN,SAAS2B,EAAmBC,GAAsB,QACvD,OAAKA,IAGL,UAAIA,EAAMjE,eAAV,aAAI,EAAeD,YACjBkE,EAAQ,2BACHA,GADA,IAEHjE,QAAS,2BACJiE,EAAMjE,SADJ,IAELD,SAAUN,EAASO,QAAQC,aAAagE,EAAMjE,QAAQD,gBAI5D,UAAIkE,EAAMjE,eAAV,aAAI,EAAeE,cACjB+D,EAAQ,2BACHA,GADA,IAEHjE,QAAS,2BACJiE,EAAMjE,SADJ,IAELE,WAAYT,EAASO,QAAQC,aAAagE,EAAMjE,QAAQE,iBAI9D+D,EAAQ,2BACHA,GADA,IAEHH,MAAOvB,IA7JF,CACLxB,UAAW,CACTC,KAAM,SAERC,eAAgB,CACdC,OAAQ,SAEVC,eAAgB,CACdD,OAAQ,SAEVE,kBAAmB,CACjBF,OAAQ,SAEVG,cAAe,CACbL,KAAM,SAERM,aAAc,CACZJ,OAAQ,SAEVK,QAAS,CACPC,OAAO,GAETC,YAAa,CACXD,OAAO,GAETE,iBAAkB,CAChBR,OAAQ,SAEVS,OAAQ,CACNX,KAAM,SAERY,SAAU,CACRZ,KAAM,SAERa,aAAc,CACZX,OAAQ,QACRF,KAAM,SAERc,WAAY,CACV/P,QAAS,SAEXgQ,WAAY,CACVC,SAAU,SAEZC,qBAAsB,CACpBjB,KAAM,SAERkB,YAAa,CACXlB,KAAM,SAERmB,QAAS,CACPC,UAAW,WA0GiC6B,EAAMH,OAAS,IAC7DC,UAAWxB,IACTF,EAA8B4B,EAAMjE,SACpCiE,EAAMF,WAAa,MAGhBrE,YAAe6C,IAAUoB,EAAkBM,KA5BzCvE,YAAeiE,G,oBCjM1B,SAASO,EAAUnS,GACjB,MAAgB,UAAZA,EACK,CACLoS,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAGM,UAAZxS,EACK,CACLoS,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAGH,CACLJ,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAIH,SAASC,EAAT,GAA0C,IAAtBzS,EAAsB,EAAtBA,QACzB,OACE,yBAAK0S,QAAQ,eACX,kBAACC,EAAD,CAAM3S,QAASA,KAKd,SAAS4S,EAAT,GAA0C,IAAtB5S,EAAsB,EAAtBA,QACzB,OACE,yBAAK0S,QAAQ,eACX,kBAACG,EAAD,CAAM7S,QAASA,IACf,kBAAC2S,EAAD,CAAM3S,QAASA,KAKrB,SAAS2S,EAAT,GAAsC,IAC9BG,EAASX,EADqB,EAAtBnS,SAEd,OACE,oCACE,0BACE+S,MAAO,CAAEC,KAAMF,EAAOV,UACtBa,EAAE,qMAEJ,0BACEF,MAAO,CAAEC,KAAMF,EAAOT,SACtBY,EAAE,sLAEJ,0BACEF,MAAO,CAAEC,KAAMF,EAAOR,OACtBW,EAAE,oLAEJ,0BACEF,MAAO,CAAEC,KAAMF,EAAOP,UACtBU,EAAE,6KAEJ,0BACEF,MAAO,CAAEC,KAAMF,EAAON,MACtBS,EAAE,2IAMV,SAASJ,EAAT,GAAsC,IAC9BC,EAASX,EADqB,EAAtBnS,SAEd,OACE,uBACEkT,aAAW,UACXC,UAAU,6BACVJ,MAAO,CAAEC,KAAMF,EAAOV,WAEtB,0BAAMa,EAAE,6SACR,0BAAMA,EAAE,qiBACR,0BAAMA,EAAE,ofACR,0BAAMA,EAAE,uZACR,0BAAMA,EAAE,ktBACR,0BAAMA,EAAE,2hBACR,0BAAMA,EAAE,4a,qPC3FRG,EAAYC,YAAW,CAC3BC,iBAAkB,CAChBC,OAAQ,aACRnW,MAAO,QAEToW,eAAgB,CACdD,OAAQ,aACRlS,OAAQ,QAEVoS,uBAAwB,CACtBF,OAAQ,aACRG,UAAW,WAEbC,yBAA0B,CACxBJ,OAAQ,aACRG,UAAW,aA6EAE,MAjEf,YAMsB,IA8BhBC,EAnCJC,EAKoB,EALpBA,OAKoB,IAJpBC,gBAIoB,aAHpBC,eAGoB,SAFTC,EAES,EAFpBJ,UACG9B,EACiB,6DACsBmC,oBAAS,GAD/B,mBACbC,EADa,KACEC,EADF,KAEdC,EAAUC,iBAAO,GACjBC,EAAUnB,IAwChB,OAtCAoB,qBAAU,WACR,SAASC,EAAUC,GACjBA,EAAMC,iBACN,IACMC,EADMF,EAAMX,EAAW,UAAY,WAClBM,EAAQQ,QAC/B,GAAID,EAAU,CACZ,IAAME,EAAiBhB,EAAOc,GAC9BP,EAAQQ,SAAWC,GAIvB,SAASC,IACPX,GAAiB,GAEnB,OAAID,GACF9W,OAAO2X,iBAAiB,YAAaP,GAAW,GAChDpX,OAAO2X,iBAAiB,UAAWD,GAAS,GACrC,WACL1X,OAAO4X,oBAAoB,YAAaR,GAAW,GACnDpX,OAAO4X,oBAAoB,UAAWF,GAAS,KAG5C,eACN,CAACZ,EAAeL,EAAQC,IAKvBF,EAFAG,EACED,EACUQ,EAAQd,uBAERc,EAAQZ,yBAEbI,EACGQ,EAAQf,eAERe,EAAQjB,iBAIpB,uCACE4B,eAAa,OACbC,YAAa,SAAAT,GACXA,EAAMC,iBACN,IAAMS,EAAMV,EAAMX,EAAW,UAAY,WACzCM,EAAQQ,QAAUO,EAClBhB,GAAiB,IAEnBiB,KAAK,eACLxB,UAAWyB,YAAKzB,EAAWI,IACvBlC,KCpFJqB,EAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCqD,MAAO,CACLC,UADK,OAELnU,OAFK,OAGLoU,OAAQvD,SAHH,OAILwD,QAJK,OAKL3E,WAAYmB,qBAAyByD,SAEvCC,aAAc,CACZxY,MADY,EAEZqF,SAFY,QAGZoT,IAHY,EAIZJ,OAAQvD,gBAAsB,OAIlC,SAAS4D,EAAO,GAAuB,IAArBC,EAAqB,EAArBA,SAAUC,EAAW,EAAXA,QACpBzB,EAAUnB,IAEhB,OACE,uBAAOS,UAAWU,EAAlB,MAAiC0B,UAAjC,GAAgDC,QAAM,GACpD,qBACEpC,OAAQkC,EADV,aAEEnC,UAAWU,EAFb,aAGER,UAAQ,IALd,GAiBF+B,eAAsB,CACpBC,SAAU,MAGGzQ,0BAAf,GC3BM8N,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCiE,cAAe,CACbC,MADa,QAEb,UAAW,CACTxF,gBAAiByF,eACfnE,oBADmB,aAEnBA,iBAHO,cAKT,uBAAwB,CACtBtB,gBAAiB,iBAIvB0F,cAAe,CACb3E,YAAaO,cAEfqE,OAAQ,CACNC,SAAU,GAEZC,aAAc,CACZ/F,MAAOwB,oBAAwBjB,cAEjCyF,cAAe,CACbvH,OAAQ+C,cAEVyE,aAAc,CACZjG,MAAOwB,oBAAwBjB,kBAI7B2F,GAAetR,oBAAS,SAAAyM,GAAS,IAC7BiE,EAA8BjE,EADD,QACpB8E,EAAqB9E,EADD,iBAE7B+E,EAAiCd,EAFJ,cAEde,EAAkBf,EAFJ,cAG/BzB,EAAUnB,KAIVlB,EAAQ8E,cACd,OACE,uBACEvU,SADF,SAEEwU,IAAK,YAAG,OAAIJ,GAAiB,eAAG,IAAH,4CAArB,IACR9D,MAAO,CAAEhC,WAAYmB,oBAAwBpE,OAE7C,uBAASoJ,gBAAT,EAAwBrD,UAAWU,EAAQ+B,eACzC,uBACEzS,MAAOiT,GADT,GAEEK,cAFF,wBAGEtD,UAAWU,EAHb,aAIEA,QAAS,CAAE6C,KAAM7C,EAAQoC,cACzBU,YAAa,SAAAC,GAAY,MAInBC,gDAA4CD,EAJzB,MAEHE,EAFG,mBAGZC,EAHY,UAKvB,OACE,uBAAYzX,QAAZ,KAAyB0Q,MAAM,WAC5B8G,EACC,qBAAaxa,MAAOsa,IAEpBG,QALN,IAUFC,SAAU,cA/BG,IAAIC,IAgCfC,EA/BR5B,aAAmB2B,QAAnB3B,SAkCO6B,MAAA,KAAWd,EAAX,eAAuC,cAAmB,MAIrDQ,gDAA4CO,EAJS,MAErCN,EAFqC,mBAG9CC,EAH8C,UAKzD,OACE,uBACEN,cAAA,qCAA2CW,EAD7C,MAEElY,IAAG,UAAKkY,EAAL,eAFL,GAGEjU,MAAOiU,GAEP,uBAAY9X,QAAZ,KAAyB0Q,MAAM,WAC5B8G,EACC,qBAAaxa,MAAO8a,IAEpBL,QATN,GAYE,2BACE,uBACE5D,UAAWU,EADb,kBAEE4C,cAAA,UAAgBW,EAAhB,KAFF,kBAGEpH,MAHF,UAIEwC,aAJF,SAKE6E,QAAS,WACP/B,kBAGF,sBAvBR,aA8BJ,yBAAKnC,UAAWU,EAAQgC,SACxB,yBAAK1C,UAAWU,EAAQyD,mBACtB,uBACEnE,UAAWU,EADb,kBAEE4C,cAFF,kBAGEzG,MAHF,UAIEqH,QAAS,WACP/B,2BAGF,sBATJ,OAWE,uBACEmB,cADF,eAEEzG,MAFF,UAGEqH,QAAS,WACP/B,kBAGF,sBArFV,aAqHF,GAxBqB1Q,oBAAS,YAAiB,IAAd0Q,EAAc,EAAdA,QACvBc,EAAiCd,EADI,cACtBe,EAAkBf,EADI,cAGrCiC,EADkBV,iBAFmB,iBAGlBW,cAA4BpB,EAHV,uBAQH5C,mBARG,sBAQtCiE,EARsC,KAQvBtB,EARuB,KAU7C,OACE,sBAAQb,QAAR,EAA0BoC,KAAMC,QAAQtB,EAAD,OACrC,sBAAcf,QAAd,EAAgCa,iBAAkBA,IAClD,8BAAUyB,SAAU,4CAClB,qBACEtb,MADF,EAEEgZ,QAFF,EAGEmC,cAAeA,S,0CC/JnB/E,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCrB,KAAM,CACJ0H,QAAS,QAEXC,WAAY,CACV,UAAW,CACT5H,gBAAiByF,eACfnE,EAAMjE,QAAQJ,QAAQoD,aACtBiB,EAAMjE,QAAQwK,OAAOC,cAEvB,uBAAwB,CACtB9H,gBAAiB,qBA+DVtL,2BAzDf,YASG,IARDqT,EAQC,EARDA,UACA3C,EAOC,EAPDA,QACA4C,EAMC,EANDA,UAMC,EACuB1E,oBAAS,GADhC,mBACMkE,EADN,KACYS,EADZ,KAEKC,EAAWxE,iBAAO,MAClBC,EAAUnB,KAWhB,SAAS2F,IACPF,GAAQ,GAGV,OACE,yBAAKhF,UAAWU,EAAQ1D,MACtB,kBAACmI,GAAA,EAAD,CACE/B,IAAK6B,EACLf,QAjBN,WACEc,GAAST,IAiBL1H,MAAM,UACNyG,cAAY,qBACZ5C,QAAS,CAAE1D,KAAM0D,EAAQiE,aAExBG,EACD,kBAAC,KAAD,OAEF,kBAACM,GAAA,EAAD,CACEH,SAAUA,EAASjE,QACnBqE,aAAc,CAAEnF,SAAU,SAAUoF,WAAY,QAChDC,gBAxBN,SAA6BC,EAAiBC,GAC5CA,EAAStD,GACT+C,KAuBIX,KAAMA,EACNmB,QAASR,EACTH,UAAWA,Q,WC1DbxF,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCsH,MAAO,GACPC,UAAW,GACX5H,WAAY,CACVgE,IAAK,EACL1U,KAAM,EACNsB,SAAU,WACViX,WAAY,SACZC,WAAY,UAEdC,UAAW,CACT3c,QAASiV,EAAMJ,QAAQ,KAEzB+H,aAAc,CACZC,YAAa,QACbC,aAAc7H,EAAMvL,MAAMoT,aAC1BC,YAAa,OAsGFC,GA1FYC,IAAMC,YAC/B,SAACpI,EAAoCkF,GAAmC,IAC9DpT,EAAuCkO,EAAvClO,MAAOuW,EAAgCrI,EAAhCqI,SAAUpa,EAAsB+R,EAAtB/R,QAAYqa,EADiC,YACvBtI,EADuB,kCAEhCmC,qBAFgC,mBAE/DoG,EAF+D,KAElDC,EAFkD,OAG5CrG,mBAAS,GAHmC,mBAG/D9W,EAH+D,KAGxDod,EAHwD,OAIpCtG,mBAAiC,MAJG,mBAI/DuG,EAJ+D,KAIpDC,EAJoD,OAKpCxG,mBAAkC,MALE,mBAK/DyG,EAL+D,KAKpDC,EALoD,OAM9C1G,oBAAS,GANqC,mBAM/D2G,EAN+D,KAMzDC,EANyD,KAQtEtG,qBAAU,WACJqG,IACFF,GAAaA,EAAUE,OACvBC,GAAQ,MAET,CAACD,EAAMF,IAEV,IAAMpG,EAAUnB,GAAUrB,GACpBG,EAAQ8E,cAER+D,EAAcN,GAAaA,EAAUM,YACvCA,GAAeA,IAAgB3d,GACjCod,EAASO,GA+BX,OACE,yCAASV,EAAT,CAAgBpD,IAAKA,IACnB,yBAAKlE,MAAO,CAAEtQ,SAAU,aACtB,kBAACuY,EAAA,EAAD,CACE/D,IAhCS,SAAC7N,GAChBsR,EAAatR,IAgCP6R,UAAU,OACVjb,QAASA,EACT6T,UAAWU,EAAQ1C,iBAEF7Q,IAAhBsZ,EAA4BzW,EAAQyW,IAGzC,kBAACY,GAAA,EAAD,CACEC,SArCW,SAAC/R,GAChBwR,EAAaxR,IAqCTyK,UAAWU,EAAQkF,UACnB2B,WAAY,CACVrI,MAAO,aACL3V,SACI4C,GAAuB,YAAZA,GAAqC,WAAZA,EACpCkS,EAAML,WAAW7R,GACjB,KAGRuU,QAAS,CACPiF,MAAOjF,EAAQiF,MACf3I,KAAM0D,EAAQqF,UACdyB,QAAS9G,EAAQsF,cAEnBhW,WAAuB7C,IAAhBsZ,EAA4BzW,EAAQyW,EAC3C5C,SAjCN,SAAsBhD,GACpB6F,EAAe7F,EAAM4G,OAAOzX,QAiCxB0X,UA3CN,SAAuB7G,GACH,UAAdA,EAAM9U,IACR+a,GAAaA,EAAUE,OACA,WAAdnG,EAAM9U,MACf2a,OAAevZ,GACf8Z,GAAQ,KAuCNU,OAnDN,WACMlB,GAAeA,IAAgBzW,GACjCuW,EAASE,GAEXC,OAAevZ,U,sBCINsE,2BAjEf,YAIG,IAHD0Q,EAGC,EAHDA,QAGC,EACuB9B,oBAAS,GADhC,mBACMkE,EADN,KACYS,EADZ,OAE6C3E,qBAF7C,mBAEMuH,EAFN,KAEuBC,EAFvB,KAMOC,EAAyC3F,EAAzC2F,mBAAoBC,EAAqB5F,EAArB4F,iBAEtBC,EAAgBD,EAAiBzb,OACnCyb,EAAiBA,EAAiBzb,OAAS,GAC3C,KAEJqU,qBAAU,WACR,IAAIsH,EAiBJ,OAfIL,EACGI,EAEMJ,EAAgB,KAAOI,EAAc,KAC9ChD,GAAQ,GACRiD,EAAYC,YAAW,WACrBL,EAAmBG,GACnBhD,GAAQ,KACP,MANH6C,OAAmB1a,GAQZ6a,IACTH,EAAmBG,GACnBhD,GAAQ,IAGH,WACLmD,aAAaF,MAEd,CAACD,EAAeJ,IAEnB,IAAM1C,EAAc,SAACM,EAAiB4C,GACrB,cAAXA,IAGJN,IACA9C,GAAQ,KAxCT,EA2CwB4C,GAAmB,GA3C3C,mBA2CMS,EA3CN,KA2CeC,EA3Cf,KA4CD,OACE,kBAACC,GAAA,EAAD,CACEhE,KAAMA,KAAU8D,EAChB3C,QAASR,EACTN,OACE,kBAAC4D,EAAA,EAAD,CAAYnJ,aAAW,QAAQxC,MAAM,UAAUqH,QAASgB,GACtD,kBAAC,IAAD,QAIJ,kBAACuD,GAAA,EAAD,CAAO/C,QAASR,EAAawD,SAAUJ,GAAS,WAC7CD,O,iCCtDH9I,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCsK,cAAe,CACbC,SAAU,SACV1L,WAAYmB,EAAMjE,QAAQF,UAAUD,KACpCqB,OAAQ+C,EAAMJ,QAAQ,KAExBsF,KAAM,CACJ1G,MAAOwB,EAAMjE,QAAQF,UAAUkD,cAEjCyL,KAAM,CACJlG,SAAU,GAEZmG,SAAU,CACR,UAAW,CACT/L,gBAAiByF,eACfnE,EAAMjE,QAAQF,UAAUkD,aACxBiB,EAAMjE,QAAQwK,OAAOC,cAEvB,uBAAwB,CACtB9H,gBAAiB,iBAIvBgM,iBAAkB,CAChBpL,SAAU,IAEZqL,cAAe,CACblL,YAAa,IAEfmL,cAAe,CACbnL,YAAaO,EAAMJ,QAAQ,GAC3BiL,aAAc,GACd1L,WAAY,EACZC,cAAe,GAEjB0L,oBAAqB,CACnB5b,MAAO8Q,EAAMJ,QAAQ,IAEvB0H,MAAO,CACLlI,cAAe,EACfD,WAAY,GAEdoI,UAAW,CACT/I,MAAOwB,EAAMjE,QAAQF,UAAUkD,cAEjC2I,UAAW,CACT,UAAW,CACThJ,gBAAiBsB,EAAMjE,QAAQF,UAAUkP,QAG7CpD,aAAc,CACZqD,YAAahL,EAAMjE,QAAQJ,QAAQC,KACnC8C,gBAAiBsB,EAAMjE,QAAQF,UAAUkP,WAIvCE,GAAW7X,oBACf,YAQM,IAPJtI,EAOI,EAPJA,MACAogB,EAMI,EANJA,gBACAC,EAKI,EALJA,UAKI,EAC4BnJ,qBAD5B,mBACG4E,EADH,KACawE,EADb,KAGJ,OAAMtgB,EAAM4b,WAAa5b,EAAM4b,UAAUzY,OAKvC,oCACE,kBAACkc,EAAA,EAAD,iBACMe,EADN,CAEElK,aAAW,OACXqK,gBAAc,YACdC,gBAAc,OACdzF,QAAS,SAAArD,GACP4I,EAAY5I,EAAM+I,gBAEpBtG,cAAY,mBAEZ,kBAAC,KAAakG,IAEhB,kBAACpE,GAAA,EAAD,CACEH,SAAUA,EACVV,KAAMC,QAAQS,GACdM,gBAAiB,SAACC,EAAQC,GACxBA,IACAgE,OAAYtc,IAEduY,QAAS,WACP+D,OAAYtc,IAEd4X,UAAW5b,EAAM4b,aA3Bd,QAkCE8E,gBAAgB,SAAhBA,CACbpY,oBACE,YAcM,IAbJqY,EAaI,EAbJA,KACApE,EAYI,EAZJA,QACAxG,EAWI,EAXJA,MACAgD,EAUI,EAVJA,SACA6H,EASI,EATJA,YACAC,EAQI,EARJA,WASMtJ,EAAUnB,KAEV0K,EADQ9G,cACSlF,QAAQ,GAE3B1U,EAAQ,EACRwgB,EAAYG,SACV3gB,EAAUwgB,EAAYG,OAAtB3gB,OAENoX,qBAAU,WACJpX,GACE4gB,kBAAQL,IACVA,EAAKnD,SAASpd,EAAmB,EAAX0gB,KAGzB,CAACA,EAAUH,EAAMvgB,IAEpB,IAAM6gB,EAAY3J,iBAAuB,MAUzC,OANAE,qBAAU,WAAM,OACd,OAAIyJ,QAAJ,IAAIA,GAAJ,UAAIA,EAAWpJ,eAAf,aAAI,EAAoBqJ,iBACtBD,EAAUpJ,QAAQqJ,eAAe,CAAEC,MAAO,aAE3C,IAGD,kBAACC,EAAA,EAAD,CACEnI,UAAW,GACXgB,IAAK4G,EACLhK,UAAWU,EAAQiI,cACnBzJ,MAAK,2BAAOA,GAAP,IAAc9V,QAAS,OAAF,OAAS6gB,EAAT,cAAuBA,EAAvB,SAE1B,yBAAK7G,IAAKgH,EAAWlL,MAAO,CAAEwF,QAAS,SACrC,kBAAC4E,GAAD,CACEngB,MAAO2gB,EACPP,gBAAiB,CACf7I,QAAS,CAAE1D,KAAM0D,EAAQoI,UACzB0B,KAAM,SAERhB,UAAW,CAAExJ,UAAWU,EAAQ6C,QAElC,yBAAKvD,UAAWU,EAAQmI,OACxB,kBAAC,IAAD,CAAS4B,MAAM,cAAcC,OAAK,GAChC,kBAAC,GAAD,CACE1a,MACE8Z,EAAKa,cAEJb,EAAKc,cAEFd,EAAKc,cAAcC,KAAK,KACxB,iBAENtE,SAAU,SAAAuE,GACRhB,EAAKiB,eAAeD,IAEtB3e,QAAQ,QACRuU,QAAS,CACPiF,MAAOjF,EAAQiF,MACfC,UAAWlF,EAAQkF,UACnBG,UAAWrF,EAAQqF,UACnBC,aAActF,EAAQsF,iBAI5B,yBAAKhG,UAAWU,EAAQmI,OACxB,kBAACL,EAAA,EAAD,CACElF,cAAY,aACZ5C,QAAS,CAAE1D,KAAM0D,EAAQoI,UACzB0B,KAAK,MACLtG,QAASwB,GAET,kBAAC,IAAD,CAAW1F,UAAWU,EAAQ6C,SAGlC,kBAACgH,EAAA,EAAD,KAAQrI,QC5MZ3C,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrC,UAAW,CACT2M,KAAM,CACJ,cAAe,UAKjB,IAAK,CACH,kBADG,OAEH,kBAAmB,oCAGrB,uBAAwB,CACtB,qBADsB,OAEtBzhB,MAAO,QAET,6BAA8B,CAC5B,mBAD4B,iBAE5B,qBAAsB,iCAG1ByT,KAAM,CACJ0H,QADI,OAEJlX,OAFI,QAGJjE,MAAO,QAET0hB,IAAK,CACH1I,MADG,QAEH3T,SAFG,SAGHsc,UAAW7M,UAHR,GAIH8M,OAAQ9M,UAJL,GAKH9Q,MAAO8Q,cAET+M,qBAAsB,CACpBC,WADoB,OAEpB3G,QAFoB,OAGpB4G,iBAHoB,0CAIpB9d,OAAQ,SAEV+d,QAAS,CACPC,QAAS,WAEXC,WAAY,CACV9J,UADU,OAEV6J,QAAS,cAEXE,OAAQ,CACN/I,SAAU,GAEZkG,KAAM,CACJlG,SAAU,GAEZiD,UAAW,CACT/I,MAAOwB,kBAAsBjB,cAE/B2I,UAAW,CACT,UAAW,CACThJ,gBAAiBsB,kBAAsB+K,QAG3CpD,aAAc,CACZqD,YAAahL,oBADD,KAEZtB,gBAAiBsB,kBAAsB+K,WAmI3C,GA/HY3X,oBAAS,YAAgC,IAA7B0Q,EAA6B,EAA7BA,QAASwJ,EAAoB,EAApBA,cACzBjL,EAAUnB,KACR8E,EAAkBX,iBAFyB,iBAIjDT,EAQEd,EAZ+C,cAKjDyJ,EAOEzJ,EAZ+C,YAMjD0J,EAME1J,EAZ+C,UAOjDe,EAKEf,EAZ+C,cAQjD2J,EAIE3J,EAZ+C,kBASjDhR,EAGEgR,EAZ+C,KAUjD4J,EAEE5J,EAZ+C,MAWjD6J,EACE7J,EAZ+C,MAwBnD,OACE,yBACEnC,UAAWU,EADb,KAEExB,MAAO,CACL+M,oBAAqB,aAAF,OACjBhJ,kCADiB,MAKpBd,kBACC,8BAAUsC,SAAU,+BAClB,kBAACtC,EAAD,+BACE+C,YAAa,kBAAM/C,iCAAN,KACTA,EAJTA,eARH,KAgBE,yBAAKnC,UAAWU,EAAQ0K,sBACtB,yBAAKpL,UAAWU,EAAQ6K,SACtB,uBAAQvL,UAAWU,EAAnB,OAAmC9R,SAAS,UAC1C,2BACGmd,EAAA,KAAU,SAAAG,GAAI,OACb,sBACEngB,IAAKmgB,EADP,MAEEpH,UAAWoH,EAFb,MAGEnH,UAAWmH,EAHb,UAIE/J,QAASA,OAGb,yBAAKnC,UAAWU,EAAQmI,OACxB,uBAAS4B,MAAT,iBAAgCC,OAAK,GACnC,sBACE1a,MADF,EAEEuW,SA3ChB,YACMuF,GAAqBA,WAAzB,GACE3J,8GAKAA,2BAqCYhW,QAHF,QAIEuU,QAAS,CACPkF,UAAWlF,EADJ,UAEPqF,UAAWrF,EAFJ,UAGPsF,aAActF,EAAQsF,iBAlB9B,EAuBE,yBAAKhG,UAAWU,EAAQmI,OACxB,yBAAK3J,MAAO,CAAE3V,MAAF,IAAc4iB,UAAW,KACnC,qBAAUhgB,QAAQ,cAK1B,yBAAK6T,UAAWU,EAAQ+K,YACrBO,EAAA,KAAU,SAAAlC,GACT,IAAMsC,EAAW/H,cAA0ByF,EAA3C,MACA,MACE,MAAM,IAAIvb,MAAM,qBAAV,OAA+Bub,EAArC,OAHe,IAKT1F,EAAmBgI,EALV,eAMjB,OACE,sBACErgB,IAAG,eAAU+d,EADf,IAEEA,KAFF,EAGEpE,QAAS,kBAAMvD,aAAN,KAET,8BAAUsC,SAAU,4CAClB,qBACEtb,MADF,EAEEgZ,QAFF,EAGEkK,aAAchI,EAAcgI,oBAQtC,yBAAKnN,MAAO,CAAE1R,OAAQ,SAIzB0V,YACC,yBAAKlD,UAAWU,EAAQuK,KACtB,uBACEpO,MADF,UAEEzB,KAFF,QAGEiE,aAHF,OAIEiE,cAJF,kBAKEpE,MAAO,CAAEqD,MAAO,SAChB2B,QAAS,WACP/B,uBAGF,sBAZLe,QA9EH,KA+FGD,IAAA,EAA8B,sBAAcd,QAASA,IA/FxD,KAiGE,sBAAUA,QAASA,Q,8BCpMzB,SAASmK,GAAkBpO,GAOxB,IAEC3U,EAME2U,EANF3U,MACAiE,EAKE0Q,EALF1Q,OACA+e,EAIErO,EAJFqO,sBACArN,EAGEhB,EAHFgB,MACAsN,EAEEtO,EAFFsO,UACAC,EACEvO,EADFuO,aAEIC,EAAgBjM,iBAA0B,MAEhDE,qBAAU,WACR,GAAK6L,EAAL,CAGA,IAAMG,EAASD,EAAc1L,QAC7B,GAAK2L,EAAL,CAGA,IAAMC,EAAUD,EAAOE,WAAW,MAClC,GAAKD,EAGL,GAAIJ,EAAUM,SACZN,EAAUM,SAAStiB,SAAQ,SAACuiB,GACL,gBAAjBA,EAAQxV,KACVqV,EAAQI,YAAcD,EAAQ7N,MACJ,cAAjB6N,EAAQxV,KACjBqV,EAAQK,UAAYF,EAAQ7N,MACF,SAAjB6N,EAAQxV,KACjBqV,EAAQM,KAAOH,EAAQ7N,MAGvB0N,EAAQG,EAAQxV,MAAhB,MAAAqV,EAAO,aAAkBG,EAAQI,eAGhC,GAAIX,aAAqBY,KAC9BR,EAAQS,UAAUb,EAAW,EAAG,QAC3B,GAAIA,EAAUc,QAAS,CAC5B,IAAMC,EAAM,IAAIC,MAChBD,EAAIE,OAAS,kBAAMb,EAAQS,UAAUE,EAAK,EAAG,IAC7CA,EAAIG,IAAMlB,EAAUc,aAErB,CAACd,IAEJ,IAAMmB,EAAiBlB,EAAe,eAAiB,GACvD,OACE,4BACEnJ,cAAA,4BAAkCqK,GAClCvK,IAAKsJ,EACLnjB,MAAOA,EAAQgjB,EACf/e,OAAQA,EAAS+e,EACjBrN,MAAK,aAAI3V,QAAOiE,UAAW0R,KAajCoN,GAAkBsB,aAAe,CAC/BpB,eAAWrf,EACXof,sBAAuB,EACvBrN,MAAO,IAIMoN,U,uDC5EA,eAQT,IAPJ5G,EAOI,EAPJA,QACAnB,EAMI,EANJA,KACAsJ,EAKI,EALJA,eAMA,SAASC,EAAkBlJ,GACV,UAAXA,GACFiJ,IAEFnI,IAGF,OACE,kBAACqI,GAAA,EAAD,CAAQxJ,KAAMA,EAAMmB,QAAS,kBAAMoI,MACjC,kBAACE,GAAA,EAAD,CAAa3gB,GAAG,sBAAhB,SACA,kBAAC4gB,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CAAmB7gB,GAAG,4BAAtB,iFAKF,kBAAC8gB,GAAA,EAAD,KACE,kBAAChJ,GAAA,EAAD,CAAQjB,QAAS,kBAAM4J,KAAqBjR,MAAM,WAAlD,UAGA,kBAACsI,GAAA,EAAD,CACEjB,QAAS,kBAAM4J,EAAkB,UACjCjR,MAAM,UACN1Q,QAAQ,aAHV,S,SC9BFoT,GAAYC,YAAW,CAC3B4O,WAAY,CACVC,OAAQ,kBACRzf,SAAU,WACVsO,WAAY,QACZoR,cAAe,OACf1M,OAAQ,OAuCGnQ,uBAnCC,SAAC,GAYX,IAXJ8c,EAWI,EAXJA,QACAC,EAUI,EAVJA,QACAxZ,EASI,EATJA,cACAyZ,EAQI,EARJA,QAQI,IAPJC,eAOI,MAPM,IAON,EACEhO,EAAUnB,KADZ,EAEsBc,oBAAS,GAF/B,mBAEGsO,EAFH,KAEUC,EAFV,KASJ,GANAjO,qBAAU,WAGR,IAAMkO,EAAS3G,YAAW,kBAAM0G,GAAS,KAAOF,GAChD,OAAO,kBAAMvG,aAAa0G,OAExBJ,GAAWE,EAAO,CACpB,IAAMG,EAAOte,0BAAewE,EAAe,YAAa,CAAEyZ,YAC1D,OACE,yBACEzO,UAAWU,EAAQ0N,WACnBlP,MAAO,CAAE5R,KAAMihB,EAASvM,IAAKwM,IAE5BM,GAIP,OAAO,QCxCHC,GAAiB,SAAC,GAMlB,IALJlB,EAKI,EALJA,eACAmB,EAII,EAJJA,gBAII,EACgC3O,oBAAS,GADzC,mBACG4O,EADH,KACeC,EADf,KAGJ,OACE,oCACE,kBAAC/J,GAAA,EAAD,CACE7B,cAAY,cACZzG,MAAM,UACN1Q,QAAQ,YACR+X,QAAS,kBAAMgL,GAAc,KAE5BF,GAEH,kBAACG,GAAD,CACEzJ,QAAS,kBAAMwJ,GAAc,IAC7B3K,KAAM0K,EACNpB,eAAgBA,MAUlBuB,GAAmB,SAAC,GAUpB,IATJC,EASI,EATJA,eACAC,EAQI,EARJA,MACAzB,EAOI,EAPJA,eACAmB,EAMI,EANJA,gBAOA,OACE,kBAACjB,GAAA,EAAD,CAAQxJ,MAAI,GACV,kBAACyJ,GAAA,EAAD,CAAa9O,MAAO,CAAEnC,gBAAiB,SAAvC,eACA,kBAACkR,GAAA,EAAD,KACE,6BACGqB,EAAMC,WACNF,IAGL,kBAAClB,GAAA,EAAD,KACE,kBAAChJ,GAAA,EAAD,CACEtI,MAAM,YACN1Q,QAAQ,YACR+X,QAAS,kBAAM1a,OAAO4M,SAASoZ,WAHjC,WAOA,kBAAC,GAAD,CACE3B,eAAgBA,EAChBmB,gBAAiBA,OAc3BI,GAAiBxB,aAAe,CAC9B0B,MAAO,CAAEjH,QAAS,6BAClBgH,eAAgB,GAChBL,gBAAiB,iBAGJI,U,sPC7Bf,EAzD6B,SAAA/K,GAAiB,IACpCoL,EAAcpL,EADsB,UAGpC/R,EAAUmd,EAH0B,2BAIYA,EAJZ,+BAIpCC,EAJoC,sBAIfC,EAJe,yBAOpCC,EAAsBH,EAPc,wCAQpC/Z,EAAyB+Z,EARW,kDAStCI,EAAeH,EAAoB,sBAEvC,CACEI,SAAUxd,EAAA,SACR+R,4BADQ,YAER,CAAE9M,KAAM,oCAGZ,CAAEwY,kBAAF,IAA6CC,iBAAiB,IA+BhE,MAAO,CAAEC,WA5BU3d,EAAA,kCAIfA,EAAA,MAAY,CACViF,KAAMjF,UADI,uBAEV0C,cAAe2a,EAAuBE,MANzB,OASV,SAAAnc,GAAI,MAAK,CACd,uBACE,OAAOA,yBAAP,MAEF,kBACE,IAAMoW,EAAO8F,EAAb,GACA,kCACKla,EADL,QAEEwa,cAAexc,EAFjB,cAGEyc,aAHF,EAIEC,aAActG,WAAgBpW,EAJhC,kBAKE2c,OAAQvG,EALV,SAMEwG,iBAAkBvjB,KANpB,iBAOEoD,OAAQuD,gBAPV,SAQE6c,aAAc7c,EAAK6c,oBAKNV,iBCjDR,WAACxL,GAAiC,IACvCmM,EAAcnM,EAAdmM,IAAKC,EAASpM,EAAToM,KACPC,EAAcF,EAAI,mDAFuB,EAIVC,EAAKE,GAAlCV,EAJuC,EAIvCA,WAER,OAAO,IAAIS,EAAY,CACrBvf,KAAM,sBACN0e,aAR6C,EAI3BA,aAKlBI,aACAW,UAAW,eACXxE,SAAU,eACVhI,eAAgByM,YAAiCxM,M,sDCFtC,WAAUwL,GACvB,OAAOvd,QACJuB,QACC,uBACAid,YAA+BjB,GAC/Bvd,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,wBACpB/b,cAAe2a,iCAAuBE,MAGzCpc,SAAQ,SAAAC,GAAI,MAAK,CACVsd,cADU,SACIvC,GAAkB,gIAC9BtM,EAAU8O,qBAAWvd,IACvBwd,oCAA0B/O,GAFM,wBAG1BgP,EAAehP,EAAfgP,WACFC,EAAYhc,0BAAgB1B,GAC5BoB,EAAQuc,6BAAmB3d,GAC3B4d,EAAgBC,kBAAQzc,EAAO,WANH,SAObqc,EAAWK,KAAKJ,EAAW,kBAAmB,CACjEE,kBARgC,OAO5BzgB,EAP4B,OAU5B4gB,EAAgBtP,EAAQuP,UAC5B,uBACA,iBACA,CACEC,YAAalD,EAAQzgB,SACrB8b,KAAM8F,4BAAkBlc,GACxBke,aAAc/gB,IAGlBsR,EAAQ0P,WAAWJ,GAnBe,QAsBpCtP,EAAQ2P,aAAarD,GAtBe,oD,0BCoK5C,EA7LuB,SAAC,GAAkB,IAAhBgB,EAAgB,EAAhBA,UAClBpJ,EAAQoJ,EAAd,SACQsC,EAAYtC,EAFoB,mBAGOA,EAHP,cAGhChe,EAHgC,WAIhCugB,GAJgC,YAIXvC,EAJW,wCAKhCjf,EAAmBif,EALa,8CAODA,EAPC,0CAUtBA,EAAlB,cAEA,gBACE,IAAMwC,EAAa3H,kBAA0BA,SAA7C,MACM4H,EAAW5H,kBAA0BA,SAA3C,IAGA,OAFiBA,UAAgB4H,EAAhB5H,EAAiC/I,EAAlD,GAC2B+I,EAAX6H,YAA+B7H,EAA/C,aAIF,IAAM8H,EAAQ3gB,GAAS,SAAe,GAQnC,IAMD,EAMA,EACA,EApBAgd,EAOC,EAPDA,QACA4D,EAMC,EANDA,cACAhC,EAKC,EALDA,OACAlgB,EAIC,EAJDA,OACAigB,EAGC,EAHDA,aACA3M,EAEC,EAFDA,SACAS,EACC,EADDA,QAGMoO,EAAaD,EAAc5D,MAAjC,YACA,MACE,YAGF,GAAIA,MAAJ,QAAyB,OACXA,sBADW,GACrB8D,EADqB,yBAEd9D,MAAJ,UACL8D,UAIF,WAAIA,EAAkB,CAEpB,IACMC,GADyB/D,cAAD,IAA9B,GACqBgE,mBAArB,KACAC,EAAcC,SAASH,EAAD,GAAtBE,IACAE,EAAWP,EAAcG,EAAzBI,SACK,WAAIL,EAAkB,CAE3B,IAAMM,IAASpE,eAAD,UAAD,IAAb,GACMzjB,IAAQyjB,eAAD,SAAD,IAAZ,GACAiE,EAAcC,SAAS3nB,EAAvB0nB,IACAE,EAAWP,EAAXO,QACK,YAAIL,EAAmB,CAE5B,IAAMO,EAAOrE,MAAb,QACMoE,EAAOC,EAAb,QACAJ,EAAcI,EAAdJ,MACAE,EAAWP,EAAXO,GAEF,KAAc,CACZ,IAUA,EAVMG,EAAWtE,MAAjB,SACMuE,EAAeC,EAAYX,EAAjC,GACMY,EAAaD,EAAYL,EAA/B,GACMO,EAAUnB,EAAiB3B,EAAjC,GACM+C,EAAQpB,EAAiB3B,EAA/B,GACMgD,EAAYrB,EAAiB,GAEhCkB,EAAD,GAFF,GAOEI,EAAc9iB,EAAeL,EAD/B,EACuC,sBAEA,cAFuB,CAAEse,YAIhE,IAAM8E,EAAmB/iB,EAAeL,EAAQ,mBAAoB,CAClEse,YAEF,OACE,wBACEnL,cAAA,gBAAsBmL,EADxB,MAEErP,EAAG,CAAC,KAAD,gEAFL,KAGEF,MAAO,CAAEsU,OAAQF,GACjBpP,QAAS,SAAAuP,GAAG,OACVvP,EAAQuK,EAAS6D,EAAV,OAA6BM,EAA7B,OADG,IAGZc,YAAa,SAAAD,GACX,IACEA,0BAGJE,WAAY,SAAAF,GACV,IACEA,4BAOV,eAGF,cAAwC,MAEpCG,EASE1V,EAXkC,SAGpC/N,EAQE+N,EAXkC,OAIpCiS,EAOEjS,EAXkC,aAKpCoS,EAMEpS,EAXkC,iBAMpCmS,EAKEnS,EAXkC,OAOpCkS,EAIElS,EAXkC,aAQpB2V,EAGd3V,EAXkC,+BAUpCqS,EACErS,EAXkC,aAahC4V,EAAoB/B,GAAQ,WAChC,IAAMM,EAAN,GASA,OARA/B,WAAyB,SAAAhG,IACPA,gBACZA,SADYA,QAEZ,CAACA,EAFL,SAGAyJ,SAAgB,SAAAtpB,GACd4nB,EAAc5nB,EAAd4nB,iBAGJ,IACC,CAxBmC,IA0BhC2B,EAAN,GA1BsC,qBA2BtC,2BAAsC,8BAA1B3mB,EAA0B,KAAtBohB,EAAsB,KAC9BhL,EAAWwQ,YAA8BA,OAAOxF,EAAtD,MACAuF,OACE,mBACEjoB,IADF,EAEE0iB,QAFF,EAGEte,OAHF,EAIEggB,aAJF,EAKEE,OALF,EAMED,aANF,EAOEiC,cAPF,EAQE5O,SARF,EASES,QAASqM,MAvCuB,8BA2CtC,IAAM2D,EAAe,UAAH,OAAa/D,EAA/B,IACA,OACE,qBAAG9iB,GAAH,EAAqBiW,cAAY,kCAC/B,yBAEE6Q,wBAAyB,CACvBC,OAAQ,gBAAF,iGALd,GAoCF,OANAC,eAAuC,CACrClE,kBADqC,EAErC0D,kBAFqC,GAGrCtD,kBAAcpjB,GAGTsE,EAAP,IC/IF,EAzC6B,SAAA4S,GAAiB,IACpCoL,EAAcpL,EADsB,UAEtCiQ,EAAoB7E,EAA1B,2EAGQC,EAAwBD,EALY,mDAiC5C,OAAO,IAAI6E,EAAkB,CAC3BnjB,KAD2B,iCAE3BiT,eA5BqBqL,EAAvB,GA6BEI,aA5BmBH,EAAoB,iCAEvC,CACE4D,YAAa,CACX/b,KADW,QAEXiC,YAFW,6BAGX+a,aAHW,uBAIXC,gBAAiB,CAAC,YAEpBC,oBAAqB,CACnBld,KADmB,QAEnBiC,YAFmB,kDAGnB+a,aAHmB,QAInBC,gBAAiB,CAAC,YAEpBE,iBAAkB,CAChBnd,KADgB,QAEhBiC,YAFgB,qEAIhB+a,aAJgB,OAKhBC,gBAAiB,CAAC,aAGtB,CAAExE,iBAAiB,IAMnB3L,mB,SCnCSwL,EAAeH,8BAAoB,uBAAzC,IAEA,SAASiF,EAAkBtQ,GAChC,OAAO,qCAC0B,CAC7BhX,GAD6B,YAE7BkK,KAAMjF,gBAFuB,wBAG7BwX,KAAMxX,sBACJ+R,0BAJ2B,eAM7BsN,YAAarf,QANgB,SAO7Bsf,aAActf,mBARX,SAUI,SAAAoB,GAAI,MAAK,CAChBkhB,eADgB,YAEdlhB,iBAEFmhB,iBAJgB,WAKdnhB,0BCnBOgc,oCACb,kBACA,CACE7X,cAAe,CACbN,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,uBAEvBuC,MAAOgZ,8BAAoB,WAAY,CACrCjY,UAAW,CACTtO,MAAOmJ,QAAMwiB,YAAY,YAAa,CAAC,MAAO,QAC9Cvd,KAAM,aACNgd,aAAc,OAEhBne,SAAU,CACRmB,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,8BAI3B,CAAE6b,iBAAiB,I,SCGA+E,E,4MACnB5jB,KAAO,iB,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,kBACN0e,aAAcqF,EACdC,gBAAiB,kBACf,oEAA4CC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,iBAIhEuC,EAAciR,iBAAgB,kBAC5BjR,EAAcoL,UAAU8F,MAE1BlR,EAAcmR,cAAa,WACzB,IAAM3F,EAAeH,8BACnB,eACA,GACA,CAAEK,kBAAmB0F,gCAAsBpR,KAE7C,OAAO,IAAIqR,IAAU,CACnBvkB,KAAM,eACN0e,eACAI,WAAY0F,+BACVtR,EACA,eACAwL,QAKNxL,EAAcuR,gBAAe,kBAC3BvR,EAAcoL,UAAUkB,MAG1BtM,EAAcuR,gBAAe,WAC3B,IAAM/F,EC3DL,SACLxL,GAEA,IAAMwL,EAAegG,YAAsCxR,GAE3D,OAAOqL,8BACL,uBACA,GACA,CAAEK,kBAAmBF,EAAcG,iBAAiB,IDmD7B8F,CACnBzR,GAEF,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,uBACN0e,eACAI,WAAY8F,EAAiClG,GAC7Ce,UAAW,eACXxE,SAAU,mBACVhI,eAAgB4R,SAIpB3R,EAAc4R,eACZ,kBACE,IAAIC,IAAW,CACb/kB,KAAM,uBACNglB,QAAS,kBACTtG,aAAcuG,EACdnG,WAAYoG,EAAsChS,GAClDD,eAAgBkS,gBACd,kBAAM,4C,GA5D0BC,M,4VEJtChX,EAAYC,aAAW,iBAAO,CAClCgX,YAAa,CACX5nB,SAAU,WACVrB,MAAO,EACPyU,IAAK,GAEPyU,gBAAiB,CACfnb,OAAQ,QAIZ,SAASob,IACP,OACE,kBAACC,EAAA,EAAD,CACEzX,MAAO,CAAE0X,YAAa,UACtBnM,MAAM,gEAEN,kBAAC,IAAD,OAoFShZ,0BA/Ef,YAMG,IALDolB,EAKC,EALDA,OACA1tB,EAIC,EAJDA,MAKMuX,EAAUnB,IADf,EAGmCc,oBAAS,GAH5C,mBAGM4O,EAHN,KAGkBC,EAHlB,KAKK/M,EAAU8O,qBAAW9nB,GAEnB2tB,EADgBC,sBAAY5U,GAC5B2U,eACFE,EAAe,OAAGF,QAAH,IAAGA,OAAH,EAAGA,EAAgBG,MACtC,SAACC,GAAD,MAAmB,UAAGA,EAAE/lB,KAAL,YAAsB0lB,EAAO1lB,QAG5CgmB,EAAYhiB,oBAAUhM,EAAO,GAC3BiuB,EAAuBD,EAAvBC,QAASC,EAAcF,EAAdE,UAEjB,OACE,oCACE,kBAACC,EAAA,EAAD,CAAUvrB,IAAK8qB,EAAO1lB,MACnBkmB,GAAaL,EACZ,kBAACxO,EAAA,EAAD,CACEnJ,aAAW,eACXiE,cAAA,uBAA6BuT,EAAO1lB,MACpC+S,QAAS,kBAAMgL,GAAc,KAE7B,kBAAC,IAAD,OAGF,kBAACwH,EAAD,MAEF,kBAACvP,EAAA,EAAD,KAAa0P,EAAO1lB,OAEtB,kBAAC4c,EAAA,EAAD,CAAQxJ,KAAM0K,EAAYvJ,QAAS,kBAAMwJ,GAAc,KACrD,kBAAClB,EAAA,EAAD,KACE,kBAACxF,EAAA,EAAD,CACExI,UAAWU,EAAQ8V,YACnBnX,aAAW,eACX6E,QAAS,kBAAMgL,GAAc,KAE7B,kBAAC,IAAD,QAGJ,yBAAKlP,UAAWU,EAAQ+V,iBACtB,oCACE,kBAACtP,EAAA,EAAD,+CAC0C0P,EAAO1lB,KADjD,KAGA,6BACA,yBAAK+N,MAAO,CAAEwF,QAAS,OAAQ6S,eAAgB,WAC7C,kBAACpS,EAAA,EAAD,CACEhZ,QAAQ,YACR0Q,MAAM,UACNqH,QAAS,WACPgL,GAAc,GAEd1lB,OAAO0e,YAAW,WACZmP,EACFD,EAAQI,aAAaX,EAAO1lB,MACnBsmB,sCAA4BtV,IACrCA,EAAQuV,oBAAoBb,EAAO1lB,QAEpC,OAZP,mBCnDCM,0BAlCf,YAMG,IALD4S,EAKC,EALDA,cACAlb,EAIC,EAJDA,MAKQwuB,EAAYtT,EAAZsT,QAEFC,EAAcD,EACjBE,QAAO,SAAAX,GAAC,uBAAI7S,EAAcyT,eAAeZ,EAAE/lB,aAAnC,aAAI,EAAsC4mB,UAClDjmB,KAAI,SAAAolB,GAAC,OAAIA,EAAE/lB,QAER6mB,EAAkBL,EAAQE,QAC9B,SAAAhB,GAAM,OAAKe,EAAYK,SAASpB,EAAO1lB,SAGzC,OACE,kBAAC+mB,EAAA,EAAD,KACGF,EAAgB1rB,OACf0rB,EACGH,QAAO,SAAAhB,GAAM,OACZA,EAAO1lB,KAAKgnB,cAAcF,SAAS9uB,EAAMivB,WAAWD,kBAErDrmB,KAAI,SAAA+kB,GAAM,OACT,kBAAC,EAAD,CAAiB9qB,IAAK8qB,EAAO1lB,KAAM0lB,OAAQA,EAAQ1tB,MAAOA,OAG9D,kBAACge,EAAA,EAAD,2C,gGClBF5H,EAAYC,aAAW,iBAAO,CAClC6Y,KAAM,CACJ/c,OAAQ,OAEViI,KAAM,CACJ+U,WAAY,QACZ1B,YAAa,SAEf2B,KAAM,CACJC,WAAY,KAEdC,UAAW,CACT/T,QAAS,OACTgU,WAAY,SACZpd,OAAQ,iBAkEG7J,0BA9Df,YAQG,IAPDolB,EAOC,EAPDA,OACA1tB,EAMC,EANDA,MACAkuB,EAKC,EALDA,UAMM3W,EAAUnB,IACV4C,EAAU8O,qBAAW9nB,GAErBwvB,EADoBjV,iBAAOva,GAAzBkb,cAC0BuU,UAAd,UAA2B/B,EAAO1lB,KAAlC,WAJnB,EAKuCkP,oBAAS,GALhD,mBAKMwY,EALN,KAKoBC,EALpB,KAMKC,EAAgBJ,GAAeE,EAG7BzB,EADUjiB,oBAAUhM,EAAO,GAC3BiuB,QAER,OACE,kBAAC4B,EAAA,EAAD,CAAM7sB,QAAQ,WAAWJ,IAAK8qB,EAAO1lB,KAAM6O,UAAWU,EAAQ2X,MAC5D,kBAACY,EAAA,EAAD,KACE,yBAAKjZ,UAAWU,EAAQ+X,WACtB,kBAACtR,EAAA,EAAD,CAAYhb,QAAQ,MAClB,kBAAC+sB,EAAA,EAAD,CACEC,KAAI,UAAKtC,EAAOzgB,SAAZ,WACJqR,OAAO,SACP2R,IAAI,YAEHvC,EAAO1lB,QAId,yBAAK6O,UAAWU,EAAQ+X,WACtB,kBAAC,IAAD,CAAYvZ,MAAO,CAAE0X,YAAa,WAClC,kBAACzP,EAAA,EAAD,KAAa0P,EAAOwC,QAAQxO,KAAK,QAEnC,kBAAC1D,EAAA,EAAD,CAAYnH,UAAWU,EAAQ6X,MAA/B,gBACA,kBAACpR,EAAA,EAAD,KAAa0P,EAAOrd,cAEtB,kBAAC8f,EAAA,EAAD,KACE,kBAACnU,EAAA,EAAD,CACEhZ,QAAQ,YACR0Q,MAAM,UACN0c,SAAUR,EACVS,UAAWb,EAAc,kBAAC,IAAD,MAAgB,kBAAC,IAAD,MACzCzU,QAAS,WACHmT,EACFD,EAAQqC,UAAU,CAAEtoB,KAAM0lB,EAAO1lB,KAAMuoB,IAAK7C,EAAO6C,MAC1CjC,sCAA4BtV,IACrCA,EAAQwX,iBAAiB9C,GAE3BiC,GAAgB,KAGjBH,EAAc,YAAc,gB,iBChFjCpZ,GAAYC,aAAW,iBAAO,CAClCgX,YAAa,CACX5nB,SAAU,WACVrB,MAAO,EACPyU,IAAK,GAEPyU,gBAAiB,CACfnb,OAAQ,GACRoJ,QAAS,OACTkV,cAAe,cA6EJnoB,2BAzEf,YAQG,IAPD8S,EAOC,EAPDA,KACAmB,EAMC,EANDA,QACAvc,EAKC,EALDA,MAMMuX,EAAUnB,KADf,EAEiCc,mBAAS,CACzClP,KAAM,GACNuoB,IAAK,KAJN,mBAEMG,EAFN,KAEiBC,EAFjB,KAOK/V,EAAe,SAAClD,GACpBiZ,EAAa,2BACRD,GADO,kBAEThZ,EAAM4G,OAAOtW,KAAO0P,EAAM4G,OAAOzX,UAK9BonB,EADU2C,kBAAQ5wB,GAClBiuB,QAMR,OACE,kBAACrJ,EAAA,EAAD,CAAQxJ,KAAMA,EAAMmB,QAAS,kBAAMA,GAAQ,KACzC,kBAACsI,EAAA,EAAD,KACE,kBAACxF,EAAA,EAAD,CACExI,UAAWU,EAAQ8V,YACnBnX,aAAW,eACX6E,QAAS,kBAAMwB,GAAQ,KAEvB,kBAAC,IAAD,QAIJ,yBAAK1F,UAAWU,EAAQ+V,iBACtB,kBAACuD,EAAA,EAAD,CACE3sB,GAAG,aACH8D,KAAK,OACL8oB,MAAM,cACN9tB,QAAQ,WACR6D,MAAO6pB,EAAU1oB,KACjB0S,SAAUE,EACVmW,WAAS,IAEX,kBAACF,EAAA,EAAD,CACE3sB,GAAG,YACH8D,KAAK,MACL8oB,MAAM,aACN9tB,QAAQ,WACR6D,MAAO6pB,EAAUH,IACjB7V,SAAUE,EACVmW,WAAS,IAEX,kBAAC/U,EAAA,EAAD,CACEhZ,QAAQ,YACR0Q,MAAM,UACNqC,MAAO,CAAEgM,UAAW,UACpBhH,QAvCa,WACnBkT,EAAQqC,UAAU,CAAEtoB,KAAM0oB,EAAU1oB,KAAMuoB,IAAKG,EAAUH,QAkCrD,mBC5DFna,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrC8b,UAAW,CACTjP,UAAW,OAEbkP,WAAY,CACVvd,MAAO,QAETwd,UAAW,CACTC,aAAcjc,EAAMJ,QAAQ,IAE9Bsc,WAAY,CACVjf,OAAQ,QACR4K,aAAc,EAEdnJ,gBAAiB,UACjB3T,QAAS,MACTsb,QAAS,OACT8V,aAAc,UAEhBC,mBAAoB,CAClBnf,OAAQ,QACRoJ,QAAS,OACT6S,eAAgB,cAoHL9lB,8BAhHf,YAAmE,IAAtCtI,EAAsC,EAAtCA,MACrBuX,EAAUnB,KADiD,EAE3Bc,mBAAS,IAFkB,mBAE1Dqa,EAF0D,KAE7CC,EAF6C,OAGTta,oBAAS,GAHA,mBAG1Dua,EAH0D,KAGpCC,EAHoC,KAIzDxD,EAAcpG,qBAAW9nB,GAAzBkuB,UACAhT,EAAkBX,iBAAOva,GAAzBkb,cAuBR,OArBA1D,qBAAU,WACR,IAAIma,GAAS,EAeb,OAbC,sBAAC,8BAAApsB,EAAA,sEAC0BqsB,MACxB,iDAFF,WACMC,EADN,QAIiBC,GAJjB,sBAKQ,IAAI1sB,MAAM,+BALlB,uBAOoBysB,EAAYE,OAPhC,OAOMC,EAPN,OAQKL,GACHH,EAAeQ,EAAMxD,SATvB,0CAAD,GAaM,WACLmD,GAAS,KAEV,IAGD,6BACGzD,GACC,qCACI+D,cACA,yBAAKpb,UAAWU,EAAQ6Z,YACtB,kBAAC,IAAD,CAAkBrb,MAAO,CAAE0X,YAAa,WACxC,kBAACzP,EAAA,EAAD,0BACoB,8CADpB,gJAOJ,yBAAKnH,UAAWU,EAAQ+Z,oBACtB,kBAACtV,EAAA,EAAD,CACEhZ,QAAQ,YACR0Q,MAAM,UACNqH,QAAS,kBAAM2W,GAAwB,KAHzC,sBAQF,kBAAC,GAAD,CACEtW,KAAMqW,EACNlV,QAASmV,EACT1xB,MAAOA,KAIb,kBAAC6wB,EAAA,EAAD,CACEha,UAAWU,EAAQ2Z,UACnBJ,MAAM,iBACNjqB,MAAO7G,EAAMivB,WACbvU,SAAU,SAAAhD,GAAK,OAAI1X,EAAMkyB,cAAcxa,EAAM4G,OAAOzX,QACpDsrB,WAAS,EACTC,WAAY,CACVC,aACE,kBAACC,EAAA,EAAD,CAAgB7sB,SAAS,OACvB,kBAAC4Z,EAAA,EAAD,CACE3L,MAAM,YACNqH,QAAS,kBAAM/a,EAAMuyB,oBAErB,kBAAC,IAAD,WAMV,kBAACC,EAAA,EAAD,CAAWC,iBAAe,GACxB,kBAACC,EAAA,EAAD,CACEzB,WAAY,kBAAC,IAAD,CAAgBpa,UAAWU,EAAQ0Z,cAE/C,kBAACjT,EAAA,EAAD,CAAYhb,QAAQ,MAApB,sBAEF,yBAAK+S,MAAO,CAAE5D,OAAQ,QACpB,kBAAC,EAAD,CAAsB+I,cAAeA,EAAelb,MAAOA,MAG/D,kBAACwyB,EAAA,EAAD,CAAWC,iBAAe,GACxB,kBAACC,EAAA,EAAD,CACEzB,WAAY,kBAAC,IAAD,CAAgBpa,UAAWU,EAAQ0Z,cAE/C,kBAACjT,EAAA,EAAD,CAAYhb,QAAQ,MAApB,sBAEDuuB,EACE7C,QAAO,SAAChB,GACP,OAAOA,EAAO1lB,KACXgnB,cACAF,SAAS9uB,EAAMivB,WAAWD,kBAE9BrmB,KAAI,SAAA+kB,GAAM,OACT,kBAAC,EAAD,CACE9qB,IAAM8qB,EAAyB1lB,KAC/B0lB,OAAQA,EACR1tB,MAAOA,EACPkuB,YAAaA,a,w3DC9ErByE,GAAO,CACXC,OACA,kBAAmBC,EACnBC,MAAO5V,IACP,YAAa6V,EACb,aAAcC,EACd,aAAcxpB,IAGd,oBAAqBypB,EAErB,4BAA6BC,IAC7B,0BAA2BC,EAE3B,mBAAoBC,EACpB,yBAA0BC,EAG1B,2BAA4BC,EAC5B,2BAA4BC,EAC5B,wBAAyBC,IACzB,2BAA4BC,IAC5B,gCAAiCC,IACjC,yBAA0BC,IAC1B,gCAAiCC,IACjC,8BAA+BC,IAC/B,6BAA8BC,IAC9B,2BAA4BC,IAC5B,8BAA+BC,IAC/B,8BAA+BC,IAC/B,gCAAiCC,IACjC,qCAAsCC,IACtC,yBAA0BC,IAC1B,yBAA0BC,IAC1B,+BAAgCC,IAChC,mCAAoCC,IACpC,mCAAoCC,IACpC,iCAAkCC,IAClC,iCAAkCC,IAClC,yBAA0BC,IAC1B,6BAA8BC,IAC9B,+BAAgCC,IAChC,0BAA2BC,IAC3B,2BAA4BC,IAC5B,6BAA8BC,IAC9B,oCAAqCC,IACrC,8BAA+BC,IAC/B,4BAA6BC,IAC7B,+BAAgCC,IAGhC,gCAAiCC,IACjC,qCAAsCC,IAEtC,uBAAwBlI,KACxB,+CAAgDmI,IAChD,kDAAmDzJ,IACnD,kDAAmDvE,KACnD,gDAAiDgF,KACjD,iDAAkDQ,KAElD,6CAA8CyI,GAC9C,uEAAwEC,KACxE,0EAA2EryB,KAC3E,gEAAiEsyB,KACjE,8BAA+BC,GAC/B,+BAAgCC,GAChC,mBAAoBC,GACpB,qBAAsBC,GACtB,2BAA4BC,GAC5B,4BAA6BC,GAC7B,qCAAsCC,IACtC,wBAAyBC,GACzB,oCAAqCC,GACrC,0BAA2BC,GAC3B,oDAAqDC,EAErD,0CAA2CC,GC7J9B,CACb,OACA,kBACA,QACA,YACA,aACA,aAEA,oBACA,4BACA,0BACA,mBACA,yBAEA,uBACA,+CACA,kDACA,kDACA,gDACA,iDAEA,6CACA,uEACA,0EACA,gEACA,8BACA,+BACA,mBACA,qBACA,2BACA,4BACA,qCACA,wBACA,oCACA,0BACA,oDAEA,2CD6HYj1B,SAAQ,SAAA2G,GACpB,KAAMA,KAAQ2qB,IACZ,MAAM,IAAIvtB,MAAJ,uCAA0C4C,OAIrC2qB,UEtKA4D,Q,uFCIenJ,E,iDACnBplB,U,OAETuoB,S,OAEAiG,a,OAMAC,yBAA8DzyB,E,2CAJ9D,SAAQ0yB,M,uBAER,SAAUA,Q,8dC6BZ,SAASC,EAAQ3S,GAEf,IAFmC,IAAT9f,EAAS,uDAAJ,GACzBuC,EAAOkB,OAAOlB,KAAKud,GAChB4S,EAAI,EAAGA,EAAInwB,EAAKtD,OAAQyzB,IAAK,CACpC,IAAMh0B,EAAM6D,EAAKmwB,GACjB,GAAI1yB,EAAGf,OAAS,IACd,MAEuB,kBAAd6gB,EAAKphB,IAAqBohB,EAAKphB,GACxCsB,GAAMyyB,EAAQ3S,EAAKphB,GAAMsB,GAEzBA,GAAM,GAAJ,OAAOtB,EAAP,YAAcohB,EAAKphB,GAAnB,KAGN,OAAOi0B,mBAAS3yB,GAGX,IAAe4yB,EASpB,aAGE,IAFA9vB,EAEA,uDAFgCuf,YAAoB,QAAS,IAAIwQ,SACjEC,EACA,uCAKA,GALA,yBAXK9yB,QAWL,OAPF8C,YAOE,OALFgwB,mBAKE,EACApzB,KAAKoD,OAASA,EACdpD,KAAKozB,cAAgBA,EAGD,qBAATC,KAAsB,CAC/B,IAAM3yB,EAAO4yB,0BAAgBlwB,GAAU4mB,sBAAY5mB,GAAUA,EAC7DpD,KAAKM,GAAL,UAAayyB,EAAQryB,SAErBV,KAAKM,GAAK,QArBM4yB,EAGb9tB,aAAe,GAkCjB,IAAeD,EAAtB,sMA6CE,WAAuBouB,GAAvB,0FACS,MADT,2CA7CF,uHAqDE,WAAyBA,GAAzB,0FACS,MADT,2CArDF,wFA6DE,SAA2B71B,GAAwC,WAAxBgG,EAAwB,uDAAJ,GAC7D,OAAOe,2BAAgB,uCAAU,WAAMC,GAAN,eAAA/C,EAAA,sEACT,EAAK6xB,kBAAkB91B,EAAOG,QAAS6F,GAD9B,OACzB+vB,EADyB,OAE/BC,2BAAiBhwB,EAAKa,QACjBkvB,EAIH,EAAKE,YAAYj2B,EAAQgG,GACtBmB,KAAK+uB,YAAUC,6BAAmBnwB,EAAKa,UACvCW,UAAUR,GAJbA,EAASovB,WALoB,2CAAV,yDA9D3B,0CA2FE,SACE9M,GAEA,WADAtjB,EACA,uDADoB,GAEdqwB,EAAMC,IAAK,WAAL,cACPhN,EAAQjiB,KAAI,SAAArH,GACb,OAAO+G,2BAAgB,uCAAU,WAAMC,GAAN,eAAA/C,EAAA,sEACT,EAAK6xB,kBAAkB91B,EAAOG,QAAS6F,GAD9B,OACzB+vB,EADyB,OAE/BC,2BAAiBhwB,EAAKa,QACjBkvB,EAIH,EAAKE,YAAYj2B,EAAQgG,GAAMwB,UAAUR,GAFzCA,EAASovB,WALoB,2CAAV,4DAa3B,OAAIpwB,EAAKa,OACAwvB,EAAIlvB,KAAK+uB,YAAUC,6BAAmBnwB,EAAKa,UAE7CwvB,IAjHX,sEAyHE,WAA+Bl2B,GAA/B,4FAAgD6F,EAAhD,+BAAoE,GAApE,SACyB1D,KAAKi0B,YAAYvwB,GAD1C,cACQwwB,EADR,yBAESA,EAAShJ,SAASrtB,IAF3B,gDAzHF,0HA8HE,WAA4BH,EAAgBgG,GAA5C,8EACQywB,EAAQn0B,KAAK2zB,YAAYj2B,EAAQgG,GADzC,kBAES0wB,YAAc12B,EAAQy2B,IAF/B,gDA9HF,iIAmIE,0HAAiCnN,EAAjC,+BAAqD,GAAItjB,EAAzD,uBACOsjB,EAAQznB,OADf,yCAEW80B,eAFX,uBAIsBC,QAAQC,IAC1BvN,EAAQjiB,KAAI,SAAArH,GAAM,OAAI,EAAK82B,eAAe92B,EAAQgG,OALtD,cAIQywB,EAJR,OAQQM,EAAWN,EACdpvB,KAAI,SAAA2vB,GAAC,OAAIA,EAAED,YACXE,QAAO,SAACC,EAAKC,GAAN,OAAez3B,KAAKuB,IAAIi2B,EAAKC,MACjCC,EAAWX,EACdpvB,KAAI,SAAA2vB,GAAC,OAAIA,EAAEI,YACXH,QAAO,SAACC,EAAKC,GAAN,OAAez3B,KAAKwB,IAAIg2B,EAAKC,MACjCE,EAAWZ,EAAMpvB,KAAI,SAAA2vB,GAAC,OAAIA,EAAEK,YAAUJ,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,GAC9DC,EAAkBd,EACrBpvB,KAAI,SAAA2vB,GAAC,OAAIA,EAAEO,mBACXN,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,GACrBE,EAAef,EAClBpvB,KAAI,SAAA2vB,GAAC,OAAIA,EAAEQ,gBACXP,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,GACrBG,EAAehB,EAClBpvB,KAAI,SAAA2vB,GAAC,OAAIA,EAAES,gBACXR,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,GAvB7B,kBAyBS3wB,YAAa,CAClBywB,WACAL,WACAS,eACAC,eACAF,kBACAF,cA/BJ,4CAnIF,2DAAqD7B,GA+K9C,SAASkC,EACdC,GAEA,MAAO,eAAgBA,GAAS,gBAAiBA,EAG5C,SAASC,EACdD,GAEA,MAAO,eAAgBA,EAGlB,SAASE,EACdF,GAEA,MAAO,gBAAiBA,EAUnB,SAASG,EACdH,GAEA,MAAO,sBAAuBA,I,mOClShC,SAASI,EAAS9I,GAA6D,IAA3CjpB,EAA2C,uDAAvB,GACtD,OAAOsqB,MAAMrB,EAAD,aACV+I,OAAQ,MACRC,YAAa,eASVjyB,I,4CAIP,WACEipB,EACA5uB,EACAE,GAHF,iDAAA0D,EAAA,6DAIEi0B,EAJF,+BAI6D,GAErDC,EAAc,IAAIvsB,KAClBwsB,EAPR,2BAO8BF,EAAQG,SAPtC,IAO+CC,MAAO,SAAF,OAAWj4B,EAAX,YAAoBE,KAPxE,SAQoBw3B,EAAS9I,EAAD,YAAC,eACtBiJ,GADqB,IAExBG,QAASD,KAVb,UAQQ9zB,EARR,OAiBQi0B,EAAe,IAAI3sB,KACN,MAAftH,EAAIk0B,QAAiC,MAAfl0B,EAAIk0B,OAlBhC,sBAmBU,IAAI10B,MAAJ,eACIQ,EAAIk0B,OADR,0BACgCvJ,EADhC,kBAC6C5uB,EAD7C,YACsDE,IApBhE,OA2BQ83B,EAA+B,GA3BvC,cA4BuB/zB,EAAI+zB,QAAQh1B,WA5BnC,IA4BE,2BAA4C,yBAAhCmC,EAAgC,KAA7BizB,EAA6B,KAC1CJ,EAAQ7yB,GAAKizB,EA7BjB,iCAgCqB,MAAfn0B,EAAIk0B,OAhCV,uBAiCU,IAAI10B,MAAJ,eACIQ,EAAIk0B,OADR,0BACgCvJ,EADhC,kBAC6C5uB,EAD7C,YACsDE,IAlChE,yBAuC4B+D,EAAIo0B,cAvChC,eAuCQA,EAvCR,yBAwCS,CACLL,UACAF,cACAI,eACAv0B,OAAQO,SAAOC,KAAKk0B,KA5CxB,6C,sBAgDA,IAAMC,EAAmB,IAAIC,mBAAiB,CAC5CtI,M,gDACA3f,KAAM,SACNkoB,UAAW,KAAF,IAAE,EAAK,IAChBC,aAAc,UACdC,WAAY,M,SAGCC,E,gFAAf,WACE/J,EACAjpB,GAFF,qCAAA/B,EAAA,0DAKQm0B,EAAiBpyB,GAAQA,EAAKqyB,WAG9BD,aAA0Ba,QAC5BX,EAAQF,EAAe31B,IAAI,SAClB8W,MAAM2f,QAAQd,IAAiB,EAC3BA,EAAee,MAAK,kBAAmB,UAAnB,wBAA+B,MAC9Dz2B,OACAA,GAHsC,mBACpC41B,EADoC,MAMxCA,EAAQF,EAAeE,QAGvBA,EAnBN,sBAoBUc,EAAa,oBAAoBC,KAAKf,IApBhD,sCAsB6Bc,EAtB7B,GAsBe/4B,EAtBf,KAsBsBE,EAtBtB,KAuBYy2B,EAAI9O,SAAS7nB,EAAO,IACpBi5B,EAAIpR,SAAS3nB,EAAK,IAxB9B,UAyB8Bo4B,EAAiBY,SAAStK,EAAK+H,EAAGsC,EAAItC,EAAI,EAAG,CACnEnwB,OAAQb,GAAQA,EAAKa,SA1B7B,eAyBY2yB,EAzBZ,OA4BcnB,EAAYmB,EAAZnB,QA5Bd,kBA6Ba,IAAIoB,SAASD,EAASx1B,OAAQ,CAAEw0B,OAAQ,IAAKH,aA7B1D,iCAiCSN,EAAS9I,EAAKjpB,IAjCvB,6C,mCC5DM2qB,EAAa,YAAY9jB,KACR,qBAAd6sB,UAA4BA,UAAUC,UAAY,IAG9CC,EAAU,SAACC,GACtB,OAAOlJ,EAAa,IAAImJ,IAAmBD,ID8FrB5K,EC9FgD4K,ED+F/D,IAAIE,aAAWvQ,OAAOyF,GAAM,CACjCqB,MAAO0I,KAFJ,IAAiB/J,GC3FxB,SAAS+K,EAAcruB,GACrB,MAAO,QAASA,EAGlB,SAASsuB,EACPtuB,GAEA,MAAO,cAAeA,EAOjB,SAAS7F,EAAa6F,GAC3B,IAAKA,EACH,MAAM,IAAI7H,MAAM,2CAElB,GAAI6sB,EAAY,CACd,GAAIqJ,EAAcruB,GAChB,OAAO,IAAImuB,IAAmBnuB,EAASjC,KAEzC,GAAIuwB,EAAoBtuB,GACtB,OAAO,IAAIlI,IAAkBkI,EAASrC,eAEnC,CACL,GAAI0wB,EAAcruB,GAChB,OAAOiuB,EACLjuB,EAAShC,QACL,IAAIuwB,IAAIvuB,EAASjC,IAAKiC,EAAShC,SAAS+kB,KACxC/iB,EAASjC,KAGjB,GAAIuwB,EAAoBtuB,GACtB,OAAO,IAAIwuB,YAAUxuB,EAASrC,WAGlC,GA3BF,SAAwBqC,GACtB,MAAO,WAAYA,EA0BfyuB,CAAezuB,GAAW,CAE5B,IAAMG,EAAOP,kBAAQI,EAASnC,QAC9B,IAAKsC,EACH,MAAM,IAAIhI,MAAJ,iBACM6H,EAASjF,KADf,2GAIR,OAAO,IAAI2zB,WAASvuB,GAEtB,MAAM,IAAIhI,MAAM,0B,qXC3ELw2B,EAAgCrV,8BAC3C,oBACA,CACEsV,oBAAqB,CACnBztB,KAAM,SACNiC,YAAa,gDACb+a,aAAc0Q,OAAOC,YAGzB,CAAEC,mBAAoB,c,wOCMlB5lB,EAAYC,YAAW,CAC3B4lB,aAAc,CACZvf,WAAY,SACZwf,UAAW,OACXz2B,SAAU,WACVuO,UAAW,OACXuH,QAAS,QAEX4gB,iBAAkB,CAChB12B,SAAU,WACViO,MAAO,gBACP0oB,aAAc,0BACdC,WAAY,oBACZ3f,WAAY,SACZtc,MAAO,OACPivB,WAAY,OACZ6M,UAAW,SACXzjB,OAAQ,IACR6jB,UAAW,gBAGTC,EAAiBj0B,oBACrB,YAAkD,IAA/CtI,EAA+C,EAA/CA,MACKuX,EAAUnB,IACR+Q,EAAiCnnB,EAAjCmnB,iBAAkBqV,EAAex8B,EAAfw8B,WAC1B,OACE,oCACGrV,EAAiBxe,KAAI,SAAAwY,GACpB,GAAIA,aAAiBje,IAAc,CACjC,IAAMu5B,EAAQD,EAAWz4B,IAAIod,EAAMve,KAEnC,OACE,kBAAC,IAAD,CACEue,MAAOA,EACPve,IAAG,UAAK5C,EAAMkE,GAAX,YAAiBid,EAAMve,MAEzB65B,GAASA,EAAMxhB,eACd,kBAACwhB,EAAMxhB,eAAP,CAAsBjb,MAAOy8B,IAC3B,KACHA,GAASA,EAAMC,iBACd,yBACE7lB,UAAWU,EAAQ4kB,iBACnBpmB,MAAO,CACL8C,IAAK4jB,EAAMh4B,OAAOk4B,iBAAmB,GACrCxX,cAAe,OACf9gB,OAAQ,KALZ,sBAUE,MAIV,GAAI8c,aAAiBle,IACnB,OACE,kBAAC,IAAD,CACEL,IAAG,UAAK5C,EAAMkE,GAAX,YAAiBid,EAAMve,KAC1BxC,MAAO+gB,EAAMxe,UAInB,GAAIwe,aAAiBpe,IACnB,OACE,kBAAC,IAAD,CACEH,IAAKue,EAAMve,IACXxC,MAAO+gB,EAAMxe,QACboT,MAAO,CAAEhC,WAAY,QACrB6oB,SAA4B,aAAlBzb,EAAMne,UAItB,MAAM,IAAIoC,MAAJ,oCAAuC+b,WA6BxC7Y,0BAvBf,YAAoE,IAA5CtI,EAA4C,EAA5CA,MAChBuX,EAAUnB,IACR+Q,EAAqBnnB,EAArBmnB,iBAEF0V,EAAYpW,4BAAkBzmB,GACpC,OACE,yBACEma,cAAY,WACZtD,UAAWU,EAAQ0kB,aACnBlmB,MAAO,CACL5R,KAAMgjB,EAAiB5mB,SAAWs8B,EAAUt8B,WAG9C,kBAACg8B,EAAD,CAAgBv8B,MAAOA,QCnGvBoW,EAAYC,YAAW,CAC3BkF,QAAS,CACP9V,SAAU,WACViX,WAAY,SACZwf,UAAW,OACX97B,MAAO,OACP4T,UAAW,UAGTwZ,EAAUllB,oBACd,SAACyM,GAA2E,IAClE/U,EAAsB+U,EAAtB/U,MAAO88B,EAAe/nB,EAAf+nB,WACPC,EAAsB/8B,EAAtB+8B,kBACFC,EAAYD,EACd3U,kBAAQpoB,EAAO,YAAa,CAAEslB,QAASyX,SACvC/4B,EACJ,OAAOg5B,EACL,kBAAC,IAAD,CAAY1b,MAAO0b,EAAW5hB,MAAI,EAAC6hB,UAAU,SAC3C,yBACElnB,MAAO,CACLtQ,SAAU,WACVtB,KAAM24B,EAAW,GACjBjkB,IAAKikB,EAAW,KAGjB,MAGH,QAqFOI,EAhFW50B,oBACxB,SAACyM,GACC,IAAMwC,EAAUnB,IACVlB,EAAQ8E,cAF0D,EAIpC9C,mBAAgB,CAAC,EAAG,IAJgB,mBAIjE4lB,EAJiE,KAIrDK,EAJqD,OAKhCjmB,qBALgC,mBAKjEkmB,EALiE,KAKnDC,EALmD,KAMlEpjB,EAAM3C,iBAAuB,MAC3BtX,EAAoB+U,EAApB/U,MAAO+Y,EAAahE,EAAbgE,SAEbukB,EAKEt9B,EALFs9B,iBACAC,EAIEv9B,EAJFu9B,wBACAC,EAGEx9B,EAHFw9B,iBACAn5B,EAEErE,EAFFqE,OACAo5B,EACEz9B,EADFy9B,sBAGF,OACE,yBACExjB,IAAKA,EACLE,cAAA,kBAAwBiO,kBAAQpoB,EAAO,cACvC6W,UAAWU,EAAQgE,QACnBmiB,cAAe,SAAAhmB,GACbA,EAAMC,iBACFylB,EAEFC,OAAgBr5B,GACPiW,EAAIpC,SACbwlB,EAAgB,CAAC3lB,EAAMimB,QAASjmB,EAAMkmB,WAG1CC,YAAa,SAAAnmB,GACX,GAAIuC,EAAIpC,QAAS,CACf,IAAMimB,EAAO7jB,EAAIpC,QAAQkmB,wBACzBZ,EAAc,CAACzlB,EAAMimB,QAAUG,EAAK35B,KAAMuT,EAAMkmB,QAAUE,EAAKjlB,QAGnER,KAAK,gBAEJklB,EACC,kBAACA,EAAD,CAAyBv9B,MAAOA,IAEhC,kBAAC,EAAiB+U,GAEnBgE,EACD,kBAACukB,EAAD,CACEt9B,MAAOA,EACPqE,OAAQA,EACRy4B,WAAYA,IAGd,kBAAC,OAAD,CACE1hB,KAAMC,QAAQ+hB,IAAiB/hB,QAAQmiB,EAAiBr6B,QACxDiZ,gBAAiB,SAAC4hB,EAAG1hB,GACnBA,IACA+gB,OAAgBr5B,IAElBuY,QAAS,WACP8gB,OAAgBr5B,GAChBy5B,OAAsBz5B,IAExBi6B,OAAQ,WACNZ,OAAgBr5B,GAChBy5B,OAAsBz5B,IAExBk6B,gBAAgB,iBAChBC,eACEf,EACI,CAAEvkB,IAAKukB,EAAa,GAAIj5B,KAAMi5B,EAAa,SAC3Cp5B,EAEN+R,MAAO,CAAE0C,OAAQvD,EAAMuD,OAAO2lB,SAC9BxiB,UAAW4hB,EACXrjB,cAAY,yC,4BC1GhB/D,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCmpB,QAAS,CACP1pB,YAAa,QACbf,gBAAiBsB,EAAMjE,QAAQwK,OAAO6iB,mBACtCC,gBACE,sHACFl6B,OAAQ,OACRjE,MAAO,OACP+kB,cAAe,OACf+W,UAAW,UAEbsC,aAAc,CACZp+B,MAAO,OACP2T,WAAYmB,EAAMjE,QAAQwK,OAAO6iB,mBACjCr+B,QAASiV,EAAMJ,QAAQ,GACvBqQ,cAAe,OACf+W,UAAW,UAEbuC,WAAY,CACVx+B,QAASiV,EAAMJ,QAAQ,GACvB1U,MAAO,OACPsc,WAAY,SACZhJ,MAAOwB,EAAMjE,QAAQkV,MAAMrV,KAC3B0H,UAAW,QAEbkmB,sBAAuB,CACrBt+B,MAAO,OACP2T,WAAYmB,EAAMjE,QAAQwK,OAAO6iB,mBACjCr+B,QAASiV,EAAMJ,QAAQ,GACvBonB,UAAW,UAEbyC,KAAM,CACJ,WAAY,CACVpjB,QAAS,eACTqjB,UAAW,0BACX1qB,QAAS,MACT9T,MAAO,MACP87B,UAAW,SAGf,sBAAuB,CACrB,KAAM,CACJhoB,QAAS,OAEX,MAAO,CACLA,QAAS,QAEX,MAAO,CACLA,QAAS,cAKf,SAAS2qB,GAAT,GAA+D,IAA3C9lB,EAA2C,EAA3CA,SAClB,OACE,yBAAKhD,MAAO,CAAEwF,QAAS,SACpBxC,EACAA,GAMP,IAAM+lB,GAAiBx2B,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MAA4B,EAEnCkX,oBAAS,GAF0B,mBAEtDsO,EAFsD,KAE/CC,EAF+C,KAGvDlO,EAAUnB,KAChBoB,qBAAU,WACR,IAAIma,GAAS,EACPpM,EAAUxG,YAAW,WACpB4S,GACHlM,GAAS,KAEV,KACH,OAAO,WACLzG,aAAauG,GACboM,GAAS,KAEV,IAf0D,IAiB7CoN,EAAgB/+B,EAAxB85B,OAEFA,EAD6B9tB,oBAAUhM,EAAO,GAA5Ckf,SACwB6f,EAChC,OACE,oCACGvZ,EACC,yBAAK3O,UAAWU,EAAQ8mB,SACtB,yBAAKxnB,UAAWU,EAAQonB,MAAO7E,EAAS,GAAH,OAAMA,GAAW,YAEtD,SAKV,SAASkF,GAAT,GAIG,IAHDC,EAGC,EAHDA,eAIM1nB,EAAUnB,KAEhB,MAAiC,kBAAnB6oB,EACZ,kBAACjhB,EAAA,EAAD,CAAYhb,QAAQ,QAAQ6T,UAAWU,EAAQinB,cAC5CS,GAGH,yBAAKpoB,UAAWU,EAAQmnB,uBAAwBO,GAIpD,SAASC,GAAT,GAQG,IAPD/Y,EAOC,EAPDA,MACAE,EAMC,EANDA,OACA8Y,EAKC,EALDA,cAMM5nB,EAAUnB,KAChB,OACE,yBAAKS,UAAWU,EAAQknB,WAAY1oB,MAAO,CAAE1R,OAAQ86B,IAClD9Y,EACC,oCACE,kBAACrK,EAAA,EAAD,CACE7B,cAAY,gBACZY,QAASsL,EACTgK,UAAW,kBAAC,IAAD,OAHb,UADF,UAQMlK,IAGN,kBAACnI,EAAA,EAAD,CAAYtK,MAAM,QAAQ1Q,QAAQ,SAAlC,UACMmjB,KAOd,IAoCeiZ,GApCwB92B,oBACrC,YAKM,IAJJtI,EAII,EAJJA,MAKA,OAAIA,EAAMmmB,MAEN,kBAAC0Y,GAAD,KACE,kBAACK,GAAD,CACE/Y,MAAOnmB,EAAMmmB,MACbE,OAAQrmB,EAAMqmB,OACd8Y,cAAe5yB,+BAAqBvM,GAAOgnB,aAAa3iB,UAK5DrE,EAAMkf,QAEN,kBAAC2f,GAAD,KACE,kBAACG,GAAD,CAAcC,eAAgBj/B,EAAMkf,WAIrClf,EAAMq/B,OAOJr/B,EAAMs/B,aALT,kBAACT,GAAD,KACE,kBAACC,GAAD,CAAgB9+B,MAAOA,QCAlBw8B,GA7JIrzB,QAChBnJ,MAAM,aAAc,CACnB4C,IAAKuG,QAAMS,OACXtI,OAAQmI,SACRpH,4BAA4B,EAC5BC,6BAA6B,IAG9Bi9B,UAAS,iBAAO,CACfC,sBAAkBx7B,EAClBq7B,QAAQ,EACRC,kBAAct7B,EACdymB,cAAUzmB,EACVS,YAAQT,EACR81B,OAAQ,GACR3T,WAAOniB,EACPkb,aAASlb,EACT04B,kBAAkB,EAClBzhB,eAAgBmkB,GAChB3yB,iBAAazI,MAEdsG,SAAQ,SAAAC,GACP,IAAIi1B,EACJ,MAAO,CACLC,YADK,WAEH,IAAMlkB,EAAUmkB,+BAAqBn1B,GACrCo1B,gCACEp1B,EACAq1B,GACAC,GACA,CACE73B,KAAM,GAAF,OAAKuT,EAAQrX,GAAb,YAAmBrB,4BAAkB0H,EAAKjJ,QAA1C,cACJw+B,MAAOvkB,EAAQwkB,YACfC,iBAAiB,GAEnBp8B,KAAKq8B,WACLr8B,KAAKs8B,YACLt8B,KAAKu8B,WAGTC,UAjBK,SAiBKlhB,GACR3U,EAAKuvB,OAAS5a,GAEhB+gB,WApBK,SAoBMI,QACgBr8B,IAArBw7B,IACGA,EAAiBr3B,OAAOm4B,SAC3Bd,EAAiBe,SAGrBh2B,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,kBAAet7B,EACpBuG,EAAKkgB,cAAWzmB,EAChBuG,EAAK9F,YAAST,EACduG,EAAK4b,WAAQniB,EACbuG,EAAKmyB,kBAAmB,EACxBnyB,EAAKkC,iBAAczI,EACnBw7B,EAAmBa,GAErBG,WApCK,SAoCMC,GACLjB,IAAqBA,EAAiBr3B,OAAOm4B,SAC/Cd,EAAiBe,QAEnBh2B,EAAK80B,QAAS,EACd90B,EAAK2U,QAAUuhB,EACfl2B,EAAK+0B,kBAAet7B,EACpBuG,EAAKkgB,cAAWzmB,EAChBuG,EAAK9F,YAAST,EACduG,EAAK4b,WAAQniB,EACbuG,EAAKmyB,kBAAmB,EACxBnyB,EAAKkC,iBAAczI,EACnBw7B,OAAmBx7B,GAErBk8B,YAlDK,SAmDHnrB,GAUA,GAAKA,EAAL,CADA,IAKEuqB,EAKEvqB,EALFuqB,aACA7U,EAIE1V,EAJF0V,SACAhmB,EAGEsQ,EAHFtQ,OACAi4B,EAEE3nB,EAFF2nB,iBACAjwB,EACEsI,EADFtI,YAEFlC,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,aAAeA,EACpB/0B,EAAKkgB,SAAWA,EAChBlgB,EAAK9F,OAASA,EACd8F,EAAK4b,WAAQniB,EACbuG,EAAKmyB,iBAAmBA,EACxBnyB,EAAKkC,YAAcA,EACnB+yB,OAAmBx7B,IAErBm8B,SAjFK,SAiFIha,GACPua,QAAQva,MAAMA,GACVqZ,IAAqBA,EAAiBr3B,OAAOm4B,SAC/Cd,EAAiBe,QAGnBh2B,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,kBAAet7B,EACpBuG,EAAKkgB,cAAWzmB,EAChBuG,EAAK9F,YAAST,EACduG,EAAKmyB,kBAAmB,EACxBnyB,EAAK4b,MAAQA,EACb5b,EAAKkC,iBAAczI,EACnBw7B,OAAmBx7B,GAErBqiB,OAjGK,WAkGH9b,EAAKi1B,sBAAmBx7B,EACxBuG,EAAK80B,QAAS,EACd90B,EAAK+0B,kBAAet7B,EACpBuG,EAAKkgB,cAAWzmB,EAChBuG,EAAK9F,YAAST,EACduG,EAAK4b,WAAQniB,EACbuG,EAAK2U,aAAUlb,EACfuG,EAAKmyB,kBAAmB,EACxBnyB,EAAK0Q,eAAiBmkB,GACtB70B,EAAKkC,iBAAczI,EACnBgI,oBAAUzB,EAAM,GAAG8b,UAErBsa,cA9GK,WA+GCnB,IAAqBA,EAAiBr3B,OAAOm4B,SAC/Cd,EAAiBe,QAEnB,IAAMhlB,EAAUmkB,+BAAqBn1B,GAC7Byd,EAAeF,qBAAWvd,GAA1Byd,WACA4Y,EAAiBrlB,EAAjBqlB,aACAC,EAAejB,GAAgBkB,eAAKv2B,IAApCs2B,WAEJA,GACFD,EACGG,sBACC/Y,EACAgZ,KAAKC,MAAMD,KAAKE,UAAUL,KAE3BM,OAAM,SAACvG,GAEN8F,QAAQU,KAAK,+BAAgCxG,WAapD,SAASgF,GACdr1B,EACA82B,GAEA,IACE,IAAM9lB,EAAU8lB,GAAe3B,+BAAqBn1B,GADlD,EAEsCud,qBAAWvM,GAA3C+lB,EAFN,EAEMA,gBAAiBtZ,EAFvB,EAEuBA,WAEvBG,EAKE5M,EALF4M,cACA1b,EAIE8O,EAJF9O,YACAm0B,EAGErlB,EAHFqlB,aACOW,EAELhmB,EAFF4K,MACAqb,EACEjmB,EADFimB,YAEI/f,EAAgB/V,gCAAsB81B,GACtCC,EAAYl3B,EAAKjJ,OAAOE,aAC9B,IACGigB,EAAcqN,SAAS2S,KACvBhgB,EAAcgZ,MAAK,SAAAzyB,GAAI,uBAAIs5B,EAAgBv9B,IAAIiE,UAAxB,aAAI,EAA2B05B,QAAQD,MAE/D,MAAM,IAAIr8B,MAAJ,2BACgBq8B,EADhB,8CAC+DhgB,EAD/D,MAhBN,IAqBMza,EAAWyF,EAAXzF,OAGRK,yBAAeL,GAEf,IAAMihB,EAAYhc,0BAAgBsP,GAGlC,MAAO,CACLqlB,eACA5Y,aACAvb,cACAk1B,uBAN6BpmB,EAAQqmB,uBAAuBr3B,EAAKjJ,QAOjEigC,eACAV,WAAY,CACVt5B,eAAgB,SAAC2X,GACX8B,kBAAQzW,IACVA,EAAK61B,UAAUlhB,IAGnB1d,aAAc+I,EAAKjJ,OAAOE,aAC1BopB,QAAS,CAACrgB,EAAKjJ,QACf6mB,gBACAyY,aAAcA,EAAa54B,KAC3BigB,YACA4Z,SAAUt3B,EAAK3H,IACf2iB,QAAS,MAGb,MAAOqV,GACP,MAAO,CAAE2G,aAAc3G,I,SAiBZiF,G,qFAAf,WACE9qB,EACA5M,EACAoC,GAHF,qCAAAhF,EAAA,yDAMIq7B,GANJ,EAYM7rB,GANF6rB,aACAn0B,EAPJ,EAOIA,YACAub,EARJ,EAQIA,WACA6Y,EATJ,EASIA,WACAc,EAVJ,EAUIA,uBACAJ,EAXJ,EAWIA,aAEGvgB,kBAAQzW,GAbf,8CAcWvG,GAdX,WAiBMu9B,EAjBN,uBAkBIh3B,EAAK41B,SAASoB,GAlBlB,uBAmBWv9B,GAnBX,WAqBM29B,EArBN,uBAsBIp3B,EAAKi2B,WAAWmB,GAtBpB,uBAuBW39B,GAvBX,WA0BMyI,EAAYq1B,SA1BlB,+CA2BW99B,GA3BX,yBAmCY48B,EAAamB,eAAe/Z,EAA5B,uCACL6Y,GACAp0B,GAFK,IAGRtE,YAtCJ,wBA+BIm3B,EA/BJ,EA+BIA,aACA7U,EAhCJ,EAgCIA,SACAhmB,EAjCJ,EAiCIA,OACAi4B,EAlCJ,EAkCIA,iBAlCJ,kBAwCS,CACL4C,eACA7U,WACAhmB,SACAi4B,qBA5CJ,6C,sBC7NA,IAEaQ,GAAoB/zB,QAC9BuB,QACC,oBACAs3B,cACA74B,QAAMnJ,MAAM,CACVqE,OAAQ8E,QAAMC,SACZD,QAAM84B,WACJ,gBACA94B,QAAMW,QACN,SAAAo4B,GAAC,OAAIA,GAXU,MACI,KAcvB1F,WAAYrzB,QAAMR,IAAIw5B,IACtBC,iBAAkBj5B,QAAM+B,MAAM/B,QAAMW,WAGvCy1B,UAAS,iBAAO,CACfrgB,QAAS,GACTmjB,yBAAqBr+B,EACrBs+B,wBAAoBt+B,EACpBu+B,mCAAoC,GACpCC,UAAW,MAEZ3f,OAAM,SAAAtY,GAAI,MAAK,CACd,gBACE,MAAO,gBAET,uBAAuB,IACbk4B,EAAc7+B,KAAd6+B,UACF9hB,EAAO8F,4BAAkBlc,GAC/B,IAAKoW,EAAK+hB,YACR,MAAM,IAAIt9B,MAAM,4BAElB,OAAOub,EAAK8hB,QAGf5f,OAAM,SAAAtY,GAAI,MAAK,CAId,qBACE,OAAOA,EAAK63B,kBAAoBha,kBAAQ7d,EAAM,wBAOhD,kBACE,OAAO,IAGT,uBACE,OAAQijB,GAOV,wBACE,GAAIxM,kBAAQzW,GAAO,CACjB,IACQo4B,EADQ7a,qBAAWvd,GACnBo4B,UAER,GAAIC,YAAUD,GACZ,OAAOA,EAAUz+B,OASvB,oCAID2e,OAAM,SAAAtY,GACL,IAAIs4B,GAAQ,EACRC,EAAuC,GAC3C,MAAO,CAKL,eACE,IADa,EACPC,EAAc,GADP,cAEOx4B,EAAKiyB,WAAWl2B,UAFvB,IAEb,2BAA8C,KAAnC6a,EAAmC,QACxCA,GAASA,EAAMsJ,UACjBsY,EAAYjgC,KAAKqe,EAAMsJ,WAJd,8BAQb,OADAoY,GAAQ,EACD,IAAIz8B,IAA8B28B,IAG3C,wBACE,OAAOx4B,EAAK83B,oBACRz+B,KAAK6mB,SAAS1mB,IAAIwG,EAAK83B,0BACvBr+B,GAUN,0BACE,IADwB,EAClBg/B,EAAa,IAAIt/B,IADC,cAEJ6G,EAAKiyB,WAAWl2B,UAFZ,IAExB,2BAA8C,KAAnC6a,EAAmC,QACxCA,GAASA,EAAM1c,QAAU0c,EAAM1c,OAAOw+B,YACxCD,EAAW/+B,IAAIkd,EAAMve,IAAKue,EAAM1c,OAAOy+B,kBAJnB,8BAQxB,OADAL,GAAQ,EACDG,GAWT,qBACE,IADmB,EACbA,EAAa,GADA,cAECz4B,EAAKiyB,WAAWl2B,UAFjB,IAEnB,2BAA8C,KAAnC6a,EAAmC,QACxCA,GAASA,EAAM1c,QAAU0c,EAAM1c,OAAOw+B,YACxCD,EAAWlgC,KAAKqe,EAAM1c,OAAOy+B,kBAJd,8BAQnB,OADAL,GAAQ,EACD,IAAIz8B,IAAmC48B,IAGhD,YACE,GAAIH,EAAO,CACTC,EAAQ,GADC,oBAEgCl/B,KAAKu/B,qBAFrC,IAET,2BAAmE,8BAAvDtB,EAAuD,KAA7CuB,EAA6C,KACjEN,EAAMjB,GAAY,IAAIwB,IACtB,IAFiE,EAE3DnX,EAAI4W,EAAMjB,GAFiD,cAGrCuB,GAHqC,IAGjE,2BAA4C,8BAAhCxgC,EAAgC,KAA3B6B,EAA2B,KAC1CynB,EAAEoX,OAAO,CACPC,KAAM9+B,EAAO,GACb++B,KAAM/+B,EAAO,GACbg/B,KAAMh/B,EAAO,GACbi/B,KAAMj/B,EAAO,GACbuD,KAAMpF,KATuD,gCAF1D,8BAeTigC,GAAQ,EAEV,OAAOC,GAETa,sBA/EK,SA+EiB9B,EAAkB+B,EAAWC,GACjD,IAAM/F,EAAO,CAAEyF,KAAMK,EAAGJ,KAAMK,EAAGJ,KAAMG,EAAI,EAAGF,KAAMG,EAAI,GAClDC,EAAQlgC,KAAKkgC,MAAMjC,GACzB,OAAOiC,GAASA,EAAMC,SAASjG,GAAQgG,EAAME,OAAOlG,GAAQ,QAIjExzB,SAAQ,SAAAC,GAAI,MAAK,CAChBk1B,YADgB,WACF,WAENwE,EAAqBC,mBAAQ,WAEjC,IAAMC,EAA4C,GACrC1d,4BAAkBlc,GACtBm4B,cACPn4B,EAAK4c,iBAAiBid,cAAc/iC,SAAQ,SAAA8f,GAC1CgjB,EAAchjB,EAAMve,MAAO,EACtB2H,EAAKiyB,WAAWj2B,IAAI4a,EAAMve,MAC7B,EAAKyhC,SAASljB,EAAMve,IAAKue,MAI7B5W,EAAKiyB,WAAWn7B,SAAQ,SAAC28B,EAAGp7B,GACrBuhC,EAAcvhC,IACjB,EAAK0hC,YAAY1hC,UAMzB2hC,sBAAYh6B,EAAM05B,IAEpBO,UAzBgB,SAyBNrF,GAMR,OAJE50B,EAAKlG,OADH86B,EArMe,GAsMHA,EAtMG,GA0MZ50B,EAAKlG,QAEdogC,aAjCgB,SAiCH7sB,GACX,IAAM8sB,EAAYn6B,EAAKlG,OAEvB,OADkBT,KAAK4gC,UAAUj6B,EAAKlG,OAASuT,GAC5B8sB,GAErBC,aAtCgB,SAsCHnC,GACXj4B,EAAKi4B,UAAYA,GAGnBoC,oBA1CgB,SA0CIC,GAClBt6B,EAAK63B,iBAAmByC,GAG1BrE,WA9CgB,SA8CLthB,GACT3U,EAAK2U,QAAUA,GAEjBmlB,SAjDgB,SAiDPzhC,EAAaue,GACpB5W,EAAKiyB,WAAWv4B,IACdrB,EACAu/B,GAAWpL,OAAO,CAChBn0B,MACAtB,OAAQ6f,EAAM2jB,eAIpBR,YA1DgB,SA0DJ1hC,GACV2H,EAAKiyB,WAAWuI,OAAOniC,IAEzBilB,cA7DgB,SA6DFvC,GACZ,IAAMtM,EAAU8O,qBAAWvd,GAC3B,GAAIwd,oCAA0B/O,GAAU,CACtC,IAAMsP,EAAgBtP,EAAQuP,UAC5B,oBACA,cACA,CAAEC,YAAalD,EAAQzgB,SAAU8b,KAAM8F,4BAAkBlc,KAE3DyO,EAAQ0P,WAAWJ,GAEjB0c,+BAAqBhsB,IACvBA,EAAQ2P,aAAarD,IAGzB2f,sBA3EgB,WA4EEnd,qBAAWvd,GACnB26B,kBAEVC,uBA/EgB,SA+EO7f,GACrB/a,EAAK83B,oBAAsB/c,GAE7Be,OAlFgB,WAmFd,IAAM+e,EAAOpE,KAAKC,MAAMD,KAAKE,UAAU32B,EAAKiyB,aAC5C70B,OAAOlB,KAAK2+B,GAAM/jC,SAAQ,SAAAm7B,GACxB4I,EAAK5I,GAAY55B,KAAO,aAE1B2H,EAAKiyB,WAAa4I,GAEpBC,qCAzFgB,SAyFqB/oB,GACnC/R,EAAKg4B,mCAAmCz/B,KAAKwZ,IAE/CmhB,sBA5FgB,SA4FMnY,GACpB/a,EAAK+3B,mBAAqBhd,OAG7BzC,OAAM,SAAAtY,GAAI,MAAK,CACd+6B,2BADc,SACaC,GACzB,IAAM5kB,EAAO8F,4BAAkBlc,GAC/B,OAAIoW,GAAQA,EAAKlgB,QAAU8J,EAAKi7B,eACvB,0BAEF,IAUT5D,uBAhBc,SAgBS2D,GACrB,IAAM5kB,EAAO8F,4BAAkBlc,GAC/B,GAAIoW,GAAQA,EAAKlgB,QAAU8J,EAAKi7B,eAC9B,OACE,oCACE,kBAACxnB,EAAA,EAAD,CAAYC,UAAU,OAAOjb,QAAQ,SAArC,6BAC6B,KAE7B,kBAACgZ,EAAA,EAAD,CACE7B,cAAY,gBACZY,QAAS,WACPxQ,EAAKq6B,oBAAoBjkB,EAAKlgB,SAC9B8J,EAAK8b,UAEPrjB,QAAQ,YANV,cAUA,kBAACgb,EAAA,EAAD,CAAYC,UAAU,OAAOjb,QAAQ,SAArC,8BASR,qBACE,MAAO,IAQT,6BACE,MAAO,IAET,uBAAuB,IACbkY,EAAkBX,iBAAOhQ,GAAzB2Q,cACFsiB,EAAmBjzB,EAAK+3B,mBAC1B,CACE,CACExR,MAAO,uBACP1W,KAAMqrB,IACN1qB,QAAS,WACHxQ,EAAK+3B,oBACP/3B,EAAKsd,cAActd,EAAK+3B,uBAKhC,GAMJ,OAJA/3B,EAAKg4B,mCAAmClhC,SAAQ,SAAAib,GAC9C,IAAMV,EAAYU,EAAS/R,EAAK+3B,mBAAoB/3B,EAAM2Q,GAC1DsiB,EAAiB16B,KAAjB,MAAA06B,EAAgB,YAAS5hB,OAEpB4hB,GAET,0BACE,kCACKjxB,+BAAqBhC,IAD1B,IAEEwc,cAAexc,EAAKwc,cACpBC,aAAczc,EACdm7B,eAJF,SAIiB1H,EAAY2H,GACzB,IAAM/+B,EAAI++B,GAAap7B,EAAK83B,oBAC5B,GAAKz7B,EAEE,CACL,IAAM0e,EAAU/a,EAAKkgB,SAAS1mB,IAAI6C,GAClC2D,EAAKsd,cAAcvC,QAHnB/a,EAAK06B,yBAMTlqB,QAbF,WAcIxQ,EAAK06B,yBAGPW,qBAjBF,SAiBuB5H,EAAY2H,GAC/B,IAAM/+B,EAAI++B,GAAap7B,EAAK83B,oBACvBz7B,EAIH2D,EAAKkzB,sBAAsBlzB,EAAKkgB,SAAS1mB,IAAI6C,IAH7C2D,EAAK06B,yBAOTpH,YA3BF,SA2BcG,EAAY2H,GACtBp7B,EAAK46B,uBAAuBQ,IAG9BE,aA/BF,SA+Be7H,GACXzzB,EAAK46B,4BAAuBnhC,IAG9B05B,cAnCF,WAoCInzB,EAAKkzB,2BAAsBz5B,GAC3BuG,EAAK06B,4BAIX,kBACE,OAAOrhC,KAAKkiC,yBAGfx7B,SAAQ,SAAAC,GAAI,MAAK,CACVw7B,UADU,SACAz+B,GAAqD,sIAC3DjD,EAAekG,EAAflG,OAAQH,EAAOqG,EAAPrG,GACR8hC,EAAmB1+B,EAAnB0+B,eACFrlB,EAAO8F,4BAAkBlc,GAEnB07B,EAGRtlB,EAHFpgB,SACsB2lC,EAEpBvlB,EAFFwlB,qBACA/lC,EACEugB,EADFvgB,MAPiE,SAU1C83B,QAAQC,IAC/B+N,EAAcv9B,KAAI,SAAAwY,GAChB,IAAMqb,EAAa2F,GAAWpL,OAAO,CACnCn0B,IAAKue,EAAMve,IACXtB,OAAQ6f,IAKJwgB,EACJp3B,EAAK+6B,2BAA2BnkB,IAChC5W,EAAKq3B,uBAAuBzgB,GAE9B,GAAIwgB,EACF,MAAO,CACLrC,aACE,oCACE,0BAAMsE,EAAG,EAAGC,EAAG,EAAGzjC,MAAOA,EAAOiE,OAAQ,GAAI2R,KAAK,SACjD,0BAAM4tB,EAAG,EAAGC,EAAG,IACZlC,KAlBc,MA8BrB/B,GAAgBpD,EAAYjyB,GAJ9Byd,EA1BuB,EA0BvBA,WACA6Y,EA3BuB,EA2BvBA,WACAp0B,EA5BuB,EA4BvBA,YAIF,OAhCyB,EA6BvBm0B,aAGkBmB,eAAe/Z,EAA5B,uCACF6Y,GACAp0B,GAFE,IAGL25B,UAAW9+B,SA9CkD,cAU7D++B,EAV6D,yBAoDjE,oCACGA,EAAW19B,KAAI,SAAC29B,EAAW/4B,GAAU,IAE9B/H,EADe0gC,EAAc34B,GAA3BhN,SACkB0lC,EAEpBM,EAAS,QAAH,OACM,qBAATtP,KAAuB/yB,EAAK,OADzB,YAERqJ,GACJ,OACE,kBAAC,IAAMi5B,SAAP,CAAgB5jC,IAAG,eAAU2K,IAC3B,8BACE,8BAAUrJ,GAAIqiC,GACZ,0BACE3C,EAAG,EACHC,EAAG,EACHzjC,MAAOA,EACPiE,OAAQ2hC,GAAkB3hC,MAIhC,uBAAG8R,UAAS,oBAAe3Q,EAAf,QACV,uBAAGihC,SAAQ,eAAUF,EAAV,MACRrpB,IAAMwpB,eAAeJ,EAAUhH,cAC9BgH,EAAUhH,aAEV,uBAAGtU,wBAAyB,CAAEC,OAAQqb,EAAUzkB,gBA7EG,kDAwFtE8kB,qBAAoB,SAAAp8B,GACaA,EAAxBiyB,WACR,OAF2B,YACKjyB,EADL,mB,cC3fxB,SAASihB,GAAkB9E,GAChC,OAAOvd,QACJuB,QACC,oBACAwyB,GACA/zB,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,qBACpB/b,cAAe2a,aAAuBE,MAIzC7D,OAAM,SAAAtY,GAAI,MAAK,CACd,kBACE,8CACKA,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEwc,cAAexc,EAAKwc,cACpB/f,OAAQuD,EAAKsB,cAAc8a,YAI/B,uBACE,OAAOpc,EAAKsB,cAAc8a,SAASvY,U,mCCpBrCw4B,GAAkBzZ,gBAAK,kBAAM,mCA0HpB3B,GAxHW,SAAC9E,GAAD,OACxBvd,QACGuB,QACC,qBACAwyB,GACA/zB,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,sBACpBif,gBAAiB19B,QAAM+B,MAAM/B,QAAMkB,SACnCy8B,iBAAkB39B,QAAM+B,MAAM/B,QAAMS,QACpCm9B,eAAgB59B,QAAM+B,MAAM/B,QAAMW,QAClC+B,cAAe2a,iCAAuBE,MAGzC7D,OAAM,SAAAtY,GAAI,MAAK,CACd,uBACE,OAAO6d,kBAAQ7d,EAAM,CAAC,WAAY,UAGpC,iBACE,IAAMy8B,EAAa5e,kBAAQ7d,EAAM,CAAC,WAAY,eAC9C,YAAgCvG,IAAzBuG,EAAKs8B,gBACRt8B,EAAKs8B,gBACLG,GAGN,gBACE,IAAMhkB,EAAYoF,kBAAQ7d,EAAM,CAAC,WAAY,cAC7C,YAA+BvG,IAAxBuG,EAAKw8B,eACRx8B,EAAKw8B,eACL/jB,GAGN,kBACE,IAAMikB,EAAc7e,kBAAQ7d,EAAM,CAAC,WAAY,gBAC/C,YAAiCvG,IAA1BuG,EAAKu8B,iBACRv8B,EAAKu8B,iBACLG,GAEN,qBACE,IAAMC,EAAa9e,kBAAQ7d,EAAM,CAAC,cAAgB,GAElD,OAAOA,EAAKq2B,aAAala,aAAaqQ,OAA/B,2BAEAmQ,GAFA,IAGHF,WAAYpjC,KAAKojC,WACjBC,YAAarjC,KAAKqjC,YAClBjkB,UAAWpf,KAAKof,YAElBzI,iBAAOhQ,SAKZD,SAAQ,SAAAC,GAAI,MAAK,CAChB48B,iBADgB,WAEd58B,EAAKs8B,iBAAmBt8B,EAAKy8B,YAE/BI,eAJgB,SAIDzlB,GACbpX,EAAKu8B,iBAAmBnlB,GAE1B0lB,aAPgB,SAOH1lB,GACXpX,EAAKw8B,eAAiBplB,OAGzBkB,OAAM,SAAAtY,GAAQ,IACL+8B,EAAmB/8B,EAAnB+8B,eACR,MAAO,CACL,kBACE,IAAMtgC,EAASuD,EAAKg9B,eAEpB,8CACKh9B,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEvD,YAGJ,qBAOE,4BACKsgC,GADL,CAEE,CACExW,MAAO,cACP1W,KAAMotB,KACNp5B,KAAM,WACNq5B,QAASl9B,EAAKy8B,WACdjsB,QAAS,WACPxQ,EAAK48B,qBAGT,CACErW,MAAO,eACP1W,KAAMotB,KACNE,QApBiB,CACnB,UACA,wBACA,SACA,YAgBwB/+B,KAAI,SAAAgZ,GAAG,MAAK,CAChCmP,MAAOnP,EACP5G,QAAS,WACPxQ,EAAK68B,eAAezlB,SAI1B,CACEmP,MAAO,iBACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBf,GAAiB,CACnD5mC,MAAOuK,cCpHV,SAASq9B,GAAoB1sB,GAC1C,OAAOqL,8BACL,qBACA,CACEyW,UAAW,CACT5uB,KAAM,SACNiC,YAAa,uCACb+a,aAAc,2BAEdC,gBAAiB,CAAC,YAEpB1E,SAAUzL,EAAc2sB,0BAA0B,YAElDhM,oBAAqB,CACnBztB,KAAM,SACNiC,YAAa,gDACb+a,aAAc,MAGlB,CAAExE,kBAAmBgV,EAA+B/U,iBAAiB,I,ICapDihB,G,4MACnB9/B,KAAO,yB,EAEP+/B,QAAU,CACRlb,6BACAqQ,qBACAtB,iC,6CAGF,SAAQ1gB,GACNA,EAAcmR,cAAa,WACzB,IAAM3F,EAAeH,8BACnB,eACA,GACA,CACEK,kBAAmB0F,gCAAsBpR,GACzC8gB,mBAAoB,YAGxB,OAAO,IAAIzP,IAAU,CACnBvkB,KAAM,eACN0e,eACAI,WAAY0F,+BACVtR,EACA,eACAwL,QAKNxL,EAAcmR,cAAa,WACzB,IAAM3F,EAAeH,8BACnB,aACA,GACA,CACEK,kBAAmB0F,gCAAsBpR,GACzC8gB,mBAAoB,YAGxB,OAAO,IAAIzP,IAAU,CACnBvkB,KAAM,aACN0e,eACAI,WAAY0F,+BACVtR,EACA,aACAwL,QAKNxL,EAAcuR,gBAAe,WAC3B,IAAM/F,ECnFL,SAA6BxL,GAClC,OAAOqL,8BACL,oBACA,CAAEI,SAAUzL,EAAc2sB,0BAA0B,aACpD,CACEjhB,kBAAmBgV,EACnB/U,iBAAiB,ID6EImhB,CAAqC9sB,GAC1D,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,oBACN0e,eACAI,WAAYmhB,GAAmCvhB,GAC/Ce,UAAW,aACXxE,SAAU,mBACVhI,eAAgB4R,OAIpB3R,EAAcuR,gBAAe,WAC3B,IAAM/F,EAAegG,GAAsCxR,GAC3D,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,qBACN0e,eACAI,WAAYa,GAA+BjB,GAC3Ce,UAAW,eACXxE,SAAU,mBACVhI,eAAgB4R,OAIpB3R,EAAcgtB,aACZ,kBACE,IAAI3S,IAAS,CACXvtB,KAAM,mBACN8e,WAAYqhB,aAAkCjtB,GAC9CD,eAAgBkS,gBACd,kBAAM,mD,uBAMhB,SAAUjS,GACJktB,gCAAsBltB,EAAc8S,YACtC9S,EAAc8S,UAAUqa,gBAAgB,CAAC,OAAQ,OAAQ,CACvDvX,MAAO,qBACP1W,KAAMkuB,IACNvtB,QAAS,SAAC/B,GACRA,EAAQuvB,QAAQ,mBAAoB,W,GA5FMnb,M,iIEO7C,SAASwV,EAAU3J,GACxB,MACmB,kBAAVA,GACG,OAAVA,GACkC,oBAA1BA,EAAkBl1B,KACO,oBAAzBk1B,EAAkB/0B,GA0B9B,SAASskC,EACPxkB,GAEA,MAAO,aAAcA,GAA6B,kBAAdA,EAAK1f,K,IAMtBuE,E,WAcnB,WAAmBmb,GAAmD,yBAZ9D1f,UAY8D,OAV9DmkC,kBAU8D,OAR9DC,cAQ8D,EAChEF,EAA0BxkB,GAC5BpgB,KAAKU,KAAO0f,GAEZpgB,KAAKU,KAAO0f,EAAK1f,MAAQ,GAIzBV,KAAK6kC,aAAezkB,EAAKjY,QAK3B,IAAM7H,EAAKskC,EAA0BxkB,GAAQA,EAAK0kB,SAAW1kB,EAAK9f,GAClE,QAAWF,IAAPE,GAA2B,OAAPA,EACtB,MAAM,IAAIkB,MACR,qEAKJ,GAFAxB,KAAK8kC,SAAW5d,OAAO5mB,KAEjBN,KAAKU,KAAKqkC,SAAW/kC,KAAKU,KAAKzC,IAAM+B,KAAKU,KAAK3C,OAAS,GAC5D,MAAM,IAAIyD,MAAJ,0DAC+CxB,KAAKU,KAAKzC,IADzD,mBACuE+B,KAAKU,KAAK3C,QAvBrB,IA4B5DinC,EAAgBhlC,KAAKU,KAArBskC,YACR,GAAIA,EACF,IAAK,IAAIhS,EAAI,EAAGA,EAAIgS,EAAYzlC,OAAQyzB,GAAK,EACT,oBAAvBgS,EAAYhS,GAAG7yB,MACxB6kC,EAAYhS,GAAGiS,OAASD,EAAYhS,GAAGiS,QAAUjlC,KAAKU,KAAKukC,OAC3DD,EAAYhS,GAAK,IAAI/tB,EAAc,CACjC3E,GAAI0kC,EAAYhS,GAAG8R,UAAf,UAA8BxkC,EAA9B,YAAoC0yB,GAExCtyB,KAAMskC,EAAYhS,GAClB7qB,OAAQnI,Q,uCAYlB,SAAWoE,GACT,OAAOpE,KAAKU,KAAK0D,K,iBAOnB,SAAWA,EAAc2Z,GACvB/d,KAAKU,KAAK0D,GAAQ2Z,I,kBAMpB,WACE,OAAOha,OAAOlB,KAAK7C,KAAKU,Q,gBAM1B,WACE,OAAOV,KAAK8kC,W,oBAMd,WACE,OAAO9kC,KAAK6kC,e,sBAMd,WACE,OAAO7kC,KAAKG,IAAI,iB,oBAGlB,WACE,IAAMkS,EAAI,2BAAKrS,KAAKU,MAAb,IAAmBokC,SAAU9kC,KAAKM,OACnC6pB,EAAInqB,KAAKmI,SACXgiB,IACF9X,EAAE6yB,SAAW/a,EAAE7pB,MAEjB,IAAM6kC,EAAInlC,KAAKmV,WAIf,OAHIgwB,IACF9yB,EAAE2yB,YAAcG,EAAEpgC,KAAI,SAAAqgC,GAAK,OAAIA,EAAMnkC,aAEhCoR,K,uBAGT,SAAuB8b,GACrB,OAAO,IAAIlpB,EAAJ,eAAuBkpB,Q,uCCxMlC,sFASO,SAAS1pB,EACd8B,EACAhC,GAEA,OAAO8gC,IAAWlS,QAAO,SAACzuB,GACxB,IACE,IAAM4gC,EAAM/+B,EAAK7B,GAEb4gC,GAAOA,EAAI/H,OACb+H,EAAI/H,OAAM,SAAChb,GAAD,OAAkB7d,EAAS6d,MAAMA,MAE7C,MAAOA,GAEP7d,EAAS6d,MAAMA,OAEhB1d,KAAK+uB,YAAUC,6BAAmBtvB,O,gYCtBxBoe,gCACb,iBACA,CACEve,KAAM,CACJoG,KAAM,SACNgd,aAAc,mBACd/a,YAAa,qCAEfoR,cAAe,CACbrT,KAAM,cACNgd,aAAc,GACd/a,YAAa,4DAGjB,CAAEwW,iBAAiB,EAAMmV,mBAAoB,iB,iBCdhC,WAAA9gB,GACb,OAAO,2BACgB,CACnBlT,KAAMmB,QADa,WAEnBggC,OAAQhgC,cAAY+R,4BAAZ/R,YAHL,SAKI,SAAAoB,GAAI,MAAK,CAChBk1B,YADgB,WAETl1B,SAAL,QACEA,UAAaA,EAAbA,gBAGJ6+B,aANgB,YAOd,IAAMjmC,EAASoH,cAAf,GACA,OAAOA,SAAYpH,EAAnB,IAEFkmC,cAVgB,YAUU,MAClBlmC,GAAS,EAAAoH,EAAA,iCAAf,IACA,OAAOA,eAAkBpH,IAAammC,EAA/B/+B,OAAkDpH,EAAzD,IAEFomC,cAdgB,YAgBd,OADAh/B,WACOA,EAAP,QAEFi/B,MAlBgB,kB,mCCATxH,EAAc74B,QACxBnJ,MAAM,cAAe,CACpBkE,GAAIgF,YACJkF,KAAMjF,QAAMS,OACZmd,cAAe5d,QAAM+B,MAAM/B,QAAMS,UAElC21B,UAAS,iBAAO,CACfkK,iBAAkB,GAClBtjB,WAAOniB,MAER6e,OAAM,SAAAtY,GAAI,MAAK,CACd,yBAOE,OAF0BgQ,iBAAOhQ,GAAzB2Q,cAC0BwuB,eAAen/B,EAAK6D,MACnC6M,gBAOrB,mBACE,OAAO,MAGT,oBACE,OAAOmN,kBAAQxkB,KAAK49B,YAAa,YAGnC,kBAEE,IADA,IAAI71B,EAAQK,oBAAUzB,IACboB,EAAME,gBAAiBuc,kBAAQzc,EAAO,YAAa,CAC1D,GAAIU,iBAAOV,GACT,MAAM,IAAIvG,MAAJ,oCAAuCmF,EAAK6D,KAA5C,YAAoD7D,EAAKrG,KAEjEyH,EAAQK,oBAAUL,GAEpB,OAAOA,GAOT,kBACE,kCACKY,+BAAqBhC,IAD1B,IAEEwc,cAAexc,EAAKwc,cACpBC,aAAczc,KAQlB,mBAAmB,IAEXo/B,EADoBpvB,iBAAOhQ,GAAzB2Q,cAC2B0uB,gBAAgBr/B,EAAKk/B,kBACxD,IAAKE,EACH,MAAM,IAAIvkC,MAAJ,oBAAuBmF,EAAKk/B,iBAA5B,gBAER,IAAKE,EAAa1uB,eAChB,MAAM,IAAI7V,MAAJ,mBACQmF,EAAKk/B,iBADb,qEAIR,OAAOE,GAOT,gCAIA,qBACE,MAAO,IAGT,sBACE,MAAO,IAST/H,uBAtFc,iBA0Fft3B,SAAQ,SAAAC,GAAI,MAAK,CAChB41B,SADgB,SACPha,GACP5b,EAAK4b,MAAQA,GAEf0jB,iBAJgB,SAIC9iB,GACfxc,EAAKwc,cAAgBA,GAGvBV,OARgB,iB,mCClFb,SAASmG,EACdtR,EACAuM,EACAqiB,GAEA,OAAO3gC,QACJnJ,MAAMynB,EAAW,CAChBvjB,GAAIgF,YACJkF,KAAMjF,QAAMye,QAAQH,GACpB5b,cAAe2a,YAAuBsjB,GACtCC,SAAU5gC,QAAM6oB,MACd9W,EAAc8uB,iBAAiB,UAAW,iBAG7CnnB,OAAM,SAAAtY,GAAI,MAAK,CACd,mBACE,OAAOA,EAAKsB,cAAc0E,SAG5B,WACE,OAAO6X,kBAAQ7d,EAAM,SAMvB,kBACE,IAAM4d,EAAgBC,kBAAQ7d,EAAM,WACb0/B,EAAO1vB,iBAAOhQ,GAA7B2Q,cACR,IAAKiN,EACH,MAAM,IAAI/iB,MAAJ,gDAAmDmF,EAAK6D,OAEhE,IAAMmB,EAAc06B,EAAGC,eAAe/hB,EAAc/Z,MACpD,IAAKmB,EACH,MAAM,IAAInK,MAAJ,+BAAkC+iB,EAAc/Z,OAExD,OAAOmB,GAGT,sBACE,IAAMqM,EAAwB,GAI9B,OAHArR,EAAKw/B,SAAS1oC,SAAQ,SAAAka,GACpBK,EAAU9Y,KAAV,MAAA8Y,EAAS,YAASL,EAAQ4uB,qBAErBvuB,GAET,mBACE,IAAM5C,EAAU8O,qBAAWvd,GAC3B,OACE6/B,0CAAgCpxB,KAE/BA,EAAQkV,WAEPlV,EAAQqxB,cAAc5P,MAAK,SAAA9uB,GACzB,OAAOA,EAAM4E,UAAYhG,EAAKsB,cAAc0E,aASpD,6BACE,MAAO,QAGVjG,SAAQ,SAAAC,GAAI,MAAK,CAChB+/B,wBADgB,WAEd,IAAMtxB,EAAU8O,qBAAWvd,GACrBoW,EAAO8F,4BAAkBlc,GAC/B,GAAI6/B,0CAAgCpxB,GAAU,CAE5C,IAAMpN,EAAYoN,EAAQuxB,uBAAuBhgC,EAAKsB,eAClDD,GAAaA,IAAcrB,EAAKsB,gBAElC8U,EAAK6pB,UAAUjgC,EAAKsB,eAEpB8U,EAAK8pB,UAAU7+B,MAIrB8+B,YAfgB,SAeJC,GAAyC,IAAtBC,EAAsB,uDAAJ,GACzCC,EAA0B3vB,EAAc2sB,0BAC5C,WAEIh8B,EAAgBi/B,4BACpBD,EACAja,kBAAQrmB,GACRogC,GAEII,EAAc7vB,EAAcwuB,eAAe79B,EAAcuC,MAC/D,IAAK28B,EACH,MAAM,IAAI3lC,MAAJ,+BAAkCyG,EAAcuC,OAExD,IAAMmN,EAAUwvB,EAAYjkB,WAAWiQ,OAAvB,2BACX6T,GADW,IAEdx8B,KAAMvC,EAAcuC,KACpBvC,mBAEFtB,EAAKw/B,SAASjnC,KAAKyY,IAGrByvB,YApCgB,SAoCJL,GACV,IAAME,EAA0B3vB,EAAc2sB,0BAC5C,WAEIh8B,EAAgBi/B,4BACpBD,EACAja,kBAAQrmB,GACRogC,GAGIM,EAAgB1gC,EAAKw/B,SAASrb,QAClC,SAAAzY,GAAC,OAAIA,EAAEpK,gBAAkBA,KAG3B,OADAq/B,uBAAY,kBAAMD,EAAc5pC,SAAQ,SAAA4U,GAAC,OAAI1L,EAAKw/B,SAASoB,OAAOl1B,SAC3Dg1B,EAAc9nC,QAEvBioC,eApDgB,SAqDdC,EACAC,GAEA,IADAV,EACA,uDADkB,GAEZW,EAAahhC,EAAKw/B,SAASyB,WAC/B,SAAAv1B,GAAC,OAAIA,EAAEpK,cAAc8+B,YAAcU,KAErC,IAAoB,IAAhBE,EACF,MAAM,IAAInmC,MAAJ,oCACyBimC,EADzB,gBAIR,IAAMR,EAA0B3vB,EAAc2sB,0BAC5C,WAEIh8B,EAAgBi/B,4BACpBD,EACAja,kBAAQrmB,GACR+gC,GAEIP,EAAc7vB,EAAcwuB,eAAe79B,EAAcuC,MAC/D,IAAK28B,EACH,MAAM,IAAI3lC,MAAJ,+BAAkCyG,EAAcuC,OAExD7D,EAAKw/B,SAAS0B,OAAOF,EAAY,EAAjC,2BACKX,GADL,IAEEx8B,KAAMvC,EAAcuC,KACpBvC,wBAILgX,OAAM,SAAAtY,GAAI,MAAK,CACd,qBACE,IAAMqR,EAAwB,GAC9BrR,EAAKw/B,SAAS1oC,SAAQ,SAAAka,GACpBK,EAAU9Y,KAAV,MAAA8Y,EAAS,YAASL,EAAQ+rB,oBAE5B,IAAMoE,EAA6B,GAC7B/qB,EAAO8F,4BAAkBlc,GAEzBohC,EADWzwB,EAAc0wB,YAAYjrB,EAAKvS,MACRy9B,aAAaljC,KACnD,SAAAoiC,GAAW,OAAIA,EAAY/iC,QAEvB8jC,EAAqBvhC,EAAKsB,cAAck+B,SAASrb,QACrD,SAACqd,GAAD,OACEJ,EAAuB7c,SAASid,EAAY39B,SAE1C49B,EAAUzhC,EAAKw/B,SAAS,GAAGl+B,cAAc8+B,UAiB/C,OAhBImB,EAAmB3oC,OAAS,IAC9BuoC,EAAe5oC,KACb,CAAEsL,KAAM,WACR,CAAEA,KAAM,YAAa0iB,MAAO,kBAE9Bgb,EAAmBzqC,SAAQ,SAAC0qC,GAC1BL,EAAe5oC,KAAK,CAClBsL,KAAM,QACN0iB,MAAO,GAAF,OAAKib,EAAY39B,MACtB2M,QAAS,WACPxQ,EAAK6gC,eAAeY,EAASD,EAAYpB,YAE3ClD,QAASsE,EAAYpB,YAAcqB,QAIzC,UAAWpwB,EAAc8vB,QC7M1B,SAASpf,EAAsBpR,GACpC,OAAOqL,8BACL,YACA,CACEve,KAAM,CACJqI,YAAa,gCACbjC,KAAM,SACNgd,aAAc,SAEhB3J,cAAe,CACbpR,YAAa,wDACbjC,KAAM,cACNgd,aAAc,CAAC,iBAEjB/a,YAAa,CACXA,YAAa,6BACbjC,KAAM,SACNgd,aAAc,IAEhB9a,SAAU,CACRD,YAAa,6CACbjC,KAAM,cACNgd,aAAc,IAEhB6gB,SAAU,CACR79B,KAAM,SACNiC,YAAa,mCACb+a,aAAc,IAEhB8gB,QAAShxB,EAAc2sB,0BAA0B,WACjDkC,SAAU5gC,QAAM6oB,MAAM9W,EAAc2sB,0BAA0B,aAchE,CACEsE,mBAAoB,SAAA7T,GAClB,IAAMhtB,EAAO01B,KAAKC,MAAMD,KAAKE,UAAU5I,IACjCuT,EAAe,IAAInlC,IAFF,EAGG4E,EAAlBy+B,gBAHe,MAGJ,GAHI,EAIF,kBAAjBz+B,EAAKiF,UAIPw5B,EAAS1oC,SAAQ,SAAC4U,GAAD,OAAYA,GAAK41B,EAAallC,IAAIsP,EAAE7H,SACnC8M,EAAcgI,aAAa5X,EAAK8C,MACxCy9B,aAAaxqC,SAAQ,SAAA0pC,GACxBc,EAAatlC,IAAIwkC,EAAY/iC,OAChC+hC,EAASjnC,KAAK,CACZ6nC,UAAW,GAAF,OAAKr/B,EAAKiF,QAAV,YAAqBw6B,EAAY/iC,MAC1CoG,KAAM28B,EAAY/iC,WAK1B,kCAAYsD,GAAZ,IAAkBy+B,cAEpB/N,mBAAoB,UACpBnV,iBAAiB,EACjBvc,QAAS,SAACC,GAAD,MAAgB,CACvB6hC,eADuB,SACRL,GAAkD,IACvD39B,EAAS29B,EAAT39B,KACR,IAAKA,EACH,MAAM,IAAIhJ,MAAJ,+BAAkCgJ,IAE1C,IAAMmN,EAAUhR,EAAKw/B,SAAStP,MAC5B,SAACxkB,GAAD,OAAYA,GAAKA,EAAE00B,YAAcoB,EAAYpB,aAE/C,GAAIpvB,EACF,OAAOA,EAET,IAAMpY,EAASoH,EAAKw/B,SAASjnC,KAAKipC,GAClC,OAAOxhC,EAAKw/B,SAAS5mC,EAAS,U,qMCnEhC2B,GAA+B,qBAAXzE,OAAyBA,OAAU,IAAvDyE,SAEFunC,E,4MACGvS,Y,0BAD6B10B,QAYjBg2B,E,WAcnB,WAAmBp2B,GAA8C,IAC3DC,EAD2D,OAA9BqC,EAA8B,uDAAJ,GAK3D,GAL+D,yBAbvDipB,SAauD,OAXvD+b,WAWuD,OATvD1a,WASuD,OANvD2a,cAAqB,GAMkC,KAJzDC,mBAAoB,EAIqC,KAFzDvnC,iBAEyD,OAuDzDwnC,UAvDyD,uCAuD7C,WAClBjwB,EACAkwB,GAFkB,yBAAAnnC,EAAA,6DAIdmnC,IACFA,EAAKvkC,YAASnE,GALE,SAOgB,EAAKiB,YAAYI,OACjD,QACAmX,EACAkwB,GAVgB,cAOZC,EAPY,OAYVrnC,EAAwCqnC,EAAxCrnC,OAAQq0B,EAAgCgT,EAAhChT,QAASG,EAAuB6S,EAAvB7S,OAAQ8S,EAAeD,EAAfC,WAC3B9R,EAAW,IAAIC,SAASz1B,EAAQ,CAAEw0B,SAAQ8S,aAAYjT,YAb1C,kBAcXmB,GAdW,2CAvD6C,wDAE3Dh2B,IACFG,EAAcH,EAASG,cAEpBA,EACH,MAAM,IAAIG,MACR,kEAQJ,GALAxB,KAAKqB,YAAcA,EAEnBrB,KAAK2sB,IAAMvrB,EAGPA,EAAO6nC,WAAW,WAAY,CAChC,IAAMC,EAAOC,IAAS/nC,GACtB,IAAK8nC,EACH,MAAM,IAAIE,UAAU,oBAEtB,IAAMC,EAAY,IAAIloC,IAAkB+nC,GAIxC,OAHAlpC,KAAKspC,KAAOD,EAAUC,KAAKC,KAAKF,GAChCrpC,KAAKwpC,SAAWH,EAAUG,SAASD,KAAKF,QACxCrpC,KAAKypC,KAAOJ,EAAUI,KAAKF,KAAKF,IAIlC,IAAMK,EAAWhmC,EAAKsqB,OAASvxB,OAAOuxB,MACtC,IAAKA,MACH,MAAM,IAAIob,UAAJ,oEAIRppC,KAAKguB,MAAQ0b,EAEThmC,EAAK0N,YACPpR,KAAK2oC,cAAgBjlC,EAAK0N,W,gGAI9B,WACE8lB,GADF,0EAGiC,oBAApBA,EAASx1B,OAHtB,yCAIWw1B,EAASx1B,UAJpB,UAMsC,oBAAzBw1B,EAASd,YANtB,gCAOuBc,EAASd,cAPhC,cAOUuT,EAPV,yBAQW1nC,EAAOC,KAAKynC,IARvB,aAUQ,IAAIP,UACR,iFAXJ,2C,oHAgCA,WACE1lC,GADF,8FAGO1D,KAAKguB,MAHZ,sBAIU,IAAIxsB,MACR,iEALN,UAQOxB,KAAK2sB,IARZ,sBASU,IAAInrB,MAAM,oBATpB,cAWQooC,EAAU5pC,KAAK4oC,kBAAoB5oC,KAAK6oC,UAAY7oC,KAAKguB,MAXjE,EAYmDtqB,EAAzCqyB,eAZV,MAYoB,GAZpB,EAYwBxxB,EAA2Bb,EAA3Ba,OAZxB,EAYmDb,EAAnB0N,iBAZhC,MAY4C,GAZ5C,EAaQy4B,EAbR,yBAcI9T,UACAL,OAAQ,MACRoU,SAAU,SACVC,KAAM,OACNxlC,UACGvE,KAAK2oC,eACLv3B,GApBP,mBAwBqBw4B,EAAQ5pC,KAAK2sB,IAAKkd,GAxBvC,QAwBI3S,EAxBJ,4DA0BS8S,2BAAiB,EAAD,IA1BzB,qBA2BUhqC,KAAK4oC,kBA3Bf,2CA8BM9L,QAAQU,KAAK,6CAAb,MACAx9B,KAAK4oC,mBAAoB,EA/B/B,kBAgCa5oC,KAAKiqC,SAASvmC,IAhC3B,kCAsCO1D,KAAK0oC,QAEJmB,EAAe9T,SAAW8T,EAAe9T,QAAQC,OAC7CkU,EAAehT,EAASnB,QAAQ51B,IAAI,kBACpCgqC,EAAY,WAAWpT,KAAKmT,GAAgB,MACjCC,EAAU,KACzBnqC,KAAK0oC,MAAQ,CAAEr6B,KAAMuX,SAASukB,EAAU,GAAI,QAGxCC,EAAgBlT,EAASnB,QAAQ51B,IAAI,qBAEzCH,KAAK0oC,MAAQ,CAAEr6B,KAAMuX,SAASwkB,EAAe,OAjDrD,kBAqDSlT,GArDT,0D,qHAwDA,uGACSl3B,KAAKiqC,SAAS,CAAE74B,UAAW,CAAEskB,OAAQ,WAD9C,gD,+GAIA,WACEh0B,GADF,sGAEEE,EAFF,+BAEW,EACTrC,EAHF,uBAIEsC,EAJF,+BAIa,GACX6B,EALF,+BAK4B,IAErBqyB,QAAUryB,EAAKqyB,SAAW,GAC3Bx2B,EAAS8qC,IACX3mC,EAAKqyB,QAAQC,MAAb,gBAA8Bn0B,EAA9B,YAA0CA,EAAWtC,GAC5CA,IAAW8qC,KAAyB,IAAbxoC,IAChC6B,EAAKqyB,QAAQC,MAAb,gBAA8Bn0B,EAA9B,MAXJ,SAcyB7B,KAAKiqC,SAASvmC,GAdvC,WAgByB,OAFjBwzB,EAdR,QAgBchB,QAA+B,IAAbr0B,IACR,MAApBq1B,EAAShB,OAjBb,kCAmB+Bl2B,KAAKsqC,sBAAsBpT,GAnB1D,eAmBUqT,EAnBV,OAoBUC,EAAcD,EAAapoC,KAC/BT,EACAE,EACA,EACAxE,KAAKwB,IAAIW,EAAQgrC,EAAahrC,SAxBpC,kBA2BW,CAAEkrC,UAAWD,EAAa9oC,WA3BrC,cA+BQ,IAAIF,MAAJ,eAAkB01B,EAAShB,OAA3B,qBAA8Cl2B,KAAK2sB,MA/B3D,iD,oHAkCA,8GAKyB,kBAJvBiJ,EADF,+BACwC,KAKpC8U,EAAW9U,EACXlyB,EAAO,KAEPgnC,EAAW9U,EAAQ8U,gBACnBhnC,EAAOkyB,GACK8U,UAXhB,SAayB1qC,KAAKiqC,SAASvmC,GAbvC,UAc0B,OADlBwzB,EAbR,QAcehB,OAdf,sBAeUyU,EAAM,IAAIlC,EAAJ,eACFvR,EAAShB,OADP,qBAC0Bl2B,KAAK2sB,OAEvCuJ,OAASgB,EAAShB,OAChByU,EAnBV,UAqBmB,SAAbD,EArBN,0CAsBWxT,EAASnV,QAtBpB,YAwBM2oB,EAxBN,uBAyBU,IAAIlpC,MAAJ,gCAAmCkpC,IAzB7C,iCA2BS1qC,KAAKsqC,sBAAsBpT,IA3BpC,iD,+GA8BA,iFACOl3B,KAAK0oC,MADZ,gCAEU1oC,KAAK4qC,YAFf,UAIO5qC,KAAK0oC,MAJZ,gCAKU1oC,KAAKspC,KAAKrnC,EAAO4oC,YAAY,IAAK,EAAG,GAAI,GALnD,UAOO7qC,KAAK0oC,MAPZ,sBAQU,IAAIlnC,MAAJ,8CAAiDxB,KAAK2sB,MARhE,gCAUS3sB,KAAK0oC,OAVd,gD,sRClNmBoC,GAxB0BnoB,8BAC7C,eACA,CACEve,KAAM,CACJoG,KAAM,SACNgd,aAAc,IAEhBmF,IAAK,CACHniB,KAAM,SACNgd,aAAc,M,WAkBlB,aAAwD,IAA5CujB,EAA4C,uDAAJ,GAAI,yBAFxDC,YAAkC,GAGhChrC,KAAKgrC,YAAc5N,KAAKC,MAAMD,KAAKE,UAAUyN,I,8CAG/C,SAAWE,GACT,GAAIC,UAAYA,SAASC,qBACvB,OAAOC,IAAcH,GAGvB,GAAItkC,MAAQA,KAAK0kC,cACf,OAAO,IAAI/W,SAAQ,SAACgX,EAASC,GAC3B,IAEE5kC,KAAK0kC,cAAcJ,GACnB,MAAO1oB,GAEP,YADAgpB,EAAOhpB,GAAS,IAAI/gB,MAAJ,yBAA4BypC,KAG9CK,OAGJ,MAAM,IAAI9pC,MACR,2E,+DAIJ,WAAiBgqC,GAAjB,uBAAA7pC,EAAA,0DACQ8pC,EAAY9e,IAAI0Q,MAAMmO,EAAW7e,MAE1B+e,UACY,UAAvBD,EAAUC,UACa,WAAvBD,EAAUC,SALd,iCAOU1rC,KAAK2rC,WAAWH,EAAW7e,KAPrC,UAQUif,EAAaJ,EAAWpnC,KACxBynC,EATV,uBASoCD,GAG1BE,EACa,kBAATnlC,MAAqBA,KAAKA,OAASA,MAAQA,MAChC,kBAAXolC,GAAuBA,EAAOA,SAAWA,GAAUA,GAC3D/rC,KAEI8pB,EAAUgiB,EAAcD,GAjBlC,uBAmBY,IAAIrqC,MAAJ,iBACMoqC,EADN,4BACoCE,EAAME,YAAY5nC,KADtD,YAC8DynC,EAD9D,kBAnBZ,iCAwBW/hB,EAAO/U,SAxBlB,cA0BQ,IAAIvT,MAAJ,8CACmCiqC,EAAUC,SAD7C,MA1BR,iD,2FA+BA,SAAuBhxB,GAErBA,EAAOuxB,eAAiB,GACxBloC,OAAOhD,QAAQmrC,KAAWzuC,SAAQ,YAA0B,uBAAxBmuC,EAAwB,KAAZO,EAAY,KAE1DzxB,EAAOuxB,eAAeL,GAAcO,O,yDAIxC,iCAAAxqC,EAAA,+EACS2yB,QAAQC,IACbv0B,KAAKgrC,YAAYjmC,IAAjB,uCAAqB,WAAMymC,GAAN,SAAA7pC,EAAA,sEACL,EAAKyqC,WAAWZ,GADX,+BAEnBA,EAFmB,mBACnB1hB,OADmB,KAEnB0hB,WAFmB,kDAArB,kCAAAxrC,KAAA,kBAFJ,gD,0ZC/EF,SAASqsC,EAAYC,GACnB,OAAQC,EAAYD,EAAS9hC,MAA0B,EAAlB8hC,EAAS/sC,OAGhD,SAASgtC,EAAY/hC,GACnB,MAAgB,aAATA,GAAgC,aAATA,GAAgC,cAATA,EAIvD,SAASgiC,EAAIC,EAAUxH,EAAgBz6B,EAAckiC,GAC9CD,EAAIjiC,GAAMkiC,KACbD,EAAIjiC,GAAMkiC,GAAS,CAAEC,MAAO,EAAGC,QAAS,CAAE,KAAM,EAAG,EAAK,EAAG,EAAK,KAElEH,EAAIjiC,GAAMkiC,GAAOC,QACjBF,EAAIjiC,GAAMkiC,GAAOE,QAAQ3H,KAG3B,SAAS4H,EAAIJ,EAAUxH,EAAgBz6B,EAAckiC,GAC9CD,EAAIjiC,GAAMkiC,KACbD,EAAIjiC,GAAMkiC,GAAS,CAAEC,MAAO,EAAGC,QAAS,CAAE,KAAM,EAAG,EAAK,EAAG,EAAK,KAElEH,EAAIjiC,GAAMkiC,GAAOC,QACjBF,EAAIjiC,GAAMkiC,GAAOE,QAAQ3H,K,IAGN6H,E,sMACnB,qGACQC,EAAmBtpC,yBAAezD,KAAKoD,OAAQ,cAC/C4pC,EAAevpC,yBAAezD,KAAKoD,OAAQ,CAC/C,aACA,oBAJJ,mBAM4BpD,KAAKozB,qBANjC,aAM4B,OAAApzB,KAAqB+sC,GANjD,UAMQE,EANR,QAQ0BD,EAR1B,2CASYhtC,KAAKozB,qBATjB,aASY,OAAApzB,KAAqBgtC,GATjC,qDAUM5sC,EAVN,WAQQ8sC,EARR,KAYOD,EAZP,uBAaU,IAAIzrC,MAAM,4BAbpB,iCAgBS,CACL2rC,WAAYF,EAAYA,YACxBC,gBAAe,OAAEA,QAAF,IAAEA,OAAF,EAAEA,EAAiBD,cAlBtC,iD,+EAwBA,SAAYvvC,GAA+C,WAA/BgG,EAA+B,uDAAJ,GACrD,OAAOe,2BAAgB,uCAAU,WAAMC,GAAN,qBAAA/C,EAAA,sEACF,EAAKyrC,YADH,uBACvBD,EADuB,EACvBA,WACJE,EAASF,EAAWxZ,YAAYj2B,EAAQgG,GAExCA,EAAK4pC,UACCA,EAAY5pC,EAAZ4pC,QACRD,EAASA,EAAOxoC,KAAKimB,aAAO,SAAA9nB,GAAC,OAAIsqC,EAAQC,OAAOvqC,EAAGU,QANtB,SASZ,EAAK8pC,qBAAqBH,EAAQ3vC,EAAQgG,GAT9B,cAW1BjG,SAAQ,SAACgvC,EAAK9iC,GACb8iC,EAAIE,OACNjoC,EAAS+oC,KACP,IAAIxoC,IAAc,CAChB3E,GAAI,GAAF,OAAK,EAAKA,GAAV,YAAgB5C,EAAOK,MAAvB,YAAgC4L,GAClCjJ,KAAM,CACJgtC,MAAOjB,EAAIE,MACXgB,QAASlB,EACT1uC,MAAOL,EAAOK,MAAQ4L,EACtB1L,IAAKP,EAAOK,MAAQ4L,EAAQ,EAC5B9L,QAASH,EAAOG,eAO1B6G,EAASovB,WA5BsB,4CAAV,sDA6BpBpwB,EAAKa,U,gEAGV,4CAAA5C,EAAA,6DAAkB+B,EAAlB,+BAAsC,GAAtC,SAC+B1D,KAAKotC,YADpC,uBACUD,EADV,EACUA,WADV,kBAESA,EAAWlZ,YAAYvwB,IAFhC,gD,iFAKA,c,yEAUA,WACEmjB,EACAnpB,EACAgG,GAHF,qCAAA/B,EAAA,6DAKUisC,EAAYlqC,EAAZkqC,QALV,SAMoC5tC,KAAKotC,YANzC,mBAMUF,EANV,EAMUA,gBACArvC,EAAwBH,EAAxBG,QAASE,EAAeL,EAAfK,MAAOE,EAAQP,EAARO,IAClB4vC,EAASzwC,KAAKC,KAAKK,EAAOO,IAAMP,EAAOK,OAOvC+vC,EAAW72B,MAAM/U,KAAK,CAAE3C,OAAQsuC,IAAU,iBAAO,CACrDlB,MAAO,EACPoB,QAAS,GACTC,IAAK,GACLC,SAAU,GACVC,OAAQ,GACR73B,IAAK,QAMH62B,EA3BN,kCA4ByBA,EAClBvZ,YAAY,CAAE91B,UAASE,QAAOE,IAAKA,EAAM,EAAGL,aAAc,OAC1DiH,KAAKspC,eACLC,YA/BP,oCA4BWC,EA5BX,KAgCIC,EAAS,OAAGD,QAAH,IAAGA,OAAH,EAAGA,EAAMluC,IAAI,OAhC1B,iCAmCS0mB,EACJhiB,KACC8vB,aAAO,SAAC4Z,EAAM7sB,GAOZ,IANA,IAAM8sB,EAAQ9sB,EAAQvhB,IAAI,SACpBsuC,EAAS/sB,EAAQvhB,IAAI,SACrBuuC,EAAOhtB,EAAQvhB,IAAI,OACnBwuC,EAAUjtB,EAAQvhB,IAAI,UACtByuC,EAAWC,qBAAWL,GAEnBM,EAAIL,EAAQK,EAAIJ,EAAMI,IAAK,CAClC,IAAM9b,EAAI8b,EAAIpxC,EAAOK,MACrB,GAAIi1B,GAAK,GAAKA,EAAIub,EAAKhvC,OAAQ,CAC7B,IAAMktC,EAAM8B,EAAKvb,GACjByZ,EAAIE,QACJH,EAAIC,EAAKkC,EAAS,MAAO,QAI7B,GAAsB,mBAAX,OAAPf,QAAO,IAAPA,OAAA,EAAAA,EAASpjC,MAA0B,CACrC,IAAMukC,EAAMrtB,EAAQvhB,IAAI,OAClB6uC,EAAKC,YAAUvtB,EAAS,KAAM,OAAS,GAEvCwtB,EACHD,YAAUvtB,EAAS,KAAM,OAA+B,GAErDytB,EAAgBD,GACH,kBAAPA,EAAkBA,EAAGE,MAAM,KAAKrqC,KAAI,SAAAiyB,GAAC,OAAKA,KAAKkY,GAAInqC,KACzD,SAAAiyB,GAAC,OAAIA,EAAI,OAEViY,YAAUvtB,EAAS,KAAM,MACvB0tB,MAAM,IACNrqC,KAAI,SAAA2vB,GAAC,OAAIA,EAAE2a,WAAW,GAAK,MAC3BtqC,KAAI,SAAAuqC,GAAG,OAAIlyC,KAAKwB,IAAI,EAAG0wC,EAAM,OAEhCC,EAAY,EAChBC,mCAAyBR,EAAID,GAAKtxC,SAAQ,YAAyB,MAAtB+M,EAAsB,EAAtBA,KAAMilC,EAAgB,EAAhBA,UAC3CC,EAAM,OAAH,OAAUllC,GAD8C,cAE/CmlC,wBAAcf,EAAUa,IAFuB,IAEjE,2BAAsD,KAA3Cj7B,EAA2C,QAC9Co7B,EAAOp7B,EAAMi6B,EAAS/wC,EAAOK,MACnC,GAAI6xC,GAAQ,GAAKA,EAAOrB,EAAKhvC,QAAUiV,EAAMi6B,EAASC,EAAM,CAC1D,IAAMjC,EAAM8B,EAAKqB,GACbT,EAAcI,GAAa,GAC7B/C,EAAIC,EAAKkC,EAAS,MAAOe,GAEzBlD,EAAIC,EAAKkC,EAAS,UAAWe,GAGjCH,KAZ+D,uCAmBhE,GAAsB,iBAAX,OAAP3B,QAAO,IAAPA,OAAA,EAAAA,EAASpjC,MAAwB,CACxC,IAAK8jC,EACH,MAAM,IAAI9sC,MACR,mEAGJ,IAAMutC,EAAMrtB,EAAQvhB,IAAI,OAClB6uC,EAAKC,YAAUvtB,EAAS,KAAM,OAAS,GACvCmuB,EAAW,IAAI54B,MAAMvZ,EAAOO,IAAMP,EAAOK,OAAOqU,KAAK,GAE3Do9B,mCAAyBR,EAAID,GAAKtxC,SAAQ,YAAyB,IAAtB+M,EAAsB,EAAtBA,KAAMilC,EAAgB,EAAhBA,UAEjD,GAAa,MAATjlC,EAAc,qBACEmlC,wBAAcf,EAAUa,IAD1B,IAChB,2BAAsD,KAC9CG,EAD8C,QACjCnB,EAAS/wC,EAAOK,MAC/B6xC,GAAQ,GAAKA,EAAOC,EAAStwC,SAC/BswC,EAASD,GAAQ,IAJL,mCAUpB,IAAK,IAAId,EAAIL,EAAQK,EAAIJ,EAAMI,IAAK,CAClC,IAAM9b,EAAI8b,EAAIpxC,EAAOK,MACrB,GAAIi1B,GAAK,GAAKA,EAAIub,EAAKhvC,OAAQ,CAC7B,IAAMuwC,EAAKxB,EAAUtb,EAAI,GACnB+c,EAAKzB,EAAUtb,GACfyZ,EAAM8B,EAAKvb,GAEQ,MAArB+c,EAAG1lC,eAA8C,MAArBylC,EAAGzlC,gBAC7BwlC,EAAS7c,IACXwZ,EAAIC,EAAKkC,EAAS,MAAO,QACzB9B,EAAIJ,EAAKkC,EAAS,MAAO,SAEzBnC,EAAIC,EAAKkC,EAAS,MAAO,UACzB9B,EAAIJ,EAAKkC,EAAS,MAAO,gBAUjC,IADA,IAAMqB,EAAatuB,EAAQvhB,IAAI,cACtB6yB,EAAI,EAAGA,GAAC,OAAGgd,QAAH,IAAGA,OAAH,EAAGA,EAAYzwC,QAAQyzB,IAGtC,IAFA,IAAMsZ,EAAW0D,EAAWhd,GACtBid,EAASxB,EAASnC,EAASvuC,MACxB+wC,EAAImB,EAAQnB,EAAImB,EAAS5D,EAAYC,GAAWwC,IAAK,CAC5D,IAAMc,EAAOd,EAAIpxC,EAAOK,MACxB,GAAI6xC,GAAQ,GAAKA,EAAOrB,EAAKhvC,OAAQ,CACnC,IAAMktC,EAAM8B,EAAKqB,GACTM,EAAe5D,EAAf4D,KAAM1lC,EAAS8hC,EAAT9hC,KACR2lC,EAAY5D,EAAY/hC,GACzB2lC,EAGH3D,EAAIC,EAAKkC,EAAS,SAAUnkC,GAF5BqiC,EAAIJ,EAAKkC,EAAS,MAAO,OAKd,aAATnkC,GAAgC,SAATA,GACzBgiC,EAAIC,EAAKkC,EAAS,WAAYnkC,GAC9BiiC,EAAIE,SACMwD,GACV3D,EAAIC,EAAKkC,EAAS,MAAOuB,IAOnC,OAAO3B,IACNT,IAEJM,aAnKL,iD,gEAzE8CjpC,0BAgPxCC,EAAiB0nC,EAAjB1nC,c,qBChSR+mC,EAAOhI,QAAU,WACf,OAAO,IAAIiM,OAAO,IAA0B,oC,m2ECIzBloB,E,kDASnB,WACEmoB,GAQA,MAEA,GAFA,qBACA,cAAMA,IAlBRC,kBAiBE,IAfFloB,qBAeE,IAbFtF,kBAaE,IAXFzd,yBAWE,EAEI,iBAAkBgrC,EACpB,EAAKC,aAAeD,EAAMC,iBACrB,MAAI,oBAAqBD,GAG9B,MAAM,IAAI7uC,MAAJ,yEAC8D,EAAK4C,OAHzE,EAAKgkB,gBAAkBioB,EAAMjoB,gBAL/B,OAWA,EAAKtF,aAAeutB,EAAMvtB,aAC1B,EAAKzd,oBAAsBgrC,EAAMhrC,qBAAuB,GAZxD,E,iBAlBqCkrC,I,iHCCpB5sB,E,kDAWnB,WAAY0sB,GAOT,MAOD,GAPC,qBACD,cAAMA,IAlBRntB,gBAiBG,IAfHJ,kBAeG,IAbHzL,oBAaG,IAXHwM,eAWG,IATHxE,cASG,EAED,EAAK6D,WAAamtB,EAAMntB,WACxB,EAAKJ,aAAeutB,EAAMvtB,aAC1B,EAAKzL,eAAiBg5B,EAAMh5B,eAC5B,EAAKwM,UAAYwsB,EAAMxsB,UACvB,EAAKxE,SAAWgxB,EAAMhxB,UACjB,EAAK6D,WACR,MAAM,IAAI1hB,MAAJ,4CAA+C,EAAK4C,OAE5D,IAAK,EAAK0e,aACR,MAAM,IAAIthB,MAAJ,+CAAkD,EAAK4C,OAE/D,IAAK,EAAKiT,eACR,MAAM,IAAI7V,MAAJ,iDAAoD,EAAK4C,OAEjE,IAAK,EAAKyf,UACR,MAAM,IAAIriB,MAAJ,4CAA+C,EAAK4C,OAE5D,IAAK,EAAKib,SACR,MAAM,IAAI7d,MAAJ,2CAA8C,EAAK4C,OAE3D,IAAKosC,0BAAgB,EAAK1tB,cAActY,KAAM,CAC5C,IAAMpG,EAAO,EAAK0e,aAAe,EAAKA,aAAa1e,KAAO,UAC1D,MAAM,IAAI5C,MAAJ,UAAa4C,EAAb,4BAxBP,S,UAlBoCmsC,M,urECDpBE,E,kDAanB,WAAYJ,GAQT,MAQD,GARC,qBACD,cAAMA,IArBRntB,gBAoBG,IAlBHJ,kBAkBG,IAhBHlF,iBAgBG,IAdHnR,iBAcG,IAZHkgB,SAYG,IAVH+jB,2BAUG,EAED,EAAKxtB,WAAamtB,EAAMntB,WACxB,EAAKJ,aAAeutB,EAAMvtB,aAC1B,EAAKlF,YAAcyyB,EAAMzyB,YACzB,EAAKnR,YAAc4jC,EAAM5jC,YACzB,EAAKkgB,IAAM0jB,EAAM1jB,IACjB,EAAK+jB,sBAAwBL,EAAMK,uBAC9B,EAAKxtB,WACR,MAAM,IAAI1hB,MAAJ,+CAAkD,EAAK4C,OAE/D,IAAK,EAAK0e,aACR,MAAM,IAAIthB,MAAJ,iDAAoD,EAAK4C,OAZhE,S,UArBuCmsC,K,SCHxCI,EAAqB,EAEnBC,EAA+C,IAAIC,QAgDzD,IAAMC,EAA0D,IAAIhxC,IAQ7D,SAASixC,EAAT,GAE4B,IADjCC,EACiC,EADjCA,cAEIC,EAA2BH,EAA0B3wC,IAAI6wC,GAK7D,OAJKC,IACHA,EAA2B,IAAIC,gBAC/BJ,EAA0BzwC,IAAI2wC,EAAeC,IAExCA,EAAyB1sC,O,ICxDJ4sC,E,kDAK5B,WAAY75B,GAA8B,kCACxC,cAAM,CAAElT,KAAM,MALhBkT,mBAI0C,IAF1ClT,KAAO,UAIL,EAAKkT,cAAgBA,EAFmB,E,6FAK1C,WAAyB8I,EAAUgxB,GAAnC,eAAAzvC,EAAA,6DACQqH,EAAUE,uBADlB,6CAEckX,GAFd,IAEoBpX,aAFpB,2C,kIAKA,WAKEqoC,EAA4BD,GAL9B,eAAAzvC,EAAA,yDAMM0vC,EAAeroC,SACjBG,qBAAWkoC,EAAeroC,WAEpBzE,EAAW8sC,EAAX9sC,UDMS,kBAHnB8wB,ECFoC9wB,IDMxB,OAAV8wB,KACA,kBAAmBA,IAEY,kBAAxBA,EAAM2b,eCnBf,oEAWgBK,GAXhB,IAWgC9sC,OAAQwsC,EAAuBxsC,MAX/D,2DAcc8sC,GAdd,IAc8B9sC,YAAQnE,KAdtC,iCDWK,IACLi1B,ICZA,O,6HAsBA,WACEic,EACAC,EACAH,GAHF,SAAAzvC,EAAA,+EAKS2vC,GALT,2C,iIAQA,WACEE,EACAD,EACAH,GAHF,SAAAzvC,EAAA,+EAKS6vC,GALT,2C,gEA7CkDjB,K,oCCP9CztB,EAAeH,8BAAoB,oBAAqB,IAE/C,SAASiF,EAAkBtQ,GACxC,OAAO/R,QACJnJ,MAAM,oBAAqB,CAC1BkE,GAAIgF,YACJkF,KAAMjF,QAAMye,QAAQ,qBACpBY,YAAarf,QAAMksC,SACnB10B,KAAMxX,QAAMmsC,cACVp6B,EAAc8uB,iBAAiB,OAAQ,iBAG1C1/B,SAAQ,SAAAC,GAAI,MAAK,CAChBkhB,eADgB,SACDnnB,GACbiG,EAAKie,YAAclkB,GAErBonB,iBAJgB,WAKdnhB,EAAKie,iBAAcxkB,O,iCCf3B,SAASuxC,EACPptB,GAEA,gBAAUqtB,IAAoBrtB,IAQhC,IAAIstB,EAAkD,GAW/C,SAAeC,EAAtB,sC,4CAAO,WACLx6B,EACA+M,EACA0tB,GAHK,iCAAApwC,EAAA,yDAMCqwC,EAAWL,EAAsBI,GAClCF,EAAaG,GAPb,oBAQGrmC,GAAeomC,GAAyB,IAAIvnC,KAR/C,sBAUK,IAAIhJ,MACR,iEAXD,UAcGywC,EAAkB36B,EAAcgvB,eAAe36B,GAdlD,sBAgBK,IAAInK,MAAJ,oCAAuCmK,IAhB5C,UAqBG4Y,EAAgB0tB,EAAgBnvB,aAAaqQ,OACjD4e,EACA,CAAEz6B,kBAGE8b,EAAgB0e,EAAWvI,KAAK,KAAMjyB,EAAe+M,GAMnDisB,EAAkC2B,EAAlC3B,aAAcloB,EAAoB6pB,EAApB7pB,gBAhCnB,KAmCWkoB,EAnCX,uCAmCkCloB,IAnClC,+BAmCG8pB,EAnCH,4BAqCK,IAAI1wC,MAAM,yBArCf,QAwCGyrC,EAAc,IAAIiF,EAAM3tB,EAAe6O,GAG7Cye,EAAaG,GAAY,CACvB/E,cACAkF,WAAY,IAAIrvC,IAAI,CAACuhB,KA7CpB,eAiDC+tB,EAAaP,EAAaG,IACrBG,WAAWpvC,IAAIshB,GAlDrB,kBAoDE+tB,GApDF,6C,sBAiEA,SAASC,EAAqBC,GACnC,IAAIC,EAAc,EAEZC,EAAWzuC,OAAOlB,KAAKyvC,GAI7B,GAAwB,IAApBE,EAASjzC,QAAgC,cAAhBizC,EAAS,GAAoB,KAChDnuB,EAAciuB,EAAdjuB,UACRtgB,OAAOhD,QAAQ8wC,GAAcp0C,SAAQ,YAA4B,uBAA1Bu0C,EAA0B,KAAhBI,EAAgB,KAC/DA,EAAWD,WAAWhR,OAAO9c,GACM,IAA/B+tB,EAAWD,WAAW9jC,OACxBkkC,GAAe,SACRV,EAAaG,YAKxBjuC,OAAOrB,OAAOmvC,GAAcp0C,SAAQ,SAAA20C,GAC7BA,EAAWnF,YAAYwF,eAIxBH,EAActrB,UACbsrB,EAAc50C,OAAS,CAAC40C,EAAc50C,QAAU,KAC3CD,SAAQ,SAACC,QACQ0C,IAAnB1C,EAAOG,SACTu0C,EAAWnF,YAAYwF,cAAc/0C,MAPzCo/B,QAAQU,KAAK4U,EAAWnF,YAAa,uCAc3C,OAAOsF,E,uCC3GIG,EAAb,4MACEtuC,KAAO,kBADT,oFAGE,WACEgc,EAKAuyB,GANF,uBAAAhxC,EAAA,sEAQiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAVJ,cAQQE,EARR,OAYUxuB,EAA6BwuB,EAA7BxuB,UAAWE,EAAkBsuB,EAAlBtuB,cAZrB,SAagCutB,EAC5B9xC,KAAKsX,cACL+M,EACAE,GAhBJ,sBAaU0oB,EAbV,EAaUA,uBAKmB9nC,0BAlB7B,0CAmBW8nC,EAAYhZ,YAAY4e,IAnBnC,iCAqBS,IArBT,iDAHF,8DAAqC1B,GA4BxB2B,EAAb,4MACE1uC,KAAO,cADT,oFAGE,WACEgc,EAKAuyB,GANF,uBAAAhxC,EAAA,sEAQiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAVJ,cAQQE,EARR,OAYUxuB,EAA6BwuB,EAA7BxuB,UAAWE,EAAkBsuB,EAAlBtuB,cAZrB,SAagCutB,EAC5B9xC,KAAKsX,cACL+M,EACAE,GAhBJ,uBAaU0oB,EAbV,EAaUA,YAbV,kBAkBS1X,2BAAiB0X,GACpBA,EAAYrpC,UAAUivC,GACtB,MApBN,gDAHF,8DAAqC1B,GA2BxB4B,EAAb,4MACE3uC,KAAO,kBADT,oFAGE,WACEgc,EAKAuyB,GANF,uBAAAhxC,EAAA,sEAQiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAVJ,cAQQE,EARR,OAYUxuB,EAA6BwuB,EAA7BxuB,UAAWE,EAAkBsuB,EAAlBtuB,cAZrB,SAagCutB,EAC5B9xC,KAAKsX,cACL+M,EACAE,GAhBJ,uBAaU0oB,EAbV,EAaUA,YAbV,kBAkBS1X,2BAAiB0X,GACpBA,EAAY+F,YAAYH,GACxB,MApBN,gDAHF,8DAAqC1B,GA2BxB8B,GAAb,4MACE7uC,KAAO,kBADT,8FAGE,WAAwB+vB,GAAxB,SAAAxyB,EAAA,+EACSwyB,EAAMpvB,KAAI,SAAAspC,GACf,OAAO,IAAIppC,IAAcopC,OAF7B,2CAHF,mHASE,WACEjuB,EAMAuyB,GAPF,6BAAAhxC,EAAA,sEASiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAXJ,cASQE,EATR,OAaUxuB,EAAqCwuB,EAArCxuB,UAAWE,EAA0BsuB,EAA1BtuB,cAAe7mB,EAAWm1C,EAAXn1C,OAbpC,SAcgCo0C,EAC5B9xC,KAAKsX,cACL+M,EACAE,GAjBJ,mBAcU0oB,EAdV,EAcUA,aAKJ1X,2BAAiB0X,GAnBvB,wBAoBU3H,EAAM2H,EAAYtZ,YAAYj2B,GApBxC,UAqBoB4nC,EAAIzgC,KAAKspC,eAAWC,YArBxC,eAqBU9lB,EArBV,yBAsBWA,EAAEvjB,KAAI,SAAA/B,GAAC,OAAIA,EAAE/B,aAtBxB,iCAwBS,IAxBT,iDATF,8DAAqCkwC,GA2CxB+B,GAAb,4MACE9uC,KAAO,oBADT,oFAGE,WAAckuC,GAAd,eAAA3wC,EAAA,6DACM4wC,EAAc,EAElBA,GAAeF,EAAqBC,GAGpCtyC,KAAKsX,cAAc67B,mBAAmB11C,SAAQ,SAAAslB,GAC5C,IAAMqwB,EAAQrwB,EAAS0vB,gBACnBW,IACFb,GAAea,MATrB,kBAaSb,GAbT,gDAHF,4DAAuCpB,GAmC1BkC,GAAb,4MACEjvC,KAAO,aADT,+FAGE,WAAyBgc,EAAkBuyB,GAA3C,yBAAAhxC,EAAA,2DACQ+7B,EADR,UAC0B19B,KAAKsX,cAAc8S,iBAD7C,iBAC0B,EAA8BhV,eADxD,aAC0B,EACpBsoB,iBAFN,gCAIY4V,gCAAsB5V,EAAiBtd,GAJnD,8CAKMA,EALN,UAGQmzB,EAHR,KAO6B,wBAAvBZ,EAPN,0CAQWY,GARX,eAWUvW,EAAiB5c,EAAjB4c,aAEF+I,EAAeyN,GACnBxW,EACAh9B,KAAKsX,cAAc0uB,gBAAgBhJ,IAfvC,kBAkBS+I,EAAa0N,sBAAsBF,IAlB5C,iDAHF,qHAwBE,WACEnzB,EACAuyB,GAFF,mCAAAhxC,EAAA,yDAIMkxC,EAAmBzyB,EACI,wBAAvBuyB,EALN,gCAM6B3yC,KAAK4yC,qBAC5BxyB,EACAuyB,GARN,OAMIE,EANJ,iBAWUxuB,GAXV,EAW6DwuB,GAAnDxuB,UAAWE,EAXrB,EAWqBA,cAAeyY,EAXpC,EAWoCA,aAAcz4B,EAXlD,EAWkDA,OAC3C8f,EAZP,sBAaU,IAAI7iB,MAAM,iCAbpB,cAgBEkyB,2BAAiBnvB,GAhBnB,UAkBgCutC,EAC5B9xC,KAAKsX,cACL+M,EACAE,GArBJ,qBAkBU0oB,EAlBV,EAkBUA,uBAKqB9nC,yBAvB/B,uBAwBU,IAAI3D,MAAJ,6DACkDyrC,IAzB5D,WA6BQlH,EAAeyN,GACnBxW,EACAh9B,KAAKsX,cAAc0uB,gBAAgBhJ,IAG/BC,EAlCR,2BAmCO4V,GAnCP,IAoCI5F,gBAIuB,wBAAvB0F,EAxCJ,kCAyCc5M,EAAa2N,OAAOzW,GAzClC,6DA0Cc8I,EAAa4N,eAAe1W,GA1C1C,mCAuCQ76B,EAvCR,KA4CEsxB,2BAAiBnvB,GA5CnB,kBA6CSnC,GA7CT,iDAxBF,+HAwEE,WACEovC,EACApxB,EACAuyB,GAHF,iBAAAhxC,EAAA,yDAK6B,wBAAvBgxC,EALN,yCAMWnB,GANX,cASUxU,EAAiB5c,EAAjB4c,aACF+I,EAAeyN,GACnBxW,EACAh9B,KAAKsX,cAAc0uB,gBAAgBhJ,IAZvC,kBAcS+I,EAAa6N,2BAClBpC,EACApxB,IAhBJ,gDAxEF,gEAAgC+wB,GA6FhC,SAASqC,GAAwBxW,EAAsB+I,GACrD,IAAKA,EACH,MAAM,IAAIvkC,MAAJ,oBAAuBw7B,EAAvB,gBAGR,IAAK+I,EAAa1uB,eAChB,MAAM,IAAI7V,MAAJ,mBACQw7B,EADR,qEAKR,KAAM+I,aAAwBlU,KAC5B,MAAM,IAAIrwB,MACR,+EAGJ,OAAOukC,E,IC1RY8N,G,4MACnBzvC,KAAO,a,6CAEP,SAAQkT,GAENvT,OAAOrB,OAAOoxC,GAAgBr2C,SAAQ,SAAAs2C,GACpCz8B,EAAc08B,cAAa,kBAAM,IAAID,EAAUz8B,SAGjDA,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,oBACNglB,QAAS,kBACTtG,eACAI,WAAY0E,EAAkBtQ,GAC9BD,eAAgBkS,gBACd,kBAAM,qD,GAhBwBC,K,UC8BlCyqB,G,WAKJ,aAAwC,yBAJxCC,eAAiB,IAAIp0C,IAImB,KAFxCq0C,WAA0B,GAEc,2BAAzBA,EAAyB,yBAAzBA,EAAyB,gBACtCn0C,KAAKm0C,WAAaA,E,uCAGpB,SAAIC,EAAkB17B,GACpB,IAAK1Y,KAAKm0C,WAAWjpB,SAASkpB,GAC5B,MAAM,IAAI5yC,MAAJ,wBAA2B4yC,IAEnC,IAAIF,EAAiBl0C,KAAKk0C,eAAe/zC,IAAIi0C,GACxCF,IACHA,EAAiB,GACjBl0C,KAAKk0C,eAAe7zC,IAAI+zC,EAAOF,IAEjCA,EAAeh1C,KAAKwZ,K,iBAGtB,WAAM,WACJ1Y,KAAKm0C,WAAW12C,SAAQ,SAAA42C,GACtB,IAAMH,EAAiB,EAAKA,eAAe/zC,IAAIk0C,GAC3CH,GACFA,EAAez2C,SAAQ,SAAAib,GAAQ,OAAIA,c,KAiBrC47B,G,WAYJ,WACEC,EACAC,GAMA,yBAnBFC,gBAAoD,GAmBlD,KAjBFC,eAiBE,OAVFH,cAUE,EACAv0C,KAAKu0C,SAAWA,EAChBv0C,KAAK00C,UAAYF,E,uCAGnB,SAAIpwC,EAAcuwC,GAChB30C,KAAKy0C,gBAAgBrwC,GAAQuwC,I,iBAG/B,SAAIvwC,GACF,OAAOA,KAAQpE,KAAKy0C,kB,iBAGtB,SAAIrwC,GACF,IAAKpE,KAAK2C,IAAIyB,GACZ,MAAM,IAAI5C,MAAJ,UACDxB,KAAKu0C,SADJ,aACiBnwC,EADjB,kFAIR,OAAOpE,KAAKy0C,gBAAgBrwC,K,iBAG9B,WACE,OAAOL,OAAOrB,OAAO1C,KAAKy0C,qB,KAwBTG,G,WAyCnB,aAAgE,WAApDC,EAAoD,uDAAJ,GAAI,yBAxChEjqB,QAAoB,GAwC4C,KArChEkqB,KAAYC,eAqCoD,KAnChEhqB,eAAiD,GAmCe,KAjChEiqB,yBAA+C,GAiCiB,KA/BhEC,wBAA0B,IAAIhB,GAC5B,WACA,UACA,UACA,QACA,aACA,OACA,SACA,cAuB8D,KApBhEiB,cAAgB,IAAIZ,GAAW,eAAgBvO,KAoBiB,KAlBhEoP,aAAe,IAAIb,GAAW,cAAepsB,KAkBmB,KAhBhEktB,WAAa,IAAId,GAAW,YAAa3rB,KAgBuB,KAdhEsf,aAAe,IAAIqM,GAAW,cAAe3wB,KAcmB,KAZhE0xB,gBAAkB,IAAIf,GAAW,iBAAkB7D,GAYa,KAVhE6E,UAAY,IAAIhB,GAAW,WAAY3iB,KAUyB,KARhE4jB,YAAc,IAAIjB,GAAW,aAAcnrB,KAQqB,KANhEqsB,WAAa,IAAIlB,GAAW,gBAAiBnD,GAMmB,KAJhEsE,YAAa,EAImD,KAFhErrB,eAEgE,OAyLhEsrB,eAAiB,IAAI51C,IAzL2C,KA2LhE2jB,IAAMyoB,IA3L0D,KA6LhExoB,KAAO,SAA4BD,GAIjC,OAHK,EAAKiyB,eAAe/yC,IAAI8gB,IAC3B,EAAKiyB,eAAer1C,IAAIojB,EAAKA,EAAI,IAE5B,EAAKiyB,eAAev1C,IAAIsjB,IAjM+B,KA0MhEf,UAAY,SACVe,GAGA,GAAmB,kBAARA,EAAkB,CAC3B,IAAMkyB,EAAO,EAAKlyB,IAAIA,GACtB,IAAKkyB,EACH,MAAM,IAAIvM,UAAJ,sDAC2C3lB,EAD3C,0IAIR,OAAOkyB,EAGT,GAAmB,oBAARlyB,EACT,OAAO,EAAKC,KAAKD,GAGnB,GAAIA,EAAI1O,QACN,OAAO,EAAK2N,UAAUe,EAAI1O,SAG5B,MAAM,IAAIq0B,UACR,kEA/NFppC,KAAK0sB,UAAU,CAAE5C,OAAQ,IAAI+pB,GAAcxL,SAAU,CAAErd,QAAQ,KAG/D6pB,EAAep3C,SAAQ,SAAAqsB,GACrB,EAAK4C,UAAU5C,M,8DAInB,WACE,IAAM8rB,EAAmD,GAMzD,OALA51C,KAAK4qB,QAAQntB,SAAQ,SAAAqsB,GACfA,EAAO+I,sBACT+iB,EAAqB9rB,EAAO1lB,MAAQ0lB,EAAO+I,wBAGxC+iB,I,uBAGT,SAAUlyB,GACR,GAAI1jB,KAAKy1C,WACP,MAAM,IAAIj0C,MAAM,kDAFiD,MAKjEkiB,aAAgB8F,IAAS,CAAC9F,EAAM,IAAM,CAACA,EAAKoG,OAAQpG,EAAK2kB,UALQ,mBAI5Dve,EAJ4D,YAIpDue,OAJoD,MAIzC,GAJyC,EAOnE,GAAIroC,KAAK4qB,QAAQM,SAASpB,GACxB,MAAM,IAAItoB,MAAM,4BASlB,OANAxB,KAAK+qB,eAAejB,EAAO1lB,MAAQikC,EAC/B,eAAgB3kB,GAClB1jB,KAAKg1C,yBAAyB91C,KAAKwkB,EAAK8nB,YAE1C1hB,EAAO+rB,QAAQ71C,MACfA,KAAK4qB,QAAQ1rB,KAAK4qB,GACX9pB,O,uBAGT,SAAUoE,GACR,OAAOpE,KAAK4qB,QAAQiM,MAAK,SAAA1M,GAAC,OAAIA,EAAE/lB,OAASA,O,uBAG3C,SAAUA,GACR,YAAgChE,IAAzBJ,KAAK81C,UAAU1xC,K,qCAGxB,WAKE,OAFApE,KAAKi1C,wBAAwBc,aACtB/1C,KAAKi1C,wBACLj1C,O,0BAGT,SAAaoqB,GACXpqB,KAAKoqB,UAAYA,I,uBAGnB,WAAY,WACV,GAAIpqB,KAAKy1C,WACP,MAAM,IAAIj0C,MAAM,sBASlB,OANAxB,KAAK4qB,QAAQntB,SAAQ,SAAAqsB,GAAM,OAAIA,EAAOsjB,UAAU,MAEhDptC,KAAKy1C,YAAa,EAIXz1C,O,kCAGT,SACEg2C,GAEA,OAAQA,GACN,IAAK,UACH,OAAOh2C,KAAKm1C,aACd,IAAK,aACH,OAAOn1C,KAAKq1C,gBACd,IAAK,SACH,OAAOr1C,KAAKu1C,YACd,IAAK,WACH,OAAOv1C,KAAKk1C,cACd,IAAK,UACH,OAAOl1C,KAAKioC,aACd,IAAK,QACH,OAAOjoC,KAAKo1C,WACd,IAAK,OACH,OAAOp1C,KAAKs1C,UACd,IAAK,aACH,OAAOt1C,KAAKw1C,WACd,QACE,MAAM,IAAIh0C,MAAJ,gCAAmCw0C,EAAnC,S,4BAIZ,SACEA,EACAC,GACA,WACA,GAAgC,oBAArBA,EACT,MAAM,IAAIz0C,MACR,qEAGJ,IAAM00C,EAAal2C,KAAKm2C,qBAAqBH,GAiB7C,OAfAh2C,KAAKi1C,wBAAwBlyC,IAAIizC,GAAW,WAC1C,IAAMI,EAAaH,EAAiB,GACpC,IAAKG,EAAWhyC,KACd,MAAM,IAAI5C,MAAJ,uBAA0Bw0C,EAA1B,kBAGR,GAAIE,EAAWvzC,IAAIyzC,EAAWhyC,MAC5B,MAAM,IAAI5C,MAAJ,UACDw0C,EADC,YACYI,EAAWhyC,KADvB,kDAKR8xC,EAAWnzC,IAAIqzC,EAAWhyC,KAAMgyC,MAG3Bp2C,O,4BAGT,SAAeg2C,EAAsCzB,GAEnD,OADmBv0C,KAAKm2C,qBAAqBH,GAC3B71C,IAAIo0C,K,oCAGxB,SAAuByB,GAErB,OADmBh2C,KAAKm2C,qBAAqBH,GAC3BzhB,Q,8BAIpB,SACE8hB,EACAC,GAEA,IADA5+B,EACA,uDADqBnS,QAAM+B,MAAM/B,QAAMgxC,MAEjCC,EAAkC,GAYxC,OAXAx2C,KAAKm2C,qBAAqBE,GACvB9hB,MACA92B,SAAQ,SAAAk3C,GACP,IAAMtf,EAAQsf,EAAE2B,GACZG,iBAAOphB,IAAUqhB,sBAAYrhB,IAC/BmhB,EAAet3C,KAAKm2B,MAMI,IAA1BmhB,EAAej3C,QACjBu9B,QAAQU,KAAR,sDACiD6Y,EADjD,cACgEC,EADhE,OAGO5+B,GAEFnS,QAAMsC,MAAN,MAAAtC,QAAeixC,K,uCAIxB,SACEH,GAEA,IADAC,EACA,uDADoC,eAE9BE,EAA+C,GAYrD,OAXAx2C,KAAKm2C,qBAAqBE,GACvB9hB,MACA92B,SAAQ,SAAAk3C,GACP,IAAMtf,EAAQsf,EAAE2B,GACZK,wCAA8BthB,IAChCmhB,EAAet3C,KAAKm2B,MAGI,IAA1BmhB,EAAej3C,QACjBi3C,EAAet3C,KAAKyjB,8BAAoB,OAAQ,KAE3Cpd,QAAMsC,MAAN,MAAAtC,QAAeixC,K,6BA+CxB,SAAgBjC,GACd,OAAOv0C,KAAKk1C,cAAc/0C,IAAIo0C,K,8BAGhC,WACE,OAAOv0C,KAAKk1C,cAAc3gB,Q,4BAG5B,SAAeggB,GACb,OAAOv0C,KAAKm1C,aAAah1C,IAAIo0C,K,0BAG/B,SAAaA,GACX,OAAOv0C,KAAKo1C,WAAWj1C,IAAIo0C,K,4BAG7B,SAAeA,GACb,OAAOv0C,KAAKioC,aAAa9nC,IAAIo0C,K,yBAG/B,SAAYA,GACV,OAAOv0C,KAAKs1C,UAAUn1C,IAAIo0C,K,2BAG5B,SAAcA,GACZ,OAAOv0C,KAAKu1C,YAAYp1C,IAAIo0C,K,+BAG9B,SAAkBA,GAChB,OAAOv0C,KAAKq1C,gBAAgBl1C,IAAIo0C,K,8BAGlC,SAAiBqC,GACf,OAAO52C,KAAKw1C,WAAWr1C,IAAIy2C,K,6BAG7B,SACEX,GAEA,OAAOj2C,KAAK62C,eAAe,WAAYZ,K,4BAGzC,SACEA,GAEA,OAAOj2C,KAAK62C,eAAe,UAAWZ,K,0BAGxC,SACEA,GACM,WAkBN,OAAOj2C,KAAK62C,eAAe,SAfV,WACf,IAAM9uC,EAAQkuC,EAAiB,GAY/B,OAXE,EAAKa,uBAAuB,WAA6Br5C,SACzD,SAAAka,GAEIA,EAAQkM,YAAc9b,EAAM3D,MAE3B2D,EAAMkgC,aAAa/c,SAASvT,IAE7B5P,EAAM8gB,eAAelR,MAIpB5P,O,4BAKX,SACEkuC,GAEA,OAAOj2C,KAAK62C,eAAe,UAAWZ,K,yBAGxC,SACEA,GACM,WAgBN,OAAOj2C,KAAK62C,eAAe,QAfV,WACf,IAAME,EAAUd,EAAiB,GAYjC,OAXE,EAAKa,uBAAuB,WAA6Br5C,SACzD,SAAAka,GAEIA,EAAQ0H,WAAa03B,EAAQ3yC,MAE5B2yC,EAAQ9O,aAAa/c,SAASvT,IAE/Bo/B,EAAQluB,eAAelR,MAItBo/B,O,2BAKX,SACEd,GAEA,OAAOj2C,KAAK62C,eAAe,SAAUZ,K,+BAGvC,SACEA,GAEA,OAAOj2C,KAAK62C,eAAe,aAAcZ,K,0BAG3C,SACEA,GAEA,OAAOj2C,KAAK62C,eAAe,aAAcZ,O,uLCvgBtC,WACL7rB,EACA4sB,EACAC,GAHK,iCAAAt1C,EAAA,4DAKO,uCAENu1C,EAAsB9sB,EAAUC,QAAQkb,OAAOza,QACnD,SAAC/iB,GAAD,OAAiBtE,yBAAesE,EAAO,kBAAoB,IAAIxI,OAAS,KACxEA,OAEI43C,EAAoBpzC,OAAOlB,KAAKu0C,cAActsB,QAAO,SAAA1mB,GAAI,OAC7DA,EAAK8mB,SAAS,kBACd3rB,OAEe6D,EAAkCgnB,EAA3CC,QAAiBjV,EAA0BgV,EAA1BhV,QAAkBiiC,EAAQjtB,EAAjBwI,QAC1B2S,EAAgCniC,EAAhCmiC,OAAQ+R,EAAwBl0C,EAAxBk0C,WAAY1sB,EAAYxnB,EAAZwnB,QAGtB2sB,EAAsB,CAC1BF,MACA,iBAAwB,OAAPzsB,QAAO,IAAPA,OAAA,EAAAA,EAASrrB,SAAU,EACpC,sBAAgBqrB,QAAhB,IAAgBA,OAAhB,EAAgBA,EAAS7lB,KAAI,SAAColB,GAAD,OAAYA,EAAE/lB,QAAM0Z,KAAK,KACtD,mBAAoBw5B,EAAW/3C,OAC/B,eAAgBgmC,EAAOhmC,OACvB,wBAA+B,OAAP6V,QAAO,IAAPA,OAAA,EAAAA,EAASqxB,cAAclnC,SAAU,EACzD,cAAqB,OAAP6V,QAAO,IAAPA,OAAA,EAAAA,EAAS6J,MAAM1f,SAAU,EACvC,uBAAwB23C,EACxB,uBAAwBC,EAGxB,+BAA2C,OAAZF,QAAY,IAAZA,OAAA,EAAAA,EAAc7H,MAAM,KAAK,KAAM,OAG9D,QAAS3yC,OAAO+6C,OAAO/2C,OACvB,QAAShE,OAAO+6C,OAAOh7C,MAGvB,QAASC,OAAOg7C,YAChB,QAASh7C,OAAOC,WAEhBwE,SAA4B,qBAAXzE,QAA0Bgb,QAAQhb,OAAOyE,UAC1Dw2C,UAAWpuC,KAAKC,MAAQytC,GAAoB,IAC5CW,KAAK,GAIPpS,EAAO9nC,SAAQ,SAACsK,GACdwvC,EAAM,eAAD,OAAgBxvC,EAAMyC,OACzB+sC,EAAM,eAAD,OAAgBxvC,EAAMyC,OAAU,GAAK,KAIvC,OAAP4K,QAAO,IAAPA,KAASqxB,cAAchpC,SAAQ,SAACsK,GAC9BwvC,EAAM,sBAAD,OAAuBxvC,EAAMyC,OAChC+sC,EAAM,sBAAD,OAAuBxvC,EAAMyC,OAAU,GAAK,KAI/CotC,EAAK7zC,OAAOlB,KAAK00C,GACpBxyC,KAAI,SAAA/F,GAAG,gBAAOA,EAAP,YAAcu4C,EAAMv4C,OAC3B8e,KAAK,KA7DH,kBA+DEkQ,MAAM,GAAD,OA1DA,uCA0DA,YAAW4pB,KA/DlB,6C,oEAkEA,WACLxtB,EACA4sB,GAFK,uBAAAr1C,EAAA,sDAIe,eACd41C,EAAsB,CAC1B,eAAgBntB,EAAUC,QAAQkb,OAAOhmC,OACzC83C,IAAKjtB,EAAUwI,QACf1xB,SAA4B,qBAAXzE,QAA0Bgb,QAAQhb,OAAOyE,UAC1Dw2C,SAAUpuC,KAAKC,MAAQytC,EACvBa,aACE,UAAAztB,EAAUC,QAAQO,eAAlB,eAA2B7lB,KAAI,SAAC+kB,GAAD,OAAiBA,EAAO1lB,UAAS,IAIhE0zC,EACF,+EACFA,GACE,iFACFA,GACE,kFACFA,GACE,qFACFA,GAAmB,iBAAJ,OAnBK,eAmBL,iCAETC,EAAuB,GACJ,kGAER3I,MAAM,OAAO3xC,SAAQ,SAACuB,EAAK2K,GAC1CouC,EAAO,YAAD,OAAapuC,EAAQ,IAAO4tC,EAAMv4C,MAG1C+4C,EAAOC,QAAU56C,KAAK66C,MAAMV,EAAMG,UAElCI,GAAmB,wCAAJ,OAA4C1a,KAAKE,UAC9Dya,GADa,OAITG,EAAsBhN,SAASiN,cAAc,WAC/BC,UAAYN,EAEhC5M,SAASC,qBAAqB,QAAQ,GAAGkN,YAAYH,GAzChD,6C,sECvEP,SAASI,GAAY/4C,GACnB,OAAO9C,YAEHwa,MAAA,KAAWxa,8BAA8B,IAAI87C,WAA7C,EAAwDh5C,KAAxD,KACO,SAAAy1B,GAAC,OAAI9N,oBAAJ,MADR,KAFGzqB,qCAAP,GAUF,IAAM+7C,GAAU,SAACz2B,EAAD,GACd,OAAO02B,kBAAP,YAGIC,GAAU,SAAC32B,EAAD,GAEd,OADc02B,eAAd,GACOE,SAAP,OAmBF,SAASC,GAAYjO,GACnB,IAEE,OADYvN,WAAZ,GACA,QACA,SACA,OAAOuN,GAIX,mD,8CAAO,6CAAAhpC,EAAA,6DAKCk3C,EALD,UAKWC,uBAAa1b,eALxB,KAMC2b,EAAWT,GANZ,GAOCU,EAAmBR,GAAQK,EAP5B,IASCn4C,EAAO,IATR,UAULA,oBACAA,gCAA6B4I,KAA7B5I,QACAA,sBAZK,SAckBstB,MAAM,GAAD,kBAAgB,CAC1C0H,OAD0C,OAE1CqU,KAF0C,OAG1CkP,KAAMv4C,IAjBH,WAcCw2B,EAdD,6CAqBeA,EArBf,qBAqBGyT,EArBH,OAsBG,UAAUiO,GAtBb,6BAwBc1hB,EAxBd,sBAwBC/I,EAxBD,yBAyBE,CACLA,KADK,EAEL6qB,iBAFK,EAGLD,aA5BG,6C,sBAgCP,qD,8CAAO,2CAAAp3C,EAAA,6DAMC0iB,EAAY60B,kBANb,GAOCvsB,EAPD,8CASkBqB,MAAMrB,EAAK,CAChCpoB,WAVG,WASC2yB,EATD,4CAceA,EAdf,oBAcGyT,EAdH,OAeG,UAAUiO,GAfb,6BAkBc1hB,EAlBd,sBAkBC/I,EAlBD,yBAmBEuqB,GAAQvqB,EAAD,QAnBT,iD,+FC3EA,SAAegrB,GAAtB,yC,8CAAO,WACL38C,EACAiE,EACAiD,EAIA01C,GAPK,+BAAAz3C,EAAA,yDASG6gC,EAAyC9+B,EAAzC8+B,UATH,EAS4C9+B,EAA9B8b,6BATd,MASsC,EATtC,GAUDgjB,GAAcA,EAAU6W,gBAVvB,uBAWGC,EAAa,IAAIC,KAAwB/8C,EAAOiE,GAChD+4C,EAAUF,EAAWx5B,WAAW,MAZnC,SAaGs5B,EAAGI,GAbN,gCAcI,CACL9d,aAAc4d,EAAWG,qBAfxB,WAkBDjX,IAAaA,EAAU6W,gBAlBtB,wBAmBW,EACRz5B,EAAS85B,aAAat8C,KAAKC,KADnB,EACwBb,GADxB,EACwCiE,IAChDk5C,EAAM/5B,EAAOE,WAAW,OAC1B85B,MAHU,KAnBX,UAuBGR,EAAGO,GAvBN,kBAAAh4C,EAAA,KA8BUnF,EA9BV,KA+BWiE,GAENmf,EAAOi6B,cAjCZ,6BAkCeC,gBAlCf,UAmCiBl6B,EAAOi6B,cAAc,CACzBrvC,KAAM,cApCnB,qGAuCSoV,EAAOm6B,YAvChB,+BA8BGv9C,MA9BH,KA+BGiE,OA/BH,KAgCGu5C,UAhCH,yEA4BDte,aA5BC,sBA8CC9b,EAAS85B,aACbt8C,KAAKC,KAAKb,EAAQgjB,GAClB/e,EAAS+e,IAELm6B,EAAM/5B,EAAOE,WAAW,OAC1B85B,MAAMp6B,EAAuBA,GAnD5B,UAoDC45B,EAAGO,GApDJ,yBAsDqBM,aAAkBr6B,GAtDvC,8CAsDIH,UAtDJ,oD,0BC+BuBy6B,G,4MAC5BC,aAAc,E,mFAEd,WAAatxC,GAAb,sCAAAlH,EAAA,sEACyB3B,KAAK2zB,YAAY9qB,GAD1C,cACQge,EADR,OAEUpmB,EAA6BoI,EAA7BpI,OAAQumB,EAAqBne,EAArBme,QAASnqB,EAAYgM,EAAZhM,QAF3B,cAGmBmqB,EAHnB,GAGStpB,EAHT,KAIQlB,GAASkB,EAAOO,IAAMP,EAAOK,OAASlB,EAJ9C,SAMoBs8C,GAChB38C,EACAiE,EACAoI,GACA,SAAC8wC,GAAD,OACE,EAAKS,KAAKT,EAAV,2BACK9wC,GADL,IAEEge,iBAbR,cAMQ7kB,EANR,wHAkBO6G,GACA7G,GAnBP,IAoBI6kB,WACApmB,SACAjE,WAtBJ,eAiBQ69C,EAjBR,gEA0BOA,GACAr4C,GA3BP,IA4BI6kB,WACApmB,SACAjE,WA9BJ,iD,4DAHuD89C,M,UCyC1C51C,4BAzEf,SAAyByM,GAStB,IAEC6V,EAQE7V,EARF6V,QACAH,EAOE1V,EAPF0V,SACAhqB,EAMEsU,EANFtU,QACAL,EAKE2U,EALF3U,MACAiE,EAIE0Q,EAJF1Q,OAND,EAUG0Q,EAHF8wB,oBAPD,MAOgB,aAPhB,IAUG9wB,EAFF8oB,mBARD,MAQe,aARf,IAUG9oB,EADF2wB,sBATD,MASkB,aATlB,EAWMpkC,EAXN,YAWgBspB,EAXhB,MAYK3Q,EAAM3C,iBAAuB,MAEnC,SAAS6mC,EAAqBC,GAE5B,IAAI54C,EAAS,EACTyU,EAAIpC,UACNrS,EAASyU,EAAIpC,QAAQkmB,wBAAwB55B,MAE/C,IAGI44B,EAT8C,EAM5C3X,EAAUg5B,EAAe54C,EACzB64C,EAAK/8C,EAAOQ,SAAW1B,EAAQglB,EAAUA,EACzCk5B,EAAWh9C,EAAOK,MAAQlB,EAAU49C,EARQ,eAU5B5zB,EAASnkB,UAVmB,IAUlD,2BAAyC,KAA9Bgf,EAA8B,QACvC,GAAIg5B,GAAYh5B,EAAQvhB,IAAI,QAAUu6C,GAAYh5B,EAAQvhB,IAAI,SAAU,CACtEg5B,EAAoBzX,EACpB,QAb8C,8BAgBlD,OAAOyX,EAET,OACE,yBACE9iB,IAAKA,EACLE,cAAY,wBACZ0jB,YAAa,SAAAnmB,GACX,IAAMqlB,EAAoBohB,EAAqBzmC,EAAMimB,SACrDE,EACEnmB,EACAqlB,EAAoBA,EAAkB74B,UAAOF,IAGjD+W,QAAS,SAAArD,GACP,IAAMqlB,EAAoBohB,EAAqBzmC,EAAMimB,SACrD+H,EACEhuB,EACAqlB,EAAoBA,EAAkB74B,UAAOF,IAGjD6hC,aAAc,SAAAnuB,GAAK,OAAImuB,EAAanuB,IACpCW,KAAK,eACLxB,UAAU,kBACVd,MAAO,CACL0J,SAAU,UACVha,SAAU,WACVpB,WAGF,kBAAC,qBAAsB0Q,OCzEdwR,iCACb,gBACA,CACE1X,eAAgB,CACdT,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,oBAGzB,CAAE6b,iBAAiB,I,4CCUd,SAAS03B,GAAT,GAMO,IACRf,EADQ,IALZgB,cAKY,MALH,GAKG,MAJZ5kB,aAIY,MAJJ,GAII,EAHZ6kB,EAGY,EAHZA,UACAC,EAEY,EAFZA,WACAC,EACY,EADZA,SACY,cAEOH,EAFP,GAELh8C,EAFK,KAEAD,EAFA,KAGZ,QAAYyB,IAARxB,QAA6BwB,IAARzB,EACvB,MAAM,IAAI6C,MAAM,kBAElB,GAAkB,WAAdq5C,EACFjB,EAAQoB,oBACH,GAAkB,QAAdH,GACTjB,EAAQqB,gBACF/K,KAAK,OACN,IAAkB,aAAd2K,EAGT,MAAM,IAAIr5C,MAAM,uBAFhBo4C,EAAQsB,eAIVtB,EAAMgB,YAAsBx6C,IAAf06C,EAA2B,CAACl8C,EAAKk8C,EAAYn8C,GAAO,CAACC,EAAKD,IAEvEi7C,EAAMuB,OAlBM,kBAoBiBnlB,EApBjB,GAoBLolB,EApBK,KAoBKC,EApBL,KAqBZ,QAAiBj7C,IAAbg7C,QAAuCh7C,IAAbi7C,EAC5B,MAAM,IAAI75C,MAAM,iBAKlB,OAHAo4C,EAAM5jB,MAAM+kB,EAAW/kB,EAAMslB,QAAQC,UAAYvlB,GAG1C4jB,EAOF,SAAS4B,GAAUX,GAaxB,MAAkB,QAAdA,EACK,EAEF,EAcF,SAASY,GAAT,GAQJ,IAPDZ,EAOC,EAPDA,UACAD,EAMC,EANDA,OACAz9B,EAKC,EALDA,OAKC,cAC4BA,EAD5B,GACMu+B,EADN,KACgBC,EADhB,mBAEgBf,EAFhB,GAEIh8C,EAFJ,KAESD,EAFT,KAqBD,GAjBkB,WAAdk8C,IACEl8C,EAAM,IACRA,EAAM,GAEJC,EAAM,IACRA,EAAM,IAGQ,QAAdi8C,IAKU,IAARj8C,GAAaA,EAAM,KACrBA,EAAM,QAGEwB,IAARxB,QAA6BwB,IAARzB,EACvB,MAAM,IAAI6C,MAAM,uBAEDpB,IAAbs7C,GAA0BA,IAAaxjB,OAAO0jB,YAChDh9C,EAAM88C,QAESt7C,IAAbu7C,GAA0BA,IAAazjB,OAAOC,YAChDx5B,EAAMg9C,GAER,IAcM/B,EAde,SAACpvC,GACpB,GAAa,WAATA,EACF,OAAOwwC,eAET,GAAa,QAATxwC,EAAgB,CAClB,IAAMovC,EAAQqB,eAEd,OADArB,EAAM1J,KAAK,GACJ0J,EAET,GAAa,aAATpvC,EACF,OAAO0wC,eAET,MAAM,IAAI15C,MAAJ,8BAAiCgJ,IAE3BqxC,CAAahB,GAI3B,OAFAjB,EAAMgB,OAAO,CAACh8C,EAAKD,IACnBi7C,EAAMuB,OACCvB,EAAMgB,SC/IAj4B,qCACb,iBACA,CACE7S,MAAO,CACLtF,KAAM,QACNiC,YAAa,sDACb+a,aAAc,QAEhBs0B,SAAU,CACRtxC,KAAM,QACNiC,YAAa,8CACb+a,aAAc,QAEhBu0B,SAAU,CACRvxC,KAAM,QACNiC,YAAa,8CACb+a,aAAc,OAEhBw0B,eAAgB,CACdxxC,KAAM,QACNiC,YAAa,gDACb+a,aAAc,uBAEhBy0B,UAAW,CACTzxC,KAAM,QACNiC,YAAa,mCACb+a,aAAc,OAEhB00B,WAAY,CACV1xC,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,iBAAkB,CAAC,SAAU,UAAW,SACjEtb,YAAa,+CACb+a,aAAc,UAEhBiU,OAAQ,CACNjxB,KAAM,UACNiC,YAAa,oBACb+a,cAAc,GAEhB20B,aAAc,CACZ3xC,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,aAAc,CACrC,UACA,OACA,UACA,SAEFtb,YAAa,wBACb+a,aAAc,WAEhB40B,kBAAmB,CACjB5xC,KAAM,SACNgd,aAAc,EACd/a,YAAa,kCAEf4vC,iBAAkB,CAChB7xC,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,aAAc,CAAC,MAAO,MAAO,MAAO,aAC7Dtb,YACE,qGACF+a,aAAc,YAEhB80B,oBAAqB,CACnB9xC,KAAM,UACNiC,YAAa,gDACb+a,cAAc,IAGlB,CAAEvE,iBAAiB,ICxDAs5B,G,0JACnB,SACE5C,EACAxoC,GACA,IAOIqrC,EACAC,EAPI51B,EAA0D1V,EAA1D0V,SAAUG,EAAgD7V,EAAhD6V,QAASnqB,EAAuCsU,EAAvCtU,QAAS6/C,EAA8BvrC,EAA9BurC,UAAWj8C,EAAmB0Q,EAAnB1Q,OAAQ2C,EAAW+N,EAAX/N,OAChD1F,EAFP,YAEiBspB,EAFjB,MAGM21B,EAAQl5C,yBAAeL,EAAQ,gBAC/B03C,EAAar3C,yBAAeL,EAAQ,qBACpC24C,EAAWt4C,yBAAeL,EAAQ,YAClC04C,EAAWr4C,yBAAeL,EAAQ,YAGA,SAApCK,yBAAeL,EAAQ,UAEzBq5C,EAEM9B,GADM,SAAVgC,EACa,2BACJD,GADG,IAEN5B,aACA9kB,MAAO,CAAC+lB,EAAU,QAASD,KAEpB,2BAAKY,GAAN,IAAiB1mB,MAAO,CAAC,QAAS8lB,MAChDU,EAAgB,SAAC96B,GAAD,OAAsB+6B,EAAW/6B,EAAQvhB,IAAI,YAE7Dq8C,EAAgB,SAAC96B,GAAD,OACdje,yBAAeL,EAAQ,QAAS,CAAEse,aAtBtC,qBAyBsBmF,EAASnkB,UAzB/B,IAyBA,2BAAyC,KAA9Bgf,EAA8B,UACbk7B,wBAAcl7B,EAAShkB,EAAQb,GADlB,mBAChCggD,EADgC,KAEjCC,EAFiC,KAEnBD,EAAS,GAC7BlD,EAAIz5B,UAAYs8B,EAAc96B,GAC9Bi4B,EAAIoD,SAASF,EAAQ,EAAGC,EAAGr8C,IA7B7B,mC,GAJyCy5C,IAqChCp3B,GAAeH,8BAC1B,kBACA,GACA,CAAEK,kBAAmB7c,GAAc8c,iBAAiB,I,mCC/ChD+5B,GAAM,eAACtoB,EAAD,uDAAK,EAAL,OAAWuoB,WAAWvoB,EAAEwoB,YAAY,KAE1C1qC,GAAYC,cAAW,SAAAnB,GAAK,MAAK,CACrC6rC,OAAQ,CACN9tC,SAAU,QAIVwF,OAAQvD,EAAMuD,OAAO2lB,QAGrBjZ,cAAe,QAGjB67B,cAAe,CACbjtC,WAAY,OACZmR,OAAQ,OACR9kB,MAAO,EACPiE,OAAQ,OACRwU,IAAK,EACLtC,OAAQ,UACR9Q,SAAU,WACV0f,cAAe,YAInB,SAAS87B,GAAgBlsC,GAA6B,IAC5CuQ,EAAYvQ,EAAZuQ,QACFrL,EAAMqL,EAAQvhB,IAAI,WAClBm9C,EAAa,GAAH,OAAMjnC,EAAM,GAAH,OAAMA,EAAN,KAAe,IAClCtY,GAAS2jB,EAAQvhB,IAAI,SAAW,GAAGo9C,eAAe,SAClDt/C,EAAMyjB,EAAQvhB,IAAI,OAAOo9C,eAAe,SACxCC,EAAQz/C,IAAUE,EAAMF,EAAhB,UAA2BA,EAA3B,aAAqCE,GAC7Cw/C,EAAM,GAAH,OAAMH,GAAN,OAAmBE,GAE5B,YAAkCp9C,IAA3BshB,EAAQvhB,IAAI,WACjB,6BACGs9C,EACD,6BAFF,QAGQT,GAAIt7B,EAAQvhB,IAAI,aACtB,6BAJF,QAKQ68C,GAAIt7B,EAAQvhB,IAAI,UACtB,6BANF,QAOQ68C,GAAIt7B,EAAQvhB,IAAI,cAGxB,6BACGs9C,EACD,6BAFF,UAGMT,GAAIt7B,EAAQvhB,IAAI,YAM1B,IA2CeypB,GA3CCllB,qBACd,YAQM,IAPJtI,EAOI,EAPJA,MACAqE,EAMI,EANJA,OACAy4B,EAKI,EALJA,WAMQC,EAAsB/8B,EAAtB+8B,kBACFxlB,EAAUnB,KAEhB,OAAO2mB,EACL,oCACE,kBAAC,KAAD,CACEE,UAAU,cACVpmB,UAAWU,EAAQwpC,OACnB3lC,MAAI,EACJkG,MAAO,kBAAC2/B,GAAD,CAAiB37B,QAASyX,KAEjC,yBACEhnB,MAAO,CACLtQ,SAAU,WACVtB,KAAM24B,EAAW,GACjBjkB,IAAK,IAGN,MAGL,yBACEhC,UAAWU,EAAQypC,cACnBjrC,MAAO,CACL5R,KAAM24B,EAAW,GACjBz4B,OAAQA,EAAkC,EAAzBi9C,OAIrB,QChGKC,GAAYj5C,qBACvB,YAMM,IALJtI,EAKI,EALJA,MACAwhD,EAII,EAJJA,YAKQC,EAAUzhD,EAAVyhD,MAER,OACE,kBAAC,QAAD,iBACMA,EADN,CAEEC,OAAQ,SAACxf,GAAD,OAAeA,GACvBnsB,MAAO,CAAE4rC,OAAwB,SAAhBH,EAAyBI,QAAOC,gBA8B1CC,GAxBax5C,qBAAS,SAACyM,GAAyC,IACrE/U,EAAU+U,EAAV/U,MACA+hD,EAAwC/hD,EAAxC+hD,MAAO5G,EAAiCn7C,EAAjCm7C,MAAO92C,EAA0BrE,EAA1BqE,OAAQ29C,EAAkBhiD,EAAlBgiD,cAC9B,OACE,6BACE,kBAAC,KAA+BjtC,GAC/BgtC,GAAS5G,GAAS6G,EACjB,yBACEjsC,MAAO,CACLtQ,SAAU,WACVoT,IAAK,EACL1U,KAAM,IACNghB,cAAe,OACf9gB,SACAjE,MAAO,KAGT,kBAACmhD,GAAD,CAAWvhD,MAAOA,KAElB,SCXJiiD,GAAe90B,gBAAK,kBAAM,mCAC1B+0B,GAAc/0B,gBAAK,kBAAM,yDAGlBm0B,GAAyB,EAGhCxI,GAAgB,IAAIp1C,IAAI,CAC5B,CAAC,SAAU,kBACX,CAAC,UAAW,mBACZ,CAAC,OAAQ,sBAGX,SAASy+C,GAAKve,EAAWC,GACvB,OAAO7iC,KAAKohD,IAAIve,GAAK7iC,KAAKohD,IAAIxe,GAEhC,SAASiY,GAAM9hB,GAAoB,IAATnB,EAAS,uDAAL,IAC5B,OAAQmB,GAAK,EAAI,GAAK,GAAK/4B,KAAKqhD,IAAIzpB,EAAG,EAAI53B,KAAKiB,MAAMkgD,GAAKvpB,EAAG53B,KAAKshD,IAAIvoB,MAKzE,IA0jBevO,GA1jBW,SACxBtQ,EACAwL,GAFwB,OAIxBvd,QACGuB,QACC,sBACAwyB,KACA/zB,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,uBACpB/b,cAAe2a,iCAAuBE,GACtC67B,kBAAmBp5C,QAAMC,SAASD,QAAMS,OAAQ,IAChDxB,WAAYe,QAAMC,SAASD,QAAMW,OAAQ,GACzCkM,KAAM7M,QAAM+B,MAAM/B,QAAMkB,SACxBqJ,MAAOvK,QAAM+B,MAAM/B,QAAMS,QACzBq2C,iBAAkB92C,QAAM+B,MAAM/B,QAAMS,QACpC44C,sBAAuBr5C,QAAM+B,MAAM/B,QAAMS,QACzC4zC,MAAOr0C,QAAM+B,MAAM/B,QAAMS,QACzB64C,UAAWt5C,QAAM+B,MAAM/B,QAAMS,QAC7Bs2C,oBAAqB/2C,QAAM+B,MAAM/B,QAAMkB,SACvCq4C,YAAav5C,QAAMC,SACjBD,QAAMnJ,MAAM,CACVuC,IAAK4G,QAAM+B,MAAM/B,QAAMW,QACvBtH,IAAK2G,QAAM+B,MAAM/B,QAAMW,UAEzB,OAILy1B,UAAS,iBAAO,CACfwiB,OAAO,EACP7iC,aAASlb,EACTm3C,MAAOwH,sBAAW,CAAEjqB,SAAU,EAAGL,SAAU,KAC3CuqB,0BAAsB5+C,MAEvBsG,SAAQ,SAAAC,GAAI,MAAK,CAChBs4C,YADgB,SACJ1H,GACV5wC,EAAK4wC,MAAMziB,SAAWyiB,EAAMziB,SAC5BnuB,EAAK4wC,MAAM9iB,SAAW8iB,EAAM9iB,SAC5B9tB,EAAKw3C,OAAQ,GAEfe,SANgB,SAMPpvC,GACPnJ,EAAKmJ,MAAQA,GAGfusB,WAVgB,SAUL8iB,GAA0B,IACLC,EAAez4C,EAArCq4C,0BACW5+C,IAAfg/C,GAA6BA,EAAW76C,OAAOm4B,SACjD0iB,EAAWziB,QAEbh2B,EAAKq4C,qBAAuBG,GAM9Bl7B,cArBgB,SAqBFvC,GACZ,IAAMtM,EAAU8O,qBAAWvd,GACvBy6B,+BAAqBhsB,IACvBA,EAAQ2P,aAAarD,IAGzB29B,cA3BgB,SA2BFr9C,GACZ2E,EAAKnC,WAAaxC,GAGpBs9C,QA/BgB,SA+BRltC,GACNzL,EAAKyL,KAAOA,GAGdmtC,eAnCgB,WAoCK,QAAf54C,EAAKizC,MACPjzC,EAAKizC,MAAQ,MAEbjzC,EAAKizC,MAAQ,UAIjB4F,aA3CgB,SA2CH5F,GACXjzC,EAAKizC,MAAQA,GAGf6F,oBA/CgB,SA+CI1hC,GAClBpX,EAAK01C,iBAAmBt+B,GAG1B2hC,aAnDgB,SAmDH3hC,GACXpX,EAAKk4C,UAAY9gC,GAGnB4hC,YAvDgB,SAuDJ5hC,GACVpX,EAAKm4C,YAAYngD,IAAMof,GAGzB6hC,gBA3DgB,SA2DA7hC,GACdpX,EAAKi4C,sBAAwB7gC,GAG/B8hC,YA/DgB,SA+DJ9hC,GACVpX,EAAKm4C,YAAYlgD,IAAMmf,GAGzB+hC,mBAnEgB,WAoEdn5C,EAAK21C,qBAAuB31C,EAAK21C,qBAGnCyD,gBAvEgB,SAuEAC,GACdr5C,EAAK21C,oBAAsB0D,OAG9B/gC,OAAM,SAAAtY,GAAI,MAAK,CACd,uBACE,OAAQijB,IAGV,sBACE,OAAOjjB,EAAK4d,cAAc/Z,MAG5B,uBACE,IAAMy1C,EACJt5C,EAAKi4C,uBAAyBp6B,kBAAQ7d,EAAM,oBACxCq2B,EAAekY,GAAc/0C,IAAI8/C,GACvC,IAAKjjB,EACH,MAAM,IAAIx7B,MAAJ,uCAA0Cy+C,IAElD,OAAOjjB,GAIT,gBAIA,gBACE,OAAOr2B,EAAKizC,OAASp1B,kBAAQ7d,EAAM,cAErC,aACE,MAA4B,qBAAdA,EAAKyL,KACfzL,EAAKyL,KACL3O,yBAAezD,KAAK2jC,eAAgB,WAG1C,eAAe,IACLhlC,EAAQgI,EAAKm4C,YAAbngD,IACR,YAAeyB,IAARzB,EAAoBA,EAAM6lB,kBAAQ7d,EAAM,aAGjD,eAAe,IACL/H,EAAQ+H,EAAKm4C,YAAblgD,IACR,YAAewB,IAARxB,EAAoBA,EAAM4lB,kBAAQ7d,EAAM,aAGjD,qBACE,IAAM28B,EACJ9e,kBAAQ7d,EAAM,CAAC,YAAa3G,KAAK6lC,oBAAsB,GAEzD,OAAOl/B,EAAKq2B,aAAala,aAAaqQ,OAA/B,2BAEAmQ,GAFA,IAGH7H,OAAQ90B,EAAKyL,KACbyoC,UAAW76C,KAAK66C,UAChByB,oBAAqB31C,EAAK21C,oBAC1BD,iBAAkB11C,EAAK01C,iBACvBvsC,MAAOnJ,EAAKmJ,QAEd6G,iBAAOhQ,SAIZsY,OAAM,SAAAtY,GACL,IAAIu5C,EAA8B,CAAC,EAAG,GACtC,MAAO,CACL,8BACE,OACEv5C,EAAK01C,kBACL54C,yBAAekD,EAAKg9B,eAAgB,qBAGxC,aAAa,IACH4T,EAAyC5wC,EAAzC4wC,MAAOsD,EAAkCl0C,EAAlCk0C,UAAWa,EAAuB/0C,EAAvB+0C,SAAUC,EAAah1C,EAAbg1C,SAE9BrW,EAAMmW,GAAc,CACxBb,OAAQ,CAACrD,EAAMziB,SAAUyiB,EAAM9iB,UAC/BtX,OAAQ,CAACu+B,EAAUC,GACnBd,cAEIsF,EAAW37B,kBAAQ7d,EAAM,aAAe,EAG9C,MAAkB,QAAdk0C,GAAuBvV,EAAI,KAAOpN,OAAO0jB,UACpC,CAAC,EAAG1jB,OAAO0jB,YAKhBD,IAAazjB,OAAOC,WAAamN,EAAI,GAAK,IAC5CA,EAAI,GAAK2S,GAAM3S,EAAI,GAAK6a,IAEtBzE,IAAaxjB,OAAO0jB,WAAatW,EAAI,IAAM,IAC7CA,EAAI,GAAK2S,GAAM3S,EAAI,GAAK6a,IAItB/iB,KAAKE,UAAU4iB,KAAe9iB,KAAKE,UAAUgI,KAC/C4a,EAAY5a,GAGP4a,IAGT,oBACE,MAC4B,mBAA1Bv5C,EAAKk/B,kBACqB,qBAA1Bl/B,EAAKk/B,kBAGT,gBACE,MAAO,CACL+U,OAAQ56C,KAAK46C,OACbrD,MAAO5wC,EAAK4wC,MACZ6I,cAAepgD,KAAKogD,cACpBvF,UAAWl0C,EAAKk0C,UAChBE,SAAUv2B,kBAAQ7d,EAAM,cAI5B,kBACE,MAAiC,mBAA1BA,EAAKk/B,kBAGd,oBACE,OAAOl/B,EAAKk4C,WAAar6B,kBAAQ7d,EAAM,cAGzC,iCACE,OACEA,EAAK21C,qBACL74C,yBAAekD,EAAKg9B,eAAgB,4BAK3C1kB,OAAM,SAAAtY,GAAQ,IACL+8B,EAAmB/8B,EAAnB+8B,eACR,MAAO,CACL,YAAY,IACFmX,EAA8Bl0C,EAA9Bk0C,UAAWD,EAAmBj0C,EAAnBi0C,OAAQn6C,EAAWkG,EAAXlG,OAKrBm5C,EAAQe,GAAS,CACrBE,YACAD,SACA5kB,MAPY,CACZv1B,EAASi9C,GACTA,IAMA3C,SAAUv2B,kBAAQ7d,EAAM,cAEpBk3C,EAAQp9C,EAAS,GAAK,EAAI,EAChC,OAAO4/C,kCAAuBzG,EAAOiE,IAEvC,kBACE,8CACKl3C,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEu3B,UAAWv3B,EAAKw3C,MAChBh7B,cAAexc,EAAKwc,cACpBC,aAAczc,EACdvD,OAAQuD,EAAKg9B,eACb+Y,UAAW/1C,EAAK+1C,UAChBl4C,WAAYmC,EAAKnC,WACjB/D,OAAQkG,EAAKlG,OACbo9C,MAAO79C,KAAK69C,MACZvB,oBAAqB31C,EAAK21C,oBAC1BhP,QAAS3mC,EAAK2mC,WAIlB,0BAIE,OAHgCh2B,EAAcgvB,eAC5C3/B,EAAK25C,iBADCj7C,qBAMV,oBACE,OAAOrF,KAAKqF,oBAAoB6lB,SAAS,kBAG3C,qBACE,OAAOlrB,KAAKqF,oBAAoB6lB,SAAS,mBAG3C,6BACE,4BACMlrB,KAAKugD,cACL,CACE,CACErzB,MAAO,aACP4W,QAAS,CACP,CACE5W,MAAO,mBACP/V,QAAS,WACPxQ,EAAK04C,cAAgC,EAAlB14C,EAAKnC,cAG5B,CACE0oB,MAAO,qBACP/V,QAAS,WACPxQ,EAAK04C,cAAc14C,EAAKnC,WAAa,OAK7C,CACE0oB,MAAO,qBACP4W,QAAS,CAAC,MAAO,MAAO,MAAO,YAAY/+B,KAAI,SAAAuqC,GAC7C,MAAO,CACLpiB,MAAOoiB,EACPn4B,QAAS,kBAAMxQ,EAAK84C,oBAAoBnQ,UAKhD,IA9BN,YA+BM3oC,EAAK65C,YACL,CACE,CACEtzB,MAAOvmB,EAAK80B,OACR,0BACA,yBACJtkB,QAAS,WACPxQ,EAAK24C,SAAS34C,EAAK80B,WAIzB,IA1CN,CA2CE,CACEvO,MACqB,QAAnBvmB,EAAKk0C,UAAsB,mBAAqB,gBAClD1jC,QAAS,WACPxQ,EAAK44C,mBAGT,CACE/0C,KAAM,WACN0iB,MAAO,qBACP2W,QAASl9B,EAAK85C,2BACdtpC,QAAS,WACPxQ,EAAKm5C,wBAvDX,YA2DM/7C,OAAOlB,KAAK2hB,kBAAQ7d,EAAM,cAAgB,IAAIpH,OAAS,EACvD,CACE,CACE2tB,MAAO,gBACP4W,QAAS,YAAIoR,GAAcryC,QAAQkC,KAAI,SAAA/F,GAAG,MAAK,CAC7CkuB,MAAOluB,EACPmY,QAAS,kBAAMxQ,EAAKi5C,gBAAgB5gD,UAI1C,IArEN,CAsEE,CACEkuB,MAAO,iBACP4W,QAAS,CACP,CAAC,QAAS,UADH,mBAEH9jC,KAAK0gD,eACL,CACE,CAAC,SAAU,UACX,CAAC,WAAY,wBAEf,IAPG,CAQP,CAAC,UAAW,wBACZ37C,KAAI,YAAkB,uBAAhBgZ,EAAgB,KACtB,MAAO,CACLmP,MAFoB,KAGpB/V,QAFK,WAGHxQ,EAAK+4C,aAAa3hC,SAK1B,CACEmP,MAAO,oBACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBsa,GAAc,CAChDjiD,MAAOuK,MAIb,CACEumB,MAAO,YACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBua,GAAa,CAC/CliD,MAAOuK,SAOjB,qBACE,4BAAW+8B,GAAX,YAA8B1jC,KAAK2gD,8BAIxCj6C,SAAQ,SAAAC,GACP,IAAMi6C,EAAcj6C,EAAK8b,OACnBo+B,EAAiBl6C,EAAKw7B,UAFb,SAMA2e,EANA,8EAMf,WAAwBp9C,GAAxB,iDAAA/B,EAAA,2DAKyBuiB,qBAAWvd,GAA1Byd,EALV,EAKUA,WACF28B,EAAKv8B,kBAAQ7d,EAAM,cAAgB,EACjC4d,EAAiC5d,EAAjC4d,cAAe67B,EAAkBz5C,EAAlBy5C,cACjB/7B,EAAYhc,0BAAgB1B,GAC5Bq6C,EATR,aAUI38B,YACAE,gBACA5gB,eAAgB,SAAC2X,GACX8B,kBAAQzW,IACVA,EAAKi2B,WAAWthB,KAGjB5X,GAEiB,WAAlB08C,GAAgD,aAAlBA,EAnBpC,iCAoByCh8B,EAAWK,KAC9CJ,EACA,uBACA28B,GAvBN,cAoBU3G,EApBV,OAyBYvlB,EAAqCulB,EAArCvlB,SAAUmsB,EAA2B5G,EAA3B4G,UAAWC,EAAgB7G,EAAhB6G,YAzBjC,kBA6B6B,aAAlBd,EAAA,2BAEE/F,GAFF,IAGDvlB,SAAUA,GAAY,EAAI,EAAImsB,EAAYF,EAAKG,EAC/CzsB,SAAUwsB,EAAYF,EAAKG,IAE7B7G,GAnCR,WAqCwB,UAAlB+F,GAA+C,YAAlBA,EArCnC,0BAsCuCv9B,4BAAkBlc,GAA7C27B,EAtCZ,EAsCYA,cAAezlC,EAtC3B,EAsC2BA,QAtC3B,UAuC2BunB,EAAWK,KAChCJ,EACA,4BAFqB,2BAIhB28B,GAJgB,IAKnBpjD,aAAckK,gCAAsBnB,EAAKi3B,aAAa,GACtD5W,QAASoW,KAAKC,MACZD,KAAKE,UACHgF,EAAc9B,cAAcz7B,KAAI,SAAArH,GAAU,IAChCK,EAAeL,EAAfK,MAAOE,EAAQP,EAARO,IACf,kCACKP,GADL,IAEEK,MAAOX,KAAKiB,MAAMN,GAClBE,IAAKb,KAAKC,KAAKY,UAKvBpB,aAzDR,eAuCUw9C,EAvCV,OA4DYvlB,EAAqCulB,EAArCvlB,SAAUmsB,EAA2B5G,EAA3B4G,UAAWC,EAAgB7G,EAAhB6G,YA5DjC,kBAiE6B,YAAlBd,EAAA,2BAEE/F,GAFF,IAGDvlB,SAAUA,GAAY,EAAI,EAAImsB,EAAYF,EAAKG,EAC/CzsB,SAAUwsB,EAAYF,EAAKG,IAE7B7G,GAvER,WAyEwB,WAAlB+F,EAzEN,0CA0EWh8B,EAAWK,KAChBJ,EACA,uBACA28B,IA7EN,cAgFQ,IAAIx/C,MAAJ,iCAAoC4+C,EAApC,MAhFR,6CANe,sBAwFf,MAAO,CAEC39B,OAFD,WAEU,0HACb9b,EAAK41B,WACC4iB,EAAU,IAAIjO,gBAFP,SAGO4P,EAAS,CAC3Bv8C,OAAQ46C,EAAQ56C,OAChB+oC,QAAS3mC,EAAK2mC,UALH,OAGPiK,EAHO,OAOTn6B,kBAAQzW,KACVA,EAAKs4C,YAAY1H,GACjBqJ,KATW,8CAYf/kB,YAdK,WAeH8E,sBACEh6B,EACA25B,mBAAO,sBACL,gCAAA3+B,EAAA,kEAEUw9C,EAAU,IAAIjO,gBACdn0B,EAAO8F,4BAAkBlc,GAC/BA,EAAK01B,WAAW8iB,GAEXpiC,EAAK+hB,YANd,sDAUQ/hB,EAAKlgB,QAAU8J,EAAKi7B,gBAV5B,kEAcwBkf,EAAS,CAC3Bv8C,OAAQ46C,EAAQ56C,OAChB+oC,QAAS3mC,EAAK2mC,UAhBpB,QAcUiK,EAdV,OAmBQn6B,kBAAQzW,IACVA,EAAKs4C,YAAY1H,GApBvB,mDAuBSvN,2BAAiB,EAAD,KAAO5sB,kBAAQzW,IAClCA,EAAK41B,SAAL,MAxBN,0DA4BA,CAAEL,MAAO,QAITiG,UAlDD,SAkDWz+B,GAAqB,uIAC7By9C,iBAAK,kBAAMx6C,EAAKw3C,SAAWx3C,EAAK+6B,8BADH,cAE3B0c,EAAyBz3C,EAAzBy3C,cAAe7G,EAAU5wC,EAAV4wC,MAFY,EAGd10B,4BAAkBlc,GAA/BhK,EAH2B,EAG3BA,SAH2B,0CAM5B2D,GAAG,UANyB,UAMTugD,EAAen9C,GANN,iFAO9B06C,GAAiB7G,EAChB,uBAAGhlC,UAAS,oBAAenV,KAAKuB,KAAKhC,EAAU,GAAnC,MACV,kBAACghD,GAAD,CACEvhD,MAAOuK,EACPi3C,YAAY,UAGd,KAd2B,yH,qBChlBxBwD,G,0JACnB,SACEzH,EACAxoC,GACA,IAEE0V,EAQE1V,EARF0V,SACAhqB,EAOEsU,EAPFtU,QACAmqB,EAME7V,EANF6V,QACA01B,EAKEvrC,EALFurC,UACQ2E,EAINlwC,EAJF1Q,OACA2C,EAGE+N,EAHF/N,OACSV,EAEPyO,EAFF0sC,MAASn7C,OACT45C,EACEnrC,EADFmrC,oBAEK5+C,EAXP,YAWiBspB,EAXjB,MAYMxqB,GAASkB,EAAOO,IAAMP,EAAOK,OAASlB,EAKtC+E,EAAS87C,GACTj9C,EAAS4gD,EAA4B,EAATz/C,EAE5Bk5C,EAAar3C,yBAAeL,EAAQ,qBACpC24C,EAAWt4C,yBAAeL,EAAQ,YAClC04C,EAAWr4C,yBAAeL,EAAQ,YAClCq4B,EAASh4B,yBAAeL,EAAQ,UAChC64C,EAAYx4C,yBAAeL,EAAQ,aACnC44C,EAAiBv4C,yBAAeL,EAAQ,kBACxCi5C,EAAmB54C,yBAAeL,EAAQ,oBAC1Cw2C,EAAQe,GAAS,2BAAK+B,GAAN,IAAiB1mB,MAAO,CAAC,EAAGv1B,MAC5C6gD,EAAU9F,GAAUkB,EAAU7B,WA5BpC,EA6B2BjB,EAAMgB,SA7BjC,mBA6BO2G,EA7BP,KA6BgBC,EA7BhB,KA+BMC,EAAM,SAACnjB,GAAD,OAAe79B,EAASm5C,EAAMtb,GAAK18B,GACzC8/C,EAAW,SAACpjB,GAAD,OAAemjB,EAAIH,GAAWG,EAAInjB,IAE7Cke,EACgC,SAApC/4C,yBAAeL,EAAQ,SACnB,SAACg3B,EAAYsT,GAAb,OACEA,EAAQoN,EAAaiB,EAAWD,GAClC,SAACp6B,EAAkBigC,GAAnB,OACEl+C,yBAAeL,EAAQ,QAAS,CAAEse,aAE1Ci4B,EAAI15B,YAAc,OAClB05B,EAAIiI,OAAO,EAAGH,EAAI,IAClB9H,EAAIkI,OAAOrlD,EAAOilD,EAAI,IACtB9H,EAAIlzB,SAEJ,IA9CA,EA8CMq7B,EAAiBP,EAAUzG,GAAc0G,EAAU1G,EA9CzD,eA+CsBj0B,EAASnkB,UA/C/B,IA+CA,2BAAyC,KAA9Bgf,EAA8B,UACbk7B,wBAAcl7B,EAAShkB,EAAQb,GADlB,mBAChCggD,EADgC,KACxBkF,EADwB,KAEnCrU,EAAQhsB,EAAQvhB,IAAI,SAClB6hD,EAAOtgC,EAAQvhB,IAAI,YACnB8hD,EAAOvgC,EAAQvhB,IAAI,YAEnB+hD,EAAcxU,EAAQ6T,EACtBY,EAAezU,EAAQ8T,EACvB1E,EAAIiF,EAAUlF,EAAS,GAEvBuF,EAAU1gC,EAAQvhB,IAAI,WAE5B,GAAyB,QAArBk8C,EACF3O,EAAQ0U,EAAUJ,EAAOtU,EACzBiM,EAAIz5B,UAAYs8B,EAAc96B,EAASgsB,GACvCiM,EAAIoD,SAASF,EAAQ4E,EAAI/T,GAAQoP,EAAGrhB,EAASimB,EAAShU,GAAS,QAC1D,GAAyB,QAArB2O,EACT3O,EAAQ0U,EAAUH,EAAOvU,EACzBiM,EAAIz5B,UAAYs8B,EAAc96B,EAASgsB,GACvCiM,EAAIoD,SAASF,EAAQ4E,EAAI/T,GAAQoP,EAAGrhB,EAASimB,EAAShU,GAAS,QAC1D,GAAyB,aAArB2O,EAAiC,CAC1C,IAAMlX,EAAIqX,EAAc96B,EAASgsB,GAC7B0U,IACFzI,EAAIz5B,UAAY4hC,EACZtF,EAAc96B,EAASsgC,GACvBK,KAAMld,GAAGmd,QAAQ,IAAK9/B,WAC1Bm3B,EAAIoD,SACFF,EACA4E,EAAIO,GACJlF,EACArhB,EAASimB,EAASM,GAAQN,EAAShU,GAAS,IAKhDiM,EAAIz5B,UACF4hC,GAAkBM,EACdC,KAAM7F,EAAc96B,EAASsgC,IAAOO,IAClCF,KAAM7F,EAAc96B,EAASugC,KAE/B9c,EACNwU,EAAIoD,SACFF,EACA4E,EAAI/T,GACJoP,EACArhB,EAASimB,EAAShU,IAAU0U,EAAUV,EAASO,GAAQ,GAAK,GAI1DG,IACFzI,EAAIz5B,UAAY4hC,EACZtF,EAAc96B,EAASugC,GACvBI,KAAMld,GAAGqd,OAAO,IAAKhgC,WACzBm3B,EAAIoD,SAASF,EAAQ4E,EAAIQ,GAAOnF,EAAGrhB,EAASimB,EAASO,GAAQ,SAG/DtI,EAAIz5B,UAAYs8B,EAAc96B,EAASgsB,GACvCiM,EAAIoD,SAASF,EAAQ4E,EAAI/T,GAAQoP,EAAGrhB,EAASimB,EAAShU,GAAS,GAG7DyU,GACFxI,EAAIz5B,UAAY+7B,EAChBtC,EAAIoD,SAASF,EAAQ,EAAGC,EAAG,IAClBoF,GAAuC,QAAxBxF,EAAU7B,YAClClB,EAAIz5B,UAAY+7B,EAChBtC,EAAIoD,SAASF,EAAQwE,EAAmB,EAAGvE,EAAG,IAE5Cp7B,EAAQvhB,IAAI,iBACdw5C,EAAIz5B,UAAY87B,EAChBrC,EAAIoD,SAASF,EAAQ,EAAGC,EAAGr8C,KApH/B,8BAwHI67C,IACF3C,EAAI8I,UAAY,EAChB9I,EAAI15B,YAAc,wBAClBvd,EAAOjF,SAAQ,SAAAilD,GACb/I,EAAIgJ,YACJhJ,EAAIiI,OAAO,EAAGxkD,KAAK66C,MAAMwJ,EAAIiB,KAC7B/I,EAAIkI,OAAOrlD,EAAOY,KAAK66C,MAAMwJ,EAAIiB,KACjC/I,EAAIlzB,iB,GAnIgCyzB,ICJ/Bp3B,GAAeH,8BAC1B,iBACA,GACA,CAAEK,kBAAmB7c,GAAc8c,iBAAiB,ICHjC2/B,G,0JACnB,cAAiB,IAkCf,EAhCE/7B,EAQE1V,EAVW,SAGb6V,EAOE7V,EAVW,QAIbtU,EAMEsU,EAVW,QAKburC,EAKEvrC,EAVW,UAMLkwC,EAINlwC,EAVW,OAOJzO,EAGPyO,EAVW,aAQbmrC,EAEEnrC,EAVW,oBASb/N,EACE+N,EAVW,OAWRzT,EAXQ,oBAYTlB,GAASkB,MAAaA,EAAd,OAAd,EACMkE,EAbS,GAkBTnB,EAAS4gD,EAAf,EAAkCz/C,EAC5Bq6C,EAAYx4C,yBAAeL,EAAjC,aACM44C,EAAiBv4C,yBAAeL,EAAtC,kBACMw2C,EAAQe,GAAS,OAAD,IAAC,CAAD,sBAAiB3kB,MAAO,CAAC,EAAGv1B,MArBnC,EAsBYm5C,EAtBZ,4BAsBR2H,EAtBQ,KAsBCC,EAtBD,KAuBTC,EAAM,SAAAoB,GAAQ,OAAIpiD,EAASm5C,EAATn5C,GAAJ,GACd+7C,EACJ,kCAAep5C,EAAf,SACI,yBACA,SAAAse,GAAO,OAAIje,yBAAeL,EAAQ,QAAS,CAAEse,aAEnDi4B,qBACAA,WAAc8H,EAAd9H,IACAA,WAAkB8H,EAAlB9H,IACAA,WAhCe,qBAmCO9yB,EAnCP,cAmCf,2BAAyC,KAA9BnF,EAA8B,UACbk7B,wBAAcl7B,EAAShkB,EADV,sBAChCm/C,EADgC,KACxBkF,EADwB,KAEjCrU,EAAQhsB,MAAd,SACMwgC,EAAcxU,EAApB,EACMyU,EAAezU,EAArB,EACMoP,EAAIiF,IAL6B,GAOjC5c,EAAIqX,EAAV,GAEA7C,gBACAA,cACKj8C,EAAL,UAQEi8C,WAEE8H,EAAuB,qBAAZqB,EAA0BA,EAFvCnJ,IAIAA,WAAoB8H,EAApB9H,IACAA,WAAmB8H,EAAnB9H,MAZAA,WAEE8H,EAAuB,qBAAZqB,EAA0BA,EAFvCnJ,IAIAA,WAAmB8H,EAAnB9H,IACAA,WAAoB8H,EAApB9H,KASFA,WACAmJ,IAEA,GACEnJ,cACAA,qBACSuI,GAAJ,QAAmBxF,cACxB/C,cACAA,aAAqBl5C,EAArBk5C,QAEEj4B,MAAJ,iBACEi4B,cACAA,sBAzEW,8BA6Ef,IACEA,cACAA,sCACAj3C,WAAe,SAAAggD,GACb/I,cACAA,WAAcv8C,WAAWqkD,EAAzB9H,KACAA,WAAkBv8C,WAAWqkD,EAA7B9H,KACAA,mB,GArFsCO,ICAjCp3B,GAAeH,8BAAoB,mBAAD,GAG7C,CAAEK,kBAAF,GAAmCC,iBAAiB,I,UCCzC8/B,GAAb,4MACE3+C,KAAO,uBADT,iGAIE,WAA2Bgc,EAAWuyB,GAAtC,eAAAhxC,EAAA,oJAC6Cye,EAAMuyB,GADnD,cACQqQ,EADR,oDAGOA,GAHP,IAII1V,QAASltB,EAAKktB,QACV,IAAI2V,KAAwB,CAC1B3V,QAASltB,EAAKktB,eAEhBltC,KARR,gDAJF,qHAgBE,WACEggB,EAMAuyB,GAPF,uBAAAhxC,EAAA,sEASiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAXJ,cASQE,EATR,OAaUtuB,EAA6BsuB,EAA7BtuB,cAAeF,EAAcwuB,EAAdxuB,UAbzB,SAcgCytB,EAC5B9xC,KAAKsX,cACL+M,EACAE,GAjBJ,sBAcU0oB,EAdV,EAcUA,uBAMmB9nC,0BApB7B,qBAsBQ8nC,EAAY7nC,aAAa8lB,SAAS,kBAtB1C,0CAwBa+hB,EAAYiW,eAAerQ,IAxBxC,cA0BU,IAAIrxC,MAAM,8CA1BpB,cA4BQ,IAAIA,MAAM,0BA5BlB,iDAhBF,8DAA0C2vC,GAgD7BgS,GAAb,4MACE/+C,KAAO,4BADT,iGAIE,WAA2Bgc,EAAWuyB,GAAtC,eAAAhxC,EAAA,oJAC6Cye,EAAMuyB,GADnD,cACQqQ,EADR,oDAGOA,GAHP,IAII1V,QAASltB,EAAKktB,QACV,IAAI2V,KAAwB,CAC1B3V,QAASltB,EAAKktB,eAEhBltC,KARR,gDAJF,gIAgBE,WACEggB,GADF,mBAAAze,EAAA,yDAGQ+7B,EAHR,UAG0B19B,KAAKsX,cAAc8S,iBAH7C,iBAG0B,EAA8BhV,eAHxD,aAG0B,EACpBsoB,gBAJN,yCAMWtd,GANX,gCASSkzB,gCAAsB5V,EAAD,YAAC,eACxBtd,GADuB,IAE1BktB,QAASltB,EAAKktB,SAAWltB,EAAKktB,QAAQrsC,SAASqsC,YAXnD,gDAhBF,mHA+BE,WACEltB,EAQAuyB,GATF,yBAAAhxC,EAAA,sEAWiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAbJ,cAWQE,EAXR,OAeU7rB,EAAsC6rB,EAAtC7rB,QAASzC,EAA6BsuB,EAA7BtuB,cAAeF,EAAcwuB,EAAdxuB,UAflC,SAgBgCytB,EAC5B9xC,KAAKsX,cACL+M,EACAE,GAnBJ,sBAgBU0oB,EAhBV,EAgBUA,uBAMmB9nC,0BAtB7B,0CAuBW8nC,EAAYmW,oBAAoBp8B,EAAS6rB,IAvBpD,cAyBQ,IAAIrxC,MAAM,0BAzBlB,iDA/BF,8DAA+C2vC,GCjB1BkS,G,4MACnBj/C,KAAO,e,EAkFP+/B,QAAU,CACRmf,qCACAC,gCACAnC,kBACAoC,8BACAC,QACAvJ,sBACAwJ,oC,6CAvFF,SAAQpsC,GACNA,EAAcmR,cAAa,WACzB,IAAM3F,EAAeH,8BACnB,oBACA,GACA,CAAEK,kBAAmB0F,iCAAsBpR,KAE7C,OAAO,IAAIqR,IAAU,CACnBvkB,KAAM,oBACN0e,eACAI,WAAY0F,gCACVtR,EACA,oBACAwL,QAKNxL,EAAcuR,gBAAe,WAC3B,IAAM/F,EC1DG,SAA6BxL,GAC1C,IAAMqsC,EAA6BrsC,EAAc0uB,gBAC/C,kBACAljB,aACI8gC,EAA8BtsC,EAAc0uB,gBAChD,mBACAljB,aACI+gC,EAA+BvsC,EAAc0uB,gBACjD,oBACAljB,aAEF,OAAOH,8BACL,sBACA,CACEk8B,UAAW,CACTr0C,KAAM,aACNgd,aAAc,QACdprB,MAAOmJ,QAAMwiB,YAAY,iBAAkB,CACzC,SACA,QACA,WACA,UACA,WAEFtb,YACE,wFAEJivC,SAAU,CACRlxC,KAAM,SACNgd,aAAc0Q,OAAO0jB,UACrBnvC,YAAa,iCAEfkvC,SAAU,CACRnxC,KAAM,SACNiC,YAAa,gCACb+a,aAAc0Q,OAAOC,WAEvB2rB,UAAW,CACTt5C,KAAM,SACNiC,YACE,+EACF+a,aAAc,GAEhBqzB,UAAW,CACTrwC,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,aAAc,CAAC,SAAU,QAClDtb,YAAa,2BACb+a,aAAc,UAEhBuzB,SAAU,CACRvwC,KAAM,UACNiC,YAAa,mBACb+a,cAAc,GAGhBu8B,iBAAkB,CAChBv5C,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,YAAa,CAAC,UAAW,SAAU,SAC5DP,aAAc,UAGhBw8B,UAAWrhC,8BAAoB,yBAA0B,CACvD45B,gBAAiBqH,EACjBxC,eAAgBuC,EAChBf,iBAAkBiB,KAGtB,CAAE7gC,kBAAmBgV,KAA+B/U,iBAAiB,IDT9CghC,CAAuC3sC,GAC5D,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,sBACN0e,eACAI,WAAYwgC,GACVpsC,EACAwL,GAEFe,UAAW,oBACXxE,SAAU,mBACVhI,eAAgBisC,QAIpBhsC,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,gBACN0e,aAAcohC,GACd7+C,2CACA+iB,gBAAiB,kBACf,0CAAwCC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,iBAI5DuC,EAAciR,iBACZ,kBACE,IAAIg0B,GAAgB,CAClBn4C,KAAM,kBACNiT,eAAgB8sC,GAChBrhC,aAAcshC,GACd9sC,qBAINA,EAAciR,iBACZ,kBACE,IAAIq6B,GAAiB,CACnBx+C,KAAM,mBACNiT,eAAgBgtC,GAChBvhC,aAAcwhC,GACdhtC,qBAINA,EAAciR,iBACZ,kBACE,IAAI64B,GAAe,CACjBh9C,KAAM,iBACNiT,eAAgBksC,GAChBzgC,aAAc0gC,GACdlsC,qBAINA,EAAc08B,cAAa,kBAAM,IAAI+O,GAAqBzrC,MAC1DA,EAAc08B,cACZ,kBAAM,IAAImP,GAA0B7rC,U,GA/EAkS,KErCpC1G,GAAeH,8BAAoB,0BAAzC,IAEe,SAAS,GAAT,GACb,OAAO,wCAC6B,CAChCriB,GADgC,YAEhCkK,KAAMjF,gBAF0B,2BAGhCqf,YAAarf,QAHmB,SAIhCwX,KAAMxX,sBACJ+R,0BADI/R,iBALH,SASI,SAAAoB,GAAI,MAAK,CAChBkhB,eADgB,YAEdlhB,iBAEFmhB,iBAJgB,WAKdnhB,0BClBOpB,eAAMg/C,MAAK,kBACxB5hC,8BACE,aACA,CACElY,YAAa,CACXD,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,oBAEvBuC,MAAOgZ,8BAAoB,WAAY,CACrCjY,UAAW,CACTtO,MAAOmJ,QAAMwiB,YAAY,YAAa,CAAC,MAAO,QAC9Cvd,KAAM,aACNgd,aAAc,OAEhBne,SAAU,CACRmB,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,0BAGzBo9C,eAAgB,CACdh6C,KAAM,SACNgd,aAAc,KAEhBi9B,eAAgB,CACdj6C,KAAM,SACNgd,aAAc,KAEhB0lB,gBAAiB,CACf1iC,KAAM,SACNgd,aAAc,OAGlB,CAAEvE,iBAAiB,OCjCR,cACb,MAAO,CACLH,gBACAsF,gBAAiB,kBAAM,oEAAuBC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,c,UCF/C,YAACuC,GAEd,OADkBA,EAAcmM,IAAI,mBAA5Ble,MACKg/C,MAAK,kBAChB5hC,8BACE,cACA,CACEhY,aAAc,CACZH,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,qBAEvBwD,aAAc,CACZJ,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,0BAEvB8lC,gBAAiB51B,EAAc2sB,0BAA0B,YAE3D,CAAEhhB,iBAAiB,QChBV,YAAC3L,GACd,MAAO,CACLwL,aAAcxL,EAAcoM,KAAKghC,IACjCt8B,gBAAiB,kBAAM,8DAAwBC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,cCHhDxP,WAAMg/C,MAAK,kBACxB5hC,8BACE,mBACA,CACEgiC,WAAY,CACVn6C,KAAM,SACNgd,aAAc,IAEhBo9B,cAAe,CACbp6C,KAAM,SACNgd,aAAc,IAEhB0lB,gBAAiB,CACf1iC,KAAM,SACNgd,aAAc,OAGlB,CAAEvE,iBAAiB,OClBR,cACb,MAAO,CACLH,gBACAsF,gBAAiB,kBAAM,oEAA6BC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,cCkBrD8vC,GAnBY,SAACvtC,GAC1B,IAAMwtC,EAA4BxtC,EAAcwuB,eAC9C,uBACAhjB,aACIiiC,EAAiCztC,EAAcwuB,eACnD,4BACAhjB,aAEF,OAAOH,8BACL,0BACA,CACEqiC,cAAeF,EACfG,mBAAoBF,GAEtB,CAAE/hC,kBAAmBgV,KAA+B/U,iBAAiB,K,qBC0N1D2E,GA/NW,SACxBtQ,EACAwL,GAEA,OAAOvd,QACJuB,QACC,0BACAs3B,eACA74B,QAAMnJ,MAAM,CACV8oD,cAAe3/C,QAAM+B,MACnBgQ,EAAcwuB,eAAe,uBAAuB5iB,YAEtDiiC,mBAAoB5/C,QAAM+B,MACxBgQ,EAAcwuB,eAAe,4BAA4B5iB,YAE3DkiC,aAAc,GACd56C,KAAMjF,QAAMye,QAAQ,2BACpB/b,cAAe2a,iCAAuBE,GACtCriB,OAAQ,IACR4kD,cAAc,EACdC,YAAY,KAGf3pB,UAAS,iBAAO,CACfiD,UAAW,MAEZl4B,SAAQ,SAAAC,GAAI,MAAK,CAChB4+C,eADgB,WAEd5+C,EAAK0+C,cAAgB1+C,EAAK0+C,cAE5BG,aAJgB,WAKd7+C,EAAK2+C,YAAc3+C,EAAK2+C,YAE1BvkB,aAPgB,SAOHnC,GACXj4B,EAAKi4B,UAAYA,GAEnB6mB,qBAVgB,SAUKnnB,GACnB33B,EAAKy+C,aAAe9mB,OAGvBrf,OAAM,SAAAtY,GAAQ,IACL+8B,EAAmB/8B,EAAnB+8B,eACR,MAAO,CACL,0BACE,IAAMl3B,EAAOgY,kBAAQ7d,EAAM,iBACrBoB,EAAQuc,6BAAmB3d,GACjC,kCACK6F,GADL,IAEEhC,KAAM,sBACNpG,KAAM,GAAF,OAAKogB,kBAAQzc,EAAO,QAApB,WACJg/B,UAAW,GAAF,OAAKpgC,EAAKsB,cAAc8+B,UAAxB,kBAIb,qBACE,OAAOpgC,EAAKu+C,cAAc1lB,gBAG5B,eACE,OAAO74B,EAAKu+C,cAAcr+B,UAG5B,mBAAmB,MACjB,iBAAOlgB,EAAKu+C,qBAAZ,aAAO,EAAoBQ,cAG7B,eACE,OAAO/+C,EAAKu+C,cAAcS,UAE5B,uBACE,OAAOh/C,EAAKu+C,cAAcU,kBAE5B,sBACE,OAAOj/C,EAAKu+C,cAAcW,iBAG5B,+BACE,IAAMr5C,EAAOgY,kBAAQ7d,EAAM,sBACrBoB,EAAQuc,6BAAmB3d,GACjC,kCACK6F,GADL,IAEEhC,KAAM,2BACNpG,KAAM,GAAF,OAAKogB,kBAAQzc,EAAO,QAApB,iBACJg/B,UAAW,GAAF,OAAKpgC,EAAKsB,cAAc8+B,UAAxB,uBAIb,qBACE,4BACKrD,GADL,CAEE,CACEl5B,KAAM,UACN0iB,MAAO,kBACP4W,QAASn9B,EAAKu+C,cAAcvE,wBAE9B,CACEn2C,KAAM,UACN0iB,MAAO,uBACP4W,QAAS,GAAF,mBACFn9B,EAAKw+C,mBAAmBxE,wBADtB,YAEFh6C,EAAKw+C,mBAAmBW,8BAOtCp/C,SAAQ,SAAAC,GAAI,MAAK,CAChBo/C,sBADgB,SACMC,GACpBr/C,EAAKw+C,mBAAqB,CACxB36C,KAAM,2BACNvC,cAAe+9C,EACfvlD,OAAQkG,EAAKy+C,eAGjBpkB,oBARgB,SAQIC,GAClBt6B,EAAKu+C,cAAclkB,oBAAoBC,GACvCt6B,EAAKw+C,mBAAmBnkB,oBAAoBC,IAE9CglB,iBAZgB,SAYCD,GACfr/C,EAAKu+C,cAAgB,CACnB16C,KAAM,sBACNvC,cAAe+9C,IAGnBplB,UAlBgB,SAkBNrF,GAMR,OAJE50B,EAAKlG,OADH86B,EA/Ha,GAgIDA,EAhIC,GAoIV50B,EAAKlG,QAEdogC,aA1BgB,SA0BH7sB,GACX,IAAM8sB,EAAYn6B,EAAKlG,OAEvB,OADkBT,KAAK4gC,UAAUj6B,EAAKlG,OAASuT,GAC5B8sB,OAGtBp6B,SAAQ,SAAAC,GAAI,MAAK,CAChBk1B,YADgB,WAEd8E,sBACEh6B,EACA25B,oBAAQ,WACD35B,EAAKw+C,mBAGPe,KACCv/C,EAAKw/C,yBACLn8B,sBAAYrjB,EAAKw+C,mBAAmBl9C,kBAGtCtB,EAAKw+C,mBAAmBvkB,UAAUj6B,EAAKy+C,cACvCz+C,EAAKw+C,mBAAmBiB,UAAUz/C,EAAKw/C,2BARvCx/C,EAAKo/C,sBAAsBp/C,EAAKw/C,0BAW7Bx/C,EAAKu+C,cAGPgB,KACCv/C,EAAK0/C,oBACLr8B,sBAAYrjB,EAAKu+C,cAAcj9C,iBAGjCtB,EAAKu+C,cAAckB,UAAUz/C,EAAK0/C,qBAPlC1/C,EAAKs/C,iBAAiBt/C,EAAK0/C,qBAc3B1/C,EAAKu+C,cAAcoB,WAClBJ,KACCl8B,sBAAYrjB,EAAKu+C,cAAcoB,UAC/Bt8B,sBAAYrjB,EAAKw+C,mBAAmBmB,YAGtC3/C,EAAKw+C,mBAAmBoB,YACtBv8B,sBAAYrjB,EAAKu+C,cAAcoB,WAIjC3/C,EAAKu+C,cAActX,UAClBsY,KACCl8B,sBAAYrjB,EAAKu+C,cAActX,SAC/BjnC,EAAKw+C,mBAAmBvX,QACpB5jB,sBAAYrjB,EAAKw+C,mBAAmBvX,SACpC,KAGNjnC,EAAKw+C,mBAAmBqB,WACtBx8B,sBAAYrjB,EAAKu+C,cAActX,cAKvCjN,sBACEh6B,EACA25B,oBAAQ,WACN35B,EAAK8+C,qBAAqB9+C,EAAKw+C,mBAAmB1kD,aAIlD0hC,UAhEU,SAgEAz+B,GAAqC,wHAC7C+iD,EAAe9/C,EAAKlG,OAASkG,EAAKw+C,mBAAmB1kD,OADR,SAE7C0gD,iBAAK,kBAAMx6C,EAAKu+C,cAAc/G,SAFe,2DAKrCx3C,EAAKw+C,mBAAmBhjB,UAAUz+B,GALG,0FAM5C6O,UAAS,sBAAiB5L,EAAKw+C,mBAAmB1kD,OAAzC,MANmC,UAQrCkG,EAAKu+C,cAAc/iB,UAAnB,2BACDz+B,GADC,IAEJ0+B,eAAgBqkB,KAVyB,qMCvK5C/hD,4BA3Cf,YAAyE,IAA5CtI,EAA4C,EAA5CA,MACnB8oD,EAAgE9oD,EAAhE8oD,cAAeC,EAAiD/oD,EAAjD+oD,mBAAoBG,EAA6BlpD,EAA7BkpD,WAAYD,EAAiBjpD,EAAjBipD,aACvD,OACE,yBACE9uC,cAAA,kBAAwBiO,kBAAQpoB,EAAO,cACvC+V,MAAO,CAAEtQ,SAAU,aAEnB,yBAAK0U,cAAY,wBACd8uC,EACC,kBAACF,EAAmBuB,mBAApB,CAAuCtqD,MAAO+oD,IAC5C,MAEN,kBAAC,gBAAD,CACEjyC,OAAQ,SAAAyzC,GACN,OAAIxB,GACFA,EAAmBvkB,UAAUukB,EAAmB1kD,OAASkmD,GAClDA,GAEF,GAETx0C,MAAO,CACLtQ,SAAU,WACVoT,IAAKowC,EAAeF,EAAmB1kD,OAAS,EAAI,EACpDA,OAAQ,KAIZ,yBACE8V,cAAY,kBACZpE,MAAO,CACLtQ,SAAU,WACVoT,IAAKowC,EAAeF,EAAmB1kD,OAAS,EAAI,EACpDA,OAAQ,IAGT6kD,EACC,kBAACJ,EAAcwB,mBAAf,CAAkCtqD,MAAO8oD,IACvC,UCcG0B,OApDf,SAA6BtvC,GAC3B,IAAMuvC,EAA6BvvC,EAAc0uB,gBAC/C,kBACAljB,aACIgkC,EAAiCxvC,EAAc0uB,gBACnD,sBACAljB,aAGF,OAAOH,8BACL,sBACA,CACEohC,iBAAkB,CAChBv5C,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,YAAa,CAAC,SAAU,QACjDP,aAAc,UAEhBw8B,UAAWrhC,8BAAoB,yBAA0B,CACvDokC,eAAgBF,EAChBG,mBAAoBF,IAEtB/jC,SAAU,GACVkV,oBAAqB,CACnBztB,KAAM,SACNiC,YAAa,gDACb+a,aAAc,KAEhBy/B,YAAa,CACXz8C,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,cAAe,CACtC,SACA,SACA,aACA,2BACA,iBACA,QAEFtb,YAAa,sBACb+a,aAAc,WAGlB,CACExE,kBAAmB8F,aAAsCxR,GACzD2L,iBAAiB,K,sJChBRve,4BAlBf,SAAkCyM,GAAsC,IAC9D/U,EAAU+U,EAAV/U,MACAupD,EAAavpD,EAAbupD,SACR,OAAOA,EACL,yBACEpvC,cAAA,gBAAsBna,EAAMupD,UAC5BxzC,MAAO,CAAEnC,gBAAiB,UAE1B,kBAACoK,GAAA,EAAD,CAAYtK,MAAM,YAAY1Q,QAAQ,WACnChD,EAAMupD,SAAN,oBACgBA,EAASn7C,KAAK4gB,cAD9B,eACkDu6B,EAAS9nD,QAD3D,YAEK8nD,EAASnxC,KAEX,OAGN,QCvBC,SAAe0yC,GAAtB,yC,8CAAO,WACLvgD,EACAsgD,EACA1pD,EACAmG,GAJK,uBAAA/B,EAAA,+DAUkBuiB,qBAAWvd,GAA1Byd,EAVH,EAUGA,WACAG,EAAkB5d,EAAlB4d,cACFF,EAAYhc,0BAAgB1B,GAZ7B,SAagByd,EAAWK,KAC9Bpc,0BAAgB1B,GAChB,6BAFmB,aAIjB4d,gBACA4iC,IAAKF,EAAYE,IACjB9iC,YACA2C,QAASzpB,EAAOijC,eACb98B,IArBF,cAaChB,EAbD,yBAwBEA,GAxBF,4C,sBA2BA,SAAe0kD,GAAtB,2C,8CAAO,WACLzgD,EACA4d,EACA0iC,EACA1pD,EACAmG,GALK,qBAAA/B,EAAA,+DAWkBuiB,qBAAWvd,GAA1Byd,EAXH,EAWGA,WACFC,EAAYhc,0BAAgB1B,GAZ7B,SAagByd,EAAWK,KAC9BJ,EACA,gCAFmB,aAIjBE,gBACA4iC,IAAKF,EAAYE,IACjB9iC,YACA2C,QAASzpB,EAAOijC,eACb98B,IArBF,cAaChB,EAbD,yBAwBEA,GAxBF,4C,sBCKP,IAAM2kD,GAAgB99B,gBAAK,kBAAM,mCAC3B+9B,GAAiB/9B,gBAAK,kBAAM,mCAC5Bg+B,GAAeh+B,gBAAK,kBAAM,mCAC1Bi+B,GAAsBj+B,gBAAK,kBAAM,mCACjCyZ,GAAkBzZ,gBAAK,kBAAM,mCAC7Bk+B,GAAmBl+B,gBAAK,kBAAM,mCAG9B2rB,GAAgB,IAAIp1C,IAAI,CAC5B,CAAC,SAAU,kBACX,CAAC,MAAO,wBA0hBK8nB,GArhBW,SACxBtQ,EACAwL,GAFwB,OAIxBvd,QACGuB,QACC,sBACAwyB,KACA/zB,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,uBACpB/b,cAAe2a,iCAAuBE,GACtC4kC,kBAAkB,EAClBC,cAAepiD,QAAM+B,MAAM/B,QAAMW,QACjC0hD,UAAWriD,QAAM+B,MAAM/B,QAAMkB,SAC7BohD,eAAgBtiD,QAAM+B,MAAM/B,QAAMkB,SAClC08B,eAAgB59B,QAAM+B,MAAM/B,QAAMW,QAClC4hD,cAAeviD,QAAM+B,MAAM/B,QAAMkB,SACjCk/C,SAAUpgD,QAAM+B,MACd/B,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMS,OACZwO,IAAKjP,QAAMW,OACXihD,IAAK5hD,QAAM+B,MAAM/B,QAAMS,QACvBnI,QAAS0H,QAAMS,OACfpI,aAAc2H,QAAMS,UAGxB4nC,QAASroC,QAAM+B,MACb/B,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMS,OACZmhD,IAAK5hD,QAAM+B,MAAM/B,QAAMS,QACvBzJ,MAAOgJ,QAAMksC,YAGjB6U,SAAU/gD,QAAMC,SACdD,QAAMnJ,MAAM,CACV2rD,YAAaxiD,QAAMC,SAASD,QAAMW,OAAQ,GAC1C8hD,YAAaziD,QAAMC,SAASD,QAAMW,OAAQ,MAC1C+hD,SAAU1iD,QAAM+B,MAAM/B,QAAMS,QAC5BkiD,UAAW3iD,QAAM+B,MACf/B,QAAMnJ,MAAM,CAAE+qD,IAAK5hD,QAAMS,OAAQ/C,MAAOsC,QAAMS,YAGlD,OAIL21B,UAAS,iBAAO,CACfwsB,YAAapJ,cAAWh6C,IAAoB,IAC5CqjD,mBAAoBrJ,cAAWh6C,IAAoB,IACnDo5C,OAAO,EACPkK,YAAa,MAEd3hD,SAAQ,SAAAC,GAAI,MAAK,CAChB2hD,SADgB,SACPC,GACP5hD,EAAKw3C,MAAQoK,GAEfC,eAJgB,SAIDlqB,GACb33B,EAAK0hD,YAAc/pB,GAErBmF,aAPgB,SAOHnF,GACX33B,EAAKw8B,eAAiB7E,GAExBmqB,iBAVgB,SAUCnqB,GACf33B,EAAKghD,cAAgBrpB,GAEvBoqB,aAbgB,SAaHH,GACX5hD,EAAKihD,UAAYW,GAGnBI,eAjBgB,SAiBD1B,GACbtgD,EAAKwhD,YAAcpJ,cAAWh6C,IAAI,IAClC4B,EAAKinC,QAAU1Q,eAAK+pB,GACpBtgD,EAAKw3C,OAAQ,GAGfyK,2BAvBgB,SAuBWC,GACzB,IAAMC,EAAe,CAAC,MAAO,OAAQ,QAAS,SAAU,UACxDD,EAAoBprD,SAAQ,SAAAwF,GAC1B,IAAK0D,EAAKyhD,mBAAmBzlD,IAAIM,GAAQ,CACvC,IAAM8lD,EAAY,YAAIpiD,EAAKyhD,mBAAmBvlD,QAAQtD,OAChDypD,EAAWF,EAAaC,GAC9BpiD,EAAKyhD,mBAAmB/nD,IAAI4C,EAAO+lD,QAKzCC,kBAlCgB,SAkCEC,GAEhB,IAAMJ,EAAe,CACnB,UACA,OACA,UACA,UACA,UACA,YACA,aACA,MACA,UACA,eAGFI,EAAUzrD,SAAQ,SAAAwF,GAChB,IAAK0D,EAAKwhD,YAAYxlD,IAAIM,GAAQ,CAChC,IAAM8lD,EAAY,YAAIpiD,EAAKwhD,YAAYtlD,QAAQtD,OACzCypD,EAAWF,EAAaC,GAC9BpiD,EAAKwhD,YAAY9nD,IAAI4C,EAAO+lD,YAKnCtiD,SAAQ,SAAAC,GAAI,MAAK,CAChBk1B,YADgB,WAEd8E,sBACEh6B,EACA25B,mBAAO,sBACL,kDAAA3+B,EAAA,oEAE2BuiB,qBAAWvd,GAA1Byd,EAFZ,EAEYA,WACAuhC,EAAmCh/C,EAAnCg/C,SAAU/X,EAAyBjnC,EAAzBinC,QAAS/kC,EAAgBlC,EAAhBkC,YACrBkU,EAAO8F,4BAAkBlc,KAJnC,OAQQinC,QARR,IAQQA,OARR,EAQQA,EAASuZ,KARjB,gCASiCD,GACzBvgD,EACAinC,EACA7wB,EAAKosC,cAZb,OASYC,EATZ,OAcMziD,EAAKsiD,kBAAkBG,GAd7B,UAiB0B,mBAAX,OAAPxb,QAAO,IAAPA,OAAA,EAAAA,EAASpjC,MAjBjB,kCAkB2C48C,GACnCzgD,EACA6d,kBAAQ7d,EAAKi3B,YAAa,CAAC,YAC3BgQ,EACA7wB,EAAKosC,cAtBb,QAkBYE,EAlBZ,OAwBM1iD,EAAKiiD,2BAA2BS,GAxBtC,YA2BQ1D,EA3BR,wBA4BcnxC,EAA+BmxC,EAA/BnxC,IAAK3W,EAA0B8nD,EAA1B9nD,QAASD,EAAiB+nD,EAAjB/nD,aAEhBF,EAAS,CACbK,MAAOyW,EACPvW,KAAMuW,GAAO,GAAK,EAClB3W,UACAD,gBAlCR,UAuCa+I,EAAKq2B,aAAqBmB,eAAe/Z,EAA1C,aACJxmB,eACAopB,QAAS,CAACtpB,GACV6mB,cAAe5d,EAAK4d,cACpByY,aAAcr2B,EAAKq2B,aAAa54B,KAChCigB,UAAWhc,0BAAgB1B,GAC3Bgb,QAAS,KACN9Y,IA9CX,QAgDMlC,EAAK2hD,UAAS,GACd3hD,EAAK6hD,eAAezrC,EAAKlgB,SAjD/B,wBAmDM8J,EAAK2hD,UAAS,GAnDpB,0DAsDIxrB,QAAQva,MAAR,MACA5b,EAAK41B,SAAL,MAvDJ,0DA0DA,CAAEL,MAAO,QAIfjY,cAnEgB,SAmEFvC,GACZ,IAAMtM,EAAU8O,qBAAWvd,GAC3B,GAAIwd,oCAA0B/O,GAAU,CACtC,IAAMsP,EAAgBtP,EAAQuP,UAC5B,0BACA,mBACA,CAAEC,YAAalD,EAAQzgB,SAAU8b,KAAM8F,4BAAkBlc,KAE3DyO,EAAQ0P,WAAWJ,GAErBtP,EAAQ2P,aAAarD,IAGvB4nC,cAhFgB,WAiFd3iD,EAAKg/C,cAAWvlD,GAIlBmpD,uBArFgB,SAqFO7nC,GACrB,IAAM8nC,EAAgB9nC,EAAQzgB,gBACvBuoD,EAAc1kB,SACrB,IAAM1vB,EAAU8O,qBAAWvd,GAC3BxE,KAAKi7B,KAAKE,UAAUksB,EAAe,KAAM,IACzCp0C,EAAQq0C,OAAO,sBAAuB,YAGxCC,mBA7FgB,WA8Fd/iD,EAAK+gD,kBAAoB/gD,EAAK+gD,kBAEhCiC,oBAhGgB,WAiGdhjD,EAAKmhD,eAAiBnhD,EAAKmhD,eAG7B1B,UApGgB,SAoGNn+C,GACRtB,EAAKsB,cAAgBA,GAGvB2hD,YAxGgB,SAwGJp/C,EAAc28C,GAAc,IAC9B0C,EAAmBhnC,4BAAkBlc,GAArCkjD,eACR,GAAKA,EAAL,CAFsC,IAK9BhsD,EAAkCgsD,EAAlChsD,QAASD,EAAyBisD,EAAzBjsD,aAAcgE,EAAWioD,EAAXjoD,OACzBkoD,EAAW1sD,KAAK66C,MAAMr2C,GAAU,EAChCmoD,EAAgBlsD,EAElBisD,EAAW,IAIfnjD,EAAKg/C,SAAW,CACdn7C,OACAgK,IAAKs1C,EACLjsD,QAASksD,EACTnsD,eACAupD,OAEFxgD,EAAKw3C,OAAQ,KAEfoI,YA9HgB,SA8HJz7B,GAMVnkB,EAAK2/C,SAAWppB,eAAKpS,QAGxBpkB,SAAQ,SAAAC,GAEP,IAAMi6C,EAAcj6C,EAAK8b,OAEzB,MAAO,CACLA,OADK,WAEH9b,EAAK2iD,gBACL1I,SAKL3hC,OAAM,SAAAtY,GAAI,MAAK,CACd,gBACE,IAAM6F,EAAOgY,kBAAQ7d,EAAM,CAAC,YAAaA,EAAKk/B,oBAAsB,GACpE,YAA+BzlC,IAAxBuG,EAAKw8B,eACRx8B,EAAKw8B,eACL32B,EAAK4S,WAEX,qBACE,IAAMkkB,EACJ9e,kBAAQ7d,EAAM,CAAC,YAAaA,EAAKk/B,oBAAsB,GACzD,OAAOl/B,EAAKq2B,aAAala,aAAaqQ,OAA/B,2BAEAmQ,GAFA,IAGH7iC,OAAQkG,EAAKghD,cACbC,UAAWjhD,EAAKihD,UAChBxoC,UAAWpf,KAAKof,UAChB0oC,cAAenhD,EAAKmhD,gBAEtBnxC,iBAAOhQ,KAGX,2BACE,OACEA,EAAKghD,eAAiBlkD,yBAAezD,KAAK2jC,eAAgB,WAG9D,2BACE,YAA8BvjC,IAAvBuG,EAAKmhD,cACRnhD,EAAKmhD,cACLrkD,yBAAezD,KAAK2jC,eAAgB,sBAG3C1kB,OAAM,SAAAtY,GAAQ,IACL+8B,EAAmB/8B,EAAnB+8B,eACR,MAAO,CACL,uBACE,IAAMuc,EAAWz7B,kBAAQ7d,EAAM,oBACzBq2B,EAAekY,GAAc/0C,IAAI8/C,GACvC,IAAKjjB,EACH,MAAM,IAAIx7B,MAAJ,uCAA0Cy+C,IAElD,OAAOjjB,GAGT,uBACE,IAAMqR,EAAO1nC,EAAK+3B,mBACZ9E,EAAmByU,EACrB,CACE,CACEnhB,MAAO,uBACP1W,KAAMqrB,KACN1qB,QAAS,WACPxQ,EAAK06B,wBACDgN,GACF1nC,EAAKsd,cAAcoqB,KAIzB,CACEnhB,MAAO,yBACP1W,KAAMwzC,KACN7yC,QAAS,WACHk3B,GACF1nC,EAAK4iD,uBAAuBlb,MAKpC,GAOJ,OANA1nC,EAAKg4B,mCAAmClhC,SACtC,SAACib,GACC,IAAMV,EAAYU,EAAS21B,EAAM1nC,EAAM2Q,GACvCsiB,EAAiB16B,KAAjB,MAAA06B,EAAgB,YAAS5hB,OAGtB4hB,GAGT,mBACE,OAAOqwB,IAGT,cACE,IAAI3c,EAAoB,GACxB,GAAI3mC,EAAK2/C,SAAU,OACoB3/C,EAAK2/C,SAAlCyB,EADS,EACTA,YAAaC,EADJ,EACIA,YAIrB,GAHA1a,EAAU,CAAC,+BAAD,OACuBya,EADvB,cACwCA,EADxC,uCACkFC,EADlF,MAGNrhD,EAAK2/C,SAAS4B,UAAW,OACJvhD,EAAK2/C,SAAS4B,UAA7Bf,EADmB,EACnBA,IAAKlkD,EADc,EACdA,MACbqqC,EAAQpuC,KAAR,gBACW+D,EADX,uCAC6CkkD,EAD7C,6CACqFA,EADrF,kBACkGlkD,EADlG,MAIF,GAAI0D,EAAK2/C,SAAS2B,SAAU,KAClBA,EAAathD,EAAK2/C,SAAlB2B,SACR3a,EAAQpuC,KAAR,wCAA6C+oD,EAA7C,OAGJ,OAAO,IAAIhF,KAAwB,CAAE3V,aAGvC,kBACE,IAAMvwB,EAAO8F,4BAAkBlc,GAC/B,8CACKA,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEu3B,UACGv3B,EAAKw3C,OACLx3C,EAAKg/C,UAAYh/C,EAAK0hD,cAAgBtrC,EAAKlgB,QAC9CsmB,cAAexc,EAAKwc,cACpBC,aAAczc,EACdg/C,SAAUh/C,EAAKg/C,SACf/X,QAASjnC,EAAKinC,QACdua,YAAa/qB,KAAKC,MAAMD,KAAKE,UAAU32B,EAAKwhD,cAC5CC,mBAAoBhrB,KAAKC,MACvBD,KAAKE,UAAU32B,EAAKyhD,qBAEtB9a,QAASttC,KAAKstC,QACd5tB,aAAc/Y,EAAK+gD,iBACnBtkD,OAAQuD,EAAKg9B,kBAIjB,6BACE,MAAO,CACL,CACEzW,MAAO,qBACP1W,KAAMotB,KACNp5B,KAAM,WACNq5B,QAASl9B,EAAK+gD,iBACdvwC,QAAS,WACPxQ,EAAK+iD,qBAGD/iD,EAAK+gD,kBACP/gD,EAAK2iD,kBAIX,CACEp8B,MAAO,UACP1W,KAAM0zC,KACN19B,SAAU7lB,EAAK+gD,iBACf5jB,QAAS,GAAF,mBACF,CAAC,iBAAkB,cAAe,aAAa/+B,KAChD,SAAAgS,GACE,MAAO,CACLmW,MAAOnW,EACPI,QAAS,kBAAMxQ,EAAKijD,YAAY7yC,SALjC,CASL,CACEmW,MAAO,iBACP/V,QAAS,kBACP+M,qBAAWvd,GAAMo9B,mBAAmBwjB,GAAc,CAChDnrD,MAAOuK,MAGb,CACEumB,MAAO,aACP/V,QAAS,kBAAMxQ,EAAK2iD,qBAI1B,CACEp8B,MAAO,eACP1W,KAAM2zC,KACNrmB,QAAS,CACP,CACE5W,MAAO,SACP/V,QAAS,WACPxQ,EAAKgiD,eAAe,CAAEn+C,KAAM,aAGhC,CACE0iB,MAAO,kBACP/V,QAAS,WACPxQ,EAAKgiD,eAAe,CAAEn+C,KAAM,qBAGhC,CACE0iB,MAAO,SACP/V,QAAS,WACPxQ,EAAKgiD,eAAe,CAAEn+C,KAAM,aAGhC,CACE0iB,MAAO,mBACP/V,QAAS,WACPxQ,EAAKgiD,eAAe,CAAEn+C,KAAM,sBAGhC,CACE0iB,MAAO,mBACP/V,QAAS,WACPxQ,EAAKgiD,eAAe,CAAEn+C,KAAM,qBAGhC,CACE0iB,MAAO,+BACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmB0jB,GAAkB,CACpDrrD,MAAOuK,MAIb,CACEumB,MAAO,cACP/V,QAAS,WACPxQ,EAAKgiD,eAAe,CAAEn+C,KAAM,iBAGhC,CACE0iB,MAAO,sBACP/V,QAAS,WACPxQ,EAAKgiD,eAAe,CAAEn+C,KAAM,sBAGhC,CACE0iB,MAAO,kBACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBsjB,GAAe,CACjDjrD,MAAOuK,QAMjB,CACEumB,MAAO,YACP1W,KAAM4zC,KACNjzC,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBujB,GAAgB,CAClDlrD,MAAOuK,MAIb,CACEumB,MAAO,qBACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmByjB,GAAqB,CACvDprD,MAAOuK,MAIb,CACEumB,MAAO,iBACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBf,GAAiB,CACnD5mC,MAAOuK,MAIb,CACEumB,MAAO,6BACP1iB,KAAM,WACNq5B,QAASl9B,EAAK0jD,qBACdlzC,QAAS,WACPxQ,EAAKgjD,0BAMb,qBACE,4BAAWjmB,GAAX,YAA8B1jC,KAAK2gD,+BC5jB7C,IAAMnuC,GAAYC,cAAW,SAAAnB,GAAK,MAAK,CACrC6rC,OAAQ,CACN9tC,SAAU,QACVwF,OAAQvD,EAAMuD,OAAO2lB,QACrBjZ,cAAe,QAGjB67B,cAAe,CACbjtC,WAAY,OACZmR,OAAQ,OACR9kB,MAAO,EACPiE,OAAQ,OACRwU,IAAK,EACLtC,OAAQ,UACR9Q,SAAU,WACV0f,cAAe,YAWnB,SAAS87B,GAAT,GAA4D,IAAjC37B,EAAiC,EAAjCA,QACnB7jB,EAAU6jB,EAAQvhB,IAAI,WACtBpC,GAAS2jB,EAAQvhB,IAAI,SAAW,GAAGo9C,eAAe,SAClDt/C,EAAMyjB,EAAQvhB,IAAI,OAAOo9C,eAAe,SACxCE,EAAM,GAAH,OAAM5/C,EAAU,GAAH,OAAMA,EAAN,KAAmB,IAAhC,OACPE,IAAUE,EAAMF,EAAhB,UAA2BA,EAA3B,aAAqCE,IAGjCqsD,EAAO5oC,EAAQvhB,IAAI,WASjBwsC,EAA+C2d,EAA/C3d,MAAOt2B,EAAwCi0C,EAAxCj0C,IAAK23B,EAAmCsc,EAAnCtc,IAAKE,EAA8Boc,EAA9Bpc,OAAQH,EAAsBuc,EAAtBvc,QAASE,EAAaqc,EAAbrc,SAC1C,OACE,6BACE,+BACE,iCAAUwP,GACV,+BACE,4BACE,oCACA,qCACA,0CACA,uCACA,wCAGJ,+BACE,4BACE,qCACA,4BAAK9Q,GACL,8BAGD5oC,OAAOhD,QAAQ,CAAEsV,MAAK23B,MAAKE,SAAQD,WAAUF,YAAWhpC,KACvD,YAAkB,uBAAhB/F,EAAgB,KAAXurD,EAAW,KAChB,OACE,kBAAC,IAAM3nB,SAAP,CAAgB5jC,IAAKA,GAClB+E,OAAOhD,QAAQwpD,GAAOxlD,KAAI,YAAmB,uBAAjBmrC,EAAiB,KAAXxC,EAAW,KACpCd,EAAYc,EAAZd,QACR,OACE,wBAAI5tC,IAAKkxC,GACP,4BAAKA,EAAK7lC,eACV,4BAAKqjC,EAAMf,OACX,4BACY,UAATuD,EACG,MADH,UAEM9yC,KAAKiB,MAAOqvC,EAAMf,MAAQA,EAAS,KAFzC,MAIH,4BACGC,GAAQ,GAAR,UAAmBA,GAAQ,GAA3B,OAAwC,GACxCA,EAAQ,GAAR,UAAkBA,EAAQ,GAA1B,OAAsC,IAEzC,4BAAK5tC,cAe7B,IAwCe4qB,GAxCCllB,qBACd,YAQM,IAPJtI,EAOI,EAPJA,MACAqE,EAMI,EANJA,OACAy4B,EAKI,EALJA,WAMQC,EAAsB/8B,EAAtB+8B,kBACFxlB,EAAUnB,KAEhB,OAAO2mB,EACL,oCACE,kBAAC,KAAD,CACEE,UAAU,cACVpmB,UAAWU,EAAQwpC,OACnB3lC,MAAI,EACJkG,MAAO,kBAAC,GAAD,CAAiBgE,QAASyX,KAEjC,yBACEhnB,MAAO,CACLtQ,SAAU,WACVtB,KAAM24B,EAAW,GACjBjkB,IAAK,IAGN,MAGL,yBACEhC,UAAWU,EAAQypC,cACnBjrC,MAAO,CAAE5R,KAAM24B,EAAW,GAAIz4B,aAGhC,QC5HFy0C,GAAgB,IAAIp1C,IAAI,CAAC,CAAC,cAAe,yBA4PhC8nB,GAxPW,SACxBtQ,EACAwL,GAFwB,OAIxBvd,QACGuB,QACC,2BACA48C,GAAgCpsC,EAAewL,GAC/Cvd,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,4BACpBwmC,oBAAqBjlD,QAAM+B,MAAM/B,QAAMkB,SACvCgkD,eAAgBllD,QAAM+B,MAAM/B,QAAMkB,SAClC6/C,SAAU/gD,QAAMC,SACdD,QAAMnJ,MAAM,CACV2rD,YAAaxiD,QAAMC,SAASD,QAAMW,OAAQ,GAC1C8hD,YAAaziD,QAAMC,SAASD,QAAMW,OAAQ,MAC1C+hD,SAAU1iD,QAAM+B,MAAM/B,QAAMS,QAC5BkiD,UAAW3iD,QAAM+B,MACf/B,QAAMnJ,MAAM,CAAE+qD,IAAK5hD,QAAMS,OAAQ/C,MAAOsC,QAAMS,YAGlD,IAEF4nC,QAASroC,QAAM+B,MACb/B,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMS,OACZmhD,IAAK5hD,QAAM+B,MAAM/B,QAAMS,cAK9B21B,UAAS,iBAAO,CACfysB,mBAAoBrJ,cAAWh6C,IAAI,QAEpC2B,SAAQ,SAAAC,GAAI,MAAK,CAChBy/C,UADgB,SACNn+C,GACRtB,EAAKsB,cAAgBA,GAEvBs+C,YAJgB,SAIJz7B,GAMVnkB,EAAK2/C,SAAWppB,eAAKpS,IAEvB07B,WAZgB,SAYL5Y,GACTjnC,EAAKinC,QAAU1Q,eAAK0Q,IAGtBgb,2BAhBgB,SAgBWC,GACzB,IAAMC,EAAe,CAAC,MAAO,OAAQ,QAAS,SAAU,UACpD91B,EAAI,EAER61B,EAAoBprD,SAAQ,SAAAwF,GAC1B,IAAK0D,EAAKyhD,mBAAmBzlD,IAAIM,GAAQ,CACvC,IAAM+lD,EAAWF,EAAa91B,KAC9BrsB,EAAKyhD,mBAAmB/nD,IAAI4C,EAAO+lD,YAK1C/pC,OAAM,SAAAtY,GAAI,MAAK,CACd,qBACE,IAAM28B,EACJ9e,kBAAQ7d,EAAM,CAAC,YAAaA,EAAKk/B,oBAAsB,GAEzD,OAAOl/B,EAAKq2B,aAAala,aAAaqQ,OAA/B,2BAEAmQ,GAFA,IAGHknB,yBAC+BpqD,IAA7BuG,EAAK6jD,oBACDlnB,EAAWknB,oBACX7jD,EAAK6jD,oBACXC,oBAC0BrqD,IAAxBuG,EAAK8jD,eACDnnB,EAAWmnB,eACX9jD,EAAK8jD,iBAEb9zC,iBAAOhQ,KAGX,iCACE,YAAoCvG,IAA7BuG,EAAK6jD,oBACR7jD,EAAK6jD,oBACL/mD,yBAAezD,KAAK2jC,eAAgB,wBAE1C,4BACE,YAA+BvjC,IAAxBuG,EAAK8jD,eACR9jD,EAAK8jD,eACLhnD,yBAAezD,KAAK2jC,eAAgB,mBAG1C,yBAAyB,MACvB,MAA8B,mBAAvB,UAAAh9B,EAAKinC,eAAL,eAAcpjC,OACjBzG,OAAOlB,KAAKu6B,KAAKC,MAAMD,KAAKE,UAAU32B,EAAKyhD,sBACxC7oD,OAAS,GAGlB,kBACE,8CACKoH,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEu3B,UAAWv3B,EAAKw3C,QAAUn+C,KAAK0qD,mBAC/BvnC,cAAexc,EAAKwc,cACpBC,aAAczc,EACdvD,OAAQuD,EAAKg9B,eACb+Y,UAAW/1C,EAAK+1C,UAChBl4C,WAAYmC,EAAKnC,WACjB/D,OAAQkG,EAAKlG,OACbo9C,MAAOl3C,EAAKk3C,MACZvB,oBAAqB31C,EAAK21C,oBAC1BhP,QAAS3mC,EAAK2mC,QACd8a,mBAAoBhrB,KAAKC,MACvBD,KAAKE,UAAU32B,EAAKyhD,qBAKtBxa,QAASjnC,EAAKinC,QAAU5jB,sBAAYrjB,EAAKinC,cAAWxtC,SAIzDsG,SAAQ,SAAAC,GAAI,MAAK,CAChBgkD,qBADgB,WAEdhkD,EAAK8jD,gBAAkB9jD,EAAKikD,uBAE9BC,0BAJgB,WAKdlkD,EAAK6jD,qBAAuB7jD,EAAKmkD,4BAEnCjvB,YAPgB,WAQd8E,sBACEh6B,EACA25B,mBAAO,sBACL,kCAAA3+B,EAAA,kEAEYisC,EAAYjnC,EAAZinC,QAFZ,EAG6B/qB,4BAAkBlc,GAAnCwiD,EAHZ,EAGYA,aACc,mBAAX,OAAPvb,QAAO,IAAPA,OAAA,EAAAA,EAASpjC,MAJjB,gCAKyB48C,GACjBzgD,EACA6d,kBAAQ7d,EAAKi3B,YAAa,WAC1BgQ,EACAub,GATR,OAKY4B,EALZ,OAWMpkD,EAAKiiD,2BAA2BmC,GAXtC,yDAcIjuB,QAAQva,MAAR,MACA5b,EAAK41B,SAAL,MAfJ,0DAkBA,CAAEL,MAAO,YAMhBjd,OAAM,SAAAtY,GAAQ,IACL+8B,EAAmB/8B,EAAnB+8B,eACR,MAAO,CACL,uBACE,OAAO9Z,IAGT,oBAEE,MAAO,CACLpf,KAAM,qBACN2iC,WAHiB3oB,kBAAQ7d,EAAKi3B,YAAa,aAO/C,uBACE,OAAOsX,GAAc/0C,IAAI,gBAG3B,oBACE,OAAO,GAGT,uBACE,MAAO,IAGT,0BACE,MAAO,CACL,CACE+sB,MAAO,qCACP1iB,KAAM,WACNq5B,QAASl9B,EAAKikD,sBACdzzC,QAAS,WACPxQ,EAAKgkD,yBAGT,CACEz9B,MAAO,iCACP1iB,KAAM,WACNq5B,QAASl9B,EAAKmkD,2BACd3zC,QAAS,WACPxQ,EAAKkkD,gCAKb,qBACE,4BACKnnB,GADL,YAEK/8B,EAAKg6C,wBAFV,YAGK3gD,KAAK8lD,uBAMZ,cACE,IAAIxY,EAAoB,GACxB,GAAI3mC,EAAK2/C,SAAU,OACoB3/C,EAAK2/C,SAAlCyB,EADS,EACTA,YAAaC,EADJ,EACIA,YAOrB,GANA1a,EAAU,CACR,sFAC4Bya,EAD5B,cAC6CA,EAD7C,2CAE6BC,EAF7B,OAKErhD,EAAK2/C,SAAS4B,UAAW,OACJvhD,EAAK2/C,SAAS4B,UAA7Bf,EADmB,EACnBA,IAAKlkD,EADc,EACdA,MACbqqC,EAAQpuC,KACN,gEACM+D,EADN,uCACwCkkD,EADxC,gDAEqBA,EAFrB,kBAEkClkD,EAFlC,MAKJ,GAAI0D,EAAK2/C,SAAS2B,SAAU,KAClBA,EAAathD,EAAK2/C,SAAlB2B,SACR3a,EAAQpuC,KACN,wFAC6B+oD,EAD7B,OAKN,OAAO,IAAIhF,KAAwB,CAAE3V,kBC9ChC5oC,4BAjNf,SAAyByM,GAUtB,IAEC8oB,EASE9oB,EATF8oB,YACAgE,EAQE9sB,EARF8sB,SACA7a,EAOEjS,EAPFiS,aACA5mB,EAME2U,EANF3U,MACAiE,EAKE0Q,EALF1Q,OACAumB,EAIE7V,EAJF6V,QACAnqB,EAGEsU,EAHFtU,QACA8oD,EAEEx0C,EAFFw0C,SACA/X,EACEz8B,EADFy8B,QAVD,EAiBGxqB,GAAgB,GAJlB0D,EAbD,EAaCA,kBACA2X,EAdD,EAcCA,oBACAC,EAfD,EAeCA,mBACAa,EAhBD,EAgBCA,oBAEK7hC,EAlBN,YAkBgBspB,EAlBhB,MAmBKgkC,EAAyBt3C,iBAA0B,MAnBxD,EAoBqCJ,oBAAS,GApB9C,mBAoBM23C,EApBN,KAoBmBC,EApBnB,OAqB+D53C,oBAC9D,GAtBD,mBAqBM63C,EArBN,KAqBgCC,EArBhC,KAyHD,SAASv3C,EAAUC,GACbm3C,GACFG,GAA4B,GAE9B,IAAI5pC,EAAU,EACVC,EAAU,EACVupC,EAAuB/2C,UACzBuN,EAAUwpC,EAAuB/2C,QAAQkmB,wBAAwB55B,KACjEkhB,EAAUupC,EAAuB/2C,QAAQkmB,wBAAwBllB,KAEnEuM,EAAU1N,EAAMimB,QAAUvY,EAC1BC,EAAU3N,EAAMkmB,QAAUvY,EAC1B,IAAMg5B,EAAK/8C,EAAOQ,SAAW1B,EAAQglB,EAAUA,EACzCk5B,EAAWh9C,EAAOK,MAAQlB,EAAU49C,EAEpCtmB,EAAQ/Q,EAAa2c,sBACzB9B,EACAyc,EACAj5B,GAEI4pC,EAAmBl3B,EAAM50B,OAAS40B,EAAM,GAAG/vB,UAAOhE,EAEpD65B,GACFA,EAAYnmB,EAAOu3C,GAIvB,SAASC,EAAiBC,EAAqBz3C,GAE7C,IAAM03C,EAAiBr6C,EAAM,YAAD,OAAao6C,IAEnCE,EAAgBt6C,EAAM,KAAD,OAAMo6C,IAC7BC,GAAkB/sB,EACpB+sB,EAAe13C,EAAO2qB,GACbgtB,GACTA,EAAc33C,EAAO2qB,GApIzB7qB,qBAAU,WACR,IAAMgM,EAASorC,EAAuB/2C,QACtC,GAAK2L,EAAL,CAGA,IAAM+5B,EAAM/5B,EAAOE,WAAW,MAC9B,GAAK65B,EAAL,CAIA,IAAIzf,EACAwxB,EAEJ,GAJA/R,EAAIgS,UAAU,EAAG,EAAG/rC,EAAOpjB,MAAOojB,EAAOnf,QAKvCqmB,IACC4kC,EAAcnsB,EAAoBp/B,IAAI89B,MACtC/D,EAAOwxB,EAAYvrD,IAAI2mB,IACxB,OAC2CoT,EAD3C,mBACO0xB,EADP,KACeC,EADf,KACsBC,EADtB,KAC+BC,EAD/B,OAE0BC,mBAASJ,EAAQE,EAASpuD,EAAQb,GAF5D,mBAEOggD,EAFP,KAEekF,EAFf,KAGMkK,EAAU7uD,KAAK66C,MAAM4T,GACrBK,EAAa9uD,KAAK66C,MAAM8T,EAAWF,GACzClS,EAAIwS,YAAc,UAClBxS,EAAIyS,WAAa,GACjBzS,EAAI0S,SAAW,QACf1S,EAAI8I,UAAY,EAChB9I,EAAI15B,YAAc,UAClB05B,EAAI2S,WACFzP,EAAS,EACToP,EAAU,EACVlK,EAAUlF,EAAS,EACnBqP,EAAa,GAEfvS,EAAIgS,UAAU9O,EAAQoP,EAASlK,EAAUlF,EAAQqP,GAEnD,IAAMK,EAAqB9tB,IAAmB,OAAIC,QAAJ,IAAIA,OAAJ,EAAIA,EAAoBp+B,MACtE,GACEisD,IACCb,EAAcnsB,EAAoBp/B,IAAI89B,MACtC/D,EAAOwxB,EAAYvrD,IAAIosD,IACxB,OAC2CryB,EAD3C,mBACO0xB,EADP,KACeC,EADf,KACsBC,EADtB,KAC+BC,EAD/B,OAE0BC,mBAASJ,EAAQE,EAASpuD,EAAQb,GAF5D,mBAEOggD,EAFP,KAEekF,EAFf,KAGMkK,EAAU7uD,KAAK66C,MAAM4T,GACrBK,EAAa9uD,KAAK66C,MAAM8T,EAAWF,GACzClS,EAAIz5B,UAAY,QAChBy5B,EAAIoD,SAASF,EAAQoP,EAASlK,EAAUlF,EAAQqP,QAEjD,CACDrvD,EACAa,EACAopB,EACA2X,EACAC,EACAT,EACAsB,IAiFF,IAAMitB,EAAcpvD,KAAKC,KAAKb,GAE9B,OACE,yBACEyW,UAAU,kBACVsD,cAAA,iBACEovC,GAAY/X,EAAZ,WACe,OAAR+X,QAAQ,IAARA,OAAA,EAAAA,EAAUn7C,OAAQ,IADzB,QACqC,OAAPojC,QAAO,IAAPA,OAAA,EAAAA,EAASpjC,OAAQ,IAD/C,QAC2D,OAAPojC,QAAO,IAAPA,OAAA,EAAAA,EAASuZ,MAAO,IAChE,UAENh1C,MAAO,CAAEtQ,SAAU,WAAYrF,MAAOgwD,EAAa/rD,WAEnD,kBAAC,qBAAD,iBACM0Q,EADN,CAEEgB,MAAO,CAAEtQ,SAAU,WAAYtB,KAAM,EAAG0U,IAAK,MAE/C,4BACEsB,cAAY,wBACZ/Z,MAAOgwD,EACP/rD,OAAQA,EACR0R,MAAO,CAAEtQ,SAAU,WAAYtB,KAAM,EAAG0U,IAAK,GAC7ChC,UAAU,yBACVoD,IAAK20C,EACLz2C,YAAa,SAAAT,GAAK,OArGxB,SAAqBA,GACnBo3C,GAAe,GACfE,GAA4B,GAC5BE,EAAiB,YAAax3C,GAkGJS,CAAYT,IAClC24C,aAAc,SAAA34C,GAAK,OAhGzB,SAAsBA,GACpBw3C,EAAiB,aAAcx3C,GA+FJ24C,CAAa34C,IACpC8S,WAAY,SAAA9S,GAAK,OA7FvB,SAAoBA,GAClBw3C,EAAiB,WAAYx3C,GAC7Bw3C,EAAiB,aAAcx3C,GA2FN8S,CAAW9S,IAChC6S,YAAa,SAAA7S,GAAK,OAzFxB,SAAqBA,GACnBw3C,EAAiB,YAAax3C,GAwFJ6S,CAAY7S,IAClC44C,UAAW,SAAA54C,GAAK,OAtFtB,SAAmBA,GACjBo3C,GAAe,GACfI,EAAiB,UAAWx3C,GAoFJ44C,CAAU54C,IAC9BmuB,aAAc,SAAAnuB,GAAK,OA5EzB,SAAsBA,GACpBw3C,EAAiB,WAAYx3C,GAC7Bw3C,EAAiB,aAAcx3C,GA0EJmuB,CAAanuB,IACpCmmB,YAAa,SAAAnmB,GAAK,OAAID,EAAUC,IAChCqD,QAAS,SAAArD,GAAK,OApFpB,SAAiBA,GACVq3C,GACHG,EAAiB,QAASx3C,GAkFNqD,CAAQrD,IAC1BgmB,cAAe,SAAAhmB,GAAK,OA1E1B,SAAuBA,GACrBw3C,EAAiB,cAAex3C,GAyEJgmB,CAAchmB,IACtC64C,QAAS,aACT/xC,OAAQ,mBC/MD+H,iCACb,iBACA,CACE7S,MAAO,CACLtF,KAAM,QACNiC,YAAa,kDACb+a,aAAc,UACdC,gBAAiB,CAAC,YAGpBmlC,gBAAiB,CACfpiD,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,kBAAmB,CAAC,KAAM,KAAM,OACzDP,aAAc,KACd/a,YACE,wIAEJ42B,YAAa,CACX74B,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,cAAe,CACtC,SACA,UACA,aAEFtb,YAAa,4BACb+a,aAAc,UAEhBqlC,mBAAoB,CAClBriD,KAAM,SACNiC,YACE,wIACF+a,aAAc,GAEhBpI,UAAW,CACT5U,KAAM,UACNiC,YAAa,sDACb+a,aAAc,MAEhBslC,gBAAiB,CACftiD,KAAM,UACNiC,YAAa,qDACb+a,aAAc,KAEhB/mB,OAAQ,CACN+J,KAAM,SACNiC,YAAa,mDACb+a,aAAc,EACdC,gBAAiB,CAAC,YAEpBmgC,UAAW,CACTp9C,KAAM,UACNiC,YAAa,kCACb+a,cAAc,GAEhBulC,6BAA8B,CAC5BviD,KAAM,SACNiC,YACE,mEACF+a,aAAc,IAEhBsgC,cAAe,CACbt9C,KAAM,UACNgd,cAAc,EACd/a,YAAa,gCAGjB,CAAEwW,iBAAiB,I,8BC3CR+pC,GAAb,kDAKE,WAAY5sC,GAAgC,kCAC1C,cAAMA,IALRulC,cAI4C,IAF5CjmC,cAAe,EAE6B,EAa5CutC,kBAb4C,EAE1C,EAAK7pD,OAASgd,EAAKhd,OAFuB,EAL9C,uDAUE,SAAoB6pD,GAClB,OACE,6EAA0BA,IAC1BjtD,KAAK0f,eAAiButC,EAAavtC,cACnCwmC,KAAUlmD,KAAK2lD,SAAUsH,EAAatH,YAd5C,kBAoBE,WAUE,OATK3lD,KAAKitD,cAAiBjtD,KAAKktD,oBAAoBltD,KAAKitD,gBACvDjtD,KAAKitD,aAAe,CAClBpsD,OAAQb,KAAKmtD,aACb/pD,OAAQK,yBAAezD,KAAKoD,QAC5BkqC,QAASttC,KAAKstC,QACdqY,SAAU3lD,KAAK2lD,SACfjmC,aAAc1f,KAAK0f,eAGhB1f,KAAKitD,aAAapsD,WA9B7B,GAAyCusD,MCiBzC,SAASC,GAAgB/7C,GACvB,MAAO,CACL3D,EAAG2D,EAAMjE,QAAQK,MAAMC,EAAET,KACzBW,EAAGyD,EAAMjE,QAAQK,MAAMG,EAAEX,KACzBa,EAAGuD,EAAMjE,QAAQK,MAAMK,EAAEb,KACzBe,EAAGqD,EAAMjE,QAAQK,MAAMO,EAAEf,KACzBogD,SAAU,WAkCd,IAAMC,GAA+C,CACnDC,4BAA6B,UAC7BC,4BAA6B,UAC7BC,iBAAkB,UAClBC,iBAAkB,UAClBC,uBAAwB,UACxBC,uBAAwB,UACxBC,mBAAoB,OACpBC,mBAAoB,UACpBC,cAAe,UACfC,cAAe,OACfC,cAAe,OACfC,cAAe,QACfC,eAAgB,OAChBC,iBAAkB,SAClBC,iBAAkB,MAClBC,kBAAmB,QASrB,SAASC,GAAqBhkD,GAC5B,OAAQ,CAAC,cAAe,iBAAiB0gB,SAAS1gB,GAAQ,I,IAGvCu8C,G,4MACnB5M,aAAc,E,wDAId,SAAmBR,GAGjB,MAAO,CAAE8U,UAFS9U,EAAI+U,YAAY,KAAKlyD,MAEnBmyD,WADDhV,EAAI+U,YAAY,KAAKlyD,S,2BAI1C,SACEklB,EACA7gB,EACAuC,EACAvG,EACAa,EACAgiB,GAEA,IAAIkvC,EAAkB,EAClBC,EAAiB,EACf7e,EAAyBtuB,EAAQvhB,IAAI,cACrC4uC,EAAcrtB,EAAQvhB,IAAI,OAGhC,GAAIuf,GAAgBqvB,EAClB,IAAK,IAAI/b,EAAI,EAAGA,EAAIgd,EAAWzwC,OAAQyzB,GAAK,EAAG,OACRgd,EAAWhd,GAAxCxoB,EADqC,EACrCA,KAAMzM,EAD+B,EAC/BA,MAD+B,IACxB+wD,eADwB,MACd,EADc,EAEhC,aAATtkD,IACQ,IAAVzM,EAAe6wD,EAAkBE,EAAYD,EAAiBC,GAX/C,MAgBK9C,mBACxBtqC,EAAQvhB,IAAI,SAAWyuD,EACvBltC,EAAQvhB,IAAI,OAAS0uD,EACrBnxD,EACAb,GApBmB,mBAgBdggD,EAhBc,KAgBNkF,EAhBM,KAuBjBgN,EAAWtrD,yBAAeL,EAAQ,SAAU,CAAEse,YAC5C2hB,EAAc5/B,yBAAeL,EAAQ,cAAe,CAAEse,YAI5D,GAHoB,YAAhB2hB,IACF0rB,GAAY,GAEVrtC,EAAQvhB,IAAI,aAAezC,EAAOG,QACpC,MAAM,IAAI2D,MAAJ,kBACOkgB,EAAQphB,KADf,8DAEF5C,EAAOG,UAIb,IAAMguD,EAAQhrD,EAAOD,QACnB8gB,EAAQphB,KACRohB,EAAQvhB,IAAI,SAAWyuD,EACvBltC,EAAQvhB,IAAI,OAAS0uD,EACrBE,GAEF,OAAc,OAAVlD,EACK,KAGF,CACLnqC,UACAm7B,SACAkF,UACA8J,MAAuB,aAAhBxoB,EAA6B,EAAIwoB,EACxCkD,c,+BAOJ,SAAkBrxD,EAAgBu/B,GAAoC,IAC5D75B,EAAyB65B,EAAzB75B,OAAQsc,EAAiBud,EAAjBvd,aAEVotC,EAAkBrpD,yBAAeL,EAAQ,mBACvCrF,EAAeL,EAAfK,MAAOE,EAAQP,EAARO,IACT+wD,EAAM/wD,EAAMF,EACZkxD,EAAc7xD,KAAKuB,IACvBqwD,EACAtvC,EAAetiB,KAAK66C,MAAM6U,GAAmB,GAG/C,kCACKpvD,GADL,IAEEK,MAAOX,KAAKiB,MAAMjB,KAAKuB,IAAIZ,EAAQkxD,EAAa,IAChDhxD,IAAKb,KAAKC,KAAKY,EAAMgxD,O,gCAIzB,SAAmBvtC,EAAkBte,GACnC,OAAOmqD,GACLvtD,KAAKkvD,eAAextC,EAASte,IAAW,oB,4BAI5C,SAAese,EAAkBte,GAC/B,IAAMwpD,EAAkBnpD,yBAAeL,EAAQ,mBAY/C,MANuC,CACrC+rD,GAAI,gBACJC,GAAI,gBACJC,GAAI,gBACJC,GAAI,iBANOC,KAAiB3C,GACLlrC,EAAQvhB,IAAI,wB,+BAUvC,SAAkBuhB,EAAkB8tC,GAClC,OAAO9tC,EAAQvhB,IAAI,cACjBuhB,EAAQvhB,IAAI,YAAcuhB,EAAQvhB,IAAI,eACpC,OAFG,cAGI/C,KAAKshD,IAAIh9B,EAAQvhB,IAAI,oBAAsB,GAH/C,e,6BAMT,SAAgBuhB,EAAkB8tC,GAChC,IAAMC,EAAQ/tC,EAAQvhB,IAAI,SACpB8kC,EAASvjB,EAAQvhB,IAAI,UAE3B,GAAY,EAARsvD,EAAW,CACb,IACMC,EADkB,GAARD,GACW,EAAI,EAE/B,OAAY,EAARA,EACKxqB,EAASyqB,IAAY,EAAI,mBAAqB,mBAEnDhuC,EAAQvhB,IAAI,uCACP8kC,EAASyqB,IAAY,EACxB,yBACA,yBAEFhuC,EAAQvhB,IAAI,YAAcuhB,EAAQvhB,IAAI,eACjC8kC,EAASyqB,IAAY,EACxB,8BACA,8BAGY,IAAXzqB,EAAe,qBAAuB,qBAE/C,OAAkB,IAAXA,EAAe,mBAAqB,qB,mCAG7C,SACE0U,EACAtL,EACAmhB,EACA9xD,EACAb,GASA,IARA,IACQ6kB,EAA6B2sB,EAA7B3sB,QAASmqC,EAAoBxd,EAApBwd,MAAOkD,EAAa1gB,EAAb0gB,SAElBY,GADejuC,EAAQvhB,IAAI,SAAW,IACxBivC,MAAM,KAAKrqC,KAAI,SAAAgZ,GAAG,OAAKA,KACrC6wB,EAAWC,sBAAWntB,EAAQvhB,IAAI,UAClC3D,EAAQ,EAAIK,EACZkB,EAAQ2jB,EAAQvhB,IAAI,SAEjB6yB,EAAI,EAAG8b,EAAI,EAAG5rC,EAAI,EAAGA,EAAIysD,EAAOpwD,OAAQyzB,GAAK,EAAG9vB,IAAK,CAC5D,IAAM8rD,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACxB,GAAW,MAAP48B,GAAqB,MAAPA,EAChB1sD,GAAK8rD,OACA,GAAW,MAAPY,GAAqB,MAAPA,EACvB9gB,GAAKkgB,OACA,GAAW,MAAPY,GAAqB,MAAPA,GAAqB,MAAPA,EAAY,CACjD,IAAK,IAAIC,EAAI,EAAGA,EAAIb,EAAKa,IAAK,CAC5B,IAAMniB,EAAQiiB,EAAOzsD,EAAI2sD,GACzBlW,EAAIz5B,UAAJ,cAAiC,MAAVwtB,EAAgB,IAAc,IAARA,EAA7C,aAF4B,MAGXse,mBACfjuD,EAAQ+wC,EAAI+gB,EACZ9xD,EAAQ+wC,EAAI+gB,EAAI,EAChBnyD,EACAb,GAJKggD,EAHqB,oBAS5BlD,EAAIoD,SAASF,EAAQgP,EAAOrvD,EAAQ,GAAKuyD,GAE3CjgB,GAAKkgB,M,kCAcX,SACErV,EACAmW,EACAN,EACA9xD,EACAb,EACAsU,GACA,IACQuQ,EAA6BouC,EAA7BpuC,QAASmqC,EAAoBiE,EAApBjE,MAAOkD,EAAae,EAAbf,SADxB,EAEoC59C,EAA5Bi3C,0BAFR,MAE6B,GAF7B,EAIMpZ,EAAMC,aAAUvtB,EAAS,KAAM,OAAoB,GAEnDwtB,EAAMD,aAAUvtB,EAAS,KAAM,OAA+B,GAE9DytB,EAAgBD,GACH,kBAAPA,EAAkBA,EAAGE,MAAM,KAAKrqC,KAAI,SAAAiyB,GAAC,OAAKA,KAAKkY,GAAInqC,KACzD,SAAAiyB,GAAC,OAAIA,EAAI,OAEViY,aAAUvtB,EAAS,KAAM,MACvB0tB,MAAM,IACNrqC,KAAI,SAAA2vB,GAAC,OAAIA,EAAE2a,WAAW,GAAK,MAC3BtqC,KAAI,SAAAuqC,GAAG,OAAIlyC,KAAKwB,IAAI,EAAG0wC,EAAM,OAE9Bd,EAAQ9sB,EAAQvhB,IAAI,SACpBpC,EAAQ2jB,EAAQvhB,IAAI,SACpBlC,EAAMyjB,EAAQvhB,IAAI,OAClB4uC,EAAMrtB,EAAQvhB,IAAI,OAClByuC,EAAWC,sBAAWL,GAEtBuhB,EAAgBvgB,oCAAyBR,EAAID,GAG/CQ,EAAY,EAChBwgB,EAActyD,SAAQ,YAAyB,MAAtB+M,EAAsB,EAAtBA,KAAMilC,EAAgB,EAAhBA,UACvBugB,EAAM5H,EAAmB59C,IAAS,QAClC0lC,EAAOmS,KAAM2N,GAF0B,eAGvBrgB,yBAAcf,EAAUa,IAHD,IAG7C,2BAA0D,KAA/CwgB,EAA+C,QACxD,GAAIA,GAAW,GAAKlyD,EAAQkyD,EAAUhyD,EAAK,OACf+tD,mBACxBjuD,EAAQkyD,EACRlyD,EAAQkyD,EAAU,EAClBvyD,EACAb,GALuC,mBAClCggD,EADkC,KAC1BkF,EAD0B,KAUzCpI,EAAIz5B,UAAYgwB,EACbggB,MAAM/gB,EAAcI,GAAa,IACjC4gB,MACAnqD,SACH2zC,EAAIoD,SAASF,EAAQgP,EAAO9J,EAAUlF,EAAS,GAAKkS,GAEtDxf,KApB2C,oC,gCA4BjD,SACEoK,EACAmW,EACAN,EACA9xD,EACAb,EACAsU,GACA,IACQi/C,EAAmBj/C,EAAnBi/C,eACA1uC,EAA6BouC,EAA7BpuC,QAASmqC,EAAoBiE,EAApBjE,MAAOkD,EAAae,EAAbf,SAElB/f,EAAaC,aAAUvtB,EAAS,KAAM,OAAS,GAErD,IAAK0uC,EACH,MAAM,IAAI5uD,MAAM,4CAGlB,IAAMgtC,EAAQ9sB,EAAQvhB,IAAI,SACpBsuC,EAAS/sB,EAAQvhB,IAAI,SACrBuuC,EAAOhtB,EAAQvhB,IAAI,OACnB4uC,EAAMrtB,EAAQvhB,IAAI,OAClByuC,EAAWC,sBAAWL,GACb6hB,EAAsB3yD,EAA7BK,MAAoBuyD,EAAS5yD,EAAdO,IAEjB4xC,EAAW,IAAI54B,MAAMq5C,EAAOD,GAAQj+C,KAAK,GAC/Co9B,oCAAyBR,EAAID,GAAKtxC,SAAQ,YAAyB,IAAtB+M,EAAsB,EAAtBA,KAAMilC,EAAgB,EAAhBA,UACjD,GAAa,MAATjlC,GAAgBilC,EAAW,sBACXE,yBAAcf,EAAUa,IADb,IAC7B,2BAAsD,KAC9CG,EAD8C,QACjCnB,EAAS4hB,EACxBzgB,GAAQ,GAAKA,EAAOC,EAAStwC,SAC/BswC,EAASD,GAAQ,IAJQ,mCAUjC,IAAK,IAAId,EAAIL,EAAQK,EAAIJ,EAAMI,IAAK,CAClC,IAAM9b,EAAI8b,EAAIuhB,EACd,GAAIr9B,GAAK,GAAKA,EAAI6c,EAAStwC,OAAQ,CACjC,IAAMuwC,EAAKsgB,EAAep9B,EAAI,GAG9B,GAAyB,MAFdo9B,EAAep9B,GAEnB3oB,eAA8C,MAArBylC,EAAGzlC,cAAuB,OAC9B2hD,mBACxBqE,EAASr9B,EACTq9B,EAASr9B,EAAI,EACbt1B,EACAb,GALsD,mBACjDggD,EADiD,KACzCkF,EADyC,KAOpDlS,EAAS7c,GACX2mB,EAAIz5B,UAAY,MAEhBy5B,EAAIz5B,UAAY,OAElBy5B,EAAIoD,SAASF,EAAQgP,EAAO9J,EAAUlF,EAAS,GAAKkS,Q,sBAM5D,SACEpV,EACAtL,EACAl9B,GACA,IACQ6V,EAAqB7V,EAArB6V,QAASnqB,EAAYsU,EAAZtU,QACTkyD,EAA6B1gB,EAA7B0gB,SAAUlD,EAAmBxd,EAAnBwd,MAAOnqC,EAAY2sB,EAAZ3sB,QAClBhkB,EAHP,YAGiBspB,EAHjB,QAI0BglC,mBACxBtqC,EAAQvhB,IAAI,SACZuhB,EAAQvhB,IAAI,OACZzC,EACAb,GARF,mBAIOggD,EAJP,KAIekF,EAJf,KAUMwO,EAAO7yD,EAAOQ,UAAY,EAAI,EAC9B+mC,EAASvjB,EAAQvhB,IAAI,UAAYowD,EACnC1zD,EAAU,IACI,IAAZooC,GACF0U,EAAIgJ,YACJhJ,EAAIiI,OAAO/E,EAAS,EAAGgP,EAAQkD,EAAW,GAC1CpV,EAAIkI,OAAOhF,EAAQgP,EAAQkD,GAC3BpV,EAAIkI,OAAOE,EAAS8J,EAAQkD,GAC5BpV,EAAIkI,OAAOE,EAAS8J,GACpBlS,EAAIkI,OAAOhF,EAAQgP,GACnBlS,EAAI6W,YACJ7W,EAAIvnC,SAEJunC,EAAIgJ,YACJhJ,EAAIiI,OAAO/E,EAAQgP,GACnBlS,EAAIkI,OAAOhF,EAAQgP,EAAQkD,GAC3BpV,EAAIkI,OAAOE,EAAS8J,EAAQkD,GAC5BpV,EAAIkI,OAAOE,EAAU,EAAG8J,EAAQkD,EAAW,GAC3CpV,EAAIkI,OAAOE,EAAS8J,GACpBlS,EAAI6W,YACJ7W,EAAIvnC,QAGNunC,EAAIoD,SAASF,EAAQgP,EAAO9J,EAAUlF,EAAQkS,K,+BAIlD,SACEpV,EACAtL,EACAl9B,GACA,IACQ/N,EAAwD+N,EAAxD/N,OAAQvG,EAAgDsU,EAAhDtU,QAASmqB,EAAuC7V,EAAvC6V,QAAS4mB,EAA8Bz8B,EAA9By8B,QADlC,EACgEz8B,EAArBg3C,mBAD3C,MACyD,GADzD,IAE2Cva,GAAW,GAFtD,IAEQuZ,WAFR,MAEc,GAFd,MAEkB38C,KAAMimD,OAFxB,MAEoC,GAFpC,EAGQ/uC,EAAY2sB,EAAZ3sB,QACFhkB,EAASspB,EAAQ,GAIvB,OAAQypC,GACN,IAAK,aACH9W,EAAIz5B,UAAYlgB,KAAK0wD,kBAAkBhvC,EAASte,GAChD,MACF,IAAK,SACHu2C,EAAIz5B,WAAuC,IAA3BwB,EAAQvhB,IAAI,UAAmB,UAAY,UAC3D,MACF,IAAK,iBACHw5C,EAAIz5B,UAAJ,cAAuBwB,EAAQvhB,IAAI,MAAnC,aACA,MAEF,IAAK,kBACHw5C,EAAIz5B,UAAYlgB,KAAK2wD,mBAAmBjvC,EAASte,GACjD,MACF,IAAK,WACHu2C,EAAIz5B,UAAYqtC,GAAkBvtD,KAAK4wD,gBAAgBlvC,EAASte,IAChE,MACF,IAAK,KACL,IAAK,MACH,IAAMytD,EAAOnvC,EAAQvhB,IAAI,QACnB4d,EAAM8yC,EAAOA,EAAK1J,GAAOzlC,EAAQvhB,IAAIgnD,GAG3C,GAAY,OAARA,GAAwB,OAARA,EAAc,CAKhCxN,EAAIz5B,UAAYqtC,GAJmC,CACjD,IAAK,mBACL,IAAK,oBAE+BxvC,IAAQ,kBAIhD,GAAY,OAARopC,EAAc,CAChB,IAAMpiD,EAAiC,CACrC,KAC6B,IAA3B2c,EAAQvhB,IAAI,UACR,mBACA,mBACN,KAC6B,IAA3BuhB,EAAQvhB,IAAI,UACR,mBACA,oBAERw5C,EAAIz5B,UAAYqtC,GAAkBxoD,EAAIgZ,IAAQ,sBAK3C,CACH,IAAM+yC,EAAa3I,EAAYpqC,GAC/B47B,EAAIz5B,UAAY4wC,GAAc,iBAEhC,MAEF,IAAK,+BACH,MAEF,IAAK,SACL,QACEnX,EAAIz5B,UAAYzc,yBAAeL,EAAQ,QAAS,CAAEse,YAQtD,OAJA1hB,KAAK+wD,SAASpX,EAAKtL,EAAMl9B,GAIjBs/C,GACN,IAAK,iBACHzwD,KAAKgxD,sBAAsBrX,EAAKtL,EAAMjrC,EAAQ1F,EAAQb,GACtD,MAEF,IAAK,gBACHmD,KAAKixD,qBAAqBtX,EAAKtL,EAAMjrC,EAAQ1F,EAAQb,EAASsU,GAC9D,MAEF,IAAK,cACHnR,KAAKkxD,mBAAmBvX,EAAKtL,EAAMjrC,EAAQ1F,EAAQb,EAASsU,M,4BAKlE,SACEwoC,EACAtL,EACAl9B,EACAG,EACA6/C,EACAztD,GAKA,IACQokD,EAAsDpkD,EAAtDokD,cADR,EAC8DpkD,EAAvC0tD,gBADvB,WAC8D1tD,EAAtB2tD,kBADxC,SAEQjuD,EAA6B+N,EAA7B/N,OAAQvG,EAAqBsU,EAArBtU,QAASmqB,EAAY7V,EAAZ6V,QACjB+nC,EAA6B1gB,EAA7B0gB,SAAUlD,EAAmBxd,EAAnBwd,MAAOnqC,EAAY2sB,EAAZ3sB,QAHzB,EAIkC1hB,KAAKsxD,mBAAmB3X,GAAlD8U,EAJR,EAIQA,UAAWE,EAJnB,EAImBA,WACZjxD,EALP,YAKiBspB,EALjB,MAMMjpB,EAAQ2jB,EAAQvhB,IAAI,SACpBoxD,EAAe9tD,yBAAeL,EAAQ,sBACtCouD,EAAiB/tD,yBACrBL,EACA,gCAEIquD,EAAUr0D,KAAKwB,IAAI,EAAI/B,EAAS,GAChCigD,EAAI1/C,KAAKuB,IAAI4yD,EAAcE,GAC3BzhB,EAAyBtuB,EAAQvhB,IAAI,cACrCuxD,EAAY/C,EAAa,EAE/B,SAASgD,EAAcC,EAAmBtlB,GACxC,IAAIx8B,EAAQ8hD,EAOZ,OANI9J,QAAmC1nD,IAAlBksC,EAASulB,OAC5B/hD,EAAQuyC,KAAMuP,GACX1B,MAAM9yD,KAAKwB,IAAI,EAAG0tC,EAASulB,KAAO,KAClC1B,MACAnqD,UAEE8J,EAKT,IAAK,IAAIkjB,EAAI,EAAGA,EAAIgd,EAAWzwC,OAAQyzB,GAAK,EAAG,CAC7C,IAAMsZ,EAAW0D,EAAWhd,GADiB,EAEHg5B,mBACxCjuD,EAAQuuC,EAASvuC,MACjBA,EAAQuuC,EAASvuC,MAAQuuC,EAAS/sC,OAClC7B,EACAb,GAN2C,mBAEtCi1D,EAFsC,KAEtBC,EAFsB,KAQvCC,EAAkB50D,KAAKuB,IAC3B4yD,EACAn0D,KAAKshD,IAAIoT,EAAiBC,IAE5B,GAAsB,aAAlBzlB,EAAS9hC,MAAuB4mD,EAAU,CAC5C,IAAMQ,EAAYT,EAAa7kB,EAAS4D,OAAS,OAEjDyJ,EAAIz5B,UAAYyxC,EAAcC,EAAWtlB,GAEzCqN,EAAIoD,SAAS+U,EAAgBjG,EAAOmG,EAAiBjD,GAEjDiD,GAAmBvD,GAAaM,GAAY2C,IAE9C/X,EAAIz5B,UAAYyxC,EACdrgD,EAAMjE,QAAQ4kD,gBAAgBL,GAC9BtlB,GAEFqN,EAAIuY,SACF5lB,EAAS4D,KACT4hB,GAAkBE,EAAkBvD,GAAa,EAAI,EACrD5C,EAAQkD,SAGP,GAAsB,aAAlBziB,EAAS9hC,MAAuB6mD,EAAY,CACrD,IAAMO,EAAYT,EAAa7D,SAC/B3T,EAAIz5B,UAAY0xC,EAChBjY,EAAIoD,SAAS+U,EAAgBjG,EAAOmG,EAAiBjD,GACjDiD,GAAmBvD,GAAaM,GAAY2C,IAC9C/X,EAAIz5B,UAAY5O,EAAMjE,QAAQ4kD,gBAAgBL,GAC9CjY,EAAIuY,SACF5lB,EAAS4D,KACT4hB,GAAkBE,EAAkBvD,GAAa,EAAI,EACrD5C,EAAQkD,SAGP,GAAsB,cAAlBziB,EAAS9hC,MAAwB6mD,EAAY,CACtD1X,EAAIz5B,UAAY,SAChB,IAAM1L,EAAMs9C,EAAiB,IAChBxlB,EAAS4D,MAAQ5D,EAAS/sC,QAC7B,KACRo6C,EAAIoD,SAASvoC,EAAKq3C,EAAO/O,EAAGiS,GACxB,EAAIlyD,GAAW4xD,IACjB9U,EAAIoD,SAASvoC,EAAMsoC,EAAG+O,EAAW,EAAJ/O,EAAO,GACpCnD,EAAIoD,SAASvoC,EAAMsoC,EAAG+O,EAAQkD,EAAW,EAAO,EAAJjS,EAAO,IAEjD,EAAIjgD,GAAW4xD,GAAaM,GAAY2C,GAC1C/X,EAAIuY,SAAJ,WACM5lB,EAAS4D,KADf,KAEE4hB,EAAiB,EACjBjG,EAAQkD,SAIT,GAAsB,aAAlBziB,EAAS9hC,MAAyC,aAAlB8hC,EAAS9hC,KAAqB,CACvEmvC,EAAIz5B,UAA8B,aAAlBosB,EAAS9hC,KAAsB,MAAQ,OACvD,IAAMgK,EAAMs9C,EAAiB,EAC7BnY,EAAIoD,SAASvoC,EAAKq3C,EAAQ,EAAG/O,EAAGiS,EAAW,GAC3CpV,EAAIoD,SAASvoC,EAAMsoC,EAAG+O,EAAW,EAAJ/O,EAAO,GACpCnD,EAAIoD,SAASvoC,EAAMsoC,EAAG+O,EAAQkD,EAAW,EAAO,EAAJjS,EAAO,GAC/CkV,GAAmBvD,GAAaM,GAAY2C,GAC9C/X,EAAIuY,SAAJ,WACM5lB,EAAS4D,KADf,KAEE4hB,EAAiB,EACjBjG,EAAQkD,OAGe,SAAlBziB,EAAS9hC,OAIdsnD,EAAiBE,EAAkB,GACrCrY,EAAIgS,UACFmG,EACAjG,EAEAmG,GAAmBn1D,EAAU,GAAK,IAAM,GACxCkyD,GAGJpV,EAAIz5B,UAAY,OAChBy5B,EAAIoD,SAAS+U,EAAgBjG,EAAQkD,EAAW,EAAGiD,EAAiB,IAKxE,GAAIX,EACF,IAAK,IAAIr+B,EAAI,EAAGA,EAAIgd,EAAWzwC,OAAQyzB,GAAK,EAAG,CAC7C,IAAMsZ,EAAW0D,EAAWhd,GADiB,EAEpBg5B,mBACvBtqC,EAAQvhB,IAAI,SAAWmsC,EAASvuC,MAChC2jB,EAAQvhB,IAAI,SAAWmsC,EAASvuC,MAAQuuC,EAAS/sC,OACjD7B,EACAb,GAJKi1D,EAFsC,oBAQvC9C,GAAO1iB,EAAS4D,MAAQ5D,EAAS/sC,OACjC4yD,EAAM,GAAH,OAAMnD,GACf,GAAsB,cAAlB1iB,EAAS9hC,MAAwBwkD,GAAO,GAC1C,GAAInyD,EAAU20D,EACZ7X,EAAIz5B,UAAY,SAChBy5B,EAAIoD,SAAS+U,EAAiB,EAAGjG,EAAO,EAAGkD,QACtC,GAAIA,EAAWJ,EAAY,CAChC,IAAMz0B,EAAOyf,EAAI+U,YAAYyD,GAE7BxY,EAAIz5B,UAAY,SAChBy5B,EAAIoD,SACF+U,EAAiB53B,EAAK19B,MAAQ,EAHhB,EAIdqvD,EACA3xB,EAAK19B,MAAQ,GACbuyD,GAEFpV,EAAIz5B,UAAY,QAChBy5B,EAAIuY,SAASC,EAAKL,EAAiB53B,EAAK19B,MAAQ,EAAGqvD,EAAQkD,OACtD,CAELpV,EAAIz5B,UAAY,SAChBy5B,EAAIoD,SAAS+U,EAFG,EAEuBjG,EAAO,EAAakD,O,8BAOrE,SACEpV,EACAtL,EACAl9B,EACA/N,EACAkO,GACA,IACQoQ,EAA6B2sB,EAA7B3sB,QAASmqC,EAAoBxd,EAApBwd,MAAOkD,EAAa1gB,EAAb0gB,SAChB/nC,EAAqB7V,EAArB6V,QAASnqB,EAAYsU,EAAZtU,QACVa,EAHP,YAGiBspB,EAHjB,MAIMuqC,EAAe9tD,yBAAeL,EAAQ,sBACtC4sC,EAAyBtuB,EAAQvhB,IAAI,cACrC4uC,EAAMrtB,EAAQvhB,IAAI,OANxB,EAOkCH,KAAKsxD,mBAAmB3X,GAAlD8U,EAPR,EAOQA,UAAWE,EAPnB,EAOmBA,WACbwC,EAA0C,CAC9CxjD,EAAG2D,EAAMjE,QAAQK,MAAMC,EAAET,KACzBW,EAAGyD,EAAMjE,QAAQK,MAAMG,EAAEX,KACzBa,EAAGuD,EAAMjE,QAAQK,MAAMK,EAAEb,KACzBe,EAAGqD,EAAMjE,QAAQK,MAAMO,EAAEf,KACzBogD,SAAU,WAIRve,GACFiB,EACGllB,QAAO,SAAAwhB,GAAQ,MAAsB,aAAlBA,EAAS9hC,QAC5B/M,SAAQ,SAAA6uC,GAOP,IANA,IAAM8lB,EAAiB9lB,EAASwiB,SAAW,EACrCuD,EACe,IAAnB/lB,EAASvuC,MACL2jB,EAAQvhB,IAAI,SAAWiyD,EACvB1wC,EAAQvhB,IAAI,SAAWmsC,EAASvuC,MAE7BmF,EAAI,EAAGA,EAAIkvD,EAAgBlvD,GAAK,EAAG,CAC1C,IAAMgtC,EAAOnB,EAAIujB,OAAOpvD,EAAIopC,EAASvuC,OAIrC,IAAKmyC,EACH,OANwC,MASA8b,mBACxCqG,EAAgBnvD,EAChBmvD,EAAgBnvD,EAAI,EACpBxF,EACAb,GAbwC,mBASnC01D,EATmC,KASnBC,EATmB,KAepCC,EAAkBr1D,KAAKuB,IAC3B4yD,EACAn0D,KAAKshD,IAAI6T,EAAiBC,IAKtBZ,EAAYT,EAAajhB,IAAS,UACxCyJ,EAAIz5B,UAAY0xC,EAChBjY,EAAIoD,SAASwV,EAAgB1G,EAAO4G,EAAiB1D,GAEjD0D,GAAmBhE,GAAaM,GAAYJ,EAAa,IAC3DhV,EAAIz5B,UAAY5O,EAAMjE,QAAQ4kD,gBAAgBL,GAC9CjY,EAAIuY,SACFhiB,EACAqiB,GAAkBE,EAAkBhE,GAAa,EAAI,EACrD5C,EAAQkD,U,kEAQtB,WACEpV,EACA+Y,EACAvhD,GAHF,oCAAAxP,EAAA,yDAKUd,EAA8DsQ,EAA9DtQ,OAAQuC,EAAsD+N,EAAtD/N,OAAQsc,EAA8CvO,EAA9CuO,aAAckuB,EAAgCz8B,EAAhCy8B,QAAgB+kB,EAAgBxhD,EAAvBG,MACzCw2C,EAAgBrkD,yBAAeL,EAAQ,iBACvCkO,EAAQD,8BAAmBshD,GAC3BxB,EAAe9D,GAAgB/7C,GAChCzQ,EATP,sBAUU,IAAIW,MAAJ,mBAVV,UAYOX,EAAOD,QAZd,sBAaU,IAAIY,MAAM,yBAbpB,OAeEm4C,EAAIx5B,KAAO,kCAEXuyC,EAAcj1D,SAAQ,SAAC4wC,GACrB,GAAa,OAATA,EAAJ,CADmC,IAK3B3sB,EAA6B2sB,EAA7B3sB,QAASmqC,EAAoBxd,EAApBwd,MAAOkD,EAAa1gB,EAAb0gB,SAExBpV,EAAIz5B,UAAYzc,yBAAeL,EAAQ,QAAS,CAAEse,YAClD,EAAKkxC,kBAAkBjZ,EAAK,CAAEj4B,UAASmqC,QAAOkD,YAAY59C,GAC1D,EAAK0hD,eAAelZ,EAAKtL,EAAMl9B,EAAOG,EAAO6/C,EAAc,CACzDrJ,gBAEAsJ,SAAU5C,GAAoB,OAAC5gB,QAAD,IAACA,OAAD,EAACA,EAASpjC,MACxC6mD,WAAY7C,GAAoB,OAAC5gB,QAAD,IAACA,OAAD,EAACA,EAASpjC,QAExCkV,GACF,EAAKozC,iBAAiBnZ,EAAKtL,EAAMl9B,EAAO/N,EAAQkO,OAjCtD,4C,oFAwCA,SAAYH,GAAoD,WAE5DtQ,EAOEsQ,EAPFtQ,OACAgmB,EAME1V,EANF0V,SACA8+B,EAKEx0C,EALFw0C,SACAviD,EAIE+N,EAJF/N,OACAvG,EAGEsU,EAHFtU,QACA6iB,EAEEvO,EAFFuO,aACAsH,EACE7V,EADF6V,QAEKtpB,EAVuD,YAU7CspB,EAV6C,MAW9D,IAAKnmB,EACH,MAAM,IAAIW,MAAJ,mBAER,IAAKX,EAAOD,QACV,MAAM,IAAIY,MAAM,yBAGlB,IAIMuxD,GAHJpN,GAAYA,EAASn7C,MAAQ9M,EAAOK,QAAU4nD,EAASnxC,IC11BlC,SACzBqS,EACA8+B,GAEA,IAAMqN,EAAe/7C,MAAM/U,KAAK2kB,EAASnkB,UACnCuwD,EAAkC,GAClCC,EAAmC,GACjC1+C,EAAcmxC,EAAdnxC,IAAKhK,EAASm7C,EAATn7C,KAGbwoD,EAAav1D,SAAQ,SAAA01D,GACnB,IAAMzxC,EAAUyxC,EACVp1D,EAAQ2jB,EAAQvhB,IAAI,SACpBlC,EAAMyjB,EAAQvhB,IAAI,OACpBizD,aAAe5+C,EAAM,EAAGA,EAAKzW,EAAOE,GACtCg1D,EAAqB/zD,KAAKi0D,GAE1BD,EAAsBh0D,KAAKi0D,MAI/B,IAAME,IAASL,EAAazzD,QAASyzD,EAAa,GAAG7yD,IAAI,QACzD,OAAQqK,GACN,IAAK,iBACHyoD,EAAqBK,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAExB,IAAI,SAAW60B,EAAE70B,IAAI,YAC3D,MAGF,IAAK,MACH,IAAMgnD,EAAMxB,EAASwB,IACfoM,EAAS,SAACvwD,EAAY2xC,GAC1B,OAAO0e,EAASrwD,EAAE7C,IAAI,QAAQw0C,GAAK3xC,EAAE7C,IAAIw0C,IAGzCse,EAAqB,IAC2B,kBAAzCM,EAAON,EAAqB,GAAI9L,GAEvC8L,EAAqBK,MAAK,SAAC3xD,EAAGqzB,GAAJ,OACxBu+B,EAAOv+B,EAAGmyB,GAAKqM,cAAcD,EAAO5xD,EAAGwlD,OAGzC8L,EAAqBK,MACnB,SAAC3xD,EAAGqzB,GAAJ,OAAWu+B,EAAOv+B,EAAGmyB,IAAQ,IAAMoM,EAAO5xD,EAAGwlD,IAAQ,MAGzD,MAIF,IAAK,YACH,IAAMsM,EAAsC,GAC5CR,EAAqBx1D,SAAQ,SAAAikB,GACIA,EAAQvhB,IAAI,cAChC1C,SAAQ,SAAA6uC,GACjB,IACM1qC,EADQ8f,EAAQvhB,IAAI,SACHmsC,EAASvuC,MAAQ,EAGlCixD,EADc,cAAlB1iB,EAAS9hC,MAA0C,aAAlB8hC,EAAS9hC,KACpB,EAAI8hC,EAAS/sC,OACjCiV,GAAO5S,GAAU4S,EAAM5S,EAASotD,GAClCyE,EAAcv0D,KAAK,CAACwiB,EAAQphB,KAAMgsC,UAKxC,IAAMonB,EAAU,IAAI5zD,IAAI2zD,GACxBR,EAAqBK,MAAK,SAAC3xD,EAAGqzB,GAC5B,IAAM2+B,EAAYD,EAAQvzD,IAAIwB,EAAErB,MAC1BszD,EAAYF,EAAQvzD,IAAI60B,EAAE10B,MAC1BuzD,EAAQD,GAAaA,EAAU1jB,KAAK7lC,cACpCypD,EAAQH,GAAaA,EAAUzjB,KAAK7lC,cAC1C,OAAIwpD,IAAUC,GAAmB,MAAVD,EAEdF,EAAUp0D,OAASq0D,EAAUr0D,QAGnCs0D,EAAQA,EAAMxkB,WAAW,GAAK,IAAMykB,EAAQA,EAAMzkB,WAAW,GAAK,MAIvE,MAIF,IAAK,cACH4jB,EAAqBK,MAAK,SAAC3xD,EAAGqzB,GAAJ,OACxBrzB,EAAExB,IAAI,WAAa60B,EAAE70B,IAAI,UAAY,GAAK,KAYhD,OANkB,IAAIL,IACpBmzD,EACGc,OAAOb,GACPnuD,KAAI,SAAA2c,GAAO,MAAI,CAACA,EAAQphB,KAAMohB,OD4vB3BsyC,CAAYntC,EAAU8+B,GACtB,OAC+B9+B,EAcrC,OAbsBotC,kBACpBlB,EAAWrwD,UACX,SAAAgf,GAAO,OACL,EAAKouC,cACHpuC,EACA7gB,EACAuC,EACAvG,EACAa,EACAgiB,KAEJqzC,EAAW1kD,Q,2DAKf,WAAaxF,GAAb,sDAAAlH,EAAA,6DACU9E,EAAqBgM,EAArBhM,QAASmqB,EAAYne,EAAZme,QADnB,SAEyBhnB,KAAK2zB,YAAY9qB,GAF1C,UAEQge,EAFR,OAGQhmB,EAASb,KAAKk0D,qBAAqBrrD,GAEnC6pD,EAAgB1yD,KAAKm0D,YAAL,2BAAsBtrD,GAAtB,IAAmCge,WAAUhmB,aAG1BgI,EAAY0b,cAClD2oB,gBATL,iCAUY4E,EACJ9xC,KAAKsX,cACLzO,EAAYwb,UAEZxb,EAAY0b,cAAc2oB,iBAdlC,gDAgBM,GAhBN,kBAQuBA,EARvB,EAQUD,YARV,cAiBmBjmB,EAjBnB,GAiBStpB,EAjBT,MAkBiBwvC,EAlBjB,kCAmBaA,EACJvZ,YAAY,CACX51B,MAAOL,EAAOK,MACdE,IAAKP,EAAOO,IAAM,EAClBJ,QAASH,EAAOG,QAChBD,aAAcF,EAAOE,eAEtBiH,KAAKspC,eACLC,YA3BT,iDA4BM,GA5BN,yCAkBSC,EAlBT,KA6BQ+hB,EA7BR,OA6ByB/hB,QA7BzB,IA6ByBA,OA7BzB,EA6ByBA,EAAMluC,IAAI,OAE3B3D,GAASkB,EAAOO,IAAMP,EAAOK,OAASlB,EACtC4D,EAASrD,KAAKuB,IAAIkC,EAAOk4B,iBAAkB,GAhCnD,UAkCoBogB,GAChB38C,EACAiE,EACAoI,GACA,SAAC8wC,GAAD,OACE,EAAKya,cAAcza,EAAK+Y,EAAxB,2BACK7pD,GADL,IAEEhI,SACAgmB,WACAupC,uBA3CR,eAkCQpuD,EAlCR,wHAgDO6G,GACA7G,GAjDP,IAkDI6kB,WACAhmB,SACAJ,SACAjE,WArDJ,eA+CQ69C,EA/CR,gEAyDOA,GACAr4C,GA1DP,IA2DI6kB,WACAhmB,SACAJ,SACAjE,QACAs8B,iBAAkBj4B,EAAOi4B,oBA/D7B,iD,kFAmEA,SAAc1Y,GACZ,OAAO,IAAI4sC,GAAoB5sC,O,GA30BS0R,ME5G7B,YAACxa,GAAD,OACb/R,QAAMg/C,MAAK,kBACT5hC,8BACE,qBACA,CACEwqB,WAAY71B,EAAc2sB,0BAA0B,YAEtD,CAAEhhB,iBAAiB,Q,WCPV,YAAC3L,GACd,MAAO,CACL8Q,gBAAiB,kBAAM,0CAA+BC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,YAClE+N,aAAckhB,GAAoB1sB,GAClCjS,oBAAqBD,kBCNVud,iCAAoB,sBAEjC,CACEs5B,UAAW,CACTzxC,KADS,QAETiC,YAFS,mCAGT+a,aAAc,OAEhB6sC,mBAAoB,CAClB7pD,KADkB,SAElBiC,YAFkB,gEAIlB+a,aAAc,IAEhBgjC,oBAAqB,CACnBhgD,KADmB,UAEnBiC,YAFmB,kJAInB+a,cAAc,GAEhBijC,eAAgB,CACdjgD,KADc,UAEdiC,YAFc,+DAId+a,cAAc,IAGlB,CAAEvE,iBAAiB,ICDAqxC,G,0JAGnB,SACE3a,EACAxoC,GACA,IAEE0V,EAUE1V,EAVF0V,SACAG,EASE7V,EATF6V,QACAnqB,EAQEsU,EARFtU,QACA6/C,EAOEvrC,EAPFurC,UACQ2E,EAMNlwC,EANF1Q,OACOkyD,EAKLxhD,EALFG,MACQijD,EAINpjD,EAJF/N,OACAk5C,EAGEnrC,EAHFmrC,oBACS55C,EAEPyO,EAFF0sC,MAASn7C,OACT0lD,EACEj3C,EADFi3C,mBAEI92C,EAAQD,8BAAmBshD,GAC1Bj1D,EAdP,YAciBspB,EAdjB,MAeMxqB,GAASkB,EAAOO,IAAMP,EAAOK,OAASlB,EAKtC+E,EAAS87C,GACTj9C,EAAS4gD,EAA4B,EAATz/C,EAE5B8B,EAAO,2BAAKg5C,GAAR,IAAmB1mB,MAAO,CAAC,EAAGv1B,KAClC+zD,EAAY7Z,GAASj3C,GACrB+wD,EAAe9Z,GAAS,2BAAKj3C,GAAN,IAAYm3C,UAAW,YAC9CyG,EAAU9F,GAAUkB,EAAU7B,WAC9B6Z,EAAalZ,GAAU,UAEvB6Y,EAAqB5wD,yBAAe8wD,EAAK,sBACzC/J,EAAsB/mD,yBAAe8wD,EAAK,uBAC1C9J,EAAiBhnD,yBAAe8wD,EAAK,kBAGrC9S,EAAM,SAACnjB,GAAD,OAAe79B,EAAS+zD,EAAUl2B,GAAK18B,GAI7C+yD,EAAS,SAACr2B,GAAD,OAAe79B,EAASg0D,EAAan2B,GAAK18B,GACnDgzD,EAAc,SAACt2B,GAAD,OAAeq2B,EAAOD,GAAcC,EAAOr2B,IAEzD6yB,EAA0C,CAC9CxjD,EAAG2D,EAAMjE,QAAQK,MAAMC,EAAET,KACzBW,EAAGyD,EAAMjE,QAAQK,MAAMG,EAAEX,KACzBa,EAAGuD,EAAMjE,QAAQK,MAAMK,EAAEb,KACzBe,EAAGqD,EAAMjE,QAAQK,MAAMO,EAAEf,KACzBy/B,MAAO,YACPkoB,UAAW,SACXC,SAAU,OACVC,SAAU,MACVC,KAAM,MACNC,OAAQ,OACR5+C,IAAK,aAKPsjC,EAAIz5B,UAAYixC,EAAaxkB,MAzD7B,MAmCkBrO,EAnClB,eA0DsBzX,EAASnkB,UA1D/B,IA0DA,2BAAyC,KAA9Bgf,EAA8B,UACbk7B,wBAAcl7B,EAAShkB,EAAQb,GADlB,mBAChCggD,EADgC,KAEjCC,EAFiC,KAEnBD,EAAS,GACvBnP,EAAQhsB,EAAQvhB,IAAI,SAC1Bw5C,EAAIoD,SAASF,EAAQ4E,EAAI/T,GAAQoP,GA3BjBxe,EA2B6BoP,EA3Bf+T,EAAIH,GAAWG,EAAInjB,MAnCnD,8BAgEAqb,EAAIz5B,UAAY,OAChBy5B,EAAIgJ,YACJhJ,EAAIkI,OAAO,EAAG,GACdlI,EAAIiI,OAAO,EAAGplD,GACdm9C,EAAIlzB,SApEJ,qBAyEsBI,EAASnkB,UAzE/B,yBAyEWgf,EAzEX,UA0E4Bk7B,wBAAcl7B,EAAShkB,EAAQb,GA1E3D,mBA0ESggD,EA1ET,KA0EiBkF,EA1EjB,KA8EQpU,EAAUjsB,EAAQvhB,IAAI,WAKtB28C,EAAI1/C,KAAKuB,IAAIojD,EAAUlF,EAAS,GAAK,GACrCqY,EAAavnB,EAAQhB,MAE3B5oC,OAAOhD,QAAQ4sC,EAAQK,KACpBslB,MAAK,cAAc,IAAZ3xD,EAAY,oBAAPqzB,EAAO,oBAClB,OAAIrzB,EAAIqzB,GACE,EAENrzB,EAAIqzB,EACC,EAEF,KAERL,QAAO,SAACE,EAAD,GAA6B,uBAArBqb,EAAqB,KAAbvD,EAAa,KAAbA,MAMtB,OALAgN,EAAIz5B,UACFixC,EAAajhB,IACbkY,EAAmBlY,EAAKilB,QAAQ,OAAQ,MACxC,MACFxb,EAAIoD,SAASF,EAAQ8X,EAAOhoB,EAAQ9X,GAAOioB,EAAG8X,EAAYjoB,IACnD9X,EAAO8X,IACb,GAEL,IAAMyoB,EAAkBrxD,OAAOhD,QAAQ4sC,EAAQO,QAe/C,GAbIsc,GACF4K,EAAgBzgC,QAAO,SAACE,EAAD,GAA6B,uBAArBqb,EAAqB,KAAbvD,EAAa,KAAbA,MAQrC,OAPAgN,EAAIz5B,UAAYixC,EAAajhB,GAC7ByJ,EAAIoD,SACFF,EAAS,GALS,IAMA+X,EAAY//B,GAC9B,IACA+/B,EAAYjoB,IAEP9X,EAAO8X,IACb,GAGD8d,EAAgB,CAClB,IAAI4K,EAAQ,EACR12D,EAAM,EACN22D,EAAU,GACdF,EAAgB33D,SAAQ,YAAuB,uBAArByyC,EAAqB,KAAbvD,EAAa,KAAbA,MAChC0oB,GAAS1oB,EACLA,EAAQhuC,IACVA,EAAMguC,EACN2oB,EAAUplB,MAMVmlB,EAAQH,EAAab,GAAsBa,EAAa,IAC1Dvb,EAAIz5B,UAAYixC,EAAamE,GAC7B3b,EAAIgJ,YACJhJ,EAAIiI,OAAO/E,EAAS,EAAG,GACvBlD,EAAIkI,OAAOhF,EAAS,EAAG,GACvBlD,EAAIkI,OAAOhF,EAjCS,KAkCpBlD,EAAIvnC,UAnEV,2BAAyC,IAzEzC,8BAiJIkqC,IACF3C,EAAI8I,UAAY,EAChB9I,EAAI15B,YAAc,wBAClBvd,EAAOjF,SAAQ,SAAAilD,GACb/I,EAAIgJ,YACJhJ,EAAIiI,OAAO,EAAGxkD,KAAK66C,MAAMwJ,EAAIiB,KAC7B/I,EAAIkI,OAAOrlD,EAAOY,KAAK66C,MAAMwJ,EAAIiB,KACjC/I,EAAIlzB,iB,GA9JqCyzB,ICtBpCp3B,GAAeH,8BAAoB,sBAAD,GAG7C,CAAEK,kBAAF,GAAmCC,iBAAiB,ICEzCsyC,GAAb,4MACEnxD,KAAO,6BADT,+FAGE,WACEgc,GADF,mBAAAze,EAAA,yDAGUyoB,EAAcpqB,KAAKsX,cAAnB8S,UACFsT,EAJR,OAI0BtT,QAJ1B,IAI0BA,GAJ1B,UAI0BA,EAAWhV,eAJrC,aAI0B,EAAoBsoB,gBAJ9C,sBAMU,IAAIl8B,MAAM,iCANpB,gCASS8xC,gCAAsB5V,EAAiBtd,IAThD,gDAHF,mHAeE,WACEA,EAQAuyB,GATF,+BAAAhxC,EAAA,sEAWiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAbJ,cAWQE,EAXR,OAeUtuB,EAA2CsuB,EAA3CtuB,cAAeF,EAA4BwuB,EAA5BxuB,UAAW2C,EAAiB6rB,EAAjB7rB,QAASmgC,EAAQtU,EAARsU,IAf7C,SAiBUrV,EAAW9xC,KAAKsX,cAAe+M,EAAWE,GAjBpD,cAgBQ0oB,EAhBR,OAkBIA,YAEIpmB,EAAWomB,EAAYuoB,6BAA6BxuC,GApB5D,UAqB8BH,EAAShiB,KAAKspC,eAAWC,YArBvD,eAqBQqnB,EArBR,OAsBQC,EAAe,IAAI5yD,IACzB2yD,EAAch4D,SAAQ,SAAAikB,GACpB,IAAMmvC,EAAOnvC,EAAQvhB,IAAI,QACnB4d,EAAM8yC,EAAOA,EAAK1J,GAAOzlC,EAAQvhB,IAAIgnD,QAC/B/mD,IAAR2d,GACF23C,EAAa3yD,IAAb,UAAoBgb,OA3B1B,8BA8Ba23C,IA9Bb,iDAfF,8DAAgDvkB,GAiDnCwkB,GAAb,4MACEvxD,KAAO,gCADT,+FAGE,WACEgc,GADF,mBAAAze,EAAA,yDAGUyoB,EAAcpqB,KAAKsX,cAAnB8S,UACFsT,EAJR,OAI0BtT,QAJ1B,IAI0BA,GAJ1B,UAI0BA,EAAWhV,eAJrC,aAI0B,EAAoBsoB,gBAJ9C,sBAMU,IAAIl8B,MAAM,iCANpB,gCASS8xC,gCAAsB5V,EAAiBtd,IAThD,gDAHF,mHAeE,WACEA,EAQAuyB,GATF,6BAAAhxC,EAAA,sEAWiC3B,KAAK4yC,qBAClCxyB,EACAuyB,GAbJ,cAWQE,EAXR,OAeUtuB,EAAsCsuB,EAAtCtuB,cAAeF,EAAuBwuB,EAAvBxuB,UAAW2C,EAAY6rB,EAAZ7rB,QAfpC,SAiBU8qB,EAAW9xC,KAAKsX,cAAe+M,EAAWE,GAjBpD,cAgBQ0oB,EAhBR,OAkBIA,YAEIpmB,EAAWomB,EAAYuoB,6BAA6BxuC,GApB5D,UAqB8BH,EAAShiB,KAAKspC,eAAWC,YArBvD,eAqBQqnB,EArBR,OAsBQC,EAAe,IAAI5yD,IACzB2yD,EAAch4D,SAAQ,SAAAikB,GACpB,IAAM3D,EAAOkxB,aAAUvtB,EAAS,KAAM,OAAoB,QAC9CthB,IAAR2d,GACF63C,gCAAqB73C,GAAKtgB,SAAQ,SAAAk3C,GAAC,OAAI+gB,EAAa3yD,IAAI4xC,SA1B9D,8BA6Ba+gB,IA7Bb,iDAfF,8DAAmDvkB,GCT9B0kB,G,4MACnBzxD,KAAO,mB,6CAEP,SAAQkT,GACNA,EAAcmR,cAAa,WACzB,IAAM3F,EAAeH,8BACnB,kBACA,GACA,CAAEK,kBAAmB0F,iCAAsBpR,KAEvCvP,EAAQ,IAAI4gB,IAAU,CAC1BvkB,KAAM,kBACN0e,eACAI,WAAY0F,gCACVtR,EACA,kBACAwL,KAGEgzC,EAA0Bx+C,EAAcwuB,eAC5C,2BAMF,OADA/9B,EAAM8gB,eAAeitC,GACd/tD,KAETuP,EAAcuR,gBAAe,WAC3B,IAAM/F,EAAeizC,GAAuCz+C,GAC5D,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,sBACN0e,eACAI,WAAY8yC,GACV1+C,EACAwL,GAEFe,UAAW,kBACXxE,SAAU,mBACVhI,eAAgB4R,UAGpB3R,EAAcuR,gBAAe,WAC3B,IAAM/F,ECzFG,SAAkCxL,GAC/C,IAAM2+C,EAAkC3+C,EAAc0uB,gBACpD,uBACAljB,aAEF,OAAOH,8BACL,2BACA,CACEk8B,UAAW,CACTr0C,KAAM,aACNgd,aAAc,QACdprB,MAAOmJ,QAAMwiB,YAAY,iBAAkB,CAAC,UAC5Ctb,YACE,4EAEJivC,SAAU,CACRlxC,KAAM,SACNgd,aAAc0Q,OAAO0jB,UACrBnvC,YAAa,iCAEfkvC,SAAU,CACRnxC,KAAM,SACNiC,YAAa,gCACb+a,aAAc0Q,OAAOC,WAEvB0iB,UAAW,CACTrwC,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,aAAc,CAAC,SAAU,QAClDtb,YAAa,2BACb+a,aAAc,UAEhBuzB,SAAU,CACRvwC,KAAM,UACNiC,YAAa,mBACb+a,cAAc,GAEhByQ,oBAAqB,CACnBztB,KAAM,SACNiC,YAAa,gDACb+a,aAAc,KAEhB24B,SAAU,CACR31C,KAAM,SACNiC,YACE,6DACF+a,aAAc,GAGhBw8B,UAAWrhC,8BAAoB,yBAA0B,CACvD2xC,oBAAqB2B,KAGzB,CAAEjzC,kBAAmBgV,KAA+B/U,iBAAiB,IDqC9CizC,CACnB5+C,GAEF,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,2BACN0e,eACAI,WAAYizC,GACV7+C,EACAwL,GAEFe,UAAW,kBACXxE,SAAU,mBACVhI,eAAgBisC,QAGpBhsC,EAAcuR,gBAAe,WAC3B,IAAM/F,EAAeszC,GACnB9+C,GAEF,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,0BACN0e,eACAI,WAAYmzC,GACV/+C,EACAwL,GAEFe,UAAW,kBACXxE,SAAU,mBACVhI,eAAgBi/C,QAGpBh/C,EAAc4R,eACZ,kBACE,IAAIC,IAAW,CACb/kB,KAAM,0BACNglB,QAAS,kBACTtG,aAAcyzC,GACdrzC,WAAYszC,GAAyCl/C,GACrDD,eAAgBkS,gBACd,kBAAM,wCAIdjS,EAAc2Q,gBACZ,kBACE,IAAIC,IAAJ,aACE9jB,KAAM,cACHkT,EAAcoM,KAAK+yC,SAG5Bn/C,EAAc2Q,gBACZ,kBACE,IAAIC,IAAJ,aACE9jB,KAAM,sBACHkT,EAAcoM,KAAKgzC,SAG5Bp/C,EAAc2Q,gBACZ,kBACE,IAAIC,IAAJ,aACE9jB,KAAM,eACHkT,EAAcoM,KAAKizC,SAG5Br/C,EAAc2Q,gBACZ,kBACE,IAAIC,IAAJ,aACE9jB,KAAM,oBACHkT,EAAcoM,KAAKkzC,SAG5Bt/C,EAAciR,iBACZ,kBACE,IAAIw+B,GAAe,CACjB3iD,KAAM,iBACNiT,eAAgBw/C,GAChB/zC,aAAcg0C,GACdx/C,qBAGNA,EAAciR,iBACZ,kBACE,IAAI+rC,GAAoB,CACtBlwD,KAAM,sBACNiT,eAAgB0/C,GAChBj0C,aAAcmzC,GACd3+C,qBAINA,EAAc08B,cACZ,kBAAM,IAAIuhB,GAA2Bj+C,MAEvCA,EAAc08B,cACZ,kBAAM,IAAI2hB,GAA8Br+C,U,GAzIAkS,KEjD/B7G,iCACb,gBACA,CACE3X,eAAgB,CACdR,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,oBAGzB,CAAE6b,iBAAiB,ICPNN,iCACb,kBACA,CACE5X,cAAe,CACbP,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,uBAGvBuC,MAAOgZ,8BAAoB,aAAc,CACvCjY,UAAW,CACTtO,MAAOmJ,QAAMwiB,YAAY,YAAa,CAAC,MAAO,QAC9Cvd,KAAM,aACNgd,aAAc,OAEhBne,SAAU,CACRmB,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,6BAIzB4vD,YAAa,CACXxsD,KAAM,cACNiC,YAAa,uBACb+a,aAAc,IAGhByvC,YAAa,CACXzsD,KAAM,SACNiC,YAAa,2CACb+a,aAAc,IAGhB0vC,QAAS,CACP1sD,KAAM,SACNiC,YAAa,yDACb+a,aAAc,KAGlB,CAAEvE,iBAAiB,ICnCAk0C,G,4MACnB/yD,KAAO,Y,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,gBACN0e,aAAcs0C,GACdhvC,gBAAiB,kBACf,sDAAwCC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,iBAG5DuC,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,kBACN0e,aAAcu0C,GACdjvC,gBAAiB,kBACf,2EAA4CC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,qB,GAnB7ByU,KCFjC1G,GAAeH,8BAAoB,6BAAzC,IAEMO,GAAa,2CACoB,CACnC5iB,GADmC,YAEnCkK,KAAMjF,gBAF6B,8BAGnCqf,YAAarf,mBAJE,SAMR,SAAAoB,GAAI,MAAK,CAChBkhB,eADgB,YAEdlhB,iBAEFmhB,iBAJgB,WAKdnhB,0B,gCCNN,SAAS2wD,KAA4D,QAA/CC,EAA+C,uDAArC,GAAIC,EAAiC,uDAAvB,GACtCC,EAAMF,EAAGzsC,QAAO,SAAA7nB,GAAK,OAAIu0D,EAAGtsC,SAASjoB,MADwB,mBAAhB0E,EAAgB,iCAAhBA,EAAgB,kBAEnE,OAAoB,IAAhBA,EAAKpI,OACAk4D,EAGFH,GAAS,WAAT,GAAUG,GAAV,OAAkB9vD,IAcZ,SAASigB,GAAkBtQ,GAAoB,IACpDoL,EAAcpL,EAAdoL,UADoD,EAQxDA,EAAU,mBALLg1C,EAHmD,EAG1DnyD,MACA6C,EAJ0D,EAI1DA,UACAuvD,EAL0D,EAK1DA,SACAh3B,EAN0D,EAM1DA,YACAi3B,EAP0D,EAO1DA,QAEMC,EAAkBn1C,EACxB,8CADMm1C,cAMFz7D,EAASs7D,EACZt7D,MAAM,sBAAuB,CAC5BoO,KAAMjF,QAAMye,QAAQ,uBACpB8zC,aAAc,EACdr3D,OAAQ8E,QAAMC,SACZD,QAAM84B,WACJ,aACA94B,QAAMW,QACN,SAACo4B,GAAD,OAAeA,GAVL,MACI,KAalBy5B,kBAAmB,eACnBC,oBAAoB,EACpBC,WAAW,EACXC,iBAAiB,EACjBj5C,MAAO1Z,QAAM6oB,MACX9W,EAAc0wB,YAAY,oBACvB9kB,cAGNyY,UAAS,iBAAO,CACfn/B,MAAO,QAERyiB,OAAM,SAAAtY,GAAI,MAAK,CAEd,oBACE,OAAO2wD,GAAS,WAAT,cAEF3wD,EAAKsY,MAAMla,KAAI,SAAAgY,GAAI,OACpBA,EAAKwoB,OAAOxgC,KAAI,SAAA4vC,GAAC,OAAIA,EAAE1sC,cAAc0E,iBAK3C,gBACE,IAAMqL,EAAwB,GAS9B,OARArR,EAAKsY,MAAMxhB,SAAQ,SAACsf,EAAMo7C,GACpBp7C,EAAK/E,WACPA,EAAU9Y,KAAK,CACbguB,MAAO,QAAF,OAAUirC,EAAM,EAAhB,SACLr0B,QAAS/mB,EAAK/E,eAIbA,GAGT,wBACE,OA3E2B,GA+E7BogD,iBA7Bc,SA6BGC,GACf,OAAO1xD,EAAKsY,MACTla,KAAI,SAAAgY,GAAI,OAAIA,EAAKu7C,SAASD,MAC1BvtC,QAAO,SAAA9nB,GAAC,QAAMA,MAInBu1D,eApCc,SAoCCF,GACb,OAAOr4D,KAAKw4D,iBAAiBH,GAAexhC,MAC1C,SAAA7zB,GAAC,OAAqB,GAAjBA,EAAE7C,IAAI,aAMfs4D,kBA5Cc,SA4CIJ,GAChB,OAAOr4D,KAAKw4D,iBAAiBH,GAAexhC,MAC1C,SAAA7zB,GAAC,MAAsB,kBAAlBA,EAAE7C,IAAI,YAMfq4D,iBApDc,SAoDGH,GACf,IAAM9yB,EAASvlC,KAAKo4D,iBAAiBC,GACrC,OAAO,IAAI71D,MACR+iC,GAAU,IAAIxgC,KAAI,SAAA4vC,GAAC,OAAIA,EAAExO,SAAS,GAAGtf,cAK1C6xC,gCA5Dc,SA4DkB/rD,GAC9B,IAD+C,EACzCka,EAAW7mB,KAAKw4D,iBAAiB7rD,GACjCwnB,EAAqB,GACrBwkC,EAAc,IAAI71D,IAHuB,eAK/B+jB,EAASnkB,UALsB,IAK/C,2BAAmC,KAAxBM,EAAwB,QAC5B21D,EAAYh2D,IAAIK,EAAE1C,OACG,UAApB0C,EAAE7C,IAAI,OAAO,IACfg0B,EAAMj1B,KAAK,CAAC8D,IAGhB21D,EAAY51D,IAAIC,EAAE1C,OAX2B,8BAc/C,OAAO6zB,GAKTykC,2BA/Ec,SA+EajsD,GACzB,IAD0C,EACpCka,EAAW7mB,KAAKw4D,iBAAiB7rD,GACjCksD,EAAwC,GACxCF,EAAc,IAAI71D,IAHkB,eAK1B+jB,EAASnkB,UALiB,yBAK/BM,EAL+B,QAMnC21D,EAAYh2D,IAAIK,EAAE1C,OACC,aAAlB0C,EAAE7C,IAAI,SACR6C,EAAE7C,IAAI,OAAO1C,SAAQ,SAACkE,GACpB,IAAMm3D,EAAM,GAAH,OAAM91D,EAAE7C,IAAI,WAAZ,YAA0B6C,EAAE7C,IAAI,SAAW,GACpD,GAAI44D,KAASp3D,GAAI,CACf,IAAMq3D,EAAMr3D,EACPk3D,EAAWC,GAGdD,EAAWC,GAAK55D,KAAK8D,GAFrB61D,EAAWG,EAAIC,cAAgB,CAACj2D,OAQ1C21D,EAAY51D,IAAIC,EAAE1C,OAhBpB,2BAAmC,IALO,8BAwB1C,OAAOyD,OAAOrB,OAAOm2D,GAAY/tC,QAAO,SAAAqL,GAAC,OAAIA,EAAE52B,OAAS,MAK1D25D,4BA5Gc,SA4GcvsD,GAC1B,IAD2C,EACrCka,EAAW7mB,KAAKw4D,iBAAiB7rD,GACjCksD,EAAwC,GACxCF,EAAc,IAAI71D,IAHmB,eAMrB+jB,EAASnkB,UANY,IAM3C,2BAAyC,KAA9Bgf,EAA8B,QACjCphB,EAAKohB,EAAQphB,KACb64D,EAAkC,EAAvBz3C,EAAQvhB,IAAI,SAC7B,IAAKw4D,EAAYh2D,IAAIrC,KAAQ64D,EAAU,CACrC,IAAM76B,EAAI5c,EAAQvhB,IAAI,QACjB04D,EAAWv6B,KACdu6B,EAAWv6B,GAAK,IAElBu6B,EAAWv6B,GAAGp/B,KAAKwiB,GAErBi3C,EAAY51D,IAAI2e,EAAQphB,OAhBiB,8BAmB3C,OAAOyD,OAAOrB,OAAOm2D,GAAY/tC,QAAO,SAAAqL,GAAC,OAAIA,EAAE52B,OAAS,MAK1D65D,yBApIc,SAoIWzsD,GACvB,IADwC,EAClCka,EAAW7mB,KAAKw4D,iBAAiB7rD,GACjCksD,EAAwC,GACxCF,EAAc,IAAI71D,IAHgB,eAMlB+jB,EAASnkB,UANS,IAMxC,2BAAyC,KAA9Bgf,EAA8B,QACjC+tC,EAAQ/tC,EAAQvhB,IAAI,SACpBG,EAAKohB,EAAQphB,KACb64D,EAAmB,EAAR1J,EACX4J,EAA0B,EAAR5J,EAExB,IAAKkJ,EAAYh2D,IAAIrC,KAAQ+4D,IAAoBF,EAAU,CACzD,IAAM76B,EAAI5c,EAAQvhB,IAAI,QACjB04D,EAAWv6B,KACdu6B,EAAWv6B,GAAK,IAElBu6B,EAAWv6B,GAAGp/B,KAAKwiB,GAErBi3C,EAAY51D,IAAI2e,EAAQphB,OAnBc,8BAsBxC,OAAOyD,OAAOrB,OAAOm2D,GAAY/tC,QAAO,SAAAqL,GAAC,OAAIA,EAAE52B,OAAS,MAG1D+5D,2BA7Jc,SA6JajB,EAAuBxxC,GAEhD,IAAM0e,EAASvlC,KAAKo4D,iBAAiBC,GAE/BkB,EAAO,SAACxxD,EAAYsmC,GAAb,OACXtmC,EAAMo+B,SAAS,GAAG3G,eAAer/B,IAAIkuC,EAAK/tC,OAE5C,OAAOumB,EAAS9hB,KAAI,SAAAogC,GAAC,OACnBA,EAAEpgC,KAAI,SAAA2c,GACJ,IAAMnG,EAAQgqB,EAAOqC,WAAU,SAAA7/B,GAAK,OAAIwxD,EAAKxxD,EAAO2Z,MAC9C7gB,EAAS04D,EAAKh0B,EAAOhqB,GAAQmG,GACnC,MAAO,CACLA,UACA7gB,SACA0a,oBAMT7U,SAAQ,SAAAC,GAAI,MAAK,CAChBk1B,YADgB,WACF,WACZ8E,EACEh6B,EACAgxD,EACEhxD,GACA,YAQM,IAPJvC,EAOI,EAPJA,KACA8kC,EAMI,EANJA,KACA9oB,EAKI,EALJA,KAMA,GAAIzZ,EAAKsxD,UAAW,CACF,CACd,mBACA,SACA,iBACA,YACA,cACA,YACA,iBACA,oBAEU/sC,SAAS9mB,IAAS8kC,GAC5B,EAAKswB,gBAAgBp1D,EAAM8kC,EAAM9oB,SAQ7Co5C,gBAnCgB,SAmCAC,EAAoBvwB,EAAc9oB,GAChDzZ,EAAKsY,MAAMxhB,SAAQ,SAAAsf,GACjB,IAAMuoB,EAAMsyB,EAAQ76C,GAChBuoB,EAAIo0B,YAAYxwB,KAAU5D,EAAI/lC,OAAS2pC,EAAK3pC,QAE9Cwd,EAAK08C,GAAYr5C,EAAK,QAK5BxG,SA7CgB,SA6CP+/C,GACPhzD,EAAKnK,MAAQm9D,EACbhzD,EAAKsY,MAAMxhB,SAAQ,SAAA04B,GAAC,OAAIA,EAAEvc,SAAS+/C,OAGrCC,WAlDgB,SAkDL78C,GACTpW,EAAKsY,MAAMsoB,OAAOxqB,IAGpB88C,UAtDgB,WAuDdzxD,EAAUzB,EAAM,GAAGizD,WAAWjzD,IAGhCmzD,gBA1DgB,SA0DAr5D,GACdkG,EAAKmxD,aAAer3D,GAGtBs5D,eA9DgB,WA+DdpzD,EAAKuxD,iBAAmBvxD,EAAKuxD,iBAE/B8B,qBAjEgB,WAkEdrzD,EAAKqxD,oBAAsBrxD,EAAKqxD,oBAElCiC,gBApEgB,WAqEdtzD,EAAKsxD,WAAatxD,EAAKsxD,eAS7B,MAAO,CAAE/0C,WALWw0C,EAAiC5wD,QACnD+wD,EACAz7D,I,4BC5TsB,CAAC,EAAG,EAAG,EAAG,GAA3B89D,G,MAAOC,G,MAcT,SAASC,GACdr9C,EACAlf,EACA2/C,GAEA,QAASzgC,EAAKs9C,OAAO,CAAEx8D,UAAS2/C,WAAY,IAAI7gD,UAAY,GAAKogB,EAAKpgB,SAIjE,SAAS29D,GACdjC,EACA98C,EACA0D,EACAsmB,EAUAJ,GAEA,IArCeo1B,EAqCT5iD,EAAU4tB,EAAOhqB,GAAO4qB,SAAS,GAEjCxnC,EAAMgZ,EAAQlX,OAChBmB,EAAS,EACLyjD,EAAqC1tC,EAArC0tC,aAAcF,EAAuBxtC,EAAvBwtC,mBAItB,OAHIA,GAAsBE,IACxBzjD,EAASujD,EAAmB1kD,OAAS,GAGrC+5D,gBAAMr1B,EAAE+0B,IAAOviD,EAAQinB,YA9CV27B,EA8C8Bp1B,GA7ChCg1B,IAAUI,EAAML,KA6CqB,EAAIt4D,EAR1C,EAQuDjD,GA3CrE,SACEsgB,EACAo5C,EACA98C,GAEA,IAAMxT,EAAQkX,EAAM1D,GAAOk/C,UAAUpC,GACrC,OAAY,OAALtwD,QAAK,IAALA,OAAA,EAAAA,EAAOoyB,wBAAwBllB,MAAO,EAsC3CylD,CAAwBz7C,EAAOo5C,EAAe98C,GAC9C5D,EAAQinB,UAQL,IAAM+7B,GAAe,SAACC,GAAsB,MACnBtnD,qBAArBunD,EADwC,oBAEjDjnD,qBAAU,WACRinD,EAAkBD,KACjB,CAACA,K,GC5DkB,CAAC,EAAG,EAAG,EAAG,GAA3B5c,G,MAAQC,G,MA6IA6c,GA3Icp2D,qBAC3B,YAQM,IAPJtI,EAOI,EAPJA,MACAi8D,EAMI,EANJA,cACA0C,EAKI,EALJA,UAMQ97C,EAA8B7iB,EAA9B6iB,MAAO+4C,EAAuB57D,EAAvB47D,mBACPt6B,EAAoBxZ,qBAAW9nB,GAA/BshC,gBAEFtoB,EAAU8O,qBAAW9nB,GACrBsL,EAAOsiB,sBAAY5tB,GACzBu+D,GAAajzD,GACb,IAAMszD,EAAWt9B,EAAgBv9B,IAAI8e,EAAM,GAAGpB,cAAc,IAC5D,IAAKm9C,EACH,OAAO,KAGT,IAAMC,EAAgB7+D,EAAMo8D,iBAAiBH,GACvCxxC,EAAWzqB,EAAMm8D,eAAeF,GAClCj8D,EAAMg9D,yBAAyBf,GAC/Bj8D,EAAM88D,4BAA4Bb,GAChC6C,EAAgB9+D,EAAMk9D,2BAC1BjB,EACAxxC,GAEFq0C,EAAcz9D,SAAQ,SAAAoyD,GACpBA,EAAEyD,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAE+f,QAAQvhB,IAAI,WAAa60B,EAAEtT,QAAQvhB,IAAI,iBArBxD,MAuBoCmT,qBAvBpC,mBAuBG6nD,EAvBH,KAuBiBC,EAvBjB,KAyBAC,EAAU,EACd,GAAIN,EAAU9mD,QAAS,CACrB,IAAMimB,EAAO6gC,EAAU9mD,QAAQkmB,wBAC/BkhC,EAAUnhC,EAAKjlB,IAEjB,OACE,uBACEwR,OAAO,OACPrU,KAAK,OACLmE,cACE2kD,EAAc37D,OAAd,UAA0B84D,EAA1B,WAAmDA,GAGpD6C,EAAcn2D,KAAI,SAAAw1D,GAIjB,IAHA,IAAMj1B,EAAM,GADc,WAIjBtS,GAJiB,MAK2BunC,EAAMvnC,GAAzCsoC,EALQ,EAKhBz6D,OAAqB06D,EALL,EAKJ75C,QAAoB85C,EALhB,EAKSjgD,MALT,EAM2Bg/C,EAAMvnC,EAAI,GAA7CyoC,EANQ,EAMhB56D,OAAqB66D,EANL,EAMJh6C,QAAoBi6C,EANhB,EAMSpgD,MAEjC,IAAK+/C,IAAOG,EAEV,OADA3+B,QAAQU,KAAK,8CACb,GAAO,MAIT,IAAKw6B,GAAsBwD,IAAWG,EACpC,SAAO,MAET,IAAMC,EAAYL,EAAGp7D,IAAI,WACnB07D,EAAYH,EAAGv7D,IAAI,WACnB27D,EAAQd,EAASe,oBAAoBH,GACrCI,EAAQhB,EAASe,oBAAoBF,GAE3C,IAAKC,IAAUE,EACb,MAAM,IAAIx6D,MAAJ,iCAAoCs6D,GAASE,IAErD,IAAMC,EAAK7B,GACTn7C,EAAMu8C,GACNM,EACAR,GAAyB,IAAtBC,EAAGp7D,IAAI,UAAmB69C,GAAOC,KAEhCie,EAAK9B,GACTn7C,EAAM08C,GACNK,EACAP,GAAyB,IAAtBC,EAAGv7D,IAAI,UAAmB89C,GAAQD,KAEjCme,EAAYl9C,EAAMu8C,GAAQY,OAAOH,GAAI/9D,SACrCm+D,EAAYp9C,EAAM08C,GAAQS,OAAOF,GAAIh+D,SAErCqnC,EAAStmB,EAAMla,KAAI,SAAAoxB,GAAC,OAAIA,EAAEmiC,SAASD,MAEnCiE,EAAKhC,GAAKjC,EAAemD,EAAQv8C,EAAOsmB,EAAQ+1B,GAAMD,EACtDkB,EAAKjC,GAAKjC,EAAesD,EAAQ18C,EAAOsmB,EAAQk2B,GAAMJ,EAItDnyB,EAAOszB,OACV5a,OAAOqa,EAAIK,GACXG,QACCR,EAAK,IAAMV,EAAGp7D,IAAI,WAAag8D,GAAa,EAAI,GAChDG,EACAJ,EAAK,IAAMR,EAAGv7D,IAAI,WAAak8D,GAAa,EAAI,GAChDE,EACAL,EACAK,GAEDt+D,MACGqC,EAAK,GAAH,OAAMi7D,EAAGj7D,KAAT,YAAiBo7D,EAAGp7D,MAC5BglC,EAAIpmC,KACF,0BACEmT,EAAG62B,EACHlqC,IAAKsB,EACLiW,cAAY,KACZmmD,YAAavB,IAAiB76D,EAAK,EAAI,EACvC6W,QAAS,WAAM,QACPuN,EAAa,UAAGtP,EAAQuP,iBAAX,aAAG,OAAAvP,EACpB,6BACA,uBACA,CACEwP,YAAa,CACX+3C,UACE1B,EAAc96D,IAAIo7D,EAAGj7D,OAAS,CAAEW,OAAQ,eACxCA,SACF27D,UACE3B,EAAc96D,IAAIu7D,EAAGp7D,OAAS,CAAEW,OAAQ,eACxCA,YAIR,UAAAmU,EAAQ0P,kBAAR,cAAA1P,EAAqBsP,IAEvBiC,YAAa,kBAAMy0C,EAAgB96D,IACnCsmB,WAAY,kBAAMw0C,OAAgBh7D,QA7E/B4yB,EAAI,EAAGA,EAAIunC,EAAMh7D,OAAS,EAAGyzB,GAAK,EAAG,SAArCA,GAAqC,kCAiF9C,OAAOsS,SC3HjB,IA2Heu3B,GA3HGn4D,qBAChB,YAQM,IAPJtI,EAOI,EAPJA,MACAi8D,EAMI,EANJA,cACWhiD,EAKP,EALJ0kD,UAMQ97C,EAAU7iB,EAAV6iB,MACF7J,EAAU8O,qBAAW9nB,GACnBshC,EAAoBtoB,EAApBsoB,gBAEFu9B,EAAgB7+D,EAAMo8D,iBAAiBH,GACvCxxC,EAAWzqB,EAAMw8D,2BAA2BP,GAC5C6C,EAAgB9+D,EAAMk9D,2BAC1BjB,EACAxxC,GATE,EAWoCvT,qBAXpC,mBAWG6nD,EAXH,KAWiBC,EAXjB,KAYE1zD,EAAOsiB,sBAAY5tB,GACzBu+D,GAAajzD,GACb,IAAMszD,EAAWt9B,EAAgBv9B,IAAI8e,EAAM,GAAGpB,cAAc,IAE5D,IAAKm9C,EACH,OAAO,KAGT,IAAI8B,EAAO,EACX,GAAIzmD,EAAIpC,QAAS,CACf,IAAMimB,EAAO7jB,EAAIpC,QAAQkmB,wBACzB2iC,EAAO5iC,EAAKjlB,IAGd,OACE,uBACEwR,OAAO,QACPi2C,YAAa,EACbtqD,KAAK,OACLmE,cACE2kD,EAAc37D,OAAd,UAA0B84D,EAA1B,WAAmDA,GAGpD6C,EAAcn2D,KAAI,SAAAw1D,GAIjB,IAHA,IAAMj1B,EAAM,GADc,WAIjBtS,GAJiB,MAK2BunC,EAAMvnC,GAAzCsoC,EALQ,EAKhBz6D,OAAqB06D,EALL,EAKJ75C,QAAoB85C,EALhB,EAKSjgD,MALT,EAM2Bg/C,EAAMvnC,EAAI,GAA7CyoC,EANQ,EAMhB56D,OAAqB66D,EANL,EAMJh6C,QAAoBi6C,EANhB,EAMSpgD,MAC3Bjb,EAAKi7D,EAAGj7D,KAERy8D,EA7DlB,SAAyBC,EAAgBC,GACvC,IAAMpE,EAAuC,GAI7C,OAHAmE,EAAM78D,IAAI,OAAO1C,SAAQ,SAACu7D,GACxBH,EAAWG,EAAIC,cAAgBD,KAE1BH,EAAW,GAAD,OAAIoE,EAAM98D,IAAI,WAAd,YAA4B88D,EAAM98D,IAAI,SAAW,IAwDpC+8D,CAAgB3B,EAAIG,GACxC,IAAKJ,IAAOG,EACV,SAAO,MAET,IAAMG,EAAYL,EAAGp7D,IAAI,WACnB07D,EAAYH,EAAGv7D,IAAI,WACnB27D,EAAQd,EAASe,oBAAoBH,GACrCI,EAAQhB,EAASe,oBAAoBF,GAC3C,IAAKC,IAAUE,EACb,MAAM,IAAIx6D,MAAJ,iCAAoCs6D,GAASE,IAErD,IAAMC,EAAK7B,GAAoBn7C,EAAMu8C,GAASM,EAAOR,EA1EjD,IA2EEY,EAAK9B,GAAoBn7C,EAAM08C,GAASK,EAAOP,EA3EjD,IA4EEU,EAAYl9C,EAAMu8C,GAAQY,OAAOH,GAAI/9D,SACrCm+D,EAAYp9C,EAAM08C,GAAQS,OAAOF,GAAIh+D,SAErCqnC,EAAStmB,EAAMla,KAAI,SAAAoxB,GAAC,OAAIA,EAAEmiC,SAASD,MACnCiE,EAAKhC,GAAKjC,EAAemD,EAAQv8C,EAAOsmB,EAAQ+1B,GAAMwB,EACtDP,EAAKjC,GAAKjC,EAAesD,EAAQ18C,EAAOsmB,EAAQk2B,GAAMqB,EAC5D,GAAKC,EAIE,CACL,IAAM7zB,EAAOszB,OACV5a,OACCqa,EACE,IACwB,SAArBc,EAAYI,MAAmB,EAAI,IACnChB,GAAa,EAAI,GACtBG,GAEDza,OAAOoa,EAAIK,GACXza,OAAOqa,EAAIK,GACX1a,OACCqa,EACE,IACiC,SAA9Ba,EAAYK,cAA2B,GAAK,IAC5Cf,GAAa,EAAI,GACtBE,GAEDt+D,MACHqnC,EAAIpmC,KACF,0BACEmT,EAAG62B,EACHlqC,IAAKo+B,KAAKE,UAAU4L,GACpBwzB,YAAap8D,IAAO66D,EAAe,GAAK,EACxChkD,QAAS,WAAM,QACPuN,EAAa,UAAGtP,EAAQuP,iBAAX,aAAG,OAAAvP,EACpB,uBACA,iBACA,CACEwP,YAAaq2C,EAAc96D,IAAIG,KAGnC,UAAA8U,EAAQ0P,kBAAR,cAAA1P,EAAqBsP,IAEvBiC,YAAa,kBAAMy0C,EAAgB96D,IACnCsmB,WAAY,kBAAMw0C,OAAgBh7D,YAtCtC08B,QAAQU,KACN,yDA1BGxK,EAAI,EAAGA,EAAIunC,EAAMh7D,OAAS,EAAGyzB,GAAK,EAAG,SAArCA,GAAqC,kCAoE9C,OAAOsS,S,mJCtHX9yB,GAAYC,cAAW,SAACnB,GAAD,MAAiB,CAC5C+rD,UAAW,CACTC,SAAU,kBACV3lD,QAAS,QAEX4lD,WAAY,GACZ5nD,OAAQ,CACNC,SAAU,GAEZ4nD,SAAU,CACRrtD,WAAYmB,EAAMjE,QAAQF,UAAUD,KACpC7Q,QAASiV,EAAMJ,QAAQ,IAEzBusD,QAAS,CACPttD,WAAYmB,EAAMjE,QAAQF,UAAUkP,OAEtCuB,YAAa,CACXzN,WAAYmB,EAAMjE,QAAQF,UAAUD,KACpCuD,WAAY,EACZM,YAAaO,EAAMJ,QAAQ,GAC3BiL,aAAc7K,EAAMJ,QAAQ,IAE9B2H,UAAW,CACT/I,MAAOwB,EAAMjE,QAAQF,UAAUkD,cAEjC2I,UAAW,CACT,UAAW,CACThJ,gBAAiBsB,EAAMjE,QAAQF,UAAUkP,QAG7CpD,aAAc,CACZqD,YAAahL,EAAMjE,QAAQJ,QAAQC,KACnC8C,gBAAiBsB,EAAMjE,QAAQF,UAAUkP,WAIvCqhD,GAAwBh5D,qBAC5B,YAA+C,IAA5CtI,EAA4C,EAA5CA,MACKuX,EAAUnB,KAChB,OACE,kBAAC,KAAD,CACE2E,QAAS,kBAAM/a,EAAM29D,kBACrB9mD,UAAWU,EAAQ4pD,WACnB7/C,MAAM,uCAELthB,EAAM87D,gBAAkB,kBAAC,KAAD,MAAwB,kBAAC,KAAD,UAMnDyF,GAAYj5D,qBAAS,YAA+C,IAA5CtI,EAA4C,EAA5CA,MACtBuX,EAAUnB,KAChB,OACE,kBAAC,KAAD,CACE2E,QAAS,kBAAM/a,EAAM69D,mBACrBhnD,UAAWU,EAAQ4pD,WACnB7/C,MAAM,mDAELthB,EAAM67D,UACL,kBAAC,KAAD,CAAUnoD,MAAM,cAEhB,kBAAC,KAAD,CAAaA,MAAM,kBAMrB8tD,GAAOl5D,qBAAS,YAA+C,IAA5CtI,EAA4C,EAA5CA,MACjBuX,EAAUnB,KAChB,OACE,kBAAC,KAAD,CACE2E,QAAS/a,EAAM49D,qBACf/mD,UAAWU,EAAQ4pD,WACnB7/C,MAAM,oCAELthB,EAAM47D,mBACL,kBAAC,KAAD,CAASloD,MAAM,cAEf,kBAAC,KAAD,CAAYA,MAAM,kBAMpB+tD,GAASn5D,qBACb,YAMM,IALJtI,EAKI,EALJA,MACAiS,EAII,EAJJA,KAKMsF,EAAUnB,KAGhB,OADApW,EAAM09D,gBAAgBzrD,EAAK5N,QAEzB,yBAAKwS,UAAWU,EAAQ0pD,WACtB,kBAACM,GAAD,CAAWvhE,MAAOA,IAClB,kBAACshE,GAAD,CAAuBthE,MAAOA,IAC9B,kBAACwhE,GAAD,CAAMxhE,MAAOA,IAEb,yBAAK6W,UAAWU,EAAQgC,aAMjBmoD,uBAAS,CAAEC,eAAe,GAA1BD,CAAkCD,ICiBlCG,GAnIQt5D,qBACrB,YAQM,IAPJtI,EAOI,EAPJA,MACAi8D,EAMI,EANJA,cACWhiD,EAKP,EALJ0kD,UAMQ97C,EAAU7iB,EAAV6iB,MACF7J,EAAU8O,qBAAW9nB,GACrByqB,EAAWzqB,EAAMs8D,gCAAgCL,GACjD4C,EAAgB7+D,EAAMo8D,iBAAiBH,GACvC6C,EAAgB9+D,EAAMk9D,2BAC1BjB,EACAxxC,GAPE,EASoCvT,qBATpC,mBASG6nD,EATH,KASiBC,EATjB,KAUE1zD,EAAOsiB,sBAAY5tB,GAIzB,GAHAu+D,GAAajzD,IACe0N,EAApBsoB,gBACyBv9B,IAAI8e,EAAM,GAAGpB,cAAc,IAE1D,OAAO,KAGT,IAAIw9C,EAAU,EACd,GAAIhlD,EAAIpC,QAAS,CACf,IAAMimB,EAAO7jB,EAAIpC,QAAQkmB,wBACzBkhC,EAAUnhC,EAAKjlB,IAOjB,OAAIgK,EAAM1f,OAAS,EACV,KAGP,uBACE6S,KAAK,OACLqU,OAAO,QACPi2C,YAAa,EACbnmD,cACE2kD,EAAc37D,OAAd,UAA0B84D,EAA1B,WAAmDA,GAGpD6C,EAAcn2D,KAAI,SAAAw1D,GAIjB,IADA,IAAMj1B,EAAM,GAHc,WAIjBtS,GAJiB,MAK2BunC,EAAMvnC,GAAzCsoC,EALQ,EAKhBz6D,OAAqB06D,EALL,EAKJ75C,QAAoB85C,EALhB,EAKSjgD,MAC3BogD,EAAoB,IAAXH,EAAe,EAAI,EAC5Bl7D,EAAKi7D,EAAGj7D,KACd,IAAKg7D,EACH,SAAO,MAGT,IAAMhR,EAAOiR,EAAGp7D,IAAI,QACd2lB,EAAOwkC,EAAK2T,KAAK,GACjBC,EAAO5T,EAAK6T,IAAI,GAdE,EAea7T,EAAK8T,QAAQ,GAAGhvB,MAAM,IAfnC,mBAejBivB,EAfiB,KAeJC,EAfI,KAiBlBh2C,EAAI8xC,GAAoBn7C,EAAM08C,GAAS71C,EAAMo4C,GACnD,GAAI51C,EAAG,CACL,IAAMmzC,EAAmB,CAACnzC,EAAG,EAAGA,EAAI,EAAG,GAEjC2zC,EAAK7B,GACTn7C,EAAMu8C,GACND,EAAGp7D,IAAI,WACPm7D,EA3EA,IA6EIY,EAAK5zC,EACL6zC,EAAYl9C,EAAMu8C,GAAQY,OAAOH,GAAI/9D,SACrCm+D,EAAYp9C,EAAM08C,GAAQS,OAAOF,GAAIh+D,SAErCqnC,EAAStmB,EAAMla,KAAI,SAAAoxB,GAAC,OAAIA,EAAEmiC,SAASD,MACnCiE,EACJhC,GAAKjC,EAAemD,EAAQv8C,EAAOsmB,EAAQ+1B,GAAMD,EAC7CkB,EACJjC,GAAKjC,EAAesD,EAAQ18C,EAAOsmB,EAAQk2B,GAAMJ,EAE7CnyB,EAAOszB,OACV5a,OACCqa,EACE,IAAsB,MAAhBoC,EAAsB,GAAK,IAAMlC,GAAa,EAAI,GAC1DG,GAEDza,OAAOoa,EAAIK,GACXza,OAAOqa,EAAIK,GACX1a,OACCqa,EACE,IACqB,MAAlBoC,EAAwB,GAAK,IAC7BjC,GAAa,EAAI,GACtBE,GAEDt+D,MACHqnC,EAAIpmC,KACF,0BACEmT,EAAG62B,EACHlqC,IAAKo+B,KAAKE,UAAU4L,GACpBwzB,YAAap8D,IAAO66D,EAAe,GAAK,EACxChkD,QAAS,WAAM,QACPuN,EAAa,UAAGtP,EAAQuP,iBAAX,aAAG,OAAAvP,EACpB,uBACA,iBACA,CACEwP,aACEq2C,EAAc96D,IAAIG,IAAO,CAAEW,OAAQ,eACnCA,WAGN,UAAAmU,EAAQ0P,kBAAR,cAAA1P,EAAqBsP,IAEvBiC,YAAa,kBAAMy0C,EAAgB96D,IACnCsmB,WAAY,kBAAMw0C,OAAgBh7D,SAlEjC4yB,EAAI,EAAGA,EAAIunC,EAAMh7D,OAAQyzB,GAAK,EAAG,SAAjCA,GAAiC,kCAuE1C,OAAOsS,SC7HX9yB,GAAYC,cAAW,SAAAnB,GAC3B,MAAO,CACLrB,KAAM,CACJpO,SAAU,WACV0rB,aAAcjc,EAAMJ,QAAQ,GAC5B2K,SAAU,UAEZ0iD,iBAAkB,CAChB18D,SAAU,WACVoT,IAAK,EACLxU,OAAQ,OACRjE,MAAO,MACP2T,WAAY,WAEdquD,YAAa,CACXruD,WAAYmB,EAAMjE,QAAQF,UAAUD,KACpCzM,ONN6B,GMQ/Bg+D,UAAW,CACT9mD,QAAS,QAEX+mD,QAAS,CACP/mD,QAAS,OACTnb,MAAO,OACP8gE,SAAU,MACV,SAAU,CACR3qD,OAAQ,YACRP,KAAM,SAGV9B,QAAS,CACPgtD,SAAU,WAKVqB,GAAUj6D,qBACd,SAACyM,GAIK,IACI/U,EAAyB+U,EAAzB/U,MAAOi8D,EAAkBlnD,EAAlBknD,cACT9yB,EAASnpC,EAAMg8D,iBAAiBC,GACtC,MACqB,gBAAnB9yB,EAAO,GAAG/6B,MACS,oBAAnB+6B,EAAO,GAAG/6B,KAEH,kBAAC,GAAyB2G,GAEZ,iBAAnBo0B,EAAO,GAAG/6B,KACLpO,EAAMq8D,kBAAkBJ,GAC7B,kBAAC,GAAmBlnD,GAEpB,kBAAC,GAAcA,GAGZ,QAoEIytD,GAhEal6D,qBAC1B,YAA+C,IAA5CtI,EAA4C,EAA5CA,MACKuX,EAAUnB,KACRyM,EAAU7iB,EAAV6iB,MACA3H,EAAkBX,iBAAOva,GAAzBkb,cACFjB,EAAM3C,iBAAO,MAEnB,OACE,6BACE,kBAAC,GAAD,CAAQtX,MAAOA,IACf,yBAAK6W,UAAWU,EAAQ8qD,WACtB,yBAAKxrD,UAAWU,EAAQrD,SACtB,yBAAK6B,MAAO,CAAEtQ,SAAU,aACrBod,EAAMla,KAAI,SAACgY,EAAMo7C,GAAQ,IAChB9gD,EAAmBC,EAAc0wB,YAAYjrB,EAAKvS,MAAlD6M,eACFwnD,EACJ,kBAACxnD,EAAD,CAAgBrY,IAAK+d,EAAKzc,GAAIlE,MAAO2gB,IAEvC,OAAIo7C,IAAQl5C,EAAM1f,OAAS,EAClBs/D,EAEF,CACLA,EACA,yBACE7/D,IAAG,UAAK+d,EAAKzc,GAAV,YACH2S,UAAWU,EAAQ6qD,oBAM7B,yBAAKvrD,UAAWU,EAAQ+qD,SACtB,yBACEroD,IAAKA,EACLlE,MAAO,CACL3V,MAAO,OACPqY,OAAQ,GACR0M,cAAenlB,EAAM87D,qBAAkB93D,EAAY,SAGpDhE,EAAM0iE,cAAc/5D,KAAI,SAAAzE,GAOvB,OACE,kBAACq+D,GAAD,CACE5D,UAAW1kD,EACXrX,IAAKsB,EACLlE,MAAOA,EACPi8D,cAAe/3D,cClH7By+D,G,iLACJ,SAA4Br9C,EAAkB3E,GAC5C,IAEIiiD,EAFEt5C,GAAyBhE,EAAQvhB,IAAI,QAAU,IAAI,GACnD6lB,EAAWtE,EAAQvhB,IAAI,SAKrBvC,EAAiBmf,EAAKngB,iBAAiB,GAAvCgB,aAEFo9D,EADsB92C,qBAAWnH,GAA/B2gB,gBACyBv9B,IAAIvC,GAErC,IAAKo9D,EACH,MAAM,IAAIx5D,MAAJ,mBAAsB5D,EAAtB,eAER,IAAKo9D,EAASh0C,QACZ,MAAM,IAAIxlB,MAAJ,mBAAsB5D,EAAtB,wBAfiE,IAuBrEqhE,EANIlD,EAAwBf,EAAxBe,oBACFmD,EAAiBnD,EAAoBr6C,EAAQvhB,IAAI,YACjDg/D,EAAYnE,EAASh0C,QAAQ6P,MACjC,SAAA7zB,GAAC,OAAIA,EAAEnF,UAAYqpB,OAAOg4C,MAIxBE,EAAW,EACXC,EAAS,EAEb,GAAI35C,EAEF,GAA8B,UAA1BA,EAAmC,CACrC,IAAM45C,EAAO59C,EAAQvhB,IAAI,SAAW,GACpC6+D,EAASM,EAAKnB,IAAI,GAAK,EACvBc,EAAclD,EAAoBuD,EAAKrB,KAAK,QACvC,CACL,IAAMx4C,EAAeC,EAAsBuzC,aAAa7pB,MAAM,KAC9D4vB,EAASp5C,SAASH,EAAa,GAAI,IAAM,EACzCw5C,EAAclD,EAAoBt2C,EAAa,IACZ,SAA/BC,EAAsBy3C,OACxBiC,GAAY,GAE8B,SAAxC15C,EAAsB03C,gBACxBiC,GAAU,QAST,GAAI39C,EAAQvhB,IAAI,QAAS,CAE9B,IAAM4lB,EAAOrE,EAAQvhB,IAAI,QACzB8+D,EAAclD,EAAoBh2C,EAAKloB,SACvCmhE,EAASj5C,EAAKhoB,MAGhB,IAAKkhE,EAIH,OAHAniC,QAAQU,KAAR,yCACoCyhC,EADpC,yBAGO,GAGT,IAAMM,EAAevE,EAASh0C,QAAQ6P,MACpC,SAAA7zB,GAAC,OAAIA,EAAEnF,UAAYqpB,OAAO+3C,MAG5B,IAAKE,IAAcI,EAIjB,OAHAziC,QAAQU,KAAR,2EAGO,GAGT,IAAMgiC,EAAkB,CAAC,eAAKL,GAAN,eAAwBA,IAC1CM,EAAqB,CAAC,eAAKF,GAAN,eAA2BA,IA2BtD,OA1BAC,EAAgB,GAAGvhE,IAAM+nB,EAAWo5C,EACpCI,EAAgB,GAAGzhE,MAAQioB,EAAWo5C,EACtCK,EAAmB,GAAGxhE,IAAM+gE,EAASK,EACrCI,EAAmB,GAAG1hE,MAAQihE,EAASK,EACtB,CACf70D,KAAM,sBACNyU,MAAO,CACL,CACEzU,KAAM,mBACN5N,iBAAkB4iE,EAClBE,YAAY,EACZ7iE,QApFU,GAqFVF,UAAWwiE,EAAUphE,MAAQ2jB,EAAQvhB,IAAI,UArF/B,IAuFZ,CACEqK,KAAM,mBACN5N,iBAAkB6iE,EAClBC,YAAY,EACZ7iE,QA3FU,GA4FVF,UAAW4iE,EAAaxhE,MAAQihE,GA5FtB,KA+FdphD,YAAa,GAAF,OACT8D,EAAQvhB,IAAI,SAAWuhB,EAAQvhB,IAAI,OAAS,WADnC,sB,GApGqBwxB,KA4GvB,YAACra,GAAiC,IAGvC4L,GAAeQ,EAFNpM,EAAToM,MAEoBi8C,IAApBz8C,WAER,OAAO,IAAI67C,GAAwB,CACjC36D,KAAM,sBACN8e,aACA7L,eAAgBuoD,MCnHCC,G,4MACnBz7D,KAAO,4B,6CAEP,SAAQkT,GACNA,EAAcgtB,aAAY,kBACxBhtB,EAAcoL,UAAUo9C,OAE1BxoD,EAAc4R,eACZ,kBACE,IAAIC,IAAW,CACb/kB,KAAM,6BACNglB,QAAS,6BACTtG,aAAcyzC,GACdrzC,WAAY68C,GACZ1oD,eAAgBkS,gBACd,kBACE,0C,uBAQZ,gB,GAxBqDC,K,sFCPxC7G,iCAAoB,yBAEjC,CACEq9C,eAAgB,CACdx1D,KADc,eAEdgd,aAAc,CAAEpgB,IAAK,qCACrBqF,YAAa,qDAEfoR,cAAe,CACbrT,KADa,cAEbgd,aAFa,GAGb/a,YACE,kGAGN,CAAEuW,kBAAmBi9C,0B,WCdR,4oDAAf,S,8CCOO,6BAAAt+D,EAAA,+EAEuB6B,oCAFvB,sBAEG08D,EAFH,yBAGI,IAAI,GAAJ,QAHJ,0CAKG,IAAI1+D,MAAM,yCAAV,YALH,gE,sBASP,+C,8CAAO,6BAAAG,EAAA,sEACyB6B,oCADzB,sBACC28D,EADD,yBAIE,IAAI,GAAJ,YAJF,gD,sBAOP,+C,8CAAO,6BAAAx+D,EAAA,sEACyB6B,oCADzB,sBACC48D,EADD,yBAIE,IAAI,GAAJ,YAJF,gD,sBAOA,SAASC,GAAe,EAAxB,OAML,IAAM96B,EAAN,GAsCA,OApCA+6B,WAAgB,cACd,IAAMC,EAAYtpD,WAAWlP,EAA7B,QACMy4D,EAAkB,CAAC,aAAD,6BAAxB,QAMA,IAAID,EAAA,MAAe,SAAAvhE,GAAG,OAAIwhE,WAAJ,MAAtB,CAGA,IAAMC,EAAN,GACIC,EAAJ,EACA,GAEE,GADAA,EAAmBJ,aAAnBI,UACsB,OACEA,QADF,KAClBA,EADkB,oBAEpBD,OAAkBH,MAAlBG,WAJJ,GAOAA,YACA,IAGMz+D,EAeV,SAAyB,EAAzB,SAOE,IAAI6hB,EAAY9b,MAAhB,QACA,IACE8b,EAAYy8C,MAAYv4D,MAAZu4D,eAAZz8C,SAEF,IAOA,EAQA,EAfI88C,EAAgB98C,aAApB,GAEE88C,WACA54D,2CAFF,UAIE44D,UAIAC,EADEC,EAAJ,IACoB,CAChBz5D,IAAK,IAAIwwB,IAAI7vB,MAAR,cAAiC84D,EAAjC,KAA0Dz0C,MAG/C,CAAEplB,UAAWe,qBAIjC,UACE,UAkBE,OAhBE+4D,EADED,EAAJ,IACyB94D,EAAA,oBACnB,CACEX,IAAK,IAAIwwB,IAAI7vB,MAAR,gBAAmC84D,EAAnC,KACFz0C,MAEL,CACEhlB,IAAK,IAAIwwB,IAAI,GAAR,OACA7vB,MADA,sBAEH84D,EAFG,KAGHz0C,MAGerkB,EAAA,oBACnB,CAAEf,UAAWe,uBACb,CAAEf,UAAW,GAAF,OAAKe,MAAL,uBAEV,CACLyC,KADK,kBAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,aAEPC,YAFO,EAGPd,MAAO,CACLN,SAAUy3D,KAIlB,UAMA,qBAMA,eAMA,qBACE,OAAO10D,uCACLrE,MADiC,gBAAnC,GAKF,kBACE,MAAO,CACLyC,KADK,eAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,gBAEPQ,eAAgB41D,GAElB79C,SAAU,CACRvY,KAAM,uBAGZ,aAWA,kBACE,MAAO,CACLA,KADK,eAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,gBAEPQ,eAAgB41D,IAGtB,eAcA,kBAcA,aAcA,aACE,MAAO,CACLp2D,KADK,eAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,gBAEPQ,eAAgB41D,GAElB79C,SAAU,CACRvY,KAAM,uBAGZ,aACE,MAAO,CACLA,KADK,oBAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,gBAEPS,eAAgB21D,IAGtB,gBAMA,kBACE,OAAOx0D,uCACLrE,MADiC,gBAAnC,GAKF,WAkBE,OAhBE+4D,EADED,EAAJ,IACyB94D,EAAA,oBACnB,CACEX,IAAK,IAAIwwB,IAAI7vB,MAAR,gBAAmC84D,EAAnC,KACFz0C,MAEL,CACEhlB,IAAK,IAAIwwB,IAAI,GAAR,OACA7vB,MADA,uBAEH84D,EAFG,KAGHz0C,MAGerkB,EAAA,oBACnB,CAAEf,UAAWe,uBACb,CAAEf,UAAW,GAAF,OAAKe,MAAL,wBAEV,CACLyC,KADK,kBAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,cAEPG,aAFO,EAGPC,aAHO,EAIPsiC,oBAGN,UAMA,UAMA,iBACE,OAAO9gC,uCACLrE,MADiC,gBAAnC,GAKF,oBACE,MAAO,CACLyC,KADK,eAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,gBAEPQ,eAAgB41D,IAGtB,qBACE,OAAOx0D,uCACLrE,MADiC,gBAAnC,GAKF,eAkBE,OAhBE+4D,EADED,EAAJ,IACyB94D,EAAA,oBACnB,CACEX,IAAK,IAAIwwB,IAAI7vB,MAAR,gBAAmC84D,EAAnC,KACFz0C,MAEL,CACEhlB,IAAK,IAAIwwB,IAAI,GAAR,OACA7vB,MADA,sBAEH84D,EAFG,KAGHz0C,MAGerkB,EAAA,oBACnB,CAAEf,UAAWe,uBACb,CAAEf,UAAW,GAAF,OAAKe,MAAL,uBAEV,CACLyC,KADK,eAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,kBAEPM,cAFO,EAGPnB,MAAO,CACLN,SAAUy3D,KAIlB,UAMA,aACE,OAAO10D,uCACLrE,MADiC,gBAAnC,GAKF,UACE,MAAO,CACLyC,KADK,WAELpG,KAAM2D,MAFD,cAGL0E,YAAa1E,MAHR,aAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,aAEPgB,YAAao1D,IAGnB,eACE,OAAOx0D,uCACLrE,MADiC,gBAAnC,GAMF,QACE,OAAO8E,mCACL9E,MAD6B,gBAA/B,IArVUg5D,CAAgB,EAHTN,EAAA,KAAiB,SAAA7iC,GAAW,OAC7CA,MAD6C,iBAGpB,IAA3B,GAOA57B,kCAA+B4K,qBAA/B5K,IACAA,gBAAoB,CAApBA,GACAujC,cAGF,EC/Da,SAASy7B,GAAuB1pD,GAC7C,OAAO,yCAEL2pD,sCAFK,GAGL,cACS,CACLh5D,cAAe2a,iCADV,IAELpY,KAAMjF,4CAHV,SAKW,SAAAoB,GAAI,MAAK,CAChBu6D,QADgB,WAEd,IAAMC,EAAiB19D,yBAAekD,EAAD,cAArC,QACMy6D,EAAkB39D,yBACtBkD,EADoC,cAAtC,kBAIMyO,EAAU8O,qBAAhB,IDpBV,6CCqBUm9C,UACQ,SAAAC,GACJ,MASA,OAPEC,EADEH,EAAJ,IACwB,CACpBh6D,IAAK,IAAIwwB,IAAI0pC,MAAR,eAAoCF,EAApC,KACFh1C,MAGiB,CAAEplB,UAAWs6D,sBAE9BhtC,YAAY,CAAC,EAElBktC,GAFF,QAXJH,MAgBQ,YAA4B,yBAA1BC,EAA0B,KAAjBG,EAAiB,KAC1BC,EAAN,GADgC,oEAEpBC,EAFoB,KAERC,EAFQ,KAGxB/jD,EAAgBpa,yBACpBkD,EADkC,cAApC,iBAIA,GACEkX,aACCA,WAFH,GAIE,cAEF,IAAMgkD,EAAezsD,EAAA,iBACnB,SAAA4lD,GAAQ,OAAIv3D,yBAAeu3D,EAAfv3D,UAAJ,KAEV,MACE,MAAM,IAAIjC,MAAM,6BAAV,8DAAN,MAIF,IAAIq/D,OAAmB,EAErBA,EADEO,EAAJ,IACwB,CACpBh6D,IAAK,IAAIwwB,IACPgqC,MADG,WAEH,IAAIhqC,IAAI0pC,MAAR,eAAoCF,EAFjC,MAGHh1C,MAGkB,CACpBplB,UAAW46D,kBAGfF,OACEptC,YAAY,CAAC,EAEXwtC,GAFU,KADdJ,MAhCF,2BAAgD,kBAS5C,OAX4B,8BA2ChC,OAAOptC,sBAAP,OA3DJ+sC,MA6DQ,SAAAK,GAAe,4BACnB,2BAKkB,8BAJhBb,EAIgB,KAHhBkB,EAGgB,KAFhBJ,EAEgB,KADhBE,EACgB,KAKVt8B,EAAS86B,GAAe,EAAD,IAJL58D,yBAAeo+D,EAAc,CAAC,WAAtD,aAUAl7D,oBAjBiB,kCA7DvB06D,OAiFS,SAAA9+C,GACLua,iBACA1nB,yEAC2DzO,EAD3DyO,0HAIAA,kBAAwBzO,EAAxByO,wBC7Gd,SAAS4sD,GAAcr1C,GACrB,IAEE,OADA,IAAIiL,IAAIjL,IACD,EACP,MAAOpK,GACP,OAAOoK,EAAIsc,WAAW,MAI1B,SAASr/B,GAAY7B,GACnB,IAAMX,EAAM,QAASW,EAAQA,EAAMX,SAAMhH,EACnC4G,EAAY,cAAee,EAAQA,EAAMf,eAAY5G,EACrDoJ,EAAO,WAAYzB,EAAQA,OAAQ3H,EACzC,OACM,OAAJoJ,QAAI,IAAJA,OAAA,EAAAA,EAAMpF,QAAN,OACAgD,QADA,IACAA,OADA,EACAA,EAAKk0C,MAAMl0C,EAAIsyD,YAAY,KAAO,MADlC,OAEA1yD,QAFA,IAEAA,OAFA,EAEAA,EAAWs0C,MAAMt0C,EAAU0yD,YAAY,KAAO,KAC9C,GAIW,SAAS12D,GAAEsU,GACxB,OAAO/R,QACJnJ,MAAM,gBAAiB,CACtBkE,GAAIgF,YACJkF,KAAMjF,QAAMye,QAAQ,kBACpBjH,KAAMxX,QAAMmsC,cACVp6B,EAAc8uB,iBAAiB,OAAQ,iBAG1CzK,UAAS,iBAAO,CACfsmC,YAAa,WACbC,eAAW9hE,EACX+hE,oBAAgB/hE,EAGhBgiE,gBAAiB,GACjBC,aAAc,GACdC,aAAc,GAEdz4D,YAAa,OAEdnD,SAAQ,SAAAC,GAAI,MAAK,CAChB47D,eADgB,SACDC,GACb77D,EAAKkD,YAAc24D,GAErBC,eAJgB,SAIDC,GACb/7D,EAAKs7D,YAAcS,GAErBC,aAPgB,SAOHH,GACX77D,EAAKu7D,UAAYM,GAEnBI,kBAVgB,SAUEJ,GAChB77D,EAAKw7D,eAAiBK,GAExBK,YAbgB,SAaJH,GACV/7D,EAAKy7D,gBAAkBM,GAEzBI,aAhBgB,SAgBHJ,GACX/7D,EAAK07D,aAAeK,GAEtBK,aAnBgB,SAmBHL,GACX/7D,EAAK27D,aAAeI,GAGtBM,UAvBgB,WAwBdr8D,EAAKs7D,YAAc,GACnBt7D,EAAK07D,aAAe,GACpB17D,EAAK27D,aAAe,GACpB37D,EAAKy7D,gBAAkB,GACvBz7D,EAAKkD,YAAc,GACnBlD,EAAKw7D,eAAiB,CAAE/6D,IAAK,IAC7BT,EAAKu7D,UAAY,CAAE96D,IAAK,SAG3B6X,OAAM,SAAAtY,GAAI,MAAK,CACd,mBAAmB,IACTu7D,EAA2Cv7D,EAA3Cu7D,UAAWC,EAAgCx7D,EAAhCw7D,eAAgBt4D,EAAgBlD,EAAhBkD,YAEnC,OAAOq4D,EACHz4D,uBAAay4D,EAAWC,EAAgBv4D,GAAaC,QACrDzJ,GAGN,gBACE,OACEuG,EAAK07D,eACJ17D,EAAKu7D,UAAYt4D,GAAYjD,EAAKu7D,WAAa,KAIpD,YAAY,IACSn6D,EAAiCpB,EAA5Cu7D,UAAkCv4D,EAAUhD,EAA1Bw7D,eAC1B,SACGx4D,GAAS,QAASA,GAASA,EAAMvC,IAAI6hC,WAAW,WAChDlhC,GAAS,QAASA,GAASA,EAAMX,IAAI6hC,WAAW,YAIrD,yBAAyB,IACfi5B,EAAcv7D,EAAdu7D,UACR,OAAOA,GAAa,QAASA,IAAcF,GAAcE,EAAU96D,MAErE,yBAAyB,IACCuC,EAAUhD,EAA1Bw7D,eACR,OAAOx4D,GAAS,QAASA,IAAUq4D,GAAcr4D,EAAMvC,MAEzD,oBACE,OAAOpH,KAAKijE,oBAAsBjjE,KAAKkjE,oBAGzC,gBAAgB,IACKn7D,EAAUpB,EAArBu7D,UACR,OAAOn6D,GAAS,QAASA,GAASA,EAAMX,IAAI6hC,WAAW,YAEzD,gBAAgB,IACUt/B,EAAUhD,EAA1Bw7D,eACR,OAAOx4D,GAAS,QAASA,GAASA,EAAMvC,IAAI6hC,WAAW,YAGzD,oBACE,MAC+B,WAA7BxsC,OAAO4M,SAASqiC,WACf1rC,KAAKmjE,WAAanjE,KAAKojE,YAI5B,kBAAkB,MAChB,OAAO,UAAApjE,KAAKqjE,oBAAL,eAAmB74D,QAASzB,eAGrC,eAAe,MACb,OAAOpC,EAAKy7D,kBAAL,UAAwBz7D,EAAKoW,KAAKc,qBAAlC,aAAwB,EAA0B,KAG3D,gBACE,OACElX,EAAK27D,eACJtiE,KAAKqjE,aAAe33D,yBAAe1L,KAAKqjE,aAAa74D,MAAQ,SAInEyU,OAAM,SAAAtY,GAAI,MAAK,CACd,qBACE,OAAIA,EAAK28D,MACP,8DACS38D,EAAK48D,cACd,qLAGS58D,EAAK68D,cACd,mPAKK,QCnKR,IAAM1gD,GAAeH,8BAAoB,iBAAzC,ICAQ,sCAAkC,CAC/CriB,GAD+C,YAE/CkK,KAAMjF,yCCFKud,GAAeH,8BAAoB,sBAAzC,ICED8gD,GAAgB,eAAClM,EAAD,0DAAUC,EAAV,kEAClBD,EAAA,MAAQ,SAAAt0D,GAAK,OAAIu0D,WAAJ,OAWjB,SAASkM,GAAatgE,GACpB,IAAKA,EAAL,QACE,MAAM,IAAI5B,MAAV,eAEF,OACEiC,yBAAeL,EAAfK,uCACuBA,yBAAe2E,oBAAD,GADrC3E,QADF,KAMK,SAASkgE,GAAkBvnE,EAAOwnE,EAAqBC,GAC5D,IAAMC,EAAY,CAAE3uD,SAAU,IACtBkW,EAAqBjvB,EAF0C,WAEnD2gB,EAAS3gB,EAF0C,KAoDvE,OAhDAwnE,UACU,SAAA57D,GAAS,OAxBrB,SAAsB8iB,EAAQ1nB,GAC5B,IAAMgB,EAAOs/D,GAAb,GACMn3D,EAAa9I,yBAAeL,EAAfK,aAAnB,GACMsgE,EAAS,IAAIC,OAAOl5C,EAA1B,KACA,QACI1mB,QAAF,IAAwBmI,EAAA,QAAkB,SAAA03D,GAAG,QAAMA,QAAN,MAD/C,OAoBuBC,CAAa74C,EAAjB,MADnBu4C,SAEW,SAAA57D,GAEP,IAAMuE,EAAa,OAAH,IAAG,CAAK9I,yBAAeuE,EAAfvE,aAFJ,IAOhBuE,mBAAJ,iBACEuE,6BAMF,IAHA,IAAI43D,EAXgB,gBAelB,IAAMz3D,EAAWH,EAAjB,GACM+4B,EAAM6+B,EAAA,eAAwB,SAAAh/B,GAAC,OAAIA,SAAJ,KAC/B7kC,EAAKiM,UAAoBymB,EAApBzmB,QAAX,KACA,KAUE43D,QAVQ,CACR,IAAM7lC,EAAI,CACRnpB,SADQ,GAER/Q,KAFQ,EAGR9D,GAHQ,EAIRu4B,MAAO,CAAEtoB,UAAWszD,WAEtBM,mBACAA,MAZKnxC,EAAT,EAAgBA,EAAIzmB,EAApB,OAAuCymB,IAAK,EAAnCA,GAmBTmxC,kBACEA,EAAA,oBAA6B,SAAA70B,GAAG,OAAIA,WAAJ,UADlC60B,EAGE,CACE7jE,GAAI0H,EADN,QAEE5D,KAAMs/D,GAFR,GAGEl3D,KAHF,EAIEq3B,UAAW9mB,EAAA,aAAiB,SAAA/Z,GAAC,OAAIA,kBAAJ,KAC7BmS,SAAU,QAKX2uD,EAAP,SAGa,gBAAAxsD,GAAa,OAC1B,gDAC4C,CACxChX,GADwC,YAExCkK,KAAMjF,gBAFkC,mCAGxCs+D,UAAWt+D,YAAUA,QAHmB,SAIxC8lB,WAJwC,GAKxCtO,KAAMxX,sBACJ+R,0BANsC,eAQxC8sD,oBAAqB7+D,YAAUA,QAAVA,OAAwBA,QAAxBA,WATzB,SAWW,SAAAoB,GAAI,MAAK,CAChB09D,QADgB,YAEd19D,UAEF29D,eAJgB,YAKd39D,mBAA8BA,gBAA9BA,KAEFgoB,gBAPgB,WAQdhoB,iBAEF2nB,cAVgB,YAWd3nB,oBAtBN,OAyBS,SAAAA,GAAI,MAAK,CACd49D,mBADc,YACmB,IAEzBvJ,EADsB92C,qBADG,mBAEdwZ,IAAjB,GACM11B,EAAS,OAAGgzD,QAAH,IAAGA,OAAH,EAAGA,gBAAlB,SACM37C,EAAW/H,cAA0B3Q,OAA3C,MACA,KAAe,sBACSqB,EADT,mCACF2P,EADE,QAEX,GACE0H,EAAA,mBACE,SAAA8nB,GAAW,OAAIA,SAAqBxvB,EAAzB,QAGb,SAAO3P,IANX,2BAA0C,8CAD7B,iCAajB47D,oBAnBc,YAoBZ,IAAKj9D,EAAL,KACE,SAEF,IAAMyO,EAAU8O,qBAAhB,GACgB0/C,EAAyCxuD,EALzB,OAM1B4lD,EADmD5lD,EALzB,gBAMfsoB,IAAjB,GACA,MACE,SAEF,IAAM8mC,EAAS79D,qBAViB,GAahC,OAAQ69D,EAAS,CAAH,GAAP,uBACFZ,EAAA,QACO,SAAAp3D,GACN,IAAMi4D,EAAsBhhE,yBAAe+I,EAA3C,iBACQk4D,EAAe1J,EAFT,WAGd,OAAOyI,GAAciB,EAArB,MAJD,QAMO,SAAAl4D,GAAQ,IAER07B,EADmB5wB,cAA0B3Q,OADrC,mBAEa,KACzB,SAAAgR,GAAO,OAAIA,EAAJ,QAEHgtD,EAAgBn4D,EAAA,cAAkB,SAAAmL,GAAO,OAAIA,EAAJ,QAC/C,OAAO8rD,GAAcv7B,EAArB,SAKR,oBACE,OAAOvhC,OAAYA,OAAZA,cAAP,IAGFi+D,8BAtDc,cAuDZ,IAAKj+D,EAAL,KACE,SAEF,IAAMi9D,EAAsBiB,EAA5B,OAGM7J,EAFU92C,qBAAhB,GALsD,gBAOrCwZ,IAAjB,GAEA,OAAMs9B,GAAYA,EAAlB,YAKO4I,EAAA,QACG,SAAAp3D,GACN,IAAMi4D,EAAsBhhE,yBAAe+I,EAA3C,iBACQk4D,EAAe1J,EAFT,WAGd,OAAOyI,GAAciB,EAArB,MAJG,QAMG,SAAAl4D,GAAQ,IAER07B,EADmB5wB,cAA0B3Q,OADrC,mBAEa,KAAiB,SAAAgR,GAAO,OAAIA,EAAJ,QAC7CgtD,EAAgBn4D,EAAA,cAAkB,SAAAmL,GAAO,OAAIA,EAAJ,QAC/C,OAAO8rD,GAAcv7B,EAArB,MAdF,IAkBJ47B,UAlFc,YAkFU,WAChBgB,EAAOnB,GAAkB,EAE7Bh9D,sBAF4B,GAG5BA,EAHF,WAMMyO,EAAU8O,qBAAhB,GACM6gD,EAAQ3vD,EAAA,4BACJ,SAAA4vD,GACN,IAAMC,EAAsBxhE,yBAC1BuhE,EADwC,cAA1C,iBAIA,WAAIC,UAGGA,WAAP,MATU,KAWP,cACH,IAAM9/B,EAAI/vB,cAAV,GACA,MAAO,CACL9U,GAAI6kC,EADC,aAEL/gC,KAAMX,yBAAe0hC,EAFhB,QAGLhwB,SAAU,wBAHL,GAIL0jB,MAAO,CACLtoB,UAAU,OAKlB,MAAO,CACLnM,KADK,OAEL9D,GAFK,OAGL6U,SAAU,CACR,CAAE/Q,KAAF,SAAkB9D,GAAlB,SAAgC6U,SAAU2vD,IADpC,yBAOZI,oBA3Hc,cA4HZ,OAAOvB,GAAkB,EAEvBh9D,kCAFsB,GAGtBA,EAHF,YAQFw+D,wBApIc,gBAqIZ,IAAIC,EAAcP,EACdl+D,sBADwB,GAExBA,YAFJ,GAGAuiC,WAAa,SAAAm8B,GACXD,EAAcA,UAA6B,IAA3CA,OAEF,IAAI7/B,EAAJ,GAWA,OAVA6/B,WAAoB,cACdE,EAAJ,QACE//B,EAAO+/B,EAAP//B,WAEAA,EAASxhC,gBAEP4C,0BAA6BuiC,SAAY,CAF3C3D,SAMJ,QC/PKziB,GAAeH,8BAAoB,kCAAzC,I,QCCQ,SAAS3f,GAAEsU,GACxB,OAAO/R,QACJnJ,MAAM,mBAAoB,CACzBkE,GAAIgF,YACJkF,KAAMjF,QAAMye,QAAQ,qBACpBqH,WAAY,GACZtO,KAAMxX,QAAMmsC,cACVp6B,EAAc8uB,iBAAiB,OAAQ,iBAG1C1/B,SAAQ,SAAAC,GAAI,MAAK,CAChBgoB,gBADgB,WAEdhoB,EAAK0kB,WAAa,IAEpBiD,cAJgB,SAIFi3C,GACZ5+D,EAAK0kB,WAAak6C,OCfnB,IAAMziD,GAAeH,8BAAoB,oBAAzC,IC0BD6iD,GAAoBj8C,gBAAK,kBAAM,mCAE/Bk8C,GAAkBl8C,gBAAK,kBAAM,mC,+MAGjCnlB,KAAO,uB,EAEP+/B,QAAU,CACRshC,mBACAD,sB,6CAGF,SAAQluD,GACNA,EAAcouD,mBACZ,kBACE,IAAIj1B,EAAe,CACjBrsC,KAAM,yBACN0e,aAAc6iD,GACdziD,WAAY0iD,GAAiBtuD,GAC7BsG,YAAa,iBACbnR,YAAa,kDACbkgB,IAAK,mEAIXrV,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,kCACNglB,QAAS,mBACTtG,aAAc+iD,GACd3iD,WAAY4iD,GAA2CxuD,GACvDD,eAAgBkS,gBACd,kBACE,+DAORjS,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,iBACNglB,QAAS,cACTtG,aAAcijD,GACd7iD,WAAY8iD,GAA0B1uD,GACtCD,eAAgBkS,gBACd,kBAAM,wCAKZjS,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,sBACNglB,QAAS,mBACTtG,aAAcmjD,GACd/iD,WAAYgjD,GACZ7uD,eAAgBkS,gBACd,kBAAM,wCAKZjS,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,oBACNglB,QAAS,eACTtG,aAAcqjD,GACdjjD,WAAYkjD,GAA6B9uD,GACzCD,eAAgBkS,gBACd,kBAAM,oD,uBAMd,SAAUjS,GACJktB,gCAAsBltB,EAAc8S,aACtC9S,EAAc8S,UAAUi8C,aAAa,OAAQ,CAC3Cn5C,MAAO,aACP1W,KAAM8vD,KACNnvD,QAAS,SAAC/B,GACR,GAA6B,IAAzBA,EAAQ6J,MAAM1f,OAChB6V,EAAQq0C,OAAO,gDACV,GAAIr0C,EAAQ6J,MAAM1f,QAAU,EAAG,CACpC,IAAM2X,EAAS9B,EAAQuP,UACrB,iBACA,iBACA,CAAE5H,KAAM3H,EAAQ6J,MAAM,GAAG3e,KAE3B8U,EAAQ0P,WAAW5N,GACf9B,EAAQ6J,MAAM1f,OAAS,GACzB6V,EAAQq0C,OAAR,iMAORnyC,EAAc8S,UAAUi8C,aAAa,OAAQ,CAC3Cn5C,MAAO,kBACP1W,KAAM+vD,KACNpvD,QAAS,SAAC/B,GACR,IAAM8B,EAAS9B,EAAQuP,UACrB,sBACA,uBAEFvP,EAAQ0P,WAAW5N,MAGvBI,EAAc8S,UAAUi8C,aAAa,OAAQ,CAC3Cn5C,MAAO,eACP1W,KAAMgwD,KACNrvD,QAAS,SAAC/B,GACR,IAAM8B,EAAS9B,EAAQuP,UACrB,oBACA,qBAEFvP,EAAQ0P,WAAW5N,W,GAnHAsS,K,sDC5BvBhX,GAAYC,aAAW,CAC3BgoB,QAAS,CACP1pB,YAAa,QACbf,gBAAiB,UACjB2qB,gBACE,sHACFl6B,OAAQ,OACRjE,MAAO,OACP87B,UAAW,UAEb/V,MAAO,CACL5K,QAAS,QACT7H,MAAO,MACPtT,MAAO,OACPiqE,SAAU,SACV3tD,WAAY,UAEd8hB,aAAc,CACZzqB,WAAY,UACZ9T,QAAS,QAEXw+B,WAAY,CACV1qB,WAAY,UACZ9T,QAAS,OACTyT,MAAO,SAIX,SAASorB,KAAiB,MAEE5nB,oBAAS,GAFX,mBAEjBsO,EAFiB,KAEVC,EAFU,KAGlBlO,EAAUnB,KAMhB,OALAoB,qBAAU,WACR,IAAM+N,EAAUxG,YAAW,kBAAM0G,GAAS,KAAO,KACjD,OAAO,kBAAMzG,aAAauG,MACzB,IAEIC,EACL,yBAAKrL,cAAY,kBAAkBtD,UAAWU,EAAQ8mB,SAAtD,iBAEE,kBAACisC,GAAA,EAAD,OAEA,KAGN,SAAStrC,GAAT,GAAgE,IAAxCyB,EAAwC,EAAxCA,YAChBlpB,EAAUnB,KAChB,OAAO,yBAAKS,UAAWU,EAAQinB,cAAeiC,GAMhD,SAASvB,GAAT,GAAiD,IAA3B/Y,EAA2B,EAA3BA,MACd5O,EAAUnB,KAChB,OAAO,yBAAKS,UAAWU,EAAQknB,YAAatY,EAAMjH,SAIpD,IAaekgB,GAbwB92B,qBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACjD,OAAIA,EAAMmmB,MACD,kBAAC+Y,GAAD,CAAY/Y,MAAOnmB,EAAMmmB,MAAOhM,cAAY,kBAEjDna,EAAMkf,QACD,kBAAC8f,GAAD,CAAcyB,YAAazgC,EAAMkf,UAErClf,EAAMq/B,OAGJr/B,EAAMs/B,aAFJ,kBAACR,GAAD,SCnELyrC,GAGD,SAAAx1D,GAAS,IACJ/U,EAAoB+U,EAApB/U,MAAO+Y,EAAahE,EAAbgE,SADH,EAEyB/Y,EAAMsE,MAAQ,GAFvC,IAEJ8gB,eAFI,MAEM,EAFN,MAESC,eAFT,MAEmB,EAFnB,EAIN1E,EAAO8F,4BAAkBzmB,GACzB6Y,EAAM8H,EAAK6pD,MAAMjqE,SAAW8kB,EAC5BlhB,IAASwc,EAAK8pD,MAAMlqE,SAAW6kB,GACrC,OACE,yBAAKrP,MAAO,CAAEtQ,SAAU,aACtB,yBACEsQ,MAAO,CACLtQ,SAAU,WACVoT,MACA1U,SAGF,kBAACnE,EAAM0qE,gBAAoB31D,GAC1BgE,KAUTwxD,GAAe9lD,aAAe,CAC5B1L,SAAU,MAEGzQ,2BAASiiE,ICDjB,SAAS/+C,GAAkB9E,GAChC,OAAOvd,QACJuB,QACC,iBACAs3B,eACA74B,QACGnJ,MAAM,CACLoO,KAAMjF,QAAMye,QAAQ,kBACpB/b,cAAe2a,iCAAuBE,KAEvC6Y,UAAS,iBAAO,CACfC,sBAAkBx7B,EAClBq7B,QAAQ,EACR/6B,UAAMN,EACNs7B,kBAAct7B,EACdkb,aAASlb,EACT2mE,wBAAoB3mE,EACpB0mE,gBAAkBtrC,QAGvBvc,OAAM,SAAAtY,GAAI,MAAK,CACd,uBACE,OAAO6d,kBAAQ7d,EAAM,YAAY6D,MAEnC,kBACE,kCACK7B,+BAAqBhC,IAD1B,IAEEwc,cAAexc,EAAKwc,cACpBC,aAAczc,EACdvD,OAAQuD,EAAKsB,cAAc8a,gBAIhCrc,SAAQ,SAAAC,GACP,IAAIi1B,EAEJ,MAAO,CACLC,YADK,WAEHE,gCACEp1B,GACA,kBAuEZ,SAAyBA,GAA2B,IAC1Cyd,EAAeF,qBAAWvd,GAA1Byd,WACAvb,EAA8BlC,EAA9BkC,YAAam0B,EAAiBr2B,EAAjBq2B,aACbzY,EAAkB5d,EAAlB4d,cACFpc,EAAS0a,4BAAkBlc,GAQjC,GAHAlD,yBAAekD,EAAKsB,eACpB+hB,sBAAY7hB,GAERA,EAAO22B,YAAa,KACdkoC,EAAwD7+D,EAAxD6+D,UAAWC,EAA6C9+D,EAA7C8+D,WAAYC,EAAiC/+D,EAAjC++D,WAAYC,EAAqBh/D,EAArBg/D,QAASC,EAAYj/D,EAAZi/D,QACpD,MAAO,CACLpqC,eACA5Y,aACAvb,YAAa,2BACRA,GADM,IAETkU,KAAMiN,sBAAY7hB,GAClB3L,MAAOwqE,EACPvmE,OAAQwmE,EACRC,aACAC,UACAC,YAEFnqC,WAAY,CACV1Y,gBACAyY,aAAcA,EAAa54B,KAC3BigB,UAAWhc,0BAAgB1B,GAC3Bgb,QAAS,MAIf,OAzGgBqa,CAAgBr1B,MACtB,SAAC9H,GACC,OAAOA,E,4CAAYo9B,CAAkBp9B,QAAauB,IAEpD,CACEgE,KAAM,GAAF,OAAKuC,EAAK6D,KAAV,YAAkB7D,EAAKrG,GAAvB,cACJ47B,MAAO,IACPE,iBAAiB,GAEnBp8B,KAAKq8B,WACLr8B,KAAKs8B,YACLt8B,KAAKu8B,WAITF,WAnBK,SAmBMI,GACT91B,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,WAAQniB,EACbuG,EAAKogE,wBAAqB3mE,EAC1Bw7B,EAAmBa,GAErBG,WA5BK,SA4BMC,GACLjB,IAAqBA,EAAiBr3B,OAAOm4B,SAC/Cd,EAAiBe,QAEnBh2B,EAAK80B,QAAS,EACd90B,EAAK2U,QAAUuhB,EACfl2B,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,WAAQniB,EACbuG,EAAKogE,wBAAqB3mE,EAC1Bw7B,OAAmBx7B,GAErBk8B,YAxCK,SAwCOlc,GAKV,QAAahgB,IAATggB,EAAJ,CADC,IAIO1f,EAA2C0f,EAA3C1f,KAAMg7B,EAAqCtb,EAArCsb,aAAcqrC,EAAuB3mD,EAAvB2mD,mBAC5BpgE,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,aAAeA,EACpB/0B,EAAKjG,KAAOA,EACZiG,EAAK4b,WAAQniB,EACbuG,EAAKogE,mBAAqBA,EAC1BnrC,OAAmBx7B,IAErBm8B,SAzDK,SAyDIha,GACPua,QAAQva,MAAMA,GACVqZ,IAAqBA,EAAiBr3B,OAAOm4B,SAC/Cd,EAAiBe,QAGnBh2B,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,MAAQA,EACb5b,EAAKogE,wBAAqB3mE,EAC1Bw7B,OAAmBx7B,O,8CA2C7B,WACE+Q,GADF,2BAAAxP,EAAA,yDAGOwP,EAHP,sBAIU,IAAI3P,MAAM,+BAJpB,cAOUw7B,EAAsD7rB,EAAtD6rB,aAAc5Y,EAAwCjT,EAAxCiT,WAAY6Y,EAA4B9rB,EAA5B8rB,WAAYp0B,EAAgBsI,EAAhBtI,YAPhD,SAS2Cm0B,EAAqBmB,eAC5D/Z,EADsC,YAAC,eAGlC6Y,GACAp0B,IAbT,uBASU6yB,EATV,EASUA,aAAiBh7B,EAT3B,kDAiBS,CAAEg7B,eAAch7B,OAAMqmE,mBAAoB/pC,EAAa3lB,iBAjBhE,4C,sBCjLe3S,4BAJf,SAA0ByM,GACxB,OAAO,kBAAC,qBAAsBA,MCHjBwR,iCACb,kBACA,CACE0kD,SAAU,CACR78D,KAAM,aACNiC,YAAa,eACbrQ,MAAOmJ,QAAMwiB,YAAY,YAAa,CAAC,WACvCP,aAAc,UAEhB1X,MAAO,CACLtF,KAAM,QACNiC,YAAa,yCACb+a,aAAc,QACdC,gBAAiB,CAAC,YAEpBg7B,UAAW,CACTj4C,KAAM,SACNiC,YAAa,iCACb+a,aAAc,MAGlB,CAAEvE,iBAAiB,I,UCcAqkD,G,2KAcnB,SAAsBlnD,GACpB,IAAMyyB,EAAmB,2BACpBzyB,GADiB,IAEpBgD,aAAc,KAGhB,sFAAmCyvB,K,wCAIrC,SACEzwC,EACAge,GAEA,IAAMmnD,EAAe,oFAAiCnlE,EAAQge,GAC9D,kCAAYmnD,GAAZ,IAA0BtpC,SAAU7d,EAAK6d,a,mEAO3C,WAAqB7Z,EAAwBhE,GAA7C,SAAAze,EAAA,+EACSyiB,EAAWK,KAChBrE,EAAKiE,UACL,oBACAjE,IAJJ,2C,2FAaA,SAAqB6c,EAAoCvb,GACvD,OAAKub,EAAWqQ,SAGTrQ,EAAWqQ,QAAQC,OAAO7rB,EAASub,K,gEAG5C,WAAkBA,GAAlB,8BAAAt7B,EAAA,yDACUsrC,EAAwBhQ,EAAxBgQ,YAAa1oC,EAAW04B,EAAX14B,OAEjByiB,EAAU,IAGdA,EAAUiW,EAAWjW,UAEc,IAAnBA,EAAQznB,OAR1B,uBASIu9B,QAAQU,KAAK,+CATjB,kBAUW,IAVX,cAaQgqC,EAAiBxgD,EAAQjiB,KAAI,SAAAujB,GAGjC,IAAMm/C,EAAgB,eAAKn/C,GAO3B,OANIm/C,EAAc1pE,QAChB0pE,EAAc1pE,MAAQX,KAAKiB,MAAMopE,EAAc1pE,QAE7C0pE,EAAcxpE,MAChBwpE,EAAcxpE,IAAMb,KAAKiB,MAAMopE,EAAcxpE,MAExCwpE,KAIHC,EAAoBz6B,EAAYuoB,6BACpCgS,EACA,CACEjjE,WA9BN,kBAkCSmjE,EACJ7iE,KAECimB,cAAO,SAAApJ,GAAO,OAAI,EAAKimD,qBAAqB1qC,EAAYvb,MACxDysB,eAEDC,aAxCL,2C,4DAxDyDw5B,K,8BCV3D,SAASC,GAAqBnF,GAC5B,MAAoB,GAAbA,EAAInjE,OAAe,GAOrB,IAAMuoE,GAAgBz1C,KAAW01C,QAAO,SAAAphE,GAC7C,IAAMqhE,EAAcjpB,cAAWkpB,IAAI,GACnC,MAAO,CACLhpD,MAAO,CACL,oBACE,OAAOipD,aAAuBvhE,GAAM,GAAO,IAE7C,kBACE,OAAOqhE,EAAY7nE,QAGvBuG,QAAS,CACPyhE,eADO,SACQ7pC,GACb0pC,EAAY3nE,IAAIi+B,SAQlB8pC,GAAeN,GAAcC,QAAO,SAAAphE,GAAI,MAAK,CACjDsY,MAAO,CACL,YACE,OAAO7W,oBAAUzB,GAAMqgE,gBAKvBqB,GAAeP,GAAcC,QAAO,SAAAphE,GAAI,MAAK,CACjDsY,MAAO,CACL,YACE,OAAO7W,oBAAUzB,GAAMsgE,iBAKd,SAASr/C,GAAkBtQ,GACxC,OAAO/R,QAAMuB,QACX+wD,KACAtyD,QACGnJ,MAAM,cAAe,CACpBkE,GAAIgF,YACJkF,KAAMjF,QAAMye,QAAQ,eACpB8zC,aAAc,EACdr3D,OAAQ,IACRymE,WAAY,GACZoB,SAAU,EACVC,cAAe,EACfC,eAAgB,GAChBn5D,SAAU,GACV0oD,kBAAmB,eACnBl6C,cAAetY,QAAM6oB,MAAM7oB,QAAMS,QACjC6gE,MAAOthE,QAAMC,SAAS4iE,GAAc,IACpCxB,MAAOrhE,QAAMC,SAAS6iE,GAAc,IAEpC9iC,OAAQhgC,QAAM6oB,MACZ9W,EAAc8uB,iBACZ,QACA,eAOJqiC,iBAAkBljE,QAAM6oB,MACtB9W,EAAc2sB,0BAA0B,UAK1CykC,oBAAqBnjE,QAAM6oB,MAAM7oB,QAAMksC,YAExC9V,UAAS,iBAAO,CACfgtC,mBAAevoE,EACfmiB,WAAOniB,EACP+mE,QAAS,IACTC,QAAS,QAEVnoD,OAAM,SAAAtY,GAAI,MAAK,CACd,YACE,IAAKA,EAAKgiE,cACR,MAAM,IAAInnE,MAAM,yBAElB,OAAOmF,EAAKgiE,mBAGf1pD,OAAM,SAAAtY,GAAI,MAAK,CACd,kBACE,YACyBvG,IAAvBuG,EAAKgiE,eACLhiE,EAAKkgE,MAAMjqE,iBAAiB2C,OAAS,GACrCoH,EAAKigE,MAAMhqE,iBAAiB2C,OAAS,GAGzC,cACE,OAAOoH,EAAKkX,cAActe,OAAS,IAAMS,KAAK8+B,aAEhD,gBACE,OAAOn4B,EAAKnK,MAAQmK,EAAKwgE,SAE3B,iBACE,OAAOxgE,EAAKlG,OAASkG,EAAKygE,SAE5B,YACE,MAAO,CAACzgE,EAAKkgE,MAAOlgE,EAAKigE,QAG3B,kBACE,kCACKj+D,+BAAqBhC,IAD1B,IAEE6Y,sBAAuBgF,kBACrBN,qBAAWvd,GACX,gCAKPD,SAAQ,SAAAC,GAAI,MAAK,CAChBk1B,YADgB,WACF,WACNzmB,EAAU8O,qBAAWvd,GAC3Bg6B,sBACEh6B,EACA25B,oBACE,WACE,QAA2BlgC,IAAvBuG,EAAKgiE,cAA6B,CACpC,IAAMC,EAAO,CAACjiE,EAAKqgE,UAAWrgE,EAAKsgE,YAC7BhoD,EAAQ,CAACtY,EAAKkgE,MAAOlgE,EAAKigE,OAC3BjgE,EAAKm4B,aACRn4B,EAAKkX,cAAcpgB,SAAQ,SAAC2G,EAAMuF,GAChC,IAAMqxD,EAAW5lD,EAAQsoB,gBAAgBv9B,IAAIiE,GAC7C,GAAI42D,EAAU,KACJh0C,EAAYg0C,EAAZh0C,QACR,GAAIA,GAAWA,EAAQznB,OAAQ,CAC7B,IAAMspE,EAAkB7+C,sBAAYhD,GAChC6hD,GACFvhC,wBAAY,WACVroB,EAAMtV,GAAOm/D,oBAAoBD,GACjC5pD,EAAMtV,GAAOo/D,WACX9pD,EAAMtV,GAAOq/D,QAAUJ,EAAKj/D,eAU9C,CAAEuyB,MAAO,OAGbyE,sBACEh6B,EACA25B,oBAAQ,WAEN,QAA2BlgC,IAAvBuG,EAAKgiE,cAA6B,CAGpC,EAAKM,WACH7rE,KAAKuB,IACHgI,EAAKkgE,MAAMvkC,cAAc9B,cAAc7L,QACrC,SAAChzB,EAAGqzB,GAAJ,OACE53B,KAAKuB,IACHgD,EACAkmE,GAAqB7yC,EAAEn3B,QAAQy9C,MAAM,EAAG,QAE5C,GAVU,GAYZ,MAGJ,EAAK4tB,WACH9rE,KAAKuB,IACHgI,EAAKigE,MAAMtkC,cAAc9B,cAAc7L,QACrC,SAAChzB,EAAGqzB,GAAJ,OACE53B,KAAKuB,IACHgD,EACAkmE,GAAqB7yC,EAAEn3B,QAAQy9C,MAAM,EAAG,QAE5C,GAvBU,GAyBZ,YAOZ4tB,WAvEgB,SAuEL5qC,GACT33B,EAAKwgE,QAAU7oC,GAEjB2qC,WA1EgB,SA0EL3qC,GACT33B,EAAKygE,QAAU9oC,GAEjB1kB,SA7EgB,SA6EP+/C,GACPhzD,EAAKgiE,cAAgBhP,GAEvB/4B,UAhFgB,SAgFNuoC,GACRxiE,EAAKlG,OAAS0oE,GAGhB5sC,SApFgB,SAoFPvF,GACPrwB,EAAK4b,MAAQyU,GAGf6iC,UAxFgB,WAyFdzxD,oBAAUzB,EAAM,GAAGizD,WAAWjzD,IAGhCmzD,gBA5FgB,SA4FAr5D,GACdkG,EAAKmxD,aAAer3D,GAGtB2oE,cAhGgB,WAiGdziE,EAAKkgE,MAAMwC,UACX1iE,EAAKigE,MAAMyC,WAEbC,aApGgB,WAqGd3iE,EAAKkgE,MAAM0C,SACX5iE,EAAKigE,MAAM2C,UAEbC,sBAxGgB,WAyGd,GAA+B,iBAA3B7iE,EAAKoxD,kBAAsC,CAE7C,IAAM3iD,EAAe8O,qBAAWvd,GAC1B8iE,EAAWr0D,EAAQuP,UACvB,kCACA,4BACA,CAAE5H,KAAMpW,IAGV,OADAyO,EAAQ0P,WAAW2kD,GACZA,EAET,MAAM,IAAIjoE,MAAJ,sCAC2BmF,EAAKoxD,qBAIxClxB,UAzHgB,SAyHNl6B,GAAuC,IAAtBq6B,EAAsB,uDAAJ,GACrC0iC,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAEIkX,EAAYvM,EAAcgI,aAAarX,EAAcuC,MAC3D,IAAKqZ,EACH,MAAM,IAAIriB,MAAJ,6BAAgCyG,EAAcuC,OAEtD,IAAM6U,EAAW/H,EAAc0wB,YAAYrhC,EAAK6D,MAC1C29B,EAAclgC,EAAck+B,SAAStP,MACzC,SAACxkB,GACC,QACEgN,EAAS4oB,aAAapR,MACpB,SAAAsQ,GAAW,OAAIA,EAAY/iC,OAASiO,EAAE7H,WAQ9C,IAAK29B,EACH,MAAM,IAAI3mC,MAAJ,4DACiDmF,EAAK6D,OAG9D,IAAMzC,EAAQ8b,EAAUX,WAAWiQ,OAArB,2BACT6T,GADS,IAEZx8B,KAAMvC,EAAcuC,KACpBvC,gBACAk+B,SAAU,CAAC,CAAE37B,KAAM29B,EAAY39B,KAAMvC,cAAekgC,OAEtDxhC,EAAK4+B,OAAOrmC,KAAK6I,IAGnB6+B,UAjKgB,SAiKNj6B,GACR,IAAM+8D,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAGIg9D,EAAchjE,EAAK4+B,OAAOza,QAC9B,SAAA6pB,GAAC,OAAIA,EAAE1sC,gBAAkBA,KAG3B,OADAq/B,wBAAY,kBAAMqiC,EAAYlsE,SAAQ,SAAAk3C,GAAC,OAAIhuC,EAAK4+B,OAAOgC,OAAOoN,SACvDg1B,EAAYpqE,QAGrBqqE,YAlLgB,SAkLJj9D,GAEU3M,KAAK4mC,UAAUj6B,IAGjC3M,KAAK6mC,UAAUl6B,IAGnBk9D,iBA1LgB,SA0LChsD,GACflX,EAAKkX,cAAgBqf,eAAKrf,IAE5BisD,SA7LgB,SA6LPC,GACPpjE,EAAKkgE,MAAQ3pC,eAAK6sC,EAAI,IACtBpjE,EAAKigE,MAAQ1pC,eAAK6sC,EAAI,KAGxBC,UAlMgB,SAkMNC,EAAkBC,GAAgB,MACrBC,iBAAOD,EAAQ,GAAID,EAAU,IADR,mBACnCG,EADmC,KAC7BC,EAD6B,OAErBF,iBAAOD,EAAQ,GAAID,EAAU,IAFR,mBAEnCK,EAFmC,KAE7BC,EAF6B,KAG1C,OAAOntE,KAAKshD,IAAI2rB,EAAOD,GAAQ,GAAKhtE,KAAKshD,IAAI6rB,EAAOD,GAAQ,EACxD,CACE3jE,EAAKkgE,MAAMzK,OAAOgO,GAClBzjE,EAAKkgE,MAAMzK,OAAOiO,GAClB1jE,EAAKigE,MAAMxK,OAAOz1D,EAAKsgE,WAAaqD,GACpC3jE,EAAKigE,MAAMxK,OAAOz1D,EAAKsgE,WAAasD,SAEtCnqE,GAGNmpE,OA/MgB,SA+MTU,EAAkBC,GACvB,IAAM9nE,EAASpC,KAAKgqE,UAAUC,EAAWC,GACzC,GAAI9nE,EAAQ,mBACeA,EADf,GACH65D,EADG,KACCC,EADD,KACKI,EADL,KACSC,EADT,KAEV51D,EAAKkgE,MAAMjlB,OAAOqa,EAAIC,GACtBv1D,EAAKigE,MAAMhlB,OAAO2a,EAAID,KAG1BkO,cAvNgB,SAuNFP,EAAkBC,GAC9B,IAAM9nE,EAASpC,KAAKgqE,UAAUC,EAAWC,GACzC,GAAI9nE,EAAQ,mBACeA,EADf,GACH65D,EADG,KACCC,EADD,KACKI,EADL,KACSC,EADT,KAEJnnD,EAAU8O,qBAAWvd,GAErB8jE,EAAK3C,GAAc30C,OAAd,2BACNnJ,sBAAYrjB,EAAKkgE,QADX,IAET/pE,kBAAmB,EACnBC,wBAAyB,KAErB2tE,EAAK5C,GAAc30C,OAAd,2BACNnJ,sBAAYrjB,EAAKigE,QADX,IAET9pE,kBAAmB,EACnBC,wBAAyB,KAE3B0tE,EAAGE,iBAAiBhkE,EAAKkgE,MAAMrqE,OAC/BkuE,EAAGC,iBAAiBhkE,EAAKigE,MAAMpqE,OAC/BiuE,EAAG7oB,OAAOqa,EAAIC,GACdwO,EAAG9oB,OAAO2a,EAAID,GACdmO,EAAGG,OAAOH,EAAG5tE,SAAW8J,EAAKnK,MAAQmK,EAAKkgE,MAAMrqE,OAAQ,GACxDkuE,EAAGE,OAAOF,EAAG7tE,SAAW8J,EAAKnK,MAAQmK,EAAKigE,MAAMpqE,OAAQ,GAKxD,IAAM+oC,EAOA,GACN5+B,EAAK4+B,OAAO9nC,SAAQ,SAAAsK,GAClB,IAAMC,EAAYD,EAAME,cAClBkgC,EAAcngC,EAAUm+B,SAAStP,MACrC,SAAClf,GAAD,MACmB,yBAAjBA,EAAQnN,QAER29B,GACF5C,EAAOrmC,KAAK,CACVsL,KAAMxC,EAAUwC,KAChBvC,cAAeD,EACfm+B,SAAU,CACR,CAAE37B,KAAM29B,EAAY39B,KAAMvC,cAAekgC,SAKjD,IAAM0iC,EAAe,CACnBrgE,KAAM,oBACNyU,MAAO,CAAC,yBAEJzU,KAAM,oBACHwf,sBAAYygD,IAHZ,IAIHllC,OAAQ,GACRm6B,YAAY,IALT,yBAQHl1D,KAAM,oBACHwf,sBAAY0gD,IATZ,IAUHnlC,OAAQ,GACRm6B,YAAY,KAGhBn6B,UAGFnwB,EAAQuvB,QAAQ,oBAAqBkmC,SAI1C5rD,OAAM,SAAAtY,GAAI,MAAK,CACd,gBACE,IAAMyO,EAAU8O,qBAAWvd,GAC3B,OAAIwd,oCAA0B/O,GACrB,CACL,CACE8X,MAAO,sBACP/V,QAASxQ,EAAK6iE,wBAIb,S,ICxbT36B,GAAei8B,GAAfj8B,WAUak8B,G,0MACnB,WAAoB55D,GAApB,yCAAAxP,EAAA,+DAOMwP,EALFqO,sBAAuBo6B,OAF3B,MAEmC,EAFnC,EAGIp9C,EAIE2U,EAJF3U,MACAiE,EAGE0Q,EAHF1Q,OACA2C,EAEE+N,EAFF/N,OACA6b,EACE9N,EADF8N,MAGIW,EAAS85B,aAAat8C,KAAKC,KAAKb,EAAQo9C,GAAQn5C,EAASm5C,GACzDD,EAAM/5B,EAAOE,WAAW,MACxB2iC,EAAYh/C,yBAAeL,EAAQ,aACzCu2C,EAAI8I,UAAYA,EAChB9I,EAAIC,MAAMA,EAAOA,GACjBD,EAAIz5B,UAAYzc,yBAAeL,EAAQ,SAdzC,cAeyB6b,EAfzB,GAeS4nD,EAfT,KAegBD,EAfhB,KAgBQoE,EAAMnE,EAAMvkC,cAAc9B,cAAc,GAAG7jC,SAC3CsuE,EAAMrE,EAAMtkC,cAAc9B,cAAc,GAAG7jC,UAC/CkqE,EAAMhgD,UAAY,IAAIppB,SAAQ,SAAAikB,GAC9B,IAAM3jB,EAAQ2jB,EAAQvhB,IAAI,SACpBlC,EAAMyjB,EAAQvhB,IAAI,OAClBtC,EAAU6jB,EAAQvhB,IAAI,WACtB4lB,EAAOrE,EAAQvhB,IAAI,QACnB+qE,EAAUnlD,EAAKloB,QAGfiS,EAAQrM,yBAAeL,EAAQ,QAAS,CAAEse,YAChDi4B,EAAIz5B,UAAYpQ,EAChB6pC,EAAI15B,YAAcnQ,EAClB,IAAMq7D,EAAMtE,EAAMxM,OAAO,CAAEx8D,UAAS2/C,MAAOz/C,IACrCqtE,EAAMvE,EAAMxM,OAAO,CAAEx8D,UAAS2/C,MAAOv/C,IACrCotE,EAAMzE,EAAMvM,OAAO,CAAEx8D,QAASqtE,EAAS1tB,MAAOz3B,EAAKhoB,QACnDutE,EAAM1E,EAAMvM,OAAO,CAAEx8D,QAASqtE,EAAS1tB,MAAOz3B,EAAK9nB,MACzD,QACUmC,IAAR+qE,QACQ/qE,IAARgrE,QACQhrE,IAARirE,QACQjrE,IAARkrE,EACA,CACA,IAAMC,EAAKJ,EAAMH,EACXQ,EAAKJ,EAAMJ,EACXS,EAAKJ,EAAMJ,EACXS,EAAKJ,EAAML,EACjB,GAAI7tE,KAAKshD,IAAI6sB,EAAKC,GAAM,GAAKpuE,KAAKshD,IAAI+sB,EAAKC,GAAM,EAC/C/xB,EAAIoD,SACFwuB,EAAK9oB,EAAY,EACjBhiD,EAASgrE,EAAKhpB,EAAY,EAC1BA,EACAA,OAEG,CACL,IAAIkpB,EAAQJ,EACRK,EAAQH,EACNj9B,EAAQ9sB,EAAQvhB,IAAI,OAASuhB,EAAQvhB,IAAI,SAC/C,GAAIquC,EAAO,CACT,IAAMI,EAAWC,GAAWL,GAC5BmL,EAAIgJ,YACJ,IAAK,IAAI3vB,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMjV,GAAO6wB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GAElB64C,EAAQF,EACRG,EAAQF,EAEH,MAAPhc,GAAqB,MAAPA,GAAqB,MAAPA,GAC9B+b,GAAS5tD,EAAM8oD,EAAMhqE,QACrB+uE,GAAS7tD,EAAM6oD,EAAM/pE,SACL,MAAP+yD,GAAqB,MAAPA,EACvB+b,GAAS5tD,EAAM8oD,EAAMhqE,QACL,MAAP+yD,IACTgc,GAAS7tD,EAAM6oD,EAAM/pE,SAEvB88C,EAAIiI,OAAOiqB,EAAOprE,EAASqrE,GAC3BnyB,EAAIkI,OAAO8pB,EAAOlrE,EAASmrE,GAE7BjyB,EAAIlzB,cAEJkzB,EAAIgJ,YACJhJ,EAAIiI,OAAO2pB,EAAI9qE,EAASgrE,GACxB9xB,EAAIkI,OAAO2pB,EAAI/qE,EAASirE,GACxB/xB,EAAIlzB,eAIRqW,QAAQU,KAAR,qBACgB3/B,EADhB,YAC2BE,EAD3B,YACoCE,EADpC,YAC2CitE,EAD3C,YACsDnlD,EAAKhoB,MAD3D,YACoEgoB,EAAK9nB,IADzE,+CACmHktE,EADnH,YAC0HC,EAD1H,YACiIC,EADjI,YACwIC,OArF9I,kBAyFSrxB,aAAkBr6B,IAzF3B,4C,kHA4FA,WAAa/W,GAAb,sCAAAlH,EAAA,6DAEInF,EAGEqM,EAHFrM,MACAiE,EAEEoI,EAFFpI,OAHJ,EAKMoI,EADFkU,KAAQ8pD,EAJZ,EAIYA,MAAOD,EAJnB,EAImBA,MAEXmF,EAAa,CAACvvE,EAAOiE,GACrBurE,EAAgB,CAACnF,EAAOD,GAAO7hE,KAAI,SAAC2C,EAAMywD,GAC9C,IAAMp7C,EAAO+qD,GAAc30C,OAAOzrB,GAElC,OADAqV,EAAK4tD,iBAAiBoB,EAAW5T,IAC1Bp7C,KAVX,SAYQuX,QAAQC,IACZy3C,EAAcjnE,IAAd,uCAAkB,WAAMgY,GAAN,SAAApb,EAAA,kEAChBob,EADgB,SAER,EAAK4W,YAAL,2BACD9qB,GADC,IAEJme,QAASjK,EAAKulB,cAAc9B,iBAJhB,wBACXyrC,YADW,2DAAlB,wDAbJ,uBAsB0BjsE,KAAKo0D,cAAL,2BACnBvrD,GADmB,IAEtBoW,MAAO+sD,KAxBX,cAsBQvsD,EAtBR,4GA4BO5W,GA5BP,IA6BIpI,SACAjE,QACAijB,eA/BJ,eA2BQ46B,EA3BR,oDAmCOA,GAnCP,IAoCI56B,YACAhf,SACAjE,QACAglB,QAASwqD,EAAc,GAAG1pC,cAAc/kC,OAAO,GAAGZ,SAClD8kB,QAASuqD,EAAc,GAAG1pC,cAAc/kC,OAAO,GAAGZ,YAxCtD,iD,4DA7F2CuvE,I,mDCMxB//D,G,kDAcnB,WAAmB/I,GAAyC,2BAC1D,cAAMA,IAdA+oE,MAAQ,IAAIC,KAAsB,CACxCD,MAAO,IAAIE,KAAS,CAAEC,QAAS,IAC/Bl6D,KAAM,SAAC1R,EAAmB6D,GACxB,OAAO,EAAKV,MAAL,2BAAgBnD,GAAhB,IAAsB6D,eAU2B,EANpDsZ,mBAMoD,IAJpDpS,iBAIoD,EAE1D,IAAMA,EAAchI,yBAAeL,EAAQ,eACrCya,EAAgBpa,yBAAeL,EAAQ,iBAHa,OAI1D,EAAKqI,YAAcjI,wBAAaiI,GAChC,EAAKoS,cAAgBA,EALqC,E,gFAQ5D,WAAYna,GAAZ,iBAAA/B,EAAA,sEACsB3B,KAAKyL,YAAY+9B,SAAjB,aAClBkB,SAAU,QACPhnC,IAHP,cACQqe,EADR,OAKQwqD,EAA0B,GAChCxqD,EAAKqtB,MAAM,MAAM3xC,SAAQ,SAAC+uE,EAAc7iE,GACtC,GAAI6iE,EAAKjtE,OAAQ,OAeXitE,EAAKp9B,MAAM,MAfA,kBAEbq9B,EAFa,KAIbC,GAJa,WAKbC,EALa,KAMb1nC,EANa,KAObnf,EAPa,KASb8mD,GATa,WAUb1O,EAVa,KAWb2O,EAXa,KAYbC,EAZa,MAabC,EAba,MAcVC,EAdU,YAiBTrlE,EAAO5D,OAAOkpE,YAClBD,EAAOjoE,KAAI,SAAA2nC,GACT,IAAMpkB,EAAIokB,EAAMwgC,QAAQ,KAGxB,MAAO,CAFWxgC,EAAM4O,MAAM,EAAGhzB,GACdokB,EAAM4O,MAAMhzB,EAAI,QAKvCikD,EAAW5iE,GAAS,CAClBwjE,QAAS,CACP,CAAEtvE,QAAS4uE,EAAM1uE,OAAQ2uE,EAAQzuE,KAAM0uE,GACvC,CAAE9uE,QAASioB,EAAM/nB,OAAQ6uE,EAAQ3uE,KAAMigE,IAEzC3hE,MAAO,aACLswE,YAAaA,EACbC,UAAWA,EACX7nC,SACA8nC,aAAcA,GACXplE,QA3Cb,kBAgDS4kE,GAhDT,gD,6HAmDA,sBAAA5qE,EAAA,gFAIS,GAJT,2C,sHAOA,sBAAAA,EAAA,+EAES,IAFT,2C,+EAKA,SAAYjE,GAAwC,WAAxBgG,EAAwB,uDAAJ,GAC9C,OAAOe,4BAAgB,uCAAU,WAAMC,GAAN,iCAAA/C,EAAA,sEACN,EAAKwqE,MAAMhsE,IAAI,aAAcuD,EAAMA,EAAKa,QADlC,OAM/B,GALMgoE,EADyB,QAMhB,KADT5iE,EAAQ,EAAKkU,cAAcqvD,QAAQxvE,EAAOE,eAE9C,IAASo1B,EAAI,EAAGA,EAAIu5C,EAAWhtE,OAAQyzB,IAAK,EACfu5C,EAAWv5C,GAA9Bz2B,EADkC,EAClCA,MAAO4wE,EAD2B,EAC3BA,QAD2B,EAEVA,EAAQxjE,GAAhC5L,EAFkC,EAElCA,MAAOE,EAF2B,EAE3BA,IAAKJ,EAFsB,EAEtBA,QAChBsvE,EAAQxjE,GAAO9L,UAAYH,EAAOG,SAChCu1D,aAAe11D,EAAOK,MAAOL,EAAOO,IAAKF,EAAOE,IAClDyG,EAAS+oC,KACP,IAAIxoC,IAAJ,aACE6/B,SAAU,OAAF,OAAS9R,GACjBj1B,QACAE,MACAJ,UACAuvE,UAAWp6C,EACXjN,KAAM,CACJhoB,MAAOovE,IAAUxjE,GAAO5L,MACxBE,IAAKkvE,IAAUxjE,GAAO1L,IACtBJ,QAASsvE,IAAUxjE,GAAO9L,UAEzBtB,KAQfmI,EAASovB,WAhCsB,2CAAV,yD,2BAoCzB,gB,GA1HsC3uB,0BAAnBgH,GAYL/G,aAAe,CAAC,cAAe,eCxChCud,qCACb,aACA,CACE9E,cAAe,CACbrT,KAAM,cACNgd,aAAc,IAEhB/b,YAAa,CACXjB,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,uBAGzB,CAAE6b,iBAAiB,ICaAoqD,G,4MACnBjpE,KAAO,oB,+FAEP,WAAyBgc,EAAkBuyB,GAA3C,yBAAAhxC,EAAA,2DACQ+7B,EADR,UAC0B19B,KAAKsX,cAAc8S,iBAD7C,iBAC0B,EAA8BhV,eADxD,aAC0B,EACpBsoB,iBAFN,gCAIY4V,gCAAsB5V,EAAiBtd,GAJnD,8CAKMA,EALN,UAGQmzB,EAHR,KAO6B,wBAAvBZ,EAPN,0CAQWY,GARX,WAWUvW,EAAiB5c,EAAjB4c,cAEF+I,EAAe/lC,KAAKsX,cAAc0uB,gBAAgBhJ,cAE1BkvC,GAfhC,uBAgBU,IAAI1qE,MACR,+EAjBN,iCAqBSukC,EAAa0N,sBAAsBF,IArB5C,iD,qHAwBA,WACEnzB,EACAuyB,GAFF,mCAAAhxC,EAAA,yDAIMkxC,EAAmBzyB,EACI,wBAAvBuyB,EALN,gCAM6B3yC,KAAK4yC,qBAC5BxyB,EACAuyB,GARN,OAMIE,EANJ,iBAWUxuB,GAXV,EAW6DwuB,GAAnDxuB,UAAWE,EAXrB,EAWqBA,cAAeyY,EAXpC,EAWoCA,aAAcz4B,EAXlD,EAWkDA,OAC3C8f,EAZP,sBAaU,IAAI7iB,MAAM,iCAbpB,cAgBEkyB,2BAAiBnvB,GAhBnB,UAkBgCutC,EAC5B9xC,KAAKsX,cACL+M,EACAE,GArBJ,qBAkBU0oB,EAlBV,EAkBUA,uBAKqB9nC,yBAvB/B,uBAwBU,IAAI3D,MAAJ,oEACyDyrC,IAzBnE,WA6BQlH,EAAe/lC,KAAKsX,cAAc0uB,gBAAgBhJ,GA7B1D,uBAgCU,IAAIx7B,MAAJ,oBAAuBw7B,EAAvB,gBAhCV,WAkCO+I,EAAa1uB,eAlCpB,uBAmCU,IAAI7V,MAAJ,mBACQw7B,EADR,qEAnCV,WAwCQ+I,aAAwBmmC,GAxChC,uBAyCU,IAAI1qE,MACR,+EA1CN,WA8CQy7B,EA9CR,2BA+CO4V,GA/CP,IAgDI5F,gBAIuB,wBAAvB0F,EApDJ,kCAqDc5M,EAAa2N,OAAOzW,GArDlC,6DAsDc8I,EAAa4N,eAAe1W,GAtD1C,mCAmDQ76B,EAnDR,KAuDEsxB,2BAAiBnvB,GAvDnB,kBAwDSnC,GAxDT,iD,+HA2DA,WACEovC,EACApxB,EACAuyB,GAHF,iBAAAhxC,EAAA,yDAK6B,wBAAvBgxC,EALN,yCAMWnB,GANX,UASUxU,EAAiB5c,EAAjB4c,aACF+I,EAAe/lC,KAAKsX,cAAc0uB,gBAAgBhJ,GAV1D,sBAYU,IAAIx7B,MAAJ,oBAAuBw7B,EAAvB,gBAZV,UAcO+I,EAAa1uB,eAdpB,sBAeU,IAAI7V,MAAJ,mBACQw7B,EADR,qEAfV,UAmBQ+I,aAAwBmmC,GAnBhC,uBAoBU,IAAI1qE,MACR,+EArBN,iCAwBSukC,EAAa6N,2BAClBpC,EACApxB,IA1BJ,iD,gEAtF6C+wB,GCWvCtC,GAAei8B,GAAfj8B,WAmCR,SAASy+B,GAAU9+B,GAGjB,IAFA,IAAMI,EAAWC,GAAWL,GACxBjvC,EAAS,EACJyzB,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,IAChBrwD,GAAUyvD,GAGd,OAAOzvD,EAGT,SAASguE,GAAsB/+B,GAG7B,IAFA,IAAMI,EAAWC,GAAWL,GACxBjvC,EAAS,EACJyzB,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,GAAqB,MAAPA,GAAqB,MAAPA,IAC5CrwD,GAAUyvD,GAGd,OAAOzvD,E,IAiBYiuE,G,4MACnBppE,KAAO,gB,6CAEP,SAAQkT,GACNA,EAAcgtB,aAAY,WACxB,OAAO,IAAI3S,IAAS,CAClBvtB,KAAM,cACN8e,WAAY0E,GAAkBtQ,GAC9BD,eAAgBkS,gBACd,kBAAM,wCAKZjS,EAAcuR,gBAAe,WAC3B,IAAM/F,ETvGL,SAA6BxL,GAClC,OAAOqL,8BACL,iBACA,CACEI,SAAUxd,QAAMC,SACd8R,EAAc2sB,0BAA0B,YACxC,CAAEz5B,KAAM,qBAGZ,CAAE4tB,mBAAoB,YAAanV,iBAAiB,IS8F7BwqD,CAAkCn2D,GACvD,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,iBACN0e,eACAI,WAAYwqD,GAAgC5qD,GAC5Ce,UAAW,eACXxE,SAAU,cACVhI,eAAgBs2D,QAIpBr2D,EAAciR,iBACZ,kBACE,IAAIwiD,GAAgB,CAClB3mE,KAAM,kBACN0e,aAAc8qD,GACdv2D,eAAgBw2D,GAChBv2D,qBAINA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,aACN0e,aAAcgrD,GACdx9B,aAAcnkC,QAKpBmL,EAAc08B,cAAa,kBAAM,IAAIq5B,GAAkB/1D,Q,uBAGzD,SAAUA,GACJktB,gCAAsBltB,EAAc8S,YACtC9S,EAAc8S,UAAUqa,gBAAgB,CAAC,OAAQ,OAAQ,CACvDvX,MAAO,eACP1W,KAAMu3D,KACN52D,QAAS,SAAC/B,GACRA,EAAQuvB,QAAQ,cAAe,OAKrC,IAAMyU,EAAK,SACT13B,EACA/J,GACG,IACKimB,EAAgBjmB,EAAhBimB,YACR,OAAOlc,EACH,CACE,CACEwL,MAAO,yBACP1W,KAAMw3D,KACN72D,QAAS,WACP,IAAM/B,EAAU8O,qBAAWvM,GACrBs2D,EAAUvsD,EAAQvhB,IAAI,WACtBquC,EAAQ9sB,EAAQvhB,IAAI,SACpBsvD,EAAQ/tC,EAAQvhB,IAAI,SACpB+tE,GACHxsD,EAAQvhB,IAAI,QACTuhB,EAAQvhB,IAAI,QAAQ+tE,GACpBxsD,EAAQvhB,IAAI,QAAU,GACtB8nD,EAAWvmC,EAAQvhB,IAAI,QACvBguE,EAAe,GAAH,OAAMlmB,EAAN,aAVL,EAWWzjC,kBAAQoZ,EAAa,iBAAtCwwC,EAXM,oBAYPvwD,EAAgB,CAACuwD,EAAeD,GAChCxhE,EAAU,SAAH,OAAYrD,KAAKC,OACxB8C,EAAY,GAAH,OAAM47C,EAAN,eAAqBmmB,GAC9BC,EAA0BH,EAAG9+B,MAAM,KACtCtkB,QAAO,SAAAwjD,GAAG,QAAMA,KAChBvpE,KAAI,SAACupE,EAAK3kE,GAAU,MACyB2kE,EAAIl/B,MAAM,KADnC,mBACZm/B,EADY,KACLC,EADK,KACIC,EADJ,KACcC,EADd,KAEbC,EA9I1B,SAAwBngC,GAGtB,IAFA,IAAMI,EAAWC,GAAWL,GACxBogC,EAAc,EACT57C,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,GAAqB,MAAPA,IAC9Bgf,GAAe5f,GAGnB,OAAO4f,EAoIiCC,CAAeH,GAC/BI,EAAWxB,GAAUoB,GACrBK,EAAuBxB,GAAsBmB,GAC7CM,EAAkC,MAAbP,GAAoB,EAAI,EAC7CQ,EA3G1B,SAAiBzgC,EAAevJ,GAC9B,OAAmB,IAAZA,IACDuJ,EAAM0gC,MAAM,eAAiB,IAAI,IAAM,IACvC1gC,EAAM0gC,MAAM,iBAAmB,IAAI,IAAM,EAwGXC,CAAQT,EAASM,GAC7BI,GAAeZ,EAAU,EAC/B,MAAO,CACL3wE,QAAS0wE,EACTxwE,MAAOqxE,EACPnxE,IAAKmxE,EAAcT,EACnBU,UAAWP,EACXb,QAASgB,EACTK,MAAOZ,EACP9wE,aAAcwwE,EACdnpC,OAAQ+pC,EACRlqC,SAAU,GAAF,OAAKpjB,EAAQphB,KAAb,cAAuBqJ,GAC/Boc,KAAM,CACJhoB,MAAOkxE,EACPhxE,IAAKgxE,EAAYF,EACjBlxE,QAASoqD,OAKX5Z,EAAO3sB,EAAQzgB,SACrBotC,EAAKtoB,KAAO,CACVloB,QAASoqD,EACTlqD,MAAOkwE,EACPhwE,IAAKgwE,EAAUV,GAAsB/+B,IAOvC,IAAM+gC,EAAcjC,GACV,KAAR7d,EAAe4e,EAAwB,GAAGiB,MAAQ9gC,GAG9C3nB,EAAW,CACfwnB,GADY,mBAETggC,IAGLxnD,EAASysC,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAEssE,QAAUj5C,EAAEi5C,WAEtC,IAAMuB,EAAY3oD,EAAS8N,QACzB,SAAChzB,EAAGqB,GAAJ,OAAUrB,EAAIqB,EAAE/E,IAAM+E,EAAEjF,QACxB,GAGFqX,EAAQuvB,QAAQ,cAAe,CAC7Bn6B,KAAM,cACNq8D,MAAO,CACLlqE,SAAU,EACVE,QAAS2yE,EAAY,IACrB1yE,kBAAmB,EACnBC,wBAAyB,EACzBH,iBAAkBiqB,EAAS9hB,KAAI,SAAA/B,GAC7B,MAAO,CACLjF,MAAOiF,EAAEjF,MACTE,IAAK+E,EAAE/E,IACPJ,QAASmF,EAAEnF,QACXD,aAAcwwE,OAIpBxH,MAAO,CACLjqE,SAAU,EACVE,QAAS0yE,EAAc,IACvBzyE,kBAAmB,EACnBC,wBAAyB,EACzBH,iBAAkB,CAChB,CACEgB,aAAcuwE,EACdpwE,MAAO,EACPE,IAAKsxE,EACL1xE,QAASoqD,KAIfwgB,iBAAkB,CAChB,CACEj+D,KAAM,eACNqT,gBACAyqB,QAAS,CACP99B,KAAM,oBACNqc,YAEFla,UACAvI,KAAMiI,IAGVq8D,oBAAqB,CACnB,CACEtkE,KAAM+pE,EACNsB,SAAU,CACRjlE,KAAM,yBACNmC,QAAS,GAAF,OAAKs7C,EAAL,YAAiB3+C,KAAKC,OAC7B++B,QAAS,CACP99B,KAAM,4BACNqc,SAAU,CAACnF,EAAQzgB,cAK3B4c,gBACA0nB,OAAQ,CACN,CACEt9B,cAAe0E,EACfnC,KAAM,eACN27B,SAAU,CACR,CACE37B,KAAM,iBACNvC,cAAe,GAAF,OAAK0E,EAAL,uBAKrBiR,YAAa,GAAF,OAAKqqC,EAAL,eAAoBmmB,QAKvC,IAEN,SAASsB,EAAe3yD,GACJ,qBAAdA,EAAKvS,MACPuS,EAAKwoB,OAAO9nC,SAAQ,SAAAsK,GACC,oBAAfA,EAAMyC,MACRzC,EAAMo+B,SAAS1oC,SAAQ,SAAAka,GAEF,wBAAjBA,EAAQnN,MACPmN,EAAQgnB,mCAAmCzT,SAASkuB,GAIpC,4BAAjBzhC,EAAQnN,MACRmN,EAAQutC,gBACPvtC,EAAQutC,cAAcvmB,mCAAmCzT,SACxDkuB,IAGFzhC,EAAQutC,cAAczjB,qCAAqC2X,GAR3DzhC,EAAQ8pB,qCAAqC2X,SAezD9Y,oBAAQ,WAAM,MACNlrB,EAAO,UAAGkC,EAAc8S,iBAAjB,aAAG,EAAyBhV,QACrCA,GACFA,EAAQ6J,MAAMxhB,SAAQ,SAAAsf,GAChBA,EAAKkC,MACPlC,EAAKkC,MAAMxhB,SAAQ,SAAA04B,GAAC,OAAIu5C,EAAev5C,MAEvCu5C,EAAe3yD,a,GAtPgByM,KC/F5B,gBAAA1G,GACb,OAAO,8CAGL,cACS,CACLtY,KAAMjF,gBADD,0BAEL0C,cAAe2a,iCAFV,GAGL+sD,gBAAiB,iBAAepqE,cAAYA,QAA3B,SAA0C,uBAC3D9E,OAJK,IAKLmvE,qBALK,GAMLC,iBANK,EAOLC,UAAWvqE,YAAUA,YAAUA,QAP1B,YADT,OAUS,SAAAoB,GAAI,MAAK,CACd,kBACE,IAAM2mC,EA7BhB,SAAqBlqB,GACnB,IADiC,EAC3BkqB,EAAN,GACQwiC,EAAc1sD,EAFW,yBAGV0sD,EAHU,YAGjC,2BAAyC,OAA9BC,EAA8B,uBACnBD,SADmB,YACvC,2BAAoD,KAAzC7sE,EAAyC,QAC9C6sE,aAAJ,IACExiC,gEAHmC,gCAHR,8BAUjC,SAmBwB0iC,CAAhB,GACA,8CACKrnE,+BADL,IAEK3I,KAFL,yBAGEmjB,cAAexc,EAHjB,cAIEyc,aAJF,EAKEhgB,OAAQuD,gBALV,SAME2mC,aAGJ,yBACE,OAAO3mC,SAAcA,EAAdA,iBAAsCA,EAA7C,sBAEF,8BACE,OAAOvJ,SAASuJ,EAATvJ,wBAAP,KAEF,8BACE,OAAOA,SAASuJ,SAATvJ,GAAP,IAEF,uBACE,OAAOuJ,yBAAP,UAhCN,SAmCW,SAAAA,GAAI,MAAK,CAChBspE,wBADgB,YAWd,OATI9G,EAAYxiE,EAAhB,wBACMwiE,EAAYxiE,EAAhB,wBACEA,yBAEAA,uBAA4BA,EAA5BA,wBAGFA,uBAA4BA,EAA5BA,wBAEKA,EAAP,sBAEFupE,qBAbgB,YAkBd,OAJkBvpE,EAAlB,qBACkBA,0BAChBA,uBADF,IAKFwpE,aApBgB,gBAqBTxpE,gBAAL,IACEA,sBAEaA,gBAAf,GACAjE,IAAWwkB,OAAXxkB,c,+FCpEJ0tE,GAAS,SAAA9+D,GAAK,MAAK,CACvBrB,KAAM,CACJE,WAAYmB,qBADR,QAEJuK,SAFI,OAGJpL,WAHI,EAIJC,cAAeY,UAJX,GAKJP,YAAaO,UALT,GAMJ6K,aAAc7K,UANV,GAOJqG,QAPI,OAQJ04D,SAAU,QAEZvsE,OAAQ,CACNtH,MAAO,QAETkhB,MAAO,KAmBT,IAAM4yD,GAAkB,OAAAC,GAAA,OACtB7rE,qBAAS,gBAAGqrE,EAAH,WAAa3zE,EAAb,QAAoBuX,EAApB,UAA6BjR,EAA7B,gBACP,wBAAa2X,UAAb,WAAkCpH,UAAWU,EAAQ68D,aACnD,wBAAWn2D,UAAU,UADvB,GAEE,wBAAWo2D,KAAG,GACV/tE,EAAD,OAKCA,EAAA,KAAW,SAAAO,GAAK,OACd,wBACEjE,IAAG,wBADL,GAEE0xE,QACE,wBACE7sC,UAEIznC,oBACAA,uBAAkC8qB,OAJxC,KAOEpQ,SAAU,SAAA4P,GAAG,OACXtqB,mBAAoCsqB,SADzB,YAKjBwG,MAAOjqB,OApBX,wBAAgBkP,MAAO,CAAE0X,YAAa,QADvC,4BA8BTymD,aAA4B,CAC1BP,SAAUY,YADgB,WAE1Bv0E,MAAOgK,sCAFmB,WAG1B1D,OAAQiuE,aAAuBA,KAAvBA,QAA8C1qE,Y,IAGlD2qE,G,kDACJ,cAAmB,2BACjB,kBACA,MAAa,CAAEC,eAAgB,IAFd,IAGTz0E,EAAU+U,EAHD,aAIjB,kBAAuB2/D,qBACrB,WACE,IAAMC,EAAN,GASA,OARAvsD,kBAAQpoB,EAARooB,6BAA2C,SAAAurD,GACpCgB,EAAL,KACEA,SAjEZ,SAAuB30E,EAAO2zE,GAAU,MAC9BlpD,EAAwBzqB,EADM,SACpB0zE,EAAc1zE,EADM,UAEhCsG,EAAS,IAAf,IAFsC,eAGhBmkB,EAHgB,cAGtC,2BAAyC,KAA9BnF,EAA8B,QACvChf,MAAWgf,MAAXhf,KAJoC,8BAMtC,GAAIotE,MAAJ,GAA6B,sBACPA,SADO,YAC3B,2BAAoD,KAAzC7sE,EAAyC,QAClDP,UAFyB,+BAK7B,OAAOuU,WAAWvU,EAAXuU,UAAP,OAwDQ+5D,CAAc50E,EAAd40E,YAAuC,SAAA/tE,GACrC8tE,iBAGJ,KAEF,SAAAA,GACE,YAAc,SAAAl4C,GACZ,IAAMg4C,EAAN,GAOA,OANA9sE,wBAAuC,SAAAgsE,GACrCc,gCACMh4C,qBADNg4C,IAEKE,EAFLF,OAKK,CAAEA,uBAGb,CAAE30C,MAAO,MA7BM,E,wDAiCnB,WACEl8B,KAAA,oB,oBAGF,WAAS,MAC2BA,KAD3B,MACC2T,EADD,UACUxB,EADV,QACiB/V,EADjB,QAECy0E,EAAmB7wE,KAFpB,qBAGP,OACE,yBAAKmS,MAAL,EAAmBc,UAAWU,EAAQ1D,MACpC,yBAAKgD,UAAWU,EAAQ7P,QACtB,wBACEmP,UAAWU,EADb,MAEEvU,QAFF,YAGE6xE,cAAY,GALlB,YAUGltE,OAAA,oBAEM,SAAAgsE,GAAQ,OACX,sBACE/wE,IADF,EAEE+wE,SAFF,EAGE3zE,MAHF,EAIEsG,OAAQqB,YAAY8sE,EAAZ9sE,qB,GA3DOmtE,aA4E7BN,gBAA8B,CAAEz+D,MAAO,IAExBo+D,wBAAmB7rE,oBAAlC,KC/JM8N,GAAYC,cAAW,SAAAnB,GAAK,MAAK,CACrCqG,QAAS,CACPxH,WADO,QAEP1P,OAFO,OAGPob,SAAU,UAEZs1D,aAAc,CACZv8D,UADY,OAEZw8D,UAAW,UAEbC,eAAgB,CACdlhE,WAAYmB,qBAAyByD,aAkC1BrQ,4BA9Bf,SAAgCyM,GAAO,IAC7B/U,EAAU+U,EADmB,MAE/BwC,EAAUnB,KACR8+D,EAA+Dl1E,EAHlC,mBAGTwzE,EAA2CxzE,EAHlC,qBAGayzE,EAAqBzzE,EAHlC,iBAIrC,OACE,yBAAK6W,UAAWU,EAAQgE,SACtB,yBACE1E,UAAWU,EADb,aAEExB,MAAO,CAAE1R,OAAQ6wE,IAEjB,uBALJ,IAOE,mCACEp+D,OAAQ9W,EADV,qBAEE+V,MAAO,CACL1R,OADK,EAEL0P,WAFK,OAGLuoB,UAHK,aAIL64C,UAAW,uBAGf,oCAAgBp/D,MAAO,CAAE1R,OAAQmvE,IAjBrC,Q,mNChBAxrE,KAAO,uB,6CAEP,SAAQkT,GACNA,EAAcuR,gBAAe,WAC3B,IAAM/F,ECRL,YACL,OAAOH,8BAAoB,yBAEzB,CACE6uD,iBAAkB,CAChBhnE,KADgB,cAEhBgd,aAAc,CAFE,QAGhB/a,YAAa,oDAGjB,CACEuW,kBAAmB8F,aADrB,GAEE7F,iBAAiB,IDJIwuD,CACnBn6D,GAEF,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,yBACN0e,eACAI,WAAYwuD,GAAmC5uD,GAC/Ce,UAAW,iBACXxE,SAAU,mBACVhI,eAAgBs6D,Y,GAdKnoD,KENd7G,iCACb,mBACA,CACE9X,cAAe,CACbL,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,uBAEvBuC,MAAOgZ,8BAAoB,iBAAkB,CAC3CjY,UAAW,CACTtO,MAAOmJ,QAAMwiB,YAAY,YAAa,CAAC,MAAO,QAC9Cvd,KAAM,aACNgd,aAAc,OAEhBne,SAAU,CACRmB,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,6BAGzBwqE,eAAgB,CACdpnE,KAAM,cACNgd,aAAc,CAAC,aAAc,YAGjC,CAAEvE,iBAAiB,I,+MCpBnB7e,KAAO,kB,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,mBACN0e,aAAc+uD,GACdzpD,gBAAiB,kBACf,4EAA8CC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,qB,GAVzCyU,KCHd7G,iCACb,gBACA,CACErX,gBAAiB,CACfd,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,wCAEvB8sB,SAAU,CACR1pB,KAAM,cACNgd,aAAc,GACd/a,YAAa,0DAGjB,CAAEwW,iBAAiB,ICZNN,iCACb,qBACA,CACEmvD,gBAAiB,CACftnE,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,mCACrBqF,YACE,sGAEJoR,cAAe,CACbpR,YACE,2EACFjC,KAAM,cACNgd,aAAc,KAGlB,CAAExE,kBAAmBi9C,0B,sDCfhB,SAAS8R,GAAQx6C,GACtB,OAAOA,GAAOA,EAAIrK,OAA8B,kBAAdqK,EAAIrK,MAajC,SAAS8kD,GAAWrwE,EAAQqzB,GACjC,cAAmBjxB,OAAOlB,KAAKmyB,GAA/B,eAAmC,CAA9B,IAAMi9C,EAAI,KAEXA,KAAQtwE,GACW,kBAAZqzB,EAAEi9C,IACU,kBAAZtwE,EAAEswE,GAETD,GAAWrwE,EAAEswE,GAAOj9C,EAAEi9C,IAEH,qBAAZtwE,EAAEswE,IACU,qBAAZj9C,EAAEi9C,KAETtwE,EAAEswE,GAAQj9C,EAAEi9C,IAGhB,OAAOtwE,EA2CF,SAASuwE,GAAMvxD,GACpB,IACGA,GACc,kBAARA,GACiC,sBAAxC5c,OAAOouE,UAAU3vD,SAASiC,KAAK9D,GAG/B,OAAOA,EAET,GAAIA,EAAIyxD,UAAY,cAAezxD,EAEjC,OAAOA,EAAI0xD,WAAU,GAEvB,GAAI1xD,aAAerX,KAEjB,OAAO,IAAIA,KAAKqX,EAAI2xD,WAEtB,GAAI3xD,aAAeqjD,OAEjB,OAAO,IAAIA,OAAOrjD,GAEpB,IAAI2H,EACA0K,EACAgwB,EACJ,GAAI/rC,MAAM2f,QAAQjW,GAGhB,IADA2H,EAAI,GACC0K,EAAI,EAAGgwB,EAAIriC,EAAIphB,OAAQyzB,EAAIgwB,IAAKhwB,EAC/BA,KAAKrS,IACP2H,EAAE0K,GAAKk/C,GAAMvxD,EAAIqS,UASrB1K,EAAI3H,EAAIqrB,YAAc,IAAIrrB,EAAIqrB,YAAgB,GAEhD,OAoBF,SAAeumC,EAAWnxE,EAAaoxE,GACrC,IAAIpuE,EACAswB,EACE+9C,EAAQ,GACd,IAAKruE,KAAQhD,EAKXszB,EAAItzB,EAAOgD,GAEPA,KAAQmuE,IAETA,EAAKnuE,KAAUswB,GAAQtwB,KAAQquE,GAAUA,EAAMruE,KAAUswB,KAE1D69C,EAAKnuE,GAAQouE,EAAWA,EAAS99C,GAAKA,GAI1C,OAAO69C,EAvCAG,CAAMpqD,EAAG3H,EAAKuxD,IC7GhB,SAASS,GAAavvE,EAAyBupB,GACpD,GAAsB,kBAAXvpB,EAAqB,CAC9B,IAAIwvE,EACJ,IACEA,EAAax1C,KAAKC,MAAMj6B,GACxB,MAAOmf,GACP,MAAM,IAAI/gB,MAAJ,UAAa+gB,EAAb,iCAER,OAAOswD,GAAeD,EAAYjmD,GAEpC,OAAOkmD,GAAezvE,EAAQupB,GAGzB,SAASmmD,GAAa1vE,EAAgBupB,GAC3C,IAAIimD,EACJ,IACEA,EAcJ,SAAe7wD,EAAc4K,GAC3B,IACIomD,EACAC,EACA/vE,EAEAgwE,EALAC,EAAoB,GAIlBxyE,EAAe,CAAE6kC,OAAQ,IAG/B,SAAS4tC,IAEL,IAAIC,EADN,QAAchzE,IAAV6C,EAQF,IAEE,IAAMisE,EAAQjsE,EAAMisE,MAAM,eAW1B,GATEkE,EADElE,EACY9xC,KAAKC,MAAM6xC,EAAM,IAGxB,gCAAgC3kE,KAAKtH,GAC9Bg6C,WAAWh6C,EAAMkyD,QAAQ,KAAM,KAE/BlyD,GAGX8vE,EACH,MAAM,IAAIvxE,MAAJ,mCAAsC0xE,EAAQp1D,KAAK,SAE3D,IAAMorB,EAAOgqC,EAAQnf,OAAOgf,GAASj1D,KAAK,KAC1C,GAAkB,OAAdk1D,EAAoB,CACtB,IAAIK,EAAWC,KAAS5yE,EAAMwoC,GAC1BmqC,EACGp8D,MAAM2f,QAAQy8C,KACjBA,EAAW,CAACA,IAGdA,EAAW,GAGbA,EAASn0E,KAAKk0E,GACdA,EAAcC,EAEI,SAAhBD,IACFA,GAAc,GAEI,UAAhBA,IACFA,GAAc,GAEhB55D,KAAS9Y,EAAMwoC,EAAMkqC,GACrB,MAAOp8C,GACP,MAAM,IAAIx1B,MAAJ,sBACWmrB,EAAM,OAAH,OAAUA,GAAQ,IADhC,OAEFsmD,EAAa,YAAH,OAAeA,EAAa,GAAM,MA4DtD,OArDAlxD,EAAKqtB,MAAM,MAAM3xC,SAAQ,SAAC81E,EAAUvgD,GAClCigD,EAAajgD,EAAI,EACjB,IAGIk8C,EAHE1C,EAAO+G,EAASpe,QAAQ,UAAW,IAIzC,GAAK+Z,EAAQ1C,EAAK0C,MAAM,kBAEtBiE,IACAJ,OAAU3yE,EACV6C,OAAQ7C,EAEe,KADvB8yE,EAAUhE,EAAM,GAAGsE,OAAOpkC,MAAM,aACpB7vC,QAA6C,YAA7B2zE,EAAQ,GAAG9nD,gBACrC8nD,EAAU,SAIT,GACFhE,EAAQ1C,EAAK0C,WACF9uE,IAAV6C,EAAsB,sBAAwB,yBAEhD,CACAkwE,IACAJ,EAAU7D,EAAM,GAAGsE,OAAOpkC,MAAM,YAFhC,MAGmB8/B,EAHnB,mBAGM8D,EAHN,KA5FN,SAAuBS,GACrB,GAAgB,YAAZA,EACF,OAAO,EAET,OAAO,EA4FCC,CAAcR,EAAQnf,OAAOgf,GAASj1D,KAAK,QAC7Ck1D,EAAY,MAEd/vE,EAAQisE,EAAM,GAAGsE,iBAILpzE,IAAZ2yE,IACC7D,EAAQ1C,EAAK0C,MAAM,uBAEpBiE,IACAH,EAAY,KACZ/vE,EAAQisE,EAAM,GAAGsE,aAGApzE,IAAV6C,IAAwBisE,EAAQ1C,EAAK0C,MAAM,eAClDjsE,GAASA,EAAM1D,OAAN,WAAmB2vE,EAAM,GAAGsE,QAAWtE,EAAM,GAAGsE,QAIzDL,IACAJ,OAAU3yE,EACV6C,OAAQ7C,MAIZ+yE,IAEOzyE,EAnIQ28B,CAAMj6B,EAAQupB,GAC3B,MAAOpK,GACP,MAAM,IAAI/gB,MAAJ,UAAa+gB,EAAb,iCAER,OAAOswD,GAAeD,EAAYjmD,GAyI7B,SAASkmD,GAAermE,EAAcmgB,GAE3C,GAAIngB,EAAK+4B,SAAWtuB,MAAM2f,QAAQpqB,EAAK+4B,QAErC,GAAIwsC,GAAQvlE,EAAK+4B,QACf/4B,EAAK+4B,OAAS,CAAC/4B,EAAK+4B,YAGjB,CAEH,IADA,IAAMA,EAAkB,GACxB,MAAoBxhC,OAAOlB,KAAK2J,EAAK+4B,QAArC,eAA8C,CAAzC,IAAMrY,EAAK,KACRnlB,EAAQyE,EAAK+4B,OAAOrY,GACtB6kD,GAAQhqE,GACVw9B,EAAOrmC,KAAK6I,GAEZw9B,EAAOrmC,KAAP,aAAcguB,SAAUnlB,IAG5ByE,EAAK+4B,OAASA,EAKlB,IDlLuBhO,ECkLjBo8C,EAAOnnE,EAAKonE,cAClB,GAAID,GAAQA,EAAKE,QAAS,CASxB,GAP4B,kBAAjBF,EAAKE,UACdF,EAAKE,QAAU,CAACF,EAAKE,WDtLFt8C,ECwLRo8C,EAAKE,UDvLNt8C,EAAI5K,KAA0B,kBAAZ4K,EAAI5K,MCwLhCgnD,EAAKE,QAAU,CAACF,EAAKE,WAGlB58D,MAAM2f,QAAQ+8C,EAAKE,SAAU,CAEhC,IADA,IAAMA,EAAoB,GAC1B,MAAmB9vE,OAAOlB,KAAK8wE,EAAKE,SAApC,eAA8C,CAAzC,IAAMzvE,EAAI,KACPhD,EAASuyE,EAAKE,QAAQzvE,GACtB,SAAUhD,IACdA,EAAOgD,KAAOA,GAEhByvE,EAAQ30E,KAAKkC,GAEfuyE,EAAKE,QAAUA,EAIjBF,EAAKE,QAAUF,EAAKE,QAAQ9uE,KAC1B,SAAC+uE,GACC,GAAyB,kBAAdA,EAAwB,CACjC,IAAMC,EAAuB,CAAEpnD,IAAKmnD,GAC9BE,EAAYF,EAAU5E,MAAM,YAIlC,OAHI8E,IACFD,EAAavpE,KAAOwpE,EAAU,GAAG5oD,eAE5B2oD,EAET,OAAOD,KAcb,GATAtnE,EAAKynE,UAAYznE,EAAKynE,WAAatnD,EAC/BngB,EAAKynE,UAAUhrC,WAAW,OAC5Bz8B,EAAKynE,UAAY,IAAIr8C,IAAIprB,EAAKynE,UAAWx3E,OAAO4M,SAAS+iB,MAAMA,MAEjE5f,EAAK0nE,QAAU1nE,EAAK0nE,SAAW,IAAIt8C,IAAI,IAAKprB,EAAKynE,WAAW7nD,KACxD5f,EAAK0nE,QAAQ30E,SAAWiN,EAAK0nE,QAAQ5pE,SAAS,OAChDkC,EAAK0nE,SAAW,KAGd1nE,EAAKynE,UAAW,CAGlB,IAAME,EAAqC,GACvC3nE,EAAK+4B,QACP4uC,EAAQj1E,KAAR,MAAAi1E,EAAO,YAAS3nE,EAAK+4B,SAEnB/4B,EAAK4nE,QACPD,EAAQj1E,KAAR,MAAAi1E,EAAO,YAASpwE,OAAOrB,OAAO8J,EAAK4nE,UAEjC5nE,EAAK6nE,OACPF,EAAQj1E,KAAKsN,EAAK6nE,OAGpBF,EAAQ12E,SAAQ,SAACk3C,GACVA,EAAEu/B,UACLv/B,EAAEu/B,QAAU1nE,EAAK0nE,SAAW,QAK5B1nE,EAAK8nE,SAAmC,kBAAjB9nE,EAAK8nE,UAC9B9nE,EAAK8nE,QAAU,IAAI18C,IAAIprB,EAAK8nE,QAAS9nE,EAAKynE,WAAW7nD,MAEnD5f,EAAK+nE,UACP/nE,EAAK+nE,QAAU,IAAI38C,IAAIprB,EAAK+nE,QAAS/nE,EAAKynE,WAAW7nD,MA4CzD,OAxCA5f,EAAK4nE,OAAS5nE,EAAK4nE,QAAU,IAC3B5nE,EAAK+4B,QAAU,IAAI9nC,SAAQ,SAAC+2E,GAG5B,GAAIA,EAAYpxE,OAAQ,CACtB,IAAM+hC,EAAIqvC,EAAYpxE,cACfoxE,EAAYpxE,OACnBoxE,EAAc,2BAAKrvC,GAAMqvC,GAQ3B,IAAIC,EAJAD,EAAYE,QAMdD,EADuB,iBAArBD,EAAYhqE,KACG,kCACa,eAArBgqE,EAAYhqE,KACJ,gCACa,sBAArBgqE,EAAYhqE,KACJ,uCACa,kBAArBgqE,EAAYhqE,KACJ,8BAEAmqE,GAAgB,qBAAsBH,EAAYhqE,MAGrEgqE,EAAYhqE,KAAOiqE,EAEnBG,GAA2BpoE,EAAMgoE,GAE7BA,EAAYK,aACTL,EAAYK,WAAWX,UAC1BM,EAAYK,WAAWX,QAAUM,EAAYN,SAE/CU,GAA2BpoE,EAAMgoE,EAAYK,iBAI1CroE,EAQT,SAASmoE,GAAgB1kE,EAAcgD,GACrC,OAAKA,GAGAA,EAAUiY,SAAS,OACtBjY,EAAY,GAAH,OAAMhD,EAAN,YAAcgD,IAEzBA,EAAYA,EAAUkiD,QAAQ,MAAO,KAL5B,GAoEX,SAASyf,GACPE,EACAN,GACM,IAKFO,EALE,EAGuBP,EAArBQ,mBAHF,MAGgB,GAHhB,EAYN,GALED,EADEP,EAAYO,WACDJ,GAAgB,gBAAiBH,EAAYO,YArE9D,SACEP,EACAQ,GAEA,OAAKR,EAGDA,EAAYhqE,MAAQgqE,EAAYhqE,KAAK0gB,SAAS,eAChD,wCACiC,IAA/BspD,EAAYS,eAAuB,MAAQ,IAG3C,aAAa1qE,KAAKyqE,GACpB,yCACiC,IAA/BR,EAAYS,eAAuB,MAAQ,IAG3C,UAAU1qE,KAAKyqE,GACV,+BAEL,WAAWzqE,KAAKyqE,GACX,gCAEL,YAAYzqE,KAAKyqE,GACZ,gCAEL,UAAUzqE,KAAKyqE,GACV,+BAEL,eAAezqE,KAAKyqE,GACf,oCAEL,iBAAiBzqE,KAAKyqE,GACjB,qCAEL,eAAezqE,KAAKyqE,GACf,oCAEL,kBAAkBzqE,KAAKyqE,GAClB,kCAEL,kBAAkBzqE,KAAKyqE,GAClB,kCAEL,iBAAiBzqE,KAAKyqE,GACjB,wCAEL,uBAAuBzqE,KAAKyqE,GACvB,6CAEL,WAAWzqE,KAAKyqE,GACX,kCAELR,EAAYhqE,MAAQgqE,EAAYhqE,KAAKF,SAAS,aACzC,uCAEF,GAnDE,GAkEM4qE,CAAgBV,EAAaQ,GAG5C,CAQA,IAAMG,EAAmB,2BAAKX,GAAR,IAAqBhqE,KAAMuqE,IAK/B,yCAAfA,GACgB,wCAAfA,GACe,0CAAfA,GACe,+CAAfA,GACe,oCAAfA,GACe,kCAAfA,IACAP,EAAYY,kBACZN,EAASV,QAAUU,EAASV,OAAOiB,QAIrCF,EAAU/wE,KAAV,eAAyBwI,qBAAWuoE,IAFpCA,EAAU/wE,KAAO,UAKd0wE,EAASV,SACZU,EAASV,OAAS,IAEpBU,EAASV,OAAOe,EAAU/wE,MAAQ+wE,EAGlCX,EAAYE,MAAQS,EAAU/wE,UAhC5B04B,QAAQU,KAAR,2EACsEg3C,EAAYtnD,MADlF,oECjYJ,SAASwK,GAAcruB,GACrB,YAAyCjJ,IAAjCiJ,EAAyBjC,IAGnC,SAASuwB,GACPtuB,GAEA,YAAqDjJ,IAA7CiJ,EAA+BrC,U,8CAGlC,kEAAArF,EAAA,yDACL2zE,EADK,+BACkB,CAAEluE,IAAK,IAC9BmuE,EAFK,+BAEgB,CACnBC,QAAS,CAAC,4BAA6B,2BAEzCC,EALK,+BAKwB,CAAEruE,IAAK,IAE9BskC,EAAW,QAAS4pC,EAAW,MAAQ,YACvCI,EAAct4C,KAAKC,MAAMD,KAAKE,UAAUg4C,IAC1CK,EAAmB,GACnBj+C,GAAc49C,KAChBK,EAAmBL,EAASluE,KAE1BuwB,GAAoB29C,KACtBK,EAAmBL,EAAStuE,WAE1B2uE,EAAiBrrE,SAAS,OAC5BorE,EAAYhqC,GAAYiqC,EAAiBr6B,MACvC,EACAq6B,EAAiBp2E,OAAS,MAI3Bm4B,GAAc+9C,IAAmBA,EAAeruE,KAChDuwB,GAAoB89C,IAAmBA,EAAezuE,WAxBpD,iBA0BG4uE,EAAe,QAASH,EAAiB,MAAQ,YACnDI,EAAqB,GACrBn+C,GAAc+9C,KAChBI,EAAqBJ,EAAeruE,KAElCuwB,GAAoB89C,KACtBI,EAAqBJ,EAAezuE,WAElC6uE,EAAmBvrE,SAAS,OAC9BurE,EAAqBA,EAAmBv6B,MACtC,EACAu6B,EAAmBt2E,OAAS,IAG5Bu2E,EAAoB,GAxCrB,MAyCgB,CAAC,eAAgB,qBAzCjC,iDAyCQtpE,EAzCR,KA0CGupE,EAAgB,KA1CnB,oBA6CuBC,GAAgB,gBACnCJ,EADkC,UAChBC,EADgB,YACMrpE,KA9C5C,QA6CCupE,EA7CD,0DAiDCj5C,QAAQva,MAAR,0BACqBszD,EADrB,YAC2CrpE,EAD3C,iBAjDD,QAqDDspE,EAAYG,GAAaH,EAAWC,IAAkB,GArDrD,2CAuDCL,EAAYhqC,KACdoqC,EAAUR,SAAWI,EAAYhqC,IAxDhC,kBA0DIwqC,GAAkBJ,IA1DtB,eA4DCA,EAAYjD,GAAe0C,EAAY94E,OAAO4M,SAAS+iB,MACzDspD,EAAYhqC,KACdoqC,EAAUR,SAAWI,EAAYhqC,IA9D9B,kBAgEEwqC,GAAkBJ,IAhEpB,4D,sBAmEA,SAAeI,GAAtB,mC,8CAAO,WACLX,GADK,+BAAA5zE,EAAA,6DAELw0E,EAFK,+BAEMC,GAELC,EAAqBrE,GAAWE,GAAMiE,GAAWZ,GAJlD,SAKmBe,GAAaD,GALhC,cAOLE,GADAC,EAAcP,GADVO,EALC,OAMmCjB,IAAeiB,EAC5BA,GAC3BC,GAAeD,GARV,kBASEA,GATF,4C,sBAYA,SAAeR,GAAtB,mC,8CAAO,WAA+B3sE,GAA/B,eAAA1H,EAAA,sEACgB6B,wBAAa6F,GAAUmgC,SAAS,QADhD,UAEiB,kBADhBpnC,EADD,8BAGG,IAAIZ,MAAJ,kCAAqC6H,IAHxC,WAKDquB,GAAcruB,GALb,yCAMIqtE,GAASt0E,EAAQiH,EAASjC,MAN9B,WAQDuwB,GAAoBtuB,GARnB,yCASIqtE,GAASt0E,EAAQiH,EAASrC,YAT9B,gCAWE0vE,GAASt0E,IAXX,6C,sBAcA,SAASs0E,GAAStzE,GAAkC,IAAlBupB,EAAkB,uDAAZ,GAC7C,OAAIvpB,EAAOowE,OAAOvqC,WAAW,KACpB0pC,GAAavvE,EAAQupB,GAEvBmmD,GAAa1vE,EAAQupB,GAM9B,SAASspD,GAAat0E,EAAkBqzB,GACtC,GAAU,OAANA,EACF,OAAO,KAGC,OAANrzB,IACFA,EAAI,IAGN,cAAmBoC,OAAOlB,KAAKmyB,GAA/B,eAAmC,CAA9B,IAAMi9C,EAAI,KACb,GAAa,WAATA,GAAqBA,KAAQtwE,EAAG,CAClC,IAAMg1E,EAAUh1E,EAAEswE,IAAS,GACrB2E,EAAU5hD,EAAEi9C,IAAS,GAC3B,IAAIh7D,MAAM2f,QAAQ+/C,KAAY1/D,MAAM2f,QAAQggD,GAG1C,MAAM,IAAIp1E,MAAJ,0DAC+Cm1E,EAD/C,YAC0DC,IAHhEj1E,EAAEswE,GAAQ4E,GAAkBF,GAAW,GAAIC,GAAW,QAqKxC,aA9JE3E,GAClBA,KAAQtwE,GAEW,kBAAZqzB,EAAEi9C,IAEU,kBAAZtwE,EAAEswE,GAGTtwE,EAAEswE,GAAQD,GAAWrwE,EAAEswE,GAAOj9C,EAAEi9C,IACd,aAATA,QAEK7xE,IAAZuB,EAAEswE,IACW,SAAZtwE,EAAEswE,SAAgC7xE,IAAZ40B,EAAEi9C,MAEzBtwE,EAAEswE,GAAQj9C,EAAEi9C,SAGO7xE,IAAZuB,EAAEswE,SAAmC7xE,IAAZ40B,EAAEi9C,KAEpCtwE,EAAEswE,GAAQj9C,EAAEi9C,IAGhB,OAAOtwE,EAMT,SAASk1E,GAAkBl1E,EAAYqzB,GACrC,IAAKA,EAAEz1B,OACL,OAAOoC,EAIT,IAAMg1E,EAAiC,GAevC,OAdAh1E,EAAElE,SAAQ,SAACk3C,EAAG3hB,GACZ2hB,EAAEhrC,MAAQqpB,EACV2jD,EAAQhiC,EAAEznB,OAASynB,KAGrB3f,EAAEv3B,SAAQ,SAACq5E,GACT,IAAMC,EAAKJ,EAAQG,EAAG5pD,OAClB6pD,EACFd,GAAac,EAAID,GAEjBn1E,EAAEzC,KAAK43E,MAIJn1E,E,SAQM20E,G,iFAAf,WAA4BU,GAA5B,IAGiBC,EAHjB,WAAAt1E,EAAA,iGAAAA,EAAA,MAGE,WACEyB,EACA8zE,GAFF,qBAAAv1E,EAAA,yDAIQsyE,EAAY7wE,EAAO6wE,WAAa7wE,EAAO8wE,QAJ/C,sBAMU,IAAI1yE,MAAJ,0CAC+B47B,KAAKE,UAAUl6B,KAPxD,UAUQ+zE,EAAkBlB,GAAa/D,GAAMgF,GAAe9zE,GAV5D,sBAYU,IAAI5B,MAAM,2BAZpB,cAcQ0pB,EAAWqrD,GACfa,GAAmBh0E,EAAOoyE,SAAW,IACrC2B,UAEK/zE,EAAOoyE,QAER6B,EAAQnsD,EAASnmB,IAAT,uCACZ,WAAOywE,GAAP,eAAA7zE,EAAA,6DACE6zE,EAAQ8B,YAAcN,EAAYM,YADpC,SAE6BtB,GAAgB,CACzC5uE,IAAK,IAAIwwB,IAAI49C,EAAQ7oD,IAAKsnD,GAAW7nD,OAHzC,cAEQmrD,EAFR,yBAKSN,EAAUM,EAAcJ,IALjC,2CADY,uDApBhB,UA6BoC7iD,QAAQC,IAAI8iD,GA7BhD,sBA8BsB55E,SAAQ,SAAC85E,GAC3Bn0E,EAAS6yE,GAAa7yE,EAAQm0E,IAAiBn0E,KA/BnD,kBAiCSA,GAjCT,6CAHF,uBAGiB6zE,EAHjB,8CACED,EAAc9E,GAAM8E,GADtB,kBAuCSC,EAAUD,EAAa,KAvChC,4C,sBA0CA,SAASI,GACPlsD,GAEA,OAAKA,GAKAjU,MAAM2f,QAAQ1L,KACjBA,EAAW,CAACA,IAGPA,EAASnmB,KACd,SAACywE,GAaC,MAXuB,kBAAZA,IACTA,EAAU,CAAE7oD,IAAK6oD,IAIb,WAAYA,IAChBA,EAAQ13B,OAAS03B,EAAQ7oD,IAAIriB,SAAS,SAAW,OAAS,WAErC,YAAnBkrE,EAAQ13B,QAA0B,YAAa03B,IACjDA,EAAQ5iD,QAAU,GAEb4iD,MAtBF,GA4BX,SAASe,GAA6BiB,EAAcp0E,GAClD,IAAKo0E,EACH,OAAOA,EAET,GAAIvgE,MAAM2f,QAAQ4gD,GAChB,IAAK,IAAIxkD,EAAI,EAAGA,EAAIwkD,EAAUj4E,OAAQyzB,GAAK,EACzCwkD,EAAUxkD,GAAKujD,GAAciB,EAAUxkD,GAAI5vB,QAExC,GAAyB,kBAAdo0E,EAGhB,IADA,IAAMC,EAAMD,EACZ,MAAmBzzE,OAAOlB,KAAK40E,GAA/B,eAAqC,CAAhC,IAAMrzE,EAAI,KACbqzE,EAAIrzE,GAAQmyE,GAAckB,EAAIrzE,GAAOhB,QAElC,GAAyB,kBAAdo0E,EAEhB,OFxPG,SAAsBE,EAAkBC,GAAuB,WACpE,OAAOD,EAASviB,QACd,mBACA,SAAC+Z,EAAOuE,GACNA,EAAUA,EAAQte,QAAQ,OAAQ,IAClC,IAAM/iD,EAAOkhE,KAASqE,EAAUlE,GAChC,QAAarzE,IAATgS,EACF,MAAoB,oBAATA,EACFA,EAAKqhE,GAEPrhE,EAET,GAAIulE,EAASj/D,SAAU,CAErB,IAAMyd,EAAIwhD,EAASj/D,SAAS+L,KAAK,EAAMgvD,GACvC,QAAUrzE,IAAN+1B,EACF,OAAOA,EAGX,OAAO+4C,KEqOF0I,CAAaJ,EAAWp0E,GAGjC,OAAOo0E,EAWT,IAAMpB,GAAiB,CACrB7wC,OAAQ,GAERsyC,YAAa,gBACbvC,SAAU,OACVwC,gBAAgB,EAChBC,UAAU,EACVC,WAAW,EACXC,eAAe,EACfC,mBAAmB,EACnBC,sBAAsB,EACtBC,kBAAkB,EAElB9D,QAAS,8BACTkB,QAAS,CAAC,eAAgB,qBAC1BjB,QAAS,6BAET8D,SAAU,CACRC,mBAAmB,EACnBC,OAAQ,CAAE5rD,IAAK,gCAAiCvoB,KAAM,kBACtDo0E,UAAW,CACT7rD,IAAK,mCACLvoB,KAAM,qBAERq0E,MAAO,CAAE9rD,IAAK,+BAAgCvoB,KAAM,kBAGtDs0E,0BAA0B,EAC1BC,mBAAoB,QAQtB,SAASlC,GAAerzE,GAItB,GAHKA,EAAOmiC,SACVniC,EAAOmiC,OAAS,KAEbniC,EAAO8wE,QACV,MAAM,IAAI1yE,MAAM,6CCrSb,SAASo3E,GACdC,EACAvD,EACApoC,GAEA,IAAM4rC,EAA2B,CAC/BnsE,QAASC,qBAAWisE,GACpBz0E,KAAMy0E,EAAe75E,KAAO65E,EAAe3rD,OAGvCzgB,EACJosE,EAAexwC,WACdwwC,EAAexwC,SAAS57B,aAAeosE,EAAexwC,SAAS0wC,aAC9DtsE,IACFqsE,EAAersE,YAAcA,GAG/B,IAAMC,EACJmsE,EAAensE,UACdmsE,EAAexwC,UAAYwwC,EAAexwC,SAAS37B,SACtDosE,EAAepsE,SAAWA,EAAWA,EAAS0iC,MAAM,YAAc,GAhBxD,IAkBF2lC,EAAe8D,EAAf9D,WACR,IAAK8D,EAAe7D,YAAa,CAC/B,IAAMD,IAAcA,EAAWzqE,SAAS,cAAgB,CACtD,IAAM0uE,EAAkBH,EAAe75E,KAAO65E,EAAe3rD,MAI7D,OAHA4P,QAAQU,KAAR,2CACsCw7C,EADtC,8EAGO5sE,uCACL0sE,EAAe10E,KACf40E,EACAF,EAAepsE,UAGnB,OA6SJ,SACEmsE,EACAC,GAEA,IACMG,GADcJ,EAAehyD,UAAY,IACf9hB,KAC9B,SAAC2c,GACC,IAAMw3D,EAAyB97C,KAAKC,MAAMD,KAAKE,UAAU5b,IAKzD,OAJAw3D,EAAWr7E,QAAU6jB,EAAQy3D,OAC7BD,EAAWp0C,SAAX,UAAyBpjB,EAAQy3D,OAAjC,YAA2Cz3D,EAAQ3jB,MAAnD,YACE2jB,EAAQzjB,IADV,YAEIyjB,EAAQtd,MAAQ,IACb80E,KAQX,OALAJ,EAAexwC,QAAU,CACvB99B,KAAM,oBACNqc,SAAUoyD,GAEZH,EAAetuE,KAAO,eACfsuE,EAjUEM,CAA8BP,EAAgBC,GAGvD,IAAMO,EAAqB,SAACrE,GAC1B,OAAO,IAAIp9C,IAAIo9C,EAAR,UAAwBM,EAAxB,MAAqClpD,KACzC+oC,QAAQ,QAAS,KACjBA,QAAQ,QAAS,MAEhB6f,EAAcqE,EAAmBR,EAAe7D,aAEtD,GAAID,EAAY,CACd,GAAmB,iCAAfA,EAA+C,CACjD,IAAMzsC,EAAsB,CAC1B99B,KAAM,aACNC,YAAa,CAAErD,IAAK4tE,IActB,OAZI6D,EAAeS,eACjBhxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeS,kBAE5CT,EAAeU,eACxBjxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeU,iBACnD7uE,UAAW,OAGb49B,EAAQ3+B,MAAQ,CAAEN,SAAU,CAAEjC,IAAK,GAAF,OAAK4tE,EAAL,UAEnC,2BACK8D,GADL,IAEEtuE,KAAM,kBACN89B,YAGJ,GAAmB,kCAAfysC,EAAgD,CAClD,IAAMzsC,EAAsB,CAC1B99B,KAAM,cACNG,aAAc,CAAEvD,IAAK4tE,GACrB9nC,mBASF,OAPI2rC,EAAeW,gBACjBlxC,EAAQ19B,aAAe,CACrBxD,IAAKiyE,EAAmBR,EAAeW,kBAGzClxC,EAAQ19B,aAAe,CAAExD,IAAK,GAAF,OAAK4tE,EAAL,UAE9B,2BACK8D,GADL,IAEEtuE,KAAM,kBACN89B,YAGJ,GAAmB,oCAAfysC,EACF,kCACK+D,GADL,IAEEtuE,KAAM,eACN89B,QAAS,CACP99B,KAAM,gBACNc,gBAAiB,CAAElE,IAAK4tE,MAI9B,GACiB,oCAAfD,GACe,yBAAfA,EAUA,OARI8D,EAAeruE,MAAQquE,EAAeruE,KAAKF,SAAS,UACtDwuE,EAAe/0B,iBAAmB,SAElC80B,EAAeruE,MACfquE,EAAeruE,KAAKF,SAAS,aAE7BwuE,EAAe/0B,iBAAmB,WAEpC,2BACK+0B,GADL,IAEEtuE,KAAM,oBACN89B,QAAS,CACP99B,KAAM,gBACNS,eAAgB,CAAE7D,IAAK4tE,MAI7B,GAAmB,sCAAfD,EAAoD,CACtD,IAAMzsC,EAAsB,CAC1B99B,KAAM,kBACNM,cAAe,CAAE1D,IAAK4tE,IAcxB,OAZI6D,EAAeY,eACjBnxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeY,kBAE5CZ,EAAeU,eACxBjxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeU,iBACnD7uE,UAAW,OAGb49B,EAAQ3+B,MAAQ,CAAEN,SAAU,CAAEjC,IAAK,GAAF,OAAK4tE,EAAL,UAEnC,2BACK8D,GADL,IAEEtuE,KAAM,eACN89B,YAGJ,GAAmB,wCAAfysC,EACF,OAAO3oE,uCACL0sE,EAAe10E,KADkB,sBAElB4wE,EAFkB,KAGjC8D,EAAepsE,UAGnB,GAAmB,kCAAfqoE,EACF,OAAO3oE,uCACL0sE,EAAe10E,KADkB,gBAExB4wE,EAFwB,KAGjC8D,EAAepsE,UAGnB,GAAmB,oCAAfqoE,EACF,kCACK+D,GADL,IAEEtuE,KAAM,eACN89B,QAAS,CACP99B,KAAM,gBACNQ,eAAgB,CAAE5D,IAAK4tE,MAI7B,GAAmB,uCAAfD,EAAqD,CACvD,IAAMzsC,EAAsB,CAC1B99B,KAAM,mBACNK,cAAe,CAAEzD,IAAK4tE,IAcxB,OAZI6D,EAAeY,eACjBnxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeY,kBAE5CZ,EAAeU,eACxBjxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeU,iBACnD7uE,UAAW,OAGb49B,EAAQ3+B,MAAQ,CAAEN,SAAU,CAAEjC,IAAK,GAAF,OAAK4tE,EAAL,UAEnC,2BACK8D,GADL,IAEEtuE,KAAM,eACN89B,YAGJ,GAAmB,iCAAfysC,EACF,OAAO3oE,uCACL0sE,EAAe10E,KADkB,eAEzB4wE,EAFyB,KAGjC8D,EAAepsE,UAGnB,GAAmB,sCAAfqoE,EAAoD,CACtD,IAAMzsC,EAAsB,CAC1B99B,KAAM,kBACNO,cAAe,CAAE3D,IAAK4tE,IAcxB,OAZI6D,EAAeY,eACjBnxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeY,kBAE5CZ,EAAeU,eACxBjxC,EAAQ3+B,MAAQ,CACdN,SAAU,CAAEjC,IAAKiyE,EAAmBR,EAAeU,iBACnD7uE,UAAW,OAGb49B,EAAQ3+B,MAAQ,CAAEN,SAAU,CAAEjC,IAAK,GAAF,OAAK4tE,EAAL,UAEnC,2BACK8D,GADL,IAEEtuE,KAAM,eACN89B,YAGJ,GAAmB,iCAAfysC,EACF,OAAO3oE,uCACL0sE,EAAe10E,KADkB,eAEzB4wE,EAFyB,KAGjC8D,EAAepsE,UAGnB,GACiB,2CAAfqoE,GACe,yCAAfA,EAEA,OAAO3oE,uCACL0sE,EAAe10E,KADkB,yBAEf4wE,EAFe,KAGjC8D,EAAepsE,UAGnB,GAAmB,4CAAfqoE,EACF,OAAO3oE,uCACL0sE,EAAe10E,KADkB,0BAEd4wE,EAFc,KAGjC8D,EAAepsE,UAGnB,GAAmB,0CAAfqoE,EAAwD,CAC1D,IAAMzsC,EAAsB,CAC1B99B,KAAM,sBACNU,cAAe,CAAE9D,IAAK4tE,IASxB,OAPI6D,EAAea,eACjBpxC,EAAQn9B,YAAc,CACpB/D,IAAKiyE,EAAmBR,EAAea,iBAGzCpxC,EAAQn9B,YAAc,CAAE/D,IAAK,GAAF,OAAK4tE,EAAL,SAE7B,2BACK8D,GADL,IAEEtuE,KAAM,gBACN89B,YAGJ,GAAmB,+CAAfysC,EAA6D,CAC/D,IAAMzsC,EAAsB,CAC1B99B,KAAM,oBACNU,cAAe,CAAE9D,IAAK4tE,IAgBxB,OAdI6D,EAAea,eACjBpxC,EAAQn9B,YAAc,CACpB/D,IAAKiyE,EAAmBR,EAAea,iBAGzCpxC,EAAQn9B,YAAc,CAAE/D,IAAK,GAAF,OAAK4tE,EAAL,SAEzB6D,EAAec,eACjBrxC,EAAQl9B,YAAc,CACpBhE,IAAKiyE,EAAmBR,EAAec,iBAGzCrxC,EAAQl9B,YAAc,CAAEhE,IAAK,GAAF,OAAK4tE,EAAL,SAE7B,2BACK8D,GADL,IAEEtuE,KAAM,yBACN89B,YAGJ,GAAmB,oCAAfysC,EACF,kCACK+D,GADL,IAEEtuE,KAAM,yBACN89B,QAAS,CACP99B,KAAM,gBACNa,eAAgB,CAAEjE,IAAK4tE,MAY/B,GALA8D,EAAexwC,QAAU7+B,uBACvB,CAAErC,IAAK4tE,QACP50E,GACA,kBAAM40E,MAEH8D,EAAexwC,QAClB,MAAM,IAAI9mC,MAAM,+BAGlB,OAAIs3E,EAAexwC,QAAQ99B,OAASzB,cAC3BqD,uCACL0sE,EAAe10E,KACf4wE,EACA8D,EAAepsE,UAGfosE,EAAexwC,QAAQ99B,OAAS1B,UAC3B+D,mCACLisE,EAAe10E,KACf4wE,EACA8D,EAAepsE,WAInBosE,EAAetuE,KAAOkB,yBAAeotE,EAAexwC,QAAQ99B,MAEhC,sBAAxBsuE,EAAetuE,OACbquE,EAAeruE,MAAQquE,EAAeruE,KAAKF,SAAS,UACtDwuE,EAAe/0B,iBAAmB,SACzB80B,EAAeruE,MAAQquE,EAAeruE,KAAKF,SAAS,aAC7DwuE,EAAe/0B,iBAAmB,YAI/B+0B,GCxXM,mBACb,OAAO,qCAEL7X,sCAFK,GAGL,cACS,CACLh5D,cAAe2a,iCADV,IAELpY,KAAMjF,wCAHV,SAKW,SAAAoB,GAAI,MAAK,CAChBu6D,QADgB,WAEd,IAAM4Q,EAAkBruE,yBACtBkD,EADoC,cAAtC,mBAIMyO,EAAU8O,qBAAhB,IFLH,WAAP,iCEMU01D,UACQ,SAAAx2E,GACJ,IAAMxF,EAAe6F,yBACnBkD,EADiC,cAAdlD,iBAArB,GAIA,MACE,MAAM,IAAIjC,MAAV,mDAIF,IAAMqgE,EAAezsD,EAAA,iBACnB,SAAA4lD,GAAQ,OAAIv3D,yBAAeu3D,EAAfv3D,UAAJ,KAEJypC,EAAkBzpC,yBAAeo+D,EAAc,CAAC,WAAtD,YAIMgY,EAAYz2E,EAAA,YAAkB,SAAA02E,GAClC,IAAMC,EAAWnB,GAAmB,EAElCx1E,EAFiC,SAAnC,GAMA,OADA22E,gBAAyB,CAAzBA,GACA,KAEFpzE,sBA3BJizE,OA6BS,SAAAr3D,GACLua,iBACA1nB,mFACqEzO,EADrEyO,sHAIAA,kBAAwBzO,EAAxByO,yBCrDO4kE,G,4MACnB51E,KAAO,sB,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,gBACN0e,aAAcm3D,GACd7xD,gBAAiB,kBACf,8DAAwCC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,iBAI5DuC,EAAcouD,mBACZ,kBACE,IAAIj1B,EAAe,CACjBrsC,KAAM,qBACN0e,aAAco3D,GACdh3D,WAAYi3D,GAAqB7iE,GACjCsG,YAAa,iBACbnR,YAAa,6BACbkgB,IAAK,0B,GAtBkCnD,K,2GCJ3ChX,GAAYC,aAAW,CAC3BgoB,QAAS,CACP1pB,YAAa,QACbf,gBAAiB,UACjB2qB,gBACE,sHACFl6B,OAAQ,OACRjE,MAAO,OACP87B,UAAW,UAEb/V,MAAO,CACL5K,QAAS,QACT7H,MAAO,MACPtT,MAAO,OACPiqE,SAAU,SACV3tD,WAAY,UAEd8hB,aAAc,CACZzqB,WAAY,UACZ9T,QAAS,QAEXw+B,WAAY,CACV1qB,WAAY,UACZ9T,QAAS,OACTyT,MAAO,SAIX,SAASorB,KAAiB,MAEE5nB,oBAAS,GAFX,mBAEjBsO,EAFiB,KAEVC,EAFU,KAGlBlO,EAAUnB,KAMhB,OALAoB,qBAAU,WACR,IAAM+N,EAAUxG,YAAW,kBAAM0G,GAAS,KAAO,KACjD,OAAO,kBAAMzG,aAAauG,OAGrBC,EACL,yBAAKrL,cAAY,kBAAkBtD,UAAWU,EAAQ8mB,SAAtD,iBAEE,kBAACisC,GAAA,EAAD,OAEA,KAGN,SAAStrC,GAAT,GAAgE,IAAxCyB,EAAwC,EAAxCA,YAChBlpB,EAAUnB,KAChB,OAAO,yBAAKS,UAAWU,EAAQinB,cAAeiC,GAMhD,SAASvB,GAAT,GAAiD,IAA3B/Y,EAA2B,EAA3BA,MACd5O,EAAUnB,KAChB,OAAO,yBAAKS,UAAWU,EAAQknB,YAAatY,EAAMjH,SAIpD,IAaekgB,GAbwB92B,qBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACjD,OAAIA,EAAMmmB,MACD,kBAAC,GAAD,CAAYA,MAAOnmB,EAAMmmB,QAE9BnmB,EAAMkf,QACD,kBAAC,GAAD,CAAcuhB,YAAazgC,EAAMkf,UAErClf,EAAMq/B,OAGJr/B,EAAMs/B,aAFJ,kBAAC,GAAD,SCpEL0+C,GAGD,SAAAjpE,GAAS,IACJ/U,EAAoB+U,EAApB/U,MAAO+Y,EAAahE,EAAbgE,SACf,OACE,6BACE,kBAAC/Y,EAAM0qE,gBAAoB31D,GAC1BgE,IASPilE,GAAyBv5D,aAAe,CACtC1L,SAAU,MAEGzQ,2BAAS01E,ICHjB,SAASp2C,GAAoB1sB,GAClC,OAAOqL,8BACL,2BACA,CAAEI,SAAUzL,EAAc2sB,0BAA0B,aACpD,CAAEjhB,kBAAmBgV,KAA+B/U,iBAAiB,IAIlE,SAAS2E,GAAkB9E,GAChC,OAAOvd,QACJuB,QACC,2BACAs3B,eACA74B,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,4BACpB/b,cAAe2a,iCAAuBE,GACtCriB,OAAQ,OAGXk7B,UAAS,kBACRC,sBAAkBx7B,EAClBq7B,QAAQ,EACR/6B,UAAMN,EACNs7B,kBAAct7B,EACdkb,aAASlb,EACT2mE,wBAAoB3mE,EACpB0mE,gBAAkBtrC,OAEnBvc,OAAM,SAAAtY,GAAI,MAAK,CACd,uBACE,OAAO6d,kBAAQ7d,EAAM,YAAY6D,MAEnC,kBACE,MAAO,CACL2Y,cAAexc,EAAKwc,cACpBC,aAAczc,QAInBD,SAAQ,SAAAC,GACP,IAAIi1B,EAEJ,MAAO,CACLC,YADK,WAEHE,gCACEp1B,EACAq1B,GACAC,GACA,CACE73B,KAAM,GAAF,OAAKuC,EAAK6D,KAAV,YAAkB7D,EAAKrG,GAAvB,cACJ47B,MAAO,IACPE,iBAAiB,GAEnBp8B,KAAKq8B,WACLr8B,KAAKs8B,YACLt8B,KAAKu8B,WAITF,WAjBK,SAiBMI,GACT91B,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,WAAQniB,EACbuG,EAAKogE,wBAAqB3mE,EAC1Bw7B,EAAmBa,GAErBG,WA1BK,SA0BMC,GACLjB,IAAqBA,EAAiBr3B,OAAOm4B,SAC/Cd,EAAiBe,QAEnBh2B,EAAK80B,QAAS,EACd90B,EAAK2U,QAAUuhB,EACfl2B,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,WAAQniB,EACbuG,EAAKogE,wBAAqB3mE,EAC1Bw7B,OAAmBx7B,GAErBk8B,YAtCK,SAsCOlc,GAIT,IACO1f,EAA2C0f,EAA3C1f,KAAMg7B,EAAqCtb,EAArCsb,aAAcqrC,EAAuB3mD,EAAvB2mD,mBAC5BpgE,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,aAAeA,EACpB/0B,EAAKjG,KAAOA,EACZiG,EAAK4b,WAAQniB,EACbuG,EAAKogE,mBAAqBA,EAC1BnrC,OAAmBx7B,GAErBm8B,SApDK,SAoDIha,GACPua,QAAQva,MAAMA,GACVqZ,IAAqBA,EAAiBr3B,OAAOm4B,SAC/Cd,EAAiBe,QAGnBh2B,EAAK80B,QAAS,EACd90B,EAAK2U,aAAUlb,EACfuG,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,MAAQA,EACb5b,EAAKogE,wBAAqB3mE,EAC1Bw7B,OAAmBx7B,OAK7B,SAAS47B,GAAgBr1B,GAAgC,IAC/Cyd,EAAeF,qBAAWvd,GAA1Byd,WACFzM,EAAUhR,EAGdkC,EAE2C8O,EAF3C9O,YACAm0B,EAC2CrlB,EAD3CqlB,aAMFv5B,yBAAekD,EAAKsB,eAZmC,IAc/Csc,EAAkB5d,EAAlB4d,cACFpc,EAAS0a,4BAAkBlc,GAC3B0d,EAAYhc,0BAAgB1B,GAGlC,OAFAqjB,sBAAY7hB,GAEL,CACL60B,eACA5Y,aACAvb,YAAa,2BACRA,GADM,IAETkU,KAAMiN,sBAAY7hB,KAEpB80B,WAAY,CACV1Y,gBACAyY,aAAcA,EAAa54B,KAC3BigB,YACA1C,QAAS,M,SAKAsa,G,iFAAf,WAAiC9qB,GAAjC,2BAAAxP,EAAA,yDACOwP,EADP,sBAEU,IAAI3P,MAAM,+BAFpB,cAKUw7B,EAAsD7rB,EAAtD6rB,aAAc5Y,EAAwCjT,EAAxCiT,WAAYvb,EAA4BsI,EAA5BtI,YAAao0B,EAAe9rB,EAAf8rB,WALjD,SAO0CD,EAAamB,eACnD/Z,EADsC,2BAGjC6Y,GACAp0B,IAXT,uBAOU6yB,EAPV,EAOUA,aAAiBh7B,EAP3B,kDAeS,CAAEg7B,eAAch7B,OAAMqmE,mBAAoB/pC,EAAa3lB,iBAfhE,4C,sBC9Ie,SAASuQ,GAAkBtQ,GAA8B,IAE9DhS,GAAcod,EADApL,EAAdoL,WACwB,gCAAxBpd,UAGR,OAAOC,QACJuB,QACC,wBACA+wD,KACAtyD,QAAMnJ,MAAM,CACVkE,GAAIgF,EACJkF,KAAMjF,QAAMye,QAAQ,yBACpBvjB,OARgB,IAShBs3D,kBAAmB,eACnBC,oBAAoB,EACpBC,WAAW,EACXC,iBAAiB,EACjB3yB,OAAQhgC,QAAM6oB,MACZ9W,EAAc8uB,iBAAiB,QAAS,eAE1CnnB,MAAO1Z,QAAM6oB,MACX9W,EAAc0wB,YAAY,oBACvB9kB,YAMLulD,iBAAkBljE,QAAM6oB,MACtB9W,EAAc2sB,0BAA0B,aAI7CtI,UAAS,iBAAO,CACfm8B,aAAc,EACdt7D,MAAO,QAERyiB,OAAM,SAAAtY,GAAI,MAAK,CACd,kBACE,OAAOA,EAAKsY,MAAM1f,OAAS,GAG7B,eACE,OAAQoH,EAAKsY,OAAS,IAAIla,KAAI,SAAAoxB,GAAC,mBAC1B,IAAIrzB,IAAIqzB,EAAEgzB,aAAapkD,KAAI,SAAA8qD,GAAC,OAAIA,EAAEhyD,iBAIzC,oBACE,mBAAW,IAAIiF,IAAI6D,EAAKsY,MAAMla,KAAI,SAAAoxB,GAAC,OAAIA,EAAEtY,iBAAew8D,cAY3D3zE,SAAQ,SAAAC,GAAI,MAAK,CAChBk1B,YADgB,WACF,WACZ8E,sBACEh6B,EACAgxD,mBAAShxD,GAAM,SAAC2zE,GACd,GAAI3zE,EAAKsxD,UAAW,KACV7zD,EAAqBk2E,EAArBl2E,KAAM8kC,EAAeoxC,EAAfpxC,KAAM9oB,EAASk6D,EAATl6D,KACJ,CACd,mBACA,SACA,iBACA,YACA,YACA,eAEU8K,SAAS9mB,IAAS8kC,GAC5B,EAAKswB,gBAAgBp1D,EAAM8kC,EAAM9oB,SAS3C2c,cAzBgB,WA0Bd,IAAM3nB,EAAU8O,qBAAWvd,GAC3BA,EAAKkX,cAAcpgB,SAAQ,SAAA2G,GACG,MAAxBA,EAAKkG,SAAS,WAChB,UAAA8K,EAAQmlE,sBAAR,cAAAnlE,EAAyBhR,QAK/Bo1D,gBAlCgB,SAkCAC,EAAoBvwB,GAAgC,IAAlB9oB,EAAkB,uDAAJ,GAC9DzZ,EAAKsY,MAAMxhB,SAAQ,SAAAsf,GACjB,IAAMuoB,EAAMsyB,kBAAQ76C,GAChBuoB,EAAIo0B,YAAYxwB,KAAU5D,EAAI/lC,OAAS2pC,EAAK3pC,QAE9Cwd,EAAK08C,GAAYr5C,EAAK,QAK5BxG,SA5CgB,SA4CP+/C,GACPhzD,EAAKnK,MAAQm9D,EACbhzD,EAAKsY,MAAMxhB,SAAQ,SAAA04B,GAAC,OAAIA,EAAEvc,SAAS+/C,OAErC/4B,UAhDgB,SAgDNuoC,GACRxiE,EAAKlG,OAAS0oE,GAGhBW,SApDgB,SAoDP7qD,GACPtY,EAAKsY,MAAQie,eAAKje,IAGpB26C,WAxDgB,SAwDL78C,GACTpW,EAAKsY,MAAMsoB,OAAOxqB,IAGpB88C,UA5DgB,WA6DdzxD,oBAAUzB,EAAM,GAAGizD,WAAWjzD,IAGhCmzD,gBAhEgB,SAgEAr5D,GACdkG,EAAKmxD,aAAer3D,GAGtBs5D,eApEgB,WAqEdpzD,EAAKuxD,iBAAmBvxD,EAAKuxD,iBAE/B8B,qBAvEgB,WAwEdrzD,EAAKqxD,oBAAsBrxD,EAAKqxD,oBAElCiC,gBA1EgB,WA2EdtzD,EAAKsxD,WAAatxD,EAAKsxD,WAGzBuR,sBA9EgB,WA+Ed,GAA+B,iBAA3B7iE,EAAKoxD,kBAaT,MAAM,IAAIv2D,MAAJ,sCAAyCmF,EAAKoxD,oBAZlD,IAAM3iD,EAAU8O,qBAAWvd,GAC3B,GAAIwd,oCAA0B/O,GAAU,CACtC,IAAMq0D,EAAWr0D,EAAQuP,UACvB,kCACA,4BACA,CAAE5H,KAAMpW,IAGV,OADAyO,EAAQ0P,WAAW2kD,GACZA,IAObG,YA/FgB,SA+FJj9D,GAEU3M,KAAK4mC,UAAUj6B,IAGjC3M,KAAK6mC,UAAUl6B,IAInBk6B,UAxGgB,SAwGNl6B,GAAuC,IAAtBq6B,EAAsB,uDAAJ,GACrC0iC,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAEIkX,EAAYvM,EAAcgI,aAAarX,EAAcuC,MAC3D,IAAKqZ,EACH,MAAM,IAAIriB,MAAJ,6BAAgCyG,EAAcuC,OAEtD,IAAM6U,EAAW/H,EAAc0wB,YAAYrhC,EAAK6D,MAC1CgwE,EAAoBn7D,EAAS4oB,aAAaljC,KAC9C,SAAAoiC,GAAW,OAAIA,EAAY/iC,QAEvB+jC,EAAclgC,EAAck+B,SAAStP,MACzC,SAACxkB,GAAD,OAA8BmoE,EAAkBtvD,SAAS7Y,EAAE7H,SAE7D,IAAK29B,EACH,MAAM,IAAI3mC,MAAJ,4DACiDmF,EAAK6D,OAG9D,IAAMzC,EAAQ8b,EAAUX,WAAWiQ,OAArB,2BACT6T,GADS,IAEZx8B,KAAMvC,EAAcuC,KACpBvC,gBACAk+B,SAAU,CAAC,CAAE37B,KAAM29B,EAAY39B,KAAMvC,cAAekgC,OAEtDxhC,EAAK4+B,OAAOrmC,KAAK6I,IAGnB6+B,UA1IgB,SA0INj6B,GACR,IAAM+8D,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAGIg9D,EAAchjE,EAAK4+B,OAAOza,QAC9B,SAAA6pB,GAAC,OAAIA,EAAE1sC,gBAAkBA,KAG3B,OADAq/B,wBAAY,kBAAMqiC,EAAYlsE,SAAQ,SAAAk3C,GAAC,OAAIhuC,EAAK4+B,OAAOgC,OAAOoN,SACvDg1B,EAAYpqE,YAGtB0f,OAAM,SAAAtY,GAAI,MAAK,CACd,gBACE,IAAMqR,EAAwB,GAc9B,OAbArR,EAAKsY,MAAMxhB,SAAQ,SAACsf,EAAMo7C,GACpBp7C,EAAK/E,WACPA,EAAU9Y,KAAK,CACbguB,MAAO,QAAF,OAAUirC,EAAM,EAAhB,SACLr0B,QAAS/mB,EAAK/E,eAIpBA,EAAU9Y,KAAK,CACbguB,MAAO,sBACP/V,QAASxQ,EAAK6iE,sBACdhzD,KAAMikE,OAEDziE,OC9PA,mBAAkC,IAA/B0K,EAA+B,EAA/BA,UAEhB,OAAO,IADUA,EAAU,gDACpB,CAAa,CAClBte,KAAM,wBACN8e,WAAYR,EAAUg4D,IACtBrjE,eAAgBkS,gBAAK,kBAAM,sCC0BxB,SAAS3B,GACd9E,GAEA,OAAOvd,QACJuB,QACC,uBACA6zE,GAAiB73D,GACjBvd,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,wBACpB/b,cAAe2a,iCAAuBE,MAIzC7D,OAAM,SAAAtY,GAAI,MAAK,CACd,4BACE,OAAO,GAET,kBACE,IAAMi0E,EAAa/3D,4BAAkBlc,GACrC,MAAO,CACLwc,cAAexc,EAAKwc,cACpBC,aAAczc,EACdvD,OAAQohB,kBAAQ7d,EAAM,YACtBnK,MAAOo+E,EAAWp+E,MAClBiE,OAAQ,MAGZ,uBACE,OAAOkG,EAAKsB,cAAc8a,SAASvY,MAErC,oBAEE,oBACEpG,KAAMuC,EAAKi3B,YAAY31B,cAAcqgC,QAAQ99B,KAC7CqT,cAAe2G,kBAAQ7d,EAAM,kBAC1B6d,kBAAQ7d,EAAKi3B,YAAa,aAIjC,eACE,OAAOpZ,kBAAQ7d,EAAM,iB,gBCmDZk0E,IAJV,SAASC,GAAiBC,EAAet6E,GAC9C,OAAOs6E,EAAO,EAAIt6E,EAAS,EAGtB,SAAUo6E,KAAV,+FACL9qC,EADK,+BACW,GAChBD,EAFK,+BAEW,GAChBsJ,EAHK,uBAKDpmB,EAAI,EACJ8b,EAAI,EANH,YAOE9b,EAAI+c,EAAGxwC,QAAUuvC,EAAIgB,EAAGvwC,QAP1B,oBAQGoC,EAAIy3C,EAAGrJ,EAAG/c,IACVgC,EAAIokB,EAAGtJ,EAAGhB,MACZntC,EAAIqzB,GAVL,iBAWDhC,IAXC,6BAYQgC,EAAIrzB,GAZZ,iBAaDmtC,IAbC,wBAeD,OAfC,UAeK,CAACiB,EAAG/c,GAAI8c,EAAGhB,IAfhB,QAgBD9b,IACA8b,IAjBC,gE,OC/GiB,CAAC,EAAG,EAAG,EAAG,GAA3BkP,G,MAAQC,G,MAIPpP,GAAei8B,GAAfj8B,WAER,SAAS4L,GACP19B,EACAwa,GAEA,OAAQxa,EAAKs9C,OAAO9iC,IAAQ,IAAI56B,UAAY,EA8N/B+H,4BA1Lf,SAAgCyM,GAQ9B,IAAMkF,EAAM3C,iBAA0B,MAEpCjT,EAME0Q,EANF1Q,OACAjE,EAKE2U,EALF3U,MAJD,EASG2U,EAJFiS,oBALD,MAKgB,GALhB,IASGjS,EAHFqO,6BAND,MAMyB,EANzB,EAOCqH,EAEE1V,EAFF0V,SACAm0D,EACE7pE,EADF6pE,SAYIC,EA5DR,SAAuBp0D,GAErB,IADA,IAAMo0D,EAAU,GACPjoD,EAAI,EAAGA,EAAInM,EAAStnB,OAAQyzB,IACnC,IAAK,IAAI8b,EAAI9b,EAAG8b,EAAIjoB,EAAStnB,OAAQuvC,IACnC,GAAI9b,IAAM8b,EAAG,sBACY+rC,GAAgBh0D,EAASmM,GAAInM,EAASioB,IAAI,SAAAT,GAAI,OACnEA,EAAKluC,IAAI,iBAFA,IACX,2BAEG,8BAFSo7D,EAET,KAFaG,EAEb,KACDuf,EAAQ/7E,KAAK,CACX,CACEwiB,QAAS65C,EACThgD,MAAOyX,EACPn1B,QAAS09D,EAAGp7D,IAAI,WAChBU,OAAQ,CAAC06D,EAAGp7D,IAAI,SAAU,EAAGo7D,EAAGp7D,IAAI,OAAQ,KAE9C,CACEuhB,QAASg6C,EACTngD,MAAOuzB,EACPjxC,QAAS69D,EAAGv7D,IAAI,WAChBU,OAAQ,CAAC66D,EAAGv7D,IAAI,SAAU,EAAGu7D,EAAGv7D,IAAI,OAAQ,QAfvC,+BAsBjB,OAAO86E,EAkCS/f,CATal2C,mBAC3B,kBACE6B,EAAS9hB,KAAI,SAAAwW,GACX,OAAOA,EACJxW,KAAI,SAAA/B,GAAC,OAAI,IAAIiC,IAAcjC,MAC3BswD,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAExB,IAAI,aAAe60B,EAAE70B,IAAI,qBAEjD,CAAC0mB,KAGG5H,EAAQ+F,mBAAQ,WACpB,IACE,IAAM41D,EACJ,SAAUx3D,EACLP,4BAAkBO,QACnBhjB,EACN,cAAOw6E,QAAP,IAAOA,OAAP,EAAOA,EAAY37D,MACnB,MAAO+X,GAEP,OADA8F,QAAQU,KAAK,oBACN,QAER,CAACpa,IAEE83D,EAAO,OAAGj8D,QAAH,IAAGA,OAAH,EAAGA,EAAOla,KAAI,SAAAgY,GAAI,OAAIA,EAAKpgB,YAuIxC,OAtIAiX,qBAAU,WACR,GAAKyC,EAAIpC,SAAYinE,GAAYj8D,GAG5B7B,kBAAQgG,GAAb,CAGA,IAAMu2B,EAAMtjC,EAAIpC,QAAQ6L,WAAW,MACnC,GAAK65B,EAAL,CAGAA,EAAIgS,UAAU,EAAG,EAAGnvD,EAAOiE,GAC3Bk5C,EAAIC,MAAMp6B,EAAuBA,GACjCm6B,EAAIz5B,UAAYsE,kBAAQpB,EAAc,CAAC,WAAY,UACnDu2B,EAAI15B,YAAcuE,kBAAQpB,EAAc,CAAC,WAAY,UAIrD63D,EAAQx9E,SAAQ,SAAAoyD,GAGd,IAAK,IAAI78B,EAAI,EAAGA,EAAI68B,EAAEtwD,OAAS,EAAGyzB,GAAK,EAAG,OACsB68B,EAAE78B,GAAhDsoC,EADwB,EAChCz6D,OAAqB06D,EADW,EACpB75C,QAAoBquB,EADA,EACPx0B,MAAoB4/D,EADb,EACIt9E,QADJ,EAEsBgyD,EAAE78B,EAAI,GAApDyoC,EAFwB,EAEhC56D,OAAqB66D,EAFW,EAEpBh6C,QAAoBouB,EAFA,EAEPv0B,MAAoB6/D,EAFb,EAEIv9E,QACtCw9E,EAAKp8D,EAAM8wB,GACXurC,EAAKr8D,EAAM6wB,GAEjB,IAAKwrB,IAAOG,EAEV,YADA3+B,QAAQU,KAAK,8CAKf,GAA2BuS,IAAOD,EAAlC,CAGA,IAAMyrC,EAAUhgB,EAAGp7D,IAAI,OAASo7D,EAAGp7D,IAAI,SACjCq7E,EAAU9f,EAAGv7D,IAAI,OAASu7D,EAAGv7D,IAAI,SAElCo7E,EAAUF,EAAGx+E,SAAqBy+E,EAAGz+E,QAAtC,EAIJ,IAAM4+E,EAAMhhC,GAAG4gC,EAAI,CAAEx9E,QAASs9E,EAAM39B,MAAO8d,EAAGtd,MAAWk9B,EAAQnrC,GAC3D2rC,EAAMjhC,GAAG4gC,EAAI,CAAEx9E,QAASs9E,EAAM39B,MAAO8d,EAAGrd,MAAYi9B,EAAQnrC,GAC5D4rC,EAAMlhC,GAAG6gC,EAAI,CAAEz9E,QAASu9E,EAAM59B,MAAOie,EAAGzd,MAAWk9B,EAAQprC,GAC3D8rC,EAAMnhC,GAAG6gC,EAAI,CAAEz9E,QAASu9E,EAAM59B,MAAOie,EAAGxd,MAAYi9B,EAAQprC,GAE5DwsB,EACFwe,GAAiB/qC,EAAKD,EAAIrvC,GAIxB87D,EACFue,GAAiBhrC,EAAKC,EAAItvC,GAO9B,GAAI86E,EAAUF,EAAGx+E,SAAW2+E,EAAUF,EAAGz+E,QACvC88C,EAAIgJ,YACJhJ,EAAIiI,OAAO65B,EAAKnf,GAChB3iB,EAAIkI,OAAO85B,EAAKpf,GAChB5iB,EAAIlzB,aACC,CACL,IAAIo1D,EAASJ,EACTK,EAASH,EAIPI,EAAON,EAAMC,EAAM,GAAK,EACxBM,EAAOL,EAAMC,EAAM,GAAK,EAExBptC,EAAQ+sB,EAAGp7D,IAAI,OAASo7D,EAAGp7D,IAAI,SACrC,GAAIquC,EAEF,IADA,IAAMI,EAAWC,GAAWL,GACnBM,EAAI,EAAGA,EAAIF,EAASrvC,OAAQuvC,GAAK,EAAG,CAC3C,IAAM/wB,GAAO6wB,EAASE,GAChB8gB,EAAKhhB,EAASE,EAAI,GAElBmtC,EAASJ,EACTK,EAASJ,EAEJ,MAAPlsB,GAAqB,MAAPA,GAChBjW,EAAIz5B,UAAY,QAChB27D,GAAW99D,EAAMkB,EAAM,GAAGpiB,QAAWk/E,EACrCD,GAAW/9D,EAAMkB,EAAM,GAAGpiB,QAAWm/E,GACrB,MAAPpsB,GACTjW,EAAIz5B,UAAY,QAChB27D,GAAW99D,EAAMkB,EAAM,GAAGpiB,QAAWk/E,EACrCD,GAAW/9D,EAAMkB,EAAM,GAAGpiB,QAAWm/E,GACrB,MAAPpsB,GACTjW,EAAIz5B,UAAY,QAChB27D,GAAW99D,EAAMkB,EAAM,GAAGpiB,QAAWk/E,GACrB,MAAPnsB,GACTjW,EAAIz5B,UAAY,QAChB27D,GAAW99D,EAAMkB,EAAM,GAAGpiB,QAAWk/E,GACrB,MAAPnsB,IACTjW,EAAIz5B,UAAY,QAChB47D,GAAW/9D,EAAMkB,EAAM,GAAGpiB,QAAWm/E,GAEvCriC,EAAIgJ,YACJhJ,EAAIiI,OAAOq6B,EAAQ3f,GACnB3iB,EAAIkI,OAAOg6B,EAAQvf,GACnB3iB,EAAIkI,OAAOi6B,EAAQvf,GACnB5iB,EAAIkI,OAAOq6B,EAAQ3f,GACnB5iB,EAAI6W,YACJ7W,EAAIvnC,YAGNunC,EAAIgJ,YACJhJ,EAAIiI,OAAO65B,EAAKnf,GAChB3iB,EAAIkI,OAAO65B,EAAKpf,GAChB3iB,EAAIkI,OAAO+5B,EAAKrf,GAChB5iB,EAAIkI,OAAO85B,EAAKpf,GAChB5iB,EAAI6W,YACJ7W,EAAIvnC,iBAKX,CACDgR,EACA5D,EACAw7D,EACAx+E,EACAyiB,EACAi8D,EACAz6E,EACAw6E,IAIA,4BACE5kE,IAAKA,EACLE,cAAY,iBACZ/Z,MAAOA,EACPiE,OAAQA,OChPCkiB,iCAAoB,wBAEjC,CACE7S,MAAO,CACLtF,KADK,QAELiC,YAFK,yCAGL+a,aAAc,yBAGlB,CAAEvE,iBAAiB,ICPAk5D,G,mMACnB,WAAatzE,GAAb,kCAAAlH,EAAA,6DAMInF,EAEEqM,EAFFrM,MACQyiB,EACNpW,EADFkU,KAAQkC,MAEJ+sD,EAAgB/sD,EAAMla,KAAI,SAAA2C,GAC9B,IAAMqV,EAAOsV,KAAWc,OAAOzrB,GAE/B,OADAqV,EAAK4tD,iBAAiBnuE,GACfugB,KAZX,SAcyBuX,QAAQC,IAC7By3C,EAAcjnE,KAAI,SAAAgY,GAAI,OACpB,EAAK4W,YAAL,2BACK9qB,GADL,IAEEme,QAASjK,EAAKosC,aAAa3oB,qBAlBnC,OAwBE,IAVM3Z,EAdR,OAuBQu1D,EAAqBh/C,KAAKC,MAAMD,KAAKE,UAAUzW,IAC5CmM,EAAI,EAAGA,EAAIopD,EAAmB78E,OAAQyzB,IAC7C,IAAS8b,EAAI,EAAGA,EAAIstC,EAAmBppD,GAAGzzB,OAAQuvC,IAEhDstC,EAAmBppD,GAAG8b,GAAGutC,OAASrpD,EA3BxC,yBA+BS,CACL0I,aAAcpiB,IAAM6+B,cAAcn4C,KAAKqX,eAAzB,2BACTxO,GADS,IAEZge,cAEFA,SAAUu1D,IApCd,gD,4DADiDlQ,ICCpC,SAAStkD,GAAkBtQ,GACxC,OAAO/R,QAAMuB,QACXw1E,GAAUhlE,GACV/R,QAAMnJ,MAAM,oBAAqB,CAC/BoO,KAAMjF,QAAMye,QAAQ,wBCLX,gBAAC1M,GAAiC,IACvCoL,EAAcpL,EAAdoL,UAER,OAAO,IADUA,EAAU,gDACpB,CAAa,CAClBte,KAAM,oBACN8e,WAAYR,EAAUg4D,IACtBrjE,eAAgBkS,gBAAK,kBAAM,sC,WCeVgzD,G,4MACXpQ,MAAQ,IAAIC,KAAsB,CACxCD,MAAO,IAAIE,KAAS,CAAEC,QAAS,IAC/Bl6D,KAAM,kBAAM,EAAKvO,W,EAGXi7B,aAAc,E,EAEd09C,eAAiC,G,EAEjCC,cAAgC,G,EAGhCC,iB,IAGA7+D,mB,IAGA8+D,2B,wFAIR,oGACQD,EAAcj5E,yBAAezD,KAAKoD,OAAQ,eAC1Cya,EAAgBpa,yBAAezD,KAAKoD,OAAQ,iBAClDpD,KAAK28E,sBAAwBn5E,wBAC3BC,yBAAezD,KAAKoD,OAAQ,0BAJhC,SAO2BkxB,QAAQC,IAC/BmoD,EAAY33E,IAAZ,uCAAgB,WAAOooC,GAAP,mBAAAxrC,EAAA,gFACa,EAAKyxB,qBADlB,aACa,SAAqB+Z,GADlC,wJACM,EAChBF,YAFU,cACRA,EADQ,gBAGa9nC,0BAHb,0CAIL8nC,GAJK,cAMR,IAAIzrC,MAAJ,mCACwB,EAAK4B,OAAO+pC,WAAW3iC,KAD/C,MANQ,4CAAhB,wDARJ,OAOExK,KAAK08E,YAPP,OAoBE18E,KAAK6d,cAAgBA,EApBvB,gD,gHAuBA,iCAAAlc,EAAA,yDACO3B,KAAK8+B,YADZ,gCAEU9+B,KAAKotC,YAFf,uBAGwBptC,KAAK28E,sBAAsBnzC,SAAS,QAH5D,cAIS4F,MAAM,MAAM3xC,SAAQ,SAAC+uE,EAAc7iE,GACtC,GAAI6iE,EAAKjtE,QAAmB,QAATitE,EAAgB,OACHA,EAAKp9B,MAAM,MADR,mBAC1BwtC,EAD0B,KACnBC,EADmB,KACZnvC,EADY,UAEEttC,IAA/B,EAAKo8E,eAAeI,KACtB,EAAKJ,eAAeI,GAAS,SAEIx8E,IAA/B,EAAKo8E,eAAeK,KACtB,EAAKL,eAAeK,GAAS,IAE/B,EAAKL,eAAeI,GAAO19E,KAAKyK,GAChC,EAAK6yE,eAAeK,GAAO39E,KAAKyK,GAChC,EAAK8yE,cAAc9yE,GAAS,CAAEizE,QAAOC,QAAOnvC,OAAQA,OAGxD1tC,KAAK8+B,aAAc,EAlBvB,gD,4HAsBA,sBAAAn9B,EAAA,gFAIS,GAJT,2C,sHAOA,sBAAAA,EAAA,+EAES,IAFT,2C,+EAKA,SAAYjE,GAAwC,WAAxBgG,EAAwB,uDAAJ,GAC9C,OAAOe,4BAAgB,uCAAU,WAAMC,GAAN,iBAAA/C,EAAA,sEACzB,EAAKwqE,MAAMhsE,IAAI,aAAcuD,EAAMA,EAAKa,QADf,WAMhB,KADToF,EAAQ,EAAKkU,cAAcqvD,QAAQxvE,EAAOE,eALjB,uBAOvBipB,EAAW,EAAK61D,YAAY/yE,GAAOgqB,YAAYj2B,GAPxB,SAQvBmpB,EACHhiB,KACCi4E,cAAI,SAAAp7D,IAIW,EAAK86D,eAAe96D,EAAQvhB,IAAI,UAAY,IACpD1C,SAAQ,SAAAgzE,GACX/rE,EAAS+oC,KACP,IAAIxoC,IAAJ,2BACKyc,EAAQzgB,UADb,IAEEmsE,UAAWqD,aAMpBriC,YAzB0B,OA4B/B1pC,EAASovB,WA5BsB,2CAAV,yD,2BAqCzB,gB,GAtHgD3uB,0BAA7Bo3E,GAqBLn3E,aAAe,CAAC,cAAe,eC5ChCud,qCACb,uBACA,CACEg6D,sBAAuB,CACrBnyE,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,4BAEvBs1E,YAAa,CACXlyE,KAAM,SACNgd,aAAc,IAEhB3J,cAAe,CACbrT,KAAM,cACNgd,aAAc,KAGlB,CAAEvE,iBAAiB,IC0Cb4rB,GAAei8B,GAAfj8B,WAkCR,SAASy+B,GAAU9+B,GAGjB,IAFA,IAAMI,EAAWC,GAAWL,GACxBjvC,EAAS,EACJyzB,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,IAChBrwD,GAAUyvD,GAGd,OAAOzvD,EAGT,SAASguE,GAAsB/+B,GAG7B,IAFA,IAAMI,EAAWC,GAAWL,GACxBjvC,EAAS,EACJyzB,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,GAAqB,MAAPA,GAAqB,MAAPA,IAC5CrwD,GAAUyvD,GAGd,OAAOzvD,EAET,SAAS4vE,GAAQ3gC,EAAevJ,GAC9B,OAAmB,IAAZA,IACDuJ,EAAM0gC,MAAM,eAAiB,IAAI,IAAM,IACvC1gC,EAAM0gC,MAAM,iBAAmB,IAAI,IAAM,EAqBjD,IAAM18D,GAAYC,cAAW,SAAAnB,GAAK,MAAK,CACrCrB,KAAM,CACJzT,MAAO,KAETugF,YAAa,CACXl7E,SAAU,WACVrB,MAAO8Q,EAAMJ,QAAQ,GACrB+D,IAAK3D,EAAMJ,QAAQ,GACnBpB,MAAOwB,EAAMjE,QAAQ2vE,KAAK,UAI9B,SAASzpB,GAAOvwD,EAAYmkD,GAC1B,IAAM0J,EAAO7tD,EAAE7C,IAAI,QACnB,OAAO0wD,EAAOA,EAAK1J,GAAOnkD,EAAE7C,IAAIgnD,GAGlC,SAAS81B,GAAc9rE,GAKrB,IAAMwC,EAAUnB,KACRzK,EAA4CoJ,EAA5CpJ,MAAgBm1E,EAA4B/rE,EAArCuQ,QAAqBvJ,EAAgBhH,EAAhBgH,YAFnC,EAM+B7E,mBAAS,KANxC,mBAMM7W,EANN,KAMc0gF,EANd,OAOyB7pE,qBAPzB,mBAOMiP,EAPN,KAOaga,EAPb,KAQK6gD,GAAc3gF,EARnB,EAS2C6W,qBAT3C,mBASM+pE,EATN,KASsBC,EATtB,OAUiChqE,oBAAS,GAV1C,mBAUMiqE,EAVN,KAUiBC,EAVjB,KAkTD,OApSA5pE,qBAAU,WACR,IAAI6pE,GAAO,EA2BX,OA1BC,sBAAC,kDAAA97E,EAAA,2DAC8B,KAA1Bu7E,EAAW/8E,IAAI,UADnB,wBAEQ+tE,EAAa3a,GAAO2pB,EAAY,OAAS,GACzCQ,EAAaxP,EAAG9+B,MAAM,KAAK,GAHnC,EAI2BsuC,EAAWtuC,MAAM,KAJ5C,mBAISm/B,EAJT,KAIgBC,EAJhB,OAKyBtqD,qBAAWnc,GAA1Bqc,EALV,EAKUA,WACFG,EAAgBC,kBAAQzc,EAAO,WAC/Bsc,EAAYhc,0BAAgBN,GAPpC,SAQuBqc,EAAWK,KAAKJ,EAAW,kBAAmB,CACjEE,gBACAF,YACA3mB,OAAQ,CAAEG,QAAS0wE,EAAOxwE,OAAQywE,EAAU,EAAGvwE,KAAMuwE,KAXzD,OAQQr6C,EARR,OAaQwpD,EAAcxpD,EAAM0C,MACxB,SAAA7zB,GAAC,OACCA,EAAE7C,IAAI,UAAY+8E,EAAW/8E,IAAI,WACd,KAAjB6C,EAAE7C,IAAI,aAEPs9E,GACHH,EAAkBK,GAnBtB,wBAsBEL,EAAkBJ,GAtBpB,2CAAD,GA0BM,WACLO,GAAO,KAER,CAACP,EAAYn1E,IAsQd,kBAACiZ,GAAA,EAAD,CACExJ,MAAI,EACJmB,QAASR,EACTylE,kBAAgB,qBAChBC,mBAAiB,4BAEjB,kBAAC58D,GAAA,EAAD,CAAa3gB,GAAG,sBAAhB,kBAEE,kBAAC,KAAD,CACEgS,aAAW,QACXW,UAAWU,EAAQopE,YACnB5lE,QAASgB,GAET,kBAAC,KAAD,QAGJ,kBAAC+I,GAAA,EAAD,KACIm8D,EASA,yBAAKpqE,UAAWU,EAAQ1D,MACtB,kBAACmK,GAAA,EAAD,2IAICmI,EAAQ,kBAACnI,GAAA,EAAD,CAAYtK,MAAM,SAAlB,UAA8ByS,IAAwB,KAE/D,kBAAC,KAAD,CACEtf,MAAOxG,EACPqa,SAAU,SAAAhD,GACRqpE,EAAcrpE,EAAM4G,OAAOzX,QAE7BiqB,MAAM,oBAER,kBAAC,KAAD,CACEwjD,QACE,kBAAC,KAAD,CACE7sC,QAAS05C,EACTzmE,SAAU,kBAAM0mE,GAAa,SAAAz/D,GAAG,OAAKA,QAGzCmP,MAAM,oBAER,kBAAC9U,GAAA,EAAD,CACEhZ,QAAQ,YACR0Q,MAAM,UACNqC,MAAO,CAAEoZ,WAAY,IACrBpU,QAzTZ,WACE,IAAI,MACIuK,EAAU27D,GAAkBH,EAC5B9nE,EAAU8O,qBAAWnc,GACrBgV,EAAO8F,4BAAkB9a,GACzBymC,EAAQ9sB,EAAQvhB,IAAI,SACpB8tE,EAAUkB,GAAQ3gC,EAAO,GACzBihB,EAAQ/tC,EAAQvhB,IAAI,SACpB0xD,EAAOnwC,EAAQvhB,IAAI,QACnB+tE,EAAa3a,GAAO7xC,EAAS,OAAS,GACtCumC,EAAWvmC,EAAQvhB,IAAI,QAKvBguE,EAAe,GAAH,OAAMlmB,EAAN,kBAdhB,EAesBzjC,kBAAQzc,EAAO,iBAAhCqmE,EAfL,oBAgBIvwD,EAAgB,CAACuwD,EAAeD,GAChCxhE,EAAU,SAAH,OAAYrD,KAAKC,OACxB8C,EAAY,GAAH,OAAM47C,EAAN,eAAqBmmB,GAM9BpT,EADsB5lD,EAApBsoB,gBACyBv9B,IAAIiuE,GAE/BC,EAA0BH,EAAG9+B,MAAM,KACtCtkB,QAAO,SAAAwjD,GAAG,QAAMA,KAChBvpE,KAAI,SAACupE,EAAK3kE,GAAU,MACyB2kE,EAAIl/B,MAAM,KADnC,mBACZm/B,EADY,KACLC,EADK,KACIC,EADJ,KACcC,EADd,KAEbC,EAjKhB,SAAwBngC,GAGtB,IAFA,IAAMI,EAAWC,GAAWL,GACxBogC,EAAc,EACT57C,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,GAAqB,MAAPA,IAC9Bgf,GAAe5f,GAGnB,OAAO4f,EAuJuBC,CAAeH,GAC/BI,EAAWxB,GAAUoB,GACrBK,EAAuBxB,GAAsBmB,GAC7CM,EAAkC,MAAbP,GAAoB,EAAI,EAC7CQ,EAAYE,GAAQT,EAAS,GAC7BU,GAAeZ,EAAU,EAC/B,MAAO,CACL3wE,QAAS0wE,EACTxwE,MAAOqxE,EACPnxE,IAAKmxE,EAAcT,EACnBU,UAAWP,EACXb,QAASgB,EACTK,MAAOZ,EACP9wE,aAAcwwE,EACdnpC,OAAQ+pC,EACRlqC,SAAU,GAAF,OAAKpjB,EAAQphB,KAAb,cAAuBqJ,GAC/Boc,KAAM,CACJhoB,MAAOkxE,EACPhxE,IAAKgxE,EAAYF,EACjBlxE,QAASoqD,OAKX5Z,EAAO3sB,EAAQzgB,SACrBotC,EAAK4/B,QAAUA,EAEf5/B,EAAKtoB,KAAO,CACVloB,QAASoqD,EACTlqD,MAAOkwE,EACPhwE,IAAKgwE,EAAUV,GAAsB/+B,IAMvC,IAAM+gC,EAEAjC,GADI,KAAR7d,EACc4e,EAAwB,GAAGiB,MAC3B9gC,GAEV3nB,EAAW,CAACwnB,GAAJ,mBAAaggC,IAE3BxnD,EAASppB,SAAQ,SAACuF,EAAG2G,GACnB3G,EAAEnF,SAAkB,OAARm9D,QAAQ,IAARA,OAAA,EAAAA,EAAUe,oBAAoB/4D,EAAEnF,WAAYmF,EAAEnF,QAC1DmF,EAAEoqE,UAAYzjE,EACd3G,EAAE+iB,KAAKqnD,UAAYzjE,EACnB3G,EAAE+iB,KAAK+e,SAAP,UAAqB9hC,EAAE8hC,SAAvB,YAEFje,EAASysC,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAEssE,QAAUj5C,EAAEi5C,WAEtC,IAAM6P,EAAUp8D,EAAQvhB,IAAI,OAItB49E,EAAqBl3D,EAASktC,OAElCltC,EAAS9hB,KAAI,SAAA/B,GAAC,OAAIA,EAAE+iB,SAGhBi4D,EAAS,EAAIZ,EACb5N,EAAY3oD,EAAS8N,QACzB,SAAChzB,EAAGqB,GAAJ,OAAUrB,EAAIqB,EAAE/E,IAAM+E,EAAEjF,MAAQigF,IAChC,GAGIC,EAAa,GAAH,OAAMh2B,EAAN,YAAkB3+C,KAAKC,OACjC20E,EAAoB15D,kBAAQw2C,EAAU,YACtCmjB,EAAat3D,EAChB9hB,KAAI,SAAA/B,GACH,kCACKA,GADL,IAEEjF,MAAOX,KAAKuB,IAAI,EAAGqE,EAAEjF,MAAQq/E,GAC7Bn/E,IAAK+E,EAAE/E,IAAMm/E,EACbx/E,aAAcwwE,OAGjB9a,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAEssE,QAAUj5C,EAAEi5C,WAEhC,UAAA74D,EAAQgpE,mBAAR,cAAAhpE,EAAsB,CACpBhR,KAAM,GAAF,OAAK+pE,GACTsB,SAAU,CACRjlE,KAAM,yBACNmC,QAASsxE,EACTpgE,cAAe,CAACswD,GAChB7lC,QAAS,CACP99B,KAAM,4BACN6zE,mBAAmB,EACnBx3D,SAAU,CACR,CACE9oB,MAAO,EACPE,IAAKsxE,EACLxgC,IAAK+uC,EACLjgF,QAASoqD,EACTnjB,SAAU,GAAF,OAAK1nC,KAAKkhF,gBAO5BlpE,EAAQuvB,QAAQ,oBAAqB,CACnCn6B,KAAM,oBACNyU,MAAO,CACL,CACEzU,KAAM,mBACNk1D,YAAY,EACZ/iE,SAAU,EACVE,QAAS2yE,EAAYzyD,EAAKvgB,MAC1BI,iBAAkBuhF,EAClB54C,OAAQ,CACN,CACEjlC,GAAI,GAAF,OAAKlD,KAAKkhF,UACZ9zE,KAAM,yBACNqT,cAAe,CAACuwD,GAChBnmE,cAAei2E,EAAkBvxE,QACjCw5B,SAAU,CACR,CACE7lC,GAAI,GAAF,OAAKlD,KAAKkhF,UACZ9zE,KAAM,iCACN+zE,aAAa,EACbC,iBAAiB,EACjB/9E,OAAQ,GACRwH,cAAe,GAAF,OAAKg2E,EAAL,wCAMvB,CACEzzE,KAAM,mBACNk1D,YAAY,EACZ/iE,SAAU,EACVE,QAAS0yE,EAAcxyD,EAAKvgB,MAC5BI,iBAAkB,CAChB,CACEgB,aAAcuwE,EACdpwE,MAAO,EACPE,IAAKsxE,EACL1xE,QAASoqD,IAGb1iB,OAAQ,CACN,CACEjlC,GAAI,GAAF,OAAKlD,KAAKkhF,UACZ9zE,KAAM,yBACNvC,cAAeg2E,EACf93C,SAAU,CACR,CACE7lC,GAAI,GAAF,OAAKlD,KAAKkhF,UACZ9zE,KAAM,iCACN+zE,aAAa,EACbC,iBAAiB,EACjB/9E,OAAQ,GACRwH,cAAe,GAAF,OAAKg2E,EAAL,uCAZf,mBAgBAV,EACA,CACE,CACEj9E,GAAI,GAAF,OAAKlD,KAAKkhF,UACZ9zE,KAAM,oBACNvC,cAAe,CACb0E,QAAS,YACTkR,cAAe,CAACswD,GAChB/pE,KAAM,eACNoG,KAAM,oBACN89B,QAAS,CACP99B,KAAM,oBACN6zE,mBAAmB,EACnBx3D,SAAUgrC,EAAKziB,MAAM,KAAKrqC,KAAI,SAAC2oC,EAAO/jC,GACpC,MAAO,CACL5L,MAAO4L,EACP1L,IAAK0L,EAAQ,EACb9L,QAASoqD,EACTva,OAAQA,EACR5I,SAAU,QAAF,OAAUn7B,SAK1Bw8B,SAAU,CACR,CACE7lC,GAAI,GAAF,OAAKlD,KAAKkhF,UACZ9zE,KAAM,sBACN/J,OAAQ,QAKhB,OAIVgoE,iBAAkB,CAChB,CACEj+D,KAAM,eACNqT,gBACAyqB,QAAS,CACP99B,KAAM,oBACNqc,SAAUk3D,GAEZpxE,UACAvI,KAAMiI,IAGVk5B,OAAQ,CACN,CACEt9B,cAAe0E,EACfnC,KAAM,eACN27B,SAAU,CACR,CACE37B,KAAM,uBACNvC,cAAe,GAAF,OAAK0E,EAAL,6BAKrBiR,YAAa,GAAF,OAAKqqC,EAAL,eAAoBmmB,KAEjCj2D,IACA,MAAO6e,GACP8F,QAAQva,MAAMyU,GACduF,EAASvF,MAsDH,WA/BF,6BACE,kBAAC5c,GAAA,EAAD,2GAIA,kBAACqkE,GAAA,EAAD,S,mNA0CVr6E,KAAO,8B,6CAEP,SAAQkT,GACNA,EAAcgtB,aAAY,kBACxBhtB,EAAcoL,UAAUg8D,OAE1BpnE,EAAcgtB,aAAY,kBACxBhtB,EAAcoL,UAAUi8D,OAG1BrnE,EAAcmR,cAAa,WACzB,IAAM3F,EAAeH,8BACnB,eACA,GACA,CAAEK,kBAAmB0F,iCAAsBpR,KAE7C,OAAO,IAAIqR,IAAU,CACnBvkB,KAAM,eACN0e,eACAI,WAAY0F,gCACVtR,EACA,eACAwL,QAINxL,EAAcuR,gBAAe,WAC3B,IAAM/F,EAAe87D,GACnBtnE,GAEF,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,2BACN0e,eACAI,WAAY27D,GAA0C/7D,GACtDe,UAAW,eACXxE,SAAU,wBACVhI,eAAgBynE,QAGpBxnE,EAAcuR,gBAAe,WAC3B,IAAM/F,ETljBL,SAA6BxL,GAClC,OAAOqL,8BACL,uBACA,CACEq4D,SAAU,CACRxwE,KAAM,cACNgd,aAAc,IAEhBzE,SAAUxd,QAAMC,SACd8R,EAAc2sB,0BAA0B,YACxC,CAAEz5B,KAAM,0BAEVu0E,OAAQ,CAAEv0E,KAAM,UAAWgd,cAAc,IAE3C,CACExE,kBAAmBg8D,GAAkB1nE,GACrC2L,iBAAiB,ISkiBIg8D,CACnB3nE,GAEF,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,uBACN0e,eACAI,WAAYg8D,GAAsCp8D,GAClDe,UAAW,eACXxE,SAAU,oBACVhI,eAAgBynE,QAGpBxnE,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,uBACN0e,aAAcq8D,GACd7uC,aAAcisC,QAGpBjlE,EAAciR,iBACZ,kBACE,IAAI4zD,GAAsB,CACxB/3E,KAAM,wBACN0e,aAAcs8D,GACd/nE,eAAgBgoE,GAChB/nE,uB,uBAKR,SAAUA,GACJktB,gCAAsBltB,EAAc8S,YACtC9S,EAAc8S,UAAUqa,gBAAgB,CAAC,OAAQ,OAAQ,CACvDvX,MAAO,sBACP1W,KAAM8oE,KACNnoE,QAAS,SAAC/B,GACRA,EAAQuvB,QAAQ,oBAAqB,OAK3C,IAAMjsB,EAAW,SAACgJ,EAAkB/J,GAClC,OAAO+J,EACH,CACE,CACEwL,MAAO,qBACP1W,KAAMw3D,KACN72D,QAAS,WACP+M,qBAAWvM,GAASosB,mBAAmBk5C,GAAe,CACpDl1E,MAAOuc,6BAAmB3M,GAC1B+J,eAKR,IAGN,SAAS69D,EAAc/c,GACrB,OAAOA,EAAI7jC,mCAAmCzT,SAASxS,GAEzD,SAAS8mE,EAAYhd,GACnBA,EAAI/gC,qCAAqC/oB,GAE3C,SAASg3D,EAAe3yD,GACJ,qBAAdA,EAAKvS,MACPuS,EAAKwoB,OAAO9nC,SAAQ,SAAAsK,GACC,oBAAfA,EAAMyC,MACRzC,EAAMo+B,SAAS1oC,SAAQ,SAAAka,GAEF,wBAAjBA,EAAQnN,MACP+0E,EAAc5nE,GAIE,4BAAjBA,EAAQnN,MACRmN,EAAQutC,gBACPq6B,EAAc5nE,EAAQutC,gBAEvBs6B,EAAY7nE,EAAQutC,eANpBs6B,EAAY7nE,SAaxB2oB,oBAAQ,WAAM,MACNlrB,EAAO,UAAGkC,EAAc8S,iBAAjB,aAAG,EAAyBhV,QACrCA,GACFA,EAAQ6J,MAAMxhB,SAAQ,SAAAsf,GAChBA,EAAKkC,MACPlC,EAAKkC,MAAMxhB,SAAQ,SAAA04B,GAAC,OAAIu5C,EAAev5C,MAEvCu5C,EAAe3yD,a,GAvIEyM,K,cC/gBtB,SAAS5B,GAAkB9E,GAChC,OAAOvd,QACJuB,QACC,wBACAwyB,KACA/zB,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,yBACpB/b,cAAe2a,aAAuBE,MAIzC7D,OAAM,SAAAtY,GAAI,MAAK,CACd,gBACE,MAAO,iBAET,kBACE,OAAO,KAET,kBACE,8CACKA,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEwc,cAAexc,EAAKwc,cACpB/f,OAAQuD,EAAKsB,cAAc8a,YAG/B,uBACE,OAAOpc,EAAKsB,cAAc8a,SAASvY,U,cC5B3C,SAASi1E,GAAU,GAOhB,IAND/9D,EAMC,EANDA,QACAte,EAKC,EALDA,OAKC,IAJDs8E,aACEz/C,EAGD,EAHCA,EAGD,IAFCv/B,KAAQi/E,EAET,EAFSA,QAASC,EAElB,EAFkBA,SAAUlyC,EAE5B,EAF4BA,MAGvBmyC,EAAap8E,yBAAeL,EAAQ,aAAc,CAAEse,YAEpDo+D,EAAc54D,OAApB,GAEM64D,EAAN,KADkB,EAACH,EAAgBE,EAAnC,QAEA,OAAIC,EAAJ,GACE,KAGA,0BACE5tE,MAAO,CAAE9C,SAAF,EAAwB+C,KAAM4tE,gCAAqBH,IAC1D7/C,EAFF,EAGEC,EAAGA,IAAe8/C,EAHpB,IAIEE,WAJF,SAKEC,iBAAiB,WANrB,GA8BF,SAASC,GAAShvE,GAChB,IAAMivE,EAAqB,SAAAtsE,GAAS,IACNusE,EAAqBlvE,EADf,mBACGuQ,EAAYvQ,EADf,QAElC,KAGA,OAAOkvE,EAAQvsE,EAAO4N,EAAtB,OAGI4+D,EAAsB,SAAAxsE,GAAS,IACNusE,EAAqBlvE,EADf,oBACGuQ,EAAYvQ,EADf,QAEnC,KAGA,OAAOkvE,EAAQvsE,EAAO4N,EAAtB,OAGI6+D,EAAoB,SAAAzsE,GAAS,IACNusE,EAAqBlvE,EADf,kBACGuQ,EAAYvQ,EADf,QAEjC,KAGA,OAAOkvE,EAAQvsE,EAAO4N,EAAtB,OAGI8+D,EAAqB,SAAA1sE,GAAS,IACNusE,EAAqBlvE,EADf,mBACGuQ,EAAYvQ,EADf,QAElC,KAGA,OAAOkvE,EAAQvsE,EAAO4N,EAAtB,OAGI++D,EAAmB,SAAA3sE,GAAS,IACNusE,EAAqBlvE,EADf,iBACGuQ,EAAYvQ,EADf,QAEhC,KAGA,OAAOkvE,EAAQvsE,EAAO4N,EAAtB,OAGIg/D,EAAsB,SAAA5sE,GAAS,IACNusE,EAAqBlvE,EADf,oBACGuQ,EAAYvQ,EADf,QAEnC,KAGA,OAAOkvE,EAAQvsE,EAAO4N,EAAtB,OAGIi/D,EAAqB,SAAA7sE,GAAS,IACNusE,EAAqBlvE,EADf,mBACGuQ,EAAYvQ,EADf,QAElC,KAGA,OAAOkvE,EAAQvsE,EAAO4N,EAAtB,OAGIogB,EAAiB,SAAAhuB,GAAS,IACNusE,EAAqBlvE,EADf,eACGuQ,EAAYvQ,EADf,QAE9B,KAIA,OADA2C,oBACOusE,EAAQvsE,EAAO4N,EAAtB,OAIAA,EAQEvQ,EA3EmB,QAoErB/N,EAOE+N,EA3EmB,SA2EnBA,EA3EmB,aAsEnByvE,EAtEmB,iBAuEnB3gD,EAvEmB,aAwEX2/C,EAxEW,WAwEDlyC,EAxEC,QA0ErB5mB,EACE3V,EA3EmB,kBA6EjB0vE,EAAa,CACjBzuE,KAAM3O,yBAAeL,EAAQ,cAAe,CAAEse,aAE5CwF,YAA8BA,OAAOxF,EAAzC,QACEm/D,cAGF,IAAMC,EAAa,CACjB1uE,KAAM3O,yBAAeL,EAAQ,aAAc,CAAEse,aAGzCg7C,EAAcj5D,yBAAeL,EAAQ,cAAe,CAAEse,YAE5D,OACE,uBAAGnL,cAAamL,QACd,+BAAQje,yBAAeL,EAAQ,UAAW,CAAEse,aAC5C,4BACEq/D,GADF,EAEEC,GAAI/gD,EAFN,EAGE3X,EAHF,EAIEnW,MAJF,EAKEoC,YALF,EAMEk4C,aANF,EAOE7lC,WAPF,EAQED,YARF,EASE+lC,UATF,EAUEzqB,aAVF,EAWEhI,YAXF,EAYE9iB,QAZF,EAaEw1C,QAbF,EAcE/xC,OAAQ2lE,IAETX,YACC,4BACEmB,GADF,EAEEC,GAAI/gD,EAFN,EAGE3X,EAAGs3D,EAHL,EAIEztE,MAJF,EAKEoC,YALF,EAMEk4C,aANF,EAOE7lC,WAPF,EAQED,YARF,EASE+lC,UATF,EAUEzqB,aAVF,EAWEhI,YAXF,EAYE9iB,QAZF,EAaEw1C,QAbF,EAcE/xC,OAAQ2lE,IAGZ,yCAAsB7yC,MAAOA,MAyCnCyyC,gBAAwB,CACtBr5D,uBADsB,EAGtBs5D,wBAHsB,EAItBE,yBAJsB,EAKtBC,uBALsB,EAMtBC,wBANsB,EAOtBC,sBAPsB,EAQtBC,yBARsB,EAStBC,wBATsB,EAWtB7+C,oBAAgB1hC,GAEHsE,2BAAf,ICpOA,SAASu8E,GAAM9vE,GAAO,IAElBuQ,EAQEvQ,EAVgB,QAGlB/N,EAOE+N,EAVgB,SAUhBA,EAVgB,aAKhByvE,EALgB,iBAMhB3gD,EANgB,IAOR2/C,EAPQ,gBASlB94D,EACE3V,EAVgB,kBAYdgB,EAAQ,CAAEC,KAAM3O,yBAAeL,EAAQ,YAAa,CAAEse,aAI5D,OAHIwF,YAA8BA,OAAOxF,EAAzC,QACEvP,cAGA,0BACE8pD,GADF,EAEEK,GAFF,EAGEJ,GAHF,EAIEK,GAAIt8B,EAAI,EAJV,EAKExZ,OAAQhjB,yBAAeL,EAAQ,aAAc,CAAEse,YAC/Cg7C,YAAaj5D,yBAAeL,EAAQ,aAAc,CAAEse,cA0B1Du/D,gBAAqB,CACnBn6D,uBAAmB1mB,GAGNsE,2BAAf,IClDA,SAASw8E,GAAkB/vE,GACzB,IAgBMs7C,EAAe,SAAA34C,GAAS,IACNusE,EAAYlvE,EADN,aAE5B,KAGA,OAAOkvE,EAAP,IAGIp+C,EAAe,SAAAnuB,GAAS,IACNusE,EAAYlvE,EADN,aAE5B,KAGA,OAAOkvE,EAAP,IA2BF,cAA0B,IAChB3+D,EAAqCtB,EADrB,QACPvjB,EAA4BujB,EADrB,QACE1iB,EAAmB0iB,EADrB,OACUvf,EAAWuf,EADrB,OAGlB0pC,EAAW1sD,SAASskB,aAAqBA,MAA9BtkB,UAAjB,EACM+jF,EAAW9mB,iBAAOvQ,EAAUpsD,EAAlC,GACMkiF,EAAWn8E,yBAAe2c,EAAD,gBAAwB,CAAEsB,YAEzD,GACEob,cACE,IAAIt7B,MAAM,mBAAV,4CACwDkgB,EAF1Dob,QAMFj8B,MAAW6gB,EAAX7gB,SAAmC++E,EAAnC/+E,EAAiD++E,EAAc,CAC7D79C,UAAWrgB,EADkD,KAE7Di+D,QAF6D,EAG7DC,SAH6D,EAI7DlyC,MAAOjqC,yBAAe2c,EAAD,eAAuB,CAAEsB,cA3ElB,MAgF9BsF,EAME7V,EAtF4B,QAiF9BtU,EAKEsU,EAtF4B,QAkF9BtQ,EAIEsQ,EAtF4B,OAmF9B/N,EAGE+N,EAtF4B,OAoF9B0V,EAEE1V,EAtF4B,SAqFd2V,EACd3V,EAtF4B,+BAwFzBzT,EAxFyB,oBAyF1B0jF,EAAN,GACMC,EAAN,GA1FgC,eA2FVx6D,EA3FU,cA2FhC,2BAAyC,CACvCy6D,EAAW,CACT5/D,QAFqC,QAGrC7kB,QAFS,EAGTa,OAHS,EAIT0F,OAJS,EAKTvC,YAjG4B,mDAqGLA,eArGK,cAqGhC,2BAA8D,KAAnD6+E,EAAmD,QACtDh+D,EAAUmF,MAAa64D,OAA7B,WACA2B,OACE,yCAEE3B,aAFF,EAGEh+D,QAHF,EAIE1iB,IAAG,gBAAW0iB,EAJhB,MAKEoF,kBAAmBA,OA7GO,mDAkHLjmB,eAlHK,cAkHhC,2BAA8D,KAAnD6+E,EAAmD,QACtDh+D,EAAUmF,MAAa64D,OAA7B,WACA2B,OACE,yCAEE3B,aAFF,EAGEh+D,QAHF,EAIE1iB,IAAG,eAAU0iB,EAJf,MAKEoF,kBAAmBA,OA1HO,8BA+HhC,IAAMtqB,GAASkB,MAAaA,EAAd,OAAd,EACM+C,EAASI,EAAf,iBAEA,OACE,yBACEoS,UADF,oBAEEzW,MAFF,EAGEiE,OAHF,EAIE0R,MAAO,CACLtQ,SAAU,YAEZ0S,YAzIgB,SAAAT,GAAS,IACNusE,EAAYlvE,EADN,YAE3B,KAGA,OAAOkvE,EAAP,IAqIE3zB,UAlIc,SAAA54C,GAAS,IACNusE,EAAYlvE,EADN,UAEzB,KAGA,OAAOkvE,EAAP,IA8HE5zB,aATF,EAUExqB,aAVF,EAWEtb,YA7GgB,SAAA7S,GAAS,IACNusE,EAAYlvE,EADN,YAE3B,KAGA,OAAOkvE,EAAP,IAyGEz5D,WAtGe,SAAA9S,GAAS,IACNusE,EAAYlvE,EADN,WAE1B,KAGA,OAAOkvE,EAAP,IAkGE1zB,QAbF,EAcE/xC,OAdF,EAeEzD,QAjGY,SAAArD,GAAS,IACNusE,EAAYlvE,EADN,QAEvB,KAGA,OAAOkvE,EAAP,KA6EA,EADF,GAiDFa,gBAAiC,CAC/B99D,aAD+B,GAG/ByD,SAAU,IAHqB,IAK/BtS,iBAL+B,EAM/Bm4C,eAN+B,EAO/BD,kBAP+B,EAQ/BxqB,kBAR+B,EAS/Btb,iBAT+B,EAU/BC,gBAV+B,EAW/BzP,aAAS/W,GAGIsE,2BAAf,ICxMeie,iCACb,mBACA,CACE4D,YAAa,CACX/b,KAAM,QACNiC,YAAa,mCACb+a,aAAc,QACdC,gBAAiB,CAAC,YAEpBo4D,WAAY,CACVr1E,KAAM,QACNiC,YAAa,mCACb+a,aAAc,UACdC,gBAAiB,CAAC,YAEpBi1C,YAAa,CACXlyD,KAAM,SACNiC,YAAa,8BACb+a,aAAc,EACdC,gBAAiB,CAAC,YAEpBnE,OAAQ,CACN9Y,KAAM,SACNiC,YAAa,yCACb+a,aAAc,oDACdC,gBAAiB,CAAC,YAEpB85D,QAAS,CACP/2E,KAAM,SACNiC,YACE,sEACF+a,aAAc,2BACdC,gBAAiB,CAAC,YAEpB+5D,eAAgB,CACdh3E,KAAM,SACNiC,YAAa,6CACb+a,aAAc,GAEhBi6D,WAAY,CACVj3E,KAAM,QACNiC,YAAa,8BACb+a,aAAc,QACdC,gBAAiB,CAAC,YAEpBi6D,WAAY,CACVl3E,KAAM,SACNiC,YAAa,wCACb+a,aAAc,EACdC,gBAAiB,CAAC,YAEpBimB,MAAO,CACLljC,KAAM,SACNiC,YACE,kFACF+a,aAAc,4BACdC,gBAAiB,CAAC,aAGtB,CAAExE,iBAAiB,I,WC7CR0+D,GAAb,WAKE,cAA0C,IAA5BnlF,EAA4B,EAA5BA,MACZ,GADwC,yBAJ1CA,WAI0C,OAF1ColF,YAAc,EAE4B,KAO1CC,MAAsB,GAPoB,KAS1ChhF,OAAoB,IAAIf,IATkB,KAW1CgiF,aAAc,GAVPtlF,EACH,MAAM,IAAIgF,MAAM,+CAElBxB,KAAKxD,MAAQA,EATjB,uCAkBE,SACEsoC,EACA87C,EACApkF,EACAiE,EACAC,GAEAV,KAAK6hF,MAAM3iF,KAAK,CAAE4lC,WAAU87C,iBAAgBpkF,QAAOiE,SAAQC,SAC3DV,KAAK8hF,aAAc,IA1BvB,uBAgCE,SAAU75E,GACR,IAAKjI,KAAK8hF,YACR,OAAO9hF,KAAKa,OAEd,IAAKoH,EACH,MAAM,IAAIzG,MAAM,iCAYlB,IATA,IAAMo+B,EAAOn8B,yBAAewE,EAAe,kBAIrC85E,EAAS/hF,KAAK6hF,MAAMvuB,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAEjB,KAAKgtC,MAAQ1Y,EAAEt0B,KAAKgtC,SAG3Ds0C,EAAY,EACVC,EAAyChrE,MAAM8qE,EAAOxiF,QACnDyzB,EAAI,EAAGA,EAAI+uD,EAAOxiF,OAAQyzB,GAAK,EAAG,CASzC,IARA,IAAMkvD,EAAcH,EAAO/uD,GACnB4tD,EAAkCsB,EAAlCtB,eAAgBpkF,EAAkB0lF,EAAlB1lF,MAAOiE,EAAWyhF,EAAXzhF,OACzB1C,EAAQ6iF,EAAiBpkF,EAAQ,EACjCyB,EAAMF,EAAQvB,EAChByY,EAAM2qB,EACNxhB,EAASnJ,EAAMxU,EAGVquC,EAAI,EAAGA,EAAI9b,EAAG8b,GAAK,EAAG,KACpBqzC,EADoB,YACMF,EAAcnzC,GADpB,MAGxBszC,EAIDD,EAJFniD,EACGqiD,EAGDF,EAHFliD,EAIIqiD,EAAUF,EADZD,EAFF3lF,MAII+lF,EAAaF,EAFfF,EADF1hF,OAKA2yD,aAAegvB,EAAWE,EAASvkF,EAAOE,IAC1Cm1D,aAAeivB,EAASE,EAAYttE,EAAKmJ,KAIzCA,GADAnJ,EAAMstE,GACS9hF,EACfquC,GAAK,GAKTmzC,EAAcjvD,GAAK,CACjBkvD,EAAYp9C,SADK,2BAEZo9C,GAFY,IAECliD,EAAGjiC,EAAOkiC,EAAGhrB,KAE7BmJ,EAAS4jE,IACXA,EAAY5jE,GAShB,OAHApe,KAAK4hF,YAAcI,EACnBhiF,KAAKa,OAAS,IAAIf,IAAImiF,GACtBjiF,KAAK8hF,aAAc,EACZ9hF,KAAKa,SA9FhB,4BAiGE,WACE,GAAIb,KAAK8hF,YACP,MAAM,IAAItgF,MAAM,0DAElB,OAAOxB,KAAK4hF,cArGhB,6BAwGE,WACE,OAAO5hF,KAAKiB,WAzGhB,oBA4GE,WACE,GAAIjB,KAAK8hF,YACP,MAAM,IAAItgF,MAAM,kDAElB,MAAO,CAAEghF,MAAO,YAAIxiF,KAAKyiF,aAAcb,YAAa5hF,KAAK+4B,qBAhH7D,uBAmHE,WACE,MAAM,IAAIv3B,MAAM,qBApHpB,KAwHakhF,GAAb,WAKE,cAMG,IALDF,EAKC,EALDA,MACAZ,EAIC,EAJDA,YAIC,yBAVH/gF,YAUG,OARH+gF,iBAQG,EACD5hF,KAAKa,OAAS,IAAIf,IAAI0iF,GACtBxiF,KAAK4hF,YAAcA,EAbvB,uCAgBE,SAAI98C,GACF,IAAK9kC,KAAKa,OAAO8B,IAAImiC,GACnB,MAAM,IAAItjC,MAAJ,sDAAyDsjC,MAlBrE,uBAsBE,WACE,OAAO9kC,KAAKa,SAvBhB,4BA0BE,WACE,OAAOb,KAAK4hF,eA3BhB,uBA8BE,SACEzzD,GAEA,OAAO,IAAIu0D,EAA0Bv0D,OAjCzC,KClIMw0D,G,gKACJ,WAAa,MAGY3iF,KAAKgnB,QAHjB,GAILjoB,GAJK,eAIqBiB,KAAhC,QACA,OAAO,IAAIN,GAAJ,KAAgC,CAAElD,MAAOuC,M,2BAGlD,WACE,OAD0B,M,GATMquD,M,sKAelC,YACE,OAAO,IAAI,GAAX,K,uCAGF,YACE,OAAO,IAAI,GAAX,O,GANyBt7B,M,+MCN3B1tB,KAAO,iB,6CAEP,SAAQkT,GACNA,EAAciR,iBACZ,kBACE,IAAIq6D,GAAiB,CACnBx+E,KAAM,mBACNiT,eAAgBwrE,GAChB//D,aAAcggE,GACdxrE,qBAINA,EAAcuR,gBAAe,WAC3B,IAAM/F,ECxBL,SAA6BxL,GAClC,OAAOqL,8BACL,wBACA,CAAEI,SAAUzL,EAAc2sB,0BAA0B,aACpD,CACEjhB,kBAAmBgV,KACnB/U,iBAAiB,IDkBI8/D,CACnBzrE,GAEF,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,wBACN0e,eACAI,WAAY8/D,GAAuClgE,GACnDe,UAAW,gBACXxE,SAAU,mBACVhI,eAAgB4R,c,GAxBKO,K,mKEThB1G,GAAeH,8BAAoB,cAAzC,IAEMO,GAAa,4BAA2B,CACnD5iB,GADmD,YAEnDkK,KAAMjF,iCCJKud,GAAeH,8BAAoB,aAAzC,IAEMO,GAAa,2BAA0B,CAClD5iB,GADkD,YAElDkK,KAAMjF,gCCJKud,GAAeH,8BAAoB,sBAAuB,IAE1DO,GAAa3d,QAAMnJ,MAAM,sBAAuB,CAC3DkE,GAAIgF,YACJkF,KAAMjF,QAAMye,QAAQ,yBCJTlB,GAAeH,8BAAoB,iBAAzC,IAEMO,GAAa,+BAA8B,CACtD5iB,GADsD,YAEtDkK,KAAMjF,oC,+MC4BNnB,KAAO,c,6CAEP,SAAQkT,GACNA,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,cACNglB,QAAS,QACTtG,aAAcmgE,GACd//D,WAAYggE,GACZ7rE,eAAgBkS,gBACd,kBAAM,wCAKZjS,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,aACNglB,QAAS,OACTtG,aAAcqgE,GACdjgE,WAAYkgE,GACZ/rE,eAAgBkS,gBACd,kBAAM,wCAKZjS,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,sBACNglB,QAAS,iBACTtG,aAAcugE,GACdngE,WAAYogE,GACZjsE,eAAgBkS,gBACd,kBAAM,+DAKZjS,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,iBACNglB,QAAS,WACTtG,aAAcygE,GACdrgE,WAAYsgE,GACZnsE,eAAgBkS,gBACd,kBAAM,0C,uBAMd,SAAUjS,GACJktB,gCAAsBltB,EAAc8S,aACtC9S,EAAc8S,UAAUi8C,aAAa,OAAQ,CAC3Cn5C,MAAO,QACP1W,KAAMitE,KACNtsE,QAAS,SAAC/B,GACR,IAAM8B,EAAS9B,EAAQuP,UAAU,cAAe,eAChDvP,EAAQ0P,WAAW5N,MAGvBI,EAAc8S,UAAUi8C,aAAa,OAAQ,CAC3Cn5C,MAAO,OACP1W,KAAMktE,KACNvsE,QAAS,SAAC/B,GACR,IAAM8B,EAAS9B,EAAQuP,UAAU,aAAc,cAC/CvP,EAAQ0P,WAAW5N,MAGvBI,EAAc8S,UAAUu5D,aACtB,OACA,CACEz2D,MAAO,iBACP1W,KAAMotE,KACNzsE,QAAS,SAAC/B,GACR,IAAMyuE,EAAc,IAAIC,KACtB,CAAC1mD,KAAKE,UAAU,CAAEloB,QAAS4U,sBAAY5U,IAAY,KAAM,IACzD,CAAE5K,KAAM,6BAEVu5E,kBAAOF,EAAa,kBAGxB,GAEFvsE,EAAc8S,UAAUu5D,aACtB,OACA,CACEz2D,MAAO,uBACP1W,KAAMwtE,KACN7sE,QAAS,SAAC/B,GACR,IAAM8B,EAAS9B,EAAQuP,UACrB,sBACA,uBAEFvP,EAAQ0P,WAAW5N,KAGvB,GAEFI,EAAc8S,UAAUu5D,aACtB,OACA,CACEz2D,MAAO,qBACP1W,KAAMytE,KACN9sE,QAAS,SAAC/B,GACR,IAAM8B,EAAS9B,EAAQuP,UAAU,iBAAkB,kBACnDvP,EAAQ0P,WAAW5N,KAGvB,GAEFI,EAAc8S,UAAUu5D,aACtB,OACA,CACEz2D,MAAO,eACP1W,KAAM0tE,KACN/sE,QAAS,SAAC/B,GAEJA,EAAQ+uE,4BAEV/uE,EAAQ+uE,4BAER/uE,EAAQq0C,OAAR,yBAAiCr0C,EAAQhR,KAAzC,KAAkD,cAIxD,GAEFkT,EAAc8S,UAAUu5D,aACtB,OACA,CACEz2D,MAAO,oBACP1W,KAAM4tE,KACNjtE,QAAS,SAAC/B,GAAkC,MAC1C,UAAAA,EAAQivE,+BAAR,cAAAjvE,KAGJ,Q,GA3IqBoU,K,sBCeR86D,G,kDAanB,WAAmBlhF,GAAyC,kCAC1D,cAAMA,IAbAmI,cAYoD,IAVpDg5E,mBAUoD,IARpDC,2BAQoD,IANpDC,2BAMoD,IAJpDC,oBAIoD,IAFpDxwD,cAEoD,EAE1D,EAAK3oB,SAAW9H,yBAAeL,EAAQ,YAAYgE,IACnD,EAAKm9E,cAAgB9gF,yBAAeL,EAAQ,iBAC5C,EAAKqhF,sBAAwBhhF,yBAAeL,EAAQ,yBACpD,EAAKohF,sBAAwB/gF,yBAAeL,EAAQ,yBACpD,EAAKshF,eAAiBjhF,yBAAeL,EAAQ,YANa,E,sFAS5D,yGAAyBM,EAAzB,+BAA6C,IACvC1D,KAAKk0B,SADX,yCAEWl0B,KAAKk0B,UAFhB,UAIMA,EAAW,IACXl0B,KAAKwkF,sBALX,wBAMUD,EAAgBI,mBAAmB3kF,KAAKwkF,uBANlD,SAO0BxkF,KAAK4kF,YAAYL,EAAe7gF,GAP1D,OAOU22C,EAPV,OAQInmB,EAAWl0B,KAAK6kF,kBAAkBxqC,GARtC,wBASar6C,KAAK0kF,iBACdxwD,EAAWl0B,KAAK0kF,gBAVpB,eAYE1kF,KAAKk0B,SAAWA,EAZlB,kBAaSA,GAbT,iD,+EAgBA,SAAmB4wD,GAAiD,WAAxBphF,EAAwB,uDAAJ,GAC9D,OAAOe,4BAAgB,uCAAU,WAAMC,GAAN,mBAAA/C,EAAA,6DACzBojF,EAAiBJ,mBACrB7mC,KAAO,EAAKymC,cAAeO,IAErBjnF,EAAYinF,EAAZjnF,QAJuB,SAKT,EAAK+mF,YAAYG,EAAgBrhF,GALxB,OAKzB22C,EALyB,OAM/B,EAAK2qC,kBAAkB3qC,EAASx8C,GAASJ,SAAQ,SAAAikB,GAC/Chd,EAAS+oC,KAAK/rB,MAEhBhd,EAASovB,WATsB,2CAAV,sDAUpBpwB,EAAKa,U,gEAIV,WAA0BugF,EAAephF,GAAzC,kFACM+gF,EAAwB,GACxBzkF,KAAKykF,sBAAsBllF,SAC7BklF,EAAwB,IAAH,OAAOzkF,KAAKykF,sBAAsB3mE,KAAK,OAExDvZ,EAASb,GAAQA,EAAKa,OAL9B,SAMyBypB,MAAM,GAAD,OACvBhuB,KAAKuL,SADkB,kBACAu5E,GADA,OACQL,GAClC,CACE1uD,QAAS,CAAEkvD,OAAQ,oDACnB1gF,WAVN,cAMQ2yB,EANR,yBAaSA,EAAS/I,QAblB,gD,wFAgBA,SAA0B+I,GACxB,IAAMguD,IAAShuD,GAAY,IAAImjB,SAAW,IAAI8qC,UAAY,GAC1D,IAAKD,EAAK3lF,OACR,MAAO,GAGT,IADe23B,EAASkuD,KAAKC,KACjBn6D,SAAS,WACnB,MAAM,IAAI1pB,MAAM,yDAElB,OAAO0jF,EAAKngF,KAAI,SAAA0rE,GAAG,OAAIA,EAAI5yE,QAAQoF,W,+BAGrC,SACEo3C,EACAx8C,GAEA,IAAMqnF,IAAS7qC,GAAW,IAAIA,SAAW,IAAI8qC,UAAY,GACzD,IAAKD,EAAK3lF,OACR,MAAO,GAET,IAAMytE,EAAS3yB,EAAQ+qC,KAAKC,KACL,CAAC,QAAS,MAAO,YACzB5nF,SAAQ,SAAA6nF,GAChBtY,EAAO9hD,SAASo6D,IACnBxoD,QAAQva,MAAR,yBACoB+iE,EADpB,kCAKJ,IAAMC,EAA8C,GACpDL,EAAKznF,SAAQ,SAAAgzE,GACX,IAAM+U,EAAoC,CAAC,IAC3CxY,EAAOvvE,SAAQ,SAAAivC,GACb,GAAIA,KAAS+jC,EAAK,CAGhB,IAHgB,IACRxtE,EAAUwtE,EAAI/jC,GAAdzpC,MACJk1D,EAAM,EACHzrB,EAAMzD,WAAW,SACtByD,EAAQA,EAAM4O,MAAM,GACpB6c,GAAO,EAET,KAAOA,EAAMqtB,EAAQjmF,OAAS,GAC5BimF,EAAQtmF,KAAK,IAEfsmF,EAAQrtB,GAAKzrB,GAASzpC,MAI1BuiF,EAAQ/nF,SAAQ,SAACgoF,EAAIttB,GAAQ,IACnBrzB,EAAa2gD,EAAb3gD,SACJqzB,EAAMqtB,EAAQjmF,OAAS,IACzBimF,EAAQrtB,EAAM,GAAGutB,eAAiB5gD,GAEpCygD,EAAazgD,GAAY,CACvBpkC,KAAM,2BACD+kF,GADD,IAEF3gD,WACAjnC,UACAE,MAAO6nB,SAAS6/D,EAAG1nF,MAAO,IAC1BE,IAAK2nB,SAAS6/D,EAAGxnF,IAAK,IACtBgnC,OAAQrf,SAAS6/D,EAAGxgD,OAAQ,KAAO,WAO3C,cAA4BlhC,OAAOhD,QAAQwkF,GAA3C,eAA0D,2BAA9CzgD,EAA8C,KAApC9hC,EAAoC,KAClD2iF,EAAM3iF,EAAEtC,KAAKglF,eAEnB,UADO1iF,EAAEtC,KAAKglF,eACVC,EAAK,CACP,IAAMx7D,EAAIo7D,EAAaI,GACvB,GAAIx7D,EACGA,EAAEzpB,KAAKskC,cACV7a,EAAEzpB,KAAKskC,YAAc,IAEvB7a,EAAEzpB,KAAKskC,YAAY9lC,KAAnB,2BACK8D,EAAEtC,MADP,IAEEokC,qBAEKygD,EAAazgD,OACf,CACL,IADK,EACCE,EAAcjhC,OAAOrB,OAAO6iF,GAC/BxgF,KAAI,SAAA6gF,GAAE,OAAIA,EAAGllF,KAAKskC,eAClBla,QAAO,SAAA86D,GAAE,QAAMA,KACfvL,OACCwL,GAAQ,EALP,eAMoB7gD,GANpB,IAML,2BAAsC,KAA3B8gD,EAA2B,QACpC,GAAIA,GAAcA,EAAWhhD,WAAa6gD,EAAK,CACxCG,EAAW9gD,cACd8gD,EAAW9gD,YAAc,IAE3B8gD,EAAW9gD,YAAY9lC,KAAvB,2BACK8D,EAAEtC,MADP,IAEEokC,qBAEKygD,EAAazgD,GACpB+gD,GAAQ,EACR,MACSC,GAAcA,EAAW9gD,aAClCA,EAAY9lC,KAAZ,MAAA8lC,EAAW,YAAS8gD,EAAW9gD,eAnB9B,8BAsBA6gD,GACH/oD,QAAQva,MAAR,kCAAyCojE,MAMjD,OAAO5hF,OAAOlB,KAAK0iF,GAAcxgF,KAC/B,SAAAghF,GAAW,OACT,IAAI9gF,IAAJ,2BACKsgF,EAAaQ,GAAarlF,MAD/B,IAEEokC,SAAUihD,EACV/gD,YAAaugD,EAAaQ,GAAarlF,KAAKskC,oB,sEAKpD,WACEnnC,GADF,4FAEE6F,EAFF,+BAEsB,GAFtB,SAIyB1D,KAAKi0B,YAAYvwB,GAJ1C,YAIQwwB,EAJR,QAKe30B,QAAW20B,EAAShJ,SAASrtB,GAL5C,0CAMW,GANX,iCAQS,GART,gD,kFAWA,gB,GAvMyCsH,0BChD5Bwd,iCACb,gBACA,CACEpX,SAAU,CACRf,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,+BACrBqF,YAAa,8BAEf83E,cAAe,CACb/5E,KAAM,OACNgd,aAAc,GACd/a,YACE,kFAEJ+3E,sBAAuB,CACrBh6E,KAAM,OACNgd,aAAc,GACd/a,YACE,wEAEJynB,SAAU,CACR1pB,KAAM,cACNgd,aAAc,GACd/a,YACE,kGAEJg4E,sBAAuB,CACrBj6E,KAAM,cACNgd,aAAc,GACd/a,YACE,kEAGN,CAAEwW,iBAAiB,IC3BA+iE,G,4MACnB5hF,KAAO,Y,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,gBACN0e,aAAcmjE,GACd31C,aAAc41C,Y,GATe18D,KCNxB7G,iCACb,oBACA,CACEzX,cAAe,CACbV,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,uBAEvB+D,YAAa,CACXX,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,2BAEvBgE,YAAa,CACXZ,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,4BAGzB,CAAE6b,iBAAiB,IChBNN,iCACb,oBACA,CACEwjE,mBAAoB,CAClB37E,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,kCAGzB,CAAE6b,iBAAiB,ICqBrB,SAASmjE,GAAYj1E,GAoCnB,IA1BC,IAECk1E,EASEl1E,EATFk1E,WACAt3C,EAQE59B,EARF49B,IACAu3C,EAOEn1E,EAPFm1E,MACAzpF,EAMEsU,EANFtU,QACAa,EAKEyT,EALFzT,OACA+C,EAIE0Q,EAJF1Q,OACAw/B,EAGE9uB,EAHF8uB,EARD,EAWG9uB,EAFFoqC,eATD,SAUCjqC,EACEH,EADFG,MAEIsoC,EAAQ/8C,EAIR0pF,EAAO,EAAK7oF,EAAOK,MAAQ,EAK3ByoF,GAAkBF,EAAQC,EAAO,GAAK,EAEtCE,EAAY13C,EAAIuM,MAAMkrC,GAEtBE,EAAkD,GAC/C1zD,EAAI,EAAGA,EAAIyzD,EAAUlnF,OAAQyzB,GAAK,EAAG,CAC5C,IAAM2zD,EAAQF,EAAUnrC,MAAMtoB,EAAGA,EAAI,GAC/B4zD,EAAkBrrC,EAAUsrC,iBAAOF,GAASA,EAC5CG,EAAYT,EAAWO,IAAoB,GACjDF,EAAWxnF,KAAK,CAAE6nF,OAAQD,EAAWH,MAAOC,EAAgBv8E,gBAG9D,IAAMyyC,EAAK,EAAIlD,EAAS,EAClBotC,EAAwB,IAAjBtpF,EAAOK,MAAc,EAAI++C,EAChCpJ,EAAS,EAAI72C,GAAW,GACxBL,GAASkB,EAAOO,IAAMP,EAAOK,OAASlB,EAEtCkI,EAAM,CAAC,UAAW,UAAW,WAAWw2C,UAC9C,OACE,oCACGmrC,EAAW3hF,KAAI,SAACkiF,EAASt9E,GACxB,IAAMq2B,EAAItiC,EAAOQ,SACb1B,GAASsgD,GAAKnzC,EAAQ,GAAK68E,EAAiB5sC,EAAQotC,GACpDlqC,EAAInzC,EAAQ68E,EAAiB5sC,EAAQotC,EACjCD,EAAkBE,EAAlBF,OAAQJ,EAAUM,EAAVN,MAChB,OACE,kBAAC,IAAM/jD,SAAP,CAAgB5jC,IAAG,UAAK2K,EAAL,YAAco9E,IAC/B,0BACE/mD,EAAGA,EACHC,EAAGA,EACHzjC,MACEk3C,EAASoJ,EAAIA,EAAI,GAEnBr8C,OAAQA,EACRgmB,OAAQitB,EAAS,OAAS,OAC1BthC,KACE80E,gBAAch8D,SAASy7D,GACnBr1E,EAAMjE,QAAQI,WACd05E,eAAaj8D,SAASy7D,GACtBr1E,EAAMjE,QAAQG,UACdzI,EAAI3H,KAAKshD,IAAI4nC,MAGpB5yC,EACC,0BACE1T,EAAGA,EAAI8c,EAAI,EACX7c,EAAGA,EAAIx/B,EAAS,EAChBy/E,iBAAiB,SACjBD,WAAW,UAEV8G,GAED,UAQhB,SAASK,GAAIj2E,GAQV,IACOtU,EAAoDsU,EAApDtU,QAASa,EAA2CyT,EAA3CzT,OAAQgkB,EAAmCvQ,EAAnCuQ,QAASpQ,EAA0BH,EAA1BG,MAAO7Q,EAAmB0Q,EAAnB1Q,OAAQsuC,EAAW59B,EAAX49B,IAAK9O,EAAM9uB,EAAN8uB,EAChDyT,EAAS,EAAI72C,GAAW,GAF7B,EAIyBmvD,mBACxBtqC,EAAQvhB,IAAI,SACZuhB,EAAQvhB,IAAI,OACZzC,EACAb,GARD,mBAIMggD,EAJN,KAIckF,EAJd,KAUKxG,EAAU79C,EAAOQ,SACjB8wD,EAAMttC,EAAQvhB,IAAI,OAASuhB,EAAQvhB,IAAI,SACvC28C,EAAI1/C,KAAKuB,KAAKojD,EAAUlF,GAAUmS,EAAK,IAE7C,OACE,oCACGjgB,EAAIK,MAAM,IAAIrqC,KAAI,SAACgiF,EAAQp9E,GAC1B,IAAMmG,EAAQwB,EAAMjE,QAAQK,MAAMq5E,EAAO18E,eACnC21B,EAAIub,EAAUwG,GAAWp4C,EAAQ,GAAKmzC,EAAID,EAASlzC,EAAQmzC,EACjE,OACE,kBAAC,IAAMla,SAAP,CAAgB5jC,IAAK2K,GACnB,0BACEq2B,EAAGA,EACHC,EAAGA,EACHzjC,MAAOsgD,EACPr8C,OAAQA,EACR2R,KAAMtC,EAAQA,EAAM5C,KAAO,OAC3BuZ,OAAQitB,EAAS,OAAS,SAE3BA,EACC,0BACE1T,EAAGA,EAAI8c,EAAI,EACX7c,EAAGA,EAAIx/B,EAAS,EAChBy/E,iBAAiB,SACjBD,WAAW,SACX7tE,KAAMtC,EAAQkwE,gCAAqBlwE,EAAM5C,MAAQ,SAEhD65E,GAED,UAQhB,IAAMM,GAAc,SAAC,GAQV,IAPTrgE,EAOS,EAPTA,QACO2rC,EAME,EANTrhD,MAMS,IALTuV,gBAKS,MALE,IAAI/mB,IAKN,EAJTy+E,EAIS,EAJTA,YACA+I,EAGS,EAHTA,YACA9I,EAES,EAFTA,gBACA3hF,EACS,EADTA,QAEOa,EADE,YACQspB,EADR,MAEH1V,EAAQD,8BAAmBshD,GAC3B0zB,EAAakB,6BAAmBC,qBAE/B9lE,EALE,YAKamF,EAASnkB,UALtB,GAMT,IAAKgf,EACH,OAAO,KAET,IAAMqtB,EAAcrtB,EAAQvhB,IAAI,OAChC,IAAK4uC,EACH,OAAO,KAKT,IAAI68B,GAAS,GAEb,OACE,oCAGG4S,IAAoB9gF,EAAOQ,SAAWqgF,EAAc+I,GACjD,CAAC,EAAG,EAAG,GAAGviF,KAAI,SAAA4E,GAAK,OACjB,kBAACy8E,GAAD,CACEpnF,IAAG,sBAAiB2K,GACpBolC,IAAKA,EACL9O,EAAI2rC,GAAS,GACbya,WAAYA,EACZC,MAAO38E,EACP9M,QAASA,EACTa,OAAQA,EACR4T,MAAOA,EACP7Q,OA7BG,GA8BH86C,QAAS79C,EAAOQ,cAGpB,KAEHopF,EACC,kBAACF,GAAD,CACE3mF,OArCO,GAsCPw/B,EAAI2rC,GAAS,GACblqD,QAASA,EACThkB,OAAQA,EACRqxC,IAAKrxC,EAAOQ,SAAWupF,qBAAW14C,GAAOA,EACzClyC,QAASA,EACTyU,MAAOA,IAEP,KAEHitE,EACC,kBAAC6I,GAAD,CACE3mF,OAjDO,GAkDPw/B,EAAI2rC,GAAS,GACblqD,QAASA,EACThkB,OAAQA,EACRqxC,IAAKrxC,EAAOQ,SAAW6wC,EAAM04C,qBAAW14C,GACxClyC,QAASA,EACTyU,MAAOA,IAEP,KAIHktE,IAAoB9gF,EAAOQ,SAAWopF,EAAc/I,GACjD,CAAC,GAAI,GAAI,GAAGx5E,KAAI,SAAA4E,GAAK,OACnB,kBAACy8E,GAAD,CACEpnF,IAAG,0BAAqB2K,GACxBolC,IAAKA,EACL9O,EAAI2rC,GAAS,GACbya,WAAYA,EACZC,MAAO38E,EACP9M,QAASA,EACTa,OAAQA,EACR4T,MAAOA,EACP7Q,OAxEG,GAyEH86C,SAAU79C,EAAOQ,cAGrB,OAKJwpF,GAAU,SAAC,GAAqD,IAAnDllD,EAAmD,EAAnDA,UAAWhmC,EAAwC,EAAxCA,MAAOolF,EAAiC,EAAjCA,YAAazsE,EAAoB,EAApBA,SAChD,OAAOqtB,EACL,oCAAGrtB,GAEH,yBACE3Y,MAAOA,EACPiE,OAAQmhF,EACRzvE,MAAO,CAAE3V,QAAOiE,OAAQmhF,IAEvBzsE,IAkBQzQ,4BAbf,SAAkByM,GAAgB,IACxB6V,EAAqB7V,EAArB6V,QAASnqB,EAAYsU,EAAZtU,QACVa,EAFyB,YAEfspB,EAFe,MAG1BxqB,GAASkB,EAAOO,IAAMP,EAAOK,OAASlB,EAG5C,OACE,kBAAC,GAAD,iBAAasU,EAAb,CAAoBywE,YAHF,IAG4BplF,MAAOA,IACnD,kBAAC,GAAgB2U,OClSRwR,iCACb,sBACA,CACEliB,OAAQ,CACN+J,KAAM,SACNiC,YAAa,4CACb+a,aAAc,KAGlB,CAAEvE,iBAAiB,ICTNN,iCACb,sBACA,CACEzX,cAAe,CACbV,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,oBAEvB+D,YAAa,CACXX,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,yBAGzB,CAAE6b,iBAAiB,ICXRH,GAAeH,8BAC1B,iCACA,CAAEI,SAAU4kE,IACZ,CAAEvvD,mBAAoB,YAAanV,iBAAiB,ICJvCN,qCACb,gBACA,CACEtX,eAAgB,CACdb,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,sBAGzB,CAAE6b,iBAAiB,ICPN,YAAC3L,GACd,OAAOqL,8BACL,mBACA,CACEuqB,gBAAiB51B,EAAc2sB,0BAA0B,YAE3D,CAAEhhB,iBAAiB,KCNR,YAAC3L,GACd,MAAO,CACLwL,aAAcxL,EAAcoM,KAAKghC,IACjCt8B,gBAAiB,kBAAM,gCAA6BC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,c,ICkB9D6yE,G,4MACJztC,aAAc,E,uDAEd,SAAkBz8C,GAChB,kCACKA,GADL,IAEEK,MAAOX,KAAKuB,IAAIjB,EAAOK,MAAQ,EAAG,GAClCE,IAAKP,EAAOO,IAAM,Q,GAPUq8C,MAYbutC,G,4MACnBzjF,KAAO,iB,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,gBACN0e,aAAcglE,GACd1/D,gBAAiB,kBACf,8DAAwCC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,iBAI5DuC,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,oBACN0e,aAAcilE,GACd3/D,gBAAiB,kBACf,gCAAgDC,MAC9C,SAAAC,GAAC,OAAIA,EAAEvT,iBAKjBuC,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,sBACN0e,aAAcklE,GACd5/D,gBAAiB,kBACf,qDAAoDC,MAClD,SAAAC,GAAC,OAAIA,EAAEvT,iBAKjBuC,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,oBACN0e,aAAcmlE,GACd7/D,gBAAiB,kBACf,6DAAgDC,MAC9C,SAAAC,GAAC,OAAIA,EAAEvT,iBAKjBuC,EAAc2Q,gBACZ,kBACE,IAAIC,IAAJ,aACE9jB,KAAM,oBACHkT,EAAcoM,KAAKwkE,SAG5B5wE,EAAcmR,cAAa,WACzB,IAAM3F,ECpFL,SAAuCxL,GAC5C,OAAOqL,8BACL,yBACA,CACE2lB,QAAShxB,EAAc2sB,0BAA0B,WACjDkC,SAAU5gC,QAAM6oB,MAAM9W,EAAc2sB,0BAA0B,YAC9DoE,SAAU,CACR79B,KAAM,SACNiC,YAAa,mCACb+a,aAAc,KAGlB,CACE+gB,mBAAoB,SAAA7T,GAClB,IAAMhtB,EAAO01B,KAAKC,MAAMD,KAAKE,UAAU5I,IACjCuT,EAAe,IAAInlC,IAFF,EAGG4E,EAAlBy+B,gBAHe,MAGJ,GAHI,EAmBvB,MAfqB,kBAAjBz+B,EAAKiF,UAIPw5B,EAAS1oC,SAAQ,SAAC4U,GAAD,OAAYA,GAAK41B,EAAallC,IAAIsP,EAAE7H,SACnC8M,EAAcgI,aAAa5X,EAAK8C,MACxCy9B,aAAaxqC,SAAQ,SAAA0pC,GACxBc,EAAatlC,IAAIwkC,EAAY/iC,OAChC+hC,EAASjnC,KAAK,CACZ6nC,UAAW,GAAF,OAAKr/B,EAAKiF,QAAV,YAAqBw6B,EAAY/iC,MAC1CoG,KAAM28B,EAAY/iC,WAK1B,2BAAYsD,GAAZ,IAAkBy+B,cAEpB/N,mBAAoB,UACpBnV,iBAAiB,EACjBvc,QAAS,SAACC,GAAD,MAAgB,CACvB6hC,eADuB,SACRL,GAAkD,IACvD39B,EAAS29B,EAAT39B,KACR,IAAKA,EACH,MAAM,IAAIhJ,MAAJ,+BAAkCgJ,IAE1C,IAAMmN,EAAUhR,EAAKw/B,SAAStP,MAC5B,SAACxkB,GAAD,OAAYA,GAAKA,EAAE00B,YAAcoB,EAAYpB,aAE/C,GAAIpvB,EACF,OAAOA,EAET,IAAMpY,EAASoH,EAAKw/B,SAASjnC,KAAKipC,GAClC,OAAOxhC,EAAKw/B,SAAS5mC,EAAS,QDmCb4oF,CAA8B7wE,GAEnD,OAAO,IAAIqR,IAAU,CACnBvkB,KAAM,yBACN0e,eACAI,WAAY0F,gCACVtR,EACA,yBACAwL,QAKNxL,EAAcuR,gBAAe,WAC3B,IElGuB/F,EFkGjBI,GElGiBJ,EFmGrBslE,GElGC7iF,QACJuB,QACC,iCACAwyB,KACA/zB,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,kCACpB/b,cAAe2a,iCAAuBE,GACtCwkE,YAAa/hF,QAAMC,SAASD,QAAMkB,SAAS,GAC3C83E,YAAah5E,QAAMC,SAASD,QAAMkB,SAAS,GAC3C+3E,gBAAiBj5E,QAAMC,SAASD,QAAMkB,SAAS,GAC/ChG,OAAQ,OAGXwe,OAAM,SAAAtY,GAAI,MAAK,CACd,kBAAkB,IACR2gF,EAA8C3gF,EAA9C2gF,YAAa/I,EAAiC53E,EAAjC43E,YAAaC,EAAoB73E,EAApB63E,gBAClC,8CACK73E,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEwc,cAAexc,EAAKwc,cACpB/f,OAAQuD,EAAKsB,cAAc8a,SAC3BukE,cACA/I,cACAC,qBAGJxgD,uBAbc,WAcZ,IAAMjhB,EAAO8F,4BAAkBlc,GAC/B,GAAIoW,GAAQA,EAAKlgB,SAAW,EAC1B,MAAO,2BAKX,uBACE,OAAO8J,EAAKsB,cAAc8a,SAASvY,UAGtC9D,SAAQ,SAAAC,GAAI,MAAK,CAChB0hF,kBADgB,WAEd1hF,EAAK2gF,aAAe3gF,EAAK2gF,aAE3BgB,kBAJgB,WAKd3hF,EAAK43E,aAAe53E,EAAK43E,aAE3BgK,sBAPgB,WAQd5hF,EAAK63E,iBAAmB73E,EAAK63E,qBAGhCv/D,OAAM,SAAAtY,GAAI,MAAK,CACd,qBACE,MAAO,CACL,CACEumB,MAAO,eACP1iB,KAAM,WACNq5B,QAASl9B,EAAK2gF,YACdnwE,QAAS,WACPxQ,EAAK0hF,sBAGT,CACEn7D,MAAO,eACP1iB,KAAM,WACNq5B,QAASl9B,EAAK43E,YACdpnE,QAAS,WACPxQ,EAAK2hF,sBAGT,CACEp7D,MAAO,mBACP1iB,KAAM,WACNq5B,QAASl9B,EAAK63E,gBACdrnE,QAAS,WACPxQ,EAAK4hF,iCF2Bb,MAAO,CACLnkF,KAAM,iCACN0e,aAAcslE,GACdllE,aACAW,UAAW,yBACXxE,SAAU,mBACVhI,eAAgB4R,SAIpB3R,EAAciR,iBACZ,kBACE,IAAIq/D,GAAoB,CACtBxjF,KAAM,sBACNiT,eAAgBmxE,GAChB1lE,aAAc6kE,GACdrwE,yB,GA3FkCkS,KGxBvBi/D,G,WAuBnB,WACErkF,EACA7D,EACA0U,EACAzY,EACAiE,EAEAC,GAEA,GADA,yBA9BM0D,UA8BN,OA5BK7D,UA4BL,OA1BK0U,SA0BL,OAxBKzY,WAwBL,OAtBKiE,YAsBL,OAnBKC,UAmBL,OAjBMyU,cAiBN,OAfMuzE,mBAeN,OAbKvgF,YAaL,EAEEwgF,kBACiB,kBAATvkF,GACU,kBAAT7D,GACP23B,OAAO0wD,MAAMroF,IACE,kBAAR0U,GACPijB,OAAO0wD,MAAM3zE,IACI,kBAAVzY,GACP07B,OAAO0wD,MAAMpsF,IACK,kBAAXiE,GACPy3B,OAAO0wD,MAAMnoF,IAEf,MAAM,IAAI2oC,UAAU,gCAGtBppC,KAAKoE,KAAOA,EACZpE,KAAKO,KAAOA,EACZP,KAAKiV,IAAMA,EACXjV,KAAKxD,MAAQA,EACbwD,KAAKS,OAASA,EACdT,KAAKU,KAAOA,EACZV,KAAKmV,SAAW,IAAIrV,IACpBE,KAAK0oF,cAAgB,CAAEG,OAAO,G,4CAGhC,SACEC,EACAvoF,EACA0U,EACAzY,EACAiE,EAEAC,GAEA,IAAI0kC,EAOJ,MALEA,EADE0jD,aAA4BL,EACtBK,EAEA,IAAIL,EAAWK,EAAkBvoF,EAAM0U,EAAKzY,EAAOiE,EAAQC,cAG9C+nF,GACrB,MAAM,IAAIr/C,UACR,yDAIJ,GAAIppC,KAAKmV,SAASxS,IAAIyiC,EAAMhhC,MAC1B,MAAM,IAAI5C,MAAJ,uBAA0B4jC,EAAMhhC,KAAhC,qBAIRghC,EAAMj9B,OAASnI,KAnBH,MAyBRolC,EAAM2jD,SAJFC,EArBI,EAqBVzoF,KACO0oF,EAtBG,EAsBVzoF,MACK0oF,EAvBK,EAuBVj0E,IACQk0E,EAxBE,EAwBV/qE,OAWF,YARgBhe,IAAd4oF,QACe5oF,IAAf6oF,QACa7oF,IAAb8oF,QACgB9oF,IAAhB+oF,IAEAnpF,KAAKg+E,OAAOgL,EAAWC,EAAYC,EAAUC,GAC7CnpF,KAAKmV,SAAS9U,IAAI+kC,EAAMhhC,KAAMghC,IAEzBA,I,0BAGT,SAAahhC,GACX,OAAOpE,KAAKmV,SAAShV,IAAIiE,K,oBAY3B,SACEglF,EACAC,EACAC,EACAC,GACM,MAC+BvpF,KAAK+oF,SAAlCxoF,EADF,EACEA,KAAMC,EADR,EACQA,MAAOyU,EADf,EACeA,IAAKmJ,EADpB,EACoBA,OAC1B,QAAahe,IAATG,GAAsB6oF,EAAU7oF,EAAM,CACxC,IAAMipF,EAAOjpF,EAAO6oF,EACpBppF,KAAKxD,OAASgtF,EACdxpF,KAAKO,MAAQipF,EAKf,QAHcppF,IAAVI,GAAuB6oF,EAAW7oF,IACpCR,KAAKxD,OAAS6sF,EAAW7oF,QAEfJ,IAAR6U,GAAqBq0E,EAASr0E,EAAK,CACrC,IAAMu0E,EAAOv0E,EAAMq0E,EACnBtpF,KAAKS,QAAU+oF,EACfxpF,KAAKiV,KAAOu0E,OAECppF,IAAXge,GAAwBmrE,EAAYnrE,IACtCpe,KAAKS,QAAU8oF,EAAYnrE,GAEzBpe,KAAKmI,QACPnI,KAAKmI,OAAO61E,OAAOoL,EAASC,EAAUC,EAAQC,GAEhDvpF,KAAK0oF,cAAcG,OAAQ,I,kBAG7B,WACE,OAAO7oF,KAAKiV,IAAMjV,KAAKS,S,iBAGzB,WACE,OAAOT,KAAKO,KAAOP,KAAKxD,Q,yBAG1B,SAAYkc,GACN1Y,KAAKmI,SACPuQ,EAAS1Y,KAAKmI,QACdnI,KAAKmI,OAAOshF,YAAY/wE,M,0BAI5B,SAAaA,GAA0B,qBACnB1Y,KAAKmV,SAASzS,UADK,IACrC,2BAA0C,KAA/B+0E,EAA+B,QACxC/+D,EAAS++D,GACTA,EAAIiS,aAAahxE,IAHkB,iC,oBAOvC,WACE,GAAI1Y,KAAK0oF,cAAcG,MAAO,CAC5B,IAAIc,EAAU,EACVtuB,EAAU,EACdr7D,KAAKypF,aAAY,SAACjhF,GAChBmhF,GAAWnhF,EAAKjI,KAChB86D,GAAW7yD,EAAKyM,OAElBjV,KAAK0oF,cAAgB,CACnBG,OAAO,EACPtoF,KAAMP,KAAKO,KAAOopF,EAClBnpF,MAAOR,KAAKQ,MAAQmpF,EACpB10E,IAAKjV,KAAKiV,IAAMomD,EAChBj9C,OAAQpe,KAAKoe,OAASi9C,EACtB7+D,MAAOwD,KAAKxD,MACZiE,OAAQT,KAAKS,QAGjB,OAAOT,KAAK0oF,gB,kBAGd,SAAK1oD,EAAWC,GACdjgC,KAAKO,MAAQy/B,EACbhgC,KAAKiV,KAAOgrB,EAEZjgC,KAAK0oF,cAAcG,OAAQ,EAC3B7oF,KAAK0pF,cAAa,SAACvkD,GACjBA,EAAEujD,cAAcG,OAAQ,KANK,MAQM7oF,KAAK+oF,SAAlCxoF,EARuB,EAQvBA,KAAMC,EARiB,EAQjBA,MAAOyU,EARU,EAQVA,IAAKmJ,EARK,EAQLA,YAEfhe,IAATG,QACUH,IAAVI,QACQJ,IAAR6U,QACW7U,IAAXge,GAEApe,KAAKg+E,OAAOz9E,EAAMC,EAAOyU,EAAKmJ,O,KCrNrB,SAASwrE,GAAMz4E,GAU3B,IAEC4Q,EASE5Q,EATF4Q,KACAie,EAQE7uB,EARF6uB,EACAC,EAOE9uB,EAPF8uB,EAJD,EAWG9uB,EANFrB,aALD,MAKS,QALT,IAWGqB,EALF4uE,kBAND,MAMc,GANd,EAOC8J,EAIE14E,EAJF04E,aACA3rF,EAGEiT,EAHFjT,SACA4rF,EAEE34E,EAFF24E,sBATD,EAWG34E,EADF44E,qBAGIC,EAAYjK,QAbjB,MAUwB,GAVxB,GAcKkK,EACJJ,GAAgBC,EACZD,EAAeC,EACfz/C,IAEN,OACE,0BACErK,EAAG9hC,EAAW8hC,GAAK6pD,GAAgB,GAAKG,EAAYjoE,EAAKxiB,OAASygC,EAClEC,EAAGA,EAAI8/C,EACP5tE,MAAO,CAAE9C,SAAU0wE,EAAY3tE,KAAMtC,EAAO6C,OAAQ,YAEnDq3E,EAAYjoE,EAAKxiB,OAAS0qF,EAA1B,UACMloE,EAAKu5B,MAAM,EAAG2uC,EAAaD,GADjC,OAEGjoE,GChCV,SAASmoE,GAAa/4E,GAAO,IAEzBuQ,EAWEvQ,EAbuB,QAGzBg5E,EAUEh5E,EAbuB,WAIzBuF,EASEvF,EAbuB,SAKzB/N,EAQE+N,EAbuB,OAMzB/M,EAOE+M,EAbuB,KAOzBi5E,EAMEj5E,EAbuB,eAQzB1E,EAKE0E,EAbuB,YASzBk5E,EAIEl5E,EAbuB,sBAUzB4uE,EAGE5uE,EAbuB,WAWzB24E,EAEE34E,EAbuB,sBAYzBjT,EACEiT,EAbuB,SAerBm5E,EAAgBH,eAAwBjjE,OAAOxF,EAArD,OACQ6oE,EAAmBD,EAhBA,oBAkBrBE,EAAkB,CACtB,mCACExrF,IAAG,gBAAW0iB,EAAX,OADL,GAGEA,QAHF,EAIE4oE,cAJF,EAKE5zE,SAAUA,MAsCd,OAlCA,GACE8zE,OACE,sBACExrF,IAAG,qBAAgB0iB,EADrB,MAEEK,KAFF,EAGEie,EAAGmqD,qCAHL,KAIElqD,EAAGkqD,qCAJL,IAKEr6E,MAAOrM,yBAAeL,EAAQ,CAAC,SAAV,aAAkC,CAAEse,YACzDq+D,WANF,EAOE7hF,SAPF,EAQE2rF,aAAcS,EARhB,MASER,sBAAuBA,KAK7B,GACEU,OACE,sBACExrF,IAAG,4BAAuB0iB,EAD5B,MAEEK,KAFF,EAGEie,EAAGmqD,4CAHL,KAIElqD,EAAGkqD,4CAJL,IAKEr6E,MAAOrM,yBAAeL,EAAQ,CAAC,SAAV,oBAAyC,CAC5Dse,YAEFq+D,WARF,EASE8J,aAAcS,EAThB,MAUEpsF,SAVF,EAWE4rF,sBAAuBA,KAKtB,2BAAP,GA8BFI,gBAA4B,CAC1BhsF,UAD0B,EAE1BwY,UAF0B,EAG1BtS,KAH0B,GAI1BgmF,gBAJ0B,EAK1B39E,YAL0B,GAM1B49E,uBAN0B,EAO1BtK,gBAP0B,EAQ1B+J,2BAAuB1pF,GAGVsE,2BAAf,IC3CA,SAAS+lF,GAAT,GAKqB,IAJnBvwD,EAImB,EAJnBA,KACAx8B,EAGmB,EAHnBA,OACAb,EAEmB,EAFnBA,QACG6tF,EACgB,2CACnB,IAAKxwD,EACH,OAAO,KAFU,kBAIwBA,EAJxB,GAIZ0xB,EAJY,KAIJC,EAJI,KAIGC,EAJH,KAIYC,EAJZ,OAKOC,mBAASJ,EAAQE,EAASpuD,EAAQb,GALzC,mBAKZggD,EALY,KAKJkF,EALI,KAMbkK,EAAU7uD,KAAK66C,MAAM4T,GACrB8+B,GAAejtF,EAAOO,IAAMP,EAAOK,OAASlB,EAC5CqvD,EAAa9uD,KAAK66C,MAAM8T,EAAWF,GACnCrvD,EAAQulD,EAAUlF,EAExB,GAAIA,EAASrgD,EAAQ,EACnB,OAAO,KAET,IAAMouF,EAAkBxtF,KAAKuB,IAAIk+C,EAAQ,GACnC2sC,EAAOoB,EAAkB/tC,EACzBguC,EAAmBztF,KAAKuB,IAAI,EAAGvB,KAAKwB,IAAIpC,EAAQgtF,EAAMmB,IAE5D,OACE,wCACE3qD,EAAG4qD,EAAkB,EACrB3qD,EAAGgsB,EAAU,EACbzvD,MAAOquF,EAAmB,EAC1BpqF,OAAQyrD,EAAa,GACjBw+B,IA4JKhmF,4BAvJf,YAYoB,QAXlB0e,aACEmc,EAUgB,EAVhBA,oBACAzY,EASgB,EAThBA,kBACA2X,EAQgB,EARhBA,oBACAC,EAOgB,EAPhBA,mBAEFT,EAKkB,EALlBA,SACAvgC,EAIkB,EAJlBA,OACAb,EAGkB,EAHlBA,QACAsuD,EAEkB,EAFlBA,yBACG2/B,EACe,yFACZp/B,EAAW,OAAGnsB,QAAH,IAAGA,OAAH,EAAGA,EAAqBp/B,IAAI89B,GAC7C,IAAKytB,EACH,OAAO,KAET,IAAMq/B,EAAqBtsD,IAAmB,OAAIC,QAAJ,IAAIA,OAAJ,EAAIA,EAAoBp+B,MAsBtE,SAASigF,EACPzsE,GAGA,IAC2BusE,EAAYyK,EAA/BvK,kBACR,GAAMF,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,GAGxB,SAASvK,EACP1sE,GAGA,IAC4BusE,EAAYyK,EAAhCtK,mBACR,GAAMH,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,GAuDxB,OACE,oCACGA,EACC,kBAACN,GAAD,CACEvwD,KAAMwxB,EAAYvrD,IAAI4qF,GACtBrtF,OAAQA,EACRb,QAASA,EACTuV,KAAK,OACL44E,YAAY,MACZz2E,YAzGR,SACET,GACA,IAC4BusE,EAAYyK,EAAhC1K,mBACR,GAAMC,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,IAmGhBt+B,aAhGR,SACE34C,GACA,IAC6BusE,EAAYyK,EAAjCxK,oBACR,GAAMD,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,IA0FhBnkE,WAAY25D,EACZ55D,YAAa65D,EACb9zB,UAjER,SACE54C,GACA,IAC0BusE,EAAYyK,EAA9BrK,iBACR,GAAMJ,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,IA2DhB9oD,aAxDR,SACEnuB,GACA,IAC6BusE,EAAYyK,EAAjCpK,oBACR,GAAML,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,IAkDhB9wD,YA/CR,SACEnmB,GACA,IAC4BusE,EAAYyK,EAAhCnK,mBACR,GAAMN,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,IAyChB5zE,QAtCR,SAAwBrD,GACtB,IAAIq3C,EAAJ,CAD2E,IAInDk1B,EAAYyK,EAA5BhpD,eACR,GAAMu+C,GAAW0K,EAIjB,OADAj3E,EAAMm3E,kBACC5K,EAAQvsE,EAAOi3E,KA8BhBjxD,cA3BR,SACEhmB,GACA,IAC8BusE,EAAYyK,EAAlC9oD,qBACR,GAAMq+C,GAAW0K,EAGjB,OAAO1K,EAAQvsE,EAAOi3E,IAqBhBp+B,QAAS6zB,EACT5lE,OAAQ2lE,EACRhqE,cAAaw0E,IAEb,KACHjkE,EACC,kBAAC2jE,GAAD,CACEvwD,KAAMwxB,EAAYvrD,IAAI2mB,GACtBppB,OAAQA,EACRb,QAASA,EACT4pB,OAAO,UACPrU,KAAK,SAEL,SChPV,SAAS84E,GAAI/5E,GAAO,IAKlB,EAJQuQ,EAA8DvQ,EADpD,QACDzT,EAAqDyT,EADpD,OACO/N,EAA6C+N,EADpD,OACem5E,EAAqCn5E,EADpD,cAC8BuF,EAAsBvF,EADpD,SACwCtU,EAAYsU,EADpD,QAEZw5E,GAAejtF,MAAaA,EAAd,OAApB,EAEMytF,EAAS1nF,yBAAeL,EAAQ,SAAU,CAAEse,YAElD,IACE0pE,EAAmBC,qBAAUF,EAA7BC,IACA,MAAO7oE,GACP6oE,IAEF,IAAME,EAAS7nF,yBAAeL,EAAQ,SAAU,CAAEse,YAXhC,EAamB4oE,EAbnB,SAaV/pF,EAbU,OAaJ0U,EAbI,MAaCzY,EAbD,QAaQiE,EAbR,SAelB,GAAIF,IAAJ,EACE,YAEF,IAAMqqF,EAAkBxtF,WAAxB,GACMosF,EAAOoB,EAAb,EACMC,EAAmBztF,WAAYA,SAASZ,EAATY,EAArC,IAEA,OACE,0BACEmZ,cAAA,cAAoBmL,EADtB,MAEEse,EAFF,EAGEC,EAHF,EAIEzjC,MAJF,EAKEiE,OALF,EAME2R,KAAMsE,EAAW00E,EANnB,EAOE3kE,OAAQ/P,EAAW40E,OAASlrF,IAwBlC8qF,gBAAmB,CACjBx0E,UAAU,GAGGhS,2BAAf,ICvDA,SAAS6mF,GAAQp6E,GAAO,IAEpBuQ,EAOEvQ,EATkB,QAGpBtU,EAMEsU,EATkB,QAIpBzT,EAKEyT,EATkB,OAKpB/N,EAIE+N,EATkB,OAMpBm5E,EAGEn5E,EATkB,cAOpBuF,EAEEvF,EATkB,SAQpBjT,EACEiT,EATkB,SAWhBw5E,GAAejtF,MAAaA,EAAd,OAApB,EACMlB,EAAQY,SAASktF,WAATltF,MAAd,GACQmD,EAAS+pF,EAbK,gBAcAA,EAdA,SAchBr1E,EAdgB,MAcXxU,EAdW,SAelB+qF,GAAJ,KACEv2E,GAAQ,KAARA,EACAxU,GAnBJ,KAsBE,IAKA,EAJMgrF,EADS/pE,MAAf,WAC4BxjB,GAAQ,EAApC,GACM4R,EAAQ,MACVrM,yBAAeL,EAAQ,SAAU,CAAEse,YACnCje,yBAAeL,EAAQ,SAAU,CAAEse,YAEvC,IACEgqE,EAAkBL,qBAAUv7E,EAA5B47E,IACA,MAAOnpE,GACPmpE,IAEF,IAAMJ,EAAS7nF,yBAAeL,EAAQ,SAAU,CAAEse,YAElD,GAAInhB,IAAJ,EACE,YAEF,IAAMqqF,EAAkBxtF,WAAxB,GACMosF,EAAOoB,EAAb,EACMC,EAAmBztF,WAAYA,SAASZ,EAATY,EAArC,IAEA,OACE,oCACE,0BACEmZ,cAAamL,EADf,KAEE+E,OAAQ/P,EAAW40E,OAFrB,EAGEl5E,KAAMsE,EAAWg1E,EAHnB,EAIE1rD,EAJF,EAKEC,EALF,EAMEzjC,MANF,EAOEiE,OAAQA,IAETgrF,EAAA,OAAiBjC,EAChB,6BACE/iE,OAAQ/P,EAAW40E,OADrB,EAEEl5E,KAAMsE,EAAWg1E,EAFnB,EAGEC,OAAQ,CACN,CAACprF,EADK,GAEN,CAACA,EAAOE,EAAR,EAAoBwU,EAAMxU,EAFpB,GAGN,CAACF,EAAM0U,EAHD,MAdd,KAqBGw2E,EAAA,GAAiBb,IAAjB,EACC,6BACEnkE,OAAQ/P,EAAW40E,OADrB,EAEEl5E,KAAMsE,EAAWg1E,EAFnB,EAGEC,OAAQ,CACN,CAACf,EAAD,EADM,GAEN,CAACA,IAAqCnqF,EAAtC,EAAkDwU,EAAMxU,EAFlD,GAGN,CAACmqF,EAAD,EAAqC31E,EAH/B,MA1BhB,MAyDFs2E,gBAAuB,CACrB70E,UADqB,EAErBxY,UAAU,GAGGwG,2BAAf,ICzGA,SAASknF,GAASz6E,GAAO,IAevB,EAbEuQ,EASEvQ,EAXmB,QAGrBm5E,EAQEn5E,EAXmB,cAIrBuF,EAOEvF,EAXmB,SAKrB/N,EAME+N,EAXmB,OAMrBjT,EAKEiT,EAXmB,SAajB6zB,EAFF7zB,EAXmB,aAagBuQ,MAAvC,eACM4pE,EAAS7nF,yBAAeL,EAAQ,SAAU,CAAEse,YAElD,IACEmqE,EAAmBR,qBAAUC,EAA7BO,IACA,MAAOtpE,GACPspE,IAnBqB,MAqBcvB,EArBd,SAqBf/pF,EArBe,OAqBT0U,EArBS,MAqBJzY,EArBI,QAqBGiE,EArBH,SAsBjBkrF,EAAS,CACb,CAACprF,EAAM0U,EAAMxU,EADA,GAEb,CAACF,EAAD,EAAe0U,EAAMxU,EAFvB,IAIMwkC,EAASvjB,MAAf,UASA,OARA,GACEiqE,OACE,CAACprF,IAAeE,EAAhB,EAA4BwU,EAAMxU,EADpCkrF,GAEE,CAACprF,IAAeE,EAAhB,EAA4BwU,EAAWxU,EAFzCkrF,EAEoC,GAClC,CAACprF,EAAD,EAAe0U,EAAMxU,EAHvBkrF,IAQA,oCACE,8BACEp1E,cAAamL,EADf,KAEEnP,UACE0yB,KAAa/mC,GAAY+mC,EAAd,GAA8B/mC,GAAY+mC,EAArDA,wBACkB1kC,EAAO/D,EADzByoC,cACsChwB,EAAMxU,EAD5CwkC,YAHJ,EAOE0mD,OAPF,EAQEllE,OAAQ/P,EAAWm1E,EAAmBP,IAItCtmD,OAAgB,SAAA8gD,GACd,IAAMgG,EAAe5kE,OAAO4+D,EAA5B,MACMiG,EAAmBzB,eAFG,GAI5B,MACE,YAL0B,IAOpBC,EAAmBwB,EAPC,oBAQ5B,OACE,mCACE/sF,IAAG,oBADL,GAGE0iB,QAHF,EAIE4oE,cAJF,EAKE5zE,SAAUA,SA4BxBk1E,gBAAwB,CACtBl1E,UADsB,EAEtBxY,UAAU,GAGGwG,2BAAf,IChGA,SAASsnF,GAAoB76E,GAAO,IAG5B6zB,EAAcinD,GADQ96E,EAFM,QAENA,EAFM,QAMlC,OAAO,yCAAqB6zB,YAAaA,KAyB3C,SAASknD,GAAcxqE,EAASte,GAC9B,OArBF,WAA0D,IAA9B+oF,EAA8B,uDAApB,WAAY/oF,EAAQ,uCACpD0nB,EAASrnB,yBAAeL,EAA5B,GAOA,GALA,iBAAW0nB,IAETA,EAASA,QAATA,YAGE7T,cAAJ,GAA2B,CACzB,IAAMm1E,EAAYthE,EAAA,KAAW,SAAAypB,GAAQ,OAAIA,EAAJ,iBACrC,OAAO,SAAA7yB,GACL,OAAO0qE,WAAmB1qE,cAA1B,gBAGJ,0BAAWoJ,EACT,EAEK,qBAIAuhE,CAAmB,WAAnBA,GAAP,GAGF,SAASb,GAAM9pE,GACb,MAAO,yCAAyCnX,KAC9CmX,eADF,IAwFF,SAASuqE,GAAYjpF,EAAGI,GACtB,IAAI+hC,EAAIniC,MAAR,eACA,IAAKmiC,IAAMA,EAAX,OACE,SAEF,IAAMmnD,IAAYnnD,EAAA,MAAO,SAAAC,GAAK,OAAIomD,GAAJ,MACxBe,EAAe,CAAC,OAAQ,cAAcrhE,SAASloB,MAArD,SASA,QARqBspF,GAPS,GAWX7oF,yBAAeL,EAAlC,kBACE+hC,EA/FJ,SAAkBh9B,EAAQqkF,GAYxB,IAVA,IAKA,EAP8B,EAExBC,EAAW,OAAH,IAAG,CAAjB,GAEIC,EAAJ,IACIC,GAAU,IAMRC,EAAN,GACS55D,EAAT,EAAgBA,EAAIy5D,EAApB,OAAqCz5D,IAAK,CACxC,IAAMxoB,EAAOiiF,SAAb,QACI,QAAQliF,KAAZ,IACMmiF,EAAYD,SAAhB,WACEC,EAAYD,SAAZC,UAEEC,EAAUF,SAAd,SACEE,EAAUF,SAAVE,SAEO,QAAQpiF,KAAZ,GACLqiF,OAAWH,EAAXG,IACSpB,GAAMiB,EAAVz5D,MACL65D,EAAcJ,oBAA6BtkF,MAA3C0kF,SACAC,EAAeL,kBAA2BtkF,MAA1C2kF,QAKJ,KAAMF,UAAgBF,EAAhBE,KAAwCD,GAAU,KACtD,SAIFC,QAAW,qBAAUjrF,eAAiBqzB,MAA3B,YAEX,IAGA,EACA,EAJMiQ,EAAS98B,MArCe,UA0C9B,MACE,IAAK,IAAI6qB,EAAT,EAAgBA,EAAI45D,EAApB,WACE7uF,EAAQ6uF,SAAR7uF,WACA,GAFgCi1B,IAAK,CAKrC/0B,EAAMyuF,EAAYE,SAAZF,OAAkCE,SAAlCF,OAANzuF,EACA,IAAMuM,EAAOy6B,sBAAb,kBACAwnD,UACE,IAAI,EAAJ,EAAkB,CAChBtkF,OADgB,EAEhB7H,GAAI,GAAF,OAAK6H,EAAL,+BAFc,GAGhBzH,KAAM,CAAE3C,MAAF,EAASE,IAAT,EAAcgnC,OAAd,EAAsBz6B,WAOpC,MACE,IAAK,IAAIwoB,EAAI45D,SAAb,EAA+B55D,GAA/B,MACE/0B,EAAM2uF,SAAN3uF,SACA,GAFqC+0B,IAAK,CAM1Cj1B,EAAQ4uF,EAAUC,SAAVD,SAAkCC,SAAlCD,SAAR5uF,EACA,IAAMyM,EAAOy6B,uBAAb,iBACAwnD,OACE,IAAI,EAAJ,EAAkB,CAChBtkF,OADgB,EAEhB7H,GAAI,GAAF,OAAK6H,EAAL,+BAFc,GAGhBzH,KAAM,CAAE3C,MAAF,EAASE,IAAT,EAAcgnC,OAAd,EAAsBz6B,WAMpC,SAeMuiF,CAAS/pF,EAAbmiC,IAGKA,EAAA,QAAS,SAAA8hD,GAAO,OAAIiF,GAAcjF,EAAlB,MAGzB+E,UAA6B,YAMvB,IALJnrF,EAKI,EALJA,OACA6gB,EAII,EAJJA,QACA7kB,EAGI,EAHJA,QACAqB,EAEI,EAFJA,SACAkF,EACI,EADJA,OAEMlD,EAAY8sF,GAAc,CAC9BnsF,OAD8B,EAE9B6gB,QAF8B,EAG9B7kB,QAH8B,EAI9BqB,SAJ8B,EAK9BkF,WAUF,OAPA6pF,GAAkB,CAChBpsF,OADgB,EAEhBmkC,YAHkBinD,GAAYvqE,EAAhC,GAIE7kB,QAHgB,EAIhBqB,SAJgB,EAKhBkF,WAEF,GAGasB,2BAAf,ICxKA,SAASwoF,GAAY/7E,GAAO,IAClBuQ,EAAqCvQ,EADnB,QACTm5E,EAA4Bn5E,EADnB,cACMuF,EAAavF,EADnB,SAG1B,OACE,oCACGuQ,EAAA,wBAA+B,SAAAokE,GAC9B,IAAMgG,EAAe5kE,OAAO4+D,EAA5B,MACMiG,EAAmBzB,eAAzB,GACQC,EAAmBwB,EAHiB,oBAI5C,OACE,mCACE/sF,IAAG,oBADL,GAGE0iB,QAHF,EAIE4oE,cAJF,EAKE5zE,SAAUA,SAiBtBw2E,gBAA2B,CACzBx2E,UADyB,EAEzBxY,UAAU,GAGZgvF,UAAqB,YAAoD,IAAjDrsF,EAAiD,EAAjDA,OAAQ6gB,EAAyC,EAAzCA,QAAS7kB,EAAgC,EAAhCA,QAASqB,EAAuB,EAAvBA,SAAUkF,EAAa,EAAbA,OACpDlD,EAAY8sF,GAAc,CAC9BnsF,OAD8B,EAE9B6gB,QAF8B,EAG9B7kB,QAH8B,EAI9BqB,SAJ8B,EAK9BkF,WAEIigC,EAAc5/B,yBAAeL,EAAnC,eACA,6BAAIigC,EAAyC,CAC3C,IAAM2B,EAActjB,sBAApB,GACIyrE,EAAJ,EACAnoD,WAAoB,SAAA8gD,GAClB,IAAMsH,EAA2BC,GAAjC,GACMC,EAAmB7pF,yBAAeL,EAAQ,SAAU,CACxDse,QAASokE,KAGWsH,UAAD,IAA4C,CAC/DvsF,OAD+D,EAE/D6gB,QAF+D,EAG/D7kB,QAH+D,EAI/DqB,SAJ+D,EAK/DkF,WAEFmqF,UACAJ,GACE9pD,kBAEKA,cACGiqD,EADHjqD,EAAD,GAHN8pD,KAQJ,UAGazoF,2BAAf,IClEO,SAAS2oF,GAAqB3rE,GACnC,IAAMlX,EAAOkX,EAAQvhB,IAAI,QACnB8kC,EAASvjB,EAAQvhB,IAAI,UACrB6kC,EAAyBtjB,EAAQvhB,IAAI,eAE3C,GAAI6kC,EAAa,CAIf,GAHkBA,EAAYnO,MAAK,SAAAivD,GACjC,QAASA,EAAW3lF,IAAI,kBAGxB,OAAO+sF,GAGT,MADwB,CAAC,OAAQ,cAEfhiE,SAAS1gB,IACzBw6B,EAAYnO,MAAK,SAAA7zB,GAAC,MAAsB,QAAlBA,EAAE7C,IAAI,WAErB6rF,GAEFJ,GAET,MAAO,CAAC,GAAI,GAAG1gE,SAAS+Z,GAAUsmD,GAAUL,GAkBvC,SAASsC,GAAT,GAM2B,IALhC3sF,EAKgC,EALhCA,OACA6gB,EAIgC,EAJhCA,QACA7kB,EAGgC,EAHhCA,QACAqB,EAEgC,EAFhCA,SACAkF,EACgC,EADhCA,OAEMigC,EAAc5/B,yBAAeL,EAAQ,eACrClD,EAAY8sF,GAAc,CAC9BnsF,SACA6gB,UACA7kB,UACAqB,WACAkF,WAWF,MAToB,0BAAhBigC,GACF4pD,GAAkB,CAChBpsF,OAAQX,EACR8kC,YAAatjB,EAAQvhB,IAAI,gBAAkB,GAC3CtD,UACAqB,WACAkF,WAGGlD,EAGF,SAAS8sF,GAAc5sE,GAAqC,IACzDvf,EAA+Cuf,EAA/Cvf,OAAQ6gB,EAAuCtB,EAAvCsB,QAAS7kB,EAA8BujB,EAA9BvjB,QAASqB,EAAqBkiB,EAArBliB,SAAUkF,EAAWgd,EAAXhd,OACtCigC,EAAc5/B,yBAAeL,EAAQ,eACrCmnF,EACY,0BAAhBlnD,EACIkoD,GACA8B,GAAqB3rE,GACrB+rE,EAAgB/rE,EAAQvZ,SAC1B63B,EAAI,EACJytD,IACFztD,EAAI9hC,GACCuvF,EAActtF,IAAI,OAASuhB,EAAQvhB,IAAI,QAAUtD,GACjD6kB,EAAQvhB,IAAI,SAAWstF,EAActtF,IAAI,UAAYtD,GAE5D,IAAM4D,EAASgD,yBAAeL,EAAQ,SAAU,CAAEse,YAC5CllB,GAASklB,EAAQvhB,IAAI,OAASuhB,EAAQvhB,IAAI,UAAYtD,EACtD6wF,EAAe7sF,EAAOsH,OACtB8M,EAAMy4E,EAAeA,EAAaz4E,IAAM,EAS9C,OARkBpU,EAAO8sF,SACvBzmE,OAAOxF,EAAQphB,MACf0/B,EACgB,aAAhBqD,EAA6B,EAAIpuB,EACjCzY,EACgB,YAAhB6mC,EAA4B5iC,EAAS,EAAIA,EACzC,CAAE8pF,mBAKC,SAAS0C,GAAkB7sE,GAAkC,IAClDlgB,EAAsDkgB,EAA9Dvf,OAAmBmkC,EAA2C5kB,EAA3C4kB,YAAanoC,EAA8BujB,EAA9BvjB,QAASqB,EAAqBkiB,EAArBliB,SAAUkF,EAAWgd,EAAXhd,OAC3D4hC,EAAYvnC,SAAQ,SAAAqoF,IACeuH,GAAqBvH,GAC3B0H,QAAUA,IAAQ,CAC3C3sF,OAAQX,EACRwhB,QAASokE,EACTjpF,UACAqB,WACAkF,cAKC,SAASooF,GAAM9pE,GACpB,MAAO,yCAAyCnX,KAC9CmX,EAAQvhB,IAAI,SAAW,IClH3B,IACMytF,GAAiB,CACrB/rF,SAAU,YAGZ,SAASgsF,GAAqB18E,GAAO,IAgBnC,EACA,EACA,EACA,EACA,EACA,EApBQuQ,EAA0DvQ,EAD/B,QAClBtU,EAAiDsU,EAD/B,QACTzT,EAAwCyT,EAD/B,OACD/N,EAAgC+N,EAD/B,OACOkyB,EAAwBlyB,EAD/B,YACoBtQ,EAAWsQ,EAD/B,OAE3BjT,EAAaR,EAFc,SAG7BK,EAAQ2jB,MAAYxjB,EAAW,MAArC,SACM4vF,EAAUzzB,iBAAOt8D,EAAOL,EAA9B,GACMqwF,EAAgB1qD,eAAtB,cAAmDA,EAE7C8mD,EAAa,IAAI,GAAJ,aAAnB,GAEMG,GADiB+C,GAAvB,GACuB9C,QAAD,IAAkC,CACtD1pF,OADsD,EAEtD6gB,QAFsD,EAGtD7kB,QAHsD,EAItDqB,SAJsD,EAKtDkF,WAQF,KAAmB,CACjB,IAAMggC,EAAa3/B,yBAAeL,EAAlC,cACA28E,EAAat8E,yBAAeL,EAAQ,CAAC,SAAV,YAAiC,CAAEse,YAC9DssE,EAAYvqF,yBAAeL,EAAfK,6BAAZuqF,EACA5pF,EAAO,yBAAehB,EAAQ,CAAC,SAAV,QAA6B,CAAEse,aAApDtd,GACAgmF,EAAiB,KAAK7/E,KAAKnG,IAA3BgmF,EAEA39E,EACE,yBAAerJ,EAAQ,CAAC,SAAV,eAAoC,CAAEse,aADtDjV,GAEA49E,EAAwB,KAAK9/E,KAAKkC,IAAlC49E,EACA,IAAML,EArCV,GAqCsBjK,EAGdkO,EAAJ,EACA,IACEA,EAAY7wF,WACVA,SAAS8pB,iBAAT9pB,EAA0C+sF,QAD5C8D,IAGA9D,yBAGEG,SAVJ,EAOEH,MASF,IAAI+D,EAAJ,EACA,KAA2B,CACzB,IAAMC,EAAc/D,EAChBD,eAD8B,aAAlC,EAGA+D,EAAmB9wF,WACjBA,SACE8pB,iBADF9pB,EAEE+sF,QAHJ+D,IAMA/D,gCAGEgE,SA9BJ,EA2BEhE,MAUJ,IAAMt+B,EAAQhrD,UACZ6gB,EADY7gB,KAEZ6gB,MAFY7gB,SAGZ6gB,eAAuByoE,QAHXtpF,EAIZspF,EAJF,QAMA,cAAIt+B,EACF,MAEFs+B,YAGE,oCACEnrF,IAAG,sBAAiB0iB,EADtB,MAEEA,QAFF,EAGE7gB,OAHF,EAIEspF,WAJF,EAKEttF,QALF,EAMEuG,OANF,EAOEgB,KAAM8iB,OAPR,GAQEkjE,eARF,EASE39E,YAAaya,OATf,GAUEmjE,sBAVF,EAWEtK,WAXF,EAYE+J,sBAZF,EAaE5rF,SAAUR,EAAOQ,UAdrB,KAoCF,IAAMkwF,GAAmB1pF,qBAAS,SAAAyM,GAAS,MACjC0V,EAAa1V,EADoB,SAEnCk9E,EAAN,GAFyC,eAGnBxnE,EAHmB,cAGzC,2BAAyC,KAA9BnF,EAA8B,QACvC2sE,OACE,oCAAsBrvF,IAAK0iB,EAA3B,KAAyCA,QAASA,GADpD2sE,MAJuC,8BAQzC,OAAO,oCAAP,MAiBF,SAASC,GAAoBn9E,GAAO,IAEhCtQ,EAQEsQ,EAV8B,OAGhC8sB,EAOE9sB,EAV8B,SAIhC6V,EAME7V,EAV8B,QAKhCtU,EAKEsU,EAV8B,QAMhC0V,EAIE1V,EAV8B,SAOhC/N,EAGE+N,EAV8B,OAQhCiS,EAEEjS,EAV8B,aAShCqxB,EACErxB,EAV8B,YAWjB6V,GAXiB,GAW3BtpB,EAX2B,oBAY5BlB,GAASkB,MAAaA,EAAd,OAAd,EACM2lC,EAAc5/B,yBAAeL,EAAnC,eAEMiT,EAAM3C,mBAfsB,EAgBIJ,oBAhBJ,sBAgB3B23C,EAhB2B,KAgBdC,EAhBc,OAiB8B53C,oBAjB9B,sBAiB3B63C,EAjB2B,KAiBDC,EAjBC,OAoBN93C,mBApBM,sBAoB3B7S,EApB2B,KAoBnBmgC,EApBmB,KAsBhCha,EAQEzV,EA9B8B,WAuBhCoD,EAOEpD,EA9B8B,YAwBhC8wB,EAME9wB,EA9B8B,aAyBhCs7C,EAKEt7C,EA9B8B,aA0BhCwV,EAIExV,EA9B8B,YA2BhC8oB,EAGE9oB,EA9B8B,YA4BhCu7C,EAEEv7C,EA9B8B,UA6BhCgG,EACEhG,EA9B8B,QAgC5Bo9E,EAAYC,uBAChB,SAAA16E,GACEo3C,MACAE,MAEA,GADA,EAIA,OAJA,EAIA,KAEF,CAVF,IAaMj3C,EAAUq6E,uBACd,SAAA16E,GACEo3C,MAEA,GADA,EAIA,OAJA,EAIA,KAEF,CATF,IAYMujC,EAAaD,uBACjB,SAAA16E,GAEE,GADA,EAIA,OAJA,EAIA,KAEF,CARF,IAWM46E,EAAaF,uBACjB,SAAA16E,GAEE,GADA,EAIA,OAJA,EAIA,KAEF,CARF,IAWM66E,EAAYH,uBAChB,SAAA16E,GAEE,GADA,EAIA,OAJA,EAIA,KAEF,CARF,IAWM86E,EAAWJ,uBACf,SAAA16E,GAEE,GADA,EAIA,OAJA,EAIA,KAEF,CARF,IAWMD,EAAY26E,uBAChB,SAAA16E,GACE,GACEs3C,MAEF,IAAI5pC,EAAJ,EACIC,EAAJ,EACIpL,EAAJ,UACEmL,EAAUnL,kCAAVmL,KACAC,EAAUpL,kCAAVoL,KAEFD,EAAU1N,UAAV0N,EACAC,EAAU3N,UAAV2N,EACA,IAAMg5B,EAAK/8C,WAAkBlB,EAAlBkB,EAAX,EACMg9C,EAAWh9C,QAAeb,EAAhC,EAEMs3B,EAAQ/Q,4BAAd,GAKMyrE,EAA+B16D,SACjCA,KADiCA,UAArC,EAIA,GACE8F,EAAYnmB,EAAZmmB,KAGJ,CAAC,EAAD,MAKEv8B,EALF,SAMEA,EANF,QA7BF,IAyCMoxF,EAAQN,uBACZ,SAAA16E,GAEE,GAGA,GACEqD,OAGJ,CAACg0C,EAVH,IAiBA,OAJAv3C,qBAAU,WACRgtB,EAAU//B,EAAV+/B,oBACC,CAFHhtB,IAIA,EAEI,oCACEiT,SADF,EAEEwc,YAAaA,GAFf,GAIE3lC,OAAQA,KAKZ,yBAAKyU,MAAOy7E,IACV,yBACEv3E,IADF,EAEEpD,UAFF,sBAGEzW,MAAK,YAHP,MAIEiE,OAAM,YAJR,MAKE8T,YALF,EAMEm4C,UANF,EAOED,aAPF,EAQExqB,aARF,EASEtb,YATF,EAUEC,WAVF,EAWEqT,YAXF,EAYE0yB,QAZF,EAaE/xC,OAbF,EAcEzD,QAdF,EAeEhF,MAAO,CAAEwF,QAAS,UAElB,oCACEkP,SADF,EAEEwc,YAAaA,GAFf,GAIE3lC,OAJF,EAKEytD,yBAA0BA,KAE5B,yCAAuBztD,OAAQA,OAlNvC0wF,aAA6B,CAC3BvnE,SAAU8pD,eAAyB,CACjCA,gBADiC,KAEjCA,aAAuBA,KAHE,WAK3B9vE,OAAQ,WAAqB,CAC3BD,QAAS+vE,UADkB,WAE3B53C,eAAgB43C,UAAoB1qE,aACnCA,YAGLmoF,gBAAgC,CAC9BvnE,SAAU,IA+OZynE,gBAAmC,CACjClrE,aADiC,GAEjCof,eAFiC,EAIjC3b,SAAU,IAJuB,IAKjCoX,cALiC,EAOjC1pB,iBAPiC,EAQjCm4C,eARiC,EASjCD,kBATiC,EAUjCxqB,kBAViC,EAWjCtb,iBAXiC,EAYjCC,gBAZiC,EAajCqT,iBAbiC,EAcjC9iB,aAdiC,EAejC2iB,mBAfiC,EAgBjCgI,oBAhBiC,EAiBjCE,0BAAsB5hC,GAGTsE,2BAAf,IC3Zeie,iCACb,qBACA,CACEwoE,OAAQ,CACN3gF,KAAM,QACNiC,YAAa,iCACb+a,aAAc,YACdC,gBAAiB,CAAC,YAEpB6jE,OAAQ,CACN9gF,KAAM,QACNiC,YACE,sEACF+a,aAAc,QACdC,gBAAiB,CAAC,YAEpBsnE,OAAQ,CACNvkF,KAAM,QACNiC,YACE,qFACF+a,aAAc,UACdC,gBAAiB,CAAC,YAEpBhnB,OAAQ,CACN+J,KAAM,SACNiC,YAAa,oDACb+a,aAAc,GACdC,gBAAiB,CAAC,YAEpB2b,WAAY,CACV54B,KAAM,UACNgd,cAAc,GAEhBwnE,OAAQrsE,8BAAoB,mBAAoB,CAC9Cve,KAAM,CACJoG,KAAM,SACNiC,YACE,iEACF+a,aAAc,gDACdC,gBAAiB,CAAC,YAEpBwnE,UAAW,CACTzkF,KAAM,QACNiC,YAAa,wCACb+a,aAAc,QACdC,gBAAiB,CAAC,YAEpBhb,YAAa,CACXjC,KAAM,SACNiC,YAAa,sDACb+a,aAAc,yDACdC,gBAAiB,CAAC,YAEpBynE,iBAAkB,CAChB1kF,KAAM,QACNiC,YAAa,yCACb+a,aAAc,OACdC,gBAAiB,CAAC,YAEpBpY,SAAU,CACR7E,KAAM,SACNiC,YACE,iEACF+a,aAAc,GACdC,gBAAiB,CAAC,cAGtB4b,YAAa,CACX74B,KAAM,aACNpO,MAAOmJ,QAAMwiB,YAAY,cAAe,CACtC,SACA,UACA,wBACA,aAEFtb,YAAa,4BACb+a,aAAc,UAEhB2nE,yBAA0B,CACxB3kF,KAAM,SACNiC,YACE,2GACF+a,aAAc,KAEhBpI,UAAW,CACT5U,KAAM,UACNiC,YAAa,mDACb+a,aAAc,KAEhB4nE,SAAU,CACR5kF,KAAM,SACNiC,YAAa,uBACb+a,aAAc,0CAEhB6nE,YAAa,CACX7kF,KAAM,UACNiC,YAAa,8CACb+a,cAAc,IAGlB,CAAEvE,iBAAiB,IC/Ff+jC,G,4MACJ7M,aAAc,E,YADiBroB,MAIZw9D,G,4MACnBlrF,KAAO,Y,6CAEP,SAAQkT,GACNA,EAAciR,iBACZ,kBACE,IAAIy+B,GAAmB,CACrB5iD,KAAM,qBACNiT,eAAgBk4E,GAChBzsE,aAAc0sE,GACdl4E,yB,GAV6BkS,KCTxB7G,iCAAoB,gCAEjC,CACE8sE,UAAW,CACTjlF,KADS,SAETgd,aAFS,GAGT/a,YAAa,gDAGjB,CAAEuW,kBAAmBi9C,0BCThB,SAAS,GAAT,OAIL,OAYA,cAA6C,IAAhByvB,EAAgB,uDAAJ,GACvC,GAAI3nF,EAAJ,QACE,OAAOhE,OAAA,OAAcgE,EAAd,cACA,SAAA4nF,GAAQ,OACXC,EAAa,EAEX7nF,aAAmB2nF,SAAiB,CAAC3nF,EAArCA,aAHS,MADf,OAUF,OADAA,eACO,CAAP,GAzBgB6nF,CAAa,CAAEC,QADPvvB,EAF2C,wBAI9D,KAAc,SAAAqvB,GACnB,IAAMrqD,EA2BV,gBACE,IACIq7B,EADc54D,EAAlB,KACoB8b,cAApB,cAEE88C,WACA54D,oCAFF,UAIE44D,UAPyD,IAc3D,EALQmvB,EAAe/nF,EAToC,WAUrD64D,EAAkB,CACtBx5D,IAAK,IAAIwwB,IAAIk4D,EAAYC,GAAY3jE,MAE/B7f,EAAexE,EAboC,WAe3D,UACE,UAcE,OAZE+4D,EADF,EACyB/4D,EAAA,aACnB,CACEX,IAAK,IAAIwwB,IAAI7vB,EAAR,gBAAwCqkB,MAE/C,CACEhlB,IAAK,IAAIwwB,IAAI,GAAR,OAAW7vB,EAAX,sBAA+CqkB,MAGnCrkB,EAAA,aACnB,CAAEf,UAAWe,EAAMioF,cACnB,CAAEhpF,UAAW,GAAF,OAAKe,EAAL,oBAEV,CACLyC,KADK,kBAELpG,KAAM2D,EAFD,WAGL0E,YAAa1E,EAHR,UAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,aAEPC,YAFO,EAGPd,MAAO,CACLN,SAAUy3D,KAIlB,UAMA,qBAMA,eAMA,qBAMA,kBACE,OAAO10D,uCACLrE,EADiC,aAAnC,GAKF,aACE,MAAO,CACLyC,KADK,eAELpG,KAAM2D,EAFD,WAGL0E,YAAa1E,EAHR,UAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,gBAEPQ,eAAgB41D,IAGtB,eAMA,kBAMA,aAMA,aACE,OAAOx0D,uCACLrE,EADiC,aAAnC,GAKF,aACE,MAAO,CACLyC,KADK,oBAELpG,KAAM2D,EAFD,WAGL0E,YAAa1E,EAHR,UAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,gBAEPS,eAAgB21D,IAGtB,gBAMA,kBACE,OAAOx0D,uCACLrE,EADiC,aAAnC,GAKF,WAcE,OAZE+4D,EADF,EACyB/4D,EAAA,aACnB,CACEX,IAAK,IAAIwwB,IAAI7vB,EAAR,gBAAwCqkB,MAE/C,CACEhlB,IAAK,IAAIwwB,IAAI,GAAR,OAAW7vB,EAAX,sBAA+CqkB,MAGnCrkB,EAAA,aACnB,CAAEf,UAAWe,EAAMioF,cACnB,CAAEhpF,UAAW,GAAF,OAAKe,EAAL,oBAEV,CACLyC,KADK,kBAELpG,KAAM2D,EAFD,WAGL0E,YAAa1E,EAHR,UAIL2E,SAJK,EAKL47B,QAAS,CACP99B,KADO,cAEPC,YAFO,EAGPd,MAAO,CAAEN,SAAUy3D,GACnB5zB,oBAGN,UAMA,UAMA,iBAMA,qBAMA,eAMA,UAMA,aACE,OAAO9gC,uCACLrE,EADiC,aAAnC,GAKF,QACE,MAAM,IAAIvG,MAAM,2BAAV,OAAN,KAnOUu/D,CAAgB,EAG1BT,cAHyB,IAA3B,GAQA,OAFAh7B,sCAAmC14B,qBAAnC04B,IACAA,gBAAoB,CAApBA,GACAA,KCNW,mBACb,OAAO,gDAEL27B,sCAFK,GAGL,cACS,CACLz2D,KAAMjF,gBADD,iCAEL0C,cAAe2a,iCAAuB,MAH1C,SAKW,SAAAjc,GAAI,MAAK,CAChBu6D,QADgB,YAEdv6D,UACA,IAAM8oF,EAAYhsF,yBAAewsF,EAAjC,aACAjiE,MAAM,uDAAD,OAALA,UAGQ,SAAAkiE,GAAW,OAAIA,EAAJ,UAHnBliE,MAIQ,SAAAsyC,GAEJ,IAAM1iE,EAAe0iE,mBAArB,KAGMuB,EAFU39C,qBAAhB,GACiB9O,oBAAjB,GACA,cACM83B,EAAkBzpC,yBAAeo+D,EAAc,CAAC,WAAtD,YAIAl7D,gBACE05D,GAAeC,EAAS1iE,EAD1B+I,OAdJqnB,OAkBS,SAAAzL,GACLua,2BCpCOqzD,G,4MACnB/rF,KAAO,yB,6CAEP,SAAQkT,GACNA,EAAcouD,mBACZ,kBACE,IAAIj1B,EAAe,CACjBrsC,KAAM,gCACN0e,gBACA4tB,sBAAuBnnB,gBACrB,kBAAM,mCAERrG,WAAYw3D,GAAapjE,GACzBsG,YAAa,yBACbnR,YAAa,oCACbkgB,IAAK,mC,GAfqCnD,K,sFCNrC,YAAAlS,GAAiB,IAEtB/R,GAAUmd,EADIpL,EADQ,oCAiC9B,OA5BA,cASE,QANE84E,8BAMF,MAN2B,KAM3B,MALEC,uBAKF,MALoB,KAKpB,EAJEC,EAIF,EAJEA,QAIF,IAHE1yE,mBAGF,WAHgBxd,EAGhB,MAFEmwF,oBAEF,WAFiBnwF,EAEjB,EACA,OAAOmF,EAAA,iCAC2B,CAC9BiF,KAAMjF,eAFH,UAIK,iBAAO,CACf6qF,uBADe,EAEfC,gBAFe,EAGfzyE,YAAaA,GAHE,EAIf2yE,mBARG,OAUE,iBAAO,CACZD,QADY,EAEZ,gBACE,iBCvBK,YAAAh5E,GAAiB,IACtBoL,EAAcpL,EADQ,YAEQoL,EAFR,mBAEtBnd,EAFsB,QAEfirF,EAFe,UAENpoF,EAFM,YAGtB1D,EAAage,EAHS,uBAIxBpJ,EAAQoJ,EAAd,SAJ8B,EAMgCA,EANhC,qCAMtB+tE,EANsB,kBAMLC,EANK,uBAMiBC,EANjB,eAUsBjuE,EAVtB,sBAUtBkuE,EAVsB,cAUT1sE,EAVS,aAUG2sE,EAVH,iBAcxBC,EAA4BpuE,EAAlC,IAEQjQ,EAAeiQ,EAhBO,uCAiBxBjH,EAAaiH,EAAnB,gCACMuK,EAAYvK,EAAlB,+BACMquE,EAAWruE,EAAjB,8BACMgM,EAAiBhM,EAAvB,oCACMsuE,EAAStuE,EAAf,4BAEMlQ,EAAYC,GAAW,WAC3B,MAAO,CACLw+E,2BAA4B,CAAEpnE,YAAa,SAC3CqnE,kBAAmB,CACjB3iF,OAAQ,CAAC,CAAC,EAAG,EAAG,EADC,WAEjB,0BAA2B,CACzB4P,UAAW,GAEb,+BAAgC,CAC9BlJ,IAD8B,OAE9B,yBAA0B,CACxBA,IAAK,cAQTk8E,EAAuBzsF,GAAS,YAAqB,IAAlB0sF,EAAkB,EAAlBA,YACjCz9E,EAAUnB,IACV6+E,EAAmBX,EACvBC,EAAWF,EAAgBD,EAAD,GAD5B,eAGA,OACE,gCACE,mBACEvtF,MAAOmuF,EADT,UAEEt6E,SAAU,SAAAhD,GACRs9E,eAAyBlqE,OAAOpT,SAAhCs9E,UAGDC,EAAA,KAAqB,SAAAjtF,GAAI,OACxB,mBAAUpF,IAAV,EAAqBiE,MAAOmB,GADJ,OAP9B,IAaE,mBACE8oB,MADF,QAEEokE,YAFF,eAGE/uE,MAAO6uE,EAHT,mBAIEnuF,MAAOmuF,EAJT,UAKEt6E,SAAU,SAAA4P,GAAG,OAAI0qE,eAAyB1qE,SAA7B,QACbzT,UAAWU,EANb,kBAOE6a,WAAY,CACVC,aACE,mBACExb,UAAWU,EADb,2BAEE9R,SAAS,OAET,mBACEyQ,aADF,eAEE6E,QAAS,kBAAMi6E,eAAN,KACTthF,MAAM,aAEN,qBATJ,eAmBNyhF,EAAa,CAAC,gBAAD,8EAzFW,oBAmGxBC,EAAuB,CAC3B,gBAAiB,cACf,OACEC,YAAyBC,EAAzBD,SACAr+B,aACEq+B,EADY,MAEZA,EAFY,IAGZC,EAHY,MAIZA,EANJ,MAUF,mBAAoB,cAClB,OACED,YAAyBC,EAAzBD,SACAE,aACEF,EADe,MAEfA,EAFe,IAGfC,EAHe,MAIfA,EANJ,MAUF,iBAAkB,cAChB,OACED,YAAyBC,EAAzBD,SACAE,aACED,EADe,MAEfA,EAFe,IAGfD,EAHe,MAIfA,EANJ,MAWJD,mBAA2C,cAIzC,OAAQA,qBAAR,IAKFA,uBAA+C,cAI7C,OAAQA,wBAAR,IAKFA,mBAA2C,cAIzC,OAAQA,sBAAR,KA5J4B,4CA6O9B,uDAAA7vF,EAAA,6DACQyT,EAAU8O,EADlB,GAEUwZ,EAAoBtoB,EAF9B,gBAGUxX,EAAiBg0F,EAH3B,eAIiBxpF,EAJjB,GAIU9H,EAJV,cAKyBo9B,kBALzB,aAKQs9B,EALR,gBAOUvd,EAAMozC,EAAegB,EAAD,MAAY,SAAAztF,GAAI,OACxCs5B,mBAAqCk0D,EADG,iBAGlC/zF,EAAY4/C,EAVxB,QAWUq0C,EAAmB92B,sBAX7B,GAYU+2B,EAAqB/2B,EAAA,cACzB,SAAAt9D,GAAM,OAAIA,YAAJ,KAGFs0F,EAhBV,2BAiBQj1E,EAAO3H,EAAA,YAAmB,SAAA+gB,GAAC,OAAIA,OAAJ,KAjBnC,wBAmBMpZ,EAAO3H,EAAA,2BAAoC,CACzCwI,YADyC,EAEzCtd,GAAI0xF,IArBZ,UAuBY7wC,gBAAK,kBAAMpkC,EAAN,eAvBjB,QA2BMA,sBAAyB,CACvBqgB,WAAWA,eADbrgB,MA3BN,QA+BIA,iBAAoB80E,EAApB90E,MA/BJ,kDAiCI3H,kCAjCJ,2DA7O8B,sBA8S9B,OAV4B07E,EAA0B,YAAa,CACjEP,aADiE,WAEjE3yE,YAFiE,gBAGjE0yE,QAHiE,cAI/D,OAAOM,EAAYqB,EAAD,aAAqBC,EAAvC,eAEF7B,gBAvIsB9qF,EAAA,8BACU,CAC9BiF,KAAMjF,UADwB,aAE9B4sF,aAAc5sF,EAFgB,QAG9B6sF,UAH8B,GAI9Bpf,UAAWztE,WAAeA,cAAfA,GAA8CgsF,EAA9ChsF,MALS,OAOf,SAAAoB,GAAI,MAAK,CACd,yBACE,GAAIA,EAAJ,UAAoB,CAClB,IAAM0rF,EAAS1rF,EAAf,gBACA,OACG0rF,GAAD,KACAA,WADA,kBAEOA,EAAP,OAFA,kBAGOA,EAAP,KACAA,QAAeA,EALjB,IAQF,UAEF,sBACE,IAAMj9E,EAAU8O,EAAhB,GAEQtmB,EADMwK,EAAUzB,EAAVyB,GAAd,YAFoB,aAIpB,IACE,OAAOyoF,EAAelqF,EAAD,WAAiB,SAAA9I,GAAO,OAC3CuX,mCAD2C,MAG7C,MAAO4hB,GACP,SAIJ,gBACE,IAAKrwB,EAAD,WAAmBA,EAAvB,mBACE,OAAO,WACL,UAHU,IAON2rF,EAA6C3rF,EAPvC,gBAOWqsE,EAA4BrsE,EAPvC,UAOsBwrF,EAAiBxrF,EAPvC,aAQd,OAAO,SAAyB4rF,EAAO9hB,GAAK,IAEpCohB,EAD8BphB,EADM,iBAE1C,GAEA,IAAKohB,IAASA,EAAV,OAAwBA,EAA5B,aACE,SAEF,IAAMW,EAAiBX,EAAvB,aACA,IAAKW,EAAL,QACE,SAGF,IAAMC,EAAYjB,EAAlB,GACA,MACE,MAAM,IAAIhwF,MAAM,IAAV,SAAN,yCAGF,OAAOixF,EAAUD,EAAjB,SA3DgB,SA+Db,SAAA7rF,GAAI,MAAK,CAChB+rF,aADgB,YAEd/rF,eAEFgsF,aAJgB,YAKdhsF,mBApEkB,UAuEZ,iBAAO,CAAE0Q,eAAgB85E,MAiEnCf,uBAzB6B1rF,GAC7B,YAAyC,IAAtCmtF,EAAsC,EAAtCA,KAAMM,EAAgC,EAAhCA,aAAcP,EAAkB,EAAlBA,YAKrB,OACE,qBACEz6E,QANJ,YACEuP,mBArRwB,wCAsRxBksE,CAAkBhB,EAAaO,EAA/BS,IAKEl1E,MAFF,qCAGE0O,KAAK,SAEJylE,EANL,YC1RS,YAAAv6E,GAAiB,IACtBoL,EAAcpL,EADQ,YAEHoL,EAFG,mBAEtBnd,EAFsB,QAEfirF,EAFe,UAGtB9rF,EAAage,EAHS,uBAIxBpJ,EAAQoJ,EAAd,SAJ8B,EAMgCA,EANhC,qCAMtB+tE,EANsB,kBAMLC,EANK,uBAMiBC,EANjB,aAUxBG,EAA4BpuE,EAAlC,IAEM6uE,EAAa,CAAC,SAAD,6DAZW,aAsBxBC,EAAuB,CAC3BqB,SAAU,cACR,WAAOC,4BAETC,OAAQ,cACN,OAAOD,kBAAP,GAEF,cAAe,cACb,WAAOA,4BAET,YAAa,cACX,IAAMnpF,EAAQmpF,wBAAd,GACA,WAAInpF,GAGGA,IAAUmpF,SAAoBE,EAArC,QAGJxB,mBAA2C,cACzC,OAAQA,aAAR,IAEFA,iBAAyC,cACvC,OAAQA,WAAR,KAGM/+E,EAAeiQ,EA/CO,uCAgDxBjH,EAAaiH,EAAnB,gCACMuK,EAAYvK,EAAlB,+BACMquE,EAAWruE,EAAjB,8BACMgM,EAAiBhM,EAAvB,oCACMsuE,EAAStuE,EAAf,4BAEMlQ,EAAYC,GAAW,WAC3B,MAAO,CACLw+E,2BAA4B,CAAEpnE,YAAa,SAC3CqnE,kBAAmB,CACjB3iF,OADiB,EAEjB,0BAA2B,CACzB4P,UAAW,GAEb,+BAAgC,CAC9BlJ,IAD8B,OAE9B,yBAA0B,CACxBA,IAAK,cAQTk8E,EAAuBzsF,GAAS,YAAqB,IAAlB0sF,EAAkB,EAAlBA,YACjCz9E,EAAUnB,IACV6+E,EAAmBX,EACvBC,EAAWF,EAAgBD,EAAD,GAD5B,eAGA,OACE,gCACE,mBACEvtF,MAAOmuF,EADT,UAEEt6E,SAAU,SAAAhD,GACRs9E,eAAyBlqE,OAAOpT,SAAhCs9E,UAGDC,EAAA,KAAqB,SAAAjtF,GAAI,OACxB,mBAAUpF,IAAV,EAAqBiE,MAAOmB,GADJ,OAP9B,IAaE,mBACE8oB,MADF,OAEEjqB,MAAOmuF,EAFT,aAGEt6E,SAAU,SAAA4P,GAAG,OAAI0qE,YAAsB1qE,SAA1B,QACbzT,UAAWU,EAJb,kBAKE6a,WAAY,CACVC,aACE,mBACExb,UAAWU,EADb,2BAEE9R,SAAS,OAET,mBACEyQ,aADF,eAEE6E,QAAS,kBAAMi6E,YAAN,KACTthF,MAAM,aAEN,qBATJ,eAoBNmjF,EAAmB1tF,EAAA,yBACI,CACzBiF,KAAMjF,UADmB,QAEzB4sF,aAAc5sF,EAFW,QAGzBytF,aAHyB,GAIzBhgB,UAAWztE,WAAeA,cAAfA,GAA8CgsF,EAA9ChsF,MALU,OAOhB,SAAAoB,GAAI,MAAK,CAEd,gBAAgB,IACNqsF,EAA0CrsF,EADpC,aACQwrF,EAA4BxrF,EADpC,aACsBqsE,EAAcrsE,EADpC,UAEd,MACE,OAAO,WACL,UAGJ,IAAM+tB,EAAIs+D,EAPI,cAQd,OAAO,SAAyBT,EAAO9hB,GAAK,IAEpCohB,EADuBphB,EADa,iBAE1C,GACA,IAAKohB,IAASA,EAAd,KACE,SAEF,IAAMY,EAAYjB,EAAlB,GACA,MACE,MAAM,IAAIhwF,MAAM,IAAV,SAAN,yCAEF,OAAOixF,EAAUZ,EAAD,KAAhB,SA3BiB,SA+Bd,SAAAlrF,GAAI,MAAK,CAChBusF,UADgB,YAEdvsF,kBAEFgsF,aAJgB,YAKdhsF,mBApCmB,UAuCb,iBAAO,CAAE0Q,eAAgB85E,MASrC,MAAO,CAAEgC,WAPcrC,EAA0B,OAAQ,CACvDR,QADuD,cAErD,OAAO2B,qBAAyBC,EAAhC,OAEF7B,gBAAiB4C,IAGkB5C,gBAAiB4C,ICvKzC,eAAmB,IAAhBvwE,EAAgB,EAAhBA,UACRnd,EAAUmd,EADc,yBAE1BouE,EAA4BpuE,EAAlC,IAEyB0wE,EAAsB1wE,EAJf,oBAsBhC,OATeouE,EAA0B,SAAU,CACjDP,aADiD,WAEjD3yE,YAFiD,gBAGjD0yE,QAHiD,cAI/C,OAAO2B,qBAAyBC,EAAhC,OAEF7B,gBAbsB9qF,EAAA,UAEtBA,EAAA,MAAY,CACViF,KAAMjF,0BCVG,eAAmB,IAAhBmd,EAAgB,EAAhBA,UACRnd,EAAUmd,EADc,yBAExBhe,EAAage,EAFW,uBAG1BpJ,EAAQoJ,EAAd,SAEMouE,EAA4BpuE,EAAlC,IAEQjQ,EAAeiQ,EAPS,uCAQ1BuK,EAAYvK,EAAlB,+BACMquE,EAAWruE,EAAjB,8BACMsuE,EAAStuE,EAAf,4BAEM6uE,EAAa,CAAC,SAAD,qCAZa,eAqB1BC,EAAuB,CAC3BuB,OAAQ,cACN,OAAOM,IAAP,GAEF,eAAgB,cACd,OAAOA,EAAP,GAEF,YAAa,cACX,OAAOA,EAAP,GAEFC,QAAS,gBACP,OAAOD,KAA8BA,EAArC,GAGJ7B,cAAsC,gBAKpC,OAAQA,cAAR,KAOIh/E,EAAYC,GAAW,WAC3B,MAAO,CACLw+E,2BAA4B,CAAEpnE,YAAa,SAC3CqnE,kBAAmB,CACjB3iF,OAAQ,CAAC,CAAC,EAAG,EAAG,EADC,WAEjB,0BAA2B,CACzB4P,UAAW,GAEb,+BAAgC,CAC9BlJ,IAD8B,OAE9B,yBAA0B,CACxBA,IAAK,cAQTk8E,EAAuBzsF,GAAS,YAAqB,IAAlB0sF,EAAkB,EAAlBA,YACjCz9E,EAAUnB,IAEV6+E,EAAN,EAEA,OACE,gCACE,mBACEpuF,MAAOmuF,EADT,UAEEt6E,SAAU,SAAAhD,GACRs9E,eAAyBlqE,OAAOpT,SAAhCs9E,UAGDC,EAAA,KAAqB,SAAAjtF,GAAI,OACxB,mBAAUpF,IAAV,EAAqBiE,MAAOmB,GADJ,OAP9B,IAaE,mBACE8oB,MADF,SAEEokE,YAFF,MAGE9mF,KAHF,SAIE+X,MAAO6uE,EAJT,qBAKE5pE,aAAc4pE,EALhB,YAMEt6E,SAAU,SAAA4P,GACR0qE,iBAA2Bn0C,WAAWv2B,SAAtC0qE,SAEFn+E,UAAWU,EAAQu9E,oBAEpBE,yCACDA,YADCA,KAEC,wCAEE,mBACElkE,MADF,SAEEokE,YAFF,MAGE9mF,KAHF,SAIE+X,MAAO6uE,EAJT,sBAKE5pE,aAAc4pE,EALhB,aAMEt6E,SAAU,SAAA4P,GAAG,OACX0qE,kBAA4Bn0C,WAAWv2B,SAD5B,SAGbzT,UAAWU,EAAQu9E,yBASzBb,EAAkB9qF,EAAA,2BACO,CAC3BiF,KAAMjF,UADqB,UAE3B4sF,aAAc5sF,EAFa,QAG3BguF,YAAahuF,QAAYA,EAHE,QAI3BiuF,aAAcjuF,QAAYA,EAJC,QAK3BytE,UAAWztE,WAAeA,cAAfA,GAA8CgsF,EAA9ChsF,MANS,OAQf,SAAAoB,GAAI,MAAK,CAEd,gBACE,qBAAWA,EAAP,YACF,OAAO,WACL,UAHU,IAON4sF,EAAuD5sF,EAPjD,YAOO6sF,EAA0C7sF,EAPjD,aAOqBqsE,EAA4BrsE,EAPjD,UAOgCwrF,EAAiBxrF,EAPjD,aAQd,OAAO,SAAyB4rF,EAAO9hB,GAAK,IAEpCohB,EADuBphB,EADa,iBAE1C,GAEA,IAAKohB,IAASA,EAAd,KACE,SAGF,IAAMW,EAAiBv1C,WAAW40C,EAAlC,MACA,qBAAWW,EACT,SAGF,IAAMC,EAAYjB,EAAlB,GACA,MACE,MAAM,IAAIhwF,MAAM,IAAV,SAAN,yCAGF,OAAOixF,EAAUD,EAAgBe,EAAjC,SApCgB,SAwCb,SAAA5sF,GAAI,MAAK,CAChB8sF,eADgB,YAEVv7D,iBAAJ,kBAA8BoG,EAC5B33B,qBAEAA,iBAGJ+sF,gBARgB,YASVx7D,iBAAJ,kBAA8BoG,EAC5B33B,sBAEAA,kBAGJgsF,aAfgB,YAgBdhsF,mBAxDkB,UA2DZ,iBAAO,CAAE0Q,eAAgB85E,MASrC,MAAO,CAAEwC,aAPY7C,EAA0B,SAAU,CACvDR,QADuD,cAErD,OAAOrzC,WAAWg1C,EAAXh1C,MAAyBA,WAAWi1C,EAA3C,OAEF7B,oBAGqBA,oBCzLV,eAAmB,IAAhB3tE,EAAgB,EAAhBA,UACRnd,EAAUmd,EADc,yBAE1BouE,EAA4BpuE,EAAlC,IAEyB0wE,EAAsB1wE,EAJf,oBAsBhC,OATiBouE,EAA0B,WAAY,CACrDP,aADqD,WAErD3yE,YAFqD,QAGrD0yE,QAHqD,cAInD,OAAOrzC,WAAWg1C,EAAXh1C,MAAyBA,WAAWi1C,EAA3C,OAEF7B,gBAbsB9qF,EAAA,UAEtBA,EAAA,MAAY,CACViF,KAAMjF,4BCTG,eAAmB,IAAhBmd,EAAgB,EAAhBA,UACRnd,EAAUmd,EADc,yBAE1BouE,EAA4BpuE,EAAlC,IAEyB0wE,EAAsB1wE,EAJf,oBAsBhC,OATeouE,EAA0B,SAAU,CACjDP,aADiD,WAEjD3yE,YAFiD,MAGjD0yE,QAHiD,cAI/C,OAAOrzC,WAAWg1C,EAAXh1C,MAAyBA,WAAWi1C,EAA3C,OAEF7B,gBAbsB9qF,EAAA,UAEtBA,EAAA,MAAY,CACViF,KAAMjF,0BCJG,YAAC+R,GAAiC,IACvCoL,EAAcpL,EAAdoL,UACAnd,EAAUmd,EAAU,mBAApBnd,MAKFquF,EAAc,CAClB17D,OAJ+BxV,EAAUmxE,IAAnCF,aAKN1hF,KAJ2ByQ,EAAUoxE,IAA/BX,WAKNY,UAAWrxE,EAAUsxE,IACrBC,OAAQvxE,EAAUwxE,IAClBC,SAAUzxE,EAAU0xE,IACpBC,OAAQ3xE,EAAU4xE,KAGdC,EAAiBxwF,OAAOrB,OAAOkxF,GAC/BY,EAAgBjvF,EAAMsC,MAAN,MAAAtC,EAAK,YAAUgvF,IAErC,OAAOxwF,OAAO0wF,OAAO,CACnBb,cACAY,gBAEAE,mBAAoBnvF,EAAMsC,MAAN,MAAAtC,EAAK,YACpBgvF,EACAxvF,KAAI,SAAA4vF,GAKH,OAH4BA,EAAWxhE,OAAO,CAC5C3oB,KAAMmqF,EAAWC,WAAWpqF,KAAKvH,QAD3BotF,mBAMTvlE,QAAO,SAAA6pB,GAAC,QAAMA,UCvCR,YAACr9B,GAAiC,MAC/BA,EAARmM,IACyB,mBAAzBle,EAFuC,EAEvCA,MAAO6C,EAFgC,EAEhCA,UAETysF,EAAYtvF,EAAMnJ,MAAM,kBAAmB,CAC/C2lB,KAAMxc,EAAMS,OACZ8uF,aAAcvvF,EAAM+B,MAAM/B,EAAMksC,YAwClC,OArCiBlsC,EACdnJ,MAAM,iBAAkB,CACvBkE,GAAIiF,EAAME,WACVsvF,MAAOxvF,EAAM6oB,MAAMymE,GACnBC,aAAcvvF,EAAM+B,MAAM/B,EAAMksC,UAChCujD,YAAY,IAEbtuF,SAAQ,SAAAC,GAAI,MAAK,CAChBsuF,aADgB,WAEdtuF,EAAKquF,YAAcruF,EAAKquF,YAE1BE,SAJgB,WAKdvuF,EAAKquF,YAAa,GAEpBG,OAPgB,WAQdxuF,EAAKquF,YAAa,GAEpBI,gBAVgB,SAUA10F,GACdiG,EAAKmuF,aAAep0F,OAGvBue,OAAM,SAAAtY,GAAI,MAAK,CACd,uBAAuB,IACb0uF,EAAYjtF,EAAUzB,EAAM,GAA5B0uF,QACJriE,EAAI,EAER,OAAOqiE,EAAQtwF,KAAI,SAACuwF,GAClB,OAAIA,EAAOC,UACFD,EAAOE,KAAKC,SAAS,CAC1BhlB,IAAK9pE,IAGFA,EAAKouF,MAAM/hE,cCsBb0iE,GA9DgB,SAACp+E,GAAiC,IACvDmM,EAAcnM,EAAdmM,IAAKC,EAASpM,EAAToM,KADkD,EAElCD,EAAI,mBAAzBle,EAFuD,EAEvDA,MAAO6C,EAFgD,EAEhDA,UACTutF,EAAWjyE,EAAKkyE,IAEtB,OAAOrwF,EACJnJ,MAAM,eAAgB,CACrBy5F,SAAUtwF,EAAMye,SAAQ,GACxBkhE,KAAM3/E,EAAM6oB,MAAMunE,KAEnB12E,OAAM,SAAAtY,GAAI,MAAK,CACd,YACE,OAAOA,EAAKu+E,KAAK3lF,QAGnB,0BACE,OAAOS,KAAK81F,mBAAmBv2F,QAGjC,oBACE,OAAOS,KAAK+1F,aAAax2F,QAG3B,qCACE,OAAOS,KAAKg2F,qBAAqBz2F,QAGnC,iBACE,IAAM4I,EAASC,EAAUzB,GACzB,OAAOA,EAAKu+E,KAAK5pC,QAAQgY,KAAKnrD,EAAO8tF,+BAGvC,mBACE,OAAOtvF,EAAKu+E,KAAKp6D,QAAO,SAAAxC,GAAC,OAAIA,EAAE0sE,eAGjC,2BACE,IAAMzC,EAAQnqF,EAAUzB,GAEhB0qE,EADKjpE,EAAUmqF,GACflhB,eACR,OAAOrxE,KAAK+1F,aAAajrE,QAAO,SAAA2lD,GAAG,OACjCY,EAAe6kB,iBAAiB3D,EAAO9hB,OAK3C,yBACE,IAAM8hB,EAAQnqF,EAAUzB,GAEhB0qE,EADKjpE,EAAUmqF,GACflhB,eACR,OAAO1qE,EAAKu+E,KACTp6D,QAAO,SAAA2lD,GAAG,OAAIY,EAAe6kB,iBAAiB3D,EAAO9hB,MACrDnd,KAAKi/B,EAAM0D,mCAGjBvvF,SAAQ,SAAAC,GAAI,MAAK,CAChBwvF,YADgB,WAEdxvF,EAAKu+E,KAAKznF,SAAQ,SAAAgzE,GAAG,OAAIA,EAAIykB,oBC0GtBkB,GA7JW,SAAC9+E,GAAiC,IAClDmM,EAAcnM,EAAdmM,IAAKC,EAASpM,EAAToM,KAD6C,EAE7BD,EAAI,mBAAzBle,EAFkD,EAElDA,MAAO6C,EAF2C,EAE3CA,UAF2C,EAInBsb,EAAK2yE,IAApCzC,EAJkD,EAIlDA,YAAaY,EAJqC,EAIrCA,cAEf8B,EAAoB5yE,EAAK6yE,IAGzBC,EAAmBjxF,EACtBnJ,MAAM,mBAAoB,CACzBgI,KAAMmB,EAAM+B,MAAM/B,EAAMS,QACxBywF,SAAUlxF,EAAMC,SAASgvF,GAAe,iBAAO,CAC7ChqF,KAAM,WAKR+qF,WAAW,EAEXmB,uBAAwBnxF,EAAM+B,MAAM/B,EAAMS,UAE3CiZ,OAAM,SAAAtY,GAAI,MAAK,CACd,WACE,GAAIA,EAAK4uF,UAEP,OAAOoB,aACLzvE,OAAOvgB,EAAK+vF,wBACZp/E,EAAcw9B,WA8HxB,OAtHmBvvC,EAChBnJ,MAAM,cAAe,CACpBw6F,OAAQrxF,EAAMC,SAAS8wF,GAAmB,kBACxCA,EAAkBnjE,YAEpBkiE,QAAS9vF,EAAM6oB,MAAMooE,GACrBK,mBAAoBtxF,EAAM6oB,MAAM7oB,EAAMW,QACtC4wF,gBAAgB,EAEhBC,YAAaxxF,EAAM6oB,MACjB7oB,EACGnJ,MAAM,cAAe,CACpB+1F,aAAc5sF,EAAMW,OACpB8wF,YAAY,IAEbtwF,SAAQ,SAAAC,GAAI,MAAK,CAChBswF,gBADgB,WAEdtwF,EAAKqwF,YAAcrwF,EAAKqwF,iBAKhCp5F,aAAc2H,EAAM+B,MAAM/B,EAAMS,UAEjC21B,UAAS,iBAAO,CACfu7D,gBAAiBtD,EAAY3hF,KAC7BklF,gBAAiB,KACjBtB,UAAU,MAEX52E,OAAM,SAAAtY,GAAI,MAAK,CACd,kBACE,IAAMyO,EAAU8O,qBAAWvd,GACrBvC,EAAOuC,EAAK/I,aAClB,GAAIwG,EAAM,CACR,IAAMgzF,EAAMhiF,EAAQsoB,gBAAgBv9B,IAAIiE,GACxC,OAAOgzF,GAAOA,EAAIt4D,YAEpB,OAAO,GAET,uBAEE,OAAO12B,EAAUzB,GAAM0wF,kBAKzB,sBAIE,OAHkBtzF,OAAOlB,KACvB+wF,GAEe7uF,KAAI,SAAAwvC,GACnB,IAAMkiD,EAAW7C,EAAYr/C,GAAUphB,OAAO,CAAE3oB,KAAM+pC,IAEtD,MAAO,CAAEA,WAAU32B,YADmB64E,EAA9B74E,YACwB2yE,aADMkG,EAAjBlG,kBAKzB0F,6BA5Bc,SA4BeqB,EAAWC,GACtC,IAAK,IAAIvkE,EAAI,EAAGA,EAAIrsB,EAAKowF,YAAYx3F,OAAQyzB,GAAK,EAAG,OACdrsB,EAAKowF,YAAY/jE,GAA9Cm/D,EAD2C,EAC3CA,aAAc6E,EAD6B,EAC7BA,WAEhB50F,EADeuE,EAAK0uF,QAAQlD,GAA1BsE,SACgBnG,QACtBgH,EAAKE,iBAAiBrF,GACtBoF,EAAKC,iBAAiBrF,IAExB,GAAI/vF,EACF,OAAO40F,GAAc50F,EAASA,EAGlC,OAAO,OAGVsE,SAAQ,SAAAC,GAAI,MAAK,CAChBk1B,YADgB,WACF,WACZ8E,sBACEh6B,EACA25B,mBAAO,sBAAC,8BAAA3+B,EAAA,yDACAyT,EAAU8O,qBAAWvd,GACnB+2B,EAAoBtoB,EAApBsoB,gBAFF,UAIA/2B,EAAK/I,aAJL,gCAKI8/B,EAAgB+5D,gBAAgB9wF,EAAK/I,cALzC,OAMF,EAAK85F,WAAU,GANb,uDASJtiF,EAAQq0C,OAAR,kCAC6B9iD,EAAK/I,aADlC,kBAEE,SAXE,4DAkBZ85F,UAtBgB,SAsBNnvC,GACR5hD,EAAKkvF,SAAWttC,GAGlBovC,mBA1BgB,SA0BGC,GACjBjxF,EAAKwwF,gBAAkBS,GAGzBC,eA9BgB,SA+BdC,GAEIA,IAEFnxF,EAAKowF,YAAce,IAGvBC,cAtCgB,SAsCF5F,EAAsB6F,GAClCrxF,EAAK0uF,QAAQlD,GAAcsE,SAAW,CAAEjsF,KAAMwtF,IAEhD7B,YAzCgB,WA0Cd,OAAOxvF,EAAKiwF,OAAOT,oBC3JrB8B,GAAoB,IAEX,YAAC3gF,GAAiC,IACvCmM,EAAQnM,EAARmM,IADuC,EAETA,EAAI,mBAAlCle,EAFuC,EAEvCA,MAAO6C,EAFgC,EAEhCA,UAAW4kB,EAFqB,EAErBA,QAClBxpB,EAAiBigB,EAAI,yBAArBjgB,aACAC,EAAmBggB,EAAI,+BAAvBhgB,eAEFy0F,EAAY,CAAC,MAAO,MAAO,MAAO,MAAO,QAAS,eAClDC,EAAkB,CACtBC,IAAK,kBACH,qDAAwC/vE,MAAK,SAAAC,GAAC,OAAIA,EAAE+vE,mBACtDC,IAAK,kBACH,qDAAwCjwE,MAAK,SAAAC,GAAC,OAAIA,EAAEiwE,mBACtDC,IAAK,kBACH,sDAAsCnwE,MAAK,SAAAC,GAAC,OAAIA,EAAEmwE,mBACpDC,IAAK,kBACH,qDAAsCrwE,MAAK,SAAAC,GAAC,OAAIA,EAAEqwE,mBACpDC,MAAO,kBACL,qDAAsCvwE,MAAK,SAAAC,GAAC,OAAIA,EAAEuwE,qBACpD,cAAe,kBACb,sDAA6CxwE,MAC3C,SAAAC,GAAC,OAAIA,EAAEwwE,2BAIPC,EAAkB,IAAI/0B,OAAJ,cACfk0B,EAAUp6E,KAAK,KADA,cAEtB,KAGF,OAAOvY,EACJnJ,MAAM,0BAA2B,CAChC48F,SAAUzzF,EAAMC,SAASD,EAAMwiB,YAAYmwE,GAAY,OACvDe,mBAAmB,EACnBC,qBAAsB,EACtBC,oBAAqB,IAEtBx9D,UAAS,iBAAO,CACfu8D,YAEAkB,gBAAYh5F,EACZmiB,WAAOniB,EACPq6B,SAAS,MAEVxb,OAAM,SAAAtY,GAAI,MAAK,CACd,oBACE,OACGA,EAAK4b,OACN5b,EAAKyyF,aACJzyF,EAAKyyF,WAAW5vF,MACf7C,EAAKyyF,WAAWpyF,WAChBL,EAAKyyF,WAAWhyF,MAGtB,gBACE,OAAOgB,EAAUzB,GAAM0yF,gBAEzB,sBACE,OAAOrsE,EAAQrmB,GAAM0jB,QAAQitB,YAE/B,2BACE,IAAM8/C,EAAMpqE,EAAQrmB,GAAM0jB,QAAQitB,WAAW3wC,EAAKwyF,qBAClD,GAAI/B,EACF,OAAO3zF,EAAe2zF,EAAK,SAK/B,eACE,OACEzwF,EAAKyyF,WAAWhyF,KAChBT,EAAKyyF,WAAWpyF,WACfL,EAAKyyF,WAAW5vF,MAAQ7C,EAAKyyF,WAAW5vF,KAAKpF,MAIlD,oBACE,OAAOpE,KAAKgK,SAASM,SAAS,OAGhCgvF,eApCc,SAoCCz7F,EAAiBD,GAC9B,OAAOsmB,qBAAWvd,GAAM+2B,gBAAgB47D,eACtCz7F,EACAD,QAIL8I,SAAQ,SAAAC,GAAI,MAAK,CAChB4yF,cADgB,SACFC,GAIZ,GAHA7yF,EAAKyyF,WAAaI,EAClB7yF,EAAK4b,WAAQniB,EAETuG,EAAKyyF,WAAY,CAEnB,IAAMh1F,EAAOuC,EAAKqD,SAElB,GAAI5F,EAAM,CACR,IAAM8qE,EAAQ6pB,EAAgBhiE,KAAK3yB,GAC/B8qE,GAASA,EAAM,KACA,QAAbA,EAAM,IAAgB9qE,EAAK8mB,SAAS,eACtCvkB,EAAKqyF,SAAW,cAEhBryF,EAAKqyF,SAAW9pB,EAAM,GAAG7kE,kBAOnCovF,uBAtBgB,SAsBOthC,GACrBxxD,EAAKwyF,oBAAsBhhC,GAG7BuhC,wBA1BgB,WA2Bd/yF,EAAKsyF,mBAAqBtyF,EAAKsyF,mBAGjCU,wBA9BgB,SA8BQC,GAClBA,EAAY,IACdjzF,EAAKuyF,qBAAuBU,IAIhCC,YApCgB,SAoCJtlD,GACV5tC,EAAKqyF,SAAWzkD,GAGlBhY,SAxCgB,SAwCPha,GACPua,QAAQva,MAAMA,GACd5b,EAAK8zB,SAAU,EACf9zB,EAAK4b,MAAQA,GAGfm1E,UA9CgB,WA+Cd/wF,EAAK8zB,SAAU,EACf9zB,EAAK4b,WAAQniB,GAGf05F,aAnDgB,WAoDdnzF,EAAK4b,WAAQniB,EACbgI,EAAUzB,GAAM68B,kBAKZu2D,OA1DU,WA0DD,8IAENpzF,EAAKyyF,WAFC,qDAMPzyF,EAAK8zB,QANE,sBAOH,IAAIj5B,MAAM,2CAPP,cASXmF,EAAK8zB,SAAU,EATJ,SAUc09D,EACvBxxF,EAAKqyF,YAXI,UAULgB,EAVK,8BAcH,IAAIx4F,MAAJ,qCAAwCmF,EAAKqyF,SAA7C,MAdG,yBAiBa,kCAjBb,iBAiBHiB,EAjBG,EAiBHA,OAEF12F,EAAaC,EAAamD,EAAKyyF,aAElC3vD,OACAphB,MAAK,SAAAohB,GACJ,GAAIA,EAAKp7B,KAAO4pF,GACd,MAAM,IAAIz2F,MAAJ,gEACqD,IAEvD+7C,iBAHE,WAOTl1B,MAAK,kBAAM9kB,EAAWimC,cACtBnhB,MAAK,SAAA3mB,GACJ,OAAOiF,EAAKuzF,cAAgBD,EAAMv4F,GAAUA,KAE7C2mB,MAAK,SAAA3mB,GAAM,OAAIs4F,EAAWt4F,EAAkBiF,MAC5C0hB,MAAK,SAAAupE,GACJ,EAAK8F,YACLtvF,EAAUzB,GAAMwzF,mBAAmBvI,MAEpCr0D,MAAM,EAAKhB,UAxCH,kDA0CX,EAAKA,SAAL,MA1CW,kEClJN,YAACjlB,GAAiC,IACvCmM,EAAcnM,EAAdmM,IAAKC,EAASpM,EAAToM,KADkC,EAElBD,EAAI,mBAAzBle,EAFuC,EAEvCA,MAAO6C,EAFgC,EAEhCA,UAEagyF,EAAoB12E,EAAK2yE,IAA7C3B,mBAGF2F,EAAoB90F,EACvBnJ,MAAM,oBAAqB,CAC1BoO,KAAMjF,EAAMye,QAAQ,eACpBgvE,aAAc,KAEf/zE,OAAM,SAAAtY,GAAI,MAAK,CAEd,gBACE,IAAI+tB,EAAI/tB,EAAKqsF,aACb,OAAKt+D,GAKLA,EAAIA,EAAEtJ,cACC,SACLkvE,EACA7pB,GAGA,IAFA,IACQ+mB,EAAqB/mB,EAArB+mB,iBAEFrF,EAAe,EACnBA,EAAeqF,EAAiBj4F,OAChC4yF,GAAgB,EAChB,CACA,IAAMN,EAAO2F,EAAiBrF,GAE9B,GAAIN,EAAK9vE,MAAQ8vE,EAAK9vE,KAAKqJ,cAAcF,SAASwJ,GAChD,OAAO,EAGX,OAAO,IArBA,WACL,OAAO,QAwBdhuB,SAAQ,SAAAC,GAAI,MAAK,CAChBusF,UADgB,SACNx+D,GACR/tB,EAAKqsF,aAAet+D,GAEtBkR,MAJgB,WAKdj/B,EAAKqsF,aAAe,QAI1B,OAAOztF,EACJnJ,MAAM,4BAA6B,CAClCm+F,YAAah1F,EAAMC,SACjB60F,GACA,iBACG,CACC7vF,KAAM,cACNwoF,aAAc,OAGpBwH,cAAej1F,EAAM6oB,MAAMgsE,KAE5Bn7E,OAAM,SAAAtY,GAAI,MAAK,CACd,cACE,MAAO,CAACA,EAAK4zF,aAAN,mBAAsB5zF,EAAK6zF,gBAAe1vE,QAAO,SAAA9nB,GAAC,QAAMA,MAEjEy3F,qBAJc,SAIOzH,GAEnBrsF,EAAK4zF,YAAc,CACjB/vF,KAAM,cACNwoF,iBAGJkD,iBAXc,SAWG3D,EAAgB9hB,GAC/B,IAAK,IAAIz9C,EAAI,EAAGA,EAAIhzB,KAAKstC,QAAQ/tC,OAAQyzB,GAAK,EAC5C,IAAKhzB,KAAKstC,QAAQta,GAAGy/D,UAAUF,EAAO9hB,GACpC,OAAO,EAGX,OAAO,OAGV/pE,SAAQ,SAAAC,GAAI,MAAK,CAChB+zF,qBADgB,SACKvI,GAAsB,IACjCsE,EAAaruF,EAAUzB,GAAMirF,YAAYyD,QAAQlD,GAAjDsE,SACR9vF,EAAK6zF,cAAct7F,KAAK,CACtBsL,KAAMisF,EAASjsF,KACf2nF,kBAGJwI,mBARgB,SAQG7vE,GACjB,OAAOnkB,EAAK6zF,cAAcjzD,OAAOzc,IAEnC8vE,gBAXgB,WAYdj0F,EAAK6zF,cAAc50D,QACnBj/B,EAAK4zF,YAAY30D,cC/EnBi1D,GAAsD,CAC1D,CACE3tE,MAAO,gBACP1W,KAAMskF,KACN3jF,QAHF,SAII4jF,EACAnJ,GACA,MACMoJ,EAAS,UAAGpJ,EAAYuF,uBAAf,aAAG,EAA6B6D,eAC7B56F,IAAd46F,GACFpJ,EAAYgF,OAAO1R,KAAK8V,EAAY,GAAG/F,kBA+IhCgG,GAzIe,SAAC3jF,GAAiC,IACtDmM,EAAcnM,EAAdmM,IAAKC,EAASpM,EAAToM,KACLsL,EAASvL,EAATuL,KAFsD,EAGzBvL,EAAI,mBAAjCle,EAHsD,EAGtDA,MAAO6C,EAH+C,EAG/CA,UAAWuO,EAHoC,EAGpCA,OAClBkhD,EAAkBp0C,EAAI,8CAAtBo0C,cAEFqjC,EAAmBx3E,EAAKy3E,IACxBC,EAAoB13E,EAAK23E,IACzBC,EAAsB53E,EAAKktD,IAI3Bx0E,EAAQmJ,EACXnJ,MAAM,kBAAmB,CACxBoO,KAAMjF,EAAMye,QAAQ,mBACpBrnB,SAAU,EACV8D,OAAQ8E,EAAMC,SACZD,EAAM84B,WACJ,wBACA94B,EAAMW,QACN,SAAAo4B,GAAC,OAAIA,GAVK,MACI,KAclBi9D,kBAAkB,EAClBC,0BAA0B,EAC1BC,oBAAoB,EAEpBpqB,eAAgB9rE,EAAMC,SAAS81F,GAAqB,kBAClDA,EAAoBnoE,OAAO,OAI7B4W,KAAMxkC,EAAMC,SACVD,EAAMwiB,YAAY,sBAAuB,CAAC,SAAU,YACpD,UAEF2zE,aAAcn2F,EAAMC,SAAS41F,GAAmB,kBAC9CA,EAAkBjoE,YAEpBy+D,YAAarsF,EAAM+B,MAAM4zF,KAE1Bv/D,UAAS,iBAAO,CACfn/B,MAAO,IACPm/F,aAAc3sE,EAAK+vB,WAAW87C,QAE/B57E,OAAM,SAAAtY,GAAI,MAAK,CACd,qBACE,QAASA,EAAKirF,aAAejrF,EAAKirF,YAAYiE,UAGhD,uBACE,QAASl/E,EAAOhQ,GAAM0wF,kBAGxB,iBACE,GAAI1wF,EAAKirF,aAAejrF,EAAKirF,YAAYgF,OAAOf,SAAU,CACxD,IAAMn/E,EAAW/P,EAAKirF,YAAYgF,OAAOZ,qBACzC,OAAIt/E,EAASnX,OACJmX,EAEF/P,EAAKirF,YAAYgF,OAAOd,qBAKnC,eACE,GAAInvF,EAAKirF,aAAejrF,EAAKirF,YAAYh0F,aAAc,CAErD,IACMo9D,GADa92C,qBAAWvd,GAAM2wC,YACJ,IAAIzgB,MAClC,SAAAugE,GAAG,aACD3zF,yBAAe2zF,EAAK,WAApB,UAAgCzwF,EAAKirF,mBAArC,aAAgC,EAAkBh0F,iBAEtD,GAAIo9D,EACF,OAAOA,QAMdt0D,SAAQ,SAAAC,GAAI,MAAK,CAChBi1F,gBADgB,SACAC,GACdl1F,EAAKg1F,aAAaxmC,QAAQ0mC,IAE5BjiF,SAJgB,SAIP+/C,GAEP,OADAhzD,EAAKnK,MAAQm9D,EACNhzD,EAAKnK,OAEdokC,UARgB,SAQNuoC,GAMR,OAJExiE,EAAKlG,OADH0oE,EAjFQ,GAkFIA,EAlFJ,GAsFLxiE,EAAKlG,QAEdogC,aAhBgB,SAgBH7sB,GACX,IAAM8sB,EAAYn6B,EAAKlG,OAEvB,OADkBT,KAAK4gC,UAAUj6B,EAAKlG,OAASuT,GAC5B8sB,GAErBg7D,YArBgB,SAqBJ9nF,GACV,IAAM+nF,EAAWp1F,EAAKnK,MAEtB,OADiBwD,KAAK4Z,SAASjT,EAAKnK,MAAQwX,GAC1B+nF,GAIpB5B,mBA5BgB,SA4BGvI,GACjBjrF,EAAK0qE,eAAeupB,kBAEpBj0F,EAAKirF,YAAcA,EACnBjrF,EAAKojC,KAAO,WAGdiyD,cAnCgB,WAoCdr1F,EAAKojC,KAAO,UAGdvG,eAvCgB,WAwCV78B,EAAK0yF,iBACP1yF,EAAKojC,KAAO,YAIhB8vB,UA7CgB,WA8CdzxD,EAAUzB,EAAM,GAAGizD,WAAWjzD,QAMpC,OAFmBpB,EAAMuB,QAAQ+wD,EAAez7D,ICjK7B6/F,G,4MACnB73F,KAAO,wB,6CAEP,SAAQkT,GACNA,EAAcgtB,aAAY,WACxB,OAAO,IAAI3S,IAAS,CAClBvtB,KAAM,kBACN8e,WAAY0E,GAAkBtQ,GAC9BD,eAAgBkS,gBACd,kBAAM,0C,uBAMd,SAAUjS,GACJktB,gCAAsBltB,EAAc8S,YACtC9S,EAAc8S,UAAUqa,gBAAgB,CAAC,OAAQ,OAAQ,CACvDvX,MAAO,mBACP1W,KAAM0lF,KACN/kF,QAAS,SAAC/B,GACRA,EAAQuvB,QAAQ,kBAAmB,W,GArBMnb,K,gCCqKnD,GA3K8B,SAAAlS,GAAiB,IACrCoL,EAAcpL,EADuB,YAEboL,EAFa,cAErChe,EAFqC,WAGvC4U,GAHuC,YAG/BoJ,EAAd,UACMjH,EAAaiH,EAAnB,gCACQjQ,EAAeiQ,EALsB,uCAMvCy5E,EAAOz5E,EAAb,0BACM05E,EAAmB15E,EAAzB,sCACM25E,EAAW35E,EAAjB,8BACQ1P,EAAiB0P,EAToB,iCAUrCs6D,EAASt6D,EAV4B,iCAcvCvQ,EAAQ,CACZ3V,MADY,EAEZ2T,WAFY,OAGZuoB,UAHY,aAIZ64C,UAAW,qBAEP/+D,EAAYC,GAAW,SAAAnB,GAC3B,MAAO,CACLrB,KAAM,CACJsd,aAAcjc,UADV,GAEJnB,WAFI,QAGJ0L,SAAU,UAEZ/X,OAAQ,CACN+X,SADM,SAEN/C,WAFM,SAGN4f,UAHM,aAINj4B,OAnBN,GAoBM0P,WAAY6sE,EALN,MAQRsf,aAAc,CACZ/tF,OAAQ,GAEVguF,eAAgB,CACd5kF,QAAS,QAEX6kF,yBAA0B,CACxBC,YAAa,CAAC,CAAC,MAAO,QAASzf,EADP,OAExBnhE,SAAU,UAEZ6gF,oBAAqB,CACnBrgG,QAASiV,UADU,GAEnBnB,WAAY6sE,EAAK,UAKjB2f,EAAej4F,GAAS,YAAe,IAAZtI,EAAY,EAAZA,MAEzBuX,EAAUnB,IAChB,OACE,mBACES,UAAWU,EADb,aAEE8qD,WAFF,EAGEvtD,QAHF,EAIEu6E,UAJF,MAKE9/D,WAAW,UAEX,mBAAMixE,MAAI,GACR,mBACEzlF,QAAS,kBAAM/a,EAAN,iBACT6W,UAAWU,EAFb,WAGE+J,MAHF,sBAIEnH,cAJF,yBAKEzG,MAAM,aAEN,qBAhBR,YAuBI+sF,EAAsBn4F,GAAS,YAAqB,IAAlBo4F,EAAkB,EAAlBA,YAEhCnpF,EAAUnB,IAEhB,OACE,mBACEisD,WADF,EAEExrD,UAAWU,EAFb,oBAGExB,MAAO,CAAE1R,OAAQq8F,EAAYC,+BAE7B,mBAAMH,MAAI,GACR,mBACElsB,QACE,mBACEz9D,UAAWU,EADb,YAEEkwB,QAASi5D,EAFX,yCAGE3lF,QAAS,SAAAuP,GAAG,OACVo2E,8CACEp2E,SAFQ,YAOhBwG,MAAM,qCAmEhB,OAAOxoB,GA5DP,YAAoC,IAATtI,EAAS,EAATA,MACnBuX,EAAUnB,IAGdquB,EAKEzkC,EAT8B,aAKhCyzE,EAIEzzE,EAT8B,iBAMhC4gG,EAGE5gG,EAT8B,8BAOhC6gG,EAEE7gG,EAT8B,2BAQhC8gG,EACE9gG,EAT8B,iBAWlC,OACE,uBAAK6W,UAAWU,EAAhB,KAA8B4C,cAAana,EAAMkE,IAC/C,mBAAMm+D,WAAN,EAAgBgtB,UAAhB,MAAgCx4E,UAAWU,EAAQ7P,QACjD,mBAAM84F,MAAI,GACR,mBAAcxgG,MAAOA,MAGzB,uBAAK6W,UAAWU,EAAQ4oF,gBACtB,uBAAKtpF,UAAWU,EAAQ6oF,0BACtB,mBAA+BpgG,MAAOA,EAAM+gG,mBAG7CD,EACC,gCACE,mBACEhqF,OAAQ,SAAAc,GACN,IAAMopF,EAAOhhG,4BAAb,GAEA,OADaA,+BAAb,IAGF+W,UANF,EAOEC,SAPF,EAQEjB,MAAOA,IAET,uBACEc,UAAWU,EADb,sBAEExB,MAAO,CAAE3V,MAAOJ,eAAmBI,QAEnC,mBAAqBsgG,YAAa1gG,IAClC,mBAA4BA,MAAOA,EAAMihG,iBA5BnD,MAiCE,mBACEnqF,OADF,EAEEf,MAAO,CACL1R,OADK,EAEL0P,WAFK,OAGLuoB,UAHK,aAIL64C,UAAW,4B,qBC/JR,eAAmB,IACxBsf,GAAmBnuE,EADK,EAAhBA,WAAgB,qCAGhC,wBASE,IAAM46E,EAAN,GAaA,OAZAjI,WAAgB,cACd,IAAIkI,WAAJ,IADwC,IAIlCx7E,EAAS0uD,QAJyB,QAKxC,WAAI6kB,kBACFvzE,EAAOk7B,WAAPl7B,IAEFu7E,EAAUhI,EAAVgI,YAIF,kCAEEx4D,SAAU,sBAAF,OAFV,GAGEjnC,QAAS2/F,EAHX,QAIEz/F,MAAOy/F,EAJT,MAKEv/F,IAAKu/F,EALP,IAMEz3E,KAAM,CACJloB,QAAS4/F,EADL,QAEJ1/F,MAAO0/F,EAFH,MAGJx/F,IAAKw/F,EAAKx/F,OAKhB,sBAQE,IAAMu/F,EAAO3M,EACXpgB,QAAUitB,EAAVjtB,IADyB,KAA3B,GAIMgtB,EAAO5M,EACXpgB,QAAUitB,EAAVjtB,IADyB,KAA3B,GAUA,OAAOktB,EAAiB,EALc,CACpCD,EADoC,GAEpCA,EAFF,IAKuB,MAAvB,GAUF,wBAQE,IAAME,EAAS,SAAAC,GAAK,OAAIptB,WAAJ,MACd+sB,EAAO,CACX3/F,QAAS+/F,EAAOE,EADL,IAEX//F,MAAO6nB,SAASg4E,EAAOG,EAAR,IAARn4E,IAFI,EAGX3nB,IAAK2nB,SAASg4E,EAAOI,EAAR,SAETP,EAAO,CACX5/F,QAAS+/F,EAAOE,EADL,IAEX//F,MAAO6nB,SAASg4E,EAAOG,EAAR,IAARn4E,IAFI,EAGX3nB,IAAK2nB,SAASg4E,EAAOI,EAAR,SAUf,OAAOL,EAAiB,EARc,CACpCG,EADoC,GAEpCC,EAFoC,GAGpCC,EAHoC,GAIpCF,EAJoC,GAKpCC,EALoC,GAMpCC,EANF,IAQuB,MAAvB,GAsDF,MAAO,CACLC,mBA3CF,kBAAmE,IACzD5I,EAAgC9C,EADyB,QAChDsE,EAAuBtE,EADyB,mBAE3D2L,EAAN,GACArH,WAA2B,SAAA1E,GACzB,IAAMgM,EAAmB9I,EAAzB,GACK6I,EAAYC,WAAjB,QACED,EAAYC,WAAZD,UAEFA,EAAYC,WAAZD,iBAEF,IAAMR,EAAwBQ,aAA9B,GACMH,EAAwBG,YAA9B,GACMF,EAAsBE,UAA5B,GACMJ,EAAsBI,UAbqC,GAgBjE,OAAIR,UAAJ,EACSU,EAAmC,EAAD,MAAzC,GASAN,aACAC,UADAD,GAEAE,UAHF,EAKSK,EAAyC,EAAD,QAA/C,QALF,GAmBAD,mCAFK,EAGLC,6CC1JW,YAAA/mF,GAAiB,IACtBoL,EAAcpL,EADQ,UAEtB4M,EAAexB,EAFO,iCAItBu7E,EAAuBv7E,EAJD,uBAM9B,oBAME,GAAI+tD,EAAJ,aAAsB,CACpB,GAAIA,eAAJ,WACE,OAAOA,eAAP,WAEF,GAAIA,eAAJ,QACE,OAAOA,eAAP,QAGJ,IAAM6tB,EAAeL,EACnBd,EADqC,gBAIrC/nF,kBAJF,gBAMA,KACE,SAKJ,sBAOE,IAAMA,EAAU8O,EAAhB,GACMU,EAAc25E,EAA2B,EAAD,IAA9C,GAMA,KAAiB,CACf,IAAM78E,EAAU,IAAI,EAAJ,EAAhB,GACAtM,kBACA,IAAMiK,EAAW/H,cAAjB,uBACQ+lF,EAAiBmB,EAJV,aASf,OAJqBn/E,gCAArB,IAuDJ,MAAO,CACLk/E,2BADK,EAELE,wCAFK,EAGLC,uCAxBF,oBAOE,IACE,IAAM7zB,EAAe4zB,EAAwC,EAAD,MAA5D,GAOA,OAAOhnF,QAAP,GACA,MAAOuf,GACP,WAQF2nE,oCAlDF,oBAOE,IAAM9zB,EAAe4zB,EAAwC,EAAD,MAA5D,GAOA,KAAkB,KAERpB,EAAiBmB,EAFT,aAGhB3zB,qBAAkCwyB,UAAlCxyB,IACAA,qBAAkCwyB,UAAlCxyB,IAEgB3mD,EAAhB,GACA9O,qCCjFN,SAASwpF,GAAoBl9E,EAASm9E,EAAYvnF,GAAe,OAGrBoL,EAFpBpL,EADyC,iCAGvDuL,EAHuD,oBAMzDzN,GAAU8O,EAN+C,cAM/D,GACA9O,kBACA,IAAM2H,EAAO8F,EAAb,GAEMgoD,EADWvzD,cAAjB,uBACqB+H,8BAV0C,GAkC/DwrD,qBAAkC9tD,UAAlC8tD,IACAA,qBAAkC9tD,UAAlC8tD,IACAA,cAA2BnpD,EAA3BmpD,KAEAz1D,mCAGF,IA0VA,GA1VyB,SAAAkC,GAAiB,IAChCoL,EAAcpL,EADkB,YAEVA,MAFU,KAEhCgpB,EAFgC,UAEvBwwC,EAFuB,aAGex5D,MAHf,mBAGhC/R,EAHgC,QAGzB6C,EAHyB,YAGdu4B,EAHc,cAGD3W,EAHC,cAMhC6tC,EAAkBn1C,EANc,4DAShCwB,EAAexB,EATiB,iCAUhCjf,EAAmBif,EAVa,8CAYlCo8E,EAAsBxnF,cAA5B,mBACMynF,EAAmBznF,cAAzB,gBAbwC,EAwBpCoL,EAxBoC,IAqBtCg8E,EArBsC,yCAsBtCC,EAtBsC,sCAuBtCJ,EAvBsC,6BA0BlCniG,EAAQmJ,EAAA,wBACc,CACxBiF,KAAMjF,UADkB,mBAExBsqE,iBAFwB,EAGxBpvE,OAAQ8E,EAAA,SACNA,EAAA,mCAEEA,EAFF,QAGE,SAAA+4B,GAAC,OAAIA,GAnBb,OACA,KAuBI0gE,0CAZwB,EAgBxBj1D,KAAMxkC,WACJA,oCAAyC,CAAC,SADtCA,YAhBkB,UAqBxB43F,gBAAiB53F,EAAA,SAAeu5F,EAAf,YAA+C,kBAC9DA,EAAA,kBAAsC,CACpCt0F,KADoC,kBAEpC+wF,kBAFoC,EAGpCC,0BAA0B,OAI9B6B,aAAc93F,EAAA,SAAew5F,EAAf,YAA4C,kBACxDA,EAAA,kBAAmC,CACjCv0F,KADiC,eAEjCgxF,0BAFiC,EAGjCyD,yBAHiC,EAIjCC,mBAAmB,SAnCb,UAuCF,iBAAO,CACf1iG,MAAO,QAxCG,OA0CL,SAAAmK,GAAI,MAAK,CACd,mBACE,OAAOA,yBAAP,cAGF,mBAAmB,IACTq0D,EAAar0D,EADJ,yBAEjB,KACE,OAAOlD,EAAeu3D,EAAtB,SAKJ,uBACE,kBAAOr0D,wBAGT,oCACE,IAAMyO,EAAU8O,EAAhB,GACA,MAAO,CACL1Z,KADK,oBAELqc,UAAWlgB,8BAAD,SACH,qBACH43F,EAA2B,EAEzB53F,EAFwB,kBADvB,MADG,QASA,SAAA3D,GAAC,OAAIyU,QAAJ,QAKf,wBAOE,OAHgB,IAAI0nF,EADhB7nF,iBAHkB,mCAKpB3Q,EADF,+BAGA,eAGF,yCAoBE,OAnBA2Q,6CAIsB,CACpB9M,KADoB,eAEpBmC,QAAS,8BAAF,OAAgChG,EAFnB,IAGpBvC,KAHoB,6BAIpBkkC,QAAS3hC,EAJW,8BAKpBkX,cAAe,CAAClX,EALI,cAMpBw/B,SAAU,CACR,CACE37B,KADF,sBAEEu8B,UAAW,4CAAF,OAA8CpgC,EAFzD,IAGE6c,aAHF,0DAIET,SAAU,CAAEvY,KAAM,0CAvGhB,UA8GF,iBAAO,CACfwyF,8BAA+B8B,EADhB,eAEf7B,2BAA4B8B,EAFb,eAGfhC,6BAzHJ,OAQc,SAmHH,SAAAp2F,GAAI,MAAK,CAChBk1B,YADgB,WAGd8E,EAAY,EAEVL,GACE,WAEE,GAAI35B,EAAJ,iBAA2B,CACzB,IAAMy4F,EAAmBhiG,WAAzB,IAAoCuJ,SAC9B04F,EAAoB14F,QAA1B,EACAA,2BAA8By4F,EAJhC,GAKEz4F,gCAEAA,2BAA8BA,EAA9BA,SAGJ,CAAEvC,KAAM,mCAIZu8B,EAAY,EAEVL,GACE,WACE35B,4BAA+BA,SArJ3C,IAsJYA,yBACEA,SAvJd,GACA,MAyJU,CAAEvC,KAAM,oCAKZu8B,EAAY,EAEVL,GACE,WAAM,IAEF1iC,EAIE+I,EANA,aAGFq4F,EAGEr4F,EANA,yCAIF02F,EAEE12F,EANA,aAKF24F,EACE34F,EANA,kBAOI4+B,EAAW83D,EAPf,OAQEjoF,EAAU8O,EAAhB,GACA,KAAkB,CAChB,IAAM82C,EAAW5lD,sBAAjB,GACA,KAAc,KACGmqF,EAAoBvkC,EADvB,QAOZ,GAFEukC,EAHF,EAGoBv1E,EAAlBu1E,GAFAA,GAIF,GACE,OAAIh6D,SAAqB,KAErBw2B,EACE3mD,sBAHmB,uBAKvBkqF,QACQ,SAAAE,GAEJ,IAAMC,EAA2B,IAAI38F,IACnC08F,EAAA,KACE,SAAA3hG,GAAO,OACLk+D,MADK,MAILn/D,EAAmB2iG,EAAA,QAAuB,SAAAj3E,GAAC,OAC/Cm3E,MAA6Bn3E,EADkB,YAGjD+0E,sBACEjgE,WAAWA,eADbigE,QAZJiC,OAgBS,SAAAtoE,GAAC,OAAIqmE,WAAJ,YAGZA,8BAGFA,6BAIN,CAAEj5F,KAAM,4CAKZu8B,EAAY,EAEVmwC,GACE,iBAAO,CACL4uB,mBACE/4F,GAAQA,EAFL,mCAGL/I,aAAc+I,GAAQA,EAAK/I,iBAE7B,SAAA8C,GACE,MADM,IAIE9C,EAAqC8C,EAJvC,aAIgBg/F,EAAuBh/F,EAJvC,mBAMFiG,sBAAJ,QACEA,+BAAiC,SAAAoB,GAC/BpB,yBAA4BoB,gBAA5BpB,YAKA/I,GAAJ,GACE+I,8BAAmD,CACjD/I,oBAIN,CACEwG,KADF,8CAEEg4B,iBAAiB,KAMvBuE,EAAY,EAEVL,GAAQ,WACN35B,kCAGE,CACE,CACEumB,MADF,yBAEE1W,KAFF,KAGEgW,SAHF,kBAII,OAAQkyE,EAAuC,EAAD,MAA9C,IAQFvnF,QAZF,kBAaIwnF,EAAoC,EAAD,MAAnCA,YAcd/kF,SAlKgB,YAmKdjT,WAEFi6B,UArKgB,YA2Kd,OAJEj6B,SADEwiE,EApSV,IAqSQxiE,EArSR,IAySaA,EAAP,QAEFk6B,aA7KgB,YA8Kd,IAAMC,EAAYn6B,EAAlB,OAEA,OADkBA,YAAeA,SAAjC,GACA,GAGFq1F,cAnLgB,WAoLdr1F,mCAGF68B,eAvLgB,WAwLd78B,oCAGFkzD,UA3LgB,WA4LdzxD,EAAUzB,EAAVyB,kBAGF0gE,oBA/LgB,YAgMdniE,uCAGFg5F,4CAnMgB,YAoMdh5F,2CAAgD8Q,QAAhD9Q,QAMN,MAAO,CAAEuc,WAFU3d,YAAnB,KCrXF,GATyB,SAAC,GAAkB,IAAhBmd,EAAgB,EAAhBA,UACpBiP,EAAWjP,EAAjB,gDAEMrL,EAAiBqL,EAAvB,IAGA,OAAO,IAAIiP,EAAS,CAAEvtB,KAAF,kBAA2B8e,WAFxBR,EAJmB,eAMiBrL,oBCAxCuoF,G,4MACnBx7F,KAAO,wB,6CAEP,SAAQkT,GACNA,EAAcgtB,aAAY,kBACxBhtB,EAAcoL,UAAUm9E,S,uBAI5B,SAAUvoF,GACJktB,iCAAsBltB,EAAc8S,YACtC9S,EAAc8S,UAAUqa,gBAAgB,CAAC,OAAQ,OAAQ,CACvDvX,MAAO,eACP1W,KAAMspF,KACN3oF,QAAS,SAAC/B,GACRA,EAAQuvB,QAAQ,kBAAmB,W,GAfMnb,KCqBpC9kB,4BAxBf,SAAsByM,GAOnB,IACO3U,EAAkB2U,EAAlB3U,MAAOiE,EAAW0Q,EAAX1Q,OACT+rD,EAAcpvD,KAAKC,KAAKb,GAE9B,OACE,yBACEyW,UAAU,kBACVd,MAAO,CAAEtQ,SAAU,WAAYrF,MAAOgwD,EAAa/rD,WAEnD,kBAAC,qBAAD,iBACM0Q,EADN,CAEEgB,MAAO,CAAEtQ,SAAU,WAAYtB,KAAM,EAAG0U,IAAK,UCtBtC0N,iCACb,cACA,CACEivC,UAAW,CACTpnD,KAAM,QACNiC,YAAa,6CACb+a,aAAc,QAEhB1X,MAAO,CACLtF,KAAM,QACNiC,YAAa,+CACb+a,aAAc,mEACdC,gBAAiB,CAAC,QAAS,WAAY,cAGzCrI,UAAW,CACT5U,KAAM,UACNiC,YAAa,mDACb+a,aAAc,MAGlB,CAAEvE,iBAAiB,IC2BA88E,G,4MACnB5lD,aAAc,E,0FAEd,WACER,EACAxoC,GAFF,6DAAAxP,EAAA,6DAIUklB,EAA+D1V,EAA/D0V,SAAUzjB,EAAqD+N,EAArD/N,OAAQvG,EAA6CsU,EAA7CtU,QAAS0H,EAAoC4M,EAApC5M,OAAQ0oC,EAA4B97B,EAA5B87B,YAAazoC,EAAe2M,EAAf3M,WAJ1D,SAKoByoC,EAAY+yD,cAAcnjG,EAAU2H,GALxD,UAKQxC,EALR,OAMQ86C,EAAI96C,GAAOnF,EAAUO,KAAK6iG,KAAK,IAC/BruC,EAAYvP,KAAM5+C,yBAAeL,EAAQ,eAC3CyjB,EAAStnB,OARf,wBASUqC,EAASilB,EAAS,GAAGq5E,KACvBvkD,EAAW,EACXwkD,EAAS,EACTC,EAAS,EAZjB,UAaUC,0BAAgB97F,GAb1B,QAcI,IAASyuB,EAAI,EAAGA,EAAInM,EAAStnB,OAAQyzB,IAAK,EACTnM,EAASmM,GAAhCktE,EADgC,EAChCA,KAAMI,EAD0B,EAC1BA,KAAMC,EADoB,EACpBA,OACpB5kD,EAAWv+C,KAAKuB,IAAI4hG,EAAQ5kD,GAC5BwkD,EAAS/iG,KAAKwB,IAAIxB,KAAKwB,IAAIshG,EAAMI,GAAOH,GACxCC,EAAShjG,KAAKuB,IAAIvB,KAAKuB,IAAIuhG,EAAMI,GAAOF,GAlB9C,iBAoBUC,0BAAgB97F,GApB1B,QAqBIo1C,EAAI6mD,QAAQpjG,KAAKqjG,GAAK,GAClB1iG,EAAQuL,KAAKC,MACRypB,EAAI,EAvBjB,aAuBoBA,EAAInM,EAAStnB,QAvBjC,sBAwBqCsnB,EAASmM,GAAhCktE,EAxBd,EAwBcA,KAAMI,EAxBpB,EAwBoBA,KAAMC,EAxB1B,EAwB0BA,OACpB5mD,EAAIz5B,UAAYzc,yBAAeL,EAAQ,QAAS,CAC9CgwC,MAAOmtD,EACP5kD,WACAiW,cAEFjY,EAAIoD,UAAUmjD,EAAOt+F,GAAUk7C,GAAIwjD,EAAO1+F,GAAUk7C,EAAGA,EAAGA,MACrDxzC,KAAKC,MAAQxL,EAAQ,KA/BhC,kCAgCcsiG,0BAAgB97F,GAhC9B,QAiCQxG,GAASuL,KAAKC,MAjCtB,QAuByCypB,IAvBzC,4D,oHAuCA,WAAanqB,GAAb,wCAAAlH,EAAA,6DACUyB,EAA6ByF,EAA7BzF,OAAQ4jB,EAAqBne,EAArBme,QAASnqB,EAAYgM,EAAZhM,QAD3B,cAEmBmqB,EAFnB,GAEStpB,EAFT,KAGQlB,GAASkB,EAAOO,IAAMP,EAAOK,OAASlB,EACtC4D,EAASgD,yBAAeL,EAAQ,aAJxC,SAKyBpD,KAAK2zB,YAAY9qB,GAL1C,cAKQge,EALR,gBAOoBsyB,GAChB38C,EACAiE,EACAoI,GACA,SAAC8wC,GACC,OAAO,EAAKya,cAAcza,EAAnB,2BACF9wC,GADE,IAELge,iBAdR,cAOQ7kB,EAPR,wHAmBO6G,GACA7G,GApBP,IAqBI6kB,WACAnpB,OAAQmL,EAAYme,QAAQ,GAC5BvmB,SACAjE,WAxBJ,eAkBQ69C,EAlBR,gEA4BOA,GACAr4C,GA7BP,IA8BIvB,SACAjE,WA/BJ,iD,uHAmCA,WAAkB4jB,GAAlB,mBAAAze,EAAA,6DACUsrC,EAAyB7sB,EAAzB6sB,YAAajmB,EAAY5G,EAAZ4G,QADvB,SAEyBimB,EACpBtZ,YAAY3M,EAAQ,GAAI5G,GACxBvb,KAAKspC,eACLC,YALL,cAEQvnB,EAFR,yBAUSA,GAVT,2C,4DA7EuCgL,KChC1B6uE,GAbe,SAACppF,GAC7B,IAAMqpF,EAA0BrpF,EAAc0uB,gBAAgB,eAC3DljB,aAEH,OAAOH,8BACL,mBACA,CAAEI,SAAU49E,GACZ,CAAE39E,kBAAmBgV,KAA+B/U,iBAAiB,KCN1D,YAACH,GAAD,OACbvd,QACGuB,QACC,mBACAwyB,KACA/zB,QAAMnJ,MAAM,CACVoO,KAAMjF,QAAMye,QAAQ,oBACpB/b,cAAe2a,iCAAuBE,GACtCte,WAAYe,QAAMC,SAASD,QAAMW,OAAQ,MAG5C+Y,OAAM,SAAAtY,GAAI,MAAK,CACd,gBACE,MAAO,iBAET,uBACE,MAAO,eAOT,kBACE,IAAMvD,EAASuD,EAAKq2B,aAAala,aAAaqQ,OAC5C3O,kBAAQ7d,EAAM,aAAe,GAC7BgQ,iBAAOhQ,IAGT,8CACKA,EAAKu7B,qBACLv5B,+BAAqBhC,IAF1B,IAGEvD,SACA+f,cAAexc,EAAKwc,cACpBC,aAAczc,EACdnC,WAAYmC,EAAKnC,kBAItBkC,SAAQ,SAAAC,GAAI,MAAK,CAChB04C,cADgB,SACF/gB,GACZ33B,EAAKnC,WAAa85B,OAGrBrf,OAAM,SAAAtY,GAAQ,IACL+8B,EAAmB/8B,EAAnB+8B,eACR,MAAO,CACL,6BACE,MAAO,CACL,CACExW,MAAO,aACP4W,QAAS,CACP,CACE5W,MAAO,mBACP/V,QAAS,WACPxQ,EAAK04C,cAAgC,EAAlB14C,EAAKnC,cAG5B,CACE0oB,MAAO,qBACP/V,QAAS,WACPxQ,EAAK04C,cAAc14C,EAAKnC,WAAa,SAQjD,qBACE,4BAAWk/B,GAAX,YAA8B1jC,KAAK2gD,+BC1E9Bh+B,iCACb,aACA,CACEnX,YAAa,CACXhB,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,qBAGzB,CAAE6b,iBAAiB,ICYA29E,G,4MACnBx8F,KAAO,Y,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,aACN0e,aAAc+9E,GACdz4E,gBAAiB,kBACf,uDAAkCC,MAAK,SAAAC,GAAC,OAAIA,EAAEvT,iBAGtDuC,EAAciR,iBACZ,kBACE,IAAIw3E,GAAY,CACd37F,KAAM,cACNiT,eAAgBypF,GAChBh+E,aAAci+E,GACdzpF,qBAGNA,EAAcmR,cAAa,WACzB,IAAM3F,EAAeH,8BACnB,WACA,GACA,CACEK,kBAAmB0F,iCAAsBpR,GACzC8gB,mBAAoB,YAGxB,OAAO,IAAIzP,IAAU,CACnBvkB,KAAM,WACN0e,eACAI,WAAY0F,gCACVtR,EACA,WACAwL,QAINxL,EAAcuR,gBAAe,WAC3B,IAAM/F,EAAek+E,GAAoC1pF,GACzD,OAAO,IAAIqM,IAAY,CACrBvf,KAAM,mBACN0e,eACAI,WAAY+9E,GAA6Bn+E,GACzCe,UAAW,WACXxE,SAAU,mBACVhI,eAAgB4R,Y,uBAKtB,SAAU3R,GACRA,EAAcw9B,KAAKosD,aAAa,SAAS,SAACpxF,EAAc7M,GAAf,OACvC6M,EAAMogD,MAAMjtD,MAEdqU,EAAcw9B,KAAKosD,aAAa,OAAO,SAACpxF,GAAD,OAAkBA,EAAMqgD,SAC/D74C,EAAcw9B,KAAKosD,aAAa,eAAe,SAACpxF,GAAD,OAC7CA,EAAM9J,gB,GA5D2BwjB,KC4BvC,GA1BoB,CAAC,GAAD,uEAApB,I,wJCQMhX,GAAYC,cAAW,SAAAnB,GAAK,MAAK,CACrC6vF,SAAU,CACR7oE,UADQ,SAERvnB,YAAa,OAEfqwF,YAAa,CACX,UAAW,CACTpxF,gBAAiByF,gBACfnE,kBADmB,aAEnBA,iBAHO,cAKT,uBAAwB,CACtBtB,gBAAiB,iBAIvBqxF,eAAgB,CACdhlG,QAASiV,cAEXyrE,YAAa,CACXl7E,SADW,WAEXrB,MAAO8Q,UAFI,GAGX2D,IAAK3D,UAHM,GAIXxB,MAAOwB,yBAILgwF,GAAN,mBAEA,SAASC,GAAepwF,GAKtB,IAAMwC,EAAUnB,KACRmG,EAAkCxH,EAFzC,QAEgBqG,EAAyBrG,EAFzC,KAEsBqwF,EAAmBrwF,EAFzC,iBAG6BmC,mBAH7B,sBAGMmuF,EAHN,KAGeC,EAHf,OAI2CpuF,oBAJ3C,sBAIMquF,EAJN,KAIsBC,EAJtB,KAMKzpF,EAAc,WAClBi/B,2BACAz+B,MAGF,OACE,oCACE,wBAAQA,QAAR,EAA8BnB,KAAMA,GAClC,wDAEGW,EACC,wBAAYlF,UAAWU,EAAvB,YAA4CwD,QAASgB,GACnD,uBAFQ,OAHhB,MASE,4BACE,mGAEE,wBAAYhB,QAAS,kBAAMyqF,GAAN,KACnB,uBAJN,QAOE,wBAAavnF,UAAU,YACrB,wBACEpX,MADF,EAEE6T,SAAU,SAAAhD,GACR,IAAMiK,EAAMjK,SAAZ,MACA4tF,OAGF,wBACEz+F,MADF,QAEEytE,QAAS,uBAFX,MAGExjD,MAAM,cAER,wBACEjqB,MADF,OAEEytE,QAAS,uBAFX,MAGExjD,MAAM,iBAMhB,sBACE1V,KADF,EAEEmB,QAAS,WACPipF,UAMV,SAASC,GAAW1wF,GAClB,IAAMwC,EAAUnB,KACRmG,EAAkBxH,EAFqC,QAE9CqG,EAASrG,EAFqC,KAIzDgH,EAAc,WAClBQ,KAGF,OACE,wBAAQA,QAAR,EAA8BnB,KAAMA,GAClC,wBAAalX,GAAG,uBAAhB,0BAEGqY,EACC,wBAAY1F,UAAWU,EAAvB,YAA4CwD,QAASgB,GACnD,uBAFI,OAHZ,MASE,4BACE,4BADF,qaAUE,4BAVF,uUAkBE,4BA5BN,wDAoCF,IAAM2pF,GAAcp9F,qBAClB,YAMO,IALLyT,EAKI,EALJA,YACA/C,EAII,EAJJA,QAKMzB,EAAUnB,KADZ,EAE4Bc,mBAF5B,uBAEGyuF,EAFH,KAEaC,EAFb,OAG0B1uF,oBAH1B,sBAGGmnB,EAHH,KAGY4B,EAHZ,OAIsB/oB,qBAJtB,mBAIGiP,EAJH,KAIUga,EAJV,OAKgDjpB,oBALhD,sBAKG2uF,EALH,KAKuBC,EALvB,KAOEv1E,EAAMvX,EAAZ,SACMosF,EACJpqD,0BADF,QAEM1vC,EAAOsiB,sBAAb,GAEApW,qBAAU,WACR,IAAIuuF,GAAJ,EA0BA,OAzBC,sBAAC,gCAAAxgG,EAAA,mEACI6/F,EADJ,iCAGInlE,MACM+lE,EAAc,IAAIxqE,IAAIn7B,gBAJhC,eAKyB4lG,GAAqB,EAAD,EAGvCD,EARN,aAKUhgG,EALV,OAUI,IACEi6B,OACM2kB,EAAS,IAAIshD,gBAAgBF,EAFrB,SAGdphD,8BAA+B5+C,OAA/B4+C,YACAA,iBAAuB5+C,EAAvB4+C,UACAohD,SAAqBphD,EAArBohD,WACAJ,EAAYI,EAAZJ,OAhBN,kDAmBI3lE,MACAE,EAAS,EAATA,IApBJ,yDAAD,GAyBM,WACL4lE,QAED,CAACX,EAAe,EA1Cf,IA6CJ,IAAM3oD,EAAI,UAAMC,uBAAa1b,eAAepT,sBAA5C,MACMu4E,EAAU,IAAI3qE,IAAIn7B,gBAAxB,MACM+lG,EAAa,IAAIF,gBAAgBC,EAAvC,QAGA,OAFAC,sCACAD,SAAiBC,EAAjBD,WAEE,oCACE,wBACEE,SADF,KAEEjrF,MAFF,EAGEmB,QAHF,EAIEpC,cAAY,gBAEZ,qDAEG4B,EACC,wBAAYlF,UAAWU,EAAvB,YAA4CwD,QAASgB,GACnD,uBAFQ,OARhB,MAcE,uBAdF,MAgBE,oCACE,4BACE,wFAEE,wBAAYhB,QAAS,kBAAM+qF,GAAN,KACnB,uBALR,SAUE,4BACG,UAAAV,EACCj/E,EACE,wBAAYzS,MAAM,SAAlB,UADG,IAED2qB,EACF,4BADS,2BAGT,wBACEvN,MADF,MAEEjqB,MAFF,EAGEurB,WAAY,CACVk0E,UAAU,GAEZloF,WAAY,CAAE,cAAe,kBAC7Bpb,QAPF,SAQE+S,MAAO,CAAE3V,MAAO,QAChB2a,QAAS,SAAArD,GACQA,EAAf,OACA4G,UAEFnE,cAAY,oBAIhB,wBACE2W,MADF,MAEEjqB,MAAOs/F,EAFT,WAGE/zE,WAAY,CACVk0E,UAAU,GAEZtjG,QANF,SAOE+S,MAAO,CAAE3V,MAAO,QAChB2a,QAAS,SAAArD,GACQA,EAAf,OACA4G,cAMV,4BACE,wBACEvD,QAAS,WACPhV,KAAK4/F,GAAYQ,EAAjBpgG,YACAiT,2CAEFtF,MALF,UAME2c,UAAW,uBANb,MAOED,SAAUg1E,aAA8B/mE,GAR5C,yBAaE,wBAAQtjB,QAAR,EAA8BrH,MAA9B,UAA8C6yF,WAAS,GAhF7D,WAsFE,sBACEnrF,KADF,EAEEmB,QAAS,WACPupF,OAEFV,eAAgBA,QAsC1B,GA/BoB98F,qBAAS,YAAuC,IAAD,EACzC4O,oBADyC,sBAC1DkE,EAD0D,KACpDS,EADoD,KAGzD7C,EAAYjE,EAH6C,QAI3DwC,EAAUnB,KAMhB,OACE,yBAAKS,UAAWU,EAAQwtF,UACtB,wBACE5qF,cADF,eAEEY,QAAO,sBAAE,sBAAAxV,EAAA,sDACPsW,MADO,2CAGT5J,KALF,QAMEyB,MANF,UAOE2c,UAAW,uBAPb,MAQE9Y,QAAS,CAAE1D,KAAM0D,EAAQytF,cAT7B,SAaG5pF,EACC,sBAAaW,YAnBC,WAClBF,OAkB2C7C,QAASA,IAftD,SCzRa1Q,4BA1Cf,SAAwB,GAAsD,IAApD4S,EAAmD,EAAnDA,cAChB8S,EAAc9S,EADqD,UAErEsrF,EAAuBtrF,YAA7B,wBAEA,MACE,MAAM,UAAN,4CALyE,MAWtEsrF,EAXsE,QASzEn9B,EATyE,kBAUzED,EAVyE,wBAczEq9B,EAdyE,oBAezEC,EAfyE,0BAgBzEC,EAhByE,2BAiBzEC,EAjByE,qBAkBzE34E,EAlByE,UAqB3E,OACE,oCACE,qBACED,UADF,EAEE5S,KAFF,EAGEmB,QAAS,WACPqqF,SAGJ,qBACE54E,UADF,EAEE5S,KAFF,EAGEmB,QAAS,WACPoqF,OAEFE,eAAiB54E,EAAD,eAAoCjmB,WCrC5D,SAAS8+F,GAAe9/F,GACtB,qBAAWA,EACT,cAAkBW,YAAlB,kBAAuC,CAAlC,IAAM/E,EAAG,EAAT,GACH,kBAAWoE,EAAP,GACF8/F,GAAe9/F,EAAf8/F,IACK,QAAIlkG,UACFoE,EAAP,SAMR,IAyDA,GAzDgBsB,qBAAS,YAAwB,IAArB4S,EAAoB,EAApBA,cAAoB,EAC3B6rF,aAAc,WADa,MACvCC,EADuC,sBAExBD,aAAc,cAFU,MAEvCE,EAFuC,sBAGrBF,aAAc,UAHO,MAGrCG,EAHqC,oBAItCl5E,EAAc9S,EAJwB,YAKV8S,GALU,GAKtC7H,EALsC,QAK/B8H,EAL+B,UAKtBjV,EALsB,UAMlCmuF,EAAqBnuF,EANa,GAwC9C,GAhCAxB,qBAAU,WACR0vF,EAAa,SAAD,OAAZA,IACA7mG,0BACAA,0BACC,CAAC8mG,EAAiB,EAAlB,EAJH3vF,IAMAA,qBAAU,WACR4vF,qBAAWn5E,EAAD,uCAAU,mCAAA1oB,EAAA,oFAGhBuhG,GADM9/F,EAASg6B,WAAWA,eAFV,KAIVqmE,EAAU,CAAEL,SAAF,EAAYhgG,UAJZ,SAMO4qB,MAAMq1E,GAAD,gBAAiC,CAC3D3tE,OAD2D,OAE3DK,QAAS,CACP,eAAgB,oBAElBkjB,KAAM7b,oBAXQ,WAMVlG,EANU,6CAcQA,EAdR,eAcR5b,EAdQ,OAedlG,uCACyB8hB,EADzB9hB,oBAC6C8hB,EAD7C9hB,wBAEIkG,GAFJlG,KAfc,4CAAV,yDAuBT,CAACiV,EAAQ,EAAT,EAxBHzW,IA0BA,EACE,MAAM2O,EAGR,IAAMjR,EAAQkT,kBAAQ4F,EAAD,QAArB,SACA,OACE,wBAAe9Y,MAAOD,8BAAmBC,IACvC,uBADF,MAEE,0BACE8D,QADF,EAEEwJ,cAAe,sBAAaxJ,QAASA,MAEtCguF,EAAW,sBAAgB9rF,cAAeA,IAP/C,SClDIosF,GAAgB,CACpB,mBACA,mBACA,oBACA,iBACA,iBACA,mBACA,qBACA,mBACA,mBACA,mBACA,mBACA,iBACA,kBACA,iBACA,oBACA,qBACA,mBACA,qBACA,mBACA,oBACA,qBACA,qBACA,qBACA,qBACA,qBACA,oB,SAGaC,G,uFAAf,WACE3oC,EACA4oC,EACAhuE,EACArxB,GAJF,+BAAA5C,EAAA,6DAMU0iB,EAAcuR,EAAdvR,UANV,SAOQ88B,gBAAK,kBAAM1pC,QAAQujD,EAASh0C,SAAWg0C,EAAS6oC,kBAAiB,CACrEt/F,SACAH,KAAM,wBATV,uBAYyB42D,EAAS52C,WAAWK,KACzCJ,EACA,kBAFqB,aAInBE,cAAeq/E,EACfr/F,UACGqxB,GAEL,CAAEjU,QAAS,MApBf,UAYQuS,EAZR,OAsBQ4vE,EAAqC,GAChB9oC,EAAnB6oC,eAvBV,uBAyBU,IAAIriG,MAAJ,iCAAoCw5D,EAAS52D,KAA7C,sBAzBV,QAsCE,IAVA8vB,EAASz2B,SAAQ,SAACI,GAChBkmG,GAAalmG,GACb,IAAMmmG,EAAQhpC,EAASe,oBAAoBl+D,GACvCmmG,IACFF,EAAWE,GAASnmG,MAKlBK,EAAmC,GACzC,MAA2C6F,OAAOhD,QAAQ+iG,GAA1D,eAAuE,sBAA3DG,EAA2D,KAA5CC,EAA4C,KACrEhmG,EAASgmG,GAAeD,EAvC5B,yBA0CS,CACLE,WAAYL,EACZM,WAAYlmG,IA5ChB,6C,sBAgDA,SAAS6lG,GAAalmG,GAEpB,IACGA,EAAQqxE,MACP,+DAGF,MAAM,IAAI1tE,MAAJ,wCAA2C3D,EAA3C,MAqBK,SAASwmG,GACtBC,EACAhtF,GAEA,IAAMitF,EAAe,IAAIn4B,KAAsB,CAC7CD,MAAO,IAAIE,KAAS,CAAEC,QAAS,MACzBl6D,KAFuC,SAG3CgO,EACAokF,EACA7gG,GACA,4HACQigG,EAA+BxjF,EAA/BwjF,YAAaj9F,EAAkByZ,EAAlBzZ,KAAMivB,EAAYxV,EAAZwV,QAD3B,kBAEO+tE,GACLh9F,EACAi9F,EAFmB,YAAC,eAGfhuE,GAHc,IAGLjyB,mBACd6gG,IANF,gDAWJ,OAAOj/F,QACJnJ,MAAM,CACL6L,cAAe1C,QAAMmsC,cAAc4yD,GACnCt9E,QAASzhB,QAAM+B,MAAM/B,QAAM6oB,MAAMq2E,WACjCZ,eAAgBt+F,QAAM+B,MAAM/B,QAAMR,IAAIQ,QAAMS,WAE7CiZ,OAAM,SAAAtY,GAAI,MAAK,CACd,kBACE,OAAO8Q,QAAQ9Q,EAAKk9F,iBAEtB,WACE,OAAOpgG,yBAAekD,EAAKsB,cAAe,SAG5C,cACE,OAAOxE,yBAAekD,EAAKsB,cAAe,YAG5C61B,QAZc,SAYN15B,GACN,OAAOpE,KAAKoE,OAASA,GAAQpE,KAAK+kC,QAAQ7Z,SAAS9mB,IAGrD,iBACE,OAAQpE,KAAKoE,MAAb,mBAAsBpE,KAAK+kC,WAE7B,eACE,OAAOp+B,EAAKqgB,SAAWrgB,EAAKqgB,QAAQjiB,KAAI,SAAArH,GAAM,OAAIA,EAAOG,YAE3D,kBACE,GAAK8I,EAAKk9F,eAGV,OAAO5sF,MAAM/U,KAAKyE,EAAKk9F,eAAehhG,SAExC,iBACE,OAAOuF,oBAAUzB,EAAM,GAAGyd,YAE5B,oBACE,IAAMlS,EAASzO,yBACbkD,EAAKsB,cACL,iBAEF,OAAsB,IAAlBiK,EAAO3S,OACFmkG,GAEFxxF,OAGV+M,OAAM,SAAAtY,GAAI,MAAK,CACdo1D,oBADc,SACMl+D,GAClB,IAAK8I,EAAKk9F,eACR,MAAM,IAAIriG,MACR,4FAGJ,OAAOmF,EAAKk9F,eAAe1jG,IAAItC,IAEjC6mG,gBATc,SASE7mG,GAAiB,MACzBs6D,EAAG,UAAGxxD,EAAKutB,gBAAR,aAAG,EAAe0T,WAAU,SAAAtf,GAAC,OAAIA,IAAMzqB,KAChD,QAAYuC,IAAR+3D,IAA8B,IAATA,EAGzB,OAAOxxD,EAAK+8F,cAAcvrC,EAAMxxD,EAAK+8F,cAAcnkG,SAErD+5F,eAhBc,SAgBCz7F,GACb,IAAK8I,EAAKk9F,eACR,MAAM,IAAIriG,MACR,8EAGJ,QAASxB,KAAK+7D,oBAAoBl+D,QAGrC6I,SAAQ,SAAAC,GAAI,MAAK,CAChB01B,WADgB,aAEhBq7D,UAFgB,YAQb,IALDiN,EAKC,EALDA,2BACAd,EAIC,EAJDA,eAKA7jG,KAAK4kG,WAAWD,GAChB3kG,KAAK6kG,kBAAkBhB,IAEzBtnE,SAZgB,SAYPha,GACFna,oBAAUzB,EAAM,GAAGk8F,mBACtBz6F,oBAAUzB,EAAM,GAAG41B,SAASha,IAGhCqiF,WAjBgB,SAiBL59E,GACTrgB,EAAKqgB,QAAUkW,eAAKlW,IAEtB69E,kBApBgB,SAoBEhB,GAChBl9F,EAAKk9F,eAAiB3mE,eAAK2mE,IAE7BhoE,YAvBgB,WAwBdE,gCAEEp1B,EAqDV,SAA8B2Q,GAC5B,OAAO,SAAC3Q,GACN,GAAIA,EAAKsB,cAAe,OAIhB68F,EAAwBn+F,EAAKsB,cAAcwnE,SAASnnC,QACpDy8D,EAA2B,UAC/Bp+F,EAAKsB,cAAc47F,sBADY,aAC/B,EAAmCv7D,QACrC,MAAO,CACLw8D,wBACAlnG,aAAc+I,EAAKvC,KACnB2gG,8BACAztF,mBAhEE0tF,CAAqB1tF,GACrB2tF,GACA,CAAE7gG,KAAM,GAAF,OAAKuC,EAAKvC,KAAV,qBAAmCg4B,iBAAiB,GAC1Dp8B,KAAKq8B,WACLr8B,KAAK03F,UACL13F,KAAKu8B,eAIVtd,OAAM,SAAAtY,GAAI,MAAK,CACdu+F,mBADc,SACKtB,EAAsBhuE,GAAsB,IACrDrxB,EAAoCqxB,EAApCrxB,OAAQZ,EAA4BiyB,EAA5BjyB,eAAmBgE,EAD0B,YACjBiuB,EADiB,6BAE7D,IAAKA,EAAQvR,UACX,MAAM,IAAI7iB,MAAM,yBAElB,IAAM2jG,EA1Jd,SAAsBvB,GACpB,OAAOhyD,IAAoBgyD,GAyJHwB,CAAaxB,GAC/B,OAAOW,EAAapkG,IAClBglG,EACA,CACEvB,cACAj9F,KAAMA,EACNivB,QAASjuB,GAEXpD,EACAZ,IAOE0hG,wBAtBQ,SAsBgBzB,EAAsBlgG,GAAmB,+HAChEA,GAASA,EAAK2gB,UADkD,sBAE7D,IAAI7iB,MAAM,yBAFmD,uBAInD,EAAK0jG,mBAAmBtB,EAAalgG,GAJc,cAI/DqB,EAJ+D,yBAK9DA,EAAIo/F,YAL0D,8CAWjEmB,+BAjCQ,SAkCZ1B,EACAlgG,GACA,4IACkB,EAAKwhG,mBAAmBtB,EAAalgG,GADvD,cACMqB,EADN,yBAEOA,EAAIq/F,YAFX,kD,SAyBOa,G,mFAAf,WACE9zF,EACA5M,GAFF,+CAAA5C,EAAA,yDAIOwP,EAJP,oDASI2zF,EAIE3zF,EAJF2zF,sBACAlnG,EAGEuT,EAHFvT,aACAmnG,EAEE5zF,EAFF4zF,4BACAztF,EACEnG,EADFmG,cAGI26B,EAAkB36B,EAAcgvB,eACpCw+D,EAAsBt6F,MAEhB8lC,EAAkC2B,EAAlC3B,aAAcloB,EAAoB6pB,EAApB7pB,gBAlBxB,KAmBgBkoB,EAnBhB,6CAmBuCloB,QAnBvC,IAmBuCA,OAnBvC,EAmBuCA,IAnBvC,8BAmBQ8pB,EAnBR,4BAqBU,IAAI1wC,MAAM,+BArBpB,eAuBQ8mC,EAAU,IAAI4J,EAAM4yD,GAvB5B,UAwBgCx8D,EAAQi9D,WAAW,CAAEhhG,WAxBrD,WAwBQihG,EAxBR,OA0BQb,EAA6Ba,EAAezgG,KAAI,SAAA0gG,GAGpD,OADA1B,GADoB0B,EAAZ5nG,SAER,2BAAY4nG,GAAZ,IAA2B7nG,oBAEvBimG,EAAiC,IACnCkB,EAhCN,oBAiCUW,EAAsBpuF,EAAcgvB,eACxCy+D,EAA4Bv6F,MAGdm7F,EAEZD,EAFFp1D,aACiBs1D,EACfF,EADFt9E,gBAtCN,KAwCqBu9E,EAxCrB,8CAwC+CC,QAxC/C,IAwC+CA,OAxC/C,EAwC+CA,IAxC/C,+BAwCUC,EAxCV,4BA0CY,IAAIrkG,MAAM,0BA1CtB,eA4CUskG,EAAsB,IAAID,EAC9Bd,GA7CN,UA+CsCe,EAAoBC,kBAAkB,CACtExhG,WAhDN,eAsDuB9G,SAAQ,YAA0B,IAAvBI,EAAuB,EAAvBA,QAAuB,EAAdknC,QAC7BtnC,SAAQ,SAAAuoG,GACdjC,GAAaiC,GACbnC,EAAemC,GAASnoG,QAzDhC,eA+DE8mG,EAA2BlnG,SAAQ,SAAAC,GACjCmmG,EAAenmG,EAAOG,SAAWH,EAAOG,WAhE5C,kBAkES,CAAE8mG,6BAA4Bd,mBAlEvC,6C,sBC3Se,SAASoC,GACtB3B,EACAhtF,GAEA,IAAM4uF,EAAW7B,GAAgBC,EAAoBhtF,GACrD,OAAO/R,QACJnJ,MAAM,CACLk7C,WAAY/xC,QAAM6oB,MAAM83E,KAEzBjnF,OAAM,SAAAtY,GAAI,MAAK,CACdxG,IADc,SACVvC,GACF,OAAO+I,EAAK2wC,WAAWzgB,MAAK,SAAAmkC,GAAQ,OAAIA,EAASl9B,QAAQlgC,OAG3D,mBAGE,4BACKwK,oBAAUzB,GAAM0jB,QAAQitB,YAD7B,YAEMlvC,oBAAUzB,GAAMyO,QAAQ+wF,mBAAqB,MAIrD,iBACE,OAAO/9F,oBAAUzB,GAAMyd,YAEzB,oBACE,OAAOhc,oBAAUzB,GAAM2Q,eAEzB,0BACE,IADwB,EACpB4c,EAAqB,GADD,eAEDvtB,EAAK2wC,YAFJ,IAExB,2BAAwC,KAA7B0jB,EAA6B,QACtC,IAAKA,EAASorC,YACZ,OAEFlyE,EAAWA,EAAS6/B,OAAOiH,EAASorC,cANd,8BAQxB,OAAOlyE,OAGVjV,OAAM,SAAAtY,GAAI,MAAK,CAGR8wF,gBAHQ,SAGQ75F,GAAsB,oHACrCA,EADqC,sBAElC,IAAI4D,MAAM,gDAFwB,YAIpCw5D,EAAWr0D,EAAKxG,IAAIvC,IAJgB,gCAMlCujD,gBAAK,kBAAM1pC,QAAQujD,EAASh0C,SAAWg0C,EAAS6oC,mBANd,gCAOjC7oC,GAPiC,qCASnC56D,GATmC,8CAYtCilG,wBAfQ,SAgBZzB,EACAhmG,EACA8F,GACA,iIACMy9C,gBAAK,kBAAM1pC,QAAQ9Q,EAAKxG,IAAIvC,MAAgB,CAChD2G,OAAQb,EAAKa,OACbH,KAAM,wBAHR,YAMM42D,EAAWr0D,EAAKxG,IAAIvC,IAN1B,yCAQSo9D,EAASqqC,wBAAwBzB,EAAalgG,IARvD,qCAUOtD,GAVP,8CAYIklG,+BA/BQ,SAgCZ1B,EACAhmG,EACA8F,GACA,iIACMy9C,gBAAK,kBAAM1pC,QAAQ9Q,EAAKxG,IAAIvC,MAAgB,CAChD2G,OAAQb,EAAKa,OACbH,KAAM,wBAHR,YAKM42D,EAAWr0D,EAAKxG,IAAIvC,IAL1B,yCAOSo9D,EAASsqC,+BAA+B1B,EAAalgG,IAP9D,qCASOtD,GATP,8CAWFk5F,eA9Cc,SA8CCz7F,EAAiBD,GAC9B,GAAIA,EAAc,CAChB,IAAMo9D,EAAWr0D,EAAKxG,IAAIvC,GAC1B,GAAIo9D,EACF,OAAOA,EAASs+B,eAAez7F,GAEjC,MAAM,IAAI2D,MAAJ,6BACkB5D,EADlB,qCAIR,IAAK+I,EAAK0/F,oBACR,MAAM,IAAI7kG,MAAJ,+JAIR,OAAOmF,EAAK0/F,oBAAoBn7E,SAASrtB,QAG5C6I,SAAQ,SAAAC,GAAI,MAAK,CAChB4zE,eADgB,SACD6c,GACbzwF,EAAK2wC,WAAW/P,OAAO6vD,IAEzBv7D,YAJgB,WAIF,WACZ8E,sBACEh6B,EACAmqE,qBAEE,kBAAMnqE,EAAK2/F,gBACX,SAAAC,GACE5/F,EAAK2wC,WAAW75C,SAAQ,SAAA25F,GACjBA,EAAInvF,eACP,EAAKsyE,eAAe6c,MAGxBmP,EAAgB9oG,SAAQ,SAAA+oG,IAKO,IAJD7/F,EAAK2wC,WAAW1P,WAC1C,SAAAozB,GAAQ,OACNA,EAAS52D,OAASX,yBAAe+iG,EAAgB,YAGnD,EAAKpoB,YAAYooB,QAIvB,CAAEpqE,iBAAiB,EAAMh4B,KAAM,iCAQrCg6E,YAlCgB,SAmCdooB,GAEA7/F,EAAK2wC,WAAWp4C,KAAK,CAAE+I,cAAeu+F,KAGxCC,gBAxCgB,SAyCdtuC,EACAquC,GAEA7/F,EAAK2wC,WAAW6gB,GAAOj7B,eAAK,CAC1Bj1B,cAAeu+F,SCjKV,gBAAClvF,GACd,IAAMovF,EAA2B/jF,8BAC/B,eACA,CACEoiB,QAAS,CACPv6B,KAAM,cACNgd,aAAc,GACd/a,YAAa,yCAEfgjE,SAAUn4D,EAAcgI,aAAa,0BAClCwD,aACH4gF,cAAe,CACbl5F,KAAM,cACNgd,aAAc,GACd/a,YACE,sIAGN,CAAE2rB,mBAAoB,SAGlBuuE,EAAuBhkF,8BAC3B,WACA,CACEkhF,eAAgBlhF,8BAAoB,iBAAkB,CACpD2lB,QAAShxB,EAAc2sB,0BAA0B,cAGrD,CAAEjhB,kBAAmB0jF,IAkBvB,MAAO,CACLE,sBAAuB,CAACD,EAAsBD,GAC9CG,WAjBF,SACEC,GAIA,OAAKA,GAGsBA,EAAnBjD,eAEC8C,EAJAD,KCtCPK,GAAkCpkF,8BACtC,sBACA,GACA,CAAEM,iBAAiB,IAEf+jF,GAAiCrkF,8BACrC,qBACA,GACA,CAAEM,iBAAiB,IAEfgkF,GAAgCtkF,8BACpC,oBACA,GACA,CAAEM,iBAAiB,IAGNN,iCACb,aACA,CACEukF,cAAe,CACb18F,KAAM,SACNiC,YACE,mGACF+a,aAAc,uBAEhB2/E,QAAS5hG,QAAMC,SACbD,QAAMR,IACJQ,QAAMsC,MACJk/F,GACAC,GACAC,KAGJ,CAAEG,oBAAqB,CAAE58F,KAAM,0BAGnC,CAEE9D,QAAS,SAACC,GAAD,MAAgB,CACvB0gG,gBADuB,SACPC,EAAoBC,GAClC5gG,EAAKwgG,QAAQ9mG,IAAIinG,EAAYC,Q,WChBrC,SAASC,GAAWnyE,GAClB,MAAqB,oBAAVA,KAGPA,aAAiB7zB,O,8CAQhB,WACLimG,EACAC,EACA/0D,GAHK,SAAAhxC,EAAA,sEAMC8lG,EAAOhjF,KAAK,OAAQ,GAAI,CAAE9C,QAAS,IAAWgxB,uBAN/C,gCASE,IAAIre,SAAQ,SAACqzE,EAAUp8D,IAC5B,SAASrP,IACP/gB,WAAU,sBAAC,sBAAAxZ,EAAA,+EAED8lG,EAAOhjF,KAAK,OAAQ,GAAI,CAC5B9C,QAAoB,EAAX+lF,EACT/0D,uBAJK,OAMPzW,IANO,+CAQPqP,EAAO,EAAD,IARC,wDAURm8D,GAELxrE,OAvBG,4C,0BAmCD0rE,G,WAKJ,WAAYC,GAAuB,yBAJnCJ,YAImC,OAFnCI,YAEmC,EACjC7nG,KAAK6nG,OAASA,E,6CAGhB,SAAUvwF,EAA8Bq7B,GAA4B,WAClE,IAAK3yC,KAAKynG,OAAQ,CAChB,IAAMA,EAASznG,KAAK6nG,OAAOC,WAAWxwF,IA9CrC,SAAP,wCA+CMywF,CAAYN,EAAQznG,KAAK6nG,OAAOG,YAAar1D,GAAoBpV,OAC/D,SAAAhb,GACM,EAAKklF,SACP3qE,QAAQU,KAAR,iEAC4Djb,IAE5D,EAAKklF,OAAOQ,UACZ,EAAKR,OAAOvxE,OAAS,SACrB,EAAKuxE,OAAOllF,MAAQA,EACpB,EAAKklF,YAASrnG,MAIpBJ,KAAKynG,OAASA,EAEhB,OAAOznG,KAAKynG,W,KAIcS,G,WAmB5B,WAAY9nF,GAAgC,yBAlBnChc,UAkBmC,OAhBpC+jG,sBAAwB,EAgBY,KAdpCC,kBAAoB,IAAItoG,IAcY,KAZpCuoG,YAAc,EAYsB,KARpCC,gBAQoC,OAN5CN,YAAc,IAM8B,KAJ5CO,qBAAuB,IAIqB,KAF5CnlG,YAE4C,EAC1CpD,KAAKoD,OAASgd,EAAKhd,O,8CAIrB,SACEiyB,EACA/d,EACA+M,GACY,WACZ,GAAIpN,MAAM2f,QAAQvB,GAChB,OAAQA,EACLvK,OAAO08E,IACPziG,KAAI,SAAA4vC,GAAC,OACJ,EAAK6zD,WAAW7zD,EAAGr9B,EAAe+M,MAGxC,GAAqB,kBAAVgR,GAAgC,OAAVA,EAAgB,CAE/C,GAAIA,aAAiBozE,YACnB,O7MpID,SACLlkG,EACAmkG,GAEA,IAAI13D,EAAgBJ,EAAezwC,IAAIoE,GAYvC,OAXKysC,IACHL,GAAsB,EACtBC,EAAevwC,IAAIkE,EAAQosC,GAC3BK,EAAgBL,EAChBpsC,EAAO6P,iBAAiB,SAAS,WAC/B,IAAMu0F,EAAW/3D,EAAezwC,IAAIoE,QACnBnE,IAAbuoG,GACFD,EAAS,cAAeC,OAIvB,CAAE33D,iB6MoHK43D,CACNvzE,EACAr1B,KAAK6oG,YAAYt/D,KAAKvpC,KAAMsX,EAAe+M,IAI/C,GAAIiP,0BAAgB+B,KAAWjY,kBAAQiY,GACrC,MAAM,IAAI7zB,MAAM,2CAKlB,OAAI6zB,aAAiByzE,KACZzzE,EAGF0zE,4BACLhlG,OAAOhD,QAAQs0B,GACZvK,QAAO,SAAAkM,GAAC,OAAIwwE,GAAWxwE,EAAE,OACzBjyB,KAAI,mCAAE7B,EAAF,KAAKizB,EAAL,WAAY,CAACjzB,EAAG,EAAKslG,WAAWryE,EAAG7e,EAAe+M,QAG7D,OAAOgR,I,yBAGT,SACE/d,EACA+M,EACA2kF,EACAL,GAEe3oG,KAAKipG,UAAU5kF,EAAW/M,GAClCmN,KACLukF,EACA,CAAEL,YACF,CAAEhnF,QAAS,IAASgxB,mBAAoB3yC,KAAKoE,S,8BAIjD,WAAiC,WACzB8kG,EAtHV,WACE,IAAMC,EAA+B,qBAAX1sG,OACpB2sG,EAAYD,GAAc,wBAAyB1sG,OAAO26B,UAChE,OAAI+xE,GAAcC,EACT3sG,OAAO26B,UAAU8xE,oBAEnB,EAgHuBG,GAEtBhB,EACJroG,KAAKqoG,aAAejrG,KAAKuB,IAAI,EAAGvB,KAAKC,MAAM6rG,EAAsB,GAAK,IAExE,OAAO,YAAI,IAAIjyF,MAAMoxF,IAActjG,KAAI,kBAAM,IAAI6iG,GAAW,Q,2BAG9D,WACE,IAAK5nG,KAAKsoG,WAAY,CACpB,IAAMtmG,EAAMhC,KAAKspG,mBAEjB,OADAtpG,KAAKsoG,WAAatmG,EACXA,EAET,OAAOhC,KAAKsoG,a,uBAGd,SAAUjkF,EAAmB/M,GAC3B,IAAMiyF,EAAUvpG,KAAKwpG,gBACjBC,EAAezpG,KAAKooG,kBAAkBjoG,IAAIkkB,GAC9C,QAAqBjkB,IAAjBqpG,EAA4B,CAC9B,IAAMC,GAAoB1pG,KAAKmoG,qBAAuB,GAAKoB,EAAQhqG,OACnES,KAAKooG,kBAAkB/nG,IAAIgkB,EAAWqlF,GACtC1pG,KAAKmoG,qBAAuBuB,EAC5BD,EAAeC,EAIjB,IAAMjC,EAAS8B,EAAQE,GAAcR,UAAU3xF,EAAetX,KAAKoE,MACnE,IAAKqjG,EACH,MAAM,IAAIjmG,MAAM,qCAElB,OAAOimG,I,yDAGT,WACEnwF,EACA+M,EACA2kF,EACA5oF,GAJF,kDAAAze,EAAA,yDAKEi0B,EALF,+BAKY,GAELvR,EAPP,sBAQU,IAAI+kB,UAAU,yBARxB,cAUQq+D,EAASznG,KAAKipG,UAAU5kF,EAAW/M,GACnCqyF,EAAYryF,EAAcsyF,iBAAiBZ,GAXnD,SAY+BW,EAAUE,mBAAmBzpF,EAAMpgB,KAAKoE,MAZvE,cAYQitC,EAZR,OAaQy4D,EAA4B9pG,KAAKwoG,WACrCn3D,EACA/5B,EACA+M,GAII0lF,EAAQtC,EAAOhjF,KAAKukF,EAAcc,EAA1B,aACZnoF,QAAS,IACThe,eAAgByc,EAAKzc,eACrBgvC,mBAAoB3yC,KAAKoE,MACtBwxB,IAMCo0E,EAAU,IAAI11E,SAAQ,SAACqzE,EAAUp8D,GACrC0+D,EAAsBC,aAAY,WAEV,WAAlBzC,EAAOvxE,QACTqV,EACE,IAAI/pC,MAAJ,kEAC6DimG,EAAOllF,WAIvE,EAAKgmF,yBACP4B,SAAQ,WACTC,cAAcH,MAMVI,EAAU/1E,QAAQg2E,KAAK,CAACP,EAAOC,IAhDvC,KAkDSL,EAlDT,UAkD2CU,EAlD3C,gCAkDoDjqF,EAlDpD,KAkD0DpgB,KAAKoE,KAlD/D,uBAkDmBmmG,kBAlDnB,4E,oEC7MIC,G,6JACJ,WACExqG,KAAKupG,QAAQ,GAAGkB,c,yDAGlB,WACEzB,EACA5oF,EACA1c,GAHF,uBAAA/B,EAAA,6DAQUgC,EAAuCD,EAAvCC,eAAgBgvC,EAAuBjvC,EAAvBivC,mBAClB+3D,EATR,kBAS6BhlG,KAAQC,YAC7BglG,EAAW,SAACrvF,GACZ3X,GACFA,EAAe2X,IAGnBtb,KAAK4qG,GAAGF,EAASC,GAfnB,uEAiBI3B,EAjBJ,2BAkBS5oF,GAlBT,IAkBesqF,UAAS/3D,uBACpBjvC,GAnBJ,cAgBQtB,EAhBR,OAqBEpC,KAAK6qG,IAAIH,EAASC,GArBpB,kBAsBSvoG,GAtBT,gD,gEAL4B0oG,KAAIC,QA+BbC,G,kDAOnB,WACE5qF,EACA6qF,GACA,kCACA,cAAM7qF,IAVRhc,KAAO,qBASL,EAPF8mG,iBAOE,IALFD,6BAKE,EAEA,EAAKC,YAAc9qF,EAAK8qF,YACxB,EAAKD,wBAA0BA,EAH/B,E,8CAMF,WAIE,IAAMxD,EAAS,IAAI+C,GAAgB,CAAEjB,QAAS,CAAC,IAAIvpG,KAAKkrG,eAGxD,OADAzD,EAAO8B,QAAQ,GAAG4B,YAAYnrG,KAAKirG,yBAC5BxD,M,GAvBqCS,IC1C1CkD,G,uFACJ,c,yDAEA,WACEC,EACAC,GAFF,yBAAA3pG,EAAA,4FAGa,GAHb,uBAKSvB,GALT,2C,gEAcmBgnG,G,kDAKnB,WAAYhnF,GAAgC,kCAC1C,cAAMA,IALRhc,KAAO,sBAIqC,EAF5C0jG,gBAE4C,EAE1C,EAAKA,WAAa,kBAAmB,IAAIsD,IAFC,E,+EAK5C,WACE9zF,EACA+M,EACA2kF,EACA5oF,GAJF,mBAAAze,EAAA,yDAMO0iB,EANP,sBAOU,IAAI+kB,UAAU,yBAPxB,cASQugE,EAAYryF,EAAcsyF,iBAAiBZ,GATnD,SAU+BW,EAAUE,mBAAmBzpF,EAAMpgB,KAAKoE,MAVvE,cAUQitC,EAVR,gBAWuBs4D,EAAU4B,QAAQl6D,EAAgBrxC,KAAKoE,MAX9D,cAWQhC,EAXR,yBAYSunG,EAAUY,kBAAkBnoG,EAAQge,EAAMpgB,KAAKoE,OAZxD,iD,kEAV+C8jG,I,GCL7B,qBAAXzrG,OAAyBA,OAAU,G,MAFpC+uG,0B,OAAoB,G,GAAItqG,G,GAAAA,S,SAQjBuqG,G,iFAAf,WAAoBC,GAApB,SAAA/pG,EAAA,+EACS,IAAI2yB,SAAQ,SAAAgX,GACjBnwB,WAAWmwB,EAASogE,OAFxB,4C,0BAQMC,G,WASJ,WACEtqG,EACA5E,EACA2G,GACA,yBAZM/B,iBAYN,OAVM5E,YAUN,OARM2G,YAQN,OANM+6C,OAAQ,EAOdn+C,KAAKqB,YAAcA,EACnBrB,KAAKvD,OAASA,EACduD,KAAKoD,OAASA,E,2CAGhB,WACEpD,KAAKvD,OAAOwrG,Y,0DAId,4BAAAtmG,EAAA,yDACO3B,KAAKm+C,MADZ,iBAEQytD,GAAiB,EAFzB,UAGYA,EAHZ,iCAIYH,GAAK,KAJjB,uBAKgCzrG,KAAKqB,YAAYwqG,aACzC7rG,KAAKvD,OACL,2BAPR,OAKMmvG,IALN,+CAWyB5rG,KAAKqB,YAAYwqG,aACpC7rG,KAAKvD,OACL,YACAuD,KAAKoD,QAdX,yCAiBY,IAAI5B,MAAM,8BAjBtB,QAmBIxB,KAAKm+C,OAAQ,EAnBjB,iD,+GAuBA,WACE6qD,EACA8C,GAFF,mCAAAnqG,EAAA,6DAGE+B,EAHF,+BAGsD,GAHtD,SAKQ1D,KAAK6D,QALb,cAOsCH,EAA5BC,eAAmBgE,EAP7B,YAOsCjE,EAPtC,oBAQQgnG,EARR,kBAQ6BhlG,KAAQC,YAC7BglG,EAAW,SAAClyF,EAAiB6C,GAC7B5X,EAAKC,gBACPD,EAAKC,eAAe2X,IAGxBtb,KAAKqB,YAAYupG,GAAGF,EAASC,GAd/B,SAeuB3qG,KAAKqB,YAAYwqG,aACpC7rG,KAAKvD,OACL,OACAusG,EAHmB,2BAId8C,GAJc,IAIApB,YACnB/iG,GApBJ,cAeQvF,EAfR,OAsBEpC,KAAKqB,YAAY0qG,eAAerB,EAASC,GAtB3C,kBAuBSvoG,GAvBT,iD,gECnDI4pG,GAAgB,CACpBhB,sBACA5D,uBACA6E,kB,kDDkFA,WACE7rF,EACA8rF,GACA,2BACA,cAAM9rF,IAVRhc,KAAO,oBASL,EAPF8nG,gBAOE,IALFxB,aAKE,MAEQyB,EAA0B/rF,EAA1B+rF,sBAFR,OAIA,EAAKD,WAAaA,EAClB,EAAKxB,QAAUyB,EALf,E,8CAQF,WAAiC,IACvB9qG,EAAgBmqG,GAAhBnqG,YACR,IAAKA,EACH,MAAM,IAAIG,MACR,mFAGJ,IAAKN,GACH,MAAM,IAAIM,MACR,oEAGJ,IAAM4qG,EAAiBlrG,GAASmrG,OAC1BC,EAAWjrG,EAAYkrG,SAASvsG,KAAK0qG,SACrCjuG,EAAS2vG,EAAeI,cAAcC,OAAOH,GAEnD,OADe,IAAIX,GAAmBtqG,EAAa5E,EAAQuD,KAAKksG,c,yDAIlE,WACE50F,EACA+M,EACA2kF,EACA5oF,GAJF,+BAAAze,EAAA,6DAKEi0B,EALF,+BAKY,GALZ,uEAQIte,EACA+M,EACA2kF,EACA5oF,EACAwV,GAZJ,aAemB,kBARXtN,EAPR,SAeqC,OAANA,GAAc,cAAeA,KAClD9H,EAAM,IAAIC,OAEZE,IAAM2H,EAAE7I,UAAUc,QAEtB+H,EAAE7I,UAAYe,GApBlB,kBAsBS8H,GAtBT,gD,kEArC6C4/E,KCxE1BwE,G,WAWnB,WACEp1F,EACAq1F,EACAC,GAEA,GADA,yBAZFC,mBAYE,OAVFv1F,mBAUE,OARFq1F,uBAQE,OANFC,2BAME,GACKD,EACH,MAAM,IAAInrG,MAAM,qDAElBxB,KAAKsX,cAAgBA,EACrBtX,KAAK2sG,kBAAoBA,EACzB3sG,KAAK4sG,sBAAwBA,EAC7B5sG,KAAK6sG,cAAgB,IAAI/sG,I,6CAG3B,SAAUgtG,GACR,IAAMjF,EAAS7nG,KAAK6sG,cAAc1sG,IAAI2sG,GACtC,GAAIjF,EACF,OAAOA,EAGT,IAAMkF,EAAuB/sG,KAAK4sG,sBAAsBE,GAClDE,EAAkBhB,GAAcc,GAEtC,IAAKE,EACH,MAAM,IAAIxrG,MAAJ,gCAAmCsrG,EAAnC,uBACD,IAAKC,EACV,MAAM,IAAIvrG,MAAJ,gCAAmCsrG,EAAnC,wBAGR,IAAMG,EAAY,IAAID,EAAgBD,EAA6B,CACjEniF,QAAS5qB,KAAKsX,cAAc09B,2BAG9B,OADAh1C,KAAK6sG,cAAcxsG,IAAIysG,EAAaG,GAC7BA,I,8BAGT,SACEC,EACA7B,EACAjrF,GAEA,IAAM0sF,EACJ1sF,EAAK+C,eACL1f,yBAAezD,KAAK2sG,kBAAmB,iBAEzC,OAAO3sG,KAAKmtG,UAAUL,K,yDAGxB,WAAWzoF,EAAmB2kF,EAAsB5oF,GAApD,2BAAAze,EAAA,yDAA8D+B,EAA9D,+BAAqE,GAE9D2gB,EAFP,sBAGU,IAAI7iB,MAAM,yBAHpB,gCAKSxB,KAAKotG,iBAAiB/oF,EAAW2kF,EAAc5oF,GAAMqE,KAC1DzkB,KAAKsX,cACL+M,EACA2kF,EACA5oF,EACA1c,IAVJ,gD,kEA3DmBgpG,GACZ5pF,aAAeuqF,G,0BCdT,SAASC,GAAW,EAApB,KAKb,IAAMC,EAAe,2BACE,CACnBtlG,cAAe0a,8BAAoB,OAAO,OAAR,IAAQ,CAAR,CAChC6qF,IAAKd,GAD2B,aAGhCltF,sBAAuB,CACrBhV,KADqB,SAErBgd,aAAc,GAEhBimF,SAAU,CACRjjG,KADQ,SAERgd,aAAc,qCAEhBkmF,eAAgB/qF,8BAAoB,iBAAkB,CACpDgrF,cAAe,CACbnjG,KADa,cAEbgd,aAAc,CAAC,OAAO,iBAG1BomF,iBAAkB,CAChBpjG,KADgB,UAEhBgd,cAAc,GAEhBlW,MAAO,CAAE9G,KAAF,SAAkBgd,aAAc,KACpClQ,EAvBc,+BAyBnBsT,QAASrlB,cAAYA,QAzBF,UA0BnB+xC,WAAY/xC,cA1BO,GA6BnBggC,OAAQhgC,cAAY+R,4BA7BD,UA8BnBu2F,YAAatoG,cACX+R,4BA/BiB,eAiCnBw2F,eAAgB,iBAAevoG,eAAf,GAAsC,CACpDnB,KAAK,kBAnCU,SAsCV,SAAAuC,GAAI,MAAK,CAChBonG,YADgB,WAEd,IAAMC,EAAN,GACArnG,yBAA2B,SAAA/I,GACzB,MACE,MAAM,UAAN,kDAEF,GAAIowG,WAAJ,GACE,MAAM,6DAAN,IAIAA,cAINC,gBAhBgB,YAgBe,IACrB7pG,EAASy9D,EADW,KAE5B,MACE,MAAM,UAAN,sCAEF,IAAM7G,EAAWr0D,EAAA,iBAAqB,SAAAywF,GAAG,OAAIA,SAAJ,KACzC,KACE,OAAOp8B,EAET,IAAMz7D,EAASoH,EAAA,kDAEb8oE,SAAS,OAAD,IAAC,CAAD,CACNjlE,KADM,yBAENmC,QAAQ,GAAD,qBAAarD,KAAb,QACHu4D,YAHE,OAMV,OAAOl7D,aAAgBpH,EAAvB,IAEF2uG,mBAnCgB,YAoCd,IAAMC,EAAWxnG,EAAA,iBACf,SAAAq0D,GAAQ,OAAIA,SAAJ,KAEV,GACEr0D,wBAGJ6+B,aA3CgB,YA2CS,IACfh7B,EAASxC,EADK,KAEtB,MACE,MAAM,uCAAN,IAEF,IAAMD,EAAQpB,EAAA,aAAiB,SAAAguC,GAAC,OAAIA,YAAc3sC,EAAlB,WAChC,KACE,OAAOD,EAET,IAAMxI,EAASoH,cAAf,GACA,OAAOA,SAAYpH,EAAnB,IAEFipC,eAvDgB,cAuDsB,IAC5Bh+B,EAAS29B,EADkB,KAEnC,MACE,MAAM,yCAAN,IAEF,IAAMpgC,EAAQpB,EAAA,aAAiB,SAAAguC,GAAC,OAAIA,YAAJ,KAChC,MACE,MAAM,iDAAN,IAEF,OAAO5sC,iBAAP,IAEFqmG,kBAlEgB,YAkEmB,IACzB5jG,EAASylF,EADe,KAEhC,MACE,MAAM,4CAAN,IAEF,IAAM1wF,EAASoH,mBAAf,GACA,OAAOA,cAAiBpH,EAAxB,IAGF8uG,qBA3EgB,YA4Ed,IAAMl2C,EAAMxxD,EAAA,uBACV,SAAAq+D,GAAI,OAAIA,OAAY/8D,EAAhB,MAEN,QAAIkwD,EAGJ,OAAOxxD,uBAAP,IAGF2nG,gBArFgB,YAqFY,IAClB3hG,EAAY3E,EADK,QAEnBmwD,EAAMxxD,EAAA,kBAAsB,SAAAguC,GAAC,OAAIA,YAAJ,KACnC,QAAIwjB,EAIJ,OAAOxxD,kBAAP,IAEF4nG,sBA9FgB,YA+Fd,MAMQnqG,GAJNoqG,EADEpmG,sCAAiCqmG,EAArC,KACezkF,sBAAbwkF,GAEaE,gBAAbF,IAL+B,KAQjC,MACE,MAAM,qDAAN,IAEF7nG,oBAEF+lB,UA3GgB,YA4Gd/lB,gCAAmBA,EAAnBA,cACkBqmB,kBAAlB,GACA5C,uBAEFK,aAhHgB,YAiHd9jB,UAAeA,EAAA,gBACb,SAAAmjB,GAAM,MAAI,UAAGA,EAAH,iBAAJ,KAEUkD,kBAAlB,GACA5C,2BA3Je,OA8JZ,SAAAzjB,GAAI,MAAK,CACd,oBACE,OAAOA,EAAA,gBAAoB,SAAAq0D,GAAQ,OAAIv3D,yBAAeu3D,EAAnB,YAErC,iBACE,OAAO5yD,uBAAP,gBAIN,OAAO,4BAAsC,CAC3CX,cAD2C,YAYzC,OAVA,SAASknG,EAAWnsC,EAAI,GACtB,IAAK,IAAL,OACMyP,IAAJ,SACSzP,EAAP,GACK,kBAAWA,EAAP,IACTmsC,EAAWnsC,EAAXmsC,IAINA,CAAW7H,EAAX6H,WACO7H,KA3LbrqG,iCACAA,6C,+CC0BMmyG,GAAcrlF,gBAAK,kBAAM,mCAOhB,SAASslF,GAAoB,GAGzC,IADDC,EACA,uDAD4BvpG,iBAEtBwpG,EAAN,IACMC,EAAe,uCACc,CAC/B1uG,GAAIiF,iBAAeA,QAAfA,WAAiCG,QACrCtB,KAAMmB,QAFyB,OAG/BgJ,OAH+B,EAI/BsQ,YAAa,iBACX,mBAAiBtZ,QAAjB,SAAgC,SAAA/I,GAAK,OAAIA,GAAJ,KALR,KAQ/ByiB,MAAO1Z,cAAY+R,0BARY,eAS/B23F,QAAS1pG,YACP+R,4BAV6B,eAY/BnB,cAAe5Q,YACbA,sBACE+R,4BAd2B,gBAiB/B43F,oBAAqB3pG,cACnB+R,gCAlB6B,eAoB/BmvB,cAAelhC,cACb+R,4BArB6B,UAuB/B63F,mBAAoB5pG,cAClB+R,4BAxB6B,eA0B/B6uF,kBAAmB5gG,cA1BY,GA2B/BwkB,eAAgBxkB,cAAYA,QA3BG,UA4B/BuZ,UAAWvZ,iBAAeA,QAAfA,cA7BM,UA+BT,iBAAC,CAMTw5B,eANyB,EAYzBqwE,UAZyB,EAczBC,qBAdyB,EAezBC,iBAAalvG,MA9CI,OAgDZ,SAAAuG,GAAI,MAAK,CACd,eACE,OAAO6d,kBAAQpc,uBAAD,QAAd,aAEF,iBACE,OAAOA,+BAAP,YAEF,oBACE,OAAOA,+BAAP,eAEF,iBACE,OAAOA,+BAAP,YAEF,oBACE,OAAOA,+BAAP,eAEF,aACE,MAAM,GAAN,mBAAWzB,EAAX,2BAAkCyB,+BAAlC,UAEF,kBACE,MAAM,GAAN,mBACKzB,EADL,gCAEKyB,+BAFL,eAKF,gBACE,OAAOA,uBAAP,WAEF,oBACE,OAAOA,uBAAP,eAEF,yBACE,OAAOA,uBAAP,oBAEF,wBACE,OAAOA,uBAAP,mBAEF,cACE,OAAOA,uBAAP,SAEF,YACE,OAAOA,uBAAP,OAEF,sBACE,OAAOA,uBAAP,iBAEF,cACE,OAAOA,uBAAP,SAEF,kBACE,MAAO,CAAEkJ,MAAO7N,yBAAezD,KAAD,yBAEhC,oBACE,GAAIod,kBAAJ,GAEE,OAAOnG,WAAWtQ,gBAAXsQ,UACLtQ,qBADF,IAaJ4oG,aApEc,YAqEZ,IAAMC,EAAN,GAYA,OAXAC,eAAKrnG,oBAAD,IAAkB,SAAAI,GACpB,GAAIkuC,sBAAY85C,kBAAhB,IAAgC,CAC9B,IAAMX,EAAU6f,qBAAhB,GACA3rG,eAAe8rF,EAAf9rF,qBAA2C,YAAmB,IAAD,mBAAhB/E,EAAgB,KAAXiE,EAAW,KAEvD0sG,8BAA0BnnG,OAA9B,GACEgnG,OAAU,CAAEhnG,KAAF,EAAQxJ,eAKnBwwG,OAjIQ,SAoIV,SAAA7oG,GAAI,MAAK,CAChBo9B,mBADgB,cAEdp9B,oBACAA,iBAEFipG,QALgB,YAMdjpG,UAGFy3E,YATgB,YAUdz3E,6BAEFimB,iBAZgB,YAad,GAAIjmB,EAAA,qBAAyB,SAAAwjB,GAAC,OAAIA,SAAWL,EAAf,QAC5B,MAAM,UAAN,4CAEFnjB,yBACkBqmB,kBAAlB,GACA5C,uBAEFmwD,eApBgB,YAqBd,IAAM5wE,EAAQhD,EAAA,6BACZ,SAAAywF,GAAG,OAAIA,SAAJ,MAEL,IAAIztF,GACFhD,iCAGJgkB,oBA5BgB,YA6Bd,IAAMhhB,EAAQhD,EAAA,0BACZ,SAAAmjB,GAAM,MAAI,UAAGA,EAAH,iBAAJ,MAER,IAAIngB,GACFhD,6BAEgBqmB,kBAAlB,GACA5C,uBAEFylF,eAtCgB,YAyCb,IADD7oE,EACA,uDADkB,GAEVx8B,EAASvC,EADjB,KAEA,MACE,MAAM,UAAN,4CAEF,IAAM7D,EAAOX,yBAAewE,EAA5B,QACM6nG,EAAiBx4F,oBAAvB,GACA,MACE,MAAM,4CAAN,IAEF,IAAMy4F,EAAc,kCAElB3rG,KAFkB,EAGlBoG,KAHkB,EAIlBvC,kBAEI1I,EAASoH,2BAAf,GACA,OAAOA,sBAAyBpH,EAAhC,IAGFywG,gBA7DgB,kBAkEb,IAAD,OACAC,WAAkB,YAA8B,IAA3BznG,EAA0B,EAA1BA,KACf0nG,GAAJ,EACA,IAGE,IAAM1lG,EAAN,gBACMuS,EAAO8F,4BAAb,GACAstF,QAAe,kBAAMpzF,YAAehV,EAArB,YACfmoG,KACKE,EAAL,KACEA,QAEFA,QACA,UAKF,GAAIzpG,cAAiB6B,EAArB,IAA+B,CAG7B,IAAMgC,EAAN,iCACA2lG,QAAe,kBAAM,aAAN,MACfD,KACKE,EAAL,KACEA,QAEFA,QAEF,MACE,MAAM,wHACmGhzE,eACrGpT,sBAFJ,UASNqmF,yBA1GgB,YA0GgD,IAAD,OACvDC,EAAN,GACMF,EAAN,GACMhsG,EAAOX,yBAAewE,EAA5B,QACM48D,EAAal+D,EAAA,0BAA8B,SAAAw+B,GAAC,OAAIA,SAAJ,KAClD,KAAgB,CACd0/B,kBAA0B,YACxB,IAAMorC,EAAYtpG,eAAlB,GACA,8BAWF,MAAO,CAJuB,WAC5B2pG,WAAoC,SAAAl3D,GAAE,OAAIA,OAC1C,sBAEF,KAKJm3D,gBAlIgB,YAmId,IAAMnsG,EAAOX,yBAAewE,EAA5B,QACM48D,EAAal+D,EAAA,0BAA8B,SAAAw+B,GAAC,OAAIA,SAAJ,KAClDx+B,iCAGF6pG,iBAxIgB,YAyId,MAMA,GALI7pG,EAAJ,YACE8pG,EAAcroG,oDAAdqoG,KAIF,EAAkB,CAAC,IACTC,EAAiBzoG,EADT,aAEVkwD,EAAMxxD,EAAA,8BACV,SAAAw+B,GAAC,OAAIA,iBAAJ,KAEH,QAAIgzB,EACF,OAEF,OAAOxxD,8BAAP,GAEF,OAAO8pG,GAGTE,kBA5JgB,YA6Jd,GAAI9xF,IAAgBlY,EAApB,YACE,OAAOA,EAAP,YAEF,IAAIiqG,EAAJ,EAKA,OAJIA,EAAJ,IACEA,KAEFjqG,gBACOiqG,GAGTC,aAxKgB,YAyKd,IAAMC,EAAiBnqG,EAAvB,YAGA,OADuBmqG,EADA9wG,KAAK2wG,kBAAkBG,EAA9C,IAKFnsE,QA/KgB,YA+K8B,IAApBosE,EAAmB,uDAAJ,GACjCC,EAAiB15F,wBAAvB,GACA,MACE,MAAM,sCAAN,IAGF,IAAM/X,EAASoH,EAAA,6CAEb6D,KAAM+pC,KAER,OAAO5tC,QAAWpH,EAAlB,IAGFq6D,WA5LgB,YA4LO,IAAD,iBACKjzD,EADL,mBACpB,2BAA6C,CAAC,IAAhCuQ,EAA+B,0BACvCA,QAAeA,YAAmB6F,EAAtC,IACE/c,KAAKixG,WAAW/5F,IAHA,8BAMpBvQ,mBAGFsnG,gBArMgB,YAsMd,OAAO7lG,+CAAP,IAGFo9B,aAzMgB,YA0Md,GAAI7+B,EAAJ,UACE,OAAOyB,4CAAP,GAF2C,IAIrCuE,EAAkB3E,EAJmB,QAI5BwC,EAASxC,EAJmB,KAK7C,MACE,MAAM,uCAAN,IAEF,IAAMD,EAAQpB,EAAA,oBAAwB,mBAAYguC,YAAZ,KACtC,KACE,OAAO5sC,EAET,IAAMxI,EAASoH,qBAAf,GACA,OAAOA,gBAAmBpH,EAA1B,IAGF+uG,gBAzNgB,YA0Nd,IAAMgC,EAAN,GAEML,EAAYtpG,eAAlB,GAQA,GAPA3G,KAAKgwG,gBAAgB,EAArB,IAFA,IAQAM,WAAoC,SAAAl3D,GAAE,OAAIA,OACtCzyC,EAAJ,UACE,OAAOyB,+CAAP,GAZ8C,IAcxCuE,EAAY3E,EAd4B,QAe1CmwD,EAAMxxD,EAAA,yBAA6B,SAAAguC,GAAC,OAAIA,YAAJ,KAC1C,WAAIwjB,EAGGxxD,yBAAP,QAHA,GAMFynG,kBA/OgB,YAgPd,GAAIznG,EAAJ,UACE,OAAOyB,iDAAP,GAFmC,IAI7BsoG,EAAuBzgB,EAJM,aAIfzlF,EAASylF,EAJM,KAKrC,MACE,MAAM,4CAAN,IAEF,IAAMprB,EAAal+D,EAAA,oBACjB,mBAAYw+B,iBAAZ,KAEF,KACE,OAAO0/B,EAET,IAAMtlE,EAASoH,0BAAf,GACA,OAAOA,qBAAwBpH,EAA/B,IAGF2xG,8BAjQgB,YAiQwD,IAApBH,EAAmB,uDAAJ,GACjE,OAAO/wG,KAAA,uCAAP,IAOFmxG,kBAzQgB,cA6Qb,IADDJ,EACA,uDADoB,GAEd/1C,EAAWr0D,EAAA,iBACf,mBACElD,yBAAeixB,EAAfjxB,UADF,KAGF,MACE,MAAM,sDAAN,+BAQF,OAJAstG,iCAA8CttG,yBAAe,EAA7DstG,QAIO/wG,KAAA,UAAP,IAGFoxG,uBA9RgB,cAkSb,IADDL,EACA,uDADgD,GAE1Cl4E,EAAK,eAAX,GAEA,OADAA,mBAAyB7O,sBAAYqnF,EAArCx4E,kBACO74B,KAAA,UAAP,IAGF2kB,UAxSgB,cA6Sb,IAFDosF,EAEA,uDAFe,GACf9oG,EACA,uDADgB,CAAEuC,KAAM+pC,GAElBy8D,EAAiB15F,0BAAvB,GACA,MACE,MAAM,wCAAN,IAEF,IAAM5W,EAAI,kCAERJ,GAFQ,EAGRkK,KAHQ,EAIRvC,kBAGF,OADAtB,mBACOA,cAAP,IAGFme,WA5TgB,YA6TVne,oBAAuBuQ,EAA3B,KACEvQ,uBAA0BuQ,EAA1BvQ,IAEFA,oBAAuBuQ,EAAvBvQ,MACAA,gBAGF2qG,UApUgB,YAqUd,OAAO3qG,oBAAuBuQ,EAA9B,KAGF+5F,WAxUgB,YAyUdtqG,uBAA0BuQ,EAA1BvQ,KAEF4qG,qBA3UgB,WA4Ud5qG,gBAEF6qG,iBA9UgB,WA+Ud7qG,gBAEF8qG,eAjVgB,WAkVd9qG,yBAQFoe,aA1VgB,YA2Vdpe,eAMF26B,eAjWgB,WAkWd36B,oBAGF+qG,iBArWgB,WAsWd/qG,gCAGFgrG,gBAzWgB,YA0Wd,OAAOvpG,uCAAP,IAGFwpG,mBA7WgB,YA8Wd,OAAOxpG,0CAAP,IAGFypG,qBAjXgB,YAkXd,OAAOzpG,4CAAP,IAGFi8E,wBArXgB,WAsXd,OAAOj8E,uBAAP,2BAEF0pG,gBAxXgB,YAyXd,OAAO1pG,uCAAP,IAEF2pG,kBA3XgB,WA4Xd,OAAO3pG,uBAAP,qBAEF+7E,0BA9XgB,WA+Xd,OAAO/7E,uBAAP,6BAEF4pG,oBAjYgB,WAkYd,OAAO5pG,uBAAP,uBAEF6pG,WApYgB,YAqYd,OAAO7pG,kCAAP,QAzgBe,QA4gBX,WACN,IAAM4S,EAAmB+jC,cAAzB,QAEA,MAAO,CACL9/B,MAAO,CACL,uBACE,OAAOjE,IAGXtU,QAAS,CACP+iD,OADO,cAEL,OAAOzpD,KAAA,sBAAP,IAGFkyG,oBALO,cAML,OAAOl3F,OAAsB,CAACM,EAA9B,KAGFP,mBATO,WAUL,OAAOC,EAAP,YA/hBW,SAoiBV,SAAArU,GAAI,MAAK,CAMhBwrG,kBANgB,YAOd,IAAKC,+BAAL,GACE,MAAM,UAAN,wDAIF,IAAMC,EAAN,EACMC,EAASD,EAAA,qDAGb,CAAE33F,OAAQzS,IAEZoqG,iBAEF1rE,uBApBgB,YAqBd,IACGhgC,EAAD,YADF,IAEEA,2BAEA,MAAM,UAAN,uDAEF3G,KAAKmyG,kBAAkBlqG,QA/jBR,OAkkBZ,SAAAtB,GAAI,MAAK,CACd4rG,wBADc,YAEZ,IAAMn9F,EAAN,EACMo9F,EACJp9F,aACAA,EAAA,oBAA2B,SAAArN,GACzB,OAAOA,YAAkB3E,EAAzB,WAIEqvG,EAAN,2BACEhvG,yBAAeL,EAAfK,QACF,MAAO,CACL,CACEypB,MADF,cAEE/V,QAAS,WACP/B,wBAAwC,CAAEhS,YAE5CoT,KAAMitE,MAER,CACEv2D,MADF,WAEEV,UAFF,EAGErV,QAAS,WACP/B,6BAEFoB,KAAMk8F,MAER,CACExlF,MADF,eAEEV,UAAWgmF,GAFb,EAGEr7F,QAAS,WACP/B,sBAEFoB,KAAMm8F,MAER,CACEzlF,MADF,aAEEV,SAFF,EAGErV,QAAS,WACP,IAAMy7F,EAAgBx1E,WACpBA,eAAepT,sBADjB,KAGMzgB,EAAMD,KAAZ,MACAspG,yBACAA,oBACE,YACEj7F,8BAMCvC,EAAL,YACEw9F,2BACAA,mBAEFA,kBACAx9F,mBAEFoB,KAAMq8F,YAMhB,OAAO,4BAAsC,CAE3CC,aAF2C,YAGzC,KAAc,OAE6BhM,GAF7B,GAEJoI,EAFI,sBAEoBvnG,EAFpB,uCAMZ,IAAKsP,cAAL,GACE,OAAOtP,EAGX,OAAOm/F,KChqBb,SAASiM,GAAqBvqG,EAA9B,GAKE,YAAIA,EAGJ,GAAIwqG,sBAAJ,IAA4B,WAC1B,IAAM5kF,EAAN,EACM6kF,EAAYC,uBAAlB,GACA,GAAIvD,0BAAJ,GAEE,IAF+B,IAAD,cAGvBwD,4BAAiB,kBAAM/kF,EAAN,MAGpB4E,KAFA5E,cAJ0B,KAErB4E,EAAT,EAAgBA,EAAI5E,EAApB,QAAqC,EAA5B4E,GAQX5E,WAAc,SAAAglF,GACZL,GAAqBK,EAArBL,MAdwB,QAgBrB,GAAIM,oBAAJ,IAA0B,WAC/B,IAAMtuG,EAAN,EACMkuG,EAAYC,uBAAlB,GACA,GAAIvD,0BAAJ,GAAgC,CAAC,IAAD,cAGvBwD,4BAAiB,kBAAMpuG,MAAN,OACpBA,aAFJ,IAAK,IAAL,KAAkBA,EAAlB,OAA+B,EAApB/F,GAMb+F,WAAY,SAAAqgC,GACV2tE,GAAqB3tE,EAArB2tE,MAZ6B,QAc1B,GAAIr8D,sBAAJ,GAA2B,KAExBk+C,EAAe0e,6BAFS,cAIhCvvG,2BAAmC,YAAqB,IAAD,mBAAlBwvG,EAAkB,KAAXC,EAAW,KAErDT,GAAqBvqG,EAAD,GAApBuqG,OAUS,SAASU,GAAU,GAG/B,IADDnpF,EACA,0DAC8CopF,GAD9C,GACQ9M,EADR,wBAC+BC,EAD/B,aAIMiI,EAA4BvpG,4BAAK,CACrC,CAAEshG,eADmC,mBAAvC,KAIM8M,EAAU9E,GAAoBv3F,EAApC,GACMs8F,EAAsB3N,GAAuB,EAAnD,GAIA,OAAO,qBACU,CACb57E,QAASwpF,GAAkB,EAAD,EADb,GAMbC,WAAYvuG,cAAYA,QANX,QAOb6P,QAAS7P,cAPI,GAQbm4B,gBARa,EASb9K,QAASrtB,cAAYA,QATR,QAUbs9F,mBAVa,EAWbC,yBAXa,EAYbiR,gBAAgB,IAbb,UAeK,SAAAptG,GAAI,MAAK,CACjByd,WAAY,IAAI,GAAJ,EAEVzd,wBAFU,IAGV,CACEqkG,mBAAoB,CAAEE,YAAa8I,MACnC5M,oBAAqB,KAGzB6M,sBAAuBl1D,kBATN,IAUjBznC,cAViB,EAWjBiL,WAAOniB,MA1BJ,OA4BE,SAAAuG,GAAI,MAAK,CACd,oBACE,OAAOsQ,WAAWtQ,wBAAlB,WAEFutG,eAJc,YAKZ,MAAM,cAAN,qBAA6BvtG,EAA7B,aAEF,iBACE,MAAM,YAAN,OAAmBA,EAAnB,aAEF,yBACE,MAAM,oBAAN,OAA2BA,EAA3B,iBAvCC,OA0CE,SAAAA,GAAI,MAAK,CACd,wBACE,OAAOA,EAAA,mBAAuB,SAAAyO,GAAO,OAAIA,EAAJ,SAEvC,uBAAwB,IAAD,EACfgtF,EAAc,IAAIxqE,IAAIn7B,gBAA5B,MACMukD,EAAS,IAAIshD,gBAAgBF,EAAnC,QACA,cAAOphD,QAAP,IAAOA,GAAP,UAAOA,MAAP,+BAAOA,kBAAP,QAjDC,SAoDI,SAAAr6C,GAAI,MAAK,CAChBonG,YADgB,WACD,IAAD,OACZhqG,qCACU,mCAAE/E,EAAF,iBAAiBA,aAAjB,kBADV+E,QAGI,mCAAE/E,EAAF,qBAAiBA,UAAY2H,cAAZ3H,gBAHrB+E,SAKW,YAAiB,IAAD,mBAAd/E,EAAc,KAAT+e,EAAS,KACvB,IAAK,IACK3I,EAAYgoB,WADlB,WAEFz2B,iCACA,SACAm2B,iDAGN6D,sBAAY,EAEVL,oBAAQ,WAAO,IAAD,iBACW35B,wBADX,eACZ,2BAA6D,CAAC,IAAD,yBAA9CoX,GAA8C,WAC3D,IACE,IAAM/e,EAAM2H,iBAAoBoX,EAAhC,MACAq5B,uBAA0Bha,KAAA,UAAe,CAAEhoB,QAAS2I,KACpD,SACIiZ,eAAJ,SAAuBA,QACrBm9E,8FAPM,mCAehBxzE,sBAAY,EAEVL,oBACE,WACE,GAAI35B,EAAJ,QAAkB,CAChB,IACMmgG,EAAW98E,sBAAYrjB,EAAZqjB,UADC,CAAE5lB,KAAM,SAE1BgwG,iCAEEh3E,KAAA,UAAe,CAAEhoB,QAAS0xF,KAG5B1vD,wCACczwC,EADdywC,YAEEha,KAAA,UAAe,CACbhoB,QAAQ,OAAD,IAAC,CAAD,sBAELhR,KAAK,GAAD,OAAK0iG,EAAL,wBAINngG,EAAJ,iBACE,qBADuB,GAGvBlK,6BAIN,CAAEy/B,MAAO,QAIf+1E,WAhEgB,YAiEd,IAAMoC,EAAa1tG,EAAnB,QAEA,GADAA,UAAeu2B,eAAfv2B,GACIA,EAAJ,QAEE,IACEosG,GAAqBpsG,EAAD,QAAe6pF,kBAAQ7pF,EAA3CosG,UACA,SAGA,MADApsG,YACM4b,EAGV,GACEviB,KAAKs0G,mBAAkB,IAG3BtR,mBAjFgB,YAkFdr8F,uBAEFo8F,yBApFgB,YAqFdp8F,6BAEF2tG,kBAvFgB,YAwFd3tG,oBAEForG,kBA1FgB,WA0FK,IACXjE,EAAmBnnG,EADT,uBAEZ4tG,EAAU,kCAEdnwG,KAAK,GAAD,OAAK0pG,EAAL,kBAA4B,IAAIxkG,MAAhC,oBAGNtJ,KAAKiyG,WAAWsC,IAElB1C,qBAnGgB,YAoGd,GAAIlrG,EAAJ,QAAkB,CAChB,IAAMmgG,EAAW1pE,WAAWA,eAAepT,sBAAYrjB,EAAvD,WACAmgG,SACA9mG,KAAKiyG,WAAWnL,KAIpB6K,gBA3GgB,YA4Gd,IAAM3yG,EAAM2H,iBAAoByO,EAAhC,MACAzO,kCAGFirG,mBAhHgB,YAiHd,IAAM5yG,EAAM2H,iBAAoByO,EAAhC,MACAgiC,2BACAzwC,mCAGF09E,wBAtHgB,WAuHd,GAAI19E,EAAJ,QAAkB,CAChB,IAAMmgG,EAAW1pE,WAAWA,eAAepT,sBAAYrjB,EAAvD,WACI6tG,EAAe,UAAM7tG,UAAN,KAAnB,WACA,GAAIA,6BAAJ,GAAsD,CACpD,IAAI8tG,EAAJ,EACA,GACED,EAAe,UAAM7tG,UAAN,yBAAf6tG,KACAC,WACO9tG,6BAHT,IAKFmgG,SACA9mG,KAAKiyG,WAAWnL,KAGpBgL,gBArIgB,YAsId,IAAM4C,EAAU/tG,iBAAhB,GACMguG,EAAqBv9D,qBAA3B,GACA,MACE,MAAM,6CAAN,qCAKFp3C,KAAKiyG,WAAW70E,cAAhB,UAEF+mD,0BAhJgB,WAiJd,GAAIx9E,EAAJ,QAAkB,CAChB,IAAM3H,EAAM2H,iBAAoBA,UAAhC,MACAA,8BAAoCqjB,sBAAYrjB,EAAhDA,YAGJqrG,oBAtJgB,WAuJd,IAAM4C,EAAmBx9D,qBAAqBzwC,EAA9C,oBACMkuG,EAAmBD,EACrBx3E,cADqC,QAAzC,GAGQh5B,EAASywG,EALG,KAMpBA,iBAA2BzwG,uBAA3BywG,iBACA70G,KAAKiyG,WAAW4C,IAGlBt4E,SAhKgB,YAiKd51B,eArNC,UAwNK,SAAAA,GAAI,MAAK,CACjBmuG,QADiB,GAEjB91F,MAAM,CACJ,CACEkO,MADF,OAEElV,UAAW,CACT,CACEkV,MADF,cAEE1W,KAFF,KAIEW,QAAS,YACP,IAAM49F,EAAe39D,qBAAqBzwC,EAA1C,YACA,GACEywC,qBAAqBzwC,EAArBywC,sBAEFhiC,wBAGJ,CACE8X,MADF,0BAEE1W,KAFF,KAGEW,QAAS,WACPxQ,0BApBL,mBAyBC2jB,EACA,CACE,CACE4C,MADF,QAEElV,UAAW,CACT,CACEkV,MADF,wBAEE1W,KAFF,KAIEW,QAAS,YACW/O,oBAAlB,GACAgiB,yBAGJ,CACE8C,MADF,sBAEE1W,KAFF,KAIEW,QAAS,YACW/O,oBAAlB,GACAgiB,kCA/CC,KAuDjBE,gBA/QG,SAiRI,SAAA3jB,GAAI,MAAK,CAEhBquG,WAFgB,YAGdruG,aAEFsuG,SALgB,YAMdtuG,WAOFuuG,WAbgB,YAcd,OAAOvuG,EAAA,WAAgB,CAAEumB,MAAF,EAAmBlV,UAAW,MAUvDm9F,WAxBgB,cAyBd,IAAMC,EACJvzG,IAAe8E,eAAf9E,EADF,EAGA,OADA8E,mBAAqC,CAAEumB,MAAF,EAAmBlV,UAAW,KAC5DrR,QAAP,QAQF0/D,aApCgB,cAqCd,IAAMlnD,EAAOxY,EAAA,YAAgB,SAAAkpD,GAAC,OAAIA,UAAJ,KAC9B,SAIO1wC,iBAAP,IAHExY,aAAgB,CAAEumB,MAAF,EAAmBlV,UAAW,CAACq9F,KACxC,IAaX1xB,aArDgB,gBAsDd,IAAMxkE,EAAOxY,EAAA,YAAgB,SAAAkpD,GAAC,OAAIA,UAAJ,KAC9B,MAEE,OADAlpD,aAAgB,CAAEumB,MAAF,EAAmBlV,UAAW,CAACq9F,KACxC,EAET,IAAMD,EACJvzG,IAAesd,mBAAftd,EADF,EAGA,OADAsd,0BACOA,YAAP,QASFslB,gBAvEgB,cAwEd,IAAI6wE,EAAU3uG,EAAA,YAAgB,SAAAkpD,GAAC,OAAIA,UAAY0lD,EAAhB,MAC/B,MAAc,CACZ,IAAMp9C,EAAMn4D,KAAKk1G,WAAWK,EAA5B,IACAD,EAAU3uG,QAAWwxD,EAArBm9C,GAJoD,IAMrCxxE,EANqC,YAOhD0xE,EAAY,CAACD,EAAnB,IAeA,OAdAA,oBAA0B,SAAAE,GACxBD,UACA,IAAIE,EAAK5xE,EAAA,MAAa,SAAA6xE,GAAE,MAAI,aAAiBA,UAArB,KACxB,MAAS,CACP,IAAMx9C,EAAMr0B,EAAA,KAAa,CAAE5W,MAAF,EAAmB4W,QAAS,KACrD4xE,EAAK5xE,EAAQq0B,EAAbu9C,GAEF,KAAM,YAAN,GACE,MAAM,+CAAN,uBAIF5xE,EAAU4xE,EAAV5xE,WAEKA,OAAP,IAYF8xE,gBAzGgB,gBA8Gd,IAAIN,EAAU3uG,EAAA,YAAgB,SAAAkpD,GAAC,OAAIA,UAAY0lD,EAAhB,MAC/B,MAAc,CACZ,IAAMp9C,EAAMn4D,KAAKk1G,WAAWK,EAA5B,IACAD,EAAU3uG,QAAWwxD,EAArBm9C,GAJF,IAMiBxxE,EANjB,YAOM0xE,EAAY,CAACD,EAAnB,IAgBA,OAfAA,oBAA0B,SAAAE,GACxBD,UACA,IAAIE,EAAK5xE,EAAA,MAAa,SAAA6xE,GAAE,MAAI,aAAiBA,UAArB,KACxB,MAAS,CACP,IAAMx9C,EAAMr0B,EAAA,KAAa,CAAE5W,MAAF,EAAmB4W,QAAS,KACrD4xE,EAAK5xE,EAAQq0B,EAAbu9C,GAEF,KAAM,YAAN,GACE,MAAM,+CAAN,uBAIF5xE,EAAU4xE,EAAV5xE,WAEFA,gBACOA,EAAP,Y,eClgBR,8C,8CAAe,sBAAAniC,EAAA,sDAEblF,gBAAkBA,gBAAlBA,SAFa,4C,sBCuCf,IAAMo5G,GAAuBtsF,gBAAK,kBAAM,mCAClCusF,GAAsBvsF,gBAAK,kBAAM,mCACjCwsF,GAAcxsF,gBAAK,kBAAM,mCAE/B,SAASysF,KAeP,OACE,6BACE,4BADF,6IAME,+EAEE,uBAAG5pF,KAAK,+CARZ,sBAaGu8D,gBACC,oCACE,6BADF,2BAEE,4BA/BM,CACZ,CAAC,+BADW,sBAEZ,CAAC,wBAFW,eAGZ,CAAC,6BAHW,qBAIZ,CAAC,+BAJW,cAKZ,CAAC,mCALW,cAMZ,CAAC,gCANW,uBAOZ,CAAC,4CAPW,uBAQZ,CAAC,sCARW,iBASZ,CAAC,qCATW,gBAUZ,CAAC,iCAVW,YAWZ,CAAC,iCAXW,YAYZ,CAAC,6BAZH,qBAgCW,KAAU,YAAmB,IAAD,mBAAhBstB,EAAgB,KAAV7xG,EAAU,OACF3H,OADE,SACnB2vB,EADmB,OACbgU,EADa,WAEC81E,WAFD,GAERvuG,GAFQ,oCAGrBsI,EAAOmc,aAAb,GACM40B,EAAS,iDAEb59C,OAAQ6yG,KAEV,OACE,wBAAIj3G,IAAKoF,GACP,uBAAGgoB,KAAI,4BAFX,SASN,oCACE,6BADF,0BAEE,4BACE,4BACE,uBAAGA,KAAK,wCAvCpB,0B,SAkDa+pF,G,iFAAf,iCAAAx0G,EAAA,sEAC4BqsB,MAD5B,4DACQC,EADR,iCAKU,UALV,sDAOuBA,EAPvB,qBAOQG,EAPR,OAUQgoF,EAAoBhoF,EAAA,aAAkB,SAAAjE,GAAC,OAAIA,EAAJ,OAV/C,kBAWSksF,EAAA,OAAqB,SAAAlsF,GAAC,OAAIisF,WAA2BjsF,EAA/B,SAX/B,6C,sBAgBA,IAAMmsF,GAAgB,cACb,CACLxC,WAAYvuG,cAAYA,QADnB,QAEL0xC,aAAc1xC,cAAYA,QAFrB,QAGLwzC,SAAUxzC,cAAYA,QAHjB,QAIL69F,SAAU79F,cAAYA,QAAZA,UALQ,UAOV,iBAAO,CACfgxG,cADe,EAEfC,oBAFe,EAGfC,kBAHe,EAIflP,oBAJe,EAKfmP,qBALe,EAMfC,eANe,GAOf5sF,eAPe,GAQf6sF,kBARe,EASfC,iBATe,EAUfC,IACEr6G,yBACA,IAAIA,OAAJ,iBAZa,sBAafs6G,IACEt6G,yBACA,IAAIA,OAAJ,2CAtBgB,OAwBb,SAAAkK,GAAI,MAAK,CACd,oBAAqB,IAAD,EAClB,iBAAOA,EAAP,iCAAOA,aAAP,WAGF,qBAAsB,IAAD,EACnB,iBAAOA,EAAP,iCAAOA,aAAP,aAGF,kBAAmB,IAAD,EAChB,iBAAOA,EAAP,iCAAOA,aAAP,UAGF,mBAAoB,IAAD,EACjB,iBAAOA,EAAP,iCAAOA,aAAP,WAGF,YACE,OAAO3G,KAAA,gBAAuB2G,EAA9B,aAGF,YACE,OAAOA,eAAoBA,EAA3B,cAGF,oBACE,QACIA,EAAF,gBAAyBA,EAAzB,mBAAmDA,EADrD,cAIF,mBACE,QAASA,EAAF,eAAwBA,EAA/B,oBAvDgB,SA0DX,SAAAA,GAAI,MAAK,CAChBqwG,gBADgB,YAEdrwG,kBAEFswG,eAJgB,YAKdtwG,iBAEFuwG,gBAPgB,YAQdvwG,kBAEFwwG,kBAVgB,YAWdxwG,oBAEFywG,kBAbgB,YAcdzwG,oBAEF0wG,kBAhBgB,YAiBd1wG,oBAGF2wG,gBApBgB,YAqBd3wG,kBAEF4wG,kBAvBgB,YA4Bd5wG,oBAEF6wG,0BA9BgB,YA+Bd7wG,yBAzFgB,SA4FX,SAAAA,GAAI,MAAK,CACV8wG,aADU,YAC6C,OAAD,6HAElDC,EAAe,IAAI5sE,GAAJ,EAAiB1nC,EAFkB,UAGxDs0G,+BAHwD,SAI3BA,EAJ2B,cAIlDf,EAJkD,OAKxDhwG,oCALwD,gDAOxDm2B,oBACAn2B,uBARwD,4DAWtDgxG,oBAZU,YAY0D,OAAD,6HAE/DD,EAAe,IAAI5sE,GAAJ,EAAiBpjC,kBAF+B,KAGrEgwG,+BAHqE,SAI/CA,EAJ+C,cAI/D9sF,EAJ+D,OAKrEjkB,oCALqE,gDAOrEm2B,oBACAn2B,uBARqE,4DAanEixG,mBAzBU,cA4Bb,IAAD,wIAEkClwG,EAFlC,iBAEUqiB,OAFV,mDAIYosF,GAJZ,0GAOU,sBAPV,WAQIxvG,+BARJ,wBAUIA,oBAAuB,CACrBe,KADqB,EAErBmwG,OAFqB,UAGrBx8F,OAAQ0O,IAbd,0DAiBE+S,oBACAn2B,uBAlBF,6DAsBImxG,YAlDU,WAkDK,IAAD,yIACqBnxG,EADrB,WACVmtG,OADU,yCAGT,wBAAa,CAAE1sG,IAAK0sG,IAApB,SAHS,8BAEZ1wG,EAFY,2BAKZ20G,EAAY,IAAIngF,IAAIk8E,EAAYr3G,gBALpB,MAMlBu7G,GAAgB50G,EANE,GASd20G,aAAuBt7G,gBATT,+BAUVw7G,EAAgB70G,WAVN,6CAYN+yG,GAZM,wFAedxvG,oBAAuB,CACrBe,KADqB,EAErBmwG,OAFqB,SAGrBx8F,OAAQ48F,IAlBI,yCAqBR,eArBQ,WAsBdtxG,uBAtBc,iDAyBV,eAzBU,WA0BhBA,uBA1BgB,+CA8BduxG,2BAhFU,WAgFoB,IAAD,mIAC3BC,EAAa/D,uBADc,WAE3BtvB,EAASn+E,EAAD,8BAFmB,0BAMzByxG,EAAch7E,uBANW,GAO3B0nD,IAAUszB,EAPiB,mCAQvB,qBARuB,+CAY7BzxG,EAZ6B,4BAa/BA,qBACM0jG,EAAU,IAAI/1E,SAAQ,cACtB3tB,EAAJ,MACEA,gBAAqB,SAAA0xG,GACnB/sE,EAAQ+sE,EAAR/sE,QAGJnwB,YAAW,kBAAMowB,MAAjBpwB,QApB6B,qCAwBvB/Y,EAxBuB,iBA0BvBuE,EAAA,qDAAqCrG,GAAIoF,UA1BlB,mFAiC3B,UAjC2B,iGAoC7B4yG,mBApHU,WAoHY,IAAD,mIAEnBC,EAAW,SAAC,EAAD,KAKf,OAAQ/rG,iBAAD,QAAP,GAPuB,6CAWMgsG,GAAsB,GAAD,OAC/CD,EAAS5xG,EAAD,0BAZY,qCAW2B,QAElDA,gBAFkD,GAGlDA,YAduB,kBAWnB8xG,EAXmB,OAiBnBrjG,EAAUgoB,WAAWs7E,yBAjBF,aAmBnB,uDAAsCp4G,GAAIoF,UAnBvB,8CAsBrBizG,wBA1IU,WA0IiB,IAAD,+HACxBvjG,EAAUgoB,WAEds7E,yBAAe/xG,kCAHa,eAKxB,uDAAsCrG,GAAIoF,UALlB,8CAQ1BkzG,qBAlJU,WAkJc,IAAD,+HAErBxjG,EAAUgoB,WAAWz2B,+BAFA,cAGrB,gDAA6ByO,EAA7B,aAA8C9U,GAAIoF,UAH7B,8CAMvBqoG,YAxJU,WAwJK,IAAD,yIAEhB8K,EAKElyG,EAPc,aAGhBmyG,EAIEnyG,EAPc,eAIhBoyG,EAGEpyG,EAPc,cAKhBqyG,EAEEryG,EAPc,YAMhBmtG,EACEntG,EAPc,YAUZouG,EAAe39D,wCAVH,MAYhBA,sDAZgB,kBAiBV,EAjBU,4EAmBhBta,oBACAn2B,uBApBgB,2BAwBlBg6B,sBAAY,EAEVL,mBAAO,sBAAC,sBAAA3+B,EAAA,mEAEAgF,EAFA,sEAIM,EAJN,2FAMM,EANN,kGAQM,EARN,+FAUM,EAVN,iEAWSA,EAXT,oCAaM,UAbN,uCAgBAA,sBAhBA,QAkBEA,EAAJ,MACEA,gBAAqB,SAAA0xG,GACnB,IAAM/yE,EACJlI,WAAWg3E,mCAAXh3E,eADF,GAGIkI,OAAW+yE,EAAf,MACM1xG,EAAJ,KACEA,uBAzBN,0DAgCJm2B,oBACAn2B,wBAjCI,4DA1BQ,gEAkEjB,SAASsyG,GAAO,GAInB,IAAD,IAHDC,wBAGC,MAHkB5vG,WAGlB,EAGKoa,EAAO,SAAC42D,GAAD,OACXA,gBADW,GAHZ,EAMgB6oB,aAAc,SAN9B,MAMM//F,EANN,sBAOiB+/F,aAAc,UAP/B,MAOM/tF,EAPN,sBAQkB+tF,aAAc,WARhC,MAQMpqD,EARN,sBASkBoqD,aAAc,WAThC,MASMC,EATN,oBAWK+V,EAAS7C,GAAA,OAAqB,CAClCxC,WAAYpwF,EADsB,GAElCuzB,aAAcvzB,EAFoB,GAGlCq1B,SAAUr1B,EAHwB,GAIlC0/E,SAAU1/E,EAAK0/E,KAGjB,OACE,sBACE+V,OADF,EAEED,iBAFF,EAGEE,oBAAqBhkG,IAK3B,IAAMikG,GAAW30G,qBACf,YAQO,IAPLy0G,EAOI,EAPJA,OACAD,EAMI,EANJA,iBACAE,EAKI,EALJA,oBAKI,EACoBjW,aAAc,WADlC,MACKmW,EADL,oBAEI1C,EAAuDuC,EAF3D,aAEkBtC,EAAyCsC,EAF3D,YAE+Bh7D,EAA4Bg7D,EAF3D,MAEsC1C,EAAqB0C,EAF3D,mBAG2B7lG,qBAH3B,mBAGG+yB,EAHH,KAGOkzE,EAHP,OAIsBjmG,mBAJtB,uBAIGiP,EAJH,KAIUga,EAJV,OAKsCjpB,mBALtC,uBAKGkmG,EALH,KAKkBC,EALlB,KAOJ7lG,qBAAU,WACR,IAAK,IAED+iG,EAMEwC,EARF,eAGApvF,EAKEovF,EARF,eAIA/V,EAIE+V,EARF,SAKA5R,EAGE4R,EARF,eAMAzC,EAEEyC,EARF,gBAOArF,EACEqF,EARF,WAUF,KAAW,CAIT,IAAM7hG,EAAgB,IAAI,GAAJ,sBACjB,QAAgB,SAAAoiG,GACjB,MAAO,CACL5vF,OAAQ,IADH,EAELue,SAAU,CAAErd,QAAQ,QAJJ,YAOjB2rF,EAAA,KAAmB,gBAAW+C,EAAX,SAAcluE,EAAd,mBAAgC,CACpD1hB,OAAQ,IAD4C,EAEpD0hB,kBATkB,YAWjBzhB,EAAA,KAAmB,gBAAW2vF,EAAX,SAAcluE,EAAd,mBAAgC,CACpD1hB,OAAQ,IAD4C,EAEpD0hB,oBAGJl0B,4BAEA,IAAMqiG,EAAmBC,GAAwB,IAAjD,GAKA,GAAIT,EAAJ,eAA2B,CAAC,IAAD,MACnB/uF,EAAYuvF,EAAA,OAChB,CACEtvF,QADF,EAEEqT,gBAFF,GAGE9K,QAASinF,GAHX,QAIE/F,cAEF,CAAEx8F,kBAeJ,GAbA8S,iEAEE,CAAE5f,KAAM,wBAEN,UAAC2uG,EAAD,uCAACA,EAAD,sCAACA,EAAD,wBAACA,EAAL,gBACE/uF,oEAQF,EACEA,EADgB,oBAIZA,EAAJ,SACEA,kDAC4BwsF,EAD5BxsF,kOAOG,GAAIssF,IAAJ,EACL,IACEtsF,aAAqB+uF,EAArB/uF,iBACA,SAAa,IAAD,EACZ0S,iBACA1S,sBACA,IAAM0vF,GAAgBnvE,WAAD,oDAArB,IAGA,UAAAvgB,EAAA,sEAEI0vF,uBACOA,UADPA,+BAFJ,QAQG,CACL,IAAMC,EAAwB3vF,UAA9B,gBACA,OAAI2vF,QAAJ,IAAIA,OAAJ,EAAIA,EAAJ,QACMA,eAAJ,GACE3vF,sBAOJA,IACC3mB,yBACC2mB,UADa,cAFjB,sB/M1jBL,SAAP,gC+MikBc4vF,CAAkB,EAAD,EAAjBA,G/M/fP,SAAP,8B+MogBcC,CAAiB7vF,EAAjB6vF,IAGF3iG,kBACAA,cACAiiG,EA/EyB,GAkFzBD,YAGJ,SACA,IAAMpqC,EAAQl4C,gBADJ,sDAMV,GACEuF,EAAS,6BAAD,OAA8B2yC,EAAtC3yC,KACAk9E,EAAiBvqC,EAAjBuqC,KAEAl9E,EAASvF,kBAATuF,MAEFO,oBAED,CAAC,EAAD,UAzIHlpB,IAmJA,IAoFQ,EApFF+2B,EAAMksE,GAAZ,EAEA,KACE,OACE,6BACE,qBADF,MAEGlsE,EACC,yBACEx4B,MAAO,CACLmP,OADK,kBAELzF,SAFK,OAGLuD,UAHK,IAIL/iB,QAJK,EAKLkS,OALK,EAMLyB,gBAAiB,YAPrB,aAWGwpG,EACC,uEAEE,yBACErnG,MAAO,CACLhC,WADK,YAELmR,OAFK,kBAGL/S,OAAQ,KAGT6uB,eAAeA,WAAfA,QAVO,KAZd,MAHR,MAmCF,GAAI+7E,EAAJ,eAA2B,CACzB,IAAMhhG,EAAc,WAClBghG,6BAEF,MAAO,YAAAA,EAAA,sBACL,8BAAUzhG,SAAU,+BAClB,sBACEwiG,UAAS,sBAAE,4BAAAv4G,EAAA,6DACHyT,EAAUgoB,WACdA,eAAe+7E,iBAFR,gBAMHA,EAAA,qDACU74G,GAAIoF,UAPX,UAUTyS,IAVS,2CAYXgiG,SAAU,WACRhB,sBACAhhG,KAEFkD,OAAQ89F,iBAAsB99F,UAIlC,8BAAU3D,SAAU,+BAClB,sBACEwiG,UAAS,sBAAE,4BAAAv4G,EAAA,6DACHyT,EAAUgoB,WACdA,eAAe+7E,iBAFR,gBAIHA,eAJG,UAKTA,sDAAuC74G,GAAIoF,UAC3CyS,IANS,2CAQXgiG,SAAU,WACRC,KACAjiG,KAEFkD,OAAQ89F,iBAAsB99F,UAKtC,UACM,UAACgrB,EAAD,8BAACA,EAAL,SAOO,sBAAS/uB,cAAe+uB,IAL3B,8BAAU3uB,SAAU,4CAClB,sBAAazH,KAAMo2B,EAAnB,UAAiCvlB,eAAgBs5F,MAMlD,uBAAP,SAIJ,SAASpC,GAAgB50G,EAAzB,GACE,qBAAWA,EACT,cAAkBW,YAAlB,kBAAuC,CAAlC,IAAM/E,EAAG,EAAT,GACH,kBAAWoE,EAAP,GACF40G,GAAgB50G,EAAD,GAAf40G,GACK,QAAIh5G,IACToE,UAAiB20G,EAAjB30G,OAMR,IAAMi3G,GAAmC,SAAClpG,GACxC,OACE,qDACE8Q,gBADF,gBAEEnB,eAAgBs5F,IAHpB,KAkBF,UAVsB,SAAC,GAAwD,IAAtDlB,EAAqD,EAArDA,iBACvB,OACE,oCAAeoB,kBAAmBD,IAChC,4BACE,sBAAQnB,iBAAkBA,Q,yHCzuBbvwF,E,kDAOnB,WAAY0nB,GAIT,MAID,GAJC,qBACD,cAAMA,IAXRntB,gBAUG,IARHJ,kBAQG,IANHmlB,aAA8B,GAQ5B,EAAK/kB,WAAamtB,EAAMntB,WACxB,EAAKJ,aAAeutB,EAAMvtB,cACrB,EAAKI,WACR,MAAM,IAAI1hB,MAAJ,0CAA6C,EAAK4C,OAE1D,IAAK,EAAK0e,aACR,MAAM,IAAIthB,MAAJ,6CAAgD,EAAK4C,OAE7D,IAAKosC,0BAAgB,EAAK1tB,cAActY,KAAM,CAC5C,IAAMpG,EAAO,EAAK0e,aAAe,EAAKA,aAAa1e,KAAO,UAC1D,MAAM,IAAI5C,MAAJ,UAAa4C,EAAb,4BAZP,S,kDAgBH,SAAeuT,GACb3X,KAAKioC,aAAa/oC,KAAKyY,O,GA5BY44B,M,+FCDlBpnB,E,kDAYnB,WAAYknB,GAQT,MAOD,GAPC,qBACD,cAAMA,IApBRjnB,aAmBG,IAjBHtG,kBAiBG,IAfHy3F,sBAeG,IAZHljG,oBAYG,IAVH6L,gBAUG,EAED,EAAKkG,QAAUinB,EAAMjnB,QACrB,EAAKmxF,iBAAmBlqE,EAAMkqE,iBAC9B,EAAKz3F,aAAeutB,EAAMvtB,aAC1B,EAAKI,WAAamtB,EAAMntB,WACxB,EAAK7L,eAAiBg5B,EAAMh5B,gBACvB,EAAKA,eACR,MAAM,IAAI7V,MAAJ,+CAAkD,EAAK4C,OAE/D,IAAK,EAAK8e,WACR,MAAM,IAAI1hB,MAAJ,2CAA8C,EAAK4C,OAX1D,S,iBApBmCmsC,I,iCCLxC,kGAIO,SAASiqE,EAAYrpG,GAC1B,OACE,kBAAC,IAAYA,EACX,0BAAMkB,EAAE,gIAsBP,SAASooG,EAActpG,GAC5B,OACE,kBAAC,IAAYA,EACX,0BAAMkB,EAAE,wR,+EChCgBk+B,EAK5B,cAAwC,IAA1BnsC,EAA0B,EAA1BA,KAA0B,yBAFxCA,KAAO,GAGLpE,KAAKoE,KAAOA,I,uRCqBVoO,EAAYC,YAAW,CAC3BkC,MAAO,CACL9S,SAAU,QACV+S,UAAW,OACXw8D,UAAW,SAEXxgE,SAAU,GACVR,UAAW,GACXqyF,SAAU,oBACVrjF,UAAW,oBACXnK,IAAK,EACL1U,KAAM,EAENuU,QAAS,GAEX4lG,sBAAuB,CACrB74G,SAAU,WACVrB,MAAO,GACPyU,IAAK,MACL1C,UAAW,mBACXlW,QAAS,EACTwtB,aAAc,GACdlS,QAAS,iBAkBb,SAASgjG,EAAsBxpG,GAC7B,IAEI0yB,EACArX,EAIAhW,EAPE7C,EAAUnB,IACRhI,EAAS2G,EAAT3G,KAOR,GAJI,YAAa2G,IACX0yB,EAAsB1yB,EAAtB0yB,QAASrX,EAAarb,EAAbqb,UAGF,YAAThiB,EACFgM,EAAO,kBAAC,IAAD,CAAgB1G,MAAM,gBACxB,GAAa,aAATtF,EACT,GAAIq5B,EAAS,CACX,IAAM/zB,EAAQ0c,EAAW,UAAY,YACrChW,EAAO,kBAAC,IAAD,CAAc1G,MAAOA,SAE5B0G,EAAO,kBAAC,IAAD,CAA0B1G,MAAM,gBAEpC,GAAa,UAATtF,EACT,GAAIq5B,EAAS,CACX,IAAM/zB,EAAQ0c,EAAW,UAAY,YACrChW,EAAO,kBAAC,IAAD,CAAwB1G,MAAOA,SAEtC0G,EAAO,kBAAC,IAAD,CAA0B1G,MAAM,WAG3C,OAAO,yBAAKmD,UAAWU,EAAQ+mG,uBAAwBlkG,GA+FzD,IAAMokG,EAAWthG,IAAMC,YAAW,SAACpI,EAAsBkF,GAAQ,MACjB/C,qBADiB,mBACxDunG,EADwD,KACvCC,EADuC,OAEnBxnG,qBAFmB,mBAExDynG,EAFwD,KAExCC,EAFwC,OAGrB1nG,oBAAS,GAHY,mBAGxD2nG,EAHwD,KAGzCC,EAHyC,OAIT5nG,qBAJS,mBAIxD6nG,EAJwD,KAInCC,EAJmC,OAK/B9nG,qBAL+B,mBAKxDzR,EALwD,KAK9Cw5G,EAL8C,KASzDC,EAAW5nG,mBACXC,EAAUnB,IAGdwF,EAME7G,EANF6G,UACAQ,EAKErH,EALFqH,gBACAhB,EAIErG,EAJFqG,KACAmB,EAGExH,EAHFwH,QACAT,EAEE/G,EAFF+G,SAjB6D,EAmB3D/G,EADF8D,WAlB6D,SAqB/DrB,qBAAU,WACH4D,IACHsjG,OAAmB16G,GACnB46G,OAAkB56G,MAEnB,CAACoX,IAEJ5D,qBAAU,WACR,IACI2nG,EADEC,EAAsBhkG,GAAQC,QAAQojG,GAW5C,OATIW,IAAwBP,EAC1BM,EAAQpgG,YAAW,WACjB+/F,GAAiB,KAChB,MACOM,GAAuBP,IACjCM,EAAQpgG,YAAW,WACjB+/F,GAAiB,KAChB,MAEE,WACL9/F,aAAamgG,MAEd,CAACN,EAAezjG,EAAMqjG,IAEzBjnG,qBAAU,WACR,GAAIsE,EAAU,CACZ,IAAMgiB,EAAQhiB,EAAyBiiB,wBACnCt4B,GAEAq4B,EAAKjlB,MAAQpT,EAASoT,KACtBilB,EAAK35B,KAAO25B,EAAK19B,QAAUqF,EAAStB,MAKtC86G,EAAY,CAAEpmG,IAAKilB,EAAKjlB,IAAK1U,KAAM25B,EAAK35B,KAAO25B,EAAK19B,aAE5CqF,GACVw5G,EAAY,MAEb,CAACx5G,EAAUqW,IAEd,IAAMujG,EAAmBzjG,EAAUkS,MACjC,SAAAmrF,GAAQ,MACN,YAAaA,GACK,aAAlBA,EAAS7qG,MACS,UAAlB6qG,EAAS7qG,QAEPkxG,EAAU1jG,EAAUkS,MACxB,SAAAmrF,GAAQ,MAAI,SAAUA,GAAYA,EAAS7+F,QAEvCmlG,EAAmC,GACrCF,IACFE,EAAcx/F,aAAe,IAS/B,IAAMy/F,EACJ,oCACE,kBAAC,IAAD,CAAUC,cAAerkG,IAASyjG,GAC/BjjG,EACEs7C,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAWA,EAAE8mF,UAAY,IAAMn6G,EAAEm6G,UAAY,MAClD/2G,KAAI,SAACswG,EAAUl9C,GACd,GAAsB,YAAlBk9C,EAAS7qG,KACX,OAAO,kBAAC,IAAD,CAASxL,IAAG,kBAAam5D,GAAO99C,UAAU,OAEnD,GAAsB,cAAlBg7F,EAAS7qG,KACX,OACE,kBAAC,IAAD,CAAexL,IAAG,oBAAeq2G,EAASnoF,MAAxB,YAAiCirC,IAChDk9C,EAASnoF,OAIhB,IAAI1W,EAAO,KACPulG,EAAgB,KACpB,GAAI1G,EAAS7+F,KAAM,CACjB,IAAMzE,EAAOsjG,EAAS7+F,KACtBA,EACE,kBAAC,IAAD,KACE,kBAACzE,EAAD,OAIF,YAAasjG,EACf0G,EAAgB,kBAACpB,EAAD,CAAuBnwG,KAAK,YAE1B,aAAlB6qG,EAAS7qG,MACS,UAAlB6qG,EAAS7qG,OAETuxG,EACE,kBAACpB,EAAD,CACEnwG,KAAM6qG,EAAS7qG,KACfq5B,QAASwxE,EAASxxE,QAClBrX,SAAU6oF,EAAS7oF,YAIzB,IA9CW9T,EA8CLvB,EACJ,YAAak+F,GA/CJ38F,EA+C2B28F,EAASl+F,QA9ChD,SAACrD,GACN0E,EAAgB1E,EAAO4E,UA6CyCtY,EAC1D,OACE,kBAAC,IAAD,CACEpB,IAAKq2G,EAASnoF,MACd/a,MAAOwpG,EACPjlG,SAAUyhD,IAAQgjD,EAClBhkG,QAASA,EACT8iB,YAAa,SAAAjD,GACPA,EAAEna,gBAAkBquB,SAAS8wE,gBAC/BhlF,EAAEna,cAAco/F,QAChBb,EAAuBjjD,IAErB,YAAak9C,EACX0F,IAAmB5iD,IACrB2iD,EAAmB9jF,EAAEna,eACrBm+F,EAAkB7iD,KAGpB2iD,OAAmB16G,GACnB46G,OAAkB56G,KAGtBua,UAAW,SAAAqc,GACT,GAAc,cAAVA,EAAEh4B,KAAiC,WAAVg4B,EAAEh4B,IAC7B2Z,GAAWA,EAAQqe,EAAG,sBACjB,GAAc,YAAVA,EAAEh4B,IACXo8G,EAhKpB,SAA8BpjG,EAAuBkkG,GACnD,OAAOC,wBACLnkG,EAAUsjC,MAAM,EAAG4gE,IACnB,SAAA7G,GAAQ,MACY,YAAlBA,EAAS7qG,MACS,cAAlB6qG,EAAS7qG,OACR6qG,EAAS7oF,YA0J2B4vF,CAAqBpkG,EAAWmgD,SAClD,GAAc,cAAVnhC,EAAEh4B,IAAqB,CAChC,IAAM2C,EAjL1B,SAA0BqW,EAAuBkkG,GAC/C,IAAM/jD,EAAMngD,EACTsjC,MAAM4gE,EAAa,GACnBt0E,WACC,SAAAytE,GAAQ,MACY,YAAlBA,EAAS7qG,MACS,cAAlB6qG,EAAS7qG,OACR6qG,EAAS7oF,YAEhB,OAAa,IAAT2rC,EACKA,EAEF+jD,EAAa,EAAI/jD,EAqKIkkD,CAAiBrkG,EAAWmgD,GACtCijD,EAAuBz5G,OACd,YAAa0zG,IACR,eAAVr+E,EAAEh4B,KAAkC,UAAVg4B,EAAEh4B,MAC9B87G,EAAmB9jF,EAAEna,eACrBm+F,EAAkB7iD,GAClB+iD,GAAiB,MAIvB1uF,SAAU/U,QAAQ49F,EAAS7oF,WAE1BhW,EACD,kBAAC,IAAD,CACEvJ,QAASooG,EAASnoF,MAClB/f,UAAWkoG,EAASiH,SACpBxrG,MAAO4qG,IAAYrG,EAAS7+F,OAE7BulG,OAKV/jG,EAAUjT,KAAI,SAACswG,EAAUl9C,GACxB,IAAIr0B,EAAU,KAgBd,MAfI,YAAauxE,IACfvxE,EACE,kBAAC82E,EAAD,CACE57G,IAAKq2G,EAASnoF,MACdhV,SAAU2iG,EACVrjG,KAAMyjG,GAAiBF,IAAmB5iD,EAC1Cx/C,QAAS,WACPuiG,GAAiB,GACjBJ,OAAmB16G,IAErBoY,gBAAiBA,EACjBR,UAAWq9F,EAASvxE,WAInBA,MAKb,OAAI7uB,EACK2mG,EAIP,kBAAC,IAAD,CAAMW,GAAI/kG,EAAMrF,MAAO,CAAEqqG,gBAAiB,SAAWnmG,IAAKA,GACxD,kBAAC,IAAD,CACEhB,UAAW,EACXgB,IAAKilG,EACLroG,UAAWU,EAAQgB,MACnBxC,MAAK,eAAOtQ,IAEX+5G,OAoCMvjG,IAtBf,SAAclH,GAAkB,IACtBqG,EAAwDrG,EAAxDqG,KAAMmB,EAAkDxH,EAAlDwH,QAASX,EAAyC7G,EAAzC6G,UAAWQ,EAA8BrH,EAA9BqH,gBAAoBiB,EADxB,YACkCtI,EADlC,kDAG9B,OACE,kBAAC,IAAD,eACEsrG,mBAAoB,EACpBjlG,KAAMA,EACNmB,QAASA,EACT+jG,cAAe,CAAEC,WAAW,IACxBljG,GAEJ,kBAACmhG,EAAD,CACEpjG,KAAMA,EACNmB,QAASA,EACTX,UAAWA,EACXQ,gBAAiBA,EACjBvD,KAAG,O,2gBCvIM06B,GAzRV,SAASd,EAAWL,GACzB,OAAQA,GAAS,IAAIY,MAAM,iBAEtB,SAASwtE,EACdC,EACA9tE,EACA8iB,GAKA,IAHA,IAAIirD,EAAa,EACbC,EAAY,EACV/sE,EAAyB,GACtBhd,EAAI,EAAGA,EAAI6pF,EAAIt9G,OAAS,EAAGyzB,GAAK,EAAG,CAC1C,IAAMg8B,GAAO6tD,EAAI7pF,GACX48B,EAAKitD,EAAI7pF,EAAI,GAInB,GAHW,MAAP48B,GAAqB,MAAPA,GAAqB,MAAPA,IAC9BmtD,GAAa/tD,GAEJ,MAAPY,EACF5f,EAAW9wC,KAAK,CACdnB,MAAO++G,EACPtyG,KAAM,YACN0lC,KAAM,GAAF,OAAK8e,GACTzvD,OAAQ,IAEVw9G,GAAa/tD,OACR,GAAW,MAAPY,EACT5f,EAAW9wC,KAAK,CACdnB,MAAO++G,EACPtyG,KAAM,WACN0lC,KAAM,IACN3wC,OAAQyvD,SAEL,GAAW,MAAPY,EACT5f,EAAW9wC,KAAK,CACdnB,MAAO++G,EACPtyG,KAAM,OACN0lC,KAAM,IACN3wC,OAAQyvD,SAEL,GAAW,MAAPY,EAAY,CAIrB,IAHA,IAAMtnC,EAAIymB,EAAIuM,MAAMyhE,EAAWA,EAAY/tD,GACrCguD,GAAQ,OAAJnrD,QAAI,IAAJA,OAAA,EAAAA,EAAMvW,MAAMyhE,EAAWA,EAAY/tD,KAAQ,GAE5ClgB,EAAI,EAAGA,EAAIkgB,EAAKlgB,IACvBkB,EAAW9wC,KAAK,CACdnB,MAAO++G,EAAahuE,EACpBtkC,KAAM,WACN0lC,KAAM5nB,EAAEwmB,GACR+iB,KAAMmrD,EAAEluE,GACRvvC,OAAQ,IAGZw9G,GAAa/tD,MACG,MAAPY,EACT5f,EAAW9wC,KAAK,CACdnB,MAAO++G,EACPtyG,KAAM,WACN0lC,KAAM,IAAF,OAAM8e,GACVF,QAASE,EACTzvD,OAAQ,IAEM,MAAPqwD,IACT5f,EAAW9wC,KAAK,CACdnB,MAAO++G,EACPtyG,KAAM,WACN0lC,KAAM,IAAF,OAAM8e,GACVF,QAASE,EACTzvD,OAAQ,IAEVw9G,GAAa/tD,GAGJ,MAAPY,GAAqB,MAAPA,GAAqB,MAAPA,IAC9BktD,GAAc9tD,GAGlB,OAAOhf,EAOF,SAASitE,EACdC,EACAtuE,EACAuuE,EACApuE,EACA8iB,GAEA,IAAMurD,EAA8B,GAChCvoF,EAAiB,CAAE92B,MAAO,EAAGmyC,KAAM,GAAI3wC,OAAQ,EAAGiL,KAAM,YACtD6yG,EAAQF,EAAgBryF,QAAO,SAAA0jB,GAAK,MAAmB,SAAfA,EAAMhkC,QAChD8yG,EAAY,EACZC,EAAqB,EACrBC,EAAgB,EAChBC,EAAc,EAMlB,SAASC,IACPN,EAAgBl+G,KAAK21B,GAGrBA,EAAO,CACL92B,MAAO82B,EAAK92B,MAAQ82B,EAAKt1B,OACzBA,OAAQ,EACR2wC,KAAM,GACN1lC,KAAM,YAIV,SAASmzG,EAAsBC,GAG7B,IAFA,IAAIC,EAAiBN,EACjBO,EAAYN,EAEVxqF,EAAIsqF,EACRtqF,EAAI4b,EAASrvC,QAAUu+G,GAAaF,EAC5BN,EAARtqF,GAAK,EACL,CACA,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,EAChBiuD,GAAkB7uD,EACF,MAAPY,GAAqB,MAAPA,GAAqB,MAAPA,EACrCkuD,GAAa9uD,EACG,MAAPY,IACTiuD,GAAkB7uD,EAClB8uD,GAAa9uD,GAMjB,OAHAuuD,EAAqBM,EACrBL,EAAgBM,EAETD,GAAkBC,EAAYF,GAKvC,IADA,IAAMG,EAAKb,EAAShuC,MAAM,2BAA6B,GAC9Cl8C,EAAI,EAAGA,EAAI+qF,EAAGx+G,OAAQyzB,IAAK,CAClC,IAAMgrF,EAAQD,EAAG/qF,GACjB,GAAIgrF,EAAM9uC,MAAM,OACdr6C,EAAK92B,OAAS6nB,SAASo4F,EAAO,SACzB,GAAIA,EAAM9uC,MAAM,OACrBr6C,EAAKt1B,OAASy+G,EAAMz+G,OAAS,EAC7Bs1B,EAAKqb,KAAO,IACZrb,EAAKrqB,KAAO,WACZqqB,EAAKka,IAAMivE,EAAMC,UAAU,GAC3BP,SACK,GAAIM,EAAM9uC,MAAM,WAErB,IAAK,IAAIpgC,EAAI,EAAGA,EAAIkvE,EAAMz+G,OAAQuvC,GAAK,EAAG,CAGxC,IAFAja,EAAKt1B,OAAS,EAEPk+G,EAAcJ,EAAM99G,QAAQ,CACjC,IAAM+sC,EAAW+wE,EAAMI,GACvB,KAAI5oF,EAAK92B,OAASuuC,EAASvuC,OAIzB,MAHA82B,EAAK92B,OAASuuC,EAAS/sC,OACvBk+G,IAKJ,IAAM/oF,EAAIka,EAAW+uE,EAAsB9oF,EAAK92B,OAAS82B,EAAK92B,MAC9D82B,EAAKqb,KAAOnB,EAAMA,EAAImvE,OAAOxpF,EAAG,GAAK,IACrC,IAAMypF,EAAS,OAAGtsD,QAAH,IAAGA,OAAH,EAAGA,EAAMvW,MAAM5mB,EAAGA,EAAI,GAAG,GACpCypF,IACFtpF,EAAKg9B,KAAOssD,GAEdtpF,EAAKupF,QAAUJ,EACfN,KAIN,OAAON,EAGF,SAASiB,EAAiBT,EAAkBhvE,GAGjD,IAFA,IAAIivE,EAAiB,EACjBC,EAAY,EACP9qF,EAAI,EAAGA,EAAI4b,EAASrvC,QAAUu+G,GAAaF,EAAU5qF,GAAK,EAAG,CACpE,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACb,MAAP48B,GAAqB,MAAPA,EAChBiuD,GAAkB7uD,EACF,MAAPY,GAAqB,MAAPA,EACvBkuD,GAAa9uD,EACG,MAAPY,IACTiuD,GAAkB7uD,EAClB8uD,GAAa9uD,GAGjB,OAAO6uD,GAAkBC,EAAYF,GAGhC,SAASU,EACdC,EACAC,EACAzvE,EACA8iB,GAEA,IAAI7hB,EAAyB,GACzBpB,EAAqB,GAGrB2vE,IACF3vE,EAAWC,EAAW0vE,GACtBvuE,EAAaA,EAAW+jB,OAAO6oD,EAAkBhuE,EAAUG,EAAK8iB,KAI9D2sD,IACFxuE,EAAaA,EAAW+jB,OACtBkpD,EAAeuB,EAAU5vE,EAAUoB,EAAYjB,EAAK8iB,KAKxD,IAAMm8C,EAAqC,GAC3C,OAAOh+D,EAAWllB,QAAO,SAAA+kC,GACvB,IAAM7wD,EAAM,GAAH,OAAM6wD,EAAErlD,KAAR,YAAgBqlD,EAAE9xD,MAAlB,YAA2B8xD,EAAEtwD,QAChCm1B,EAAIs5E,EAAKhvG,GAEf,OADAgvG,EAAKhvG,IAAO,GACJ01B,KAKL,SAAS+pF,EAAW/jG,EAAgBoqE,EAAet2C,GACxD,IAAIkwE,EAAc,EACdC,EAAe,EACfC,EAAW,EACf,IAAKlkG,EAEH,OADAoiB,QAAQU,KAAK,iCACN,GAIT,IAFA,IAAMoR,EAAWC,EAAWL,GACxBk0B,EAAM,GACD1vC,EAAI,EAAGA,EAAI4b,EAASrvC,OAAQyzB,GAAK,EAAG,CAC3C,IAAMg8B,GAAOpgB,EAAS5b,GAChB48B,EAAKhhB,EAAS5b,EAAI,GACxB,GAAW,MAAP48B,GAAqB,MAAPA,GAAqB,MAAPA,EAAY,CAC1C,IAAK,IAAI9gB,EAAI,EAAGA,EAAIkgB,EAAKlgB,IAErBg2C,EAAM45B,EAAc5vE,GAAG1jB,gBACvB1Q,EAAOikG,EAAe7vE,GAAG1jB,eAEzBs3C,GAAO,GAAJ,OAAOk8C,GAAP,OAAkBlkG,EAAOikG,EAAe7vE,GAAGzkC,eAC9Cu0G,EAAW,GAEXA,IAGJF,GAAe1vD,EACf2vD,GAAgB3vD,OACX,GAAW,MAAPY,EACT8uD,GAAe1vD,OACV,GAAW,MAAPY,EAAY,CAErB,IADA,IAAIivD,EAAM,GACD/vE,EAAI,EAAGA,EAAIkgB,EAAKlgB,IACvB+vE,GAAOnkG,EAAOikG,EAAe7vE,GAAGzkC,cAElCq4D,GAAO,GAAJ,OAAOk8C,EAAP,YAAmBC,GACtBD,EAAW,EACXD,GAAgB3vD,MACA,MAAPY,EACT+uD,GAAgB3vD,EACA,MAAPY,IACT8uD,GAAe1vD,GAMnB,OAHI4vD,EAAW,IACbl8C,GAAOk8C,GAEFl8C,EAKF,SAAU/yB,EAAcf,EAAoBa,GAA5C,mFACDqvE,EAAW,EACX7uD,EAAU,EACV8uD,EAAS,EAEJ/rF,EAAI,EALR,YAKWA,EAAIyc,EAAUlwC,QALzB,iBAOH,IADMiV,EAAMi7B,EAAUzc,GACf8rF,EAAWlwE,EAASrvC,QAAU0wD,EAAUz7C,EAAKsqG,GAAY,EACxD9vD,GAAOpgB,EAASkwE,GAEX,OADLlvD,EAAKhhB,EAASkwE,EAAW,KACN,MAAPlvD,EAChBK,GAAWjB,EACK,MAAPY,GAAqB,MAAPA,EACvBmvD,GAAU/vD,EACM,MAAPY,GAAqB,MAAPA,GAAqB,MAAPA,IACrCK,GAAWjB,EACX+vD,GAAU/vD,GAId,OApBG,SAoBGvf,EAAUzc,GAAKi9B,EAAU8uD,EApB5B,OAKiC/rF,IALjC,uDAwBA,SAASwc,EAAyBR,EAAYD,GAEnD,OADaC,EAAGI,MAAM,KAEnBtkB,QAAO,SAAA4kB,GAAG,QAAMA,KAChB3qC,KAAI,SAAA2qC,GAAO,MACiBA,EAAIN,MAAM,KAD3B,iBACH4vE,EADG,KACSr3G,EADT,WAIJszE,EAAU+jC,EAAQ9vC,MAAM,wBAC9B,IAAK+L,EACH,MAAM,IAAIz5E,MAAM,yBANR,kBAQwBy5E,EARxB,GAQD/qC,EARC,KAQKjL,EARL,KAYJ1/B,EAZI,KAYY6pC,MAAM,WAAWtkB,QAAO,SAAA9nB,GAAC,QAAMA,KAErD,MAAe,MAAXiiC,GACFnI,QAAQU,KAAK,6CAEN,CAAEhzB,KAAM,cAAeilC,UAAW,KAOpClqC,EAAMR,KAAI,SAAAyF,GACf,IAAIwoB,EAAI,EACR,MAAO,CACLxoB,OACAilC,UAAW9nC,EACR5C,KAAI,SAAA2oC,GAAK,OAAKA,KACd3oC,KAAI,SAAA4hD,GACH3zB,IACA,GACe,MAATkd,GAAgBA,IAASnB,EAAI/b,IAC/B2zB,IAEF3zB,UACO2zB,GAAS,GAAK3zB,EAAI+b,EAAIxvC,QAE/B,QADAyzB,YAMTqnD,OAGE,SAASzkB,EAAqB5mB,GAEnC,OADaA,EAAGI,MAAM,KAEnBtkB,QAAO,SAAA4kB,GAAG,QAAMA,KAChB3qC,KAAI,SAAA2qC,GAAO,MACQA,EAAIN,MAAM,KAEtB6rC,EAHI,oBAGc/L,MAAM,wBAC9B,IAAK+L,EACH,MAAM,IAAIz5E,MAAM,yBAMlB,OAXU,YAOcy5E,EAPd,MAWK7rC,MAAM,WAAWtkB,QAAO,SAAA9nB,GAAC,QAAMA,QAE/Cq3E,S,uGCpXgB1oD,E,kDAOnB,WAAY0e,GAIT,MAID,GAJC,qBACD,cAAMA,IAXRh5B,oBAUG,IARH6L,gBAQG,IANH+kB,aAA8B,GAQ5B,EAAK5wB,eAAiBg5B,EAAMh5B,eAC5B,EAAK6L,WAAamtB,EAAMntB,YACnB,EAAK7L,eACR,MAAM,IAAI7V,MAAJ,6CAAgD,EAAK4C,OAE7D,IAAK,EAAK8e,WACR,MAAM,IAAI1hB,MAAJ,yCAA4C,EAAK4C,OARxD,S,kDAYH,SAAeuT,GACb3X,KAAKioC,aAAa/oC,KAAKyY,O,UAxBW44B,I,iCCZtC,g6BA6BO,SAAS0uE,EACd5pF,GAEA,OACE/B,0BAAgB+B,IAChB,eAAgBA,GAChB,YAAaA,GACb,UAAWA,EA8DR,SAAS6pF,EAAe7pF,GAC7B,MACmB,kBAAVA,GACG,OAAVA,GACA,eAAgBA,GAChB,kBAAmBA,EAQhB,SAASmR,EACdnR,GAEA,OAAO6pF,EAAe7pF,IAAU,sBAAuBA,EAelD,SAASlR,EACdkR,GAEA,OAAO6pF,EAAe7pF,IAAU,YAAaA,EAQxC,SAAS3K,EACd2K,GAEA,OAAO6pF,EAAe7pF,IAAU,mBAAoBA,EAQ/C,SAAS+L,EACd/L,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,cAAeA,GACf,iBAAkBA,EAWf,SAAS8pF,EAAY9pF,GAC1B,MACmB,kBAAVA,GACG,OAAVA,GACA,UAAWA,GACX,aAAcA,EAKX,SAAS+pF,EAAa/pF,GAC3B,MACmB,kBAAVA,GACG,OAAVA,GACA,kBAAmBA,GAEnBA,EAAMptB,cAAc0E,QAWjB,SAAS0yG,EAAehqF,GAC7B,MACmB,kBAAVA,GACG,OAAVA,GACA,kBAAmBA,GAEnBA,EAAMptB,cAAc8+B,UAQjB,SAASu4E,EAAiBjqF,GAC/B,MACmB,kBAAVA,GACG,OAAVA,GACA,cAAeA,GACf,cAAeA,EAiCZ,SAASmP,EACdnP,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,eAAgBA,GAChB,oBAAqBA,I,imBC/OnB7iB,EAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCyrE,YAAa,CACXl7E,SAAU,WACVrB,MAAO8Q,EAAMJ,QAAQ,GACrB+D,IAAK3D,EAAMJ,QAAQ,GACnBpB,MAAOwB,EAAMjE,QAAQ2vE,KAAK,UAIf,SAASuiC,EAAT,GAMZ,IALDnjH,EAKC,EALDA,MACA+b,EAIC,EAJDA,YAIC,EAC6C7E,mBACjB,qBAApBksG,iBAFR,mBACMnmE,EADN,KACuBomE,EADvB,OAI6BnsG,oBAAS,GAJtC,mBAIMmnB,EAJN,KAIe4B,EAJf,OAKyB/oB,qBALzB,mBAKMiP,EALN,KAKaga,EALb,KAMK5oB,EAAUnB,IAChB,OACE,kBAACwO,EAAA,EAAD,CAAQxJ,MAAI,EAACmB,QAASR,GACpB,kBAAC8I,EAAA,EAAD,kBAEE,kBAACxF,EAAA,EAAD,CAAYxI,UAAWU,EAAQopE,YAAa5lE,QAASgB,GACnD,kBAAC,IAAD,QAGJ,kBAAC+I,EAAA,EAAD,KACGqB,EACC,yBAAKpQ,MAAO,CAAErC,MAAO,QAArB,UAAkCyS,IAChCkY,EACF,6BACE,kBAACgkD,EAAA,EAAD,CAAkBpwE,KAAM,GAAI8D,MAAO,CAAE0X,YAAa,MAClD,kBAACzP,EAAA,EAAD,CAAYzC,QAAQ,UAApB,iBAEA,KAEwB,qBAApB6nG,gBACN,kBAACpjB,EAAA,EAAD,CACE1rB,QACE,kBAAC2rB,EAAA,EAAD,CACEx4D,QAASwV,EACTviC,SAAU,kBAAM2oG,GAAmB,SAAA1hG,GAAG,OAAKA,QAG/CmP,MAAM,iFAGR,kBAAC9S,EAAA,EAAD,6FAMF,kBAAChC,EAAA,EAAD,CACEhZ,QAAQ,YACR0Q,MAAM,UACNtF,KAAK,SACL2M,QAAO,sBAAE,sBAAAxV,EAAA,6DACP06B,GAAW,GACXE,OAASn8B,GAFF,kBAIChE,EAAMsjH,UAAU,CAAErmE,oBAJnB,OAKLlhC,IALK,gDAOLokB,EAAS,EAAD,IAPH,yBASLF,GAAW,GATN,6EAJX,Y,gCC3DF7pB,EAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCyrE,YAAa,CACXl7E,SAAU,WACVrB,MAAO8Q,EAAMJ,QAAQ,GACrB+D,IAAK3D,EAAMJ,QAAQ,GACnBpB,MAAOwB,EAAMjE,QAAQ2vE,KAAK,UA4Dft4E,0BAxDf,YAMG,IALDtI,EAKC,EALDA,MACA+b,EAIC,EAJDA,YAKMxE,EAAUnB,IAChB,OACE,kBAACwO,EAAA,EAAD,CAAQyhF,SAAS,KAAKjrF,MAAI,EAACmB,QAASR,GAClC,kBAAC8I,EAAA,EAAD,0BAEG9I,EACC,kBAACsD,EAAA,EAAD,CACExI,UAAWU,EAAQopE,YACnB5lE,QAAS,WACPgB,MAGF,kBAAC,IAAD,OAEA,MAEN,kBAACwnG,EAAA,EAAD,MAEA,kBAACz+F,EAAA,EAAD,6FAIA,kBAACE,EAAA,EAAD,KACE,kBAAChJ,EAAA,EAAD,CACEjB,QAAS,WACP/a,EAAMwjH,YACNznG,KAEF/Y,QAAQ,YACR0Q,MAAM,UACN6yF,WAAS,GAPX,MAWA,kBAACvqF,EAAA,EAAD,CACEjB,QAAS,WACPgB,KAEFrI,MAAM,YACN1Q,QAAQ,YACRujG,WAAS,GANX,eCAR,SAASkd,GAA2Br/E,GAClC,IAAKA,EAAcjhC,OACjB,MAAO,GAET,IAAMugH,EAAuBt/E,EAAcu/E,OACzC,SAAAxiG,GAAK,OAAIA,EAAM3f,eAAiB4iC,EAAc,GAAG5iC,gBAUnD,OARa4iC,EAAcz7B,KAAI,SAAAwY,GAAK,OAClCte,4BAAkB,2BACbse,GADY,IAEfxf,MAAOX,KAAK66C,MAAM16B,EAAMxf,OACxBE,IAAKb,KAAK66C,MAAM16B,EAAMtf,KACtBL,aAAckiH,OAAuB1/G,EAAYmd,EAAM3f,mBAG/CkgB,KAAK,KAUZ,IAAMkiG,GAAoB,GACpBC,GAAyB,GACzBC,GAAmB,GACnBC,GAAuB,EAG7B,SAASv4F,GAAkBtQ,GAChC,IAAMlb,EAAQmJ,QACXnJ,MAAM,mBAAoB,CACzBkE,GAAIgF,YACJkF,KAAMjF,QAAMye,QAAQ,oBACpBrnB,SAAU,EACVE,QAAS,EACTD,iBAAkB2I,QAAM6oB,MAAMgyF,UAG9B76E,OAAQhgC,QAAM6oB,MACZ9W,EAAc8uB,iBAAiB,QAAS,eAE1Cs5B,YAAY,EACZ2gD,oBAAoB,EACpBtoD,kBAAmBxyD,QAAMC,SACvBD,QAAMwiB,YAAY,CAAC,iBACnB,gBAEFu4F,YAAa,cACbC,gBAAgB,IAEjB5kF,UAAS,iBAAO,CACfgtC,mBAAevoE,EACftD,kBAAmB,EACnB0jH,qBAAiBpgH,EACjBmiB,WAAOniB,EAIPqgH,kCAAmC,GACnCz4C,YAAa,EAEbvN,UAAW,GACXimD,oBAAqB,GACrBC,cAAe,EACfC,gBAAYxgH,EACZygH,iBAAazgH,MAEd6e,OAAM,SAAAtY,GAAI,MAAK,CACd,YACE,QAA2BvG,IAAvBuG,EAAKgiE,cACP,MAAM,IAAInnE,MACR,6DAGJ,OAAOmF,EAAKgiE,mBAGf1pD,OAAM,SAAAtY,GAAI,MAAK,CACd,kBAAkB,IACR+2B,EAAoBxZ,qBAAWvd,GAA/B+2B,gBAMFojF,EAAwB9gH,KAAK6d,cAAckiG,OAAM,SAAAniH,GAAgB,MACrE,kBACE8/B,EAAgB4oE,oBADlB,aACE,EACIvhG,KAAI,SAAAqyF,GAAG,OAAIA,EAAIhzF,QAChB8mB,SAASttB,MAEJ8/B,EAAgBv9B,IAAIvC,IAAiB,IAAIkhC,eAKrD,YAA8B1+B,IAAvBuG,EAAKgiE,eAA+Bm4C,GAE7C,0BACE,OAAOn6G,EAAK/J,iBAAiB2C,OAAS,GAExC,2BACE,OAAOoH,EAAKi6G,YAAcj6G,EAAKk6G,aAEjC,qBACE,OAAOX,GAAmBC,IAE5B,mBACE,OAAIx5G,EAAK+4D,WACA,EAEL/4D,EAAK05G,mBACAL,GAEFA,GAAoBC,IAE7B,mBACE,OAAOt5G,EAAK4+B,OACTxgC,KAAI,SAAA4vC,GAAC,OAAIA,EAAExO,SAAS,GAAG1lC,UACvBk0B,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,IAG7B,oCACE,OAAOh1B,KAAK+gH,aAAep6G,EAAK4+B,OAAOhmC,OAAS4gH,IAElD,aACE,OACEngH,KAAKghH,8BACLhhH,KAAK83D,aACL93D,KAAKihH,gBAGT,8BACE,OA3GkC,GA6GpC,cACE,IAAIC,EAAU,EAId,OAHAv6G,EAAK/J,iBAAiBa,SAAQ,SAAAC,GAC5BwjH,GAAWxjH,EAAOO,IAAMP,EAAOK,SAE1BmjH,GAGT,iBACE,OAAOlhH,KAAKgpE,SAAwB,GAAbriE,EAAKnK,QAG9B,iBACE,MAAO,KAGT,gBAGE,OAAOwD,KAAKmhH,wBADQ,IAGtB,6BACE,IAAMC,EAAe,GACb1jF,EAAoBxZ,qBAAWvd,GAA/B+2B,gBAgBR,OAfA/2B,EAAK/J,iBAAiBa,SAAQ,YAA+B,IAA5BI,EAA4B,EAA5BA,QAASD,EAAmB,EAAnBA,aAClCo9D,EAAWt9B,EAAgBv9B,IAAIvC,GAC/B0qB,EAAI0yC,GAAaA,EAASh0C,QAChC,GAAIsB,EAAG,CACL,IAAM+4F,EAAgB/4F,EAAEuO,MACtB,SAAA44C,GAAQ,OAAIA,EAAS5xE,UAAYA,KAE7ByjH,EAAgBF,EAAavqF,MACjC,SAAA44C,GAAQ,OAAIA,EAAS5xE,UAAYA,KAE/BwjH,IAAkBC,GACpBF,EAAaliH,KAAKmiH,OAIjBD,GAGT,mCACE,OAAOphH,KAAKuhH,uBACTx8G,KAAI,SAAApD,GAAC,OAAIA,EAAE1D,IAAM0D,EAAE5D,SACnB42B,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,IAE7B,gBAGE,OADqB,GACbruB,EAAKnK,OAGf,8BACE,OAAOwD,KAAKgpE,QAAUriE,EAAK9J,SAG7B,kBACE,kCACK8L,+BAAqBhC,IAD1B,IAEE9J,QAAS8J,EAAK9J,QACd2iB,sBAAuBgF,kBACrBN,qBAAWvd,GACX,4BAIN,oBACE,mBACK,IAAI7D,IAAI6D,EAAK/J,iBAAiBmI,KAAI,SAAArH,GAAM,OAAIA,EAAOE,mBAG1DkB,aAlIc,SAkIDlB,EAAsBC,GACjC,OAAOmC,KAAKuhH,uBAAuB1qF,MACjC,SAAA/3B,GAAY,OACVA,EAAalB,eAAiBA,GAC9BkB,EAAajB,UAAYA,MAU/Bw8D,OAhJc,YAwJX,IAPDx8D,EAOC,EAPDA,QACA2/C,EAMC,EANDA,MACA7/C,EAKC,EALDA,aAMI6jH,EAAW,EAETC,EAAuBzhH,KAAKjD,wBAA0B4J,EAAK9J,QAC3D6kH,EAAiB/6G,EAAK7J,kBAAoB6J,EAAK9J,QAC/C8M,EAAQhD,EAAK/J,iBAAiBgrC,WAAU,SAAClqC,EAAQy6D,GACrD,IAAMnJ,EAAMtxD,EAAOO,IAAMP,EAAOK,MAChC,OACEF,IAAYH,EAAOG,SACnB2/C,GAAS9/C,EAAOK,OAChBy/C,GAAS9/C,EAAOO,OAEZN,GAAeA,IAAiBw6D,IAClCqpD,GAAY9jH,EAAOQ,SACfR,EAAOO,IAAMu/C,EACbA,EAAQ9/C,EAAOK,OACZ,IAOTixD,EAAM0yD,GACNF,EAAW76G,EAAK9J,SAAW,GAC3B2kH,EAAW76G,EAAK9J,QAAU8J,EAAKnK,MAE/BglH,GAAYxyD,EAAMyyD,EAElBD,GAAYxyD,GAEP,MAGT,GADoBroD,EAAK/J,iBAAiB+M,GAExC,MAAO,CACLA,QACAhN,SAAUS,KAAK66C,MAAMupE,EAAW76G,EAAK9J,WAW3Cu/D,OAxMc,SAwMP3hB,GACL,IAAIknE,EAAU,EACRC,GAAMj7G,EAAKhK,SAAW89C,GAAM9zC,EAAK9J,QACjCyhC,EAAI33B,EAAK/J,iBAAiB2C,OAChC,GAAIqiH,EAAK,EAAG,CACV,IAAMlkH,EAASiJ,EAAK/J,iBAAiB,GAC/BgF,EAASggH,EACf,kCACK53F,sBAAYtsB,IADjB,IAEEmkH,KAAK,EACLrkE,MAAO9/C,EAAOQ,SACVd,KAAKiB,MAAMX,EAAOO,IAAM2D,GAAU,EAClCxE,KAAKiB,MAAMX,EAAOK,MAAQ6D,GAAU,EACxCA,SACA+H,MAAO,IAOX,IAHA,IAAM83G,EAAuBzhH,KAAKjD,wBAA0B4J,EAAK9J,QAC3D6kH,EAAiB/6G,EAAK7J,kBAAoB6J,EAAK9J,QAE5C8M,EAAQ,EAAGA,EAAQhD,EAAK/J,iBAAiB2C,OAAQoK,GAAS,EAAG,CACpE,IAAMjM,EAASiJ,EAAK/J,iBAAiB+M,GAC/BqlD,EAAMtxD,EAAOO,IAAMP,EAAOK,MAC1B6D,EAASggH,EAAKD,EACpB,GAAI3yD,EAAM2yD,EAAUC,GAAMD,GAAWC,EACnC,kCACK53F,sBAAYtsB,IADjB,IAEEmkH,KAAK,EACLjgH,SACA47C,MAAO9/C,EAAOQ,SACVd,KAAKiB,MAAMX,EAAOO,IAAM2D,GAAU,EAClCxE,KAAKiB,MAAMX,EAAOK,MAAQ6D,GAAU,EACxC+H,UAOFjM,EAAOO,IAAMP,EAAOK,MAAQ2jH,GAC5B9/G,EAAS+E,EAAK9J,QAAU,GACxB+E,EAAS+E,EAAK9J,QAAU8J,EAAKnK,MAE7BmlH,GAAW3yD,EAAMyyD,EAEjBE,GAAW3yD,EAIf,GAAI4yD,GAAMD,EAAS,CACjB,IAAMjkH,EAASiJ,EAAK/J,iBAAiB0hC,EAAI,GAEnC18B,EAASggH,EAAKD,GADRjkH,EAAOO,IAAMP,EAAOK,OAEhC,kCACKisB,sBAAYtsB,IADjB,IAEEmkH,KAAK,EACLjgH,SACA47C,MAAO9/C,EAAOQ,SACVd,KAAKiB,MAAMX,EAAOO,IAAM2D,GAAU,EAClCxE,KAAKiB,MAAMX,EAAOK,MAAQ6D,GAAU,EACxC+H,MAAO20B,EAAI,IAGf,MAAO,CACLkf,MAAO,EACP7zC,MAAO,EACP9L,QAAS,GACTgkH,KAAK,EACLjkH,aAAc,GACdgE,OAAQ,EACR7D,MAAO,EACPE,IAAK,EACLC,UAAU,IAIdo6D,SArRc,SAqRLh4D,GACP,OAAOqG,EAAK4+B,OAAO1O,MAAK,SAAA8d,GAAC,OAAIA,EAAE1sC,cAAc0E,UAAYrM,MAI3DwhH,gBA1Rc,SA0REj+F,EAAmB0iB,GAA6B,WAC9DA,EAAgB9oC,SAAQ,SAACoa,GAKvB,GAHI,YAAaA,GACf,EAAKiqG,gBAAgBj+F,EAAWhM,EAAOisB,SAErC,YAAajsB,EAAQ,CACvB,IAAMkqG,EAAclqG,EAAOV,QAC3BU,EAAOV,QAAU,WAAwB,2BAApBiJ,EAAoB,yBAApBA,EAAoB,gBACvCzZ,EAAK4+B,OAAO9nC,SAAQ,SAAAsK,GACdA,EAAMyC,OAASqZ,GACjBk+F,EAAYC,MAAMj6G,EAAlB,CAA0BA,GAA1B,OAAoCqY,aAQhD,uBAAuB,WACf6hG,EAAsC,IAAIniH,IAUhD,OATA6G,EAAK4+B,OAAO9nC,SAAQ,SAAAsK,GAElB,IADmBk6G,EAAW9hH,IAAI4H,EAAMyC,MACvB,CACf,IAAM+7B,EAAkB2rC,IAAMnqE,EAAMw+B,iBACpC,EAAKu7E,gBAAgB/5G,EAAMyC,KAAM+7B,GACjC07E,EAAW5hH,IAAI0H,EAAMyC,KAAM+7B,OAIxB07E,GAGT,qBACE,OAAOt7G,EAAK/J,iBAAiB2C,OACzBS,KAAKo8D,OAAOz1D,EAAKnK,MAAQ,QACzB4D,OAGPsG,SAAQ,SAAAC,GAAI,MAAK,CAChBiT,SADgB,SACP+/C,GACPhzD,EAAKgiE,cAAgBhP,GAEvBp9B,SAJgB,SAIPha,GACP5b,EAAK4b,MAAQA,GAGf2/F,aARgB,WASdv7G,EAAK+4D,YAAc/4D,EAAK+4D,YAG1ByiD,qBAZgB,WAadx7G,EAAK05G,oBAAsB15G,EAAK05G,oBAGlC+B,SAhBgB,SAgBPzlH,GACP,IAAM0lH,EAAc7nD,gBAAM79D,EAAUgK,EAAK27G,UAAW37G,EAAK47G,WAEzD,OADA57G,EAAKhK,SAAW0lH,EACTA,GAGTz3C,OAtBgB,SAsBT/tE,GACL,IAAM2lH,EAAahoD,gBAAM39D,EAAS8J,EAAK87G,WAAY97G,EAAK+7G,YACxD,GAAIF,IAAe77G,EAAK9J,QACtB,OAAO2lH,EAET,IAAMG,EAAah8G,EAAK9J,QAGxB,GAFA8J,EAAK9J,QAAU2lH,EAEXplH,KAAKshD,IAAIikE,EAAaH,GAAc,KAEtC,OADA1lF,QAAQU,KAAK,iCACNmlF,EAIT,IAAM37C,EAAYrgE,EAAKnK,MAOvB,OANAwD,KAAKoiH,SACHhlH,KAAK66C,OACDtxC,EAAKhK,SAAWqqE,EAAY,GAAK27C,EAAcH,EAC/Cx7C,EAAY,IAGXw7C,GAGTI,WA9CgB,SA8CLriH,EAA4BC,GAErCmG,EAAKi6G,WAAargH,EAClBoG,EAAKk6G,YAAcrgH,GAGrBqiH,WApDgB,SAoDLhmH,EAAiBF,GAC1BqD,KAAK4qE,OAAO/tE,GACZmD,KAAKoiH,SAASzlH,IAGhBmmH,iBAzDgB,WA0Ddn8G,EAAK/J,iBAAmBsgC,eACtBv2B,EAAK/J,iBACF0+C,QACAC,UACAx2C,KAAI,SAAArH,GAAM,kCAAUA,GAAV,IAAkBQ,UAAWR,EAAOQ,eAEnD8B,KAAKoiH,SAASz7G,EAAKqiE,QAAUriE,EAAK9J,QAAU8J,EAAKhK,SAAWgK,EAAKnK,QAGnEqqC,UAnEgB,SAmENl6B,GAAuC,IAAtBq6B,EAAsB,uDAAJ,GACrC0iC,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAEIkX,EAAYvM,EAAcgI,aAAarX,EAAcuC,MAC3D,IAAKqZ,EACH,MAAM,IAAIriB,MAAJ,6BAAgCyG,EAAcuC,OAEtD,IAAM6U,EAAW/H,EAAc0wB,YAAYrhC,EAAK6D,MAC1CgwE,EAAoBn7D,EAAS4oB,aAAaljC,KAC9C,SAAAoiC,GAAW,OAAIA,EAAY/iC,QAEvB+jC,EAAclgC,EAAck+B,SAAStP,MACzC,SAACxkB,GAAD,OAA8BmoE,EAAkBtvD,SAAS7Y,EAAE7H,SAE7D,IAAK29B,EACH,MAAM,IAAI3mC,MAAJ,4DACiDmF,EAAK6D,OAG9D,IAAMzC,EAAQ8b,EAAUX,WAAWiQ,OAArB,2BACT6T,GADS,IAEZx8B,KAAMvC,EAAcuC,KACpBvC,gBACAk+B,SAAU,CAAC,CAAE37B,KAAM29B,EAAY39B,KAAMvC,cAAekgC,OAGtD,OADAxhC,EAAK4+B,OAAOrmC,KAAK6I,GACVA,GAGT6+B,UAtGgB,SAsGNj6B,GACR,IAAM+8D,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAGIg9D,EAAchjE,EAAK4+B,OAAOza,QAC9B,SAAA6pB,GAAC,OAAIA,EAAE1sC,gBAAkBA,KAG3B,OADAq/B,uBAAY,kBAAMqiC,EAAYlsE,SAAQ,SAAAk3C,GAAC,OAAIhuC,EAAK4+B,OAAOgC,OAAOoN,SACvDg1B,EAAYpqE,YAGtBmH,SAAQ,SAAAC,GAAI,MAAK,CAChBo8G,UADgB,SACNC,EAAuBC,GAC/B,IAAMC,EAAWv8G,EAAK4+B,OAAOqC,WAC3B,SAAA7/B,GAAK,OAAIA,EAAMzH,KAAO0iH,KAExB,IAAkB,IAAdE,EACF,MAAM,IAAI1hH,MAAJ,mBAAsBwhH,EAAtB,eAER,IAAMG,EAAWx8G,EAAK4+B,OAAOqC,WAC3B,SAAA7/B,GAAK,OAAIA,EAAMzH,KAAO2iH,KAExB,IAAkB,IAAdE,EACF,MAAM,IAAI3hH,MAAJ,mBAAsByhH,EAAtB,eAER,IAAMl7G,EAAQiiB,sBAAYrjB,EAAK4+B,OAAO29E,IACtCv8G,EAAK4+B,OAAOsC,OAAOq7E,EAAU,GAC7Bv8G,EAAK4+B,OAAOsC,OAAOs7E,EAAU,EAAGp7G,IAGlC8xD,UAnBgB,WAoBd,IAAM1xD,EAAS0a,4BAAkBlc,GAC7BwB,EAEE82G,0BAAgB92G,IAClBA,EAAOyxD,WAAWjzD,GAIpBud,qBAAWvd,GAAMizD,WAAWjzD,IAIhCijE,YAhCgB,SAgCJj9D,GAEUhG,EAAKigC,UAAUj6B,IAGjChG,EAAKkgC,UAAUl6B,IAInBy2G,eAzCgB,SAyCD3hB,GACb96F,EAAK25G,YAAc7e,GAGrB4hB,iBA7CgB,WA8Cd18G,EAAK45G,gBAAkB55G,EAAK45G,gBAG9Bz3C,oBAjDgB,SAiDI9hD,GAClBrgB,EAAK/J,iBAAmBsgC,eAAKlW,GAC7BrgB,EAAKikE,OAAOjkE,EAAK9J,UAGnB2sE,sBAtDgB,WAuDd,GAA+B,iBAA3B7iE,EAAKoxD,kBAAsC,CAC7C,IAAM3iD,EAAU8O,qBAAWvd,GAC3B,GAAIwd,oCAA0B/O,GAAU,CACtC,IAAMq0D,EAAWr0D,EAAQuP,UACvB,kCACA,4BACA,CAAE5H,KAAMpW,IAGV,OADAyO,EAAQ0P,WAAW2kD,GACZA,GAGX,MAAM,IAAIjoE,MAAJ,sCAAyCmF,EAAKoxD,qBAEtDurD,eArEgB,SAqEDlxB,EAAmBmxB,GAA0B,IAClD7lF,EAAoBxZ,qBAAWvd,GAA/B+2B,gBACA47D,EAAmB57D,EAAnB47D,eACFkqB,EAAapxB,EAAUhjD,MAAM,KACnC,GAAIzoC,EAAK/J,iBAAiB2C,OAAS,EAAnC,CACE,IAAMkkH,EAAYD,EAAWz+G,KAAI,SAAA2+G,GAAE,OACjC7yB,yBAAe6yB,EAAIpqB,MAErBt5F,KAAK2jH,cAAcF,OAJrB,CAOA,IAAI7lH,EAAe2lH,EACfK,EAAiB,GACgB,IAAjCj9G,EAAK/J,iBAAiB2C,SAExB3B,EAAe+I,EAAK/J,iBAAiB,GAAGgB,aACxCgmH,EAAiBj9G,EAAK/J,iBAAiB,GAAGiB,SAE5C,IAAIm9D,EAAWp9D,GAAgB8/B,EAAgBv9B,IAAIvC,GACnD,IAAKo9D,EACH,MAAM,IAAIx5D,MAAJ,kCAAqC5D,IApBa,IAsBpDopB,EAAYg0C,EAAZh0C,QACN,IAAKA,EACH,MAAM,IAAIxlB,MAAJ,+BAAkC5D,EAAlC,oBAER,GAAI4lH,EAAWjkH,OAAS,EACtB,MAAM,IAAIiC,MACR,mFAGJ,IAAM8wF,EAAkBzB,yBAAe2yB,EAAW,IAAI,SAAA3lH,GAAO,OAC3Dy7F,EAAez7F,EAASD,MAEtBimH,GAAkB,EACtB,GACEvxB,EAAgB10F,cAChB00F,EAAgB10F,eAAiBA,EACjC,CACA,IAAMkmH,EAAcpmF,EAAgBv9B,IAAImyF,EAAgB10F,cACxD,IAAKkmH,EACH,MAAM,IAAItiH,MAAJ,kCACuB8wF,EAAgB10F,eAG/Co9D,EAAW8oD,EACXD,GAAkB,EAClB,IAAME,EAAaD,EAAY98F,QAC/B,IAAK+8F,EACH,MAAM,IAAIviH,MAAJ,+BACoB8wF,EAAgB10F,aADpC,oBAIRopB,EAAU+8F,EAEZ,IAAMjyB,EAAmB92B,EAASe,oBAChCu2B,EAAgBz0F,SAGlB,IAAKi0F,EACH,MAAM,IAAItwF,MAAJ,iCACsB8wF,EAAgBz0F,QADtC,eACoDm9D,EAAS52D,OAGrE,GAAIy/G,GAAmB/xB,IAAqB8xB,EAAgB,CAC1D,IAAM7xB,EAAqB/qE,EAAQ6P,MACjC,SAAAn5B,GAAM,OAAIA,EAAOG,UAAYi0F,KAE/B,IAAIC,EAGF,MAAM,IAAIvwF,MAAJ,iCACsB8wF,EAAgBz0F,QADtC,eACoDm9D,EAAS52D,OAHnEpE,KAAK8oE,oBAAoB,CAAC9+C,sBAAY+nE,KAO1C,IAAMiyB,EAAkBh9F,EAAQ6P,MAC9B,SAAAn5B,GAAM,OAAIA,EAAOG,UAAYi0F,KAE/B,GAAIkyB,EAAiB,SACbjmH,EAAQy8D,gBAAK,iBACjB83B,QADiB,IACjBA,OADiB,EACjBA,EAAiBv0F,aADA,QACS,EAC1B,EACAimH,EAAgB/lH,KAEZA,EAAMu8D,gBAAK,iBACf83B,QADe,IACfA,OADe,EACfA,EAAiBr0F,WADF,QACS+lH,EAAgB/lH,IACxC,EACA+lH,EAAgB/lH,KAGlB+B,KAAKikH,MAAL,2BACK3xB,GADL,IAEEv0F,QACAE,YAgBNgmH,MAnLgB,SAmLVn/B,GACJ9kF,KAAK2jH,cAAc,CAAC7+B,KAGtB6+B,cAvLgB,SAuLFF,GACZ,IAAMS,EAAgBT,EAAU,GAC1B5lH,EAAYqmH,EAAZrmH,QAEJE,EAGEmmH,EAHFnmH,MACAE,EAEEimH,EAFFjmH,IALoC,EAOlCimH,EADFtmH,oBANoC,MAMrB+I,EAAKkX,cAAc,GANE,EAStC,QAAczd,IAAVrC,QAA+BqC,IAARnC,GAAqBF,EAAQE,EACtD,MAAM,IAAIuD,MAAJ,iBAAoBzD,EAAQ,EAA5B,kCAAuDE,EAAvD,MAER,IAEM+8D,EAFU92C,qBAAWvd,GACnB+2B,gBACyBv9B,IAAIvC,GACrC,GAAIo9D,EAAU,CACZ,IAAM82B,EAAmB92B,EAASe,oBAAoBl+D,GAClDi0F,IACFj0F,EAAUi0F,GA0Bd,IAvBA,IAsBInoF,EAtBA+qB,EAAI32B,EACJi5B,EAAI/4B,EACJkmH,GAAiB,EACf1xB,EAAY,SAACnqE,GACjB,GAAIzqB,IAAYyqB,EAAEzqB,QAAS,CAQzB,GAPAsmH,GAAiB,OACP/jH,IAANs0B,IACFA,EAAIpM,EAAEvqB,YAEEqC,IAAN42B,IACFA,EAAI1O,EAAErqB,KAEJy2B,GAAKpM,EAAEvqB,OAAS22B,GAAKpM,EAAErqB,KAAO+4B,GAAK1O,EAAErqB,KAAO+4B,GAAK1O,EAAEvqB,MACrD,OAAO,EAET22B,EAAI32B,EACJi5B,EAAI/4B,EAEN,OAAO,GAGHmmH,EAAYjI,wBAAcx1G,EAAK/J,iBAAkB61F,GAEhD9oF,IAAUy6G,GACf,IACE,IAAMC,EAAoC16G,EAO1C,GANAA,EAAQhD,EAAK/J,iBACV0+C,WAAwBl7C,IAAlBikH,EAA8B,EAAIA,EAAgB,GACxDz8E,UAAU6qD,QACSryF,IAAlBikH,IACF16G,GAAS06G,EAAgB,IAEtBF,EACH,MAAM,IAAI3iH,MAAJ,gDACqC3D,EADrC,MAIR,QAAUuC,IAANs0B,EACF,MAAM,IAAIlzB,MAAJ,gDACqC3D,EADrC,4CACgFm5B,IAGxF,QAAU52B,IAAN42B,EACF,MAAM,IAAIx1B,MAAJ,gDACqC3D,EADrC,6CAEF62B,EAAI,IAIV,IAAe,IAAX/qB,EACF,MAAM,IAAInI,MAAJ,6DACkDvC,4BACpDilH,GAFE,MAMR,GAAyB,IAArBT,EAAUlkH,OAAc,CAC1B,IAAMyD,EAAI2D,EAAK/J,iBAAiB+M,GAKhC,YAJA3J,KAAK4hD,OACH,CAAEj4C,QAAO/H,OAAQoB,EAAE9E,SAAW8E,EAAE/E,IAAM+4B,EAAItC,EAAI1xB,EAAEjF,OAChD,CAAE4L,QAAO/H,OAAQoB,EAAE9E,SAAW8E,EAAE/E,IAAMy2B,EAAIsC,EAAIh0B,EAAEjF,QAOpD,IAHA,IAAIumH,EAAgB,EAChBC,EAAgB,EAChBC,EAAc,EAGhBF,EAAgBb,EAAUlkH,OAC1B+kH,IACA,CACA,IAAMj7G,EAAWo6G,EAAUa,GACrB5mH,EAASiJ,EAAK/J,iBAAiB+M,EAAQ26G,GAG7C,GAFAC,EAAgBl7G,EAAStL,OAASL,EAAOK,MACzCymH,EAAcn7G,EAASpL,KAAOP,EAAOO,IACjCoL,EAASxL,UAAYH,EAAOG,QAC9B,MAAM,IAAI2D,MAAJ,2BACgBvC,4BAClBoK,GAFE,2CAMR,GAAIi7G,EAAgB,EAKlB,KAHoB5mH,EAAOQ,SACvBsmH,IAAgB9mH,EAAOO,IACvBsmH,IAAkB7mH,EAAOK,OAE3B,MAAM,IAAIyD,MAAJ,UAEF9D,EAAOQ,SAAW,MAAQ,QAFxB,sBAGUe,4BACZoK,GAJE,uBAKY3L,EAAOQ,SACnBR,EAAOO,IACPP,EAAOK,MAAQ,GACjBw/C,eAAe,SARb,oBAaV,KADe+mE,IAAkBb,EAAUlkH,OAAS,GAMlD,KAHqB7B,EAAOQ,SACxBqmH,IAAkB7mH,EAAOK,MACzBymH,IAAgB9mH,EAAOO,KAEzB,MAAM,IAAIuD,MAAJ,UAEF9D,EAAOQ,SAAW,QAAU,MAF1B,sBAGUe,4BACZoK,GAJE,uBAKY3L,EAAOQ,SACnBR,EAAOK,MAAQ,EACfL,EAAOO,KACTs/C,eAAe,SARb,oBAaZ+mE,GAAiB,EACjB,IAAMG,EAAuB99G,EAAK/J,iBAAiB+M,GAC7C+6G,EACJ/9G,EAAK/J,iBAAiB+M,EAAQ26G,GAehC,YAdAtkH,KAAK4hD,OACH,CACEj4C,QACA/H,OAAQ6iH,EAAqBvmH,SACzBumH,EAAqBxmH,IAAM+4B,EAC3BtC,EAAI+vF,EAAqB1mH,OAE/B,CACE4L,MAAOA,EAAQ26G,EACf1iH,OAAQ8iH,EAAmBxmH,SACvBwmH,EAAmBzmH,IAAMsmH,EACzBC,EAAcE,EAAmB3mH,QAIzC,MAAOwkB,GACP,GAAI5Y,IAAUy6G,EACZ,MAAM7hG,IAedoiG,uBAzWgB,SAyWO9nE,EAAkBkF,GACvC,QAAe3hD,IAAXy8C,QAAoCz8C,IAAZ2hD,EAA5B,CAOA,GAFElF,EAAOh/C,UAAYkkD,EAAQlkD,SAAWg/C,EAAOlzC,QAAUo4C,EAAQp4C,OAG9Co4C,EAAQngD,OAASi7C,EAAOj7C,QACzCi7C,EAAOlzC,MAAQo4C,EAAQp4C,MACvB,OACqB,CAACo4C,EAASlF,GAA7BA,EADF,KACUkF,EADV,KAGF,IAAM6iE,EAAc,CAClB7mH,MAAO8+C,EAAO9+C,MACdE,IAAK4+C,EAAO5+C,IACZ0L,MAAOkzC,EAAOlzC,MACd/H,OAAQi7C,EAAOj7C,QAEXijH,EAAY,CAChB9mH,MAAOgkD,EAAQhkD,MACfE,IAAK8jD,EAAQ9jD,IACb0L,MAAOo4C,EAAQp4C,MACf/H,OAAQmgD,EAAQngD,QAElB,GAAIgjH,GAAeC,EACjB7kH,KAAK4hD,OAAOgjE,EAAaC,QAET3gG,qBAAWvd,GACnB8iD,OAAO,kCAAmC,aAWtDq7D,mBAlZgB,SAmZdlE,EACAC,GAEA,IAAMkE,EAAU1yF,IAAWc,OAAX,2BACXnJ,sBAAYrjB,IADD,IAEd5J,wBAAyB4J,EAAK5J,2BAMhC,OAHAgoH,EAAQp6C,iBAAiBhkE,EAAKnK,OAC9BuoH,EAAQJ,uBAAuB/D,EAAYC,GAEpCkE,EAAQziF,cAAc9B,cAAcz7B,KAAI,SAAArH,GAC7C,kCACKA,GADL,IAEEK,MAAOX,KAAKiB,MAAMX,EAAOK,OACzBE,IAAKb,KAAKC,KAAKK,EAAOO,WAM5B+mH,yBAxagB,SAwaS5rE,GACvBzyC,EAAK85G,kCAAkCvhH,KAAKk6C,IAS9CwI,OAlbgB,SAkbT7jD,EAAiBE,GAEtB,IAAI0jH,EAAU,EAEd,GAAI5jH,EAAM4L,QAAU1L,EAAI0L,MACtBg4G,GAAW1jH,EAAI2D,OAAS7D,EAAM6D,WACzB,CACL,IAAM8yB,EAAI/tB,EAAK/J,iBAAiBmB,EAAM4L,OAEtC,GADAg4G,GAAWjtF,EAAEz2B,IAAMy2B,EAAE32B,MAAQA,EAAM6D,OAC/B3D,EAAI0L,MAAQ5L,EAAM4L,OAAS,EAC7B,IAAK,IAAIqpB,EAAIj1B,EAAM4L,MAAQ,EAAGqpB,EAAI/0B,EAAI0L,MAAOqpB,GAAK,EAChD2uF,GACEh7G,EAAK/J,iBAAiBo2B,GAAG/0B,IAAM0I,EAAK/J,iBAAiBo2B,GAAGj1B,MAG9D4jH,GAAW1jH,EAAI2D,OAEjB,IAAMqjH,EACJtD,GACCh7G,EAAKnK,MACJmK,EAAK5J,yBAA2BkB,EAAI0L,MAAQ5L,EAAM4L,QAChD64G,EAAa77G,EAAKikE,OAAOq6C,GAG3BC,EAAU,EACVD,EAAgBzC,IAClB0C,GAAY1C,EAAayC,GAAiBt+G,EAAKnK,MAAS,GAI1D,IADA,IAAI2oH,GAAaD,EACRlyF,EAAI,EAAGA,EAAIrsB,EAAK/J,iBAAiB2C,OAAQyzB,GAAK,EAAG,CACxD,IAAMt1B,EAASiJ,EAAK/J,iBAAiBo2B,GACrC,GAAIj1B,EAAM4L,QAAUqpB,EAAG,CACrBmyF,GAAapnH,EAAM6D,OACnB,MAEAujH,GAAaznH,EAAOO,IAAMP,EAAOK,MAGrC4I,EAAKy7G,SACHhlH,KAAK66C,MAAMktE,EAAYx+G,EAAK9J,SAC1B8J,EAAK5J,wBAA0BgB,EAAM4L,QAI3Cy7G,iBA/dgB,SA+dCpxG,GACf,IAAMqxG,EAAc1+G,EAAKhK,SAGzB,OADoBgK,EAAKy7G,SAASz7G,EAAKhK,SAAWqX,GAC7BqxG,GAUvBC,SA7egB,SA6eP1D,EAAY/jH,EAAiB0nH,GACpC,IAAMpkC,EAAWx6E,EAAK0zD,OAAO,CAC3Bx8D,UACA2/C,MAAOokE,EACPjkH,aAAc4nH,IAEZpkC,GACFx6E,EAAKy7G,SAAShlH,KAAK66C,MAAMkpC,EAASxkF,SAAWgK,EAAKnK,MAAQ,KAI9DgpH,OAxfgB,WAyfd,IAAM17D,EAAWnjD,EAAKqiE,QAAU,EAChCriE,EAAKy7G,SAAShlH,KAAK66C,MAAM6R,EAAWnjD,EAAK9J,QAAU8J,EAAKnK,MAAQ,KAGlEipH,eA7fgB,WA8fd9+G,EAAKikE,OAAOjkE,EAAK+7G,YACjB1iH,KAAKwlH,UAGPE,yBAlgBgB,SAkgBS9nH,GACvB,IAAMwX,EAAU8O,qBAAWvd,GACnB+2B,EAAoBtoB,EAApBsoB,gBACR,IAAK9/B,EAAc,CACjB,IAAMigB,EAAgB,YACjB,IAAI/a,IACL6D,EAAK/J,iBAAiBmI,KAAI,SAAArH,GAAM,OAAIA,EAAOE,kBAG/C,GAAIigB,EAActe,OAAS,EAIzB,YAHA6V,EAAQq0C,OAAR,yDAMA7rD,EAbe,YAaCigB,EAbD,MAenB,IAAMm9C,EAAWt9B,EAAgBv9B,IAAIvC,GACrC,GAAIo9D,EAAU,KACJh0C,EAAYgD,sBAAYgxC,GAAxBh0C,QACJA,IACFhnB,KAAK8oE,oBAAoB9hD,GACzBrgB,EAAKikE,OAAOjkE,EAAK+7G,YACjB1iH,KAAKwlH,YAKXG,mBA/hBgB,SA+hBGxtD,GACjBxxD,EAAK65G,gBAAkBroD,GAGzBgQ,eAniBgB,SAmiBDy9C,GACbj/G,EAAKqhE,YAAc49C,OAGtBl/G,SAAQ,SAAAC,GACP,IAAIk/G,EAAsB,aAa1B,MAAO,CAAEC,MAXT,SAAeC,GAAoB,MACEC,wBACjCr/G,EAAKhK,SACLgK,EAAKhK,SAAWgK,EAAKnK,MAAQupH,EAC7Bp/G,EAAKy7G,UAJ0B,mBAC1B6D,EAD0B,KACjBC,EADiB,KAMjCL,IACAA,EAAsBK,EACtBD,SAKHv/G,SAAQ,SAAAC,GACP,IAAIk/G,EAAsB,aA2B1B,MAAO,CAAEM,KAzBT,SAAclB,GAEZ,GADAt+G,EAAKikE,OAAOjkE,EAAK9J,WAGdooH,EAAgBt+G,EAAK9J,SAAW8J,EAAK9J,UAAY8J,EAAK87G,YAEtDwC,EAAgBt+G,EAAK9J,SAAW8J,EAAK9J,UAAY8J,EAAK+7G,YAJzD,CAQA,IAAMkD,EAASj/G,EAAK9J,QAAUooH,EAVK,EAWAe,wBACjC,EACAJ,EACAj/G,EAAKwhE,gBACL,WACExhE,EAAKikE,OAAOq6C,GACZt+G,EAAKwhE,eAAe,MAjBW,mBAW5B89C,EAX4B,KAWnBC,EAXmB,KAoBnCL,IACAA,EAAsBK,EACtBD,UAKHhnG,OAAM,SAAAtY,GACL,IAAIy/G,EACAC,EAA6C,GACjD,MAAO,CACL,gBACE,IAD0B,EACpBruG,EAAwB,CAC5B,CACEkV,MAAO,wBACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBuiF,EAAuB,CACzDlqH,MAAOuK,KAGX6P,KAAMytE,KAER,CACE/2D,MAAO,aACP/V,QAAS,WACP+M,qBAAWvd,GAAMo9B,mBAAmBw7E,EAAc,CAChDnjH,MAAOuK,MAIb,CACEumB,MAAO,sBACP/V,QAASxQ,EAAK6iE,sBACdhzD,KAAMikE,KAER,CACEvtD,MAAO,oBACP1W,KAAM+vG,IACNpvG,QAASxQ,EAAKm8G,kBAEhB,CACE51F,MAAO,+BACP1W,KAAMotB,IACNzsB,QAASxQ,EAAK++G,0BAEhB,CACEx4F,MAAO,mBACP1W,KAAMotB,IACNp5B,KAAM,WACNq5B,QAASl9B,EAAK45G,eACdppG,QAASxQ,EAAK08G,kBAEhB,CAAE74G,KAAM,WACR,CACE0iB,MAAO,cACP1W,KAAMotB,IACNp5B,KAAM,WACNq5B,SAAUl9B,EAAK+4D,WACfvoD,QAASxQ,EAAKu7G,cAEhB,CACEh1F,MAAO,uBACP1W,KAAMotB,IACNp5B,KAAM,WACNq5B,SAAUl9B,EAAK05G,mBACflpG,QAASxQ,EAAKw7G,qBACd31F,SAAU7lB,EAAK+4D,YAEjB,CACExyC,MAAO,eACP1W,KAAMgwG,IACN1iF,QAAS,CACP,CACE5W,MAAO,cACP1W,KAAMotB,IACNp5B,KAAM,QACNq5B,QAA8B,gBAArBl9B,EAAK25G,YACdnpG,QAAS,kBAAMxQ,EAAKy8G,eAAe,iBAErC,CACEl2F,MAAO,SACP1W,KAAMotB,IACNp5B,KAAM,QACNq5B,QAA8B,WAArBl9B,EAAK25G,YACdnpG,QAAS,kBAAMxQ,EAAKy8G,eAAe,YAErC,CACEl2F,MAAO,SACP1W,KAAMotB,IACNp5B,KAAM,QACNq5B,QAA8B,WAArBl9B,EAAK25G,YACdnpG,QAAS,kBAAMxQ,EAAKy8G,eAAe,eAhFjB,cAuFCz8G,EAAK8/G,iBAAiB1lH,WAvFvB,IAuF1B,2BAA4D,8BAAhD/B,EAAgD,KAA3CiE,EAA2C,KACtDA,EAAM1D,SACRyY,EAAU9Y,KACR,CAAEsL,KAAM,WACR,CAAEA,KAAM,YAAa0iB,MAAOluB,IAE9BiE,EAAMxF,SAAQ,SAAAoa,GACZG,EAAU9Y,KAAK2Y,QA9FK,8BAmG1B,OAAOG,GAGT,mBACE,IAAMstB,EAAMnpC,YAAsBwK,GAC5B+/G,EAAOtpF,KAAKE,UAAUgI,GAK5B,OAJI+gF,IAA+CK,IACjDN,EAAkC9gF,EAClC+gF,EAA6CK,GAExCN,GAGT,oBACE,OAAOl+C,YAAuBvhE,IAGhC,2BACE,OAAO3G,KAAKsiC,cAAc9B,cAAcz7B,KAAI,SAAAwY,GAC1C,kCACKA,GADL,IAEExf,MAAOX,KAAKiB,MAAMkf,EAAMxf,OACxBE,IAAKb,KAAKC,KAAKkgB,EAAMtf,WAI3B,wBACE,OAAO4hH,GAA2B7/G,KAAKsiC,cAAc9B,gBAEvD,8BACE,OAAOq/E,GAA2Bl5G,EAAK+5G,0BAI5Ch6G,SAAQ,SAAAC,GAAI,MAAK,CAEhBi5G,UAFgB,WAGdj5G,EAAKmiE,oBAAoB,IACzBniE,EAAK4+B,OAAOK,QAIZj/B,EAAKy7G,SAAS,GACdz7G,EAAKikE,OAAO,KAEd+7C,uBAXgB,SAWOppH,GACrBoJ,EAAK+5G,oBAAsBnjH,EAAOijC,cAClC75B,EAAKg6G,cAAgBpjH,EAAOyrE,SAE9BntC,YAfgB,WAeF,WACZ8E,sBACEh6B,EACA25B,mBACE,WACM35B,EAAKm4B,aACP,EAAK6nF,uBAAuBhgH,EAAK27B,iBAGrC,CAAEpG,MAAO,YAKhBx1B,SAAQ,SAAAC,GAAI,MAAK,CACV+4G,UADU,WAC6B,4IAA7Bh8G,EAA6B,+BAAJ,GAAI,SAExBkjH,sBAAYjgH,EAAajD,GAFD,OAErCua,EAFqC,OAGrCzU,EAAO,IAAIs6E,KAAK,CAAC7lE,GAAO,CAAEzT,KAAM,kBACtCu5E,iBAAOv6E,EAAM,aAJ8B,kDAQjD,OAAOjE,QAAMuB,QAAQ+wD,gBAAez7D,K,4JCn0CtC,IAAMyqH,EAA0C,CAC9CC,YAAavhH,QAAM6oB,MAAM7oB,QAAMS,QAC/B+gH,eAAgBxhH,QAAMR,IAAIQ,QAAM6oB,MAAM7oB,QAAMS,SAC5CghH,UAAWzhH,QAAMR,IAAIQ,QAAMW,QAC3BO,QAASlB,QAAMkB,QACfqJ,MAAOvK,QAAM84B,WAAW,QAAS94B,QAAMS,QATzC,WAEE,OAAO,KAQPihH,QAAS1hH,QAAM0hH,QACf/gH,OAAQX,QAAMW,OACdF,OAAQT,QAAMS,OACd+b,KAAMxc,QAAMS,OACZkhH,aAAct/G,eACd6pC,OAAQlsC,QAAMksC,UAIV01E,EAAgD,CACpDL,YAAa,GACbC,eAAgB,GAChBC,UAAW,GACXvgH,SAAS,EACTqJ,MAAO,QACPm3G,QAAS,EACT/gH,OAAQ,EACRF,OAAQ,GACR+b,KAAM,GACNmlG,aAAc,CAAE9/G,IAAK,yBACrBqqC,OAAQ,IAGJ21E,EAAc,SAACzgH,GAAD,MAA2B,CAC7CsY,MAAO,CACL,gBACE,OAAOtY,EAAK1D,UAKZokH,EAAa,SAAC1gH,GAAD,MAA2B,CAC5CsY,MAAO,CACL,gBACE,OAAOme,KAAKE,UAAU32B,EAAK1D,WAM3BqkH,EAAkE,CACtEJ,aAAcG,EACdnhH,OAAQkhH,EACRH,QAASG,EACT3gH,QAAS2gH,EACT31E,OAAQ41E,EAERP,YAAa,SAACngH,GAAD,MAAgC,CAC3CsY,MAAO,CACL,gBACE,OAAOme,KAAKE,UAAU32B,EAAK1D,SAG/ByD,QAAS,CACP3D,IADO,SACHgb,GACFpX,EAAK1D,MAAM/D,KAAK6e,IAElBwpG,cAJO,SAIOpvD,GACZxxD,EAAK1D,MAAM4kC,OAAOswB,EAAK,IAEzBqvD,WAPO,SAOIrvD,EAAap6C,GACtBpX,EAAK1D,MAAMk1D,GAAOp6C,MAIxBgpG,eAAgB,SAACpgH,GAAD,MAA6C,CAC3DsY,MAAO,CACL,gBACE,OAAOme,KAAKE,UAAU32B,EAAK1D,SAG/ByD,QAAS,CACP3D,IADO,SACH/D,EAAa+e,GACfpX,EAAK1D,MAAM5C,IAAIrB,EAAK+e,IAEtBwpB,OAJO,SAIAvoC,GACL2H,EAAK1D,MAAMk+B,OAAOniC,IAEpByoH,SAPO,SAOEzoH,EAAa+e,GACpB,IAAM2pG,EAAK/gH,EAAK1D,MAAM9C,IAAInB,GAC1B,IAAK0oH,EACH,MAAM,IAAIlmH,MAAJ,UAAaxC,EAAb,eAER0oH,EAAGxoH,KAAK6e,IAEV4pG,iBAdO,SAcU3oH,EAAam5D,GAC5B,IAAMuvD,EAAK/gH,EAAK1D,MAAM9C,IAAInB,GAC1B,IAAK0oH,EACH,MAAM,IAAIlmH,MAAJ,UAAaxC,EAAb,eAER0oH,EAAG7/E,OAAOswB,EAAK,IAEjByvD,cArBO,SAqBO5oH,EAAam5D,EAAap6C,GACtC,IAAM2pG,EAAK/gH,EAAK1D,MAAM9C,IAAInB,GAC1B,IAAK0oH,EACH,MAAM,IAAIlmH,MAAJ,UAAaxC,EAAb,eAER0oH,EAAGvvD,GAAOp6C,MAIhBipG,UAAW,SAACrgH,GAAD,MAA2C,CACpDsY,MAAO,CACL,gBACE,OAAOme,KAAKE,UAAU32B,EAAK1D,SAG/ByD,QAAS,CACP3D,IADO,SACH/D,EAAa+e,GACfpX,EAAK1D,MAAM5C,IAAIrB,EAAK+e,IAEtBwpB,OAJO,SAIAvoC,GACL2H,EAAK1D,MAAMk+B,OAAOniC,QAYpB6oH,EAAiBtiH,QAAM84B,WAAW,aAAc94B,QAAMS,QAAQ,SAAA08D,GAAG,OACrEA,EAAIz5B,WAAW,Y,aC1DjB,SAAS6+E,EAGPC,EAAmBC,EAA8BpyF,GAGjD,IACInwB,EADEwiH,EAAuC,GAO7C,GAJIryF,EAAQ3S,kBACVglG,EAAgBz9G,KAAOjF,QAAMC,SAASD,QAAMye,QAAQ+jG,GAAYA,IAG9DnyF,EAAQwC,oBAAsBxC,EAAQsyF,mBACxC,MAAM,IAAI1mH,MAAJ,gEACqDumH,IAGzDnyF,EAAQwC,mBACgC,kBAA/BxC,EAAQwC,oBACjB6vF,EAAgBryF,EAAQwC,oBAAsB7yB,QAAME,WACpDA,EAAamwB,EAAQwC,qBAErB6vF,EAAgB3nH,GAAKiF,QAAME,WAC3BA,EAAa,MAENmwB,EAAQsyF,qBACyB,kBAA/BtyF,EAAQsyF,oBACjBD,EAAgBryF,EAAQsyF,oBAAsB5iH,YAC9CG,EAAamwB,EAAQsyF,qBAErBD,EAAgB3nH,GAAKgF,YACrBG,EAAa,OAKjB,IAAM0iH,EAAyC,CAC7CC,8BAA8B,EAC9BC,cAAe,CACbN,YACAv8E,WAAYw8E,EACZpyF,YAGJ7xB,OAAOhD,QAAQinH,GAAkBvqH,SAAQ,YAAgC,uBAA9B6qH,EAA8B,KAApBC,EAAoB,KACvE,GACG9xE,iBAAO8xE,IAAmBC,qBAAWD,IACtCE,YAA0BF,GAI1BN,EAAgBK,GAAYC,OACvB,GACqB,kBAAnBA,GACmB,kBAAnBA,EAEPJ,EAAkBG,GAAYC,MACzB,IAA8B,kBAAnBA,EAgBhB,MAAM,IAAI/mH,MAAJ,oDACyC8mH,EADzC,yGAdN,IAAKC,EAAe/9G,KAClB,MAAM,IAAIhJ,MAAJ,sCAAyCumH,EAAzC,YAAsDO,IAE9D,IACEL,EAAgBK,GDeT,SACbA,EADa,GASb,QANE77G,mBAMF,MANgB,GAMhB,EALErQ,EAKF,EALEA,MACAoO,EAIF,EAJEA,KACAgd,EAGF,EAHEA,aAGF,IAFEC,uBAEF,MAFoB,GAEpB,EACA,IAAKjd,EACH,MAAM,IAAIhJ,MAAM,sBAKlB,GAHKpF,IACHA,EAAQyqH,EAAWr8G,KAEhBpO,EACH,MAAM,IAAIoF,MAAJ,uCAC4BgJ,EAD5B,sCAKR,QAAqBpK,IAAjBonB,EACF,MAAM,IAAIhmB,MAAM,8BAKlB,IAAMknH,EAAsB,GAAH,OAAMJ,EAC5Bh2D,OAAO,GACPjoD,eAFsB,OAENi+G,EAAShtE,MAAM,GAFT,cAGrBqtE,EAAOpjH,QACRnJ,MAAMssH,EAAqB,CAC1BtkH,KAAMmB,QAAMye,QAAQskG,GACpB77G,YAAalH,QAAMye,QAAQvX,GAC3BjC,KAAMjF,QAAMye,QAAQxZ,GACpBvH,MAAOsC,QAAMC,SAASD,QAAMsC,MAAMggH,EAAgBzrH,GAAQorB,KAE3DmU,UAAS,iBAAO,CACflU,sBAEDxI,OAAM,SAAAtY,GAAI,MAAK,CACd,iBACE,OAAOugB,OAAOvgB,EAAK1D,OAAOgmC,WAAW,cAGxChqB,OAAM,SAAAtY,GAAI,MAAK,CACd,WACE,GAAIA,EAAKiiH,WAAY,KAEXtxG,EAAkBX,iBAAOhQ,GAAzB2Q,cAMR,OALKA,GAAiC,qBAAT+b,MAC3ByJ,QAAQU,KACN,6KAGGm5D,YAAuBzvE,OAAOvgB,EAAK1D,OAAb,OAAqBqU,QAArB,IAAqBA,OAArB,EAAqBA,EAAew9B,MAEnE,MAAO,CAAE2gD,SAAU,kBAAM9uF,EAAK1D,SAMhC,gBAIE,IAAcA,EAHd,IAAI0D,EAAKiiH,WAST,OANc3lH,EAMF0D,EAAK1D,QALFA,EAAMhC,OACVgC,EAAMhC,SAEf,WAAWgC,EAAX,UAKLslC,oBAAmB,SAAAxqB,GAAG,MACN,kBAARA,GAAoBA,EAAI3Z,OAASkkH,EACpCvqG,EACA,CACE3Z,KAAMkkH,EACN77G,cACAjC,OACAvH,MAAO8a,MAGdglB,qBAAoB,SAAAr7B,GACnB,MAA0B,kBAAfA,EAAKzE,MACPm6B,KAAKE,UAAU51B,EAAKzE,SAAWm6B,KAAKE,UAAU9V,GACjD9f,EAAKzE,WACL7C,EAECsH,EAAKzE,QAAUukB,EAAe9f,EAAKzE,WAAQ7C,KAEnDsG,SAAQ,SAAAC,GAAI,MAAK,CAChBtG,IADgB,SACZwoH,GACFliH,EAAK1D,MAAQ4lH,GAEfC,MAJgB,WAKdniH,EAAK1D,MAAQukB,GAEfuhG,kBAPgB,WAQVpiH,EAAKiiH,aAGTjiH,EAAK1D,MAAL,eAAqB0D,EAAKqiH,WAAa,QAEzCC,eAbgB,WAcd,GAAKtiH,EAAKiiH,WAAV,CAIA,IACE,IAAMM,EAAaviH,EAAK6uF,KAAKC,WAC7B,QAAmBr1F,IAAf8oH,EAEF,YADAviH,EAAK1D,MAAQimH,GAGf,MAAOlyF,IAQT,GALArwB,EAAK1D,MAAQukB,EAKT7gB,EAAKiiH,WAAY,CACnB,KAAMp+G,KAAQ28G,GACZ,MAAM,IAAI3lH,MAAJ,8CAAiDgJ,IAEzD7D,EAAK1D,MAAQkkH,EAAiB38G,UAOlC88G,EAAoB98G,KACtBm+G,EAAOA,EAAK5gD,OAAOu/C,EAAoB98G,KAGzC,IAMMqlD,EANgBtqD,QAAMC,SAASmjH,EAAM,CACzCvkH,KAAMkkH,EACN99G,OACAiC,cACAxJ,MAAOukB,IAIT,OADAzjB,OAAOolH,eAAet5D,EAAG,6BAA8B,CAAE5sD,OAAO,IACzD4sD,ECrK2Bu5D,CAC1Bd,EACAC,GAEF,MAAOvxF,GACP,MAAM,IAAIx1B,MAAJ,6CACkCumH,EADlC,YAC+CO,EAD/C,aAC4DtxF,EAAE1b,eAU1E,IAAI+tG,EAAgB9jH,QACjBnJ,MADiB,UACR2rH,EADQ,uBACwBE,GACzCvhH,SAAQ,SAAAC,GAAI,MAAK,CAChB2iH,aADgB,SAEdhB,EACA5nH,GAEA,IAAK+nH,YAA0BR,EAAgBK,IAC7C,MAAM,IAAI9mH,MAAJ,UAAa8mH,EAAb,wCAER,IAAMiB,EAAYj2F,0BAAgB5yB,GAC9BA,EACAunH,EAAgBK,GAAUn1F,OAAOzyB,GAErC,OADAiG,EAAK2hH,GAAYiB,EACVA,OAITxlH,OAAOlB,KAAKslH,GAAmB5oH,SACjC8pH,EAAgBA,EAAc1tF,UAAS,wBAErC/F,EAAQlvB,UACV2iH,EAAgBA,EAAc3iH,QAAQkvB,EAAQlvB,UAE5CkvB,EAAQ3W,QACVoqG,EAAgBA,EAAcpqG,MAAM2W,EAAQ3W,QAE1C2W,EAAQmyC,SACVshD,EAAgBA,EAActhD,OAAOnyC,EAAQmyC,SAE/CshD,EAAgBA,EAActmF,qBAAoB,SAAAr7B,GAChD,IAAM8hH,EAA6C,GAanD,OAXAzlH,OAAOhD,QAAQ2G,GAAMjK,SAAQ,YAAkB,IAnL5B43B,EAmL4B,mBAAhBr2B,EAAgB,KAAXiE,EAAW,UAEjC7C,IAAV6C,QAC2B7C,IAA3B+nH,EAAkBnpH,KApLL,kBAFEq2B,EAuLApyB,IApLlBgU,MAAM2f,QAAQvB,IACL,OAAVA,GAC8B,IAA9BtxB,OAAOlB,KAAKwyB,GAAO91B,UAIvB,SAAsB81B,GACpB,OAAOpe,MAAM2f,QAAQvB,IAA2B,IAAjBA,EAAM91B,OA8K9BkqH,CAAaxmH,KAGdumH,EAAQxqH,GAAOiE,MAGZumH,KAGL5zF,EAAQ2S,qBACV8gF,EAAgBA,EAAc9gF,mBAAmB3S,EAAQ2S,qBAG3D,IAAMmhF,EAAoBjkH,EAAa,eAAGA,EAAa,iBAAoB,GAO3E,OANmBF,QAAMC,SACvB6jH,EACAzzF,EAAQ3S,gBAAR,aACMzY,KAAMu9G,GAAc2B,GACtBA,GAkBD,SAAS/mG,EAIdolG,EACA4B,EACAC,GAC4B,MAjM9B,SACE7B,EACA4B,GAEA,IADAC,EACA,uDAD2C,GAE3C,GAAyB,kBAAd7B,EACT,MAAM,IAAIvmH,MACR,gFAMJ,IAAIwmH,EAAmB2B,EACnB/zF,EAAUg0F,EAed,OAbEA,EAAa5mG,mBACb4mG,EAAa5mG,kBAAkB6mG,0BAE/B7B,EAAmB,2BACd4B,EAAa5mG,kBAAkB6mG,yBAC/B7B,UAELpyF,EAAU,2BACJg0F,EAAa5mG,kBAAkB8mG,sBAAwB,IACxDF,IAEU5mG,mBAEV,CAAEglG,mBAAkBpyF,WAqKWm0F,CACpChC,EACA4B,EACAC,GAHM5B,EADoB,EACpBA,iBAAkBpyF,EADE,EACFA,QAKpBo0F,EAAalC,EACjBC,EACAC,EACApyF,GAMF,OAHAo0F,EAAW5B,8BAA+B,EAC1C4B,EAAWH,wBAA0B7B,EACrCgC,EAAWF,qBAAuBl0F,EAC3Bo0F,EAGF,SAASpnG,EAAuBonG,GACrC,OAAOzkH,QAAMsC,MAAMtC,QAAM0kH,UAAUD,GAAaA,K,iSCpQ5C93G,EAAiC,CACrCg4G,UAAW,UACXC,aAAc,UACdC,KAAM,UACNC,WAAY,UACZC,MAAO,UACPC,MAAO,UACPC,OAAQ,UACRC,MAAO,UACPC,eAAgB,UAChB58G,KAAM,UACN68G,WAAY,UACZC,MAAO,UACPC,UAAW,UACXC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,MAAO,UACPC,eAAgB,UAChBC,SAAU,UACVC,QAAS,UACTC,KAAM,UACNC,SAAU,UACVC,SAAU,UACVC,cAAe,UACfC,SAAU,UACVC,UAAW,UACXC,SAAU,UACVC,UAAW,UACXC,YAAa,UACbC,eAAgB,UAChBC,WAAY,UACZC,WAAY,UACZC,QAAS,UACTC,WAAY,UACZC,aAAc,UACdC,cAAe,UACfC,cAAe,UACfC,cAAe,UACfC,cAAe,UACfC,WAAY,UACZC,SAAU,UACVC,YAAa,UACbC,QAAS,UACTC,QAAS,UACTC,WAAY,UACZC,UAAW,UACXC,YAAa,UACbC,YAAa,UACbC,QAAS,UACTC,UAAW,UACXC,WAAY,UACZC,KAAM,UACNC,UAAW,UACXz7G,KAAM,UACNhE,MAAO,UACP0/G,YAAa,UACbtwC,KAAM,UACNuwC,SAAU,UACVC,QAAS,UACTC,UAAW,UACXC,OAAQ,UACRC,MAAO,UACPC,MAAO,UACPC,SAAU,UACVC,cAAe,UACfC,UAAW,UACXC,aAAc,UACdC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,qBAAsB,UACtBC,UAAW,UACXC,WAAY,UACZC,UAAW,UACXC,UAAW,UACXC,YAAa,UACbC,cAAe,UACfC,aAAc,UACdC,eAAgB,UAChBC,eAAgB,UAChBC,eAAgB,UAChBC,YAAa,UACbC,KAAM,UACNC,UAAW,UACXC,MAAO,UACPC,QAAS,UACTC,OAAQ,UACRC,iBAAkB,UAClBC,WAAY,UACZC,aAAc,UACdC,aAAc,UACdC,eAAgB,UAChBC,gBAAiB,UACjBC,kBAAmB,UACnBC,gBAAiB,UACjBC,gBAAiB,UACjBC,aAAc,UACdC,UAAW,UACXC,UAAW,UACXC,SAAU,UACVC,YAAa,UACbC,KAAM,UACNC,QAAS,UACTC,MAAO,UACPC,UAAW,UACXC,OAAQ,UACRC,UAAW,UACXC,OAAQ,UACRC,cAAe,UACfC,UAAW,UACXC,cAAe,UACfC,cAAe,UACfC,WAAY,UACZC,UAAW,UACXC,KAAM,UACNC,KAAM,UACNC,KAAM,UACNC,WAAY,UACZC,OAAQ,UACRC,cAAe,UACfnjH,IAAK,UACLojH,UAAW,UACXC,UAAW,UACXC,YAAa,UACbC,OAAQ,UACRC,WAAY,UACZC,SAAU,UACVC,SAAU,UACVC,OAAQ,UACRC,OAAQ,UACRC,QAAS,UACTC,UAAW,UACXC,UAAW,UACXC,UAAW,UACXC,KAAM,UACNC,YAAa,UACbC,UAAW,UACXC,IAAK,UACLC,KAAM,UACNC,QAAS,UACTC,OAAQ,UACRC,UAAW,UACXC,OAAQ,UACRC,MAAO,UACPC,MAAO,UACPC,WAAY,UACZC,OAAQ,UACRC,YAAa,WAGR,SAASC,EAAgB7uH,GAC9B,OAAO8N,EAAO9N,GAGT,SAAS8uH,EAAa9uH,GAC3B,QAAS8N,EAAO9N,GC1IX,SAAS47E,EAAqBlwE,GAEnC,OADkBqjH,EAAarjH,GACZ,GAAM,QAAU,QAcrC,SAASqjH,EAAarjH,GACpB,IAAMsjH,EAAiBH,EAAgBnjH,GACvC,OAAOujH,uBAAgBD,GAAkBtjH,GAapC,SAASu7E,EAAUv7E,GAA2C,IAA5BwjH,EAA4B,uDAAd,IAC/CF,EAAiBH,EAAgBnjH,GACvC,OAAOyjH,oBAAaH,GAAkBtjH,EAAOwjH,GAGxC,SAASE,EACdC,GAUA,IAPA,IAFAtjH,EAEA,uDAFa,QACbujH,EACA,uDADmB,EAEfC,EAAsBV,EAAgBQ,IAAeA,EACnDG,EAAsBX,EAAgB9iH,IAAeA,EACrD0jH,EAAsBV,EAAaS,GACrCE,EAAgBC,2BAAiBJ,EAAqBC,GACpDI,EAAgBL,EAClBL,EAAc,IACXQ,EAAgBJ,GACrBC,EACEE,EAAsB,GAClBrxE,iBAAOwxE,EAAeV,GACtBhxE,kBAAQ0xE,EAAeV,GAC7BA,GAAe,IACfQ,EAAgBC,2BAAiBJ,EAAqBC,GAExD,OAAOD,I,iCC3ET,oTAeO,SAAShjC,EAAWnmF,GACzB,MACA,GAAIypH,yBAAJ,GACEt/E,EAAInqC,YAAiBA,EAArBmqC,SACK,KAAIq+D,2BAAqBK,oBAAzB,GAEA,wBAAW7oG,EAAP,WACT,OAAOA,EAAP,aAEA,MAAM,IAAI4+B,UAAV,wBAJAuL,EAAInqC,YAAiBA,EAAjBA,UAAkCA,EAAtCmqC,QAMF,MAEE,MAAM,IAAInzC,MAAV,yBAEF,SAQK,SAAS0yH,EAAiBC,GAC/B,IAAKC,sBAAL,GACE,MAAM,IAAIhrF,UAAV,yBAEF,IAAMuL,EACJw/E,UACAA,EADAA,OAEAxjC,KAFAwjC,QAGAxjC,KAJF,MAKA,MAEE,MAAM,IAAInvF,MAAV,6CAEF,SAUK,SAASivF,EAAgBjmF,EAAM6pH,GAEpC,OADqB7pH,aAArB,GAQK,SAASgmC,EAAgBhmC,GAC9B,IAAKypH,yBAAL,GACE,MAAM,IAAI7qF,UAAV,iCAEF,OAAO5+B,iBAAsBA,EAA7B,aAIK,SAASkmF,EAAqBlmF,GAGnC,OAFiB0pH,EADwB,GAGlC,KAAa,SAAAv/E,GAAC,OAAIA,EAAJ,SAGhB,SAAS2/E,EAAgBC,GAC9B,OACGH,sBAAD,IACCphB,sBADD,KAEAwV,qBAHF,GAOA,EAFS+L,EAAP,e,iCCnFG,SAASC,EACdC,EACAC,EACAC,EACAC,GAGA,OAAIF,EAASC,GAASF,EAAQG,GAAUA,EAASD,GAASD,EAASD,EAC7DA,EAAQE,EACND,EAASE,EAGJ,CAACH,EAAOC,GAIV,CAACD,EAAOG,GAEbF,EAASE,EAGJ,CAACD,EAAOD,GAIV,CAACC,EAAOC,GAEV,GAaF,SAASxhE,EACdqhE,EACAC,EACAC,EACAC,GAEA,OAAOF,EAASC,GAASF,EAAQG,EAW5B,SAASjjC,EACd8iC,EACAC,EACAC,EACAC,GAEA,OAAOD,GAASF,GAASG,GAAUF,EAtErC,uG,qNCEal3H,EAAb,WAGE,aAAsC,IAA1BD,EAA0B,uDAAJ,GAAI,yBAFtCA,OAAsB,GAGpByC,KAAKzC,OAASA,EAJlB,wCAOE,SAAKggB,GACH,GAAIA,aAAiBle,GACfW,KAAKzC,OAAOgC,OAAQ,CACtB,IAAMs1H,EAAY70H,KAAKzC,OAAOyC,KAAKzC,OAAOgC,OAAS,GACnD,GAAIs1H,aAAqBx1H,EAEvB,YADAw1H,EAAU31H,KAAKqe,GAMrBvd,KAAKzC,OAAO2B,KAAKqe,KAlBrB,uBAqBE,WACE,OAAOvd,KAAKzC,SAtBhB,wBAyBE,WACE,OAAOyC,KAAKzC,OAAOwH,KAAI,SAAAwY,GAAK,OAAIA,EAAM2jB,gBA1B1C,iBA6BE,SAAiB36B,EAAeuuH,GAC9B,OAAO90H,KAAKzC,OAAOwH,IAAIwB,EAAMuuH,KA9BjC,qBAiCE,SAAqBvuH,EAAeuuH,GAClC,OAAO90H,KAAKzC,OAAOE,QAAQ8I,EAAMuuH,KAlCrC,kBAqCE,WACE,OAAO90H,KAAKzC,OAAOgC,SAtCvB,wBAyCE,WACE,OAAOS,KAAKzC,OAAOgC,OACfS,KAAKzC,OAAOwH,KAAI,SAAAxH,GAAM,OAAIA,EAAOwB,WAAS41B,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,KAC/D,IA5CR,sCA+CE,WACE,OAAOh1B,KAAKzC,OAAOgC,OACfS,KAAKzC,OACFutB,QAAO,SAAAvN,GAAK,MAAsB,aAAlBA,EAAMne,WACtB2F,KAAI,SAAAxH,GAAM,OAAIA,EAAOwB,WACrB41B,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,KACxB,IArDR,oBAwDE,WACE,OAAOh1B,KAAKzC,OAAOgC,OAASS,KAAKzC,OAAO,GAAGZ,SAAW,IAzD1D,yBA4DE,WACE,OAAOqD,KAAKzC,OAAOutB,QAAO,SAAAvN,GAAK,OAAIA,aAAiBje,OA7DxD,mBAgEE,WACE,OAAOU,KAAKwgC,cACTz7B,KAAI,SAAAwY,GAAK,OAAIA,EAAMtf,IAAMsf,EAAMxf,SAC/B42B,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,OAnE/B,KAuEa+/F,EAAb,WAoBE,WAAYr0H,GAAW,yBAhBhB7C,aAgBgB,OAdhBE,WAcgB,OAZhBE,SAYgB,OAVhBL,kBAUgB,OARhBoB,SAQgB,OANhBrC,cAMgB,EACrBoH,OAAOixH,OAAOh1H,KAAMU,GACpBV,KAAKpC,aAAe8C,EAAK9C,aACzBoC,KAAKnC,QAAU6C,EAAK7C,QACpBmC,KAAKjC,MAAQ2C,EAAK3C,MAClBiC,KAAK/B,IAAMyC,EAAKzC,IAChB+B,KAAKhB,IAAM0B,EAAK1B,IAChBgB,KAAKrD,SAAW+D,EAAK/D,SA3BzB,mDAqCE,SAAgBkB,GACd,OAAImC,KAAKnC,SAAWA,IAAYmC,KAAKnC,QAE5B,IAAKmC,KAAKgsC,YAAV,2BAAmChsC,MAAnC,IAAyCnC,aAE3CmC,OA1CX,sBA6CE,WACE,MAAO,CACLnC,QAASmC,KAAKnC,QACdE,MAAOiC,KAAKjC,MACZE,IAAK+B,KAAK/B,IACVL,aAAcoC,KAAKpC,aACnBM,SAAU8B,KAAK9B,cAnDrB,KAwDaoB,EAAb,4HAAkCy1H,GAMrB11H,EAAb,kDAIE,WAAYqB,GAA2B,kCACrC,cAAMA,IAJD3B,aAGgC,EAErC,EAAKA,QAAU2B,EAAK3B,QAFiB,EAJzC,wCASE,SAAKk2H,GACHj1H,KAAKk1H,kBAAoB,EAErBD,IACFj1H,KAAKnC,QAAU,GACfmC,KAAKjC,MAAQ,EACbiC,KAAK/B,IAAM,EACX+B,KAAKjB,SAAWk2H,EAAWl2H,aAhBjC,GAAiCg2H,GAyBpB51H,EAAb,4HAA6C41H,I,yFChJvC1iG,EAAa9sB,QAChBnJ,MAAM,aAAc,CACnBQ,iBAAkB2I,QAAM6oB,MAAMvoB,UAC9BhJ,QAAS,EACTF,SAAU,EACVI,wBAAyBwI,QAAMC,SAASD,QAAMW,OAAQ,GACtDpJ,kBAAmByI,QAAMC,SAASD,QAAMW,OAAQ,KAEjDy1B,UAAS,iBAAO,CACf9U,cAAUzmB,EACVuoE,cAAe,MAEhBjiE,SAAQ,SAAAC,GAAI,MAAK,CAChBmiE,oBADgB,SACI9hD,GAClBrgB,EAAK/J,iBAAmBsgC,eAAKlW,IAE/B+hD,WAJgB,SAILhrD,GACTpX,EAAK9J,QAAUkhB,GAEjB4sD,iBAPgB,SAOCnuE,GACfmK,EAAKgiE,cAAgBnsE,OAGxByiB,OAAM,SAAAtY,GAAI,MAAK,CACd,YACE,OAAOA,EAAKgiE,eAGd,8BACE,OAAO3oE,KAAKgpE,QAAUriE,EAAK9J,SAG7B,gBAGE,OAAOmD,KAAKmhH,wBADQ,IAItB,gBAGE,OADqB,GACbnhH,KAAKxD,OAEf,cACE,OAAOmK,EAAK/J,iBACTmI,KAAI,SAAApD,GAAC,OAAIA,EAAE1D,IAAM0D,EAAE5D,SACnB42B,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,IAU7BqlC,OAjCc,YAyCX,WAPDx8D,EAOC,EAPDA,QACA2/C,EAMC,EANDA,MACA7/C,EAKC,EALDA,aAMI6jH,EAAW,EAETC,EAAuB96G,EAAK5J,wBAA0B4J,EAAK9J,QAC3D6kH,EAAiB/6G,EAAK7J,kBAAoB6J,EAAK9J,QAC/C8M,EAAQhD,EAAK/J,iBAAiBgrC,WAAU,SAAClqC,EAAQy6D,GACrD,IAAMnJ,EAAMtxD,EAAOO,IAAMP,EAAOK,MAChC,OACEF,IAAYH,EAAOG,SACnB2/C,GAAS9/C,EAAOK,OAChBy/C,GAAS9/C,EAAOO,OAEZN,GAAeA,IAAiBw6D,IAClCqpD,GAAY9jH,EAAOQ,SACfR,EAAOO,IAAMu/C,EACbA,EAAQ9/C,EAAOK,OACZ,IAOTL,EAAOO,IAAMP,EAAOK,MAAQ2jH,GAC5BF,EAAW76G,EAAK9J,QAAU,GAC1B2kH,EAAW76G,EAAK9J,QAAU,EAAKL,MAE/BglH,GAAYxyD,EAAMyyD,EAElBD,GAAYxyD,GAEP,MAIT,GADoBroD,EAAK/J,iBAAiB+M,GAExC,OAAOvM,KAAK66C,MAAMupE,EAAW76G,EAAK9J,UAMtCu/D,OAnFc,SAmFP3hB,GACL,IAAIknE,EAAU,EACRC,GAAMj7G,EAAKhK,SAAW89C,GAAM9zC,EAAK9J,QACjCyhC,EAAI33B,EAAK/J,iBAAiB2C,OAChC,GAAIqiH,EAAK,EAAG,CACV,IAAMlkH,EAASiJ,EAAK/J,iBAAiB,GAC/BgF,EAASggH,EACf,kCACK53F,sBAAYtsB,IADjB,IAEEmkH,KAAK,EACLrkE,MAAO9/C,EAAOQ,SACVd,KAAKiB,MAAMX,EAAOO,IAAM2D,GAAU,EAClCxE,KAAKiB,MAAMX,EAAOK,MAAQ6D,GAAU,EACxCA,SACA+H,MAAO,IAOX,IAHA,IAAM83G,EAAuB96G,EAAK5J,wBAA0B4J,EAAK9J,QAC3D6kH,EAAiB/6G,EAAK7J,kBAAoB6J,EAAK9J,QAE5C8M,EAAQ,EAAGA,EAAQhD,EAAK/J,iBAAiB2C,OAAQoK,GAAS,EAAG,CACpE,IAAMjM,EAASiJ,EAAK/J,iBAAiB+M,GAC/BqlD,EAAMtxD,EAAOO,IAAMP,EAAOK,MAC1B6D,EAASggH,EAAKD,EACpB,GAAI3yD,EAAM2yD,EAAUC,GAAMD,GAAWC,EACnC,kCACK53F,sBAAYtsB,IADjB,IAEEmkH,KAAK,EACLjgH,SACA47C,MAAO9/C,EAAOQ,SACVd,KAAKiB,MAAMX,EAAOO,IAAM2D,GAAU,EAClCxE,KAAKiB,MAAMX,EAAOK,MAAQ6D,GAAU,EACxC+H,UAOFjM,EAAOO,IAAMP,EAAOK,MAAQ2jH,GAC5B9/G,EAAS+E,EAAK9J,QAAU,GACxB+E,EAAS+E,EAAK9J,QAAUmD,KAAKxD,MAE7BmlH,GAAW3yD,EAAMyyD,EAEjBE,GAAW3yD,EAIf,GAAI4yD,GAAMD,EAAS,CACjB,IAAMjkH,EAASiJ,EAAK/J,iBAAiB0hC,EAAI,GAEnC18B,EAASggH,EAAKD,GADRjkH,EAAOO,IAAMP,EAAOK,OAEhC,kCACKisB,sBAAYtsB,IADjB,IAEEmkH,KAAK,EACLjgH,SACA47C,MAAO9/C,EAAOQ,SACVd,KAAKiB,MAAMX,EAAOO,IAAM2D,GAAU,EAClCxE,KAAKiB,MAAMX,EAAOK,MAAQ6D,GAAU,EACxC+H,MAAO20B,EAAI,IAGf,MAAO,CACLkf,MAAO,EACP7zC,MAAO,EACP5L,MAAO,EACPF,QAAS,GACTgkH,KAAK,EACLjkH,aAAc,GACdgE,OAAQ,EACR1D,UAAU,QAIf+gB,OAAM,SAAAtY,GAAI,MAAK,CACd,oBACE,OAAOuhE,YAAuBvhE,IAEhC,mBACE,OAAOxK,YAAsBwK,IAE/B,aACE,OAAO3G,KAAKsiC,cACTv9B,KAAI,SAAApD,GAAC,OAAIA,EAAE1D,IAAM0D,EAAE5D,SACnB42B,QAAO,SAAChzB,EAAGqzB,GAAJ,OAAUrzB,EAAIqzB,IAAG,QAG9BtuB,SAAQ,SAAAC,GAAI,MAAK,CAChBslE,YADgB,SACJplD,GACVlgB,EAAKkgB,SAAWA,GAGlB89F,uBALgB,SAMd9nE,EACAkF,GAEA,QAAe3hD,IAAXy8C,QAAoCz8C,IAAZ2hD,EAA5B,CAOA,GAFElF,EAAOh/C,UAAYkkD,EAAQlkD,SAAWg/C,EAAOlzC,QAAUo4C,EAAQp4C,OAG9Co4C,EAAQngD,OAASi7C,EAAOj7C,QACzCi7C,EAAOlzC,MAAQo4C,EAAQp4C,MACvB,OACqB,CAACo4C,EAASlF,GAA7BA,EADF,KACUkF,EADV,KAGF,IAAM6iE,EAAc,CAClB7mH,MAAO8+C,EAAO9+C,MACdE,IAAK4+C,EAAO5+C,IACZ0L,MAAOkzC,EAAOlzC,MACd/H,OAAQi7C,EAAOj7C,QAEXijH,EAAY,CAChB9mH,MAAOgkD,EAAQhkD,MACfE,IAAK8jD,EAAQ9jD,IACb0L,MAAOo4C,EAAQp4C,MACf/H,OAAQmgD,EAAQngD,QAElB,IAAIgjH,IAAeC,EAGjB,MAAM,IAAIrjH,MAAM,qBAFhBxB,KAAK4hD,OAAOgjE,EAAaC,KAQ7BY,eA3CgB,WA4Cd9+G,EAAK9J,QAAU8J,EAAKqiE,QAAUriE,EAAKnK,MACnCmK,EAAKhK,SAAW,GASlBilD,OAtDgB,SAsDT7jD,EAAiBE,GAEtB,IAAI0jH,EAAU,EAEd,GAAI5jH,EAAM4L,QAAU1L,EAAI0L,MACtBg4G,GAAW1jH,EAAI2D,OAAS7D,EAAM6D,WACzB,CACL,IAAM8yB,EAAI/tB,EAAK/J,iBAAiBmB,EAAM4L,OAEtC,GADAg4G,GAAWjtF,EAAEz2B,IAAMy2B,EAAE32B,MAAQA,EAAM6D,OAC/B3D,EAAI0L,MAAQ5L,EAAM4L,OAAS,EAC7B,IAAK,IAAIqpB,EAAIj1B,EAAM4L,MAAQ,EAAGqpB,EAAI/0B,EAAI0L,MAAOqpB,GAAK,EAChD2uF,GACEh7G,EAAK/J,iBAAiBo2B,GAAG/0B,IAAM0I,EAAK/J,iBAAiBo2B,GAAGj1B,MAG9D4jH,GAAW1jH,EAAI2D,OAEjB5B,KAAK4qE,OACH+2C,GACGh7G,EAAKnK,MACJmK,EAAK5J,yBAA2BkB,EAAI0L,MAAQ5L,EAAM4L,SAIxD,IADA,IAAIw7G,EAAY,EACPnyF,EAAI,EAAGA,EAAIrsB,EAAK/J,iBAAiB2C,OAAQyzB,GAAK,EAAG,CACxD,IAAMt1B,EAASiJ,EAAK/J,iBAAiBo2B,GACrC,GAAIj1B,EAAM4L,QAAUqpB,EAAG,CACrBmyF,GAAapnH,EAAM6D,OACnB,MAEAujH,GAAaznH,EAAOO,IAAMP,EAAOK,MAGrC4I,EAAKhK,SACHS,KAAK66C,MAAMktE,EAAYx+G,EAAK9J,SAC5B8J,EAAK5J,wBAA0BgB,EAAM4L,OAGzC0/D,QA5FgB,WA6FdrpE,KAAK4qE,OAAsB,EAAfjkE,EAAK9J,UAGnB0sE,OAhGgB,WAiGdvpE,KAAK4qE,OAAOjkE,EAAK9J,QAAU,IAG7B+tE,OApGgB,SAoGT43C,GAA6C,IAAzB5gH,EAAyB,uDAAhB+E,EAAKnK,MAAQ,EACzCK,EAAU2lH,EAChB,GAAI3lH,IAAY8J,EAAK9J,QAArB,CAGA,IAAM8lH,EAAah8G,EAAK9J,QACxB8J,EAAK9J,QAAUA,EAGf8J,EAAKhK,SAAW69D,gBACdp9D,KAAK66C,OAAQtxC,EAAKhK,SAAWiF,GAAU+gH,EAAc9lH,EAAU+E,GAC/D+E,EAAK27G,UACL37G,EAAK47G,aAIT4S,OApHgB,SAoHTnhH,GACL,IAAMqxG,EAAc1+G,EAAKhK,SAEnB0lH,EAAc7nD,gBAClB7zD,EAAKhK,SAAWqX,EAChBrN,EAAK27G,UACL37G,EAAK47G,WAGP,OADA57G,EAAKhK,SAAW0lH,EACTA,EAAcgD,OAOZhzF,O,gPCrUT+iG,EAAsB,IAG5B,SAASC,EACPp5D,EACAC,EACAI,EACAC,GAEA,OAAOL,GAAMI,GAAMC,GAAMN,E,IAUrBq5D,E,WASJ,aAAc,yBARNj5H,aAQM,OANNk5H,eAMM,OAJNC,gBAIM,OAFNC,cAEM,EACZz1H,KAAK3D,QAAU,EACf2D,KAAKw1H,WAAa,I,gDAepB,SAAa90H,GACXV,KAAKu1H,UAAY70H,I,uBAGnB,SAAUs/B,GACR,GAAIhgC,KAAKu1H,UACP,OAAOv1H,KAAKu1H,UAEd,GAAKv1H,KAAKy1H,eAIgBr1H,IAAtBJ,KAAKy1H,SAAS72H,OAGdohC,EAAIhgC,KAAKy1H,SAAS72H,QAGlBohC,GAAKhgC,KAAKy1H,SAAS92H,KAAvB,CAGA,IAAMiD,EAASo+B,EAAIhgC,KAAKy1H,SAAS7zH,OAKjC,OAAO5B,KAAKy1H,SAASC,KAAK9zH,M,0BAG5B,SAAarB,EAAcC,GACzB,GAAIR,KAAKu1H,UACP,OAAO,EAGT,IAAKv1H,KAAKy1H,SACR,OAAO,EANwC,MAS5Bz1H,KAAKy1H,SAAlB72H,EATyC,EASzCA,IAAKD,EAToC,EASpCA,IAEb,GAAI6B,GAAS5B,GAAO2B,GAAQ5B,EAC1B,OAAO,EAMT,IAFA,IAAMkhC,EAAOziC,KAAKwB,IAAID,EAAK6B,GACvBw/B,EAAI5iC,KAAKuB,IAAIC,EAAK2B,GACfy/B,EAAIx/B,GAASw/B,EAAIH,EAAMG,GAAK,EACjC,GAAIhgC,KAAK21H,UAAU31F,GACjB,OAAO,EAIX,OAAO,I,wBAGT,SAAWz/B,EAAcC,GAEvB,IAAMo1H,EAAYp1H,EAAQD,EAC1B,MAAO,CACLqB,OAAQrB,EAAOq1H,EACfh3H,IAAK2B,EACL5B,IAAK6B,EACLk1H,KAAM,IAAIz+G,MAAM,EAAI2+G,M,qBAKxB,SAAQ17F,EAAoBx5B,GAC1B,IAAMH,EAAO25B,EAAK8oB,EACZxiD,EAAQ05B,EAAK5R,EAAItoB,KAAK3D,QACvB2D,KAAKy1H,WACRz1H,KAAKy1H,SAAWz1H,KAAK61H,WAAWt1H,EAAMC,IAKxC,IAAIs1H,EAAQv1H,EAAOP,KAAKy1H,SAAS7zH,OAC7Bm0H,EAASv1H,EAAQR,KAAKy1H,SAAS7zH,OAC7Bo0H,EAAah2H,KAAKy1H,SAASC,KAAKn2H,OAItC,GAAIw2H,GAAU/1H,KAAKy1H,SAASC,KAAKn2H,OAAQ,CACvC,IAAM02H,EAAmBF,EAAS,EAC9B/1H,KAAKy1H,SAASC,KAAKn2H,OAAS02H,EAAmBj2H,KAAKw1H,YACtD14F,QAAQU,KACN,8GAEFx9B,KAAKy1H,SAAWz1H,KAAK61H,WAAWt1H,EAAMC,IAC7By1H,EAAmB,IAC5Bj2H,KAAKy1H,SAASC,KAAO11H,KAAKy1H,SAASC,KAAK3hE,OACtC,IAAI98C,MAAMg/G,KAMhB,GAAI11H,EAAOP,KAAKy1H,SAAS7zH,OAAQ,CAE/B,IAAMq0H,EAAmB74H,KAAKwB,IAC5Bo3H,EAAaF,EACb91H,KAAKy1H,SAAS7zH,QAEZ5B,KAAKy1H,SAASC,KAAKn2H,OAAS02H,EAAmBj2H,KAAKw1H,YACtD14F,QAAQU,KACN,8GAGFx9B,KAAKy1H,SAAWz1H,KAAK61H,WAAWt1H,EAAMC,KAEtCR,KAAKy1H,SAASC,KAAO,IAAIz+G,MAAMg/G,GAAkBliE,OAC/C/zD,KAAKy1H,SAASC,MAEhB11H,KAAKy1H,SAAS7zH,QAAUq0H,IAG5BF,EAASv1H,EAAQR,KAAKy1H,SAAS7zH,SAC/Bk0H,EAAQv1H,EAAOP,KAAKy1H,SAAS7zH,QAlKJ,KA0KvBk7B,QAAQU,KAAR,oDAEIu4F,EAASD,EAFb,0BAIE57F,EACAx5B,GAIJ,IAAK,IAAIs/B,EAAI81F,EAAO91F,EAAI+1F,EAAQ/1F,GAAK,EAEnChgC,KAAKy1H,SAASC,KAAK11F,GAAKt/B,EAGtBH,EAAOP,KAAKy1H,SAAS72H,MACvBoB,KAAKy1H,SAAS72H,IAAM2B,GAElBC,EAAQR,KAAKy1H,SAAS92H,MACxBqB,KAAKy1H,SAAS92H,IAAM6B,K,0BAQxB,SAAaD,EAAcC,GACzB,IAAIR,KAAKu1H,WAKJv1H,KAAKy1H,YAKNj1H,GAASR,KAAKy1H,SAAS72H,KAAO2B,GAAQP,KAAKy1H,SAAS92H,KAKxD,GAAI4B,GAAQP,KAAKy1H,SAAS72H,KAAO4B,GAASR,KAAKy1H,SAAS92H,IACtDqB,KAAKy1H,cAAWr1H,MADlB,CAgBA,GAVII,EAAQR,KAAKy1H,SAAS72H,KAAO2B,GAAQP,KAAKy1H,SAAS72H,MACrDoB,KAAKy1H,SAAS72H,IAAM4B,GAIlBD,EAAOP,KAAKy1H,SAAS92H,KAAO6B,GAASR,KAAKy1H,SAAS92H,MACrDqB,KAAKy1H,SAAS92H,IAAM4B,GAKpBP,KAAKy1H,SAAS7zH,OAAS5B,KAAKy1H,SAAS72H,IAAMw2H,GAC3Cp1H,KAAKy1H,SAASC,KAAKn2H,OACjBS,KAAKy1H,SAAS92H,IAAMy2H,EAAsBp1H,KAAKy1H,SAAS7zH,OAC1D,CAEA,IAAMs0H,EAAiBl2H,KAAKy1H,SAAS72H,IAAMoB,KAAKy1H,SAAS7zH,OACnDu0H,EACJn2H,KAAKy1H,SAASC,KAAKn2H,OACnB,GACCS,KAAKy1H,SAAS92H,IAAMqB,KAAKy1H,SAAS7zH,QAIrC5B,KAAKy1H,SAASC,KAAO11H,KAAKy1H,SAASC,KAAKp6E,MACtC46E,EACAl2H,KAAKy1H,SAASC,KAAKn2H,OAAS42H,GAE9Bn2H,KAAKy1H,SAAS7zH,QAAUs0H,OAGnB,GAAIl2H,KAAKy1H,SAAS7zH,OAAS5B,KAAKy1H,SAAS72H,IAAMw2H,EAAqB,CAEzE,IAEMgB,EADJp2H,KAAKy1H,SAAS72H,IAAMxB,KAAKiB,MAAM+2H,KACEp1H,KAAKy1H,SAAS7zH,OAEjD5B,KAAKy1H,SAASC,KAAK7tF,OAAO,EAAGuuF,GAC7Bp2H,KAAKy1H,SAAS7zH,QAAUw0H,OAGnB,GACLp2H,KAAKy1H,SAASC,KAAKn2H,OACnBS,KAAKy1H,SAAS92H,IAAMqB,KAAKy1H,SAAS7zH,OAASwzH,EAC3C,CAEA,IAAMiB,EACJr2H,KAAKy1H,SAAS92H,IACdqB,KAAKy1H,SAAS7zH,OACd,EACAxE,KAAKiB,MAAM+2H,KAGbp1H,KAAKy1H,SAASC,KAAKn2H,OAAS82H,EAgB9B,IAPA,IAAMP,EAAQ14H,KAAKuB,IAAIqB,KAAKy1H,SAAS72H,IAAK2B,GAAQP,KAAKy1H,SAAS7zH,OAM1Dm0H,EAAS34H,KAAKwB,IAAI4B,EAAOR,KAAKy1H,SAAS92H,KAAOqB,KAAKy1H,SAAS7zH,OACzDo+B,EAAI81F,EAAO91F,GAAK,GAAKA,EAAI+1F,EAAQ/1F,GAAK,EAC7ChgC,KAAKy1H,SAASC,KAAK11F,QAAK5/B,O,KAKTk2H,E,WAmBnB,aAeQ,6DAAJ,GAAI,IAdNC,cAcM,MAdG,GAcH,MAbNC,cAaM,MAbG,GAaH,MAZNp3G,iBAYM,MAZM,IAYN,MAXNq3G,oBAWM,MAXS,IAWT,MAVNpzF,mBAUM,MAVQ,SAUR,2BAjCAkzF,YAiCA,OA/BAC,YA+BA,OA7BAC,kBA6BA,OA3BAC,YA2BA,OAzBAr3F,gBAyBA,OAvBDvG,sBAuBC,OArBA1Z,eAqBA,OAnBAikB,iBAmBA,OAjBAszF,kBAiBA,EACN32H,KAAKu2H,OAASA,EACdv2H,KAAKw2H,OAASA,EACdx2H,KAAKy2H,aAAeA,EACpBz2H,KAAK84B,kBAAmB,EACxB94B,KAAKqjC,YAAcA,EAGM,YAArBrjC,KAAKqjC,cACPrjC,KAAKw2H,OAASp5H,KAAK66C,MAAMj4C,KAAKw2H,OAAS,IAAM,EAC7Cx2H,KAAKu2H,OAASn5H,KAAK66C,MAAMj4C,KAAKu2H,OAAS,IAAM,GAG/Cv2H,KAAK02H,OAAS,GACd12H,KAAKq/B,WAAa,IAAIu3F,gBACtB52H,KAAKof,UAAYhiB,KAAKC,KAAK+hB,EAAYpf,KAAKw2H,QAC5Cx2H,KAAK22H,aAAe,E,2CAOtB,SACEr2H,EACAC,EACAC,EACAC,EACAC,GAIA,IAAMm2H,EAAY72H,KAAKq/B,WAAWl/B,IAAIG,GACtC,GAAIu2H,EACF,OAAsB,OAAlBA,EAAU5hH,IACL,MAITjV,KAAK82H,gBAAgBD,GACdA,EAAU5hH,IAAMjV,KAAKw2H,QAG9B,IAAMO,EAAQ35H,KAAKiB,MAAMkC,EAAOP,KAAKu2H,QAC/BS,EAAS55H,KAAKiB,MAAMmC,EAAQR,KAAKu2H,QACjCU,EAAU75H,KAAKC,KAAKoD,EAAST,KAAKw2H,QAGlCU,EAA0B,CAC9B52H,KACA0iD,EAAG+zE,EACHzuG,EAAG0uG,EACH/hH,IAAK,KAEL/Q,EAAG+yH,EACHE,eAAgB12H,EAChBC,QAGI02H,EAASp3H,KAAKof,UAAY63G,EAC5BhiH,EAAM,EACV,GAAyB,aAArBjV,KAAKqjC,YAA4B,CACnC,KAAOpuB,GAAOmiH,GACPp3H,KAAKmgC,SAAS+2F,EAAWjiH,GADVA,GAAO,GAM7B,GAAIA,EAAMmiH,EAIR,OAHAF,EAAUjiH,IAAM,KAChBjV,KAAKq/B,WAAWh/B,IAAIC,EAAI42H,GACxBl3H,KAAK84B,kBAAmB,EACjB,KAQX,OALAo+F,EAAUjiH,IAAMA,EAChBjV,KAAK82H,gBAAgBI,GACrBl3H,KAAKq/B,WAAWh/B,IAAIC,EAAI42H,GACxBl3H,KAAK22H,aAAev5H,KAAKuB,IAAIqB,KAAK22H,cAAgB,EAAG1hH,EAAMgiH,GAEpDhiH,EAAMjV,KAAKw2H,S,sBAGpB,SAASt8F,EAAoBjlB,GAM3B,IANiD,IACzCyhH,EAAW12H,KAAX02H,OAIF52F,EAAO7qB,EAAMilB,EAAKh2B,EACf+7B,EAAIhrB,EAAKgrB,EAAIH,EAAMG,GAAK,EAAG,CAClC,IAAMwwC,EAAMimD,EAAOz2F,GACnB,GAAIwwC,IAAQA,EAAI4mD,aAAan9F,EAAK8oB,EAAG9oB,EAAK5R,GACxC,OAAO,EAIX,OAAO,I,2BAMT,SAAsBouG,EAAwBz2F,GAC5C,IAAIwwC,EAAMimD,EAAOz2F,GACjB,IAAKwwC,EAAK,CACR,GAAIxwC,EAAIjgC,KAAKy2H,aACX,MAAM,IAAIj1H,MAAJ,6BAEFxB,KAAKy2H,aAAez2H,KAAKw2H,OAFvB,kCAMR/lD,EAAM,IAAI6kD,EACVoB,EAAOz2F,GAAKwwC,EAEd,OAAOA,I,6BAGT,SAAgBv2C,GACd,GAAiB,OAAbA,EAAKjlB,IAAT,CAIA,IAAMvU,EAAOw5B,EAAKx5B,OAAQ,EAClBg2H,EAAW12H,KAAX02H,OACFY,EAAOp9F,EAAKjlB,IAAMilB,EAAKh2B,EAC7B,GAAIg2B,EAAK5R,EAAI4R,EAAK8oB,EArcO,IA4cvB,IAAK,IAAI/iB,EAAI/F,EAAKjlB,IAAKgrB,EAAIq3F,EAAMr3F,GAAK,EACpCjgC,KAAKu3H,cAAcb,EAAQz2F,GAAGu3F,aAAa92H,QAG7C,IAAK,IAAIu/B,EAAI/F,EAAKjlB,IAAKgrB,EAAIq3F,EAAMr3F,GAAK,EACpCjgC,KAAKu3H,cAAcb,EAAQz2F,GAAGr/B,QAAQs5B,EAAMx5B,M,0BASlD,SAAaH,EAAcC,GAKzB,IAHA,IAAMu2H,EAAQ35H,KAAKiB,MAAMkC,EAAOP,KAAKu2H,QAC/BS,EAAS55H,KAAKiB,MAAMmC,EAAQR,KAAKu2H,QAC/BG,EAAW12H,KAAX02H,OACCz2F,EAAI,EAAGA,EAAIy2F,EAAOn3H,OAAQ0gC,GAAK,EAAG,CACzC,IAAMwwC,EAAMimD,EAAOz2F,GACfwwC,GACFA,EAAI3vE,aAAai2H,EAAOC,M,qBAK9B,SAAQ12H,GACN,OAAON,KAAKq/B,WAAW18B,IAAIrC,K,wBAG7B,SAAW0/B,EAAWC,GACpB,IAAMw3F,EAAKr6H,KAAKiB,MAAM4hC,EAAIjgC,KAAKw2H,QACzB/lD,EAAMzwE,KAAK02H,OAAOe,GACxB,GAAKhnD,EAAL,CAGA,IAAMinD,EAAKt6H,KAAKiB,MAAM2hC,EAAIhgC,KAAKu2H,QAC/B,OAAO9lD,EAAIklD,UAAU+B,M,qBAGvB,SAAQp3H,GACN,IAAMgoB,EAAItoB,KAAKq/B,WAAWl/B,IAAIG,GAC9B,GAAIgoB,EACF,OAAOA,EAAE5nB,OAAQ,I,qBAKrB,c,4BAEA,WACE,OAAOV,KAAK22H,aAAe32H,KAAKw2H,S,uBAGlC,WACE,OAAOx2H,KAAK+4B,mB,2BAGd,WAAwC,WACtC,OAAO,IAAIj5B,IACTmX,MAAM/U,KAAKlC,KAAKq/B,WAAWt+B,WAAWgE,KAAI,YAAgB,uBAAdzE,EAAc,KAAV45B,EAAU,KAChD8oB,EAA8B9oB,EAA9B8oB,EAAG16B,EAA2B4R,EAA3B5R,EAAG6uG,EAAwBj9F,EAAxBi9F,eACRxiF,GADgCza,EAARjlB,KACZ,GAAK,EAAKuhH,OACtBxhG,EAAI2f,EAAIwiF,EACd,MAAO,CAAC72H,EAAI,CAAC0iD,EAAI,EAAKuzE,OAAQ5hF,EAAGrsB,EAAI,EAAKiuG,OAAQvhG,U,6BAKxD,SAAgBt3B,GACd,IADwE,EAClEi6H,EAAiD,GACnD7+F,GAAmB,EAFiD,cAG/C94B,KAAKq/B,WAAWt+B,WAH+B,IAGxE,2BAAoD,8BAAxCT,EAAwC,KAApC45B,EAAoC,KAC1C8oB,EAA8B9oB,EAA9B8oB,EAAG16B,EAA2B4R,EAA3B5R,EAAG6uG,EAAwBj9F,EAAxBi9F,eAAgBliH,EAAQilB,EAARjlB,IAC9B,GAAiB,OAAbilB,EAAKjlB,IACP6jB,GAAmB,MACd,CACL,IAAM6b,GAAK1/B,GAAO,GAAKjV,KAAKw2H,OACtBxhG,EAAI2f,EAAIwiF,EACR76D,EAAKtZ,EAAIhjD,KAAKu2H,OACdh6D,EAAKj0C,EAAItoB,KAAKu2H,OAIhBlB,EAHO33H,EAAOK,MACPL,EAAOO,IAEYq+D,EAAKt8D,KAAKu2H,OAAQh6D,EAAKv8D,KAAKu2H,UACxDoB,EAAiBr3H,GAAM,CAACg8D,EAAI3nB,EAAG4nB,EAAIvnC,MAhB+B,8BAoBxE,MAAO,CACLqK,WAAYs4F,EACZ/1C,YAAa5hF,KAAK+4B,iBAClBD,sB,oBAIJ,WAEE,MAAO,CACLuG,WAFiB0pE,4BAAkB/oG,KAAKs/B,iBAGxCsiD,YAAa5hF,KAAK+4B,iBAClBD,iBAAkB94B,KAAK84B,sB,eC7jBR8+F,E,WAOnB,cAA6E,IAA/Dv4F,EAA+D,EAA/DA,WAAYuiD,EAAmD,EAAnDA,YAAa9oD,EAAsC,EAAtCA,iBAAsC,yBANrEuG,gBAMqE,OAJrEuiD,iBAIqE,OAFtE9oD,sBAEsE,EAC3E94B,KAAKq/B,WAAa,IAAIv/B,IAAIiE,OAAOhD,QAAQs+B,IAEzCr/B,KAAK4hF,YAAcA,EACnB5hF,KAAK84B,iBAAmBA,E,2CAG1B,SAAQx4B,GACN,IAAM45B,EAAOl6B,KAAKq/B,WAAWl/B,IAAIG,GACjC,IAAK45B,EACH,MAAM,IAAI14B,MAAJ,aAAgBlB,EAAhB,6CAGR,OAAO45B,EAAK,K,2BAMd,WACE,OAAOl6B,KAAKq/B,a,4BAGd,WACE,OAAOr/B,KAAK4hF,c,sBAGd,SAASi2C,EAAqBC,GAC5B,MAAM,IAAIt2H,MAAM,6B,6BAGlB,SAAgBq2H,EAAqBE,GACnC,MAAM,IAAIv2H,MAAM,6B,0BAGlB,SAAaw2H,EAAeC,GAC1B,MAAM,IAAIz2H,MAAM,6B,6BAGlB,SAAgBmgC,GACd,MAAM,IAAIngC,MAAM,6B,oBAGlB,WACE,MAAO,CACL69B,WAAY0pE,4BAAkB/oG,KAAKq/B,YACnCuiD,YAAa5hF,KAAK4hF,YAClB9oD,kBAAkB,O,sBC7BXs0B,EAAb,WAOE,WAAYhtC,GAEV,GAFoC,yBANtChd,YAMsC,OAJtCvG,aAIsC,OAFtCywC,aAEsC,OAoCtC2f,kBApCsC,EACpCjtD,KAAKoD,OAASgd,EAAKhd,QACdgvG,+BAAqBpyG,KAAKoD,QAC7B,MAAM,IAAI5B,MAAM,0BAElBxB,KAAKnD,QAAUujB,EAAKvjB,QACpBmD,KAAKstC,QAAUltB,EAAKktB,QACpBttC,KAAKk4H,OAAO93G,GAdhB,0CAiBE,SAAOjP,GACLpN,OAAOixH,OAAOh1H,KAAMmR,KAlBxB,wBAqBE,WACE,OAAO,IAAIzR,IAAY42H,EAAoB,CACzCl3G,UAAW3b,yBAAezD,KAAKoD,OAAQ,aACvCigC,YAAa5/B,yBAAezD,KAAKoD,OAAQ,eACzCmzH,OAAQv2H,KAAKnD,QACb25H,OAAQ/yH,yBAAezD,KAAKoD,OAAQ,aAAe,EAAI,MA1B7D,iCAkCE,SAAoB6pD,GAClB,OACEA,GACAA,EAAapsD,OAAOd,yBAAyBw2H,SAAWv2H,KAAKnD,SAC7DqpD,IAAUziD,yBAAezD,KAAKoD,QAAS6pD,EAAa7pD,SACpD8iD,IAAUlmD,KAAKstC,QAAS2f,EAAa3f,WAvC3C,kBA6CE,WAQE,OAPKttC,KAAKitD,cAAiBjtD,KAAKktD,oBAAoBltD,KAAKitD,gBACvDjtD,KAAKitD,aAAe,CAClBpsD,OAAQb,KAAKmtD,aACb/pD,OAAQK,yBAAezD,KAAKoD,QAC5BkqC,QAASttC,KAAKstC,UAGXttC,KAAKitD,aAAapsD,WArD7B,KAuFqBixB,E,4MACnBqmG,SAAmD,G,sDAEnD,SAAiBhnH,GAAmD,IAC1DkT,EAAclT,EAAdkT,UACHrkB,KAAKm4H,SAAS9zG,KACjBrkB,KAAKm4H,SAAS9zG,GAAarkB,KAAKo4H,cAAcjnH,IAEhD,IAAMiE,EAAUpV,KAAKm4H,SAAS9zG,GAE9B,OADAjP,EAAQ8iH,OAAO/mH,GACRiE,I,+BAIT,SAAkB1X,EAAgBu/B,GAChC,IAAKv/B,EACH,OAAOA,EAF2D,IAI5Db,EAAoBogC,EAApBpgC,QAASuG,EAAW65B,EAAX75B,OACX+rF,OACO/uF,IAAXgD,EACI,EACAK,yBAAeL,EAAQ,4BAC7B,IAAK+rF,EACH,OAAOzxF,EAET,IAAMuxD,EAAc7xD,KAAK66C,MAAMk3C,EAA2BtyF,GAC1D,kCACKa,GADL,IAEEK,MAAOX,KAAKiB,MAAMjB,KAAKuB,IAAIjB,EAAOK,MAAQkxD,EAAa,IACvDhxD,IAAKb,KAAKC,KAAKK,EAAOO,IAAMgxD,O,2BAIhC,SAAc99C,GACZ,OAAO,IAAIi8C,EAAcj8C,K,0EAG3B,WAA4BiT,EAAwBhE,GAApD,qBAAAze,EAAA,6DACU0iB,EAAuBjE,EAAvBiE,UAAW2C,EAAY5G,EAAZ4G,QACfqxG,EAAQ,EACNjjH,EAAUpV,KAAKm4H,SAAS9zG,IACzB2C,GAAW5R,WACPpV,KAAKm4H,SAAS9zG,GACrBg0G,EAAQ,GAENjjH,GAAW4R,GACb5R,EAAQvU,OAAOC,aACbkmB,EAAQ,GAAGnpB,QACXmpB,EAAQ,GAAGjpB,MACXipB,EAAQ,GAAG/oB,KAZjB,KAeSo6H,EAfT,sFAeoDj0G,EAAYhE,GAfhE,wG,gGAkBA,SAA0B+N,GACxB,OAAO,IAAIypG,EAAkBzpG,K,wCAG/B,SACE/rB,EACAge,GAEA,IAAMvf,EAASb,KAAKs4H,0BAA0Bl2H,EAAOvB,QAmBrD,OAlBqB,6GACduB,GADW,IACHvB,WACbuf,K,kCAmBJ,SAAqBA,GAA8B,IACzC4G,EAAY5G,EAAZ4G,QAGR,OAFgBhnB,KAAKu4H,iBAAiBn4G,GACZvf,OAAOF,aAAaqmB,EAAQ,GAAGnpB,W,sCAI3D,SACEw8C,EACAj6B,GAEA,IAAMo4G,EAAa,gFACjBn+E,EACAj6B,GAGK1iB,EANY,YAMF0iB,EAAK4G,QANH,MAiBnB,OAVAwxG,EAAW33H,OAASw5C,EAAQx5C,OAAO43H,gBACjCz4H,KAAK04H,kBAAkBh7H,EAAQ0iB,IAE7Bo4G,EAAW33H,OAAOw+B,aACpBm5F,EAAW3xG,SAAW2xG,EAAW3xG,SAASiE,QAAO,SAAA9nB,GAC/C,OAAOyU,QAAQ+gH,EAAW33H,OAAOw+B,WAAWr8B,EAAE8hC,eAIlD0zF,EAAW1/F,iBAAmB0/F,EAAW33H,OAAOi4B,iBACzC0/F,I,2DAQT,WAAarnH,GAAb,iBAAAxP,EAAA,6DACQd,EACHsQ,EAAMtQ,QACPb,KAAKk0D,qBAAqB/iD,GAH9B,kGAIyCA,GAJzC,IAIgDtQ,YAJhD,cAIQuB,EAJR,oDAKcA,GALd,IAKsBvB,YALtB,gD,4DAzH2Cy5C,M,smBC/F7C,SAASq+E,EAAOC,EAAkBnpD,GAChC,OAAOmpD,EAAS7zH,KAAI,SAAA0yE,GAAG,OAAIhI,EAASn0B,MAAMm8B,EAAI15E,MAAO05E,EAAIx5E,QAAM6f,KAAK,IAItE,SAAS+6G,EAASxqF,GAChB,gBAAUA,EAAKtwC,MAAf,YAAwBswC,EAAKpwC,KAI/B,SAAS66H,EAAOC,GACd,OAAOA,EAAKjuG,QACV,SAAC8xE,EAAMpoF,EAAKwkH,GAAZ,OAAqBxkH,GAAOqkH,EAASj8B,KAAUi8B,EAASG,EAAIxkH,EAAM,OAItE,SAASykH,EAAQF,EAAcG,GAC7B,OAAOH,EACJh0H,KAAI,SAAA0yE,GAAG,kCACHA,GADG,IAEN15E,MAAOm7H,EAASzhD,EAAIx5E,IACpBA,IAAKi7H,EAASzhD,EAAI15E,WAEnBu1D,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAE5D,MAAQi3B,EAAEj3B,SAKhC,IAEMo7H,EAAW,mBACXC,EAAoB,oBAG1B,SAASC,EAAQloH,GAA0C,IACjDmoH,EAAkBnoH,EAAlBmoH,IAAK7pD,EAAat+D,EAAbs+D,SAEb,OAAO,0BAAMt9D,MAAO,CAAEhC,WAAYgpH,IAAaR,EAAOW,EAAK7pD,IAG7D,SAAS8pD,EAAYpoH,GAQnB,IAJC,IACOmoH,EAA8BnoH,EAA9BmoH,IAAK7pD,EAAyBt+D,EAAzBs+D,SAAU4W,EAAel1E,EAAfk1E,WACjB3jB,EAAMi2D,EAAOW,EAAK7pD,GACpB+pD,EAAU,GACLxmG,EAAI,EAAGA,EAAI0vC,EAAInjE,OAAQyzB,GAAK,EAEnCwmG,GAAWnzC,EAAW3jB,EAAIpnB,MAAMtoB,EAAGA,EAAI,KAAO,IAGhD,OAAO,0BAAM7gB,MAAO,CAAEhC,WAzBH,qBAyBgCqpH,GAGrD,SAASC,EAAStoH,GASf,IAECuoH,EAQEvoH,EARFuoH,IACAJ,EAOEnoH,EAPFmoH,IACA1sC,EAMEz7E,EANFy7E,MACAnd,EAKEt+D,EALFs+D,SACAkqD,EAIExoH,EAJFwoH,SACAC,EAGEzoH,EAHFyoH,WACAC,EAEE1oH,EAFF0oH,eACAC,EACE3oH,EADF2oH,eAEIC,EAAST,EAAI/5H,OACf,sBAAI+5H,GAAJ,YAAYI,IAAKpmE,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAE5D,MAAQi3B,EAAEj3B,SAC5C6uF,EACJ,OACE,oCACG+sC,EACC,0BAAMxnH,MAAO,CAAEhC,WAAYipH,IAAsBO,GAC/C,KAEHI,EAAOh1H,KAAI,SAACw1D,EAAO5wD,GAAU,MACtBqwH,EAASvqD,EAASn0B,MAAMif,EAAMt8D,IAArB,UAA0B87H,EAAOpwH,EAAQ,UAAzC,aAA0B,EAAmB5L,OAC5D,OACE,kBAAC,IAAM6kC,SAAP,CAAgB5jC,IAAKo+B,KAAKE,UAAUi9B,IAClC,0BACEpoD,MAAO,CAAEhC,WAA2B,QAAfoqD,EAAM/vD,KAAiB2uH,EA1DzC,qBA4DF1pD,EAASn0B,MAAMif,EAAMx8D,MAAOw8D,EAAMt8D,MAEpC47H,EACC,0BAAM1nH,MAAO,CAAEhC,WAlET/P,YAmEH05H,GAAkBE,EAAOz6H,OAAS,GAAlC,UACMy6H,EAAO1+E,MAAM,EAAG,IADtB,cAC+B0+E,EAAO1+E,OAAO,KAC1C0+E,GAEJ,SAKTJ,EACC,0BAAMznH,MAAO,CAAEhC,WAAYipH,IAAsBQ,GAC/C,MA+BH,IAAMK,EAAgB3gH,IAAMC,YAOjC,SAACpI,EAAOkF,GAAQ,IACRqL,EAAkBvQ,EAAlBuQ,QAASqoB,EAAS54B,EAAT44B,KADD,EAIZ54B,EADFs+D,SAAiBA,EAHH,EAGF1gC,IAHE,IAGa4qF,gBAHb,MAGwB,GAHxB,MAG4BC,kBAH5B,MAGyC,GAHzC,EAMR50F,EAAgBtjB,EAAhBsjB,YACFqhD,EAAakB,6BAAmBC,qBAEtC,IAAKxiD,EACH,OAAO,KAGT,IAAM7vB,EAAW6vB,EACdsuB,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAE5D,MAAQi3B,EAAEj3B,SAC3BgH,KAAI,SAAA0yE,GACH,kCACKA,GADL,IAEE15E,MAAO05E,EAAI15E,MAAQ2jB,EAAQ3jB,MAC3BE,IAAKw5E,EAAIx5E,IAAMyjB,EAAQ3jB,WAczBu7H,EAAMR,EAAO3jH,EAAS2V,QAAO,SAAA2sD,GAAG,MAAiB,QAAbA,EAAIjtE,SACxCkvH,EAAMZ,EAAO3jH,EAAS2V,QAAO,SAAA2sD,GAAG,OAAIA,EAAIjtE,KAAK0kE,MAAM,YACnD0d,EAAQksC,EAAO3jH,EAAS2V,QAAO,SAAA2sD,GAAG,MAAiB,SAAbA,EAAIjtE,SAM9C,IAJKkvH,EAAIn6H,QAAU+5H,EAAI/5H,QAAUqtF,EAAMrtF,SACrCm6H,EAtEJ,SAAuBJ,EAAa1sC,GAClC,IAAMstC,EAAWZ,EAAI,GACfa,EAAUb,EAAIA,EAAI/5H,OAAS,GAC3B66H,EAAcxtC,EAAMhlD,WACxB,SAAAyyF,GAAI,OAAIA,EAAKp8H,KAAOi8H,EAASn8H,OAASs8H,EAAKt8H,OAASm8H,EAASn8H,SAEzDu8H,EAAa1tC,EAAMhlD,WACvB,SAAAyyF,GAAI,OAAIA,EAAKp8H,KAAOk8H,EAAQl8H,KAAOo8H,EAAKt8H,OAASo8H,EAAQl8H,OAErDs8H,EAAc3tC,EAAM0tC,GACpBE,EAAe5tC,EAAMwtC,GAErBK,EAAW,sBACZ7tC,EAAMtxC,MAAM,EAAG8+E,IADH,CAEf,CAAEr8H,MAAOy8H,EAAaz8H,MAAOE,IAAKi8H,EAASn8H,SAC3CgH,KAAI,SAAAuqC,GAAG,kCAAUA,GAAV,IAAe9kC,KAAM,sBAExBkwH,EAAY,CAChB,CAAE38H,MAAOo8H,EAAQl8H,IAAKA,IAAKs8H,EAAYt8H,MADvB,mBAEb2uF,EAAMtxC,MAAMg/E,KACfv1H,KAAI,SAAAuqC,GAAG,kCAAUA,GAAV,IAAe9kC,KAAM,uBAE9B,4BAAWiwH,GAAX,YAAwBC,IAgDhBC,CAAcrB,EAAK1sC,KAGH,IAApBlrE,EAAQujB,OAAe,OAGW,CAClC4hD,iBAAOpX,GACPoX,iBAAO+yC,GACP/yC,iBAAO8yC,IAHGA,EAHa,KAGHC,EAHG,KAQzBN,EAAML,EAAQK,GALZ7pD,EAHuB,MAQGlwE,QAC5BqtF,EAAQqsC,EAAQrsC,EAAOnd,EAASlwE,QAChCm6H,EAAMT,EAAQS,EAAKjqD,EAASlwE,QAG9B,OACE,yBAAK8W,IAAKA,EAAKE,cAAY,kBACf,QAATwzB,EACC,kBAACsvF,EAAD,CAASC,IAAKA,EAAK7pD,SAAUA,IAClB,SAAT1lC,EACF,kBAAC0vF,EAAD,CAAU7sC,MAAOA,EAAO0sC,IAAKA,EAAKI,IAAKA,EAAKjqD,SAAUA,IAC3C,YAAT1lC,EACF,kBAACwvF,EAAD,CAAaD,IAAKA,EAAKjzC,WAAYA,EAAY5W,SAAUA,IAC9C,SAAT1lC,EACF,kBAAC0vF,EAAD,CACE7sC,MAAOA,EACP0sC,IAAKA,EACLI,IAAKA,EACLjqD,SAAUA,EACVoqD,gBAAc,IAEL,0BAAT9vF,EACF,kBAAC0vF,EAAD,CACE7sC,MAAOA,EACP0sC,IAAKA,EACL7pD,SAAUA,EACViqD,IAAKA,EACLG,gBAAc,EACdC,gBAAc,IAEL,sBAAT/vF,EACF,kBAAC0vF,EAAD,CACE7sC,MAAOA,EACP0sC,IAAKA,EACL7pD,SAAUA,EACViqD,IAAKA,EACLC,SAAUA,EACVC,WAAYA,EACZC,gBAAc,IAEL,uCAAT9vF,EACF,kBAAC0vF,EAAD,CACE7sC,MAAOA,EACP0sC,IAAKA,EACL7pD,SAAUA,EACViqD,IAAKA,EACLC,SAAUA,EACVC,WAAYA,EACZC,gBAAc,EACdC,gBAAc,IAGhB,iDASO,SAASc,EAAuBzpH,GAAkB,MACvD/U,EAAmB+U,EAAnB/U,MAAOslB,EAAYvQ,EAAZuQ,QACT+rE,EAAiB/rE,EACjBm5G,EAAM,UAAGptC,EAAczoD,mBAAjB,aAAG,EAA2BnO,MAAK,SAAA4gD,GAAG,MAAiB,QAAbA,EAAIjtE,QACpDswH,EAAcpnH,iBAAuB,MAJoB,EAMvCqnH,cAAhB1kH,EANuD,EAMvDA,IAAK2kH,EANkD,EAMlDA,OANkD,EAO/B1nH,qBAP+B,mBAOxDm8D,EAPwD,KAO9CwrD,EAP8C,OAYrC3nH,qBAZqC,mBAYxDiP,EAZwD,KAYjDga,EAZiD,OAavCjpB,mBAASunH,EAAS,MAAQ,QAba,mBAaxD9wF,EAbwD,KAalDmxF,EAbkD,OAcnC5nH,oBAAS,GAd0B,mBAcxD6nH,EAdwD,KAchDC,EAdgD,KAgB/DxnH,qBAAU,WAAM,MACVynH,GAAW,EACf,IAAKj/H,IAAU4+H,EACb,OAAO,aAHK,MAK0B92G,qBAAW9nB,GAA3CshC,EALM,EAKNA,gBAAiBtZ,EALX,EAKWA,WALX,GAMS,UAAAhoB,EAAM2gB,YAAN,eAAYc,gBAAiB,GAA7CjgB,EANO,6BAOC09H,EAPD,kFAOd,WAAwBv9H,EAAeE,EAAaJ,GAApD,yBAAA8D,EAAA,sEACyB+7B,EAAgB+5D,gBAAgB75F,GADzD,UACQo9D,EADR,6BAGU,IAAIx5D,MAAM,sBAHpB,cAKQ6iB,EAAY,cALpB,SAMsBD,EAAWK,KAAKJ,EAAW,kBAAmB,CAChEE,cAAeC,kBAAQw2C,EAAU,CAAC,WAAY,YAC9C32C,YACA3mB,OAAQ,CACNK,QACAE,MACAJ,QAASm9D,EAASe,oBAAoBl+D,MAZ5C,UAMQs2B,EANR,SAgBiBA,EAhBjB,mBAgBSka,EAhBT,4BAkBU,IAAI7sC,MAAJ,sDAC2C3D,IAnBrD,iCAsBSwwC,EAAKluC,IAAI,QAtBlB,6CAPc,sBAqDd,OAtBC,sBAAC,wCAAAwB,EAAA,sEAGW+yB,GAHX,EAMMhT,GAHF3jB,MACKi5B,EAJT,EAII/4B,IACAJ,EALJ,EAKIA,QALJ,SAWoBy9H,EAAS5mG,EAAGsC,EAAGn5B,GAXnC,cAWQkxC,EAXR,gBAYyBusF,EAASl+H,KAAKuB,IAAI,EAAG+1B,EAAI,KAAMA,EAAG72B,GAZ3D,cAYQ87H,EAZR,iBAa2B2B,EAAStkG,EAAGA,EAAI,IAAKn5B,GAbhD,QAaQ+7H,EAbR,OAcOyB,GACHJ,EAAY,CAAElsF,MAAK4qF,WAAUC,eAfjC,kDAkBEr9F,EAAS,EAAD,IAlBV,yDAAD,GAsBM,WACL8+F,GAAW,KAEZ,CAAC35G,EAASs5G,EAAQ5+H,IAErB,IAAMq+B,GAAWg1C,EAEjB,OACE,yBAAKp5D,IAAKA,GACR,kBAAC26E,EAAA,EAAD,CACE/tF,MAAO8mC,EACPjzB,SAAU,SAAAhD,GAAK,OAAIonH,EAAQpnH,EAAM4G,OAAOzX,SAEvC43H,EAAS,kBAAC9pC,EAAA,EAAD,CAAU9tF,MAAM,OAAhB,OAAuC,KAChD43H,EAAS,kBAAC9pC,EAAA,EAAD,CAAU9tF,MAAM,WAAhB,WAA+C,KACzD,kBAAC8tF,EAAA,EAAD,CAAU9tF,MAAM,QAAhB,mBACA,kBAAC8tF,EAAA,EAAD,CAAU9tF,MAAM,yBAAhB,0BAGA,kBAAC8tF,EAAA,EAAD,CAAU9tF,MAAM,qBAAhB,gCAGA,kBAAC8tF,EAAA,EAAD,CAAU9tF,MAAM,sCAAhB,+CAGA,kBAAC8tF,EAAA,EAAD,CAAU9tF,MAAM,QAAhB,SAEF,kBAACmV,EAAA,EAAD,CACE5N,KAAK,SACLpL,QAAQ,YACR+X,QAAS,WACH2jH,EAAY7mH,UACd9R,IAAK24H,EAAY7mH,QAAQmkC,UAAW,CAAE0F,OAAQ,cAC9Cs9E,GAAU,GACVjgH,YAAW,WACTigH,GAAU,KACT,QAIND,EAAS,uBAAyB,QAErC,yBAAK5kH,cAAY,oBACdgM,EACC,kBAACnI,EAAA,EAAD,CAAYtK,MAAM,SAAlB,UAA8ByS,IAC5BkY,EACF,yDACEg1C,EACF,yBAAKt9D,MAAO,CAAEopH,WAAY,YAAa90D,SAAU,eAC/C,kBAACwzD,EAAD,CACE5jH,IAAKykH,EACLp5G,QAAS+rE,EACT1jD,KAAMA,EACN0lC,SAAUA,KAId,oDC5XV,IAAM+rD,EAAa,CACjB,SACA,WACA,cACA,WACA,aACA,WACA,aACA,YAIIC,EAAc,CAClB,OACA,QACA,MACA,SACA,UACA,cACA,QAGWjpH,EAAYC,aAAW,SAAAnB,GAAK,MAAK,CAC5CoqH,sBAAuB,CACrB/jH,QAAS,QACTtb,QAASiV,EAAMJ,QAAQ,IAEzBmc,WAAY,CACVvd,MAAO,WAET6rH,UAAW,CACTxrH,WAAYmB,EAAMjE,QAAQ2vE,KAAK,MAEjCtwC,MAAO,CACL/0B,QAAS,OACT04D,SAAU,QAEZurD,iBAAkB,CAChB,UAAW,CACTzrH,WAAY,WAGhBmmC,UAAW,CACTulF,UAAW,YACXjrH,SAAU,OACV6xF,SAAU,QACVjqE,aAAc,kBACdroB,WAAYmB,EAAMjE,QAAQ2vE,KAAK,KAC/BnzD,YAAavY,EAAMJ,QAAQ,GAC3B7U,QAASiV,EAAMJ,QAAQ,KAEzB4qH,WAAY,CACVD,UAAW,aACXz8G,UAAW,IACX/iB,QAASiV,EAAMJ,QAAQ,IACvB2K,SAAU,QAEZkgH,cAAe,CACbF,UAAW,aACXz8G,UAAW,IACX/iB,QAASiV,EAAMJ,QAAQ,IACvBf,WAAYmB,EAAMjE,QAAQ2vE,KAAK,KAC/B17D,OAAQ,aAAF,OAAehQ,EAAMjE,QAAQ2vE,KAAK,MACxCtkD,UAAW,aACX7c,SAAU,QAGZmgH,gBAAiB,CACf79G,UAAW,MACXmD,OAAQ,sBAIL,SAAS26G,EAAT,GAIW,IAHhB9mH,EAGgB,EAHhBA,SACAuI,EAEgB,EAFhBA,MAEgB,IADhBmR,uBACgB,SACVlb,EAAUnB,IAChB,OACE,kBAACoc,EAAA,EAAD,CACE3b,UAAWU,EAAQqoH,gBACnBntG,gBAAiBA,EACjBqtG,gBAAiB,CAAEC,eAAe,IAElC,kBAACrtG,EAAA,EAAD,CACEzB,WAAY,kBAAC,IAAD,CAAYpa,UAAWU,EAAQ0Z,cAE3C,kBAACjT,EAAA,EAAD,CAAYhb,QAAQ,UAApB,IAA+Bse,IAEjC,kBAAC0+G,EAAA,EAAD,CAAkBnpH,UAAWU,EAAQ+nH,uBAClCvmH,IAMT,IAAMknH,EAAY,SAAC,GAQb,IAPJ5vH,EAOI,EAPJA,YACArI,EAMI,EANJA,KAMI,IALJk4H,cAKI,MALK,GAKL,EACE3oH,EAAUnB,IACVuL,EAAM,sBAAIu+G,GAAJ,CAAYl4H,IAAM0Z,KAAK,KACnC,OAAOrR,EACL,kBAACmd,EAAA,EAAD,CAASlM,MAAOjR,EAAa4sB,UAAU,QACrC,yBAAKpmB,UAAWyB,YAAKf,EAAQioH,iBAAkBjoH,EAAQ2iC,YACpDv4B,IAIL,yBAAK9K,UAAWU,EAAQ2iC,WAAYv4B,IAIlCw+G,EAAa,SAAC,GAAmD,IAAjDt5H,EAAiD,EAAjDA,MACd0Q,EAAUnB,IAChB,OACE,yBAAKS,UAAWU,EAAQmoH,YACrBxiH,IAAMwpB,eAAe7/B,GACpBA,EAEA,kBAACu5H,EAAA,EAAD,CACEv+G,KAAM86C,IAAS91D,GAASm6B,KAAKE,UAAUr6B,GAASikB,OAAOjkB,OAM3Dw5H,EAAc,SAAC,GAUf,IATJr4H,EASI,EATJA,KACAnB,EAQI,EARJA,MACAwJ,EAOI,EAPJA,YACA6vH,EAMI,EANJA,OAOM3oH,EAAUnB,IAChB,OAAiB,OAAVvP,QAA4B7C,IAAV6C,EACvB,yBAAKgQ,UAAWU,EAAQ+4B,OACtB,kBAAC,EAAD,CAAW4vF,OAAQA,EAAQ7vH,YAAaA,EAAarI,KAAMA,IAC3D,kBAAC,EAAD,CAAYnB,MAAOA,KAEnB,MAGAy5H,GAAa,SAAC,GAUd,IATJt4H,EASI,EATJA,KACAnB,EAQI,EARJA,MACAwJ,EAOI,EAPJA,YACA6vH,EAMI,EANJA,OAOM3oH,EAAUnB,IAChB,OACE,oCACoB,IAAjBvP,EAAM1D,OACLw5D,IAAS91D,EAAM,IACb,kBAAC,GAAD,CAAY05H,WAAY15H,EAAM,GAAIq5H,OAAM,sBAAMA,GAAN,CAAcl4H,MAEtD,yBAAK6O,UAAWU,EAAQ+4B,OACtB,kBAAC,EAAD,CAAW4vF,OAAQA,EAAQ7vH,YAAaA,EAAarI,KAAMA,IAC3D,kBAAC,EAAD,CAAYnB,MAAOA,EAAM,MAG3BA,EAAM88G,OAAM,SAAAhiG,GAAG,OAAIg7C,IAASh7C,MAC9B9a,EAAM8B,KAAI,SAACgZ,EAAKiV,GAAN,OACR,kBAAC,GAAD,CAAY2pG,WAAY5+G,EAAKu+G,OAAM,sBAAMA,GAAN,CAAcl4H,EAAO,IAAM4uB,SAGhE,yBAAK/f,UAAWU,EAAQ+4B,OACtB,kBAAC,EAAD,CAAW4vF,OAAQA,EAAQ7vH,YAAaA,EAAarI,KAAMA,IAC1DnB,EAAM8B,KAAI,SAACgZ,EAAKiV,GAAN,OACT,yBAAKh0B,IAAG,UAAKoF,EAAL,YAAa4uB,GAAK/f,UAAWU,EAAQooH,eAC3C,kBAAC,EAAD,CAAY94H,MAAO8a,WASjC,SAAS6+G,GAAYzrH,GAAkB,IAC7BuQ,EAAYvQ,EAAZuQ,QAD6B,EAEGA,EAAhC7jB,EAF6B,EAE7BA,QAASE,EAFoB,EAEpBA,MAAOE,EAFa,EAEbA,IAAKgnC,EAFQ,EAERA,OAMvB43F,EAAoC,CACxC,KAAM,IACN,EAAK,GACL,EAAK,KAEDC,EAAYD,EAAU53F,GAAV,WAAkC43F,EAAU53F,GAA5C,KAAyD,GACrE83F,GAAgBh/H,EAAQ,GAAGw/C,eAAe,SAC1Cy/E,EAAa/+H,EAAIs/C,eAAe,SAChCD,EAAaz/C,EAAU,GAAH,OAAMA,EAAN,KAAmB,GACvCo/H,EAAwC,2BACzCv7G,GADsC,IAEzCniB,QAAStB,EAAMF,GAAOw/C,eAAe,SACrC17C,SAAU,GAAF,OAAKy7C,GAAL,OAAkBy/E,EAAlB,aAAmCC,EAAnC,YAAiDF,KAU3D,OACE,oCAR0B,CAC1B,WACA,cACA,OACA,SACA,QAIuB/3H,KAAI,SAAA/F,GACvB,IAAMiE,EAAQg6H,EAAiBj+H,EAAIosB,eACnC,OAAiB,OAAVnoB,QAA4B7C,IAAV6C,EACvB,kBAAC,EAAD,CAAajE,IAAKA,EAAKoF,KAAMpF,EAAKiE,MAAOA,IACvC,SAML,IAAMi6H,GAAkB,SAAC/rH,GAC9B,OACE,kBAAC8qH,EAAD,iBAAc9qH,EAAd,CAAqBuM,MAAM,iBACzB,kBAACk/G,GAAgBzrH,KAajBgsH,GAAkB,SAAC,GAQnB,IAPJl6H,EAOI,EAPJA,MACAq5H,EAMI,EANJA,OACAl4H,EAKI,EALJA,KAMMvB,EAAOkB,OAAOlB,KAAKI,EAAM,IAAIqwD,OAC7B8pE,EAAY,IAAIt6H,IAAID,GAE1B,GADAI,EAAMxF,SAAQ,SAACsgB,GAAD,OAAcha,OAAOlB,KAAKkb,GAAKtgB,SAAQ,SAAAyF,GAAC,OAAIk6H,EAAUr6H,IAAIG,SACpEk6H,EAAU/uH,KAAOxL,EAAKtD,OAAS,EAAG,CAEpC,IAWI89H,EAXEn4C,EAAOnhF,OAAOhD,QAAQkC,GAAO8B,KAAI,YAAc,uBAAZ7B,EAAY,KAAT6a,EAAS,KAC3Czd,EAAgByd,EAAhBzd,GAAOqH,EADoC,YAC3BoW,EAD2B,QAEnD,oBACEzd,GAAI4C,EACJuC,WAAYnF,GACTqH,MAOHy1H,EAAUz6H,IAAI,OAChBy6H,EAAUj8F,OAAO,MACjBk8F,EAAW,CAAC,cAAJ,mBAAqBD,KAE7BC,EAAW,YAAID,GAGjB,IAAM/nC,EAAUgoC,EAASt4H,KAAI,SAAAgZ,GAAG,MAAK,CACnC2uB,MAAO3uB,EACPvhB,MAAOY,KAAKuB,IAAL,MAAAvB,KAAI,YACN8nF,EAAKngF,KAAI,SAAA0rE,GACV,IAAMruE,EAAS8kB,OAAOupD,EAAI1yD,IAC1B,OAAO3gB,KAAKwB,IAAIxB,KAAKuB,IAAI+vD,sBAAYtsD,EAAQ,IAAM,GAAI,IAAK,cAOlE,OACE,oCACE,kBAAC,EAAD,CAAWk6H,OAAQA,EAAQl4H,KAAMA,IACjC,yBACE+N,MAAO,CACL1R,OAC+B,GAA7BrD,KAAKwB,IAAIsmF,EAAK3lF,OAAQ,KACtB,IACC2lF,EAAK3lF,OAAS,IAAM,EAAI,IAC3B/C,MAAO,SAGT,kBAAC,WAAD,CACE8gI,yBAAuB,EACvBC,UAAW,GACXzlE,aAAc,GACdotB,KAAMA,EACNs4C,mBAAoB,GACpBC,oBAAkB,EAClBC,4BAA0B,EAC1BroC,QAASA,EACTsoC,WAAYz4C,EAAK3lF,OAAS,QAMpC,OAAO,MAiBF,IAAMq+H,GAAsD,SAAtDA,EAAsDzsH,GAAS,IAExEwrH,EAKExrH,EALFwrH,WAFwE,EAOtExrH,EAJF0sH,YAHwE,MAGjE,GAHiE,EAIxEh5G,EAGE1T,EAHF0T,aAJwE,EAOtE1T,EAFF2sH,iBALwE,MAK5D,SAAA//G,GAAG,OAAIA,GALqD,IAOtE5M,EADFmrH,cANwE,MAM/D,GAN+D,EAQpEyB,EAAQ,GAAH,mBAAOF,GAASrC,GAE3B,OACE,oCACGz3H,OAAOhD,QAAQ47H,GACb7xG,QAAO,mCAAE5nB,EAAF,iBAAkB9C,IAAlB,OAAgC29H,EAAM7yG,SAAShoB,MACtD6B,KAAI,YAAkB,uBAAhB/F,EAAgB,KAAXiE,EAAW,KACrB,GACEgU,MAAM2f,QAAQ3zB,IACdA,EAAM1D,OAAS,GACf0D,EAAM88G,OAAM,SAAAhiG,GAAG,OAAIg7C,IAASh7C,MAE5B,OACE,kBAAC,GAAD,CACE/e,IAAKA,EACLs9H,OAAQA,EACRl4H,KAAMpF,EACNiE,MAAOA,IAKb,IAAMwJ,EA3ChB,SAAsBs9D,GAA8C,MAA/BvH,EAA+B,uDAAJ,GAM9D,OALAuH,EAAItsE,SAAQ,SAAA6xC,GACNkzB,IACFA,EAAMA,EAAIlzB,OAGQ,kBAARkzB,EACVA,EAC4B,kBAA5B,UAAOA,SAAP,aAAO,EAAKuW,aACZvW,EAAIuW,iBACJ34E,EAiCwB49H,CAAa,GAAD,mBAAK1B,GAAL,CAAat9H,IAAM6lB,GACnD,OAAI5N,MAAM2f,QAAQ3zB,GAEd,kBAAC,GAAD,CACEjE,IAAKA,EACLoF,KAAMpF,EACNiE,MAAOA,EACPwJ,YAAaA,EACb6vH,OAAQA,IAKVvjE,IAAS91D,GAET,kBAAC26H,EAAD,CACEC,KAAME,EACN/+H,IAAKA,EACL29H,WAAY15H,EACZ4hB,aAAcA,EACdy3G,OAAM,sBAAMA,GAAN,CAAct9H,MAMxB,kBAAC,EAAD,CACEA,IAAKA,EACLoF,KAAMpF,EACNiE,MAAO66H,EAAU76H,EAAOjE,GACxByN,YAAaA,EACb6vH,OAAQA,SAQT2B,GAAiB,SAAC9sH,GAAqB,IAC1CuQ,EAAYvQ,EAAZuQ,QACR,OACE,kBAACu6G,EAAD,iBAAc9qH,EAAd,CAAqBuM,MAAM,eACzB,kBAAC,GAAD,iBAAgBvM,EAAhB,CAAuBwrH,WAAYj7G,OAgBlC,IAAMw8G,GAAiB,SAAjBA,EAAkB/sH,GAMzB,MAC6CA,EAAzC0sH,YADJ,MACW,GADX,EACezhI,EAA8B+U,EAA9B/U,MAAOslB,EAAuBvQ,EAAvBuQ,QADtB,EAC6CvQ,EAAdgtH,aAD/B,MACuC,EADvC,EAEI/5H,EAAqCsd,EAArCtd,KAAM9D,EAA+BohB,EAA/BphB,GAFV,EAEyCohB,EAA3BlX,YAFd,MAEqB,GAFrB,EAEyBw6B,EAAgBtjB,EAAhBsjB,YACvBo5F,EAAOh6H,GAAQ9D,GAAM,GACrB+9H,EAAYD,EAAK7+H,OAAS,GAAd,UAAsB6+H,EAAtB,OAAkCA,EAC9C1gH,EAAQ,GAAH,OAAM2gH,GAAN,OAAkB7zH,EAAO,MAAH,OAASA,GAAS,IAC7C4K,EAAU8O,qBAAW9nB,GAErBuxG,EACJnpF,kBAAQpP,EAAS,CAAC,iBAAkB,mBAFlB,CAAC,OAAQ,cAI7B,OACE,kBAAC6mH,EAAD,CAAUv+G,MAAOA,GACf,6CACA,kBAACk/G,GAAgBzrH,GACjB,kBAACwuG,EAAA,EAAD,MACA,2CACA,kBAAC,GAAD,eACEgd,WAAYj7G,GACRvQ,EAFN,CAGE0sH,KAAI,sBAAMA,GAASpC,MAEpB9tB,EAAcziF,SAASxJ,EAAQlX,MAC9B,kBAAC,gBAAD,CACE8vG,kBAAmB,gBAAG/3F,EAAH,EAAGA,MAAH,OACjB,kBAACnI,EAAA,EAAD,CAAYtK,MAAM,SAAlB,mDAC4CyS,MAI9C,kBAACq4G,EAA2BzpH,IAE5B,KACH6zB,GAAeA,EAAYzlC,OAC1B,kBAAC08H,EAAD,CACEv+G,MAAM,cACNmR,iBAAkB8+E,EAAcziF,SAASxJ,EAAQlX,OAEhDw6B,EAAYjgC,KAAI,SAAC0yE,GAAD,OACf,kBAACymD,EAAD,CACEl/H,IAAKo+B,KAAKE,UAAUm6C,GACpB/1D,QAAS+1D,EACTr7E,MAAOA,EACP+hI,MAAOA,EAAQ,QAInB,OAKJG,GAAqB55H,oBAAS,SAACyM,GAA0B,IACrD/U,EAAU+U,EAAV/U,MACAwoB,EAAgBxoB,EAAhBwoB,YAER,IAAKA,EACH,OAAO,KAET,IArEe49C,EAqET9gD,EAAU0b,KAAKC,MAAMD,KAAKE,UAAU1Y,IAE1C,OAvEe49C,EAuEH9gD,EAtEuB,IAA5B3d,OAAOlB,KAAK2/D,GAAKjjE,OAuEf,KAEF,kBAAC,GAAD,CAAgBnD,MAAOA,EAAOslB,QAASA,OAGjC48G,c,wOCrgBA,SAASC,EACtBptH,GAEA,IAAMqtH,EAAmB9qH,iBAAuB,MAExCpC,EAA6CH,EAA7CG,MAAO2M,EAAsC9M,EAAtC8M,KAAMyoC,EAAgCv1C,EAAhCu1C,mBAAuB/+C,EAH5C,YAGqDwJ,EAHrD,uCAKMstH,EAAeptH,6BAAmBC,GAyCxC,OAvCAsC,qBAAU,WACR,IAAM8qH,EAAUF,EAAiBvqH,QA+BjC,OA7BMyqH,IACEA,GACFC,iCAAuBD,GAEzBA,EAAQtmF,UAAYn6B,EASpB2gH,eACE,WACEC,kBACE,kBAACC,EAAA,EAAD,CAAextH,MAAOmtH,GACpB,kBAAC/3E,EAAuB/+C,IAE1B+2H,KAGJ,CAAE/8G,QAAS,OAOV,WACD+8G,GACFC,iCAAuBD,MAG1B,CAACzgH,EAAMwgH,EAAc92H,IAGtB,yBACE0O,IAAKmoH,EACLO,iBAAgB9gH,EAAK1e,OACrB0T,UAAU,kB,ICXK20D,E,2KAQnB,SAAsBxnD,GACpB,kCACKA,GADL,IAEEhd,OAAQkwB,0BAAgBlT,EAAKhd,QACzB4mB,sBAAY5J,EAAKhd,QACjBgd,EAAKhd,OACTkqC,QAASltB,EAAKktB,SAAWltB,EAAKktB,QAAQrsC,SAASqsC,Y,wCAYnD,SACE+M,EACAj6B,GAE0Bi6B,EAAlBp8B,KADa,IACJtW,EADI,YACK0yC,EADL,UAIrB,OAAIj6B,EAAKoiB,UAIP,2BACK6X,GADL,IAEEp8B,KAAMje,KAAKm6C,YACPE,EAAQp8B,KACR,6EAKR,2BACKtW,GADL,IAEE+zB,aACE,kBAAC6iG,EAAD,iBACMn+G,EACAi6B,EAFN,CAGEqM,mBAAoB1mD,KAAKqX,sB,qCAYjC,SAAwB+I,GACtB,IAAMmnD,EAAe,eAAMnnD,GACrBhd,EAASpD,KAAK8iB,aAAaqQ,OAAO/S,EAAKhd,QAAU,GAAI,CACzDkU,cAAetX,KAAKsX,gBAOtB,OALAiwD,EAAankE,OAASA,EACtBmkE,EAAaj6B,QAAU,IAAI2V,IAAwB,CACjD3V,QAASltB,EAAKktB,UAGTi6B,I,sCAWT,SACEltB,EACAj6B,GAEA,IAAMnC,EAAO+gH,yBACX,kBAACF,EAAA,EAAD,CAAextH,MAAOD,6BAAmB+O,EAAK9O,QAC3C+oC,EAAQ3e,eAIb,cADO2e,EAAQ3e,aACf,2BAAY2e,GAAZ,IAAqBp8B,W,mEAUvB,WAAqBmG,EAAwBhE,GAA7C,SAAAze,EAAA,+EACSyiB,EAAWK,KAAKrE,EAAKiE,UAAW,aAAcjE,IADvD,2C,4HAYA,WAAqBA,GAArB,gCAAAze,EAAA,6DACU4C,EAAsC6b,EAAtC7b,OADV,EACgD6b,EAA9Bzc,sBADlB,MACmC,aADnC,EAEE+vB,2BAAiBnvB,GACXsuC,EAAmB7yC,KAAKi/H,wBAAwB7+G,GAEtDsT,2BAAiBnvB,GALnB,SAMwB26H,uBAAa,iBAAkBv7H,GAAgB,kBACnE,EAAK+vC,OAAOb,MAPhB,cAMQwH,EANR,OASE3mB,2BAAiBnvB,GATnB,UAc2B26H,uBACvB,sBACAv7H,GACA,kBAAM,EAAKw7H,yBAAyB9kF,EAASxH,MAjBjD,eAcQ2lF,EAdR,yBAmBSA,GAnBT,iD,iIAsBA,WAA4Bp0G,EAAwBhE,GAApD,mBAAAze,EAAA,6DACQ0vC,EAAiBrxC,KAAKyzC,sBAAsBrzB,GAE5Ci4G,EAAQr4H,KAAKyyC,gBAHrB,SAI0BruB,EAAWK,KACjCrE,EAAKiE,UACL,oBACAgtB,GAPJ,cAIQ+tF,EAJR,yBASS/G,EAAQ+G,GATjB,gD,8DA3I8Cr5F,M,4RCnD1Cs5F,E,4MACGC,U,0BADgB99H,QAelB,SAASkyB,EAAiBnvB,GAC/B,GAAKA,EAAL,CAIA,KAAMA,aAAkBkkG,aACtB,MAAM,IAAIr/D,UAAU,4BAGtB,GAAI7kC,EAAOm4B,QACT,MAAM6iG,KAIV,SAAS59G,EAAQ+pF,GACf,OAAO,IAAIp3E,SAAQ,SAAAgX,GAAO,OAAInwB,WAAWmwB,EAASogE,MAO7C,SAAerL,EAAtB,kC,4CAAO,WAA+B97F,GAA/B,SAAA5C,EAAA,sEAKCggB,EAAQ,GALT,OAML+R,EAAiBnvB,GANZ,4C,sBASA,SAASg7H,IACd,GAA4B,qBAAjBC,aACT,OAAO,IAAIA,aAAa,UAAW,cAErC,IAAMxoG,EAAI,IAAIqoG,EAAW,WAEzB,OADAroG,EAAEsoG,KAAO,cACFtoG,EAGF,SAASnD,EAAmBtvB,GACjC,OAAKA,EAGEk7H,YAAUl7H,EAAQ,SAFhB8gC,IAAWlS,SASf,SAAS6W,EAAiB01F,GAC/B,MAEqB,eAAnBA,EAAUt7H,MAEyB,gBAAlCs7H,EAAyBJ,QAMxBI,EAAUpkH,QAAQ4zD,MAAM,+B,iCC/E9B,+CAGMywD,EAAwC,GAWvC,SAAShpC,EACdj0B,EAEA5tB,GAEA,IAAM9C,EAAW,SAAH,OAAY0wB,GAC1B,IAAKi9D,EAAiB3tF,GAAW,CAE/B,IADc0wB,EAAIz5B,WAAW,SAE3B,MAAM,IAAIznC,MAAM,+CAElB,IAAM89H,EAAO58D,EAAItzB,MAAM,SAAS,GAC1BwwF,EAAW9qF,EACbA,EAAK+qF,QAAL,UAAgBP,IAChBvqF,cAAqB8qF,QAArB,UAAgCP,IACpCK,EAAiB3tF,GAAY4tF,EAG/B,OAAOD,EAAiB3tF,K,iCChC1B,2FA0CM8tF,EAAO,IAAI97D,OAjCA,CACf,IACA,IACA,KACA,OACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,MACA,KACA,IACA,MACA,OACA,QACA,SACA,QACA,QACA,KACA,QACA,KACA,QACA,KACA,IACA,MAI+Bj/D,KAAI,SAAAoiD,GAAG,iBAAQA,EAAR,gBAAwBrpC,KAAK,KAAM,KAK5D,SAAS0+G,EAAT,GAAmD,IAJ3C95D,EAIiBzkD,EAA0B,EAA1BA,KAChChb,GALey/D,EAKAzkD,EAJd6hH,EAAKv1H,KAAKm4D,GAIYzkD,EAAO8hH,IAAW9hH,IAG/C,OAAO,yBAAKmJ,wBAAyB,CAAEC,OAAQ24G,IAAUC,SAASh9H,Q,iCCnDpE,qBAIM40D,EAAgBtyD,QACnBnJ,MAAM,WAAY,CACjBkE,GAAIgF,YACJsY,YAAarY,QAAM+B,MAAM/B,QAAMS,UAEhC21B,UAAS,kBACRn/B,MAAO,QAERyiB,OAAM,kBACL,gBACE,MAAO,QAGVvY,SAAQ,SAAAC,GAAI,MAAK,CAChBqX,eADgB,SACD5Z,GACbuC,EAAKiX,YAAcxZ,GAErBwV,SAJgB,SAIP+/C,GACPhzD,EAAKnK,MAAQm9D,OAIJ9B,O,gGCdM5U,E,WAGnB,cAAkE,QAApD3V,eAAoD,MAA1C,GAA0C,2BAFlE4yF,iBAEkE,EAChElgI,KAAKkgI,YAAc5yF,EAAQvoC,KAAI,SAAAo7H,GAC7B,GAA2B,kBAAhBA,EAET,MAAO,CAAE3qC,KADImB,YAAuBwpC,GACrBn6H,OAAQm6H,GAEzB,MAAM,IAAI3+H,MAAJ,sCAAyC2+H,EAAzC,S,0CAKV,WACE,IAAK,IAAIntG,EAAI,EAAGA,EAAIhzB,KAAKkgI,YAAY3gI,OAAQyzB,GAAK,EAChD,IAEGhzB,KAAKkgI,YAAYltG,GAAGwiE,KAAKC,SAAS,CAAE/zE,QAAS,UAAF,gCAE5C,OAAO,EAGX,OAAO,I,oBAGT,WACE,MAAO,CAAE4rB,QAASttC,KAAKkgI,YAAYn7H,KAAI,SAAA/B,GAAC,OAAIA,EAAEgD,c,uBAGhD,SAAgBmoB,GACd,OAAO,IAAI80B,EAAwB90B,O,uNCOlBmsB,E,2KASnB,SAAsBl6B,GAAkB,IAC9BgD,EAA0BhD,EAA1BgD,aAAc4D,EAAY5G,EAAZ4G,QAChBqqB,EAAiB,2BAClBjxB,GADe,IAElBgD,aAAcA,GAAgB,CAC5B9iB,GAAI8iB,EAAa9iB,GACjBwmB,kBAAmB1D,EAAa0D,mBAElCE,QAASoW,KAAKC,MAAMD,KAAKE,UAAUtW,MAErC,oFAAmCqqB,K,wCASrC,SACEjvC,EACAge,GAEA,IAAMggH,EAAuB,IAAItgI,IACjCsC,EAAOykB,SAASppB,SAAQ,SAAAqxC,GACtB,IAAM9rC,EAAIiC,IAAco7H,SAASvxF,GACjCsxF,EAAqB//H,IAAI6mB,OAAOlkB,EAAE1C,MAAO0C,MAE3C,IAAMukE,EAAe,6GAEdnlE,GAFW,IAGdykB,SAAUu5G,IAEZhgH,GAEF,kCACKmnD,GADL,IAEEtpC,SAAU7d,EAAK6d,SACfpX,SAAUu5G,M,sCAWd,SACEh+H,EACAge,GAEA,IAAMo4G,EAAa,gFAA+Bp2H,EAAQge,GAC1D,kCACKo4G,GADL,IAEE3xG,SAAUotC,kBAAQ7xD,EAAOykB,SAASnkB,UAAU,SAAAM,GAAC,OAAIA,EAAE/B,gB,+BAUvD,SAAkBvD,EAAgB4iI,GAChC,OAAO5iI,I,gEAST,WACEu/B,GADF,kCAAAt7B,EAAA,yDAGUsrC,EAAiChQ,EAAjCgQ,YAAa1oC,EAAoB04B,EAApB14B,OAAQyiB,EAAYiW,EAAZjW,QACvBH,EAAW,IAAI/mB,IAEhBknB,GAA8B,IAAnBA,EAAQznB,OAN1B,yCAOWsnB,GAPX,cAUQ2gD,EAAiBxgD,EAAQjiB,KAAI,SAACujB,GAGlC,IAAMm/C,EAAgB,eAAKn/C,GAO3B,OANIm/C,EAAc1pE,QAChB0pE,EAAc1pE,MAAQX,KAAKiB,MAAMopE,EAAc1pE,QAE7C0pE,EAAcxpE,MAChBwpE,EAAcxpE,IAAMb,KAAKC,KAAKoqE,EAAcxpE,MAEvCwpE,KAGH/pE,EAAS8pE,EAAe,GAExBE,EACsB,IAA1BF,EAAejoE,OACX0tC,EAAYtZ,YACV3zB,KAAK04H,kBAAkBh7H,EAAQu/B,GAE/BA,GAGFgQ,EAAYuoB,6BAA6BgS,EAAgBvqC,GAjCjE,SAmCQyqC,EACH7iE,KACCi4E,aAAI,kBAAMppD,2BAAiBnvB,MAC3BumB,aAAO,SAAApJ,GAAO,OAAI,EAAKimD,qBAAqB1qC,EAAYvb,MACxDo7D,aAAI,SAAAp7D,GACF,IAAMphB,EAAKohB,EAAQphB,KACnB,IAAKA,EACH,MAAM,IAAIkB,MAAJ,8BAAiClB,EAAjC,MAERumB,EAASxmB,IAAIC,EAAIohB,MAEnB6+G,eAEDnyF,YAhDL,gCAkDSvnB,GAlDT,iD,yFA0DA,SAAqBoW,EAAoCvb,GACvD,OAAKub,EAAWqQ,SAGTrQ,EAAWqQ,QAAQC,OAAO7rB,EAASub,K,2DAQ5C,WAAa9rB,GAAb,iBAAAxP,EAAA,8DAEKwP,EAAM0V,SAFX,qCAGW7mB,KAAK2zB,YAAYxiB,GAH5B,iCACQ0V,EADR,uGAIyC1V,GAJzC,IAIgD0V,cAJhD,cAIQzkB,EAJR,oDAKcA,GALd,IAKsBykB,cALtB,iD,4DA3J+CgL,KAoKLA,K,uFChNtCw6C,E,WACJ,aAA0B,IAAdz2C,EAAc,uDAAJ,GACpB,GADwB,sBAClBA,WAAmBA,UAAzB,GACE,MAAM,IAAIwT,UAAV,6CAGFppC,KAAA,QAAe41B,EAAf,QACA51B,KAAA,MAAa,IAAb,IACAA,KAAA,SAAgB,IAAhB,IACAA,KAAA,Q,wCAGF,cACEA,KAAA,eACAA,KAAA,SAEIA,KAAKwgI,OAASxgI,KAAlB,UACEA,KAAA,QACAA,KAAA,SAAgBA,KAAhB,MACAA,KAAA,MAAa,IAAb,O,iBAIJ,YACE,GAAIA,KAAKmsE,MAAMxpE,IAAf,GACE,OAAO3C,KAAKmsE,MAAMhsE,IAAlB,GAGF,GAAIH,KAAKygI,SAAS99H,IAAlB,GAA4B,CAC1B,IAAMM,EAAQjD,KAAKygI,SAAStgI,IAA5B,GAGA,OAFAH,KAAA,mBACAA,KAAA,UACA,K,iBAMJ,cAOE,OANIA,KAAKmsE,MAAMxpE,IAAf,GACE3C,KAAA,eAEAA,KAAA,UAGF,O,iBAGF,YACE,OAAOA,KAAKmsE,MAAMxpE,IAAI3D,IAAQgB,KAAKygI,SAAS99H,IAA5C,K,kBAGF,YACE,OAAI3C,KAAKmsE,MAAMxpE,IAAf,GACS3C,KAAKmsE,MAAMhsE,IAAlB,GAGEH,KAAKygI,SAAS99H,IAAlB,GACS3C,KAAKygI,SAAStgI,IAArB,QADF,I,oBAOF,YACE,IAAMugI,EAAU1gI,KAAKmsE,MAAMhrC,OAA3B,GAKA,OAJA,IACEnhC,KAAA,UAGKA,KAAKygI,SAASt/F,OAAOniC,IAA5B,I,mBAGF,WACEgB,KAAA,cACAA,KAAA,iBACAA,KAAA,U,4BAGF,sKAEI,OAFJ,yBACchB,EADd,cAEI,EAFJ,qM,8BAMA,sKAEI,OAFJ,yBACgBiE,EADhB,cAEI,EAFJ,qM,KAMEX,OAAOC,S,gBAAT,gHACqBvC,KADrB,+DAEI,OADS48F,EADb,iBAEI,EAFJ,2JAKqB58F,KALrB,wEAKa48F,EALb,2BAMW59F,EANX,KAOSgB,KAAKmsE,MAAMxpE,IAPpB,oBAQM,OARN,UAQM,EARN,uN,gBAaA,WACE,IADS,EACLg+H,EAAJ,EADS,cAES3gI,KAAKygI,SAFd,YAET,2BAAwC,KAA7BzhI,EAA6B,QACjCgB,KAAKmsE,MAAMxpE,IAAhB,KACEg+H,OAJK,8BAQT,OAAO3gI,KAAKwgI,MAAZ,M,KAIJ,O,0XCrGM11G,EAAS81G,YAA4B,CAAEptD,MAAM,EAAMvyC,MAAO,KAmIjDv8B,0BA3Hf,YAcG,MAbDtI,EAaC,EAbDA,MACAykI,EAYC,EAZDA,SACAjjI,EAWC,EAXDA,aACAuU,EAUC,EAVDA,MACAlP,EASC,EATDA,MASC,IARD69H,sBAQC,MARgB,GAQhB,EAEOpjG,EADQxZ,qBAAW9nB,GACnBshC,gBAGF1W,EACHppB,IAAY,UAAI8/B,EAAgBv9B,IAAIvC,UAAxB,aAAI,EAAmCopB,UACnD,GAEK+5G,EAA4B3kI,EAA5B2kI,wBACFC,EAA4B,IAAnBh6G,EAAQznB,OACjBq2B,EAAU5Q,mBACd,kBACEgC,EAAQjiB,KAAI,SAAAgS,GAAM,MAAK,CACrBvM,KAAM,qBACNvH,MAAO8T,EAAOlZ,cAElB,CAACmpB,IAgBH,OACE,kBAACi6G,EAAA,EAAD,CACE3gI,GAAE,8BAAyBlE,EAAMkE,IACjCiW,cAAY,eACZiW,UAAW5uB,IAAiBojI,EAC5BE,iBAAe,EACfC,kBAAgB,EAChBC,UAAQ,EACRC,oBAAkB,EAClBC,aAAW,EACX7mG,QAASumG,EACTO,eAAa,EACbpvH,MAAOA,EACPlP,MAAO89H,GAA2B99H,GAAS,GAC3C2yB,QAASA,EACT4rG,QAAS,SAAAzqH,GAAM,OAAImQ,OAAOnQ,EAAOvM,OACjCi3H,cAAe,SAACC,EAAiB1gF,GAC/B,IAAM2gF,EAAW72G,EAAO42G,EAAiB1gF,GAEzC,GAA0B,KAAtBA,EAAO4gF,WAAmB,CAC5B,IAAMC,EAAoB,CACxBr3H,KAAM,SACNo3H,WAAY5gF,EAAO4gF,WACnB3+H,MAAO+9C,EAAO4gF,YAEhBD,EAASziI,KAAK2iI,GAEhB,OAAOF,GAETG,aAAc,CAAE3vH,MAAO,CAAEiN,UAAW,MACpCtI,SAAU,SAACsjB,EAAG2nG,IA3ClB,SAAkBC,GAChB,IAAIC,EACAD,IAC2B,kBAAlBA,IACTC,EAAiBD,EAAcJ,YAAcI,EAAc/+H,OAEhC,kBAAlB++H,IACTC,EAAiBD,GAEnBnB,EAASoB,IAmCPnrH,CAASirH,IAEXG,YAAa,SAAAlhF,GAAU,IACbmhF,EAAgCrB,EAAhCqB,WADa,EACmBrB,EAApBtyG,kBADC,MACY,GADZ,EAEf4zG,EAAsB,uCACvBphF,EAAOxyB,YACPA,GAFoB,IAGvBC,aACE,oCACIuyG,EAGA,kBAACtyG,EAAA,EAAD,CAAgB7sB,SAAS,MAAMsQ,MAAO,CAAE0X,YAAa,IACnD,kBAAC,IAAD,OAHF,kBAAC40D,EAAA,EAAD,CAAkB3uE,MAAM,UAAUzB,KAAM,KAMzC2yC,EAAOxyB,WAAWC,gBAIzB,OACE,kBAACxB,EAAA,EAAD,iBACM+zB,EACA8/E,EAFN,CAGEqB,WAAYA,EACZl/H,MAAO89H,GAA2B99H,GAAS,GAC3CurB,WAAY4zG,EACZ9wC,YAAY,0BAIlB+wC,aAAc,SAAAtrH,GAAM,OAAI,kBAACqD,EAAA,EAAD,CAAYkoH,QAAM,GAAEvrH,EAAO9T,QACnDs/H,eAAgB,SAAAxrH,GACd,MAAsB,kBAAXA,EACFA,EAELA,EAAO6qH,WACF7qH,EAAO6qH,WAET7qH,EAAO9T,Y,oCC7If,SAASu/H,EACd5oF,EACA6oF,EACAC,GAUA,IAPA,IAAMC,EAAkBF,GADxB7oF,EAAQx8C,KAAKshD,IAAI9E,IAEXgpF,EAAiBh9G,SACrBsS,OAAOyqG,GAAiBE,gBAAgBzzF,MAAM,MAAM,GACpD,IAGE0zF,EAAa,KAAH,IAAG,GAAMF,GAChBE,EAAaH,MAClBG,GAAc,IACIH,IAGlBG,GAAc,IAKhB,IAAMC,GAFND,EAAa1lI,KAAKuB,IAAImkI,EAAY,IAEAlpF,EAE9BopF,EAAa,EASjB,QARMF,EAAa,KAAOC,EAAe,IAAML,EAC7CM,EAAaF,EAAa,KACfA,EAAa,IAAMC,EAAe,GAAKL,EAClDM,EAAaF,EAAa,IACfA,EAAa,IAAMC,EAAe,GAAKL,IAClDM,EAAaF,EAAa,GAGrB,CAAEA,aAAYE,cAGhB,SAASC,EACdllI,EACAE,EACApB,GAGA,IAFAqmI,IAEA,yDADAC,IACA,yDACMC,EAAYZ,EAAgB3lI,EAAS,GAAI,IAE3CwmI,EAAUtlI,EACVu3D,EAAUr3D,EACd,GAAgB,OAAZolI,GAAgC,OAAZ/tE,EACtB,MAAO,GAGT,GAAIz4D,EAAU,EAAG,OACO,CAACy4D,EAAS+tE,GAA9BA,EADa,KACJ/tE,EADI,KAMjB+tE,GAAWjmI,KAAKshD,IAAI,GAAK7hD,GAAW,EACpCy4D,GAAWl4D,KAAKshD,IAAI,GAAK7hD,GAAW,EAKpC,IAHA,IAAMymI,EAAYF,EAAUJ,YAAcI,EAAUN,WAChDn5H,EAAQ,EACNk0C,EAAQ,GAER3N,EAAO9yC,KAAKC,KAAKgmI,EAAUC,GAAaA,EAC5CpzF,EAAOolB,EACPplB,GAAQozF,EAEJH,GAAajzF,GAA+B,EAAvBkzF,EAAUN,aACjCjlF,EAAM3+C,KAAK,CAAEsL,KAAM,QAAS0lC,KAAMA,EAAO,EAAGvmC,UAC5CA,GAAS,IACAu5H,GAAehzF,GAA+B,EAAvBkzF,EAAUN,cAC1CjlF,EAAM3+C,KAAK,CAAEsL,KAAM,QAAS0lC,KAAMA,EAAO,EAAGvmC,UAC5CA,GAAS,GAGb,OAAOk0C,E,gCCnEHrrC,EAAYC,aAAW,SAAAnB,GAI3B,MAAO,CACLiyH,WAAY,CACV9iI,OAAQ,OACR0P,WANemB,EAAMjE,QAAQD,SAC7BqI,eAAKnE,EAAMjE,QAAQD,SAASF,KAAM,IAClCuI,eAAKnE,EAAMjE,QAAQJ,QAAQC,KAAM,IAKjCrL,SAAU,WACVgT,OAAQ,GACRyjB,UAAW,SACXzc,SAAU,UAEZ2nH,kBAAmB,CACjB7wH,OAAQ,YACRnW,MAAO,OACP4T,UAAW,GAEbqzH,eAAgB,CACd3zH,MAAOwB,EAAMjE,QAAQD,SACjBkE,EAAMjE,QAAQD,SAASiD,aACvBiB,EAAMjE,QAAQJ,QAAQoD,cAE5BqzH,QAAS,CACPC,YAAa,OACbhxH,OAAQ,aAEVgC,MAAO,CACL5D,YAAaO,EAAMJ,QAAQ,GAC3BiL,aAAc7K,EAAMJ,QAAQ,IAE9B0yH,MAAO,CACLriH,cAAe,OACf9gB,OAAQ,OACRjE,MAAO,EACPqF,SAAU,WACVgT,OAAQ,QAKd,SAASgvH,EAAT,GAQG,IAPDznI,EAOC,EAPDA,MACA0nI,EAMC,EANDA,SAMC,IALDC,wBAKC,MALkB,8BAKlB,IAC2BzwH,qBAD3B,mBACM0wH,EADN,KACcC,EADd,OAE+B3wH,qBAF/B,mBAEM4wH,EAFN,KAEgBC,EAFhB,OAG2B7wH,qBAH3B,mBAGM8wH,EAHN,KAGcC,EAHd,KAIKC,EAAc5wH,iBAAuB,MACrC6wH,EAAgB7wH,iBAAO,MACvBC,EAAUnB,IACVe,OAA2BnT,IAAX4jI,EAiEtB,SAASz1C,EAAUz6E,GACjBA,EAAMC,iBACND,EAAMm3E,kBACFq5C,EAAYrwH,SACdgwH,EACEnwH,EAAMimB,QAAUuqG,EAAYrwH,QAAQkmB,wBAAwB55B,MAKlE,SAASsT,EAAUC,GACbwwH,EAAYrwH,SACdowH,EACEvwH,EAAMimB,QAAUuqG,EAAYrwH,QAAQkmB,wBAAwB55B,MAKlE,SAASquF,IACPy1C,OAAUjkI,GAGZ,GArFAwT,qBAAU,WACR,SAAS4wH,EAAgB1wH,GACvB,GAAIwwH,EAAYrwH,SAAWV,EAAe,CACxC,IAAMkxH,EACJ3wH,EAAMimB,QAAUuqG,EAAYrwH,QAAQkmB,wBAAwB55B,KAC9D4jI,EAAYM,IAIhB,SAASC,IAcP,GAZEJ,EAAYrwH,cACD7T,IAAX4jI,QACa5jI,IAAb8jI,GAEI9mI,KAAKshD,IAAIwlF,EAAWF,GAAU,GAChC5nI,EAAMuoH,uBACJmf,EAAS1nE,OAAO4nE,GAChBF,EAAS1nE,OAAO8nE,IAMpBI,EAAYrwH,cACD7T,IAAX4jI,QACa5jI,IAAb8jI,EACA,CACA,IAAMS,EAAYb,EAAS1nE,OAAO4nE,GAClC5nI,EAAMkpH,SACJloH,KAAK66C,MAAM0sF,EAAUnnF,OACrBmnF,EAAU9mI,QACV8mI,EAAUh7H,OAGds6H,OAAU7jI,GACV+jI,OAAY/jI,QAEGA,IAAX4jI,GACFK,OAAUjkI,GAId,SAASwkI,EAAc9wH,GACH,WAAdA,EAAM9U,MACRilI,OAAU7jI,GACV+jI,OAAY/jI,IAIhB,OAAImT,GACF9W,OAAO2X,iBAAiB,YAAaowH,GAAiB,GACtD/nI,OAAO2X,iBAAiB,UAAWswH,GAAe,GAClDjoI,OAAO2X,iBAAiB,UAAWwwH,GAAe,GAC3C,WACLnoI,OAAO4X,oBAAoB,YAAamwH,GAAiB,GACzD/nI,OAAO4X,oBAAoB,UAAWqwH,GAAe,GACrDjoI,OAAO4X,oBAAoB,UAAWuwH,GAAe,KAGlD,eACN,CAACrxH,EAAe2wH,EAAUF,EAAQ5nI,EAAO0nI,SAwB7B1jI,IAAX4jI,EACF,OACE,yBAAK7xH,MAAO,CAAEtQ,SAAU,kBACVzB,IAAXgkI,EACC,kBAACx6G,EAAA,EAAD,CACEpS,MAAOjE,EACP8lB,UAAU,MACV3b,MAAO4f,oBAAUwmG,EAAS1nE,OAAOgoE,IACjCzmH,OAAK,GAEL,yBACE1K,UAAWU,EAAQiwH,MACnBzxH,MAAO,CACL5R,KAAM6jI,MAIV,KACJ,yBACEnxH,UAAWU,EAAQ6vH,kBACnB/uH,KAAK,eACL4B,IAAKiuH,EACL/vH,YAAag6E,EACb3nE,WAAYgoE,EACZ30D,YAAapmB,GAEZkwH,IAMT,IAOIc,EACAC,EARAvkI,EAAOyjI,GAAU,EACjBxnI,EAAQ,EAQZ,QAPe4D,IAAX4jI,QAAqC5jI,IAAb8jI,IAC1B3jI,EAAO2jI,EAAWF,EAASE,EAAWF,EACtCxnI,EAAQ0nI,EAAWF,GAKjBA,IACFa,EAAef,EAAS1nE,OAAO4nE,GAC/Bc,EAAgBhB,EAAS1nE,OAAO4nE,EAASxnI,GACrC0nI,GAAYA,EAAWF,GAAQ,OACA,CAACc,EAAeD,GAA/CA,EAD+B,KACjBC,EADiB,KAKrC,OACE,yBAAK3yH,MAAO,CAAEtQ,SAAU,aACrB0iI,EAActwH,QACb,oCACE,kBAAC8wH,EAAA,EAAD,CACE9xH,UAAWU,EAAQ+vH,QACnB/vH,QAAS,CACPgB,MAAOhB,EAAQgB,OAEjB6C,MAAI,EACJU,SAAUqsH,EAActwH,QACxBqE,aAAc,CACZnF,SAAU,MACVoF,WAAY,QAEdikG,gBAAiB,CACfrpG,SAAU,SACVoF,WAAY,SAEdysH,aAAW,EACXC,qBAAmB,GAEnB,kBAAC7qH,EAAA,EAAD,KACGyqH,EAAevnG,oBAAUunG,GAAgB,KAG9C,kBAACE,EAAA,EAAD,CACE9xH,UAAWU,EAAQ+vH,QACnB/vH,QAAS,CACPgB,MAAOhB,EAAQgB,OAEjB6C,MAAI,EACJU,SAAUqsH,EAActwH,QACxBqE,aAAc,CACZnF,SAAU,MACVoF,WAAY,SAEdikG,gBAAiB,CACfrpG,SAAU,SACVoF,WAAY,QAEdysH,aAAW,EACXC,qBAAmB,GAEnB,kBAAC7qH,EAAA,EAAD,KACG0qH,EAAgBxnG,oBAAUwnG,GAAiB,MAIhD,KACJ,yBACEzuH,IAAKkuH,EACLtxH,UAAWU,EAAQ4vH,WACnBpxH,MAAO,CACL5R,OACA/D,MAAOY,KAAKshD,IAAIliD,GAChBiE,OAAQw/G,OAGZ,yBACE1pG,cAAY,sBACZtD,UAAWU,EAAQ6vH,kBACnB/uH,KAAK,eACL4B,IAAKiuH,EACL/vH,YAAag6E,EACb3nE,WAAYgoE,EACZ30D,YAAapmB,GAEZkwH,IAYTF,EAAmBhjH,aAAe,CAChCkjH,iBAAkB,+BAGLr/H,yBAASm/H,GC9QlBrxH,EAAYC,aAAW,SAAAnB,GAC3B,IAAM4zH,EAAgB5zH,EAAMjE,QAAQD,SAChCkE,EAAMjE,QAAQD,SAASiP,MACvB/K,EAAMjE,QAAQJ,QAAQoP,MAC1B,MAAO,CACL8oH,SAAU,CACR3oI,MAAO,OACPiE,OAAQw/G,IACRpkG,SAAU,UAEZupH,eAAgB,CACdp1H,gBAAiBsB,EAAMjE,QAAQ8C,WAAW4E,QAC1ClT,SAAU,WACVoT,IAAK,EACLxU,OAAQw/G,IACR3+F,OAAQ,YACR+jH,kBAAmB,SAErBC,sBAAuB,CACrB3qG,gBAAiB,sKACjB4qG,iBAAkB,UAEpBC,sBAAuB,CACrB7qG,gBAAiB,kKACjB4qG,iBAAkB,UAEpBE,6BAA8B,CAC5BjpI,MAAO,GACPiE,OAAQ,KACR0P,WAAY,iHAEZo1H,iBAAkB,WAClBG,eAAgB,WAChBC,oBAAqB,MACrBC,uBAAwB,MACxBpwH,MAAO,QAETqwH,8BAA+B,CAC7BrpI,MAAO,GACPiE,OAAQ,KACR0P,WAAY,kHAEZo1H,iBAAkB,WAClBG,eAAgB,WAChBI,qBAAsB,MACtBC,wBAAyB,MACzBvwH,MAAO,SAETwwH,gBAAiB,CACfnkI,SAAU,WACV4pB,WAAY,OACZw6G,WAAY,SACZ1kH,cAAe,OACfhhB,KAAM,GAER2lI,cAAe,CACbzlI,OAAQw/G,IACRzjH,MAAO,EACPqF,SAAU,WACV8V,QAAS,OACT6S,eAAgB,SAChBjJ,cAAe,QAEjB4kH,sBAAuB,CACrBh2H,WAAYsF,eAAKyvH,EAAe,IAChCrjI,SAAU,WACVpB,OAAQw/G,IACR1+F,cAAe,OACftM,KAAM,EACNJ,OAAQ,IACRuE,YAAa,EACbF,YAAa,QACboD,YAAa7G,eAAKyvH,EAAe,IACjCxsG,UAAW,eAEborG,SAAU,CACRrjI,OAAQu/G,IACRn+G,SAAU,YAEZukI,YAAa,CAAEvkI,SAAU,gBAKvBwkI,EAAU3hI,oBACd,YAMM,IALJtI,EAKI,EALJA,MACA0nI,EAII,EAJJA,SAKMxyH,EAAQ8E,cACRzC,EAAUnB,IAEd7V,EAEEP,EAFFO,SAJE,EAMAP,EADFkmC,cAAiB9B,EALf,EAKeA,cAAe8lG,EAL9B,EAK8BA,2BAG5BC,EAAej1H,EAAMjE,QAAQD,SAC/BkE,EAAMjE,QAAQD,SAASiP,MACvB/K,EAAMjE,QAAQJ,QAAQoP,MAE1B,IAAKmkB,EAAcjhC,OACjB,OAAO,KAET,IAAMinI,EAAahmG,EAAc,GAC3Bq0F,EAAYr0F,EAAcA,EAAcjhC,OAAS,GACjDknI,EAAU3C,EAASzpE,OAAO,CAC9Bx8D,QAAS2oI,EAAW3oI,QACpB2/C,MAAOgpF,EAAWtoI,SAAWsoI,EAAWvoI,IAAMuoI,EAAWzoI,MACzDJ,aAAc6oI,EAAW7oI,eAErB+oI,EAAW5C,EAASzpE,OAAO,CAC/Bx8D,QAASg3H,EAAUh3H,QACnB2/C,MAAOq3E,EAAU32H,SAAW22H,EAAU92H,MAAQ82H,EAAU52H,IACxDN,aAAck3H,EAAUl3H,eAGpBmwF,EAAU1wF,KAAKuB,IAAI,GAAIhC,GACvBgqI,EACJ74C,EACAw4C,EACC9lG,EAAcjhC,OAASnD,EAAMW,wBAA2B,EAErD4uF,EAAS,CACb,CAACmC,EAASkyB,KACV,CAAC2mB,EAAO3mB,KACR,CAAC0mB,EAAU,GACX,CAACD,EAAS,IAGZ,OACE,yBACEhmI,OAAQu/G,IACRxjH,MAAM,OACNyW,UAAWU,EAAQyyH,aAElBz6C,GACC,6BACEA,OAAQA,EAAOnpE,WACfpQ,KAAMqD,eAAK8wH,EAAc,IACzB9/G,OAAQhR,eAAK8wH,EAAc,UAUjCK,EAAWliI,oBACf,YAQM,IAPJtI,EAOI,EAPJA,MACAw9C,EAMI,EANJA,MACAkqF,EAKI,EALJA,SAMMnwH,EAAUnB,IACOq0H,EAAmBzqI,EAAlCkmC,cACA5E,EAAoBxZ,qBAAW9nB,GAA/BshC,gBACF0lG,EAAYZ,EAAgB5oF,EAAO,IAAK,IACvBktF,EAA2BhD,EAA1CxhG,cAER,IAAKukG,EAAermG,cAAcjhC,OAChC,OAAO,KAET,IAAMinI,EAAaK,EAAermG,cAAc,GAC1CumG,EACJjD,EAASzpE,OAAO,CACdx8D,QAAS2oI,EAAW3oI,QACpBF,aAAc6oI,EAAW7oI,aACzB6/C,MAAOgpF,EAAWtoI,SAAWsoI,EAAWvoI,IAAMuoI,EAAWzoI,SACrD,EAEF82H,EACJgS,EAAermG,cAAcqmG,EAAermG,cAAcjhC,OAAS,GAC/DynI,EACJlD,EAASzpE,OAAO,CACdx8D,QAASg3H,EAAUh3H,QACnB2/C,MAAOq3E,EAAU32H,SAAW22H,EAAU92H,MAAQ82H,EAAU52H,IACxDN,aAAck3H,EAAUl3H,gBACpB,EAER,OACE,yBAAKsV,UAAWU,EAAQwxH,UACtB,yBACElyH,UAAWU,EAAQwyH,sBACnBh0H,MAAO,CACL3V,MAAOwqI,EAAiBD,EACxBxmI,KAAMwmI,KAITD,EAAuB/hI,KAAI,SAACgqC,EAAKopB,GAChC,IACI8uE,EADEjsE,EAAWt9B,EAAgBv9B,IAAI4uC,EAAInxC,cAErCo9D,IACFisE,EAAejsE,EAAS0pC,gBAAgB31D,EAAIlxC,UAI9C,IAFA,IAAMqpI,EAAen4F,EAAI9wC,IAAM8wC,EAAIhxC,MAC7BopI,EAAa,GAEbx9H,EAAQ,EACZA,EAAQvM,KAAKiB,MAAM6oI,EAAe9D,EAAUN,YAC5Cn5H,IACA,CACA,IAAMy9H,GAAez9H,EAAQ,GAAKy5H,EAAUN,WAC5CqE,EAAWjoI,KACT6vC,EAAI7wC,SAAW6wC,EAAI9wC,IAAMmpI,EAAcr4F,EAAIhxC,MAAQqpI,GAIvD,OAASr4F,aAAezvC,IAatB,yBACEN,IAAG,UAAKo+B,KAAKE,UAAUyR,GAApB,YAA4BopB,GAC/BllD,UAAWyB,YACTf,EAAQyxH,eACRr2F,EAAI7wC,SACAyV,EAAQ6xH,sBACR7xH,EAAQ2xH,uBAEdnzH,MAAO,CACL5R,KAAMwuC,EAAIpyC,SACVH,MAAOuyC,EAAIhwC,QACXud,YAAa2qH,IAIf,kBAAC7sH,EAAA,EAAD,CACEjI,MAAO,CAAErC,MAAOm3H,GAChBh0H,UAAWU,EAAQqyH,iBAElBj3F,EAAIlxC,SAINspI,EAAWpiI,KAAI,SAACsiI,EAAWC,GAAZ,OACd,yBACEtoI,IAAG,UAAKo+B,KAAKE,UAAUyR,GAApB,YAA4Bs4F,EAA5B,YAAyCC,GAC5Cr0H,UAAWU,EAAQuyH,cACnB/zH,MAAO,CACL5R,MAAQ+mI,EAAW,GAAKlE,EAAUN,WAAclpF,EAChDr4B,cAAe,OACfzR,MAAOm3H,IAGRI,EAAU9pF,eAAe,cA7ChC,yBACEv+C,IAAG,UAAKo+B,KAAKE,UAAUyR,GAApB,YAA4BopB,GAC/BllD,UAAWU,EAAQyxH,eACnBjzH,MAAO,CACL3V,MAAOuyC,EAAIhwC,QACXwB,KAAMwuC,EAAIpyC,SACVqT,gBAAiB,OACjB2qB,gBACE,+HAoGHj2B,0BApDf,YAMG,IALDtI,EAKC,EALDA,MACA+Y,EAIC,EAJDA,SAKMxB,EAAUnB,IACRhW,EAA4BJ,EAA5BI,MAAOI,EAAqBR,EAArBQ,iBAETknI,EAAWzxG,IAAWc,OAAO,CACjCv2B,iBAAkBwgC,KAAKC,MAAMD,KAAKE,UAAU1gC,IAC5CG,wBAAyB,EACzBD,kBAAmBV,EAAMU,oBAE3BgnI,EAASn5D,iBAAiBnuE,GAC1BsnI,EAASre,iBAET,IAAM7rE,EACJx9C,EAAM4sE,SAAWxsE,EAlNE,GAkNOI,EAAiB2C,OAAS,IAEtD,OAAK3C,EAAiB2C,OAepB,6BACE,kBAAC,EAAD,CACEnD,MAAOA,EACP0nI,SAAUA,EACVC,iBACE,kBAAC6C,EAAD,CAAUxqI,MAAOA,EAAO0nI,SAAUA,EAAUlqF,MAAOA,MAGvD,yBAAK3mC,UAAWU,EAAQmwH,UACtB,kBAACuC,EAAD,CAASjqI,MAAOA,EAAO0nI,SAAUA,IAChC3uH,IAvBH,oCACE,yBAAKlC,UAAWU,EAAQwxH,UACtB,kBAACz+D,EAAA,EAAD,CACEtnE,QAAQ,gBACR+S,MAAO,CAAEgM,UAAW,EAAG3hB,MAAO,WAGlC,6BAAM2Y,O,+DC5TR3C,GAAYC,YAAW,CAC3BgsD,UAAW,CACT9mD,QAAS,OACTkV,cAAe,MACflB,WAAY,UAEd47G,OAAQ,CACN/qI,MAAO,MA+CIkI,2BA3Cf,YAAmE,IAA3CtI,EAA2C,EAA3CA,MAChBuX,EAAUnB,KACRkwG,EAAiDtmH,EAAjDsmH,WAAYD,EAAqCrmH,EAArCqmH,WAAY5lH,EAAyBT,EAAzBS,QAASmrE,EAAgB5rE,EAAhB4rE,YAFwB,EAGvC10D,mBAA+B,KAArBlW,KAAKoqI,KAAK3qI,IAHmB,mBAG1DoG,EAH0D,KAGnDuW,EAHmD,KAOjE,OAHA5F,qBAAU,WACR4F,EAA+B,KAArBpc,KAAKoqI,KAAK3qI,MACnB,CAAC2c,EAAU3c,IAEZ,yBAAKoW,UAAWU,EAAQ8qD,WACtB,kBAAChjD,EAAA,EAAD,CACElF,cAAY,WACZY,QAAS,WACP/a,EAAM+pH,KAAe,EAAVtpH,IAEb2vB,SAAU3vB,GAAW6lH,EAAa,MAA0B,IAAhB16C,EAC5Cl4D,MAAM,aAEN,kBAAC,KAAD,OAGF,kBAAC23H,GAAA,EAAD,CACEx0H,UAAWU,EAAQ4zH,OACnBtkI,MAAOA,EACPrE,IAA8B,KAAxBxB,KAAKoqI,KAAK9kB,GAChB/jH,IAA8B,KAAxBvB,KAAKoqI,KAAK/kB,GAChB3rG,SAAU,SAACsjB,EAAGrc,GAAJ,OAAYvE,EAASuE,IAC/B2pH,kBAAmB,kBAAMtrI,EAAMwuE,OAAN,SAAa,GAAO3nE,EAAQ,OACrDupB,SAA0B,IAAhBw7C,IAEZ,kBAACvsD,EAAA,EAAD,CACElF,cAAY,UACZY,QAAS,WACP/a,EAAM+pH,KAAK/pH,EAAMS,QAAU,IAE7B2vB,SAAU3vB,GAAW4lH,EAAa,MAA0B,IAAhBz6C,EAC5Cl4D,MAAM,aAEN,kBAAC,KAAD,WClCF0C,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrC+rD,UAAW,CACT58D,OAAQu/G,IACRroG,QAAS,QAEXgwH,WAAY,CACVt3D,SAAU,SACVxmD,YAAa,GAEflU,OAAQ,CACNC,SAAU,GAEZgD,MAAO,GACPgvH,cAAe,CACbh3H,SAAU,KAEZi3H,UAAW,CACT13H,WAAYsF,eAAKnE,EAAMjE,QAAQ8C,WAAWwE,MAAO,IACjDlU,OArBkB,GAsBlB8N,OArBY,GAuBdqzG,GAAI,CACFjqG,QAAS,OACTgU,WAAY,SACZJ,WAAY,GAEdu8G,aAAc,CACZrnI,OAAQ,GACR6gB,OAAQ,OACR/S,OAAQ+C,EAAMJ,QAAQ,KAExB62H,aAAc,CACZl+G,YAAavY,EAAMJ,QAAQ,QAIzB82H,GAAWtjI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACrBuX,EAAUnB,KAChB,OACE,kBAAC4F,EAAA,EAAD,CACEjB,QAAS/a,EAAMotE,sBACfv2D,UAAWU,EAAQm0H,aACnBpqH,MAAM,sBACNza,MAAM,eACN6M,MAAM,aAEN,kBAAC,IAAD,CAAmBmD,UAAWU,EAAQo0H,mBAK5C,SAASE,GAAT,GAAgD,IAAzB7rI,EAAyB,EAAzBA,MACfuX,EAAUnB,KAChB,OACE,oCACE,kBAAC4F,EAAA,EAAD,CACEhZ,QAAQ,WACR6T,UAAWU,EAAQk0H,UACnB1wH,QAAS,kBAAM/a,EAAM0pH,OAAO,MAE5B,kBAAC,IAAD,OAEF,kBAAC1tG,EAAA,EAAD,CACEhZ,QAAQ,WACR6T,UAAWU,EAAQk0H,UACnB1wH,QAAS,kBAAM/a,EAAM0pH,MAAM,MAE3B,kBAAC,IAAD,QAMR,IAAMoiB,GAAcxjI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACxBuX,EAAUnB,KACRmuG,EAAkBvkH,EAAlBukH,cACR,OACE,kBAACvmG,EAAA,EAAD,CAAYhb,QAAQ,QAAQ0Q,MAAM,gBAAgBmD,UAAWU,EAAQiuG,IAArE,UACMxkH,KAAK66C,MAAM0oE,GAAepjE,eAAe,SAD/C,WA8EW4qF,GAxEgBzjI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACnCuX,EAAUnB,KACVlB,EAAQ8E,cACRhB,EAAU8O,qBAAW9nB,GACEokC,EAAoCpkC,EAAzDskH,oBAAoC9jH,EAAqBR,EAArBQ,iBAEtCwrI,EAAqB55C,uBACzB,SAACyzC,GACC,IACE,GAAIA,EAAgB,CAClB,IAAMF,EAAgC3lI,EAAMQ,iBAAiBi6B,MAC3D,SAAAn5B,GAAM,OAAIukI,IAAmBvkI,EAAOG,WAKlCkkI,GACF3lI,EAAM0sE,oBAAoB,CAACi5D,IAE3B3lI,EAAMqpH,kBAENwc,GAAkB7lI,EAAMknH,eAAe2e,IAG3C,MAAOjrG,GACP8F,QAAQU,KAAKxG,GACb5hB,EAAQq0C,OAAR,UAAkBzyB,GAAK,cAG3B,CAAC56B,EAAOgZ,IA7B2D,EAgCnCorB,EAAc,IAAM,CAAE3iC,QAAS,IAAzDD,EAhC6D,EAgC7DA,aAAcC,EAhC+C,EAgC/CA,QAEhBwqI,EACJ,yBAAKp1H,UAAWU,EAAQ0pD,WACtB,kBAAC2qE,GAAD,CAAU5rI,MAAOA,IACjB,yBAAK6W,UAAWU,EAAQgC,SACxB,kBAAC2yH,EAAA,EAAD,CAAW73D,KAAG,EAACx9D,UAAWU,EAAQg0H,YAChC,kBAACM,GAAD,CAAa7rI,MAAOA,IACpB,kBAAC,EAAD,CACEykI,SAAUuH,EACVxqI,aAAcA,EACdqF,MAAOrG,EAAiB2C,OAAS,EAAI,GAAK1B,EAC1CzB,MAAOA,EACP0kI,eAAgB,CACd1hI,QAAS,WACT6T,UAAWU,EAAQi0H,cACnBz1H,MAAO,CAAE5D,OArIL,EAqIsBqC,SAAU,SACpC4d,WAAY,CACVrc,MAAO,CACL9V,QAAS,EACToE,OA1IM,GA2IN0P,WAAYsF,eAAKnE,EAAMjE,QAAQ8C,WAAWwE,MAAO,UAM3D,kBAACuzH,GAAD,CAAa9rI,MAAOA,IACpB,kBAAC,GAAD,CAAcA,MAAOA,IACrB,yBAAK6W,UAAWU,EAAQgC,UAI5B,OAAIvZ,EAAMikH,mBACDgoB,EAGF,kBAAC,EAAD,CAAkBjsI,MAAOA,GAAQisI,M,qFC5JpC71H,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCrB,KAAM,CACJE,WAAYsF,eAAKnE,EAAMjE,QAAQ8C,WAAWwE,MAAO,IACjD,UAAW,CACTxE,WAAYmB,EAAMjE,QAAQ8C,WAAWwE,OAEvC4zH,WAAYj3H,EAAMk3H,YAAYr1G,OAAO,CAAC,cAAe,CACnDs1G,SAAUn3H,EAAMk3H,YAAYC,SAASC,YAGzCr8H,UAAW,CACTkC,OAAQ,SACR/R,MAAO,MACP6S,SAAU,SACVkS,cAAe,QAEjBonH,WAAY,CACVh2H,OAAQ,OACR7C,MAAO,WAET84H,eAAgB,CACdjxH,QAAS,eACTkxH,cAAe,SACftnH,cAAe,QAEjBg8C,WAAY,CACVlhE,QAASiV,EAAMJ,QAAQ,QAMrB43H,GAAaxvH,IAAMC,YACvB,SAACpI,EAAsDkF,GACrD,IAAM1C,EAAUnB,KAD6C,EAE7B8G,IAAMhG,SAA6B,MAFN,mBAEtD4E,EAFsD,KAE5CwE,EAF4C,KAGrD3U,EAAqBoJ,EAArBpJ,MAAOkL,EAAc9B,EAAd8B,UACT8J,EAAO8F,4BAAkB9a,GACzBqN,EAAU8O,qBAAWnc,GACrBC,EAAYD,EAAME,cAClB0E,EAAU6X,kBAAQzc,EAAO,WAMzBoQ,EAAc,WAClBuE,EAAY,OAmBVrQ,EAAYmY,kBAAQzc,EAAO,QAe/B,MAd+B,2BAA3Byc,kBAAQzc,EAAO,UACjBsE,EAAY,qBACZ+I,EAAQkiC,WAAW75C,SAAQ,SAAAu9D,GACrBA,EAASyU,WAAaznE,IACxBqE,EAAY,uBAAH,OAA0B5I,yBAAeu3D,EAAU,QAAnD,UAWb,oCACE,kBAACx9C,EAAA,EAAD,CAAOnH,IAAKA,EAAKpD,UAAWyB,YAAKzB,EAAWU,EAAQ1D,OAClD,0BACE84H,WAAS,EACT91H,UAAWU,EAAQg1H,WACnBK,YArCY,SAACl1H,GACnB,IAAM4G,EAAS5G,EAAM4G,OACjBA,EAAOuuH,aACTn1H,EAAMo1H,aAAaC,aACjBzuH,EAAOuuH,WACP,GACA,IAEFlsH,EAAK4oG,mBAAmB59G,EAAMzH,MA8B1B8oI,UA1BU,WAChBrsH,EAAK4oG,wBAAmBvlH,IA0BlBmW,cAAA,qBAA2BwG,EAAKzc,GAAhC,YAAsCqM,IAEtC,kBAAC,KAAD,CAAUsG,UAAWU,EAAQi1H,kBAE/B,kBAACntH,EAAA,EAAD,CACEtE,QAAS,kBAAM4F,EAAK6pB,UAAUj6B,IAC9BsG,UAAWU,EAAQ4pD,WACnB7/C,MAAM,mBACN5N,MAAM,aAEN,kBAAC,KAAD,OAEF,kBAACsK,EAAA,EAAD,CACEhb,QAAQ,QACRib,UAAU,OACVpH,UAAWU,EAAQtH,WAElBA,GAEH,kBAACoP,EAAA,EAAD,CACEkB,gBAAc,cACdC,gBAAc,OACdzF,QArEY,SAACrD,GACnB4I,EAAY5I,EAAM+I,gBAqEZ5J,UAAWU,EAAQ4pD,WACnBztD,MAAM,YACNyG,cAAY,kBACZiW,UAAWzkB,EAAM27B,eAAenkC,QAEhC,kBAAC,KAAD,QAGJ,kBAAC,QAAD,CACE2Y,SAAUA,EACVM,gBA9CN,SAA6B4hB,EAAY1hB,GACvCA,IACAP,KA6CIX,KAAMC,QAAQS,GACdS,QAASR,EACTH,UAAW,uBACL5C,EAAQm9F,wBACRn9F,EAAQm9F,wBAAwBvqG,GAChC,IAHK,aAIND,EAAM27B,iBACT4vB,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAWA,EAAE8mF,UAAY,IAAMn6G,EAAEm6G,UAAY,YAO/Cp3G,sBAASokI,IC9IlBt2H,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCrB,KAAM,GACN+E,aAAc,CACZvU,OAAQ0/G,IACRznF,UAAW,aACX72B,SAAU,WACVgT,OAAQ,GAEV6pD,QAAS,CACPn9C,cAAe,OACf1f,SAAU,WACVoT,IAAK,EACL1U,KAAM,EACN/D,MAAO,OACPqY,OAAQ,EACRsE,aAAc7H,EAAMvL,MAAMoT,cAE5BkwH,4BAA6B,CAC3BxnI,SAAU,WAEVtB,MAAO,EACPE,OAAQ,OACRjE,MAAO,QAET8sI,WAAY,CACVz0H,OAAQ,EACRtG,OAAQ+C,EAAMJ,QAAQ,IAExBq4H,iBAAkB,CAChB1nI,SAAU,WACV8V,QAAS,gBAEX6xH,kBAAmB,CACjB3nI,SAAU,YAEZ4nI,wBAAyB,CACvB70H,UAAW,OACXw8D,UAAW,SACXt4D,WAAY,SACZjX,SAAU,WACVsO,WAAY,OACZ0E,OAAQ,EACR6jB,UAAW,mBA2GAh0B,2BArGf,SAAwByM,GAItB,IAAMwC,EAAUnB,KACRpW,EAAiB+U,EAAjB/U,MAAO2L,EAAUoJ,EAAVpJ,MACT4P,EAAU5P,EAAMo+B,SAAS,GACvBi/E,EAAiDhpH,EAAjDgpH,iBAAkB5E,EAA+BpkH,EAA/BokH,gBAAiBuC,EAAc3mH,EAAd2mH,UACnCtiH,EAAWkX,EAAXlX,OACFsc,EAAO8F,4BAAkBlL,GACzBhL,EAAU6X,kBAAQzc,EAAO,WACzBsO,EAAM3C,iBAAO,MAEnBE,qBAAU,WAIR,OAHIyC,EAAIpC,UACN7X,EAAMq+D,UAAU9tD,GAAW0J,EAAIpC,SAE1B,kBACE7X,EAAMq+D,UAAU9tD,MAExB,CAACvQ,EAAMq+D,UAAW9tD,IAUrB,IAAM+8H,EAAuBC,gCAT7B,gBAEwBvpI,IAApBogH,GACApjG,kBAAQzF,IACR6oG,IAAoB7oG,EAAQrX,IAE5ByiH,EAAUvC,EAAiBz4G,EAAMzH,MAG0B,KACvDomD,EAAqC/uC,EAArC+uC,mBAAoBhB,EAAiB/tC,EAAjB+tC,aACtBkkF,OAA6BxpI,IAApBogH,GAAiCA,IAAoB7oG,EAAQrX,GAE5E,OACE,yBAAK2S,UAAWU,EAAQ1D,MACA,WAArB8M,EAAKujG,YACJ,kBAAC,GAAD,CACEv4G,MAAOA,EACPkL,UAAWyB,YACTf,EAAQ21H,WACa,gBAArBvsH,EAAKujG,YACD3sG,EAAQ61H,kBACR71H,EAAQ41H,oBAGd,KAEJ,kBAAC/rH,EAAA,EAAD,CACEpe,QAAQ,WACR6T,UAAWU,EAAQ81H,wBACnBt3H,MAAO,CAAE1R,UACTopI,SAAU,SAAA/1H,GACR,IAAM4G,EAAS5G,EAAM4G,OACrB/C,EAAQopB,aAAarmB,EAAOkkB,YAE9BkrG,YAAaJ,EACbnzH,cAAA,kCAAwCwG,EAAKzc,GAA7C,YAAmDqM,GACnD8H,KAAK,gBAEL,yBACE4B,IAAKA,EACLpD,UAAWU,EAAQ01H,4BACnBl3H,MAAO,CAAEI,UAAW,UAAF,OAAYnW,EAAM4rE,YAAlB,OAElB,kBAACthB,EAAD,CACEtqD,MAAOub,EACPihB,WAAY,GACZmxG,mBAAoB3kB,KAIvB1/D,EACC,yBACEvzC,MAAO,CACLtQ,SAAU,WACVtB,KAAM,EACN0U,IAAK0C,EAAQlX,OAAS,KAGvB,IACD,kBAACilD,EAAD,CAActpD,MAAOub,KAErB,MAEN,yBACE1E,UAAWU,EAAQ+qD,QACnBvsD,MAAO,CACL1R,OAAQkX,EAAQlX,OAChB0P,WAAYy5H,EAAS,0BAAuBxpI,GAE9C0pI,YAAaJ,IAEf,kBAAC,gBAAD,CACEx2H,OAAQyE,EAAQkpB,aAChB5tB,UAAWU,EAAQqB,mB,2CC1IrBxC,GAAYC,aAAW,SAAAnB,GAI3B,MAAO,CACLiyH,WAAY,CACV9iI,OAAQ,OACR0P,WANemB,EAAMjE,QAAQD,SAC7BqI,eAAKnE,EAAMjE,QAAQD,SAASF,KAAM,IAClCuI,eAAKnE,EAAMjE,QAAQJ,QAAQC,KAAM,IAKjCrL,SAAU,WACVgT,OAAQ,GACRyjB,UAAW,SACXzc,SAAU,UAEZ2nH,kBAAmB,CACjB7wH,OAAQ,YACRnW,MAAO,OACP4T,UAAW,GAEbqzH,eAAgB,CACd3zH,MAAOwB,EAAMjE,QAAQD,SACjBkE,EAAMjE,QAAQD,SAASiD,aACvBiB,EAAMjE,QAAQJ,QAAQoD,cAE5BqzH,QAAS,CACPC,YAAa,OACbhxH,OAAQ,aAEVgC,MAAO,CACL5D,YAAaO,EAAMJ,QAAQ,GAC3BiL,aAAc7K,EAAMJ,QAAQ,IAE9B0yH,MAAO,CACLriH,cAAe,OACf9gB,OAAQ,OACRjE,MAAO,EACPqF,SAAU,WACVgT,OAAQ,QAKRm1H,GAAgBtlI,oBACpB,YAAuD,IAApDtI,EAAoD,EAApDA,MAAO6tI,EAA6C,EAA7CA,OACFt2H,EAAUnB,KAChB,OACE,kBAACoX,EAAA,EAAD,CACEpS,MAAI,EACJ6hB,UAAU,MACV3b,MAAO4f,oBAAUlhC,EAAMggE,OAAO6tE,IAC9BtsH,OAAK,GAEL,yBACE1K,UAAWU,EAAQiwH,MACnBzxH,MAAO,CACL5R,KAAM0pI,EACN95H,WAAY,aAQxB,SAAS+5H,GAAT,GAMG,IALD9tI,EAKC,EALDA,MAKC,IAJD2nI,wBAIC,MAJkB,8BAIlB,IAC2BzwH,qBAD3B,mBACM0wH,EADN,KACcC,EADd,OAE+B3wH,qBAF/B,mBAEM4wH,EAFN,KAEgBC,EAFhB,OAM2C7wH,qBAN3C,mBAMMinB,EANN,KAMsB4vG,EANtB,OAW2B72H,qBAX3B,mBAWM8wH,EAXN,KAWcC,EAXd,KAYKC,EAAc5wH,iBAAuB,MACrC6wH,EAAgB7wH,iBAAO,MACvBC,EAAUnB,KACVe,OAA2BnT,IAAX4jI,QAA2C5jI,IAAnBm6B,EAgD9C,SAASg0D,EAAUz6E,GACjBA,EAAMC,iBACND,EAAMm3E,kBACN,IAAMw5C,EACJ3wH,EAAMimB,QACLjmB,EAAM4G,OAA0Byf,wBAAwB55B,KAC3D0jI,EAAUQ,GACVN,EAAYM,GAGd,SAAS5wH,EAAUC,GACjB,IAAM4G,EAAS5G,EAAM4G,OACrB2pH,EAAUvwH,EAAMimB,QAAUrf,EAAOyf,wBAAwB55B,MAG3D,SAASquF,IACPy1C,OAAUjkI,GACVhE,EAAMwmH,gBAAWxiH,OAAWA,GAgC9B,SAAS+X,IACPgyH,OAAkB/pI,GAClB6jI,OAAU7jI,GACV+jI,OAAY/jI,GAlGdwT,qBAAU,WACR,SAAS4wH,EAAgB1wH,GACvB,GAAIwwH,EAAYrwH,SAAWV,EAAe,CACxC,IAAMkxH,EACJ3wH,EAAMimB,QAAUuqG,EAAYrwH,QAAQkmB,wBAAwB55B,KAC9D4jI,EAAYM,IAIhB,SAASC,EAAc5wH,GACrB,QAAe1T,IAAX4jI,GAAwBM,EAAYrwH,QAAS,KACvC8lB,EAAqBjmB,EAArBimB,QAASC,EAAYlmB,EAAZkmB,QAEXxY,EAAUuY,EADJuqG,EAAYrwH,QACMkmB,wBAAwB55B,KAGtD4pI,EAAkB,CAChB3oH,UACAuY,UACAC,YAEFqqG,OAAUjkI,IAGd,OAAImT,GACF9W,OAAO2X,iBAAiB,YAAaowH,GACrC/nI,OAAO2X,iBAAiB,UAAWswH,GAC5B,WACLjoI,OAAO4X,oBAAoB,YAAamwH,GACxC/nI,OAAO4X,oBAAoB,UAAWqwH,KAGnC,eACN,CAACV,EAAQzwH,EAAegnB,IAE3B3mB,qBAAU,YAELL,QACYnT,IAAb8jI,QACW9jI,IAAX4jI,GACA5mI,KAAKshD,IAAIwlF,EAAWF,IAAW,GAE/B7rH,MAED,CAAC5E,EAAe2wH,EAAUF,EAAQ5nI,EAAMS,UAyD3C,IAAM2a,EAAOC,QAAQ8iB,GAOrB,IAAMviB,EAAY,CAChB,CACEkV,MAAO,iBACP1W,KAAM4zH,KACNjzH,QAAS,YA9Cb,WACE,QAAe/W,IAAX4jI,QAA2C5jI,IAAnBm6B,EAA5B,CAGA,IAAIsiB,EAASmnF,EACTjiF,EAAUxnB,EAAe/Y,QAC7B,GAAIugC,EAAUlF,EAAQ,OACC,CAACkF,EAASlF,GAA7BA,EADkB,KACVkF,EADU,KAGtB,IAAM6+D,EAAaxkH,EAAMggE,OAAOvf,GAC1BgkE,EAAczkH,EAAMggE,OAAOra,GACjC3lD,EAAMwlD,OAAOg/D,EAAYC,IAoCrBwpB,GACAlyH,MAGJ,CACE+U,MAAO,eACPV,cACepsB,IAAb8jI,QACW9jI,IAAX4jI,GACA5mI,KAAKshD,IAAIwlF,EAAWF,GAAU5nI,EAAMS,QAAU,IAChD2Z,KAAMqrB,KACN1qB,QAAS,YA5Cb,WACE,QAAe/W,IAAX4jI,QAA2C5jI,IAAnBm6B,EAA5B,CAGA,IAAIsiB,EAASmnF,EACTjiF,EAAUxnB,EAAe/Y,QAE7B,GAAIugC,EAAUlF,EAAQ,OACC,CAACkF,EAASlF,GAA7BA,EADkB,KACVkF,EADU,KAGtB,IAAM6+D,EAAaxkH,EAAMggE,OAAOvf,GAC1BgkE,EAAczkH,EAAMggE,OAAOra,GACjC3lD,EAAMwmH,WAAWhC,EAAYC,IAiCzBypB,GACAnyH,OAKN,QAAe/X,IAAX4jI,EACF,OACE,yCACc5jI,IAAXgkI,EACC,kBAAC4F,GAAD,CAAe5tI,MAAOA,EAAO6tI,OAAQ7F,IACnC,KACJ,yBACE7tH,cAAY,sBACZtD,UAAWU,EAAQ6vH,kBACnB/uH,KAAK,eACL4B,IAAKiuH,EACL/vH,YAAag6E,EACb3nE,WAAYgoE,EACZ30D,YAAapmB,GAEZkwH,IAOT,IAAMvjI,EAAQ+5B,EAAiBA,EAAe/Y,QAAU0iH,GAAY,EAC9D3jI,EAAOC,EAAQwjI,EAASxjI,EAAQwjI,EAChCxnI,EAAQY,KAAKshD,IAAIl+C,EAAQwjI,GACzBa,EAAezoI,EAAMggE,OAAO77D,GAC5BukI,EAAgB1oI,EAAMggE,OAAO77D,EAAO/D,GACpC+tI,EAAkBntI,KAAKC,KAAKb,EAAQJ,EAAMS,SAChD,OACE,oCACG0nI,EAActwH,QACb,oCACE,kBAAC8wH,EAAA,EAAD,CACE9xH,UAAWU,EAAQ+vH,QACnB/vH,QAAS,CACPgB,MAAOhB,EAAQgB,OAEjB6C,MAAI,EACJU,SAAUqsH,EAActwH,QACxBqE,aAAc,CACZnF,SAAU,MACVoF,WAAY,QAEdikG,gBAAiB,CACfrpG,SAAU,SACVoF,WAAY,SAEdysH,aAAW,EACXC,qBAAmB,GAEnB,kBAAC7qH,EAAA,EAAD,KAAakjB,oBAAUunG,KAEzB,kBAACE,EAAA,EAAD,CACE9xH,UAAWU,EAAQ+vH,QACnB/vH,QAAS,CACPgB,MAAOhB,EAAQgB,OAEjB6C,MAAI,EACJU,SAAUqsH,EAActwH,QACxBqE,aAAc,CACZnF,SAAU,MACVoF,WAAY,SAEdikG,gBAAiB,CACfrpG,SAAU,SACVoF,WAAY,QAEdysH,aAAW,EACXC,qBAAmB,GAEnB,kBAAC7qH,EAAA,EAAD,KAAakjB,oBAAUwnG,MAGzB,KACJ,yBACEzuH,IAAKkuH,EACLtxH,UAAWU,EAAQ4vH,WACnBpxH,MAAO,CAAE5R,OAAM/D,UAEf,kBAAC4d,EAAA,EAAD,CAAYhb,QAAQ,KAAK6T,UAAWU,EAAQ8vH,gBACzC8G,EAAgBhtF,eAAe,SADlC,QAIF,yBACEhnC,cAAY,sBACZtD,UAAWU,EAAQ6vH,kBACnB/uH,KAAK,eACL4B,IAAKiuH,EACL/vH,YAAag6E,EACb3nE,WAAYgoE,EACZ30D,YAAapmB,GAEZkwH,GAEFxpG,EACC,kBAAC,QAAD,CACED,gBAAgB,iBAChBC,eAAgB,CACdh6B,KAAMg6B,EAAeR,QACrB9kB,IAAKslB,EAAeP,SAEtBxhB,gBAjIR,SAA6B4hB,EAAY1hB,GACvCA,IACAP,KAgIMX,KAAMA,EACNmB,QAASR,EACTH,UAAWA,IAEX,MAUVkyH,GAAWrpH,aAAe,CACxBkjH,iBAAkB,+BAGLr/H,0BAASwlI,I,oBC9UlB13H,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCk5H,kBAAmB,CACjB3uH,SAAU,SACVha,SAAU,YAEZ4oI,sBAAuB,CACrB5oI,SAAU,WACVgT,OAAQ,GAEVswH,SAAU,CACRtjI,SAAU,WACV8V,QAAS,OACT4J,cAAe,QAEjBmpH,eAAgB,CACdr7H,SAAU,OACVwF,OAAQ,EACR1E,WAAYmB,EAAMjE,QAAQ8C,WAAWwE,MACrCsxH,WAAY,SACZ1kH,cAAe,QAEjBmhC,KAAM,CACJ7gD,SAAU,WACVrF,MAAO,EACPmb,QAAS,OACT6S,eAAgB,SAChBjJ,cAAe,QAEjBopH,SAAU,CACRt7H,SAAU,OACVxN,SAAU,WACVtB,KAAM,MACN0U,IAAK,OACLwW,WAAY,OACZw6G,WAAY,SACZpxH,OAAQ,EACR0M,cAAe,OACfpR,WAAYmB,EAAMjE,QAAQ8C,WAAWwE,WAInCi2H,GAAwBlmI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MAClCuX,EAAUnB,KAGZq4H,EAAgB,EAMpB,OALAzuI,EAAM+sD,aAAa1rD,SAAQ,SAAC8f,EAAOyV,GAC7BzV,EAAM5gB,SAAWP,EAAMO,SAAW,IACpCkuI,EAAgB73G,MAIlB,oCACG52B,EAAM+sD,aAAapkD,KAAI,SAACwY,EAAO5T,GAC9B,OAAO4T,aAAiBje,MACrBie,EAAM9e,4BAA8BkL,IAAUkhI,GAC/C,kBAACzwH,EAAA,EAAD,CACEpb,IAAG,mBAAcue,EAAMve,IAApB,YAA2B2K,GAC9BwI,MAAO,CACL5R,KACEoJ,IAAUkhI,EACNztI,KAAKuB,IAAI,GAAIvC,EAAMO,UACnB4gB,EAAM5gB,SAAWP,EAAMO,SAAW,EACxCoU,YAAapH,IAAUkhI,EAAgB,EAAI,GAE7C53H,UAAWU,EAAQg3H,SACnBp0H,cAAA,mBAAyBgH,EAAM1f,UAE9B0f,EAAM1f,SAEP,YAMNitI,GAAyBpmI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACnCuX,EAAUnB,KAEhB,OACE,oCACGpW,EAAM+sD,aAAapkD,KAAI,SAACwY,EAAO5T,GAC9B,GAAI4T,aAAiBje,IAAc,CACjC,IAAMu+C,EAAQolF,EACZ1lH,EAAMxf,MACNwf,EAAMtf,IACN7B,EAAMS,SACN,GACA,GAGF,OACE,kBAAC,KAAD,CAAuBmC,IAAG,UAAKue,EAAMve,IAAX,YAAkB2K,GAAS4T,MAAOA,GACzDsgC,EAAM94C,KAAI,SAAA29C,GACT,GAAkB,UAAdA,EAAKl4C,KAAkB,CACzB,IAAMw1B,GACHziB,EAAMrf,SACHqf,EAAMtf,IAAMykD,EAAKxS,KACjBwS,EAAKxS,KAAO3yB,EAAMxf,OAAS3B,EAAMS,QACjCkuI,GAAcroF,EAAKxS,KAAO,GAAGqN,eAAe,SAClD,OACE,yBACEv+C,IAAK0jD,EAAKxS,KACVj9B,UAAWU,EAAQ+uC,KACnBvwC,MAAO,CAAE5R,KAAMy/B,IAEd+qG,EACC,kBAAC3wH,EAAA,EAAD,CAAYnH,UAAWU,EAAQ+2H,gBAC5BK,GAED,MAIV,OAAO,SAKf,OAAIxtH,aAAiBle,IACZ,kBAAC,KAAD,CAAsBL,IAAKue,EAAMve,IAAKxC,MAAO+gB,EAAMxe,UAExDwe,aAAiBpe,IAEjB,kBAAC,KAAD,CACEH,IAAKue,EAAMve,IACXxC,MAAO+gB,EAAMxe,QACboT,MAAO,CAAEhC,WAAY,QACrB6oB,SAA4B,aAAlBzb,EAAMne,UAIf,YAMTwnI,GAAWttH,IAAMC,YACrB,WAOElD,GACG,IANDja,EAMC,EANDA,MACA+V,EAKC,EALDA,MACAc,EAIC,EAJDA,UACGwG,EAGF,8CACG9F,EAAUnB,KAEVw4H,EAAa5uI,EAAM+sD,aAAaxsD,SAAWP,EAAMO,SACvD,OACE,kBAAC6gB,EAAA,EAAD,eACElJ,eAAa,OACbrB,UAAWyB,YAAKf,EAAQ62H,kBAAmBv3H,GAC3C7T,QAAQ,WACRiX,IAAKA,EACLlE,MAAOA,GACHsH,GAEJ,yBACExG,UAAWU,EAAQ82H,sBACnBt4H,MAAO,CACLI,UACwB,IAAtBnW,EAAM4rE,YAAN,iBACc5rE,EAAM4rE,YADpB,UAEI5nE,IAGR,yBACE6S,UAAWU,EAAQwxH,SACnBhzH,MAAK,aACH5R,KAAMyqI,EAAa,EACnBxuI,MAAOJ,EAAM+sD,aAAa8hF,cACvB94H,IAGL,kBAAC24H,GAAD,CAAwB1uI,MAAOA,MAGnC,kBAACwuI,GAAD,CAAuBxuI,MAAOA,QAMvBsI,sBAASkiI,IC3LlBp0H,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrC45H,4BAA6B,CAC3BrpI,SAAU,WACVpB,OAAQ,OACRjE,MAAO,OACPqY,OAAQ,EACR0M,cAAe,QAEjB4pH,wBAAyB,CACvBtpI,SAAU,WACVpB,OAAQ,OACRoU,OAAQ,EACR0M,cAAe,OACf5J,QAAS,QAEX+qC,KAAM,CACJ7gD,SAAU,WACVpB,OAAQ,OACRjE,MAAO,GAET4uI,UAAW,CACTj7H,WAAYmB,EAAMjE,QAAQ0U,KAAKspH,MAEjCC,UAAW,CACTn7H,WAAYmB,EAAMjE,QAAQk+H,aAGxBC,GAAyB9mI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACnCuX,EAAUnB,KAChB,OACE,oCACGpW,EAAM+sD,aAAapkD,KAAI,SAACwY,EAAO5T,GAC9B,GAAI4T,aAAiBje,IAAc,CACjC,IAAMu+C,EAAQolF,EAAU1lH,EAAMxf,MAAOwf,EAAMtf,IAAK7B,EAAMS,SACtD,OACE,kBAAC,KAAD,CAAuBmC,IAAG,UAAKue,EAAMve,IAAX,YAAkB2K,GAAS4T,MAAOA,GACzDsgC,EAAM94C,KAAI,SAAA29C,GACT,IAAM1iB,GACHziB,EAAMrf,SACHqf,EAAMtf,IAAMykD,EAAKxS,KACjBwS,EAAKxS,KAAO3yB,EAAMxf,OAAS3B,EAAMS,QACvC,OACE,yBACEmC,IAAK0jD,EAAKxS,KACVj9B,UAAWyB,YACTf,EAAQ+uC,KACM,UAAdA,EAAKl4C,MAAkC,iBAAdk4C,EAAKl4C,KAC1BmJ,EAAQy3H,UACRz3H,EAAQ23H,WAEdn5H,MAAO,CAAE5R,KAAMy/B,SAO3B,OAAIziB,aAAiBle,IACZ,kBAAC,KAAD,CAAsBL,IAAKue,EAAMve,IAAKxC,MAAO+gB,EAAMxe,UAExDwe,aAAiBpe,IAEjB,kBAAC,KAAD,CACEH,IAAKue,EAAMve,IACXxC,MAAO+gB,EAAMxe,QACbi6B,SAA4B,aAAlBzb,EAAMne,UAIf,YA8BAsF,2BAzBf,YAAmD,IAAzBtI,EAAyB,EAAzBA,MAClBuX,EAAUnB,KAEVw4H,EAAa5uI,EAAM+sD,aAAaxsD,SAAWP,EAAMO,SACvD,OACE,yBACEsW,UAAWU,EAAQu3H,4BACnB/4H,MAAO,CACLI,UACwB,IAAtBnW,EAAM4rE,YAAN,iBAAoC5rE,EAAM4rE,YAA1C,UAA2D5nE,IAG/D,yBACE6S,UAAWU,EAAQw3H,wBACnBh5H,MAAO,CACL5R,KAAMyqI,EACNxuI,MAAOJ,EAAM+sD,aAAa8hF,eAG5B,kBAACO,GAAD,CAAwBpvI,MAAOA,SC1GjCoW,GAAYC,aAAW,iBAAO,CAClCg5H,oBAAqB,CACnBt7H,WAAY,cACZ1P,OAAQ,OACRoU,OAAQ,EACRhT,SAAU,WACVyf,OAAQ,mBACRiwD,UAAW,OACX/4C,aAAc,OACdjX,cAAe,QAEjBmqH,eAAgB,CACd7pI,SAAU,WACV0f,cAAe,OACfzI,WAAY,SACZ2S,WAAY,YA8CD/mB,2BA1Cf,YAA+C,IAAzBtI,EAAyB,EAAzBA,MACZS,EAAyDT,EAAzDS,QAASgtD,EAAgDztD,EAAhDytD,eAAgBk3D,EAAgC3kH,EAAhC2kH,aAAcx7E,EAAkBnpC,EAAlBmpC,OAAQ/oC,EAAUJ,EAAVI,MACjD6Z,EAAM3C,iBAAuB,MAC7BC,EAAUnB,KACVm5H,EAAmBnvI,EAAQ,EAEjC,OAAO+oC,EAAOhmC,OACZ,yBACEgX,cAAY,uBACZtD,UAAWU,EAAQ83H,oBACnBh3H,KAAK,eACL4B,IAAKA,EACLlE,MAAO,CACL5R,KAAM,GAAF,OAAKorI,EAAL,MACJnvI,MAAOY,KAAKuB,IAAI,EAAI9B,EAAS,KAG9BgtD,GACC,yBAGEtzC,cAAY,kBACZtD,UAAWU,EAAQ+3H,eACnBj3H,KAAK,eACLtC,MAAO,CACL5R,KAAMnD,KAAKuB,IAAI,EAAI9B,EAAS,GAAK,EACjCoY,IAAK8rG,IAINl3D,EAAehsD,QAZlB,IAY4B,IACzBT,KAAKuB,IAAIvB,KAAK66C,MAAM4R,EAAejoD,QAAU,EAAG,KAIrD,QC9CA4Q,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCs6H,gBAAiB,CACf/pI,SAAU,WACVsX,aAAc7H,EAAMvL,MAAMoT,aAC1B0C,SAAU,UAEZlG,OAAQ,CACN9T,SAAU,WACVpB,OAAQ0/G,SAyKGz7G,2BAlKf,YAMG,IALDyQ,EAKC,EALDA,SACA/Y,EAIC,EAJDA,MAKMuX,EAAUnB,KAGVm0C,EAAQjzC,iBAAO,GACfm4H,EAAYn4H,kBAAO,GACnBiO,EAAUjO,mBACV2C,EAAM3C,iBAAuB,MAC7Bm4D,EAAQn4D,iBAAe,GAR5B,EAUyCJ,oBAAS,GAVlD,mBAUMC,EAVN,KAUqBC,EAVrB,KAiID,OArHAI,qBAAU,WACR,IAAIk4H,EAAU,aAEd,SAAStH,EAAgB1wH,GACvBA,EAAMC,iBACN,IACMC,EADQF,EAAMimB,QACK8xC,EAAM53D,QAC3BD,IAGG63H,EAAU53H,UACb43H,EAAU53H,SAAU,EACpBxX,OAAOsvI,uBAAsB,WAC3B3vI,EAAMgpH,kBAAkBpxG,GACxB63H,EAAU53H,SAAU,EACpB43D,EAAM53D,QAAUH,EAAMimB,aAM9B,SAAS2qG,IACP74D,EAAM53D,QAAU,EACZV,GACFC,GAAiB,GAYrB,OARID,IACF9W,OAAO2X,iBAAiB,YAAaowH,GAAiB,GACtD/nI,OAAO2X,iBAAiB,UAAWswH,GAAe,GAClDoH,EAAU,WACRrvI,OAAO4X,oBAAoB,YAAamwH,GAAiB,GACzD/nI,OAAO4X,oBAAoB,UAAWqwH,GAAe,KAGlDoH,IACN,CAAC1vI,EAAOmX,EAAes4D,IA2B1Bj4D,qBAAU,WACR,IAAMihB,EAAOxe,EAAIpC,QAGjB,SAAS+3H,EAAQC,GACf,IAAMn4H,EAAQo4H,KAAeD,IACH,IAAtBA,EAAUE,SACZF,EAAUl4H,iBACV4yC,EAAM1yC,SAAWH,EAAMs4H,OAAS,IAChChwI,EAAM+rE,eACJxhB,EAAM1yC,QAAU,EAAI,EAAI0yC,EAAM1yC,QAAU,GAAK,EAAI0yC,EAAM1yC,UAErD0N,EAAQ1N,SACVmH,aAAauG,EAAQ1N,SAEvB0N,EAAQ1N,QAAUkH,YAAW,WAC3B/e,EAAM+rE,eAAe,GACrB/rE,EAAMwuE,OACJjkB,EAAM1yC,QAAU,EACZ7X,EAAMS,SAAW,EAAI8pD,EAAM1yC,SAC3B7X,EAAMS,SAAW,EAAI8pD,EAAM1yC,UAEjC0yC,EAAM1yC,QAAU,IACf,OAKC7W,KAAKshD,IAAI5qC,EAAMu4H,QAAUjvI,KAAKshD,IAAI,EAAI5qC,EAAMs4H,SAC9CH,EAAUl4H,iBAEZ4yC,EAAM1yC,SAAWH,EAAMu4H,OAClBR,EAAU53H,UAGb43H,EAAU53H,SAAU,EACpBxX,OAAOsvI,uBAAsB,WAC3B3vI,EAAMgpH,iBAAiBz+D,EAAM1yC,SAC7B0yC,EAAM1yC,QAAU,EAChB43H,EAAU53H,SAAU,OAK5B,OAAI4gB,GACFA,EAAKzgB,iBAAiB,QAAS43H,GACxB,WACLn3G,EAAKxgB,oBAAoB,QAAS23H,KAG/B,eACN,CAAC5vI,IAGF,yBACEia,IAAKA,EACL5B,KAAK,eACLxB,UAAWU,EAAQi4H,gBACnBr3H,YAnFJ,SAAmBT,GAEjB,IAAM4G,EAAS5G,EAAM4G,OACjBA,EAAOquH,WAAaruH,EAAO4xH,QAAQC,SAKlB,IAAjBz4H,EAAM04H,SACR3gE,EAAM53D,QAAUH,EAAMimB,QACtBvmB,GAAiB,KA0EjBk5C,UApEJ,SAAiB54C,GACfA,EAAMC,iBACNP,GAAiB,IAmEfyuB,aAhEJ,SAAoBnuB,GAClBA,EAAMC,mBAiEJ,kBAAC,GAAD,CAAgB3X,MAAOA,IACtBA,EAAMmkH,eAAiB,kBAAC,GAAD,CAAYnkH,MAAOA,IAAY,KAEvD,kBAAC,GAAD,CACEA,MAAOA,EACP2nI,iBACE,kBAAC,GAAD,CACE3nI,MAAOA,EACP+V,MAAO,CAAE1R,OAAQy/G,IAAkBxnF,UAAW,kBAIpD,yBAAKzlB,UAAWU,EAAQgC,SACvBR,M,iCC3KD3C,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCm7H,oBAAqB,CACnBpwI,QAASiV,EAAMJ,QAAQ,IAEzBw7H,gBAAiB,CACf97H,SAAU,KAEZ47H,OAAQ,CACNj+H,OAAQ+C,EAAMJ,QAAQ,QAkJXy7H,GA5IIjoI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MACvBuX,EAAUnB,KACV4C,EAAU8O,qBAAW9nB,GACnByhB,EAAmCzI,EAAnCyI,cAAe6f,EAAoBtoB,EAApBsoB,gBAHkC,EAIHpqB,mBAAS,GAJN,mBAIlD6lF,EAJkD,KAI7BM,EAJ6B,OAKbnmF,mBAA6B,IALhB,mBAKlDs5H,EALkD,KAKlCC,EALkC,OAMXv5H,mBAAmB,IANR,mBAMlDisF,EANkD,KAMjCutC,EANiC,KAOnDvqH,EAAS1E,EAActe,OAAsC,GAA7B,2BAChCwtI,EAAWt1H,QAAQ8K,GACnB3kB,EAAeigB,EAAcs7E,GAC7Bv7E,EAAchgB,IAAiB2kB,EAAQ42E,EAAsB,GAqBnE,SAAS6zC,EAAqBp0H,GAC5B,IAAMmpH,EAAYxiC,EAAgB1oE,MAAK,SAAAvO,GAAC,OAAIskH,IAAmBtkH,EAAEzqB,WACjE,GAAIkkI,EACF3lI,EAAM0sE,oBAAoB,CAACi5D,IAG3B3lI,EAAMqpH,sBAEN,IACE7sG,GAASxc,EAAMknH,eAAe1qG,EAAOhb,GACrC,MAAOo5B,GACP8F,QAAQU,KAAKxG,GACb5hB,EAAQq0C,OAAR,UAAkBzyB,GAAK,YAK7B,OApCApjB,qBAAU,WACR,IAAI6pE,GAAO,EAaX,OAZC,sBAAC,8BAAA97E,EAAA,0DACI/D,EADJ,gCAEyB8/B,EAAgB+5D,gBAAgB75F,GAFzD,QAEQo9D,EAFR,SAGkBA,EAASh0C,UACjBA,EAAUgD,sBAAYgxC,EAASh0C,UAChCy2D,GAAQz2D,IACX6lH,EAAkB7lH,EAAQ,GAAGnpB,SAC7BivI,EAAmB9lH,KAPzB,0CAAD,GAYM,WACLy2D,GAAO,KAER,CAAC//C,EAAiB9/B,IAoBnB,kBAACqvI,GAAA,EAAD,CAAWh6H,UAAWU,EAAQ84H,qBAC5B,kBAACtwC,GAAA,EAAD,CAAM19B,WAAS,EAACvtD,QAAS,EAAGg8H,QAAQ,SAASvhH,WAAW,UACtD,kBAACwwE,GAAA,EAAD,CAAMS,MAAI,GACR,kBAAC3vE,EAAA,EAAD,CACEkoE,QAAM,EACN/1F,QAAQ,WACR6D,MAAO2a,EACP9G,SAAU,SAAAhD,GACR2lF,EAAuBvhE,OAAOpkB,EAAM4G,OAAOzX,SAE7CiqB,MAAM,WACNi1G,WAAY5/G,GAAS,0BACrBA,MAAOwqH,EACPvgH,SAAUugH,EACVx+H,OAAO,SACP0E,UAAWU,EAAQ+4H,iBAElB7uH,EAAc9Y,KAAI,SAACX,EAAM+zD,GAAP,OACjB,kBAAC44B,GAAA,EAAD,CAAU/xF,IAAKoF,EAAMnB,MAAOk1D,GACzB/zD,QAKT,kBAAC+3F,GAAA,EAAD,CAAMS,MAAI,GACPh/F,EACCgvI,GAAkBxwI,EAAMusE,cACtB,kBAAC,EAAD,CACEvsE,MAAOA,EACPwB,aACE2kB,OAAQniB,EAAYyd,EAAcs7E,GAEpCl2F,MAAO2pI,EACP/L,SAAUgM,EACV/L,eAAgB,CACdvyH,OAAQ,SACRnP,QAAS,WACT6T,UAAWU,EAAQ+4H,gBACnBvK,WAAY,gCACZvnH,OAAQ,SAAA9G,GACN+4H,EAAmB/4H,EAAM4G,OAA4BzX,QAEvDkqI,WAAY,SAAAr5H,GACV,IAAM8tH,EAAc9tH,EAAM4G,OAA4BzX,MACpC,UAAd6Q,EAAM9U,KACRguI,EAAqBpL,OAM7B,kBAACnjD,EAAA,EAAD,CACEhqE,KAAK,cACL3E,MAAM,UACNzB,KAAM,GACN++H,eAAa,IAGf,MAEN,kBAACjxC,GAAA,EAAD,CAAMS,MAAI,GACR,kBAACxkF,EAAA,EAAD,CACEoU,UAAWogH,EACX35H,UAAWU,EAAQ64H,OACnBr1H,QAAS,WACHy1H,GACFI,EAAqBJ,IAGzBxtI,QAAQ,YACR0Q,MAAM,WATR,QAaA,kBAACsI,EAAA,EAAD,CACEoU,UAAWogH,EACX35H,UAAWU,EAAQ64H,OACnBr1H,QAAS,WACP/a,EAAMspH,yBAAyB9nH,IAEjCwB,QAAQ,YACR0Q,MAAM,aAPR,sC,+BC1FKu9H,GAtDM3oI,oBAAS,SAACyM,GAA4C,IACjE/U,EAAU+U,EAAV/U,MACAS,EAAiDT,EAAjDS,QAAS6lH,EAAwCtmH,EAAxCsmH,WAAYD,EAA4BrmH,EAA5BqmH,WAAYz6C,EAAgB5rE,EAAhB4rE,YAFgC,EAGzC10D,qBAHyC,mBAGlE4E,EAHkE,KAGxDwE,EAHwD,KAKzE,OACE,oCACE,kBAACc,EAAA,EAAD,CAAOrL,MAAO,CAAEhC,WAAY,UAC1B,kBAACsL,EAAA,EAAD,CACE3L,MAAM,YACNqH,QAAS,SAAArD,GACP4I,EAAY5I,EAAM+I,iBAGpB,kBAAC,KAAD,OAGF,kBAACpB,EAAA,EAAD,CACElF,cAAY,WACZY,QAAS,WACP/a,EAAM+pH,KAAe,EAAVtpH,IAEb2vB,SAAU3vB,GAAW6lH,EAAa,MAA0B,IAAhB16C,EAC5Cl4D,MAAM,aAEN,kBAAC,KAAD,OAEF,kBAAC2L,EAAA,EAAD,CACElF,cAAY,UACZY,QAAS,WACP/a,EAAM+pH,KAAK/pH,EAAMS,QAAU,IAE7B2vB,SAAU3vB,GAAW4lH,EAAa,MAA0B,IAAhBz6C,EAC5Cl4D,MAAM,aAEN,kBAAC,KAAD,QAGJ,kBAACuI,GAAA,EAAD,CACEH,SAAUA,EACVV,KAAMC,QAAQS,GACdM,gBAAiB,SAAC4hB,EAAG1hB,GACnBA,IACAgE,OAAYtc,IAEduY,QAAS,WACP+D,OAAYtc,IAEd4X,UAAW5b,EAAM4b,gB,4GC9BzB,IAAMxF,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrC+vF,eAAgB,CACdhlG,QAASiV,EAAMJ,QAAQ,IAEzB6rE,YAAa,CACXl7E,SAAU,WACVrB,MAAO8Q,EAAMJ,QAAQ,GACrB+D,IAAK3D,EAAMJ,QAAQ,GACnBpB,MAAOwB,EAAMjE,QAAQ2vE,KAAK,MAE5BswD,cAAe,CACb9wI,MAAO,QAET+wI,aAAc,CACZhS,WAAY,mB,SASDiS,G,mFAAf,WACE7mI,EACA8mI,GAFF,mCAAA9rI,EAAA,6DAIQyT,EAAU8O,qBAAWvd,GACrB/I,GACJ,UAAA+I,EAAKi6G,kBAAL,eAAiBhjH,gBAAjB,UAAiC+I,EAAKk6G,mBAAtC,aAAiC,EAAkBjjH,eAAgB,GAC7DwmB,EAAgChP,EAAhCgP,WAAYsZ,EAAoBtoB,EAApBsoB,gBACd8oE,EARR,UAQyB9oE,EAAgBv9B,IAAIvC,UAR7C,aAQyB,EAAmCqK,cAGpDsc,EAAgB9gB,yBAAe+iG,EAAgB,CAAC,WAAY,YAE5DniF,EAAY,cAbpB,SAcwBiQ,QAAQC,IAC5Bk5G,EAAgB1oI,KAAI,SAAArH,GAAM,OACxB0mB,EAAWK,KAAKJ,EAAW,kBAAmB,CAC5CE,gBACA7mB,SACA2mB,kBAnBR,cAcQ01G,EAdR,yBAyBSA,EAAOh1H,KAAI,SAAAw1D,GAAK,OAAIA,EAAM,OAzBnC,6C,sBAkNe71D,2BAtLf,YAMG,IALDtI,EAKC,EALDA,MACA+b,EAIC,EAJDA,YAKMxE,EAAUnB,KACV4C,EAAU8O,qBAAW9nB,GAF1B,EAGyBkX,qBAHzB,mBAGMiP,EAHN,KAGaga,EAHb,OAI+BjpB,mBAAS,IAJxC,mBAIMm8D,EAJN,KAIgBwrD,EAJhB,KAKKxgG,EAAUhjB,SAASg4D,IAAah4D,QAAQ8K,GACtCq+F,EAA4BxkH,EAA5BwkH,WAAYC,EAAgBzkH,EAAhBykH,YAKd6sB,EAAkB1oH,mBACtB,kBAAM5oB,EAAM0oH,mBAAmBlE,EAAYC,KAC3C,CAACzkH,EAAOwkH,EAAYC,IAGtBjtG,qBAAU,WACR,IAAI+5H,GAAS,EAEb,SAASC,EAAeC,GACtB,IAAMC,EAA6B,GAC7BC,EAA8B,GACpCF,EAAUpwI,SAAQ,SAAC88D,GACjB,IAAMyzE,EAAWzzE,EAAMp6D,IAAI,OACrB8tI,EAAe1zE,EAAMp6D,IAAI,WACzB+tI,EAAa3zE,EAAMp6D,IAAI,SAAW,EAClCguI,EAAW5zE,EAAMp6D,IAAI,OACrBiuI,EAAiB,GAAH,OAAMH,EAAN,YAAsBC,EAAtB,YAAoCC,GACpDH,IACFF,EAAe5uI,KAAK,CAAE4E,OAAQsqI,EAAgBr/F,IAAKi/F,IAC/CA,EAASzuI,SAAW4uI,EAAWD,EAAa,GAC9CH,EAAkB7uI,KAAlB,UACKkvI,EADL,qBACgCJ,EAASzuI,OAAOg+C,iBADhD,6CAEI4wF,EAAWD,GACX3wF,uBAKNwwF,EAAkBxuI,OAAS,GAC7B6V,EAAQq0C,OAAR,sEACiEskF,EAAkBjwH,SAGrFm9G,EAA2B6S,EC3G5B/oI,KAAI,SAAAw1D,GAAK,iBAAQA,EAAMz2D,OAAd,aAA0Cy2D,EAAMxrB,IAV3ComB,QAAQ,aAAc,QAAQk5E,cAW5CvwH,KAAK,OD+HN,OAlBC,sBAAC,4BAAAnc,EAAA,oEAEM+rI,EAAgBnuI,OAAS,GAF/B,gCAGyBiuI,GAAcpxI,EAAOsxI,GAH9C,OAGU3T,EAHV,OAIQ4T,GACFC,EAAe7T,GALrB,4BAQU,IAAIv4H,MAAM,oCARpB,yDAWEs7B,QAAQva,MAAR,MACIorH,GACFpxG,EAAS,EAAD,IAbZ,yDAAD,GAkBM,WACLoxG,GAAS,KAEV,CAACvxI,EAAOgZ,EAASs4H,EAAiBzS,IAErC,IAAMqT,EAAmB7+D,EAASlwE,OAAS,IAE3C,OACE,kBAACyhB,GAAA,EAAD,CACEzK,cAAY,kBACZksF,SAAS,KACTjrF,MAAI,EACJmB,QAASR,EACTylE,kBAAgB,qBAChBC,mBAAiB,4BAEjB,kBAAC58D,GAAA,EAAD,CAAa3gB,GAAG,sBAAhB,qBAEG6X,EACC,kBAACsD,EAAA,EAAD,CACElF,cAAY,kBACZtD,UAAWU,EAAQopE,YACnB5lE,QAAS,WACPgB,IACA/b,EAAMwmH,gBAAWxiH,OAAWA,KAG9B,kBAAC,KAAD,OAEA,MAEN,kBAACu/G,GAAA,EAAD,MAEA,kBAACz+F,GAAA,EAAD,KACGqB,EAAQ,kBAACnI,EAAA,EAAD,CAAYtK,MAAM,SAAlB,UAA8ByS,IAAwB,KAC9DkY,IAAYlY,EACX,kBAAC0qH,GAAA,EAAD,wCAEE,kBAACxuD,EAAA,EAAD,CACEtsE,MAAO,CACLoZ,WAAY,IAEdld,KAAM,GACN++H,eAAa,KAGf,UACUhtI,IAAbqvE,EACC,kBAACxiD,EAAA,EAAD,CACE1W,cAAY,sBACZnX,QAAQ,WACR+tB,WAAS,EACT+3D,KAAM,EACNqpD,QAAS,EACT/hH,SAAU8hH,EACVr7H,UAAWU,EAAQ25H,cACnB/+G,WAAS,EACTtrB,MACEqrI,EACI,yEACA7+D,EAENjhD,WAAY,CACVk0E,UAAU,EACV/uF,QAAS,CACPiF,MAAOjF,EAAQ45H,iBAInB,MAEN,kBAACnsH,GAAA,EAAD,KACE,kBAAChJ,EAAA,EAAD,CACEjB,QAAS,WACPhV,KAAKstE,GAAY,IACjBr6D,EAAQq0C,OAAO,sBAAuB,YAExCj9B,SAAUiO,GAAW6zG,EACrBx+H,MAAM,UACN2c,UAAW,kBAAC,IAAD,OAPb,qBAWA,kBAACrU,EAAA,EAAD,CACEjB,QAAS,WACP,IAAMq3H,EAAe,IAAI1qD,KAAK,CAACrU,GAAY,IAAK,CAC9CjlE,KAAM,+BAERu5E,kBAAOyqD,EAAc,uBAEvBhiH,SAAUiO,EACV3qB,MAAM,UACN2c,UAAW,kBAAC,KAAD,OATb,kBAaA,kBAACrU,EAAA,EAAD,CACEjB,QAAS,WACPgB,IACA/b,EAAMwmH,gBAAWxiH,OAAWA,IAE9B0P,MAAM,UACN6yF,WAAS,GANX,cEhPR,SAAS8rC,GAAUC,GACjB,OAAIA,EAAM,IACDxnH,OAAOwnH,GAEhB,UAAUD,MAAaC,EAAM,MAA7B,YAAuC,eAAQA,EAAM,MAAQxwB,QAAQ,EAAG,IAG1E,IAAM1rG,GAAYC,aAAW,kBAC3Bi4H,eAAgB,CACdr7H,SAAU,QAGZ+7H,UAAW,CACT3kH,OAAQ,QAGV6kH,UAAW,CACT7kH,OAAQ,YAKZ,SAASkoH,GAAT,GAcG,IAbD5wI,EAaC,EAbDA,MACAE,EAYC,EAZDA,IACApB,EAWC,EAXDA,QACAqB,EAUC,EAVDA,SACA0wI,EASC,EATDA,MACAC,EAQC,EARDA,MASMl7H,EAAUnB,KACVqrC,EAAQolF,EAAUllI,EAAOE,EAAKpB,EAAS+xI,EAAOC,GACpD,OACE,oCACGhxF,EAAM94C,KAAI,SAAA29C,GACT,IAAM1iB,GAAK9hC,EAAWD,EAAMykD,EAAKxS,KAAOwS,EAAKxS,KAAOnyC,GAASlB,EAC7D,OACE,0BACEmC,IAAK0jD,EAAKxS,KACV+rB,GAAIj8B,EACJk8B,GAAIl8B,EACJs8B,GAAI,EACJC,GAAkB,UAAd7Z,EAAKl4C,KAAmB,EAAI,EAChCkyD,YAAa,EACbj2C,OAAsB,UAAdi8B,EAAKl4C,KAAmB,OAAS,OACzCyI,UACgB,UAAdyvC,EAAKl4C,KAAmBmJ,EAAQy3H,UAAYz3H,EAAQ23H,UAEtDwD,UAASpsF,EAAKxS,UAInB2N,EACE/yB,QAAO,SAAA43B,GAAI,MAAkB,UAAdA,EAAKl4C,QACpBzF,KAAI,SAAA29C,GACH,IAAM1iB,GAAK9hC,EAAWD,EAAMykD,EAAKxS,KAAOwS,EAAKxS,KAAOnyC,GAASlB,EAC7D,OACE,0BACEmjC,EAAGA,EAAI,EACPC,EAAG,GACHjhC,IAAG,gBAAW0jD,EAAKxS,MACnB/9B,MAAO,CAAE9C,SAAU,QACnB4D,UAAWU,EAAQ+2H,gBAElB+D,GAAU/rF,EAAKxS,KAAO,QAiBrCy+F,GAAM9tH,aAAe,CACnB3iB,UAAU,EACV0wI,OAAO,EACPC,OAAO,GAGMnqI,0BAASiqI,IC1ElBn8H,GAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrCwoG,aAAc,CACZxhF,UAAW,SACX7nB,WAAYa,EAAMJ,QAAQ,GAC1BR,cAAeY,EAAMJ,QAAQ,IAE/ByE,OAAQ,CACNkU,YAAavY,EAAMJ,QAAQ,QAIzB69H,GAAmBrqI,oBAAS,YAA+B,IAA5BtI,EAA4B,EAA5BA,MAC3BmpC,EAAgEnpC,EAAhEmpC,OAAQhjB,EAAwDnmB,EAAxDmmB,MAAOm9C,EAAiDtjE,EAAjDsjE,WAAY5gC,EAAqC1iC,EAArC0iC,YAAakwG,EAAwB5yI,EAAxB4yI,oBAC1Cr7H,EAAUnB,KAEhB,OAAKssB,EAGAkwG,EAIH,yBAAK78H,MAAO,CAAEtQ,SAAU,aACrBzF,EAAM6yI,qBACL,kBAAC,GAAD,CACE7yI,MAAOA,EACP+b,YAAa,WACX/b,EAAMwmH,gBAAWxiH,OAAWA,MAG9B,KACFs/D,EAGA,yBACEvtD,MAAO,CACLtQ,SAAU,WACVrB,MAAO,EACPqU,OAAQ,OAGV,kBAAC,GAAD,CAAczY,MAAOA,KATvB,kBAACyhE,GAAD,CAAQzhE,MAAOA,IAYhBmmB,EACC,kBAAC/E,EAAA,EAAD,CAAOpe,QAAQ,WAAW6T,UAAWU,EAAQmmG,cAC3C,kBAAC1/F,EAAA,EAAD,CAAYtK,MAAM,SAASyS,EAAMjH,UAGnC,oCACE,kBAAC,GAAD,CAAiBlf,MAAOA,GACpBmpC,EAAOhmC,OAcPgmC,EAAOxgC,KAAI,SAAAgD,GAAK,OACd,kBAAC,GAAD,CAAgB/I,IAAK+I,EAAMzH,GAAIlE,MAAOA,EAAO2L,MAAOA,OAdtD,kBAACyV,EAAA,EAAD,CAAOpe,QAAQ,WAAW6T,UAAWU,EAAQmmG,cAC3C,kBAAC1/F,EAAA,EAAD,0BACA,kBAAChC,EAAA,EAAD,CACEhZ,QAAQ,YACR0Q,MAAM,UACNqH,QAAS/a,EAAMotE,sBACfr3D,MAAO,CAAE0C,OAAQ,MAEjB,kBAAC,IAAD,CAAmB5B,UAAWU,EAAQgC,SANxC,2BAnCL,kBAAC,GAAD,CAAYvZ,MAAOA,IAHnB,QA4DI2yI,aAEf,SAASnI,GAAT,GAAyE,IAKnEsI,EALc9yI,EAAqD,EAArDA,MAAOiT,EAA8C,EAA9CA,SAEvB1S,EAEEP,EAFFO,SAFqE,EAInEP,EADFkmC,cAA6C2oG,EAHwB,EAGpD3E,2BAA0Ct9D,EAHU,EAGVA,QAI3DkmE,EADE9xI,KAAKiB,MAAM2qE,EAAU,KAAW,EACtB,GAAH,OAAM/rB,YAAY+rB,EAAU,KAAS9rB,YAAY,IAAjD,OACA9/C,KAAKiB,MAAM2qE,EAAU,KAAQ,EAC1B,GAAH,OAAM/rB,YAAY+rB,EAAU,KAAM9rB,YAAY,IAA9C,OAEG,GAAH,OAAM9/C,KAAKiB,MAAM2qE,GAAjB,MAEX,IAAMmmE,EAAK/xI,KAAKuB,KAAKhC,EAAU,GACzBs/D,EAAKkzE,EAAKlE,EAChB,OACE,oCACE,0BAAMhvE,GAAIkzE,EAAIjzE,GAAID,EAAIK,GAAI,GAAIC,GAAI,GAAI91C,OAAO,UAC7C,0BAAMw1C,GAAIkzE,EAAIjzE,GAAIizE,EAAI7yE,GAAI,EAAGC,GAAI,GAAI91C,OAAO,UAC5C,0BAAMw1C,GAAIA,EAAIC,GAAID,EAAIK,GAAI,EAAGC,GAAI,GAAI91C,OAAO,UAC5C,0BACEuZ,EAAGmvG,GAAMlzE,EAAKkzE,GAAM,EACpBlvG,EAAc,EAAX5wB,EACH4wE,WAAW,SACX5wE,SAAUA,GAET6/H,IAMT,SAASE,GAAT,GAUG,IATDhzI,EASC,EATDA,MACAiT,EAQC,EARDA,SAEA7S,GAMC,EAPD6yI,YAOC,EAND7yI,OAQmBgkC,EAGfpkC,EAHFkmC,cAAiB9B,cACP6B,EAERjmC,EAFFO,SACAE,EACET,EADFS,QAEIyyI,EAAc9uG,EAAcjhC,OAAS,EAC3C,OACE,oCACE,8BACE,8BAAUe,GAAG,cACX,0BAAM0/B,EAAG,EAAGC,EAAG,EAAGzjC,MAAOA,EAAOiE,OAAQ,OAG3C+/B,EAAcz7B,KAAI,SAAAwY,GACjB,IAAMytH,EAAaztH,EAAM5gB,SAAW0lC,EACpC,OACE,uBAAGrjC,IAAG,UAAKue,EAAMve,KAAOuT,UAAS,oBAAey4H,EAAf,QAC/B,0BAAMhrG,EAAGgrG,EAAanuI,EAASojC,EAAG5wB,EAAUA,SAAUA,GACnDkO,EAAM1f,SAERyxI,EACC,uBAAG/8H,UAAU,kBAAkBswB,SAAS,oBACtC,kBAAC,GAAD,CACE9kC,MAAOwf,EAAMxf,MACbE,IAAKsf,EAAMtf,IACXpB,QAASA,EACTqB,SAAUqf,EAAMrf,YAIpB,0BACEw+D,YAAa,EACbj2C,OAAO,QACPw1C,GAAI1+C,EAAMxf,MAAQlB,EAClBq/D,GAAI3+C,EAAMtf,IAAMpB,EAChBy/D,GAAI,GACJC,GAAI,UAUpB,IAAMltD,GAAW,GAMXuyE,GAAc,SAACr8C,GACnB,OAAOA,EAAO5Q,QAAO,SAAC0gC,EAAOttD,GAE3B,OAAOstD,EADSttD,EAAMo+B,SAAS,GACR1lC,OANL,GADH4O,KAQd,IAICkgI,GAAY,SAAC,GAA8B,IAA5BnzI,EAA4B,EAA5BA,MACXI,EAAyBJ,EAAzBI,MAAOqhB,EAAkBzhB,EAAlByhB,cACTjgB,EAAeigB,EAActe,OAAS,EAAI,GAAKse,EAAc,GACnE,OACE,uBAAGvd,GAAG,UACJ,0BAAM0/B,EAAG,EAAGC,EAAG5wB,GAAUA,SAAUA,IAChCzR,GAEH,uBAAG2U,UAAS,sBAAiBlD,GAAjB,MACV,kBAAC,GAAD,CAAUjT,MAAOA,EAAOiT,SAAUA,MAEpC,uBAAGkD,UAAS,sBAxBE,GAwBF,MACV,kBAAC68H,GAAD,CACEhzI,MAAOA,EACPiT,SAAUA,GACVggI,YA5BU,GA6BV7yI,MAAOA,OAQXgzI,GAAsB,SAAC,GAA8B,IAA5BpzI,EAA4B,EAA5BA,MACrBkmC,EAA0BlmC,EAA1BkmC,cAAeiD,EAAWnpC,EAAXmpC,OAEjB9kC,EAASmhF,GAAYr8C,GAE3B,OACE,oCACGjD,EAAc9B,cAAc8a,MAAM,GAAGv2C,KAAI,SAAAwY,GAAK,OAC7C,0BACEve,IAAKue,EAAMve,IACXi9D,GAAI1+C,EAAM5gB,SAAWP,EAAMO,SAC3Bu/D,GAAI3+C,EAAM5gB,SAAWP,EAAMO,SAC3B2/D,GAVcxE,IAWdyE,GAAI97D,EACJgmB,OAAO,QACPgpH,cAAe,UAQzB,SAASC,GAAT,GAcG,IAbDC,EAaC,EAbDA,eACAvzI,EAYC,EAZDA,MACAwF,EAWC,EAXDA,OAYA,OACE,oCACG+tI,EAAe5qI,KAAI,YAAuB,IAApBgD,EAAoB,EAApBA,MAAO3F,EAAa,EAAbA,OACtB6R,EAAUrS,EACVyK,EACJmY,kBAAQzc,EAAO,SAAf,8BACuBtE,yBACrB2E,oBAAUL,EAAME,eAChB,QAHF,KAKI0P,EAAU5P,EAAMo+B,SAAS,GAE/B,OADAvkC,GAAU+V,EAAQlX,OApFJ,GADH4O,GAuFT,uBACErQ,IAAK+I,EAAME,cAAc0E,QACzB4F,UAAS,sBAAiB0B,EAAjB,MAET,0BAAM5E,SAAUA,GAAU2wB,EAAG5iC,KAAKuB,KAAKvC,EAAMO,SAAU,IACpD0P,GAEH,uBAAGkG,UAAS,sBA9FLlD,GA8FK,MAAiCjN,QASlD,SAAewkH,GAAtB,qC,8CAAO,WAA2BxqH,EAAYsH,GAAvC,yBAAA/B,EAAA,sEACCw/C,gBAAK,kBAAM/kD,EAAM0iC,eADlB,cAEGtiC,EAAkBJ,EAAlBI,MAAO+oC,EAAWnpC,EAAXmpC,OACTqqG,EAAQ,GACRhuI,EAASk2D,IACTr3D,EAASmhF,GAAYr8C,GAAU3jC,EALhC,SAMwB0yB,QAAQC,IACnCgR,EAAOxgC,IAAP,uCAAW,WAAMgD,GAAN,iBAAApG,EAAA,6DACHgW,EAAU5P,EAAMo+B,SAAS,GADtB,SAEHgb,gBAAK,uBAAyB/gD,IAAlBuX,EAAQwmC,OAAsBxmC,EAAQwmC,SAF/C,uBAGYxmC,EAAQwqB,UAAUz+B,GAH9B,cAGHtB,EAHG,yBAIF,CAAE2F,QAAO3F,WAJP,2CAAX,wDAPG,cAMCutI,EAND,yBAgBEE,+BACL,yBACErzI,MAAOA,EACPiE,OAAQA,EACRqvI,MAAM,6BACNC,WAAW,+BACXj+H,QAAS,CAAC,EAAG,EAAGtV,EAAgB,EAARozI,EAAWnvI,GAAQ+hB,YAG3C,0BAAMhmB,MAAOA,EAAgB,EAARozI,EAAWnvI,OAAQA,EAAQ2R,KAAK,UAErD,uBAAGqU,OAAO,OAAOlU,UAAS,oBAAeq9H,EAAf,YAAwBvgI,GAAxB,MACxB,kBAAC,GAAD,CAAWjT,MAAOA,IAClB,kBAACszI,GAAD,CACEtzI,MAAOA,EACPuzI,eAAgBA,EAChB/tI,OAAQA,IAEV,kBAAC,GAAD,CAAqBxF,MAAOA,QAlC7B,6C,qUCzQA,SAASqH,EACdusI,GAKK,IAJLC,EAIK,4DAJqC7vI,EAE1CggB,EAEK,uDAFuB,GAG5B,IAAK4vH,EACH,MAAM,IAAI5mG,UAAU,oCAEtB,IAAK6mG,EACH,OAAOjmH,sBAAYgmH,GAErB,GAAwB,kBAAbC,EAAuB,CAChC,IAAItnB,EAAOqnB,EAAWC,GAStB,IANGtnB,GACDr1F,0BAAgB08G,IAChB38B,oBAAU7iB,kBAAQw/C,MAElBrnB,EAAOqnB,EAAW7vI,IAAI8vI,KAEnBtnB,EACH,OAaF,GAAIA,EAAKnzB,KAAM,CACb,IAAM06C,EAAcvnB,EAAKnzB,KAAKC,SAASr1E,GACvC,OAAIkT,0BAAgB48G,GACXlmH,sBAAYkmH,GAEdA,EAET,OAAI58G,0BAAgBq1F,GACX3+F,sBAAY2+F,GAEdA,EAGT,IAAML,EAAW2nB,EAAS,GAC1B,GAAIA,EAAS1wI,OAAS,EAAG,CACvB,IAAM4wI,EAAUF,EAAS30F,MAAM,GAC3B80F,EAAUJ,EAAW1nB,GASzB,IANG8nB,GACD98G,0BAAgB08G,IAChB38B,oBAAU7iB,kBAAQw/C,MAElBI,EAAUJ,EAAW7vI,IAAImoH,KAEtB8nB,EACH,OAEF,OAAO3sI,EAAe2sI,EAASD,EAAS/vH,GAE1C,OAAO3c,EAAeusI,EAAY1nB,EAAUloG,GAWvC,SAASoE,EACdpoB,GAIA,IAHA6zI,EAGA,4DAH0C7vI,EAE1CggB,EACA,uDAD4B,GAE5B,IAAKhkB,EACH,MAAM,IAAIgtC,UAAU,+BAFtB,MAI0BhtC,EAAlB6L,EAJR,EAIQA,cACR,GAAImqG,EAAqBnqG,GACvB,OAAOxE,EAAewE,EAAegoI,EAAU7vH,GAEjD,MAAM,IAAIgpB,UAAU,yDAUf,SAASinG,EAAqCC,GACnD,GAAI75F,iBAAO65F,KACTA,EAAiBhc,0BAAgBgc,GAE7Blc,sBAAYkc,IAAiB,CAC/B,IAAMlkD,EAAsB,GAc5B,OAbA8nC,2BAAiBoc,GAAgB7yI,SAAQ,SAAA+M,GAEvC,IAAI+pC,EAAW87F,EADf7lI,EAAO8pH,0BAAgB9pH,IAElB+pC,EAASh1C,SAEZg1C,EAAW,CADC/D,0BAAgBhmC,GACZA,OAElB,IAAK+pC,EAAS,GAEZ,MAAM,IAAI/yC,MAAJ,qCAAwCgJ,IAEhD4hF,EAAUltF,KAAV,MAAAktF,EAAS,YAAS73C,OAEb63C,EAGX,MAAO,GAGF,SAASz1C,EACdthB,GAEA,GAAIohB,iBAAOphB,GAAQ,CACjB,GACEqhB,sBAAYrhB,KACX,iCAAkCA,GACjCA,EAAMjxB,KAAK8mB,SAAS,wBAEtB,OAAO,EAGT,GAAIs9F,qBAAWnzF,GACb,OAAO,EAGX,OAAO,EAGF,SAASozF,EAA0BpzF,GACxC,QAAKohB,iBAAOphB,OAURshB,EAA8BthB,KAI9B++F,sBAAY/+F,GACP6+F,2BAAiB7+F,GAAO0qF,OAC7B,SAAAprE,GAAC,OAAI8zE,EAA0B9zE,IAAiB,cAAXA,EAAEvwC,WAIvC6vH,yBAAe5+F,KAAUozF,EAA0B93B,qBAAWt7D,UAI9D29E,sBAAY39E,KAAUozF,EAA0B93B,qBAAWt7D,SAI3Dg+E,oBAAUh+E,KAAUozF,EAA0B93B,qBAAWt7D,QAOxD,SAAS+8E,EACd/8E,GAEA,OAAO/B,0BAAgB+B,IAAUozF,EAA0Bj4B,kBAAQn7D,IAG9D,SAASk7G,EAAwBl7G,GACtC,MACmB,kBAAVA,GACG,OAAVA,GACA,+BAAgCA,I,yGCnMrB,SAAS6yC,EACtB9rE,GAGA,IAFAC,IAEA,yDADAC,IACA,yDAEEK,EAMEP,EANFO,SACAC,EAKER,EALFQ,iBACAC,EAIET,EAJFS,QACAL,EAGEJ,EAHFI,MACAM,EAEEV,EAFFU,kBACAC,EACEX,EADFW,wBAGF,IAAKP,EACH,MAAM,IAAIgF,MAAM,wDAElB,IAAMjE,EAAS,IAAIC,IACfgzI,EAAwB,EACtBC,EAAe9zI,EACf+zI,EAAgBD,EAAej0I,EAwHrC,OAvHAI,EAAiBa,SAAQ,SAACC,EAAQC,GAAiB,IAE/CC,EAKEF,EALFE,aACAC,EAIEH,EAJFG,QACOC,EAGLJ,EAHFK,MACKC,EAEHN,EAFFO,IACAC,EACER,EADFQ,SAEIyyI,EACJH,GAAyBxyI,EAAYF,GAAejB,EAEhD0B,GAAiBP,EAAYF,GAAejB,EAElD,GACE2zI,EAAwBE,GACxBC,EAAyBF,EACzB,KAQI1yI,EACAE,EACAQ,EACAC,EACAkyI,EAZJ,EAE0Bpc,YACxBic,EACAC,EACAF,EACAG,GANF,mBAEO9zF,EAFP,KAEekF,EAFf,KAaI7jD,GACFH,EAAQX,KAAKuB,IACXb,EACAE,GAAa+jD,EAAUyuF,GAAyB3zI,GAGlD4B,GADAR,EAAMD,GAAa6+C,EAAS2zF,GAAyB3zI,KAChBmB,EACrCU,EAA8BX,IAAUD,EACxC8yI,EAAgBJ,GAAyBxyI,EAAYC,GAAOpB,IAO5D4B,GALAV,GAAS8+C,EAAS2zF,GAAyB3zI,EAAUiB,KAKdA,EACvCY,GALAT,EAAMb,KAAKwB,IACTZ,GACC+jD,EAAUyuF,GAAyB3zI,EAAUiB,MAGVE,EACtC4yI,EAAgBJ,GAAyBzyI,EAAQD,GAAejB,GAElE,IACMgC,EAAY,CAChBjB,eACAC,UACAE,QACAE,MACAC,WACAvB,SAAUi0I,EACV9xI,aAAcpB,EACdC,eACAoB,SAVed,EAAMF,GAASlB,EAW9B4B,6BACAC,8BACAM,IAAK,IAEPH,EAAUG,IAAV,UAAmBC,4BAAkBJ,GAArC,YAAmDlB,GAAnD,OACEO,EAAW,YAAc,IAGvB7B,GAA6B,IAAlBkB,EAAOgC,QAAgBd,GACpClB,EAAO2B,KACL,IAAIC,IAAwB,CAC1BH,IAAK,GAAF,OAAKH,EAAUG,IAAf,sBACHD,SAAUpC,EACVA,SAAUkC,EAAUlC,SAAWA,EAC/ByC,QAAS,cAKX9C,GAAWiC,EAAgBzB,EAC7BS,EAAO2B,KAAK,IAAIG,IAAYR,IAE5BtB,EAAO2B,KAAK,IAAII,IAAaT,IAG3BxC,IAGAkC,GAAiBzB,GACjB+B,EAAUH,6BACVf,EAAef,EAAiB2C,OAAS,IAEzChC,EAAO2B,KACL,IAAIC,IAAwB,CAC1BH,IAAK,GAAF,OAAKH,EAAUG,IAAf,aACHD,QAAShC,EACTJ,SAAUkC,EAAUlC,SAAWkC,EAAUE,WAG7CyxI,GAAyBzzI,GAIzBY,IAAiBf,EAAiB2C,OAAS,GAC3CV,EAAUH,8BAEVkyI,EAAgB/xI,EAAUlC,SAAWkC,EAAUE,QAC/CxB,EAAO2B,KACL,IAAIC,IAAwB,CAC1BH,IAAK,GAAF,OAAKH,EAAUG,IAAf,oBACHD,QAASvC,EAAQo0I,EAAgBj0I,EACjCA,SAAUi0I,EACVxxI,QAAS,gBAMnBoxI,IAA0BxyI,EAAYF,GAAejB,KAEhDU,I,sKCjJT,SAASm6B,EAAcruB,GACrB,MAAO,QAASA,EASlB,SAASyuB,EAAezuB,GACtB,MAAO,WAAYA,EAGrB,IAAMwnI,EAAqBnsI,oBACzB,SAACyM,GAKK,IACI9H,EAAgC8H,EAAhC9H,SAAUjF,EAAsB+M,EAAtB/M,KAAMqI,EAAgB0E,EAAhB1E,YAClBqkI,GAAaznI,GAAYquB,EAAcruB,GAAY,MAAQ,OAF7D,EAGwCiK,mBAASw9H,GAHjD,mBAGGC,EAHH,KAGmBC,EAHnB,KAKJ,OACE,oCACE,kBAAC,IAAD,CAAYC,QAAM,EAACC,QAAQ,mBACxB9sI,GAEH,kBAAC,IAAD,CAAMq6D,WAAS,EAACvtD,QAAS,EAAGu6E,UAAU,MAAM9/D,WAAW,UACrD,kBAAC,IAAD,CAAMixE,MAAI,GACR,kBAAC,IAAD,CACE35F,MAAO8tI,EACPI,WAAS,EACTr6H,SAAU,SAACsjB,EAAGg3G,GAEVJ,EADe,QAAbI,EACgB,MAEA,SAGtB9+H,aAAW,sBAEX,kBAAC,IAAD,CAAcrP,MAAM,OAAOqP,aAAW,cAAtC,QAGA,kBAAC,IAAD,CAAcrP,MAAM,MAAMqP,aAAW,OAArC,SAKJ,kBAAC,IAAD,CAAMsqF,MAAI,GACY,QAAnBm0C,EACC,kBAACM,EAAelgI,GAEhB,kBAACmgI,EAAqBngI,KAI5B,kBAAC,IAAD,KAAiB1E,OAMnB4kI,EAAa,SAAClgI,GAGd,IACI9H,EAA0B8H,EAA1B9H,SAAUkoI,EAAgBpgI,EAAhBogI,YAElB,OACE,kBAAC,IAAD,CACEhjH,WAAS,EACT/T,WAAY,CAAE,cAAe,YAC7BgN,aAAcne,GAAYquB,EAAcruB,GAAYA,EAASjC,IAAM,GACnE0P,SAAU,SAAAhD,GAAK,OAAIy9H,EAAY,CAAEnqI,IAAK0M,EAAM4G,OAAOzX,YAKnDquI,EAAmB5sI,oBACvB,SAACyM,GAA8D,IACrD9H,EAA0B8H,EAA1B9H,SAAUkoI,EAAgBpgI,EAAhBogI,YAEZjwI,EACJ+H,IACEyuB,EAAezuB,IAAaA,EAASjF,MApF7C,SACEiF,GAEA,MAAO,cAAeA,EAkFfsuB,CAAoBtuB,IAAaA,EAASrC,WAEzCwqI,EACJnoI,GAAYyuB,EAAezuB,KAAcJ,kBAAQI,EAASnC,QAE5D,OACE,yBAAKiL,MAAO,CAAEtQ,SAAU,aACtB,kBAAC,IAAD,CAAQzC,QAAQ,WAAWib,UAAU,SAArC,cAEE,2BACE7P,KAAK,OACL2H,MAAO,CACLtQ,SAAU,WACVoT,IAAK,EACL1U,KAAM,EACN/D,MAAO,OACPi1I,QAAS,GAEX36H,SAAU,YAAgB,IAAb4D,EAAa,EAAbA,OACLhR,EAAOgR,GAAUA,EAAOg3H,OAASh3H,EAAOg3H,MAAM,GAChDhoI,IACE2kB,aACFkjH,EAAY,CAAEvqI,UAAW0C,EAAKw/B,OAE9BqoG,EAAYnoI,4BAAkB,CAAEI,KAAME,UAM/CpI,EACC,oCACE,kBAAC,IAAD,CACE6Q,MAAO,CAAEoZ,WAAY,UACrBnsB,QAAQ,QACRib,UAAU,QAET/Y,GAEFkwI,EACC,kBAAC,IAAD,CAAY1hI,MAAM,SAAlB,oBACE,MAEJ,SAMG+gI,O,6KC5JR,EACA,EACA,E,8GAGDxiH,EAA+B,qBAAX5xB,QAA0Bgb,QAAQhb,OAA5D,UAEMk1I,EAAS,oBAGJnyB,gBAHLmyB,GAKF,EAGSC,EAAb,WACE,gBAA2B,oBACzB5xI,KAAA,QACAA,KAAA,SACAA,KAAA,YACAA,KAAA,0CALJ,6CASE,YACMmS,IAAUnS,KAAd,qBACEA,KAAA,cAAmB,CAAEwK,KAAF,cAAuB2H,UAC1CnS,KAAA,wBAZN,qBAgBE,YACMmS,IAAUnS,KAAd,mBACEA,KAAA,cAAmB,CAAEwK,KAAF,YAAqB2H,UACxCnS,KAAA,sBAnBN,gBAuBE,YACEA,KAAA,cACAA,KAAA,cAAmB,CAAEwK,KAAF,OAAgB2H,YAzBvC,iBA6BE,WAAa,2BAANiO,EAAM,yBAANA,EAAM,gBACXpgB,KAAA,cAAmB,CAAEwK,KAAF,MAAe4V,WA9BtC,mBAiCE,WAAe,2BAANA,EAAM,yBAANA,EAAM,gBACbpgB,KAAA,cAAmB,CAAEwK,KAAF,QAAiB4V,WAlCxC,uBAqCE,WAAmB,2BAANA,EAAM,yBAANA,EAAM,gBACjBpgB,KAAA,cAAmB,CAAEwK,KAAF,YAAqB4V,WAtC5C,uBAyCE,WAAmB,2BAANA,EAAM,yBAANA,EAAM,gBACjBpgB,KAAA,cAAmB,CAAEwK,KAAF,YAAqB4V,WA1C5C,kBA6CE,WAAc,2BAANA,EAAM,yBAANA,EAAM,gBACZpgB,KAAA,cAAmB,CAAEwK,KAAF,OAAgB4V,WA9CvC,uBAiDE,WAAmB,2BAANA,EAAM,yBAANA,EAAM,gBACjBpgB,KAAA,cAAmB,CAAEwK,KAAF,YAAqB4V,WAlD5C,kCAqDE,WAA8B,2BAANA,EAAM,yBAANA,EAAM,gBAC5BpgB,KAAA,cAAmB,CAAEwK,KAAF,uBAAgC4V,WAtDvD,2BAyDE,WAAuB,2BAANA,EAAM,yBAANA,EAAM,gBACrBpgB,KAAA,cAAmB,CAAEwK,KAAF,gBAAyB4V,WA1DhD,kCA6DE,WAA8B,2BAANA,EAAM,yBAANA,EAAM,gBAC5BpgB,KAAA,cAAmB,CAAEwK,KAAF,uBAAgC4V,WA9DvD,+BAiEE,WAA2B,2BAANA,EAAM,yBAANA,EAAM,gBACzBpgB,KAAA,cAAmB,CAAEwK,KAAF,oBAA6B4V,WAlEpD,uBAqEE,WAAmB,2BAANA,EAAM,yBAANA,EAAM,gBACjBpgB,KAAA,cAAmB,CAAEwK,KAAF,YAAqB4V,WAtE5C,qBAyEE,WAAiB,2BAANA,EAAM,yBAANA,EAAM,gBACfpgB,KAAA,cAAmB,CAAEwK,KAAF,UAAmB4V,WA1E1C,kBA6EE,WAAc,2BAANA,EAAM,yBAANA,EAAM,gBACZpgB,KAAA,cAAmB,CAAEwK,KAAF,OAAgB4V,WA9EvC,sBAiFE,WAAkB,2BAANA,EAAM,yBAANA,EAAM,oBACT4f,EAAc5f,EADL,GACN6f,EAAW7f,EADL,GACH08B,EAAQ18B,EADL,GACAlc,EAAKkc,EADL,GAEhB,KAAI4f,EAAIhgC,KAAJggC,OAAkBA,IAAtB,IAGA,IAAM6xG,EAAKz0I,WAAX,GACM00I,EAAKD,IAAS7xI,KAAT6xI,MAAsB7xI,KAAKxD,MAA3Bq1I,EAAX,EACA7xI,KAAA,cAAmB,CAAEwK,KAAF,WAAoB4V,KAAM,CAACyxH,EAAI5xG,EAAG6xG,EAAI5tI,QAxF7D,sBA2FE,WAAkB,2BAANkc,EAAM,yBAANA,EAAM,gBAIhBpgB,KAAA,cAAmB,CAAEwK,KAAF,WAAoB4V,WA/F3C,oBAkGE,WAAgB,2BAANA,EAAM,yBAANA,EAAM,gBACdpgB,KAAA,cAAmB,CAAEwK,KAAF,SAAkB4V,WAnGzC,yBAsGE,YACE,IAAM3f,GAAUT,KAAK+xI,YAAY7iE,MAAM,OAAvC,GACA,MAAO,CACL1yE,MAAQiE,EAAD,EAAeshB,EADjB,OAELthB,YA1GN,oBA8GE,WAAgB,2BAAN2f,EAAM,yBAANA,EAAM,gBACdpgB,KAAA,cAAmB,CAAEwK,KAAF,SAAkB4V,WA/GzC,8BAkHE,WAA0B,2BAANA,EAAM,yBAANA,EAAM,gBACxBpgB,KAAA,cAAmB,CAAEwK,KAAF,mBAA4B4V,WAnHnD,kBAsHE,WAAc,2BAANA,EAAM,yBAANA,EAAM,gBACZpgB,KAAA,cAAmB,CAAEwK,KAAF,OAAgB4V,WAvHvC,qBA0HE,WAAiB,2BAANA,EAAM,yBAANA,EAAM,gBACfpgB,KAAA,cAAmB,CAAEwK,KAAF,UAAmB4V,WA3H1C,oBA8HE,WAAgB,2BAANA,EAAM,yBAANA,EAAM,gBACdpgB,KAAA,cAAmB,CAAEwK,KAAF,SAAkB4V,WA/HzC,kBAkIE,WAAc,2BAANA,EAAM,yBAANA,EAAM,gBACZpgB,KAAA,cAAmB,CAAEwK,KAAF,OAAgB4V,WAnIvC,yBAsIE,WAAqB,2BAANA,EAAM,yBAANA,EAAM,gBACnBpgB,KAAA,cAAmB,CAAEwK,KAAF,cAAuB4V,WAvI9C,0BA0IE,WAAsB,2BAANA,EAAM,yBAANA,EAAM,gBACpBpgB,KAAA,cAAmB,CAAEwK,KAAF,eAAwB4V,WA3I/C,mBA8IE,WAAe,2BAANA,EAAM,yBAANA,EAAM,gBACbpgB,KAAA,cAAmB,CAAEwK,KAAF,QAAiB4V,WA/IxC,oBAkJE,WAAgB,2BAANA,EAAM,yBAANA,EAAM,gBACdpgB,KAAA,cAAmB,CAAEwK,KAAF,SAAkB4V,WAnJzC,wBAsJE,WAAoB,2BAANA,EAAM,yBAANA,EAAM,gBAClBpgB,KAAA,cAAmB,CAAEwK,KAAF,aAAsB4V,WAvJ7C,wBA0JE,WAAoB,2BAANA,EAAM,yBAANA,EAAM,gBAClBpgB,KAAA,cAAmB,CAAEwK,KAAF,aAAsB4V,WA3J7C,uBA8JE,WAAmB,2BAANA,EAAM,yBAANA,EAAM,gBACjBpgB,KAAA,cAAmB,CAAEwK,KAAF,YAAqB4V,WA/J5C,uBAkKE,WAAmB,2BAANA,EAAM,yBAANA,EAAM,gBACjBpgB,KAAA,cAAmB,CAAEwK,KAAF,YAAqB4V,aAnK5C,KA8KA,SAAS4xH,EAAWliI,GAClB,IAAMsC,EAAOiwC,IAAb,GACA,MAAO,CAAE4vF,IAAK7/H,EAAP,MAAmBq/H,QAASr/H,WAsErC,IAAamnC,EAAb,WACE,gBAA2B,oBACzBv5C,KAAA,QACAA,KAAA,SAHJ,8CAME,YACE,UAAIwK,EACF,MAAM,IAAIhJ,MAAM,gBAAV,OAAN,IAGF,OADAxB,KAAA,QAAe,IAAI4xI,EAAyB5xI,KAA7B,MAAyCA,KAAxD,QACOA,KAAP,UAXJ,8BAcE,WACE,MACA,EAEA,EACA,EAFIkyI,EAAJ,GAIMC,EAAN,GAsGA,OArGAnyI,KAAA,0BAA8B,cAC5B,YAAIggB,QACEA,EAAJ,MAAmB,OA1F3B,SAAmBG,GACjB,IAQA,EARIo7G,EAAJ,KACIlsH,EAAJ,KACI+iI,EAAJ,SACI3mH,EAAJ,SACI4mH,EAAJ,SACIpM,EAAJ,SAEMqM,EAAWnyH,QAAjB,OAEAoyH,EAAO,KAAQtrD,EAAUqrD,EAAlB,SACL,UACE,aACE,MAEF,aACA,cACEF,IACA,MAEF,iBACEC,IACA,MAEF,WACA,aACA,cACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACE5mH,IACA,MAEF,QACE,MAAe,CACb,IAAM+mH,EAAQvrD,QAAd,KACA53E,EAAWmjI,EAAXnjI,GACImjI,SAAJ,IACEvM,EAAauM,EAAbvM,IAEF,MAGF1K,IACI+W,EAAJ,SACE/W,GAAc,IAAJ,OAAQ+W,OAAlB/W,OAEF,QAIN,MAAO,CACL6W,UADK,EAELC,YAFK,EAGL5mH,WAHK,EAILpc,SAJK,EAKL42H,WALK,EAML1K,cA8BkDkX,CAAUzyH,EAHrC,OAGToyH,EAHS,YAGE7W,EAHF,aAGclsH,EAHd,WAIjB8Q,EAAO,CAAEiyH,UAAF,EAAa7W,WAAb,EAAyBlsH,YAapC,GAVA,cAAI2Q,QACEA,EAAJ,QACE0yH,EAAc1yH,EAAd0yH,OAGJ,gBAAI1yH,QACEA,EAAJ,QACE2yH,EAAgB3yH,EAAhB2yH,OAGJ,aAAI3yH,OAA6B,mBACVA,EADU,QACxBggB,EADwB,KACrBC,EADqB,KAClB6c,EADkB,KACf54C,EADe,OAEN8tI,EAFM,GAEvBC,EAFuB,MAElBR,EAFkB,UAGzBmB,EAAKx1I,WAAY6iC,EAAvB,GACM4yG,EAAKz1I,SAAX,GACA+0I,OACE,0BACEnzI,IADF,EAEEoT,KAFF,EAGE44E,YAAaymD,aAHf,EAIEzxG,EAAGA,UAJL,GAKEC,EAAG2yG,UALL,GAMEp2I,MAAOsgD,UANT,GAOEr8C,OAAQoyI,gBAId,gBAAI7yH,OAA6B,mBACVA,EADU,QACxB+B,EADwB,KAClBie,EADkB,KACfC,EADe,OAEN+xG,EAFM,GAEvBC,EAFuB,MAElBR,EAFkB,UAG/BU,OACE,wCACEnzI,IADF,EAEEoT,KAFF,EAGE44E,YAAaymD,aAHf,EAIEzxG,EAAGA,UAJL,GAKEC,EAAGA,cALL,GADFkyG,IAyBF,GAZA,cAAInyH,SACFkyH,MAEF,WAAIlyH,QACFkyH,OAAiBlyH,EAAjBkyH,MAEF,WAAIlyH,QACFkyH,OAAiBlyH,EAAjBkyH,MAEElyH,OAGJ,SAAIA,OAAyB,CAE3B,IAF2B,MACvBkpB,GAAO,oCAAiBgpG,EAA5B,KACSl/G,EAAT,EAAgBA,EAAIk/G,EAApB,OAAwCl/G,IAAK,OAC3CkW,GAAO,EAAAA,GAAA,2BAAegpG,EAAtBhpG,KAEFA,QAL2B,MAMF8oG,EANE,GAMnBC,EANmB,MAMdR,EANc,UAO3BU,OACE,0BACEnzI,IADF,EAEEoT,KAFF,EAGEC,EAHF,EAIE24E,YAAaymD,aAA0BrxI,KAI7C,cAAI4f,OAA2B,CAE7B,IAF6B,MACzBkpB,GAAO,oCAAiBgpG,EAA5B,KACSl/G,EAAT,EAAgBA,EAAIk/G,EAApB,OAAwCl/G,IAAK,OAC3CkW,GAAO,gCAAegpG,EAAtBhpG,KAEFA,QAL6B,MAMJ8oG,EANI,GAMrBC,EANqB,MAMhBR,EANgB,UAO7BU,OACE,0BACEnzI,IADF,EAEEoT,KAFF,OAGEqU,OAHF,EAIEukE,YAAaymD,aAJf,EAKEp/H,EAAG62B,KAIT,WAAIlpB,SACF8yH,EAAW,IAAC9yH,UAAyB5iB,KAArC01I,OAGGA,EACL,uBAAGvgI,UAAS,yBAAZ,UADa,IAGb,8CAHF,QA3HJ,KAoIA,GAAI8b,EACFqrB,EAAe,cACb,IAAM95B,EAASsrB,uBAAf,UAGA,OAFAtrB,UACAA,WACA,GAEFq6B,EAAiB,uCAAG,uCAAAt4C,EAAA,0GAEV,IAAIH,MAFM,kIAMX,CAAE+e,QAASX,gBANA,2CAAH,sDAQjBS,aACK,GAAIsxH,EACTj4F,EAAe,qBAAmB,IAAI8lE,gBAAgBhjH,EAAvC,IACfy9C,EAAoBx9C,0BAA4BkK,KAAhDszC,kBACA55B,EAAkB5jB,oBAAsBkK,KAAxC0Z,iBACK,GAAIsxH,EAAa,OAE4BoB,EAF5B,MAEAC,EAFA,eAEkBvyH,EAFlB,QAGtBi5B,IACAO,EAAiB,uCAAG,2CAAAt4C,EAAA,0GAEV,IAAIH,MAFM,gHAMZyxI,EAAUrzH,EANE,YAOZY,EAAM,IAPM,oBAQX,IAAI8T,SAAQ,cACjB9T,SAAa,kBAAM8qB,EAAN,IACb9qB,YACAA,YAXgB,2CAAH,sDAcjBH,SAEAq5B,EAAe,cACb,OAAO,IAAIH,EAAwB/8C,EAAnC,IAEFy9C,EAAoB,SAAAr6B,GAClB,OAAOA,EAAP,SAEFS,EAAkB,U,mLCxbd7N,EAAYC,aAAW,SAAAnB,GAAK,MAAK,CACrC4hI,aAAc,CACZrxI,SAAU,WACVuO,UAAW,OACXsoB,UAAW,aACX5f,WAAY,SACZ+C,SAAU,UAEZs3H,YAAa,CACX/iI,UAAW,OACXsoB,UAAW,aACX1oB,gBAAiB,OACjB2qB,gBACE,sHAEJy4G,wBAAyB,CACvBhjI,UAAW,OACXJ,gBAAiBsB,EAAMjE,QAAQ0U,KAAK9U,SAEtComI,qBAAsB,CACpBjjI,UAAW,OACXJ,gBAAiBsB,EAAMjE,QAAQwK,OAAO6iB,wBAmBpCp7B,EAAeoF,oBAAS,YAA4C,IAAzC6Y,EAAyC,EAAzCA,MAAOpI,EAAkC,EAAlCA,SAChCxB,EAAUnB,IAChB,OACE,yBACEL,MAAO,CACL3V,MAAO,GAAF,OAAK+gB,EAAMxe,QAAX,OAEPkU,UAAWU,EAAQu/H,cAElB/9H,MAKP,SAAS9V,EAAT,GAAkD,IAA3B7C,EAA2B,EAA3BA,MACfmX,EAAUnB,IAChB,OAAO,yBAAKS,UAAWU,EAAQw/H,YAAahhI,MAAO,CAAE3V,MAAO,GAAF,OAAKA,EAAL,SAG5D,SAAS2C,EAAT,GAIiC,IAH/B65B,EAG+B,EAH/BA,SACAx8B,EAE+B,EAF/BA,MAE+B,IAD/B2V,aAC+B,MADvB,GACuB,EACzBwB,EAAUnB,IAChB,OACE,yBACEL,MAAK,2BACAA,GADA,IAEH3V,MAAO,GAAF,OAAKA,EAAL,QAEPyW,UACE+lB,EACIrlB,EAAQ0/H,qBACR1/H,EAAQy/H,4B,iCC5Eb,SAAS7/E,EAAO7xC,EAAkBylC,GACvC,IAAM0J,EAAOnvC,EAAQvhB,IAAI,QACzB,OAAO0wD,EAAOA,EAAK1J,GAAOzlC,EAAQvhB,IAAIgnD,GAKjC,SAASlY,EAAUvtB,EAAkBylC,EAAa6R,GACvD,OAAOzF,EAAO7xC,EAASylC,IAAQoM,EAAO7xC,EAASs3C,GAVjD,oEAeO,IAAMzJ,EAAmB,CAC9B+jF,GAAI,CACFC,KAAM,KACNC,KAAM,KAENC,KAAM,KACNC,KAAM,KAENC,KAAM,KACNC,KAAM,KAENC,KAAM,KACNC,KAAM,MAGRC,GAAI,CACFF,KAAM,KACNC,KAAM,KAENH,KAAM,KACNC,KAAM,KAENH,KAAM,KACNC,KAAM,KAENH,KAAM,KACNC,KAAM,MAGRQ,GAAI,CACFN,KAAM,KACNC,KAAM,KAENH,KAAM,KACNK,KAAM,KAENC,KAAM,KACNP,KAAM,KAENK,KAAM,KACNH,KAAM,Q,kNC3CVQ,iCAGA,IAAM5kI,EAAN,OAEMksH,EAAN,uNAGM/oH,EAAYC,YAAW,CAC3ByhI,eAAgB,CACd3Y,WADc,EAEdlsH,SAFc,EAGd+hE,UAHc,OAIdjzD,UAJc,OAKdqa,aAAc,8BAEhB27G,kBAAmB,CACjB5lI,OADiB,EAEjBgtH,WAFiB,EAGjBlsH,YAEFkT,MAAO,CACLzS,MADK,MAELT,SAAU,WA2DC3K,wBAvDf,SAAoB,GAAU,IAARikH,EAAQ,EAARA,KACdh1G,EAAUnB,IACVlB,EAAQ8E,cAFc,EAGI9C,mBAC9B8pB,eAAeurF,EAAfvrF,WAJ0B,0BAGrBkoC,EAHqB,KAGX8uE,EAHW,OAMF9gI,qBANE,mBAMrBiP,EANqB,KAMdga,EANc,KAOtB83G,EAAgBC,sBAAYhvE,EAAlC,KAYA,OAVA1xD,qBAAU,WACR,IACE+0G,MAASvrF,WAATurF,IACApsF,UACA,MAAOvF,GACPuF,EAASvF,EAATuF,YAGD,CARH3oB,IAWE,oCACG2O,EAAQ,uBAAGtP,UAAWU,EAAQ4O,OAAzB,GADR,KAEE,uBAAaA,MAAOA,GAClB,uBAAY0uH,QAAZ,EAAmBC,QAAQ,mBACxBvoB,EAFL,MAIE,uBACE11G,UAAWU,EADb,eAEE1Q,MAFF,EAGEsxI,cAHF,EAIEC,UAAW,SAAAC,GAAO,OAChB,uBACEC,SADF,OAEEviI,MAAOb,4BAFT,IAGE2B,UAAWU,EAHb,kBAMEghI,YAAa,CAAExkI,WAAF,OAAsB9T,QAAS,IAP9B,IAYlBA,QAhBF,GAiBE8V,MAAO,KAET,2BAAiBw2G,EA1BvB,mB,gHC7BmBisB,E,WAYnB,WAAYx0H,GAAiD,yBAVrDhhB,aAUqD,OAPrDy1I,YAOqD,OALrDn0I,UAKqD,OAHrDo0I,SAGqD,EAC3D90I,KAAKZ,QAAUghB,EAAKhhB,QACpBY,KAAK60I,OAASz0H,EAAKy0H,OACnB70I,KAAKU,KAAOV,KAAK+0I,gBAAgB/0I,KAAKZ,SACtCY,KAAK80I,IAAM10H,EAAK9f,G,uCAIlB,SAAIosC,GACF,MAAc,YAAVA,EACK1sC,KAAKZ,QAAQ41I,QAEfh1I,KAAKU,KAAKgsC,IAAU1sC,KAAKZ,QAAQstC,K,iBAG1C,c,oBAEA,c,sBAIA,c,kBAIA,WAME,MALU,GAAH,mBACF3oC,OAAOlB,KAAK7C,KAAKU,OADf,YAEFqD,OAAOlB,KAAK7C,KAAKZ,UAFf,CAGL,c,gBAKJ,WACE,OAAOY,KAAK80I,M,6BAId,SAAgB11I,GAA2B,IACjC61I,EAAmC71I,EAAnC61I,IAAKC,EAA8B91I,EAA9B81I,IAAKC,EAAyB/1I,EAAzB+1I,IAAKC,EAAoBh2I,EAApBg2I,MAAO91E,EAAalgE,EAAbkgE,KAAM+1E,EAAOj2I,EAAPi2I,GAC9Bt3I,EAAQo3I,EAAM,EAFqB,EAGVn1I,KAAKs1I,yBAAyBL,EAAKC,GAHzB,mBAGlCK,EAHkC,KAGzB9oI,EAHyB,KAInC+oI,EAAQN,GAAOA,EAAIhrH,MAAK,SAAClnB,GAAD,MAAgC,UAANA,KAiBxD,MAViC,CAC/BnF,QAASu3I,EACTr3I,QACAE,IARAi3I,GACAA,EAAIhrH,MACF,SAAClnB,GAAD,MACe,kBAANA,IAAsC,IAApBA,EAAEkqE,QAAQ,SAKpB5N,EAAKnB,MAAQq3E,GAASl2E,EAAKnB,IAAI,GAAKpgE,EAAQk3I,EAAI11I,OACnEkN,cACAjC,KAAM+qI,EACNnxI,KAAMixI,EAAKA,EAAG,QAAKj1I,EACnB2kC,QAASswG,GAAMA,EAAG91I,OAAS,EAAIH,EAAQi2I,GAAG/5F,MAAM,QAAKl7C,K,sCASzD,SACEiW,EACA2iD,GAC2C,WAE3C,IAAKA,GAAOA,IAAQ,GAClB,MAAO,CAAC,SAAU,0BAGpB,IAAMy8E,EAAuB,IAAI3yI,IAC7B+hB,EAA4B,IAAI/hB,IAYpC,GAXAk2D,EAAIv7D,SAAQ,SAAAkE,GAAK,MACa,EAAK+zI,yBAAyBr/H,EAAK1U,GADhD,mBACVg0I,EADU,KACFlpI,EADE,KAEf,IAAKkpI,EAAQ,OACc,EAAKC,2BAA2Bv/H,EAAK1U,GADnD,mBACTg0I,EADS,KACDlpI,EADC,KAGTkpI,GAAUlpI,IACZgpI,EAAQ1yI,IAAI4yI,GACZ9wH,EAAa9hB,IAAI0J,OAIjBoY,EAAaxW,KAAO,EAAG,CACzB,IAAMwnI,EAAwB,IAAI/yI,IAClC+hB,EAAapnB,SAAQ,SAAAq4I,GACnB,IAAMxZ,EAAS,+BAA+BvlG,KAAK++G,GAC/CxZ,GAAUA,EAAO,GACnBuZ,EAAS9yI,IAAIu5H,EAAO,IAEpBuZ,EAAS9yI,IAAI+yI,MAGjB,IAAMC,EAAsB,GAC3B,YAAIF,GAAUp4I,SAAQ,SAAC6+H,GACtB,IAAM0Z,EAAqB,GAC1B,YAAInxH,GAAcpnB,SAAQ,SAACq4I,GACtBA,EAAK7sG,WAAWqzF,IAClB0Z,EAAS92I,KAAK42I,EAAKx6F,MAAMghF,EAAO/8H,YAGpCw2I,EAAU72I,KAAKo9H,EAAS0Z,EAASl4H,KAAK,SAExC+G,EAAe,IAAI/hB,IAAIizI,GAEzB,OAAIN,EAAQpnI,KACH,CAAC,YAAIonI,GAAS33H,KAAK,KAAM,YAAI+G,GAAc/G,KAAK,MAElD,MAAC1d,OAAWA,K,sCAgBrB,SACEiW,EACA2iD,GAGA,GAAmB,kBAARA,EACT,MAAO,CACL,WACA,qEAIJ,GAAmB,kBAARA,IAAqBA,EAAI/vB,WAAW,KAC7C,MAAO,MAAC7oC,OAAWA,GAGrB44D,EAAMA,EAAI7D,QAAQ,SAAU,IAG5B,IAAIwgF,EAASf,EAAWqB,aAAaj9E,GAKrC,IAHK28E,GAAU31I,KAAK60I,OAAO7hG,YAAY,MAAOgmB,KAC5C28E,EAAS,oBAEPA,EAAQ,CACV,IAAMO,EAAkBl2I,KAAK60I,OAAO7hG,YAAY,MAAOgmB,EAAK,eAI5D,MAAO,CAAC28E,EAHYO,EAAe,UAC5Bl9E,EAD4B,cACnBk9E,GACZl2I,KAAKm2I,uBAAuBR,EAAQt/H,EAAK2iD,IAK/C,IAAMo9E,EAASp9E,EAAI5pB,MAAM,KACzB,OAAIgnG,EAAO72I,OAAS,EACXS,KAAK01I,yBACVr/H,EADK,WAED+/H,EAAO96F,MAAM,EAAG86F,EAAO72I,OAAS,GAAGue,KAAK,KAFvC,MAMF,MAAC1d,OAAWA,K,wCAGrB,SACEiW,EACA2iD,GAEA,MAAmB,kBAARA,EACF,CAAC,WAAYh5D,KAAKm2I,uBAAuB,WAAY9/H,EAAK2iD,IAEhD,IAAf3iD,EAAI9W,QAA+B,IAAfy5D,EAAIz5D,OAGnB,CAAC,MAAOS,KAAKm2I,uBAAuB,MAAO9/H,EAAK2iD,IAErD3iD,EAAI9W,SAAWy5D,EAAIz5D,OACjB8W,EAAI+4B,MAAM,IAAImM,UAAUz9B,KAAK,MAAQk7C,EAChC,CAAC,YAAah5D,KAAKm2I,uBAAuB,YAAa9/H,EAAK2iD,IAE9D,CACL,eACAh5D,KAAKm2I,uBAAuB,eAAgB9/H,EAAK2iD,IAIjD3iD,EAAI9W,QAAUy5D,EAAIz5D,OACb,CAAC,YAAaS,KAAKm2I,uBAAuB,YAAa9/H,EAAK2iD,IAGjE3iD,EAAI9W,OAASy5D,EAAIz5D,OACZ,CAAC,WAAYS,KAAKm2I,uBAAuB,WAAY9/H,EAAK2iD,IAG5D,CAAC,QAASh5D,KAAKm2I,uBAAuB,QAAS9/H,EAAK2iD,M,oCAG7D,SACE28E,EACAt/H,EACA2iD,GAEA,gBAAU28E,EAAV,YAAoBt/H,EAApB,eAA8B2iD,K,oBAIhC,WACE,4CACEl0B,SAAU9kC,KAAK80I,KACZ90I,KAAKZ,SACLY,KAAKU,MAHV,IAIE21I,QAASr2I,KAAKZ,QAAQ41I,c,KAxOPJ,EAgIZqB,aAAsD,CAC3DK,IAAK,WACLC,IAAK,YACLC,IAAK,cACLC,IAAK,YACLC,OAAQ,uBACRC,IAAK,wBACLC,IAAK,gBACL,aAAc,qBACdC,QAAS,mBACT,IAAK,qB,gCCxKT,giB,2jHC+BK9yI,OAAOkpE,aAEVA,IAAY6pE,OAGP,IAAMnuD,EACQ,kBAAZouD,GACPA,sIACAA,EACWC,GAAgBruD,EAOtB,SAAS7vC,EAAa4pB,GAC3B,IAAM/pB,GAAQ,IAAIs+F,aAAcC,OAAOx0E,GACjCy0E,EAAWC,kBAAQz+F,GACnB0+F,EAAUC,wBAAcH,GACxB3iI,EAAM6iI,EAAQnqE,QAAQ,KAC5B,OAAO14D,EAAM,EACT6iI,EAAQ/7F,MAAM,EAAG9mC,GAAK2gD,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KACzDkiF,EAAQliF,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KAQ1C,SAASujD,EAAe6+B,GAC7B,IAAMC,EAUR,SAAsBD,GACpB,IAAI7I,EAAM,EAEV,OADW6I,EAAIh4I,OAAS,GAEtB,KAAK,EACHmvI,EAAM,EACN,MACF,KAAK,EACHA,EAAM,EACN,MACF,KAAK,EACHA,EAAM,EACN,MACF,QACE,MAAM,IAAIltI,MAAM,6BAEpB,OAAO+1I,EAAM,IAAIE,OAAO/I,GA1BJgJ,CAAaH,EAAIpiF,QAAQ,KAAM,KAAKA,QAAQ,KAAM,MAChExc,EAAQg/F,sBAAYH,GACpBI,EAAWC,kBAAQl/F,GACzB,OAAO,IAAIm/F,aAAcC,OAAOH,GA0B3B,SAAStD,EAAerxI,EAAUi5B,GAAkB,MACb5oB,mBAASrQ,GADI,mBAClD+0I,EADkD,KAClCC,EADkC,KAYzD,OATArkI,qBAAU,WACR,IAAMysE,EAAUllE,YAAW,WACzB88H,EAAkBh1I,KACjBi5B,GACH,OAAO,WACL9gB,aAAailE,MAEd,CAACp9E,EAAOi5B,IAEJ87G,EAKF,SAASrO,EACdjxH,GAEA,IADA+yF,EACA,uDADO,IAGDysC,EAAUxkI,mBACViO,EAAUjO,mBAEhB,SAASo4H,IACHnqH,EAAQ1N,SACVmH,aAAauG,EAAQ1N,SAOzB,OAFAL,qBAAU,kBAAMk4H,IAAS,IAElB,WAAuC,2BAAT1rH,EAAS,yBAATA,EAAS,gBAE5C83H,EAAQjkI,QAAUmM,EAGlB0rH,IAGAnqH,EAAQ1N,QAAUkH,YAAW,WACvB+8H,EAAQjkI,SACVyE,EAAQ,WAAR,cAAYw/H,EAAQjkI,YAErBw3F,IAKA,SAAS0sC,EACd3vI,EACAiqF,GAGA,IADA,IAAI7pF,EAA6CJ,EAC1CI,GAAewU,kBAAQxU,IAAc,CAC1C,GAAI6pF,EAAU7pF,GACZ,OAAOA,EAET,IAAIwvI,oBAAUxvI,GAGZ,MAFAA,EAAcR,oBAAUQ,GAK5B,MAAM,IAAIpH,MAAM,0BAUX,SAASwkH,EACdqyB,EACAC,EACA9+H,GAKA,IAMI++H,EAVJC,EAIA,uDAJW,aACXC,EAGA,uDAHY,EACZC,EAEA,uDAFU,IACVC,EACA,uDADW,GAELC,EAAO,EAOb,SAAS1gB,EAAOl9F,GACd,IAAM69G,EAAOvvI,KAAKC,MACd1H,EAAWm5B,EAAU89G,aACrBC,EAAW/9G,EAAU+9G,UAAYF,EACjCG,EAAWh+G,EAAUi+G,cAAgB,EAErCJ,EAAOE,EAAW,KACpBA,EAAWF,GAIb,IADA,IAAMK,EAAW97I,KAAKiB,MAAMw6I,EAAOE,GAC1B/lH,EAAI,EAAGA,EAAIkmH,IAAYlmH,EAAG,CAKjCnxB,GAAwB,GADxBm3I,GAA4B,KAHbN,GAAW72I,EAAWy2I,IACpBK,EAAWK,GACaJ,GACR,KACJ,IAE/B,IAAMO,EAAa/7I,KAAKshD,IAAIs6F,IAAaP,EACnCW,EACQ,IAAZV,GAAgBt7I,KAAKshD,IAAI45F,EAAUz2I,IAAa42I,EAC3BU,GAAcC,GAEnC5/H,EAAS8+H,GACTE,MAEAh/H,EAAS3X,GACT02I,EAAmBxM,uBAAsB,kBACvC7T,EAAO,CACL4gB,aAAcj3I,EACdk3I,SAAUF,EACVI,aAAcD,QAMtB,OA3CKP,IACHA,EAAYr7I,KAAKshD,IAAI45F,EAAUD,GAAa,KA0CvC,CACL,kBAAMngB,EAAO,CAAE4gB,aAAcT,KAC7B,kBAAMgB,qBAAqBd,KAKxB,SAASe,EAGd9wI,EACAiqF,GAEA,OAAO0lD,EAAe3vI,EAAMiqF,GAKvB,SAASvuE,EAAW1b,GACzB,IACE,OAAO8wI,EAAiB9wI,EAAM02G,kBAC9B,MAAOloF,GACP,MAAM,IAAIx1B,MAAM,4BAKb,SAASqhB,EAAkBra,GAChC,IACE,OAAO8wI,EAAiB9wI,EAAM22G,eAC9B,MAAOnoF,GACP,MAAM,IAAIx1B,MAAM,6BAKb,SAAS8iB,EAAmB9b,GACjC,IACE,OAAO8wI,EAAiB9wI,EAAM42G,gBAC9B,MAAOpoF,GACP,MAAM,IAAIx1B,MAAM,8BAIb,SAASs6B,EAAqBtzB,GACnC,IACE,OAAO8wI,EAAiB9wI,EAAM62G,kBAC9B,MAAOroF,GACP,MAAM,IAAIx1B,MAAM,gCAsCb,SAASvC,EAAkBvB,GAAiC,IAG7D67I,EAQAC,EAVI57I,EAAsCF,EAAtCE,aAAcC,EAAwBH,EAAxBG,QAASE,EAAeL,EAAfK,MAAOE,EAAQP,EAARO,IAChCw7I,EAAqB77I,EAAe,IAAH,OAAOA,EAAP,KAAyB,GAkBhE,OAfE27I,OADYn5I,IAAVrC,EACY,IAAH,QAAQA,EAAQ,GAAGw/C,eAAe,eAC5Bn9C,IAARnC,EACK,KAEA,GAIdu7I,OADUp5I,IAARnC,OAEUmC,IAAVrC,GAAuBA,EAAQ,IAAME,EACjC,GADJ,YAESA,EAAIs/C,eAAe,eAERn9C,IAAVrC,EAAsB,KAAO,GAE3C,UAAU07I,GAAV,OAA+B57I,GAA/B,OAAyC07I,GAAzC,OAAuDC,GAUlD,SAASE,EACdtnD,EACAkH,GAEA,IAAKlH,EACH,MAAM,IAAI5wF,MAAM,gDAMlB,IAAMm4I,GAHNvnD,EAAYA,EAAUj9B,QAAQ,KAAM,KAGJ+Z,MAAM,mBACtC,IAAKyqE,EACH,MAAM,IAAIn4I,MAAJ,oCAAuC4wF,EAAvC,MAVS,kBAYoBunD,EAZpB,GAYN/7I,EAZM,KAYQyL,EAZR,KAaXuwI,EAAevwI,EAASqwD,YAAY,KAC1C,IAAsB,IAAlBkgF,EAAqB,CACvB,GAAItgD,EAAejwF,EAAUzL,GAC3B,MAAO,CAAEA,eAAcC,QAASwL,GAElC,MAAM,IAAI7H,MAAJ,sCAAyC6H,EAAzC,MAER,IAAMizH,EAASjzH,EAASiyC,MAAM,EAAGs+F,GAC3B7vI,EAASV,EAASiyC,MAAMs+F,EAAe,GAC7C,GACEtgD,EAAegjC,EAAQ1+H,IACvB07F,EAAejwF,EAAUzL,GAEzB,MAAM,IAAI4D,MAAJ,sCAAyC4wF,EAAzC,MACD,GAAIkH,EAAegjC,EAAQ1+H,GAAe,CAC/C,IAAImM,EAyCF,MAAO,CAAEnM,eAAcC,QAASy+H,GAvChC,IAAMud,EAAa9vI,EAAOmlE,MACxB,kEAGI4qE,EAAc/vI,EAAOmlE,MAAM,yCACjC,GAAI2qE,EAAY,mBACeA,EADf,GACL97I,EADK,KACQE,EADR,KAEd,QAAcmC,IAAVrC,QAA+BqC,IAARnC,EACzB,MAAO,CACLL,eACAC,QAASy+H,EACTv+H,OAAQA,EAAMo3D,QAAQ,KAAM,IAC5Bl3D,KAAMA,EAAIk3D,QAAQ,KAAM,SAGvB,KAAI2kF,EAmBT,MAAM,IAAIt4I,MAAJ,iCACsBuI,EADtB,0BAC8CqoF,EAD9C,MAnBgB,kBACW0nD,EADX,GACb/7I,EADa,KACFg8I,EADE,KAEtB,QAAc35I,IAAVrC,EACF,OAAIg8I,EAEK,CACLn8I,eACAC,QAASy+H,EACTv+H,OAAQA,EAAMo3D,QAAQ,KAAM,KAGzB,CACLv3D,eACAC,QAASy+H,EACTv+H,OAAQA,EAAMo3D,QAAQ,KAAM,IAC5Bl3D,KAAMF,EAAMo3D,QAAQ,KAAM,WAW7B,GAAImkC,EAAejwF,EAAUzL,GAClC,MAAO,CAAEA,eAAcC,QAASwL,GAElC,MAAM,IAAI7H,MAAJ,uDAA0D4wF,EAA1D,MAwCD,SAASvB,EACduB,EACAkH,GAEA,IAAMjH,EAASqnD,EAAuBtnD,EAAWkH,GAIjD,MAH4B,kBAAjBjH,EAAOt0F,QAChBs0F,EAAOt0F,OAAS,GAEXs0F,EAGF,SAASzB,EAAYopD,EAAuBC,GACjD,IAAMC,EACJF,EAAKp8I,cAAgBq8I,EAAKr8I,cACrBo8I,EAAKp8I,cAAgB,IAAI41D,cAAcymF,EAAKr8I,cAAgB,IAC7D,EACN,GAAIs8I,EACF,OAAOA,EAGT,IAAMC,EACJH,EAAKn8I,SAAWo8I,EAAKp8I,SAChBm8I,EAAKn8I,SAAW,IAAI21D,cAAcymF,EAAKp8I,SAAW,IACnD,EACN,GAAIs8I,EACF,OAAOA,EAGT,QAAmB/5I,IAAf45I,EAAKj8I,YAAsCqC,IAAf65I,EAAKl8I,MAAqB,CACxD,IAAMq8I,EAAYJ,EAAKj8I,MAAQk8I,EAAKl8I,MACpC,GAAIq8I,EACF,OAAOA,EAGX,QAAiBh6I,IAAb45I,EAAK/7I,UAAkCmC,IAAb65I,EAAKh8I,IAAmB,CACpD,IAAMo8I,EAAUL,EAAK/7I,IAAMg8I,EAAKh8I,IAChC,GAAIo8I,EACF,OAAOA,EAGX,OAAO,EAGF,SAASC,EACd34I,EACAqzB,EACAskE,GAIA,OAAO1I,EAFMC,EAAelvF,EAAG23F,GAClBzI,EAAe77D,EAAGskE,IAW1B,SAAS9+B,EAAMk0E,EAAa9vI,EAAaD,GAC9C,OAAI+vI,EAAM9vI,EACDA,EAEL8vI,EAAM/vI,EACDA,EAEF+vI,EAGT,SAAS6L,EAAuB7L,GAC9B,OAAOtxI,KAAK66C,MAAY,GAANy2F,GAAY,GAQzB,SAASr0E,EACdunD,EACAlkH,EACAb,GAEA,OAAIa,EAAOQ,SACFq8I,GAAwB78I,EAAOO,IAAM2jH,GAAM/kH,GAE7C09I,GAAwB34B,EAAKlkH,EAAOK,OAASlB,GAGtD,IAAM29I,EAAkB,IAAQp9I,KAAKqjG,GAC/Bg6C,EAAkBr9I,KAAKqjG,GAAK,IAC3B,SAASi6C,EAASC,GACvB,OAAQA,EAAUH,EAAmB,IAEhC,SAASI,EAASC,GACvB,OAAQA,EAAUJ,GAAoB,EAAIr9I,KAAKqjG,IAM1C,SAASx7E,EAAiB61H,EAAaC,GAC5C,MAAO,CAACD,EAAM19I,KAAK49I,IAAID,GAAQD,EAAM19I,KAAK69I,IAAIF,IAQzC,SAASG,EAAiBl7G,EAAWC,GAG1C,MAAO,CAFK7iC,KAAK6iG,KAAKjgE,EAAIA,EAAIC,EAAIA,GACpB7iC,KAAK+9I,KAAKl7G,EAAID,IAIvB,SAAS4c,EACdl7B,EACAhkB,EACAb,GAEA,OAAOmvD,EAAStqC,EAAQvhB,IAAI,SAAUuhB,EAAQvhB,IAAI,OAAQzC,EAAQb,GAG7D,SAASmvD,EACdJ,EACAE,EACApuD,EACAb,GAEA,IAAMkB,EAAQs8D,EAAOzO,EAAQluD,EAAQb,GAC/BoB,EAAMo8D,EAAOvO,EAASpuD,EAAQb,GACpC,OAAOa,EAAOQ,SAAW,CAACD,EAAKF,GAAS,CAACA,EAAOE,GAG3C,IAAM8qG,EAAoBhlG,OAAOkpE,YAAY1jC,KAAKxlC,QAGlD,SAASkwD,EACdmnF,EACA70I,EACA80I,GAEA,IADK,EACChhG,EAAUghG,EAAW,IAAIpkI,MAAMokI,GAAY,GAC7CC,EAAU,EAFT,cAGcF,GAHd,IAGL,2BAA6B,KAAlBx+C,EAAkB,QAC3BviD,EAAQihG,GAAW/0I,EAAKq2F,GACxB0+C,GAAW,GALR,8BAOL,OAAOjhG,EAoBF,SAAS47B,GAAatoE,EAAW4tI,GACtC,IAAMC,EAASxnH,IAAMrmB,EAAG4tI,GAMxB,OALIA,EAAEztC,eACJ0tC,EAAO1tC,eAAiBytC,EAAEztC,eACjBngG,EAAEmgG,iBACX0tC,EAAO1tC,eAAiBngG,EAAEmgG,gBAErB0tC,EAaF,SAASr/B,GACd/tF,EACAqkE,GAGA,IADA,IAAIzvC,EAAI50B,EAAM7uB,OACPyjD,KACL,GAAIyvC,EAAUrkE,EAAM40B,GAAIA,EAAG50B,GACzB,OAAO40B,EAGX,OAAQ,EAoBH,SAASjnB,GACdp1B,EACA80I,EACAC,EAMAC,EACAC,EACAC,EACAC,GAEA,IAAIC,EAEJ,SAASC,EAAYz5H,GACdynB,YAAiBznB,KAChBnF,kBAAQzW,GACVm1I,EAAcv5H,GAEdua,QAAQva,MAAMA,IAKpB,IAAM05H,EAAmBnrE,oBACvB,WACE,IACE,OAAO2qE,EAAa90I,GACpB,MAAO4b,GAEP,YADAy5H,EAAYz5H,MALe,uCAS/B,WAAO7hB,EAAMw7I,GAAb,iBAAAv6I,EAAA,yDACMo6I,IAAeA,EAAWx3I,OAAOm4B,SACnCq/G,EAAWp/G,QAGRvf,kBAAQzW,GALf,wDAQEo1I,EAAa,IAAI7qG,gBAGjB0qG,EADMO,EAAiBJ,GAVzB,kBAayBL,EACnBh7I,EACAy7I,EAAe53I,OACfoC,EACAu1I,GAjBN,OAaU95I,EAbV,OAmBIsxB,YAAiByoH,EAAe53I,QAC5B6Y,kBAAQzW,IACVk1I,EAAgBz5I,GArBtB,kDAwBQ+5I,IAAmBA,EAAe53I,OAAOm4B,SAC3Cy/G,EAAex/G,QAEjBq/G,EAAY,EAAD,IA3Bf,0DAT+B,wDAuC/BL,GAGFh7G,sBAAYh6B,EAAMs1I,GAClBt7G,sBAAYh6B,GAAM,WACZo1I,IAAeA,EAAWx3I,OAAOm4B,SACnCq/G,EAAWp/G,WAKV,SAASy/G,GACdt4C,EACApmG,GAEA,GAAI41B,0BAAgB51B,KAAY0f,kBAAQ1f,GACtC,OAAOA,EAET,GAAIA,GAAUomG,GAAcA,EAAWpmG,EAAOG,SAAU,CAStD,IAAMw+I,EAASv4C,GANbpmG,EADE41B,0BAAgB51B,GACT,eAAKssB,sBAAYtsB,IAEjB,eAAKA,IAIiBG,SACjC,GAAIw+I,EACF,kCAAY3+I,GAAZ,IAAoBG,QAASw+I,EAAQC,gBAAiB5+I,EAAOG,UAGjE,OAAOH,EAGF,SAAe41C,GAAtB,qC,8CAAO,WASL5V,EAAkCtd,GAT7B,yBAAAze,EAAA,yDAUG/D,EAAyCwiB,EAAzCxiB,aAAcopB,EAA2B5G,EAA3B4G,QAASzC,EAAkBnE,EAAlBmE,cAC1BnE,EAAKiE,UAXL,sBAYG,IAAI7iB,MAAM,yBAZb,UAcC+6I,EAdD,2BAeAn8H,GAfA,IAgBH4G,QAAS,YAAK5G,EAAK4G,SAAW,OAG5BppB,EAnBC,gCAoBsB8/B,EAAgB2nE,wBACvC9gF,EACA3mB,EACA2+I,GAvBC,OA0BH,IANMz4C,EApBH,SA0Be98E,GAAWu1H,EAAQv1H,QACnC,IAASgM,EAAI,EAAGA,EAAIhM,EAAQznB,OAAQyzB,GAAK,EACvCupH,EAAQv1H,QAAQgM,GAAKopH,GAAqBt4C,EAAY98E,EAAQgM,IA5B/D,gCAgCEupH,GAhCF,6C,sBAmCA,SAASpyE,GAAOxoE,EAAWqzB,GAChC,MAAO,CAAC53B,KAAKwB,IAAI+C,EAAGqzB,GAAI53B,KAAKuB,IAAIgD,EAAGqzB,IAG/B,SAASsI,GAAT,GAQJ,IAPDz/B,EAOC,EAPDA,QACA2/C,EAMC,EANDA,MACAqkE,EAKC,EALDA,IAMA,gBAAUhkH,EAAV,YAAqB2/C,EAAMD,eAAe,UAA1C,OACEskE,EAAM,mBAAqB,IAIxB,IAAMxzF,GACO,qBAAX5xB,QAA0Bgb,QAAQhb,OAAOyE,UAE3C,SAAS2lF,GAAO21D,GACrB,OAAO/0D,GAAW+0D,GAAWptG,MAAM,IAAImM,UAAUz9B,KAAK,IAGjD,IAAM2pE,GAAc,WACzB,IAAMg1D,EAAkB,WAKlBC,EAAkB,CACtBC,EAAG,IACH7/F,EAAG,IACH7uC,EAAG,IACHqa,EAAG,IACH3mB,EAAG,IACHi7I,EAAG,IACHC,EAAG,IACH78G,EAAG,IACH3tB,EAAG,IACHyqI,EAAG,IACHC,EAAG,IACH98G,EAAG,IACH+8G,EAAG,IACH94I,EAAG,IACHhB,EAAG,IACH2K,EAAG,IACHovI,EAAG,IACHtoG,EAAG,IACHhnC,EAAG,IACH2wB,EAAG,IACH4+G,EAAG,IACHC,EAAG,IACHttF,EAAG,IACH15B,EAAG,IACHolH,EAAG,IACH7mH,EAAG,IACH0oH,EAAG,IACHj4G,EAAG,IACHk4G,EAAG,IACHroH,EAAG,IACHsoH,EAAG,IACHvvI,EAAG,KAGL,OAAO,SAACyuI,GACN,OAAOA,EAAUrnF,QAAQsnF,GAAiB,SAAA5sF,GAAC,OAAI6sF,EAAgB7sF,IAAM,OA1C9C,GA8CpB,SAAS/V,GAActwC,GAC5B,IAAM7H,EAAI,IAAI47I,WACd,OAAO,IAAIjpH,SAAQ,SAACgX,EAASC,GAC3B5pC,EAAE+e,OAAS,SAAAsW,GACLA,EAAEtc,OACJ4wB,EAAQtU,EAAEtc,OAAOtY,QAEjBmpC,EAAO,IAAI/pC,MAAM,6CAGrBG,EAAE67I,cAAch0I,MAOb,IAAMo1H,GACK,qBAATvrG,KAEe,qBAAX52B,QAA0BA,OAAOghJ,oBAEtChhJ,OAAOghJ,oBACP,SAACrkG,GAAD,OAAkBj+B,YAAW,kBAAMi+B,MAAM,IAC3C,SAACA,GAAD,OAAkBA,KAGjB,SAASsV,GAAYgU,GAA4B,IAAfrzD,EAAe,uDAAJ,GAE5CquI,EAAS,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,QAAS,SAAU,UAAU,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,SAAU,QAAS,SAAU,GAAI,QAAS,SAAU,SAAU,QAAS,SAAU,QAAS,SAAU,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,GAAI,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,QAAS,GAAI,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,GAAI,SAAU,SAAU,GAAI,QAAS,GAAI,GAAI,GAAI,SAAU,QAAS,QAAS,UACx6BC,EAAM,kBACZ,OACEj7E,EACGtzB,MAAM,IACNrqC,KAAI,SAAAogC,GAAC,OACJA,EAAEkK,WAAW,GAAKquG,EAAOn+I,OAASm+I,EAAOv4G,EAAEkK,WAAW,IAAMsuG,KAE7DhpH,QAAO,SAACmkC,EAAKlkC,GAAN,OAAcA,EAAMkkC,IAAK,GAAKzpD,EAIrC,IAAM63E,GAAgB,CAAC,OACjBC,GAAe,CAAC,MAAO,MAAO,OAC9BK,GAAoB,CAC/Bo2D,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,KAQA,SAASp6D,GAAmBq6D,GACjC,IAAMC,EAA4C,GAsBlD,OArBA99I,OAAOlB,KAAK++I,GAAOnkJ,SAAQ,SAAAkpF,GAGzB,IAFA,IAAMm7D,EAAKF,EAAMj7D,GACXo7D,EAAmB,GAChB/uH,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAMgvH,EAAMr7D,EAAMr0B,OAAOt/B,GACzB+uH,EAAK/uH,GAAK,GACV+uH,EAAK/uH,GAAG,GAAKgvH,EAAI33I,cACjB03I,EAAK/uH,GAAG,GAAKgvH,EAAI52H,cAEnB,IAAK,IAAI4H,EAAI,EAAGA,EAAI,EAAGA,IAErB,IADA,IAAMivH,EAAKF,EAAK,GAAG/uH,GACV8b,EAAI,EAAGA,EAAI,EAAGA,IAErB,IADA,IAAMozG,EAAKH,EAAK,GAAGjzG,GACV5rC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,IAAMi/I,EAAKJ,EAAK,GAAG7+I,GAEnB2+I,EADgBI,EAAKC,EAAKC,GACAL,MAK3BD,EAIF,SAAe3iB,GAAtB,uC,8CAAO,WACLkjB,EACAz+I,EACA0+I,GAHK,eAAA1gJ,EAAA,6DAKLgC,EAAey+I,GALV,SAMgBC,IANhB,cAMCjgJ,EAND,OAOLuB,EAAe,IAPV,kBAQEvB,GARF,4C,sBAWA,SAAS6wB,GAASyvC,GACvB,IACI1vC,EADAsvH,EAAO,EAGX,GAAmB,IAAf5/E,EAAInjE,OACN,OAAO+iJ,EAET,IAAKtvH,EAAI,EAAGA,EAAI0vC,EAAInjE,OAAQyzB,IAE1BsvH,GAAQA,GAAQ,GAAKA,EADf5/E,EAAIrzB,WAAWrc,GAErBsvH,GAAQ,EAEV,OAAOA,EAIF,SAAS11I,GAAW41D,GACzB,gBAAUvvC,GAASmK,KAAKE,UAAUklC,O,wVC1hCpC,SAAS+/E,EACPtiH,EACA8gD,EACAC,EACA14D,EACAk6H,GAEA,IAAMnwI,EAAIjV,KAAKshD,IAAIze,EAAI+gD,GACvB,KAAI3uE,EAAIiW,GAAR,CAGIjW,IAAMiW,GACRk6H,EAAYtjJ,KAAK,CAAC6hF,EAAI9gD,IAExB,IAAMwiH,EAAWrlJ,KAAK6iG,KAAK33E,EAAIA,EAAIjW,EAAIA,GACvCmwI,EAAYtjJ,KAAK,CAAC6hF,EAAK0hE,EAAUxiH,IACjCuiH,EAAYtjJ,KAAK,CAAC6hF,EAAK0hE,EAAUxiH,KAGnC,SAASyiH,EACP1iH,EACA+gD,EACAC,EACA14D,EACAk6H,GAEA,IAAMnwI,EAAIjV,KAAKshD,IAAI1e,EAAI+gD,GACvB,KAAI1uE,EAAIiW,GAAR,CAGIjW,IAAMiW,GACRk6H,EAAYtjJ,KAAK,CAAC8gC,EAAGghD,IAEvB,IAAMyhE,EAAWrlJ,KAAK6iG,KAAK33E,EAAIA,EAAIjW,EAAIA,GACvCmwI,EAAYtjJ,KAAK,CAAC8gC,EAAGghD,EAAKyhE,IAC1BD,EAAYtjJ,KAAK,CAAC8gC,EAAGghD,EAAKyhE,KAerB,SAASvH,EAAiBl7G,EAAWC,GAC1C,IAAM66G,EAAM19I,KAAK6iG,KAAKjgE,EAAIA,EAAIC,EAAIA,GAClC,OAAY,IAAR66G,EACK,CAAC,EAAG,GAGN,CAACA,EAlBV,SAA0B96G,EAAWC,GACnC,IAAI86G,GAAS39I,KAAK+9I,KAAKl7G,EAAID,GAAK,EAAI5iC,KAAKqjG,KAAO,EAAIrjG,KAAKqjG,IAQzD,OAPIzgE,EAAI,IACFC,GAAK,EACP86G,GAAS39I,KAAKqjG,GAEds6C,GAAS39I,KAAKqjG,IAGXs6C,EAQO4H,CAAiB3iH,EAAGC,IAIpC,IAAM2iH,EAAQ,EAAIxlJ,KAAKqjG,GCnDhB,IAAMoiD,EAAb,WAiBE,WACE9lI,EACArf,EACAolJ,EACAC,GACA,yBArBF/jJ,SAqBE,OAnBFtB,YAmBE,OAjBFslJ,mBAiBE,OAfF/8H,kBAeE,OAbFE,gBAaE,OAXF88H,iBAWE,OATFF,iBASE,OAPFG,aAOE,MACQD,EAAgBlmI,EAAhBkmI,YACRjjJ,KAAKhB,IAAMC,4BAAkBvB,GAC7BsC,KAAKtC,OAASA,EACdsC,KAAKgjJ,cAAgBF,EACrB9iJ,KAAKijJ,YAAcA,EACnBjjJ,KAAK+iJ,YAAcA,EACnB/iJ,KAAKkjJ,SAAU,EAEfljJ,KAAKimB,aAAejmB,KAAKgjJ,cACzBhjJ,KAAKmmB,WAAazoB,EAAOylJ,QAAUnjJ,KAAKijJ,YAAcjjJ,KAAKgjJ,cAC3Dj/I,OAAO0wF,OAAOz0F,MAjClB,0CAoCE,SAAO4hH,EAAYhiC,GACjB,IAQMwjE,GAPFpjJ,KAAKtC,OAAO2lJ,OACHrjJ,KAAKtC,OAAOylJ,QAAU,EACxBnjJ,KAAKkjJ,QACHljJ,KAAKtC,OAAOO,IAAM2jH,EAElBA,EAAK5hH,KAAKtC,OAAOK,OAEEiC,KAAKijJ,YAAcjjJ,KAAKgjJ,cACxD,OAAO/9H,2BAAiB26D,EAAUwjE,KA9CtC,oBAiDE,WACE,OAAOr6C,4BAAkBhlG,OAAOhD,QAAQf,WAlD5C,KAoEA,SAASsjJ,EAAe38I,EAAW20C,GAAc,IDf/CioG,EACAC,EACAC,EACAC,ECY+C,cAI3C/8I,EAAKg9I,eADP5I,MAH6C,GAGrC6I,EAHqC,KAGpBC,EAHoB,KAM/C,ODrBAN,ECsBEjoG,EAAM0nG,cAAgBr8I,EAAKq8I,cDrB7BQ,ECsBEloG,EAAMynG,YDrBRU,ECsBEG,EDrBFF,ECsBEG,EAAkBD,IDpBhBJ,GAAY,GAAKE,GAAY,KAG7BF,EAAW,MAAUZ,GAASc,EAAW,MAAUd,IAKvDW,GAAaA,EAAUX,EAASA,GAASA,EAASA,IAClDa,GAAaA,EAAUb,EAASA,GAASA,EAASA,GAE1Bc,GAAYH,EAAUC,EAAWC,GAMrDF,GADJE,GAAWb,GACac,GAAYH,EAAUC,EAAWC,GAMlDF,GADPE,GAAWb,EAAQA,GACQc,GAAYH,EAAUC,EAAWC,GEjE/C,SAASK,EAAaxsI,GAInC,OAAO/R,QAAMuB,QACX+wD,gBACAtyD,QACGnJ,MAAM,eAAgB,CACrBoO,KAAMjF,QAAMye,QAAQ,gBACpBg/H,eAAgB5lJ,KAAKqjG,GAAK,EAC1B5jG,QAAS,IACT0oC,OAAQhgC,QAAM6oB,MACZ9W,EAAc8uB,iBAAiB,QAAS,eAG1Co1D,0BAA0B,EAC1ByD,yBAAyB,EACzB8kD,mBAAmB,EACnB7kD,mBAAmB,EAEnBz+F,OAAQ8E,QAAMC,SACZD,QAAM84B,WAAW,cAAe94B,QAAMW,QAAQ,SAAAo4B,GAAC,OAAIA,GApBzC,MAEI,KAqBhB0lH,gBAAiB,GACjBC,UAAW,GACXC,UAAW,GACXC,gBAAiB,IACjBC,gBAAiB,EACjBtnJ,kBAAmB,GACnBF,iBAAkB2I,QAAM6oB,MAAMvoB,UAC9Bw+I,QAAS,EACTC,QAAS,EACTvsF,kBAAmB,iBAEpBp8B,UAAS,iBAAO,CACfn/B,MAAO,QAERyiB,OAAM,SAAAtY,GAAI,MAAK,CACd,mBACE,ODDV,SAA+BA,GAC7B,IADwC,EAClC49I,EAAS,GACXzB,EAAsB,EAFc,cAGnBn8I,EAAK69I,eAHc,IAGxC,2BAAyC,KAA9B9mJ,EAA8B,QACjCqlJ,EACJrlJ,EAAOylJ,QAAUx8I,EAAKs8I,YAAct8I,EAAKs9I,UAAYt9I,EAAK89I,YAC5DF,EAAOrlJ,KAAK,IAAI2jJ,EAAMl8I,EAAMjJ,EAAQolJ,EAAqBC,IACzDD,GAAuBC,GAPe,8BASxC,OAAOwB,ECRQG,CAAsB/9I,IAE/B,0BACE,OAAO3G,KAAK2kJ,aAAa75H,OAAOw4H,EAAe/5G,KAAKvpC,KAAM2G,KAE5D,qBACE,OFuBH,SACLi+I,EACAC,EACAC,GACA,kBACmCF,EADnC,GACKG,EADL,KACYC,EADZ,KACmBC,EADnB,KAC0BC,EAD1B,mBAEiBL,EAFjB,GAEO9jE,EAFP,KAEWC,EAFX,KAaA,GAPAgkE,GAASjkE,EACTkkE,GAASjkE,EACTkkE,GAASlkE,GAHT+jE,GAAShkE,GAMC,GAAKikE,EAAQ,GAAKC,EAAQ,GAAKC,EAAQ,EAErB,CAQ1B,IAPA,IAAMC,EAAW,CACf,CAACJ,EAAOE,GACR,CAACD,EAAOC,GACR,CAACF,EAAOG,GACR,CAACF,EAAOE,IAENE,GAAS,IACJpyH,EAAI,EAAGA,EAAImyH,EAAS5lJ,OAAQyzB,GAAK,EAAG,mBAC5BmyH,EAASnyH,GADmB,GACpCgN,EADoC,KACjCC,EADiC,KAErC66G,EAAM19I,KAAK6iG,KAAKjgE,EAAIA,EAAIC,EAAIA,GAC9B66G,EAAMsK,IACRA,EAAStK,GAGb,MAAO,CACLA,IAAK,CAAC,EAAG19I,KAAKwB,IAAIkmJ,EAAcM,IAChCrK,MAAO,CAAC,EAAG,EAAI39I,KAAKqjG,KAsExB,IAAM0kD,EAA+B,CACnC,CAACJ,EAAOE,GACR,CAACD,EAAOC,GACR,CAACF,EAAOG,GACR,CAACF,EAAOE,IAEVxC,EAAwBqC,EAAO,EAAG,EAAGD,EAAcK,GACnDzC,EAAwBsC,EAAO,EAAG,EAAGF,EAAcK,GACnD5C,EAAwB0C,EAAO,EAAG,EAAGH,EAAcK,GACnD5C,EAAwB2C,EAAO,EAAG,EAAGJ,EAAcK,IAG9CJ,EAAQD,GACXK,EAASjmJ,KAAK,CAAC6lJ,EAAO,IAEpBC,EAAQF,GACVK,EAASjmJ,KAAK,CAAC8lJ,EAAO,KAEnBC,EAAQH,GACXK,EAASjmJ,KAAK,CAAC,EAAG+lJ,IAEhBC,EAAQJ,GACVK,EAASjmJ,KAAK,CAAC,EAAGgmJ,IAgBpB,IARA,IAAMG,EAAUN,GAAS,GAAK,EAAI,EAI9BO,EAASj7G,IACTk7G,GAAS,IACTC,EAAWn7G,IACXo7G,GAAW,IACNzyH,EAAI,EAAGA,EAAImyH,EAAS5lJ,OAAQyzB,GAAK,EAAG,mBAE1BmyH,EAASnyH,GAFiB,GAEpC0yH,EAFoC,KAEhCC,EAFgC,KAG3C,GAAID,GAAMX,GAASW,GAAMV,GAASW,GAAMV,GAASU,GAAMT,EAAO,OACvChK,EAAiBwK,EAAKL,EAASM,EAAKN,GADG,mBACrDvK,EADqD,KAChDC,EADgD,KAGxDD,GAAOgK,EAAe,OAEpB/J,EAAQyK,GAAY1K,EAAM,OAC5B0K,EAAWzK,GAETA,EAAQ0K,GAAY3K,EAAM,OAC5B2K,EAAW1K,GAETD,EAAMwK,IACRA,EAASxK,GAEPA,EAAMyK,IACRA,EAASzK,KAgBjB,OAViB,IAAbuK,IACFG,GAAYpoJ,KAAKqjG,GACjBglD,GAAYroJ,KAAKqjG,IAGf+kD,EAAW,EAAIpoJ,KAAKqjG,IAAMglD,EAAW,EAAIroJ,KAAKqjG,KAChD+kD,GAAY,EAAIpoJ,KAAKqjG,GACrBglD,GAAY,EAAIroJ,KAAKqjG,IAGhB,CACLq6C,IAAK,CAACwK,EAAQloJ,KAAKwB,IAAIkmJ,EAAcS,IACrCxK,MAAO,CAACyK,EAAUC,IEzMLG,CACL,CACEj/I,EAAK09I,QACL19I,EAAK09I,QAAU19I,EAAKnK,MACpBmK,EAAK29I,QACL39I,EAAK29I,QAAU39I,EAAKlG,QAEtBT,KAAK6lJ,SACL7lJ,KAAK4/E,WAGT,sBACE,IADoB,EAChBkmE,EAAW,EADK,cAEJ9lJ,KAAKwkJ,eAFD,IAEpB,2BAAoC,CAClCsB,GADkC,QACpB3C,SAHI,8BAKpB,OACE2C,EAAWn/I,EAAK9J,QAAU8J,EAAKs9I,UAAYjkJ,KAAKwkJ,cAAcjlJ,QAGlE,eACE,OAAOS,KAAK+lJ,iBAAmB,EAAI3oJ,KAAKqjG,KAE1C,kBACE,OAAO95F,EAAK9J,QAAUmD,KAAK4/E,UAE7B,kBACE,OAAO5/E,KAAK4/E,UAEd,eACE,MAAO,CACL5/E,KAAK4/E,SAAWj5E,EAAKu9I,UACrBlkJ,KAAK4/E,SAAWj5E,EAAKu9I,YAGzB,cACE,IADY,EACRv3G,EAAQ,EADA,cAEShmC,EAAK/J,kBAFd,IAEZ,2BAA4C,KAAjCc,EAAiC,QAC1CivC,GAASjvC,EAAOO,IAAMP,EAAOK,OAHnB,8BAKZ,OAAO4uC,GAET,sBACE,OAAOhmC,EAAKo9I,kBACR3mJ,KAAKwB,IAAI+H,EAAKnK,MAAOmK,EAAKlG,QAAU,EAAIkG,EAAKw9I,gBAC7C,KAEN,iBACE,IAAM6B,EAAqB,EAAI5oJ,KAAKqjG,GAAK95F,EAAKq9I,gBAC9C,OAAOhkJ,KAAKgpE,QAAUg9E,GAExB,iBAEE,IAAMC,EAAqB,EAAI7oJ,KAAKqjG,GAAKzgG,KAAKkmJ,gBAC9C,OAAO1rF,gBACLx6D,KAAKgpE,QAAUi9E,EACf,MACAjmJ,KAAK0iH,aAGT,mBACE,OAAO/7G,EAAK9J,SAAWmD,KAAK0iH,YAE9B,mBACE,OAAO/7G,EAAK9J,SAAWmD,KAAKyiH,YAE9B,qBACE,OAAOziH,KAAKyiH,YAAc,OAE5B,uBACE,MAAO,CACW,EAAhBziH,KAAK4/E,SAAe,EAAIj5E,EAAKu9I,UACb,EAAhBlkJ,KAAK4/E,SAAe,EAAIj5E,EAAKu9I,YAGjC,kBACE,OAAOlkJ,KAAKmmJ,iBAAiB,IAE/B,mBACE,OAAOnmJ,KAAKmmJ,iBAAiB,IAI/B,oBAEE,IAAMC,EAAiB,GACvBz/I,EAAK/J,iBAAiBa,SAAQ,SAAAC,GAC5B,IAAMylJ,EAAUzlJ,EAAOO,IAAMP,EAAOK,MAEpC,GADgBolJ,EAAUx8I,EAAK9J,QACjB8J,EAAKy9I,gBAAiB,CAElC,IAAMiC,EAAcD,EAAQA,EAAQ7mJ,OAAS,GACzC8mJ,GAAeA,EAAYhD,QAC7BgD,EAAYr/H,QAAQ9nB,KAApB,eAA8BxB,IAC9B2oJ,EAAYlD,SAAWA,GAEvBiD,EAAQlnJ,KAAK,CACXmkJ,QAAQ,EACRF,UACAn8H,QAAS,CAAC,eAAKtpB,WAKnB0oJ,EAAQlnJ,KAAR,2BAAkBxB,GAAlB,IAA0BylJ,gBAK9B,IAAK,IAAInwH,EAAI,EAAGA,EAAIozH,EAAQ7mJ,OAAQyzB,GAAK,EAAG,CAC1C,IAAMmD,EAAIiwH,EAAQpzH,GACdmD,EAAEktH,QAA+B,IAArBltH,EAAEnP,QAAQznB,gBACjB42B,EAAEktH,OACT+C,EAAQpzH,GAAR,2BAAkBmD,GAAMA,EAAEnP,QAAQ,KAGtC,OAAOo/H,GAGT,oBACE,IAAMvoI,EAA0B,GAMhC,OALAlX,EAAK/J,iBAAiBa,SAAQ,SAAAumH,GACvBnmG,EAAcqN,SAAS84F,EAAgBpmH,eAC1CigB,EAAc3e,KAAK8kH,EAAgBpmH,iBAGhCigB,OAGV8d,UAAS,iBAAO,CACfpZ,WAAOniB,MAERsG,SAAQ,SAAAC,GAAI,MAAK,CAEhBiT,SAFgB,SAEP+/C,GAEP,OADAhzD,EAAKnK,MAAQY,KAAKuB,IAAIg7D,EAnLb,KAoLFhzD,EAAKnK,OAEdokC,UANgB,SAMNuoC,GAER,OADAxiE,EAAKlG,OAASrD,KAAKuB,IAAIwqE,EAxLb,IAyLHxiE,EAAKlG,QAEdogC,aAVgB,SAUH7sB,GACX,IAAM8sB,EAAYn6B,EAAKlG,OACjB0oE,EAAYnpE,KAAK4gC,UAAUj6B,EAAKlG,OAASuT,GAE/C,OADAhU,KAAKsmJ,wBAAwB3/I,EAAK4/I,gBAC3Bp9E,EAAYroC,GAErBg7D,YAhBgB,SAgBJ9nF,GACV,IAAM+nF,EAAWp1F,EAAKnK,MAChBm9D,EAAW35D,KAAK4Z,SAASjT,EAAKnK,MAAQwX,GAE5C,OADAhU,KAAKsmJ,wBAAwB3/I,EAAK4/I,gBAC3B5sF,EAAWoiC,GAEpByqD,sBAtBgB,WAuBdxmJ,KAAKymJ,gBAAgBrpJ,KAAKqjG,GAAK,IAGjCimD,6BA1BgB,WA2Bd1mJ,KAAK2mJ,uBAAuBvpJ,KAAKqjG,GAAK,IAGxCgmD,gBA9BgB,WA8BiB,IAAjBzyI,EAAiB,uDAAN,IACzBrN,EAAKq8I,eAAiBhvI,GAGxB2yI,uBAlCgB,WAkCwB,IAAjB3yI,EAAiB,uDAAN,IAChCrN,EAAKq8I,eAAiBhvI,GAGxBs1D,aAtCgB,WAuCdtpE,KAAK+oE,WAAWpiE,EAAK9J,QAAU,MAGjCusE,cA1CgB,WA2CdppE,KAAK+oE,WAA0B,IAAfpiE,EAAK9J,UAGvBksE,WA9CgB,SA8CL8/C,GACTliH,EAAK9J,QAAU29D,gBAAMquD,EAAQliH,EAAK87G,WAAY97G,EAAK+7G,aAGrD4jC,uBAlDgB,SAkDOM,GACjBjgJ,EAAKo9I,mBAAqB6C,GAC5B5mJ,KAAK+oE,WAAWpiE,EAAK87G,aAIzB5oD,UAxDgB,WAyDdzxD,oBAAUzB,EAAM,GAAGizD,WAAWjzD,IAGhCmiE,oBA5DgB,SA4DI9hD,GAClB,IAAM6/H,EAAmD,IAAjClgJ,EAAK/J,iBAAiB2C,OAC9CoH,EAAK/J,iBAAmBsgC,eAAKlW,GAEzB6/H,EACF7mJ,KAAK+oE,WAAWpiE,EAAK87G,YAErBziH,KAAK+oE,WAAWpiE,EAAK9J,UAIzB2sE,sBAvEgB,WAwEd,GAA+B,iBAA3B7iE,EAAKoxD,kBAAsC,CAC7C,IAAM3iD,EAAU8O,qBAAWvd,GAC3B,GAAIwd,oCAA0B/O,GAAU,CACtC,IAAMq0D,EAAWr0D,EAAQuP,UACvB,kCACA,4BACA,CAAE5H,KAAMpW,IAGV,OADAyO,EAAQ0P,WAAW2kD,GACZA,GAGX,MAAM,IAAIjoE,MAAJ,sCAC2BmF,EAAKoxD,qBAIxC6R,YAzFgB,SAyFJj9D,GAEU3M,KAAK4mC,UAAUj6B,IAGjC3M,KAAK6mC,UAAUl6B,IAInB4vB,SAlGgB,SAkGPha,GACP5b,EAAK4b,MAAQA,GAGfskB,UAtGgB,SAsGNl6B,GAAuC,IAAtBq6B,EAAsB,uDAAJ,GACrC0iC,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAEIkX,EAAYvM,EAAcgI,aAAarX,EAAcuC,MAC3D,IAAKqZ,EACH,MAAM,IAAIriB,MAAJ,6BAAgCyG,EAAcuC,OAEtD,IAAM6U,EAAW/H,EAAc0wB,YAAYrhC,EAAK6D,MAC1CgwE,EAAoBn7D,EAAS4oB,aAAaljC,KAC9C,SAAAoiC,GAAW,OAAIA,EAAY/iC,QAEvB+jC,EAAclgC,EAAck+B,SAAStP,MACzC,SAACxkB,GAAD,OAA8BmoE,EAAkBtvD,SAAS7Y,EAAE7H,SAEvDzC,EAAQ8b,EAAUX,WAAWiQ,OAArB,2BACT6T,GADS,IAEZx8B,KAAMvC,EAAcuC,KACpBvC,gBACAk+B,SAAU,CAAC,CAAE37B,KAAM29B,EAAY39B,KAAMvC,cAAekgC,OAEtDxhC,EAAK4+B,OAAOrmC,KAAK6I,IAGnBy9B,aAnIgB,SAoIdv9B,GAEA,IADA++B,EACA,uDADkB,GAEVx8B,EAASvC,EAATuC,KACFpG,EAAOX,yBAAewE,EAAe,QACrC4b,EAAYvM,EAAcgI,aAAa9U,GAC7C,IAAKqZ,EACH,MAAM,IAAIriB,MAAJ,6BAAgCyG,EAAcuC,OAEtD,IAAM6U,EAAW/H,EAAc0wB,YAAYrhC,EAAK6D,MAC1CgwE,EAAoBn7D,EAAS4oB,aAAaljC,KAC9C,SAAAoiC,GAAW,OAAIA,EAAY/iC,QAEvB+jC,EAAclgC,EAAck+B,SAAStP,MACzC,SAACxkB,GAAD,OAA8BmoE,EAAkBtvD,SAAS7Y,EAAE7H,SAEvDzC,EAAQ8b,EAAUX,WAAWiQ,OAArB,2BACT6T,GADS,IAEZ5iC,OACAoG,OACAvC,gBACAk+B,SAAU,CAAC,CAAE37B,KAAM29B,EAAY39B,KAAMvC,cAAekgC,OAEtDxhC,EAAK4+B,OAAOrmC,KAAK6I,IAGnB6+B,UA9JgB,SA8JNj6B,GACR,IAAM+8D,EAAoBpyD,EAAc2sB,0BACtC,SAEIh8B,EAAgBi/B,4BACpBwiC,EACA18C,kBAAQrmB,GACRgG,GAGIg9D,EAAchjE,EAAK4+B,OAAOza,QAC9B,SAAA6pB,GAAC,OAAIA,EAAE1sC,gBAAkBA,KAG3B,OADAq/B,uBAAY,kBAAMqiC,EAAYlsE,SAAQ,SAAAk3C,GAAC,OAAIhuC,EAAK4+B,OAAOgC,OAAOoN,SACvDg1B,EAAYpqE,QAGrBunJ,sBA/KgB,WAmLd,OAHAngJ,EAAKo9I,mBAAqBp9I,EAAKo9I,kBAE/B/jJ,KAAKsmJ,uBAAuB3/I,EAAKogJ,cAC1BpgJ,EAAKo9I,wBC3XP,eAACzsI,GAAiC,IACvCmM,EAAQnM,EAARmM,IACFnK,EAAQmK,EAAIyL,MACV5b,EAAwBgG,EAAxBhG,SAAUM,EAAc0F,EAAd1F,UACVnB,EAAegR,EAAI,4BAAnBhR,WACA/N,EAAa+e,EAAI,cAAjB/e,SAEF8N,EAAYC,GAAW,SAAAnB,GAG3B,MAAO,CACL43B,KAAM,CACJ89G,gBAAiB,IACjBC,iBAAkB,GAClBjsH,UAAW,SAAF,OALI,IAKJ,2CACPytG,IADO,2BAIX,oBAAqB,CACnB,KAAM,CACJhiH,OAAQnV,EAAMjE,QAAQJ,QAAQoP,OAEhC,MAAO,CACLoK,OAAQnV,EAAMjE,QAAQF,UAAUkP,OAElC,MAAO,CACLoK,OAAQnV,EAAMjE,QAAQD,SAASiP,OAEjC,MAAO,CACLoK,OAAQnV,EAAMjE,QAAQE,WAAW8O,OAEnC,OAAQ,CACNoK,OAAQnV,EAAMjE,QAAQJ,QAAQoP,QAGlC,kBAAmB,CACjB,KAAM,CACJ4qI,iBA7BS,GA+BX,MAAO,CACLA,iBAAkBrlJ,GAClB2Q,UAAW,kBAEb,OAAQ,CACN00I,iBApCS,EAqCT10I,UAAW,uBAoEnB,OA7DgB7N,GACd,YAMM,IAJa4e,EAIb,EALJlnB,MACEyM,YAAeya,OAKX3P,EAAUnB,IADZ,EAIsBc,GAAS,GAJ/B,mBAIGsO,EAJH,KAIUC,EAJV,KAUJ,OALAjO,GAAU,WACR,IAAM+N,EAAUxG,YAAW,kBAAM0G,GAAS,KAAO,KACjD,OAAO,kBAAMzG,aAAauG,OAGpBC,EACN,yBACE,4BACE,2BACEthB,GAAG,gBACH9D,MAAM,KACNiE,OAAO,KACPymJ,iBAAiB,iBACjBC,aAAa,kBAEb,wBACElrF,GAAG,IACHK,GAAG,IACHJ,GAAG,IACHK,GAAG,KACHpqD,MAAO,CAAEsU,OAAQ,wBAAyBi2C,YAAa,QAI7D,0BAAQqkB,GAAG,IAAIC,GAAG,IAAI14D,EAAGhF,EAAQlR,KAAK,YACtC,0BAAQ2uE,GAAG,IAAIC,GAAG,IAAI14D,EAAGhF,EAAQlR,KAAK,wBACtC,wBACE4tB,EAAE,IACFC,EAAE,IACF1tB,UAAU,iBACV2tE,iBAAiB,SACjBD,WAAW,UALb,iBASA,0BACEhtE,UAAWU,EAAQu1B,KACnB92B,KAAK,OACLsqD,YAAY,IACZ0qF,cAAc,QACdrmE,GAAG,IACHC,GAAG,IACH14D,EAAE,QArCQ,SCvEP,cAAmB,IAAhB5F,EAAgB,EAAhBA,UACVpJ,EAAQoJ,EAAd,SACQjQ,EAAeiQ,EAFS,uCAGxBhe,EAAage,EAHW,uBAK1BlQ,EAAYC,EAAW,CAC3BqnG,aAD2B,GAE3ButC,gBAF2B,GAG3BC,UAAW,KA4Db,OAxDqB5iJ,GACnB,YAKM,QAJJtI,MACiBknB,EAGb,EAHFza,YAAeya,OACff,EAEE,EAFFA,MAGI5O,EAAUnB,IAChB,OACE,qBAAGS,UAAWU,EAAQmmG,cACpB,4BACE,2BACEx5G,GADF,gBAEE9D,MAFF,KAGEiE,OAHF,KAIEymJ,iBAJF,iBAKEC,aAAa,kBAEb,wBACElrF,GADF,IAEEK,GAFF,IAGEJ,GAHF,IAIEK,GAJF,KAKEpqD,MAAO,CAAEsU,OAAF,oBAA+Bi2C,YAAa,QAIzD,0BACEzpD,UAAWU,EADb,gBAEEotE,GAFF,IAGEC,GAHF,IAIE14D,EAJF,EAKElW,KAAK,YAEP,0BACEa,UAAWU,EADb,aAEEotE,GAFF,IAGEC,GAHF,IAIE14D,EAJF,EAKElW,KAAK,wBAEP,wBACEa,UAAWU,EADb,UAEEqsB,EAFF,IAGEC,EAHF,IAIE1tB,UAJF,iBAKE2tE,iBALF,SAMED,WAAW,UAEV/4D,OAzCP,SCpBS,cAAmB,IAAhBxE,EAAgB,EAAhBA,UACVpJ,EAAQoJ,EAAd,SACQtF,EAAYsF,EAFY,2BAGxB9O,EAAsB0F,EAHE,UAGb5F,EAAW4F,EAHE,SAIeoJ,EAJf,cAIxBhe,EAJwB,0BAKYge,EALZ,cAKxBi8G,EALwB,yBAKAE,EALA,UAMxBD,EAAQl8G,EANgB,0BA2DhC,OAAOhe,GAnDP,YAAwC,IAATtI,EAAS,EAATA,MACrBsE,EAAwDtE,EAD1B,KACxB6hB,EAAkD7hB,EAD1B,KAClBq/B,EAA4Cr/B,EAD1B,OACVyM,EAAoCzM,EAD1B,YACG2qE,EAAuB3qE,EAD1B,mBAGhCoiI,EAAmB9qH,EAAzB,MAyCA,OAvCAE,GAAU,WACR,IAAM8qH,EAAUF,EAAhB,QA+BA,OA7BME,GAAJ,IACMA,GAAWA,EAAf,YACEA,uBACAC,MAEFD,yBACAA,YANqB,EAUrBE,GAAI,WACF,GAAKxhH,EAAL,IAGA,IAAMmqI,EAAsBjuI,mDAA5B,MAKAslH,GAAI,WACGxhH,EAAL,IAGAyhH,EAAQ0oB,EAAR1oB,WAMD,WACL,GACEF,SAKC,qBAAGtoH,IAAKmoH,QC/CJ,cAAkC,IAA/B/6G,EAA+B,EAA/BA,IAAKC,EAA0B,EAA1BA,KACfpK,EAAQmK,EAAIyL,MAD6B,EAEAzL,EAAI,cAA3C/e,EAFuC,EAEvCA,SAEF8iJ,GAJyC,EAE7B5hJ,UAEF8d,EAAK+jI,IACfC,EAAehkI,EAAKikI,GACpBC,EAAsBlkI,EAAKmkI,GAejC,OAAOnjJ,GAZP,YAA4C,IAAhBiT,EAAgB,EAAhBA,QAC1B,OAAIA,EAAQ4K,MACH,gBAACmlI,EAAD,CAActrJ,MAAOub,IAEzBA,EAAQ8jB,OAGN,gBAACmsH,EAAD,CAAqBxrJ,MAAOub,IAF1B,gBAAC6vI,EAAD,CAASprJ,MAAOub,Q,8DCnBd,cAAmB,IAAhB+K,EAAgB,EAAhBA,UACRra,EAAoBqa,EADI,6CAExBG,EAAsBH,EAFE,wCAGxBwB,EAAexB,EAHS,6EA6BhC,+CAAA/gB,EAAA,iFAEU,IAAIH,MAFd,yCAMIw7B,EAKE7rB,EAXN,aAOIiT,EAIEjT,EAXN,WAQI4sB,EAGE5sB,EAXN,uBASI8rB,EAEE9rB,EAXN,WAUItI,EACEsI,EAXN,wDAcW,CAAEmK,QAASyiB,IAdtB,UAmBK5sB,cAAD,QACCA,aADD,SAECA,qBArBL,gDAuBW,CAAEmK,QAAS,oBAvBtB,UA2BO3U,2BA3BP,yBA4BU,IAAInF,MAAM,YAAV,OACQw7B,EADR,KA5BV,sEAiCkCA,EAAA,kEAG9Bz4B,YApCJ,wBAiCU0Z,EAjCV,OAiCmBvd,EAjCnB,0CAuCS,CAAEud,KAAF,EAAQvd,KAAR,EAAcqmE,mBAAoB/pC,EAAa3lB,iBAvCxD,6CA7BgC,sBAuEhC,MAAO,CAAEywI,mBAlET,YAAkC,MAC1BnwI,EAAN,EACMoF,EAAO8F,EAAb,GACQma,EAA8BrlB,EAHN,aAGV9O,EAAgB8O,EAHN,YAqBhC,MAfU,CACRqlB,aADQ,EAER5Y,WAJqBF,EAJS,cAS9Brb,YAHQ,EAIRo0B,WAAY,CAEVr/B,aAAY,UAAEmf,mBAAF,uBAAEA,EAFJ,aAGVwH,cAAe6Y,WAAWA,eAAezlB,EAH/B,gBAIVqlB,aAAcA,EAJJ,KAKVhW,QAASoW,WAAWA,eAAergB,EALzB,mBAMVwG,iBAAkBxG,EANR,iBAOVsH,UAAWhc,EAPD,GAQVsZ,QARU,OAwDaomI,qBAvEG,kDCsBrBC,EAAwBziJ,QAClCuB,QACC,mBACAs3B,cACA74B,QAAMnJ,MAAM,CACV6rJ,kBAAmB,GACnBrqJ,aAAc2H,QAAM+B,MAAM/B,QAAMS,WAGnC21B,UAAS,WACR,MAAO,CAGLF,QAAQ,EACRC,kBAAct7B,EACdM,UAAMN,EACNkb,QAAS,GACTiH,WAAOniB,EACP2mE,wBAAoB3mE,EACpB0jG,gBAAY1jG,MAGfsG,SAAQ,SAAAC,GAAQ,IACP2Q,EAAkBX,iBAAOhQ,GAAzB2Q,cACFvP,EAAQpB,EACd,MAAO,CACL6c,aADK,SACQ9B,GACX8C,kBAAQ7d,EAAM,eAAgB,CAAE+a,UAAS3Z,QAAOuP,uBAIrD2H,OAAM,SAAAtY,GAAI,MAAK,CACd,uBACE,IAAMuhJ,EAAcrlI,4BAAkBlc,GACnCg+I,aACH,IAAKh+I,EAAKm9F,WACR,OAAOokD,EAGT,IAAM3D,EAASnnH,KAAKC,MAAMD,KAAKE,UAAU4qH,IAczC,OAXA3D,EAAO9mJ,SAAQ,SAAC69C,IACEA,EAAM59C,OAAO2lJ,OACzB/nG,EAAM59C,OAAOspB,QACb,CAACs0B,EAAM59C,SACHD,SAAQ,SAACC,GAAmB,MAC5ByqJ,EAAO,UAAGxhJ,EAAKm9F,kBAAR,aAAG,EAAkBpmG,EAAOG,SACrCsqJ,GAAWzqJ,EAAOG,UAAYsqJ,IAChCzqJ,EAAOG,QAAUsqJ,SAIhB5D,GAGT,kBACE,IAAMxnI,EAAO8F,4BAAkBlc,GAC/B,kCACKgC,+BAAqBhC,IAD1B,IAEEwc,cAAexc,EAAKwc,cACpBC,aAAczc,EACd0c,aAActG,EAAK6iE,SAAWj5E,EAAKshJ,kBACnC3kI,OAAQvG,EAAK6iE,SACbr8D,iBAAkBvjB,KAAKujB,iBACvBC,aAAc7c,EAAK6c,gBAQvB,mBACE,IAAM7L,EAAUhR,EAEVyhJ,EADoBzxI,iBAAOhQ,GAAzB2Q,cAC+B0uB,gBACrCr/B,EAAKk/B,kBAEP,IAAKuiH,EACH,MAAM,IAAI5mJ,MAAJ,oBAAuBmW,EAAQkuB,iBAA/B,gBAER,IAAKuiH,EAAiB/wI,eACpB,MAAM,IAAI7V,MAAJ,mBACQmW,EAAQkuB,iBADhB,qEAIR,OAAOuiH,GAGTC,yBA3Dc,SA2DWtlI,GACvB,SAAUA,aAAoBvjB,MAOhC,wBACE,GAAK4d,kBAAQzW,GAAb,CAGA,IAAMyO,EAAU8O,qBAAWvd,GAC3B,GAAKyO,EAAL,CALsB,IAQd2pB,EAAc3pB,EAAd2pB,UAER,OAAIC,YAAUD,GACLA,EAAUz+B,UADnB,SAMHoG,SAAQ,SAAAC,GAAI,MAAK,CAChB2hJ,cADgB,WAEd3hJ,EAAK80B,QAAS,EACd90B,EAAK2U,QAAU,GACf3U,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,WAAQniB,EACbuG,EAAKogE,wBAAqB3mE,GAE5BmoJ,cATgB,YAoBb,IAVDjtI,EAUC,EAVDA,QACA5a,EASC,EATDA,KACAg7B,EAQC,EARDA,aACAqrC,EAOC,EAPDA,mBAQIzrD,GACF3U,EAAK80B,QAAS,EACd90B,EAAK2U,QAAUA,EACf3U,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,WAAQniB,EACbuG,EAAKogE,wBAAqB3mE,IAE1BuG,EAAK80B,QAAS,EACd90B,EAAK2U,QAAU,GACf3U,EAAK+0B,aAAeA,EACpB/0B,EAAKjG,KAAOA,EACZiG,EAAK4b,WAAQniB,EACbuG,EAAKogE,mBAAqBA,IAG9ByhF,YArCgB,SAqCJjmI,GACVua,QAAQva,MAAMA,GAEd5b,EAAK80B,QAAS,EACd90B,EAAK2U,QAAU,GACf3U,EAAK+0B,kBAAet7B,EACpBuG,EAAKjG,UAAON,EACZuG,EAAK4b,MAAQA,EACb5b,EAAKogE,wBAAqB3mE,GAG5BqoJ,cAhDgB,SAgDF3kD,GACZn9F,EAAKm9F,WAAaA,GAEpBvnE,SAnDgB,SAmDPha,GACP5b,EAAK4b,MAAQA,OAGhB7b,SAAQ,SAAAC,GAAQ,MACWgQ,iBAAOhQ,GAAzB2Q,cAIUoL,UAAUgmI,GAF1BZ,EAHa,EAGbA,mBACAC,EAJa,EAIbA,qBAEF,MAAO,CACLlsH,YADK,WAEHE,gCACEp1B,EACAmhJ,EACAC,EACA,CACE3jJ,KAAM,GAAF,OAAKuC,EAAK6D,KAAV,YAAkB7D,EAAKrG,GAAvB,cAEJ87B,iBAAiB,GAEnBz1B,EAAK2hJ,cACL3hJ,EAAK4hJ,cACL5hJ,EAAK6hJ,aAEPzsH,gCACEp1B,GACA,iBAAO,CACLkX,cAAe/V,gCAAsBnB,EAAKi3B,aAC1C0K,QAAS9jB,kBAAQpc,oBAAUzB,EAAM,GAAI,WACrC+2B,gBAAiBxZ,qBAAWvd,GAAM+2B,mBALjB,uCAQnB,aAAyDn5B,GAAzD,mBAAA5C,EAAA,6DAASkc,EAAT,EAASA,cAAeyqB,EAAxB,EAAwBA,QAAS5K,EAAjC,EAAiCA,gBAAjC,kBACSA,EAAgB2nE,wBACrB/8D,EACAzqB,EAAc,GACd,CAAEtZ,SAAQ8f,UAAWhc,0BAAgB1B,MAJzC,2CARmB,wDAenB,CACEvC,KAAM,GAAF,OAAKuC,EAAK6D,KAAV,YAAkB7D,EAAKrG,GAAvB,qBACJ87B,iBAAiB,IAEnB,eACA,SAAA0nE,GACEn9F,EAAK8hJ,cAAc3kD,MAErB,SAAAvhF,GACEua,QAAQva,MAAMA,GACd5b,EAAK41B,SAASha,WC3OpBomI,EAAyBhmI,8BAC7B,mBACA,CACEa,aAAc,CACZhZ,KAAM,UACNiC,YACE,mEACF+a,cAAc,EACdC,gBAAiB,CAAC,UAAW,QAAS,mBAG1C,CAAE2Q,mBAAoB,cCLHwwH,E,4MACnBxkJ,KAAO,qB,6CAEP,SAAQkT,GACNA,EAAcgtB,aACZ,kBACE,IAAI3S,IAAS,CACXta,eAAgBkS,gBACd,kBAAM,mCAERrG,WAAY0E,EAAkBtQ,GAC9BlT,KAAM,sB,uBAKd,SAAUkT,GACJktB,gCAAsBltB,EAAc8S,YACtC9S,EAAc8S,UAAUqa,gBAAgB,CAAC,OAAQ,OAAQ,CACvDvX,MAAO,gBACP1W,KAAMqyI,IACN1xI,QAAS,SAAC/B,GACRA,EAAQuvB,QAAQ,eAAgB,W,GAtBMnb,M,4MCLjC,WAAAlS,GAAa,OAC1B,0CACsC,CAClChX,GADkC,YAElCkK,KAAMjF,gBAF4B,6BAKlCmV,OAAQnV,sBACN+R,4BADM/R,YANZ,SAUW,SAAAoB,GAAI,MAAK,CAChBmiJ,UADgB,YAEdniJ,iBCXKmc,EAAeH,8BAAoB,4BAAzC,IACM43F,EAAmB71G,oBAAS,YAAe,IAAZtI,EAAY,EAAZA,MAC1C,GAAIA,GAASA,EAAb,OAA2B,CACzB,GAAIA,SAAJ,KACE,gBAAUA,SAAV,kBAEF,GAAIk3B,0BAAgBl3B,EAApB,QAAmC,CACjC,IAAMoO,EAAOgmF,kBAAQp0F,EAArB,QACA,GAAIoO,GAAQA,EAAZ,KACE,gBAAUA,qCAAV,kBAIN,oB,qECDmB20F,E,kDAGnB,WACE/7F,GACA,2BACA,cAAMA,IALEyjB,cAIR,EAEA,IAAMA,EAAWpjB,yBACfL,EACA,YAJF,OAMA,EAAKyjB,SAAWs4E,EAAkB4pD,aAAaliI,GAAY,IAN3D,E,sFAqCF,sCAAAllB,EAAA,sDACQuyB,EAAwB,IAAIpxB,IADpC,cAEoC9C,KAAK6mB,UAFzC,IAEE,2BAAiD,yBAArChpB,EAAqC,KAA5BgpB,EAA4B,KAE/CqN,EAASnxB,IAAIlF,GAIbgpB,EAASppB,SAAQ,SAAAikB,GAEf,IAAMqE,EAAOrE,EAAQvhB,IAAI,QACrB4lB,GAAQA,EAAKloB,SACfq2B,EAASnxB,IAAIgjB,EAAKloB,SAGpB,IAAM2nB,IAAW9D,EAAQvhB,IAAI,SAAW,IAAI6oJ,QAAU,IAAI,GAC1D,GAAe,QAAXxjI,EAAkB,CACpB,IACMC,GADyB/D,EAAQvhB,IAAI,QAAU,IAAI,GACd84D,aAAa7pB,MAAM,KAC9Dlb,EAASnxB,IAAI0iB,EAAa,SACrB,GAAe,QAAXD,EAAkB,CAC3B,IAAMM,IAASpE,EAAQvhB,IAAI,SAAW,IAAI89D,MAAQ,IAAI,GACtD/pC,EAASnxB,IAAI+iB,OAtBrB,uDA0BS7O,MAAM/U,KAAKgyB,IA1BpB,gD,4HA6BA,sBAAAvyB,EAAA,+EACSsV,MAAM/U,KAAKlC,KAAK6mB,SAASnkB,UAAUqC,KAAI,SAAAiuD,GAAY,MAAK,CAC7Dn1D,QAASm1D,EAAa,GAAG7yD,IAAI,WAC7B4kC,QAASiuB,EAAa,GAAG7yD,IAAI,gBAHjC,gD,+EAOA,SAAYzC,GAA0B,WAC5BG,EAAwBH,EAAxBG,QAASE,EAAeL,EAAfK,MAAOE,EAAQP,EAARO,IAExB,OAAOwG,2BAAgB,uCAAU,WAAMC,GAAN,mBAAA/C,EAAA,sDAE/B,IADMklB,EAAW,EAAKA,SAAS1mB,IAAItC,IAAY,GACtCm1B,EAAI,EAAGA,EAAInM,EAAStnB,OAAQyzB,GAAK,GAClChwB,EAAI6jB,EAASmM,IACb7yB,IAAI,OAASpC,GAASiF,EAAE7C,IAAI,SAAWlC,GAC3CyG,EAAS+oC,KAAKzqC,GAGlB0B,EAASovB,WARsB,2CAAV,yD,2BAYzB,e,2BA/EA,SAAoBm1H,GAElB,IADA,IAAMpiI,EAAW,IAAI/mB,IACZkzB,EAAI,EAAGA,EAAIi2H,EAAM1pJ,OAAQyzB,GAAK,EACrC,GAAIi2H,EAAMj2H,GAAI,CACZ,IAAMhwB,EAAIhD,KAAKkpJ,YAAYD,EAAMj2H,IAC3Bn1B,EAAUmF,EAAE7C,IAAI,WAClBgpJ,EAAStiI,EAAS1mB,IAAItC,GACrBsrJ,IACHA,EAAS,GACTtiI,EAASxmB,IAAIxC,EAASsrJ,IAGxBA,EAAOjqJ,KAAK8D,GAZoC,oBAiB1B6jB,EAASnkB,UAjBiB,IAiBpD,2BAA6C,SAC/B4wD,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAExB,IAAI,SAAW60B,EAAE70B,IAAI,aAlBA,8BAqBpD,OAAO0mB,I,yBAGT,SAAmBnmB,GACjB,OAAO,IAAIuE,IAAcvE,O,GAvCkByE,0BCC1BikJ,E,kDAKnB,WACEhmJ,GACA,2BACA,cAAMA,IALAyjB,cAIN,EAEA,IAAMA,EAAWpjB,yBACfL,EACA,YAJF,OAMA,EAAKyjB,SAAWs4E,EAAkB4pD,aAAaliI,GAAY,IAN3D,E,qFAYF,8CAAAllB,EAAA,sDACQqlB,EAAU,GADlB,cAIoChnB,KAAK6mB,UAJzC,IAIE,2BAAiD,0BAArChpB,EAAqC,KAA5BgpB,EAA4B,KAC3CwiI,OAD2C,gBAEzBxiI,GAFyB,IAE/C,2BAAWnF,EAAqB,QAE5B2nI,GACAA,EAAcprJ,KAAOyjB,EAAQvhB,IAAI,UACjCkpJ,EAActrJ,OAAS2jB,EAAQvhB,IAAI,OAEnCkpJ,EAAcprJ,IAAMyjB,EAAQvhB,IAAI,QAE5BkpJ,GACFriI,EAAQ9nB,KAAKmqJ,GAEfA,EAAgB,CACdxrJ,UACAE,MAAO2jB,EAAQvhB,IAAI,SACnBlC,IAAKyjB,EAAQvhB,IAAI,SAhBwB,8BAoB3CkpJ,GACFriI,EAAQ9nB,KAAKmqJ,IAzBnB,qCA8BEriI,EAAQssC,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAE9D,QAAQ21D,cAAcx+B,EAAEn3B,YA9BnD,kBAgCSmpB,GAhCT,gD,iFAmCA,gB,GArDQkM,e,oCCbWo2H,E,iKAMnB,SAAY5rJ,GAA0B,WAK9B6rJ,EAAmB,yDACzB,OAAO9kJ,2BAAgB,uCAAU,WAAMC,GAAN,iBAAA/C,EAAA,sEACX4nJ,EACjB9kI,KAAK,EAAM/mB,GACXmH,KAAKspC,eACLC,YAJ4B,OACzBja,EADyB,OAKzBka,EAAOla,EAAM,GACnBzvB,EAAS+oC,KACP,IAAIxoC,IAAJ,2BACKopC,EAAKptC,UADV,IAEE6jC,SAAU,GAAF,OAAKuJ,EAAK/tC,KAAV,YAAkB5C,EAAOK,MAAzB,YAAkCL,EAAOO,KACjDA,IAAKP,EAAOO,IACZF,MAAOL,EAAOK,MACdgxC,IAAKV,EACFluC,IAAI,OACJm7C,MACCl+C,KAAKuB,IAAIjB,EAAOK,MAAQswC,EAAKluC,IAAI,SAAU,GAC3C/C,KAAKuB,IAAIjB,EAAOO,IAAMowC,EAAKluC,IAAI,SAAU,QAKjDuE,EAASovB,WArBsB,2CAAV,yD,+DA4BzB,8CAAAnyB,EAAA,sDACQqlB,EAAU,GADlB,cAIoChnB,KAAK6mB,UAJzC,IAIE,2BAAiD,0BAArChpB,EAAqC,KAA5BgpB,EAA4B,KAC3CwiI,OAD2C,gBAEzBxiI,GAFyB,IAE/C,2BAAWnF,EAAqB,QAE5B2nI,GACAA,EAAcprJ,KAAOyjB,EAAQvhB,IAAI,UACjCkpJ,EAActrJ,OAAS2jB,EAAQvhB,IAAI,OAEnCkpJ,EAAcprJ,IAAMyjB,EAAQvhB,IAAI,QAE5BkpJ,GACFriI,EAAQ9nB,KAAKmqJ,GAEfA,EAAgB,CACdxrJ,UACAE,MAAO2jB,EAAQvhB,IAAI,SACnBlC,IAAKyjB,EAAQvhB,IAAI,SAhBwB,8BAoB3CkpJ,GACFriI,EAAQ9nB,KAAKmqJ,IAzBnB,qCA8BEriI,EAAQssC,MAAK,SAAC3xD,EAAGqzB,GAAJ,OAAUrzB,EAAE9D,QAAQ21D,cAAcx+B,EAAEn3B,YA9BnD,kBAgCSmpB,GAhCT,gD,iFAwCA,gB,GAhFqDm4E,GCJ1Cr8E,EAAeH,8BAC1B,oBACA,CACEkE,SAAU,CACRrc,KAAM,SACNgd,aAAc,IAEhBgiI,aAAc,CACZh/I,KAAM,SACNgd,aAAc,kBAGlB,CAAEvE,iBAAiB,IAGRwmI,EAAsB9mI,8BACjC,2BACA,CACEkE,SAAU,CACRrc,KAAM,SACNgd,aAAc,IAEhBgiI,aAAc,CACZh/I,KAAM,SACNgd,aAAc,kBAGlB,CAAEvE,iBAAiB,IAGRymI,EAAuB/mI,8BAClC,4BACA,CACEkE,SAAU,CACRrc,KAAM,SACNgd,aAAc,IAEhBgiI,aAAc,CACZh/I,KAAM,SACNgd,aAAc,kBAGlB,CAAEvE,iBAAiB,I,kBChCA0mI,E,kDAOnB,WAAYvmJ,GAA0D,kCACpE,cAAMA,IALAiG,cAI8D,IAF9DugJ,aAE8D,EAEpE,EAAKvgJ,SAAW7F,uBAAaC,yBAAeL,EAAQ,aACpD,EAAKwmJ,QAAU,EAAKC,kBAHgD,E,0FAMtE,oGACyB7pJ,KAAKqJ,SAASmgC,SAAS,QADhD,cACQ6Q,EADR,yBAESA,EACJm5B,OACApkC,MAAM,MACNrqC,KAAI,SAAC0rE,GAAgB,MACUA,EAAIrhC,MAAM,MADpB,iBAEpB,MAAO,CAAEvxC,QAFW,KAEFknC,QAFE,gBAL1B,gD,qFAWA,WACE,OAAO/kC,KAAK4pJ,U,kEAGd,sBAAAjoJ,EAAA,0F,2DA3BQuxB,eCXKvQ,gCACb,sBACA,CACEtZ,SAAU,CACRmB,KAAM,eACNgd,aAAc,CAAEpgB,IAAK,6BAGzB,CAAE6b,iBAAiB,ICaf6mI,G,OAA+BvgI,gBACnC,kBAAM,0D,8MAINnlB,KAAO,sB,6CAEP,SAAQkT,GACNA,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,oBACN0e,aAAcinI,EACdz5G,aAAc05G,OAGpB1yI,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,2BACN0e,aAAcmnI,EACd35G,aAAc45G,OAGpB5yI,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,4BACN0e,aAAcqnI,EACd75G,aAAc85G,OAGpB9yI,EAAc2Q,gBACZ,kBACE,IAAIC,IAAY,CACd9jB,KAAM,sBACN0e,aAAcunI,EACd/5G,aAAcg6G,OAIpBhzI,EAAc4R,eAAc,WAC1B,OAAO,IAAIC,IAAW,CACpB/kB,KAAM,4BACNm2G,iBAAkBgwC,EAClBznI,aAAc0nI,EACdtnI,WAAYunI,EAAqCnzI,GACjDD,eAAgByyI,W,GA3CKtgI,M,yJCbRuc,E,kDAOnB,WAAYsK,GAKT,MAMD,GANC,qBACD,cAAMA,IAZRh5B,oBAWG,IATHyL,kBASG,IAPHxL,mBAOG,EAED,EAAKD,eAAiBg5B,EAAMh5B,eAC5B,EAAKyL,aAAeutB,EAAMvtB,aAC1B,EAAKxL,cAAgB+4B,EAAM/4B,eAEtB,EAAKD,eACR,MAAM,IAAI7V,MAAJ,iDAAoD,EAAK4C,OAEjE,IAAKosC,0BAAgB,EAAK1tB,cAActY,KACtC,MAAM,IAAIhJ,MAAJ,UACD,EAAK4C,KADJ,0BAC0B,EAAK0e,aAAa1e,KAD5C,4BAIR,IAAK,EAAKkT,cACR,MAAM,IAAI9V,MAAJ,iDAAoD,EAAK4C,OAfhE,S,iFAmBH,WAAa+M,GAAb,SAAAxP,EAAA,+EACS,CACL+5B,aAAcpiB,IAAM6+B,cAAcn4C,KAAKqX,eAAgBlG,EAAO,QAFlE,gD,kFAUA,WACE,OAAO,M,UA1C+Bo/B,I,wKCFnC,SAAS4Q,EACdupG,GAEA,6DADsC,GAApC/oI,EACF,EADEA,QAASpd,EACX,EADWA,OAAQH,EACnB,EADmBA,KAEnB,OAAO,IAAIkwB,SAAQ,SAACgX,EAASC,GAC3B,IAKIrwB,EALAmgH,GAAW,EAETsvB,EAAcC,eAASF,GAIzBG,EAAgB,aAChBlpI,IACFzG,EAAYC,YAAW,WAChBkgH,IACHA,GAAW,EACXsvB,EAAYG,SACZv/G,EAAO,IAAI/pC,MAAJ,gCAAmC4C,GAAQ,oBAEnDud,GACHkpI,EAAgB,kBAAM3vI,GAAaE,aAAaF,KAI9C3W,GACFA,EAAO6P,iBAAiB,SAAS,WAC1BinH,IACHA,GAAW,EAGXsvB,EAAYG,SACZD,IAEAt/G,EAAOg0F,mBAKborB,EACGtiI,MAAK,WACCgzG,IACHA,GAAW,EACXwvB,IAEAv/G,QAGH/N,OAAM,SAAAoN,GACA0wF,IACHA,GAAW,EACXwvB,IAEAt/G,EAAOZ,UAWV,SAAeogH,EAAtB,kC,4CAAO,WACLL,GADK,2BAAA/oJ,EAAA,6DAEL+B,EAFK,+BAEY,GAFZ,SAICy9C,GAAK,WACT,IAAMpjC,EAAM2sI,IACZ,YAAetqJ,IAAR2d,GAA6B,OAARA,IAC3Bra,GAPE,gCASEgnJ,KATF,4C,yDC3EP,uBAQe,eACb,IAAM57G,EAAI,IAAIgG,IAAKk2G,KAuGnB,OAlGAl8G,EAAEm8G,YAAY,OAAO,SAACvpI,EAAkBhhB,GACtC,OAAOghB,EAAQvhB,IAAIO,MAGrBouC,EAAEm8G,YAAY,MAAM,SAACvpI,GACnB,OAAOA,EAAQphB,QAKjBwuC,EAAEm8G,YAAY,QAAQ,SAAC1zH,GACrB,OAAOA,KAITuX,EAAEm8G,YAAY,OAAO,SAAC51H,GAGpB,OADAyH,QAAQ0hB,IAAInpB,GACLA,KAKTyZ,EAAEm8G,YAAY,MAAO7tJ,KAAKuB,KAC1BmwC,EAAEm8G,YAAY,MAAO7tJ,KAAKwB,KAC1BkwC,EAAEm8G,YAAY,OAAQ7tJ,KAAK6iG,MAC3BnxD,EAAEm8G,YAAY,OAAQ7tJ,KAAKC,MAC3ByxC,EAAEm8G,YAAY,QAAS7tJ,KAAKiB,OAC5BywC,EAAEm8G,YAAY,QAAS7tJ,KAAK66C,OAC5BnJ,EAAEm8G,YAAY,MAAO7tJ,KAAKshD,KAC1B5P,EAAEm8G,YAAY,WAAY/yH,OAAOtS,UAGjCkpB,EAAEm8G,YAAY,SAAS,SAACvoF,EAAawoF,GAAd,OAA+BxoF,EAAItzB,MAAM87G,MAChEp8G,EAAEm8G,YAAY,UAAU,SAACvoF,EAAa/4D,GAAd,OAAgC+4D,EAAIpQ,OAAO3oD,MACnEmlC,EAAEm8G,YAAY,cAAc,SAACvoF,EAAa/4D,GAAd,OAC1B+4D,EAAIrzB,WAAW1lC,MAEjBmlC,EAAEm8G,YAAY,eAAe,SAACvoF,EAAaluD,GAAd,OAC3BkuD,EAAIyoF,YAAY32I,MAElBs6B,EAAEm8G,YACA,cACA,SAACvoF,EAAa0oF,EAAmB7rJ,GAAjC,OACEmjE,EAAIz5B,WAAWmiH,EAAW7rJ,MAE9BuvC,EAAEm8G,YACA,YACA,SAACvoF,EAAa0oF,EAAmB7rJ,GAAjC,OACEmjE,EAAIp4D,SAAS8gJ,EAAW7rJ,MAE5BuvC,EAAEm8G,YACA,UACA,SAACvoF,EAAa2oF,EAAsBC,GAApC,OACE5oF,EAAI6oF,OAAOF,EAAcC,MAE7Bx8G,EAAEm8G,YACA,YACA,SAACvoF,EAAa2oF,EAAsBG,GAApC,OACE9oF,EAAI+oF,SAASJ,EAAcG,MAE/B18G,EAAEm8G,YAAY,UAAU,SAACvoF,EAAatvB,GAAd,OAAgCsvB,EAAI+0E,OAAOrkG,MACnEtE,EAAEm8G,YAAY,WAAW,SAACvoF,EAAawM,EAAew8E,GAA7B,OACvBhpF,EAAIvN,QAAQ+Z,EAAOw8E,MAErB58G,EAAEm8G,YAAY,cAAc,SAACvoF,EAAawM,EAAew8E,GAA7B,OAC1BhpF,EAAIipF,WAAWz8E,EAAOw8E,MAExB58G,EAAEm8G,YACA,SACA,SAACvoF,EAAa3kE,EAAeE,GAA7B,OACEykE,EAAIpnB,MAAMv9C,EAAOE,MAErB6wC,EAAEm8G,YACA,cACA,SAACvoF,EAAa0oF,EAAmBvpJ,GAAjC,OACE6gE,EAAIz5B,WAAWmiH,EAAWvpJ,MAE9BitC,EAAEm8G,YACA,aACA,SAACvoF,EAAa3kE,EAAeE,GAA7B,OACEykE,EAAIu7C,UAAUlgH,EAAOE,MAEzB6wC,EAAEm8G,YAAY,eAAe,SAACvoF,GAAD,OAAiBA,EAAIt3C,iBAClD0jB,EAAEm8G,YAAY,eAAe,SAACvoF,GAAD,OAAiBA,EAAIr4D,iBAClDykC,EAAEm8G,YAAY,QAAQ,SAACvoF,GACrBA,EAAI8Q,UAEN1kC,EAAEm8G,YAAY,WAAW,SAACvoF,GAAD,OAAiBA,EAAI2rE,aAC9Cv/F,EAAEm8G,YAAY,aAAa,SAACvoF,GAAD,OAAiBA,EAAIkpF,eAEhD98G,EAAEm8G,YAAY,UAAU,SAACvpI,EAAkBghD,GACzC,IAAM7R,EAAOnvC,EAAQvhB,IAAI,QACzB,OAAO0wD,EAAOA,EAAK6R,GAAOhhD,EAAQvhB,IAAIuiE,MAGxC5zB,EAAE+8G,YAAY,IAAK,IAAI,SAAClqJ,EAAWqzB,GAAZ,OAA0BrzB,EAAIqzB,KAE9C8Z,I,qLClFF,SAASg9G,EACdC,EACAC,EACA1tH,GAEQ,IAIJ2tH,EALJC,EACQ,wDACR,OAAU,IAAN5tH,EACK,GAGL4tH,EACFD,EAAWD,EAAa1tH,EAAKytH,EAAMA,GAAQztH,EAAIA,IAG/C2tH,EAAWD,EAAcD,EAAMA,EAAOztH,EAClCA,EAAI,IACN2tH,GAAY3tH,EAAI,IAIb2tH,EAAW,EAAI,EAAI7uJ,KAAK6iG,KAAKgsD,IAO/B,SAAS5nJ,EAAaqwB,GAC3B,kCACKA,GADL,IAEEusB,WAAYvsB,EAAEK,UAAY,IAAML,EAAEQ,cAAgBR,EAAES,cAAgB,GACpE+rB,YAAa4qG,EACXp3H,EAAEK,SACFL,EAAEO,gBACFP,EAAEQ,cAAgBR,EAAES,cAEtBg3H,gBAAiBz3H,EAAEQ,cAAgB,GAAKR,EAAES,eA6CvC,SAAef,EAAtB,oC,4CAAO,WACL12B,EACAmpB,GAFK,6BAAAllB,EAAA,6DAIG5D,EAAeL,EAAfK,MAAOE,EAAQP,EAARO,IAJV,SAYK4oB,EACPhiB,KACC8vB,aACE,SACEy3H,EAOAppJ,GAEA,IAAM0qC,EAAQ1qC,EAAE7C,IAAI,SAapB,OAZAisJ,EAAK33H,SAAWr3B,KAAKuB,IACnBytJ,EAAK33H,SACLzxB,EAAE7C,IAAI,WAAa6C,EAAE7C,IAAI,YAAcutC,GAEzC0+G,EAAKt3H,SAAW13B,KAAKwB,IACnBwtJ,EAAKt3H,SACL9xB,EAAE7C,IAAI,WAAa6C,EAAE7C,IAAI,YAAcutC,GAEzC0+G,EAAKr3H,UAAY2Y,EACjB0+G,EAAKn3H,iBAAmByY,EAAQA,EAChC0+G,EAAKl3H,cAAgB,EAEdk3H,IAET,CACEt3H,SAAUoD,OAAOC,UACjB1D,SAAUyD,OAAO0jB,UACjB7mB,SAAU,EACVE,gBAAiB,EACjBC,aAAc,KAInBkZ,YAjDE,uBAOHtZ,EAPG,EAOHA,SACAL,EARG,EAQHA,SACAM,EATG,EASHA,SACAE,EAVG,EAUHA,gBACAC,EAXG,EAWHA,aAXG,kBAmDE7wB,EAAa,CAClBowB,WACAK,WACAC,WACAE,kBACAC,eACAC,aAAcl3B,EAAMF,EAAQ,KAzDzB,6C,sBA6DA,SAASs2B,IACd,MAAO,CACLS,SAAU,EACVL,SAAU,EACVwsB,UAAW,EACXC,YAAa,EACbnsB,SAAU,EACVE,gBAAiB,EACjBC,aAAc,EACdi3H,eAAgB,EAChBh3H,aAAc","file":"static/js/16.35b627f9.chunk.js","sourcesContent":["import { assembleLocString } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Region } from './types'\n\nexport interface Base1DViewModel {\n  offsetPx: number\n  width: number\n  displayedRegions: Region[]\n  bpPerPx: number\n  minimumBlockWidth: number\n  interRegionPaddingWidth: number\n}\n\nexport default function calculateStaticBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n  extra = 0,\n\n  // on the main thread, window.innerWidth is used because this reduces\n  // recalculating the blocks, otherwise, model.width for cases such as\n  // off-main-thread. also this is not a ternary because our window.innerWidth\n  // might be undefined on off-main-thread, so instead use || model.width\n  width = (typeof window !== 'undefined' && window.innerWidth) || model.width,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  const windowLeftBp = offsetPx * bpPerPx\n  const windowRightBp = (offsetPx + width) * bpPerPx\n  const blockSizePx = width\n  const blockSizeBp = Math.ceil(blockSizePx * bpPerPx)\n  // for each displayed region\n  let regionBpOffset = 0\n  const blocks = new BlockSet()\n  displayedRegions.forEach((region, regionNumber) => {\n    // find the block numbers of the left and right window sides,\n    // clamp those to the region range, and then make blocks for that range\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const regionBlockCount = Math.ceil((regionEnd - regionStart) / blockSizeBp)\n\n    let windowRightBlockNum =\n      Math.floor((windowRightBp - regionBpOffset) / blockSizeBp) + extra\n    if (windowRightBlockNum >= regionBlockCount) {\n      windowRightBlockNum = regionBlockCount - 1\n    }\n\n    let windowLeftBlockNum =\n      Math.floor((windowLeftBp - regionBpOffset) / blockSizeBp) - extra\n    if (windowLeftBlockNum < 0) {\n      windowLeftBlockNum = 0\n    }\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    for (\n      let blockNum = windowLeftBlockNum;\n      blockNum <= windowRightBlockNum;\n      blockNum += 1\n    ) {\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      if (reversed) {\n        start = Math.max(regionStart, regionEnd - (blockNum + 1) * blockSizeBp)\n        end = regionEnd - blockNum * blockSizeBp\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n      } else {\n        start = regionStart + blockNum * blockSizeBp\n        end = Math.min(regionEnd, regionStart + (blockNum + 1) * blockSizeBp)\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: (regionBpOffset + blockNum * blockSizeBp) / bpPerPx,\n        parentRegion: region,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocString(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && regionNumber === 0 && blockNum === 0) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: width,\n            offsetPx: blockData.offsetPx - width,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n        }\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    regionBpOffset += regionEnd - regionStart\n  })\n  return blocks\n}\n","import FeatureRenderer from './FeatureRendererType'\n\nexport default class CircularChordRendererType extends FeatureRenderer {}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BaseLayout, SerializedLayout } from './BaseLayout'\n\nexport default class MultiLayout<SUB_LAYOUT_CLASS extends BaseLayout<T>, T> {\n  subLayouts: Map<string, SUB_LAYOUT_CLASS> = new Map()\n\n  SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS\n\n  subLayoutConstructorArgs: Record<string, any> = {}\n\n  /**\n   * layout class that just keeps a number of named sub-layouts.\n   * basically just a fancier\n   * `{ layout1: new GranularRectLayout(), layout2: new GranularRectLayout() ...}`\n   */\n  constructor(\n    SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS,\n    layoutArgs: Record<string, any> = {},\n  ) {\n    this.subLayouts = new Map()\n    this.SubLayoutClass = SubLayoutClass\n    this.subLayoutConstructorArgs = layoutArgs\n  }\n\n  getSublayout(layoutName: string): SUB_LAYOUT_CLASS {\n    let subLayout = this.subLayouts.get(layoutName)\n    if (subLayout === undefined) {\n      subLayout = new this.SubLayoutClass(this.subLayoutConstructorArgs)\n      this.subLayouts.set(layoutName, subLayout)\n      return subLayout\n    }\n\n    return subLayout\n  }\n\n  addRect(\n    layoutName: string,\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data: Record<string, T> = {},\n  ) {\n    return this.getSublayout(layoutName).addRect(id, left, right, height, data)\n  }\n\n  discardRange(layoutName: string, left: number, right: number) {\n    const layout = this.subLayouts.get(layoutName)\n    return layout && layout.discardRange(left, right)\n  }\n\n  toJSON() {\n    const data: Record<string, SerializedLayout> = {}\n    for (const [layoutName, sublayout] of this.subLayouts.entries()) {\n      data[layoutName] = sublayout.toJSON()\n    }\n    return data\n  }\n}\n","import { GenericFilehandle, FilehandleOptions } from 'generic-filehandle'\n\ndeclare global {\n  interface Window {\n    electron?: import('electron').AllElectron\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst { electron } = typeof window !== 'undefined' ? window : ({} as any)\n\ntype PathLike = import('fs').PathLike\ntype Stats = import('fs').Stats\n\nexport default class ElectronLocalFile implements GenericFilehandle {\n  private filename: PathLike\n\n  private fd?: Promise<number>\n\n  private ipcRenderer: import('electron').IpcRenderer\n\n  constructor(source: PathLike) {\n    let ipcRenderer\n    if (electron) {\n      ipcRenderer = electron.ipcRenderer\n    }\n    if (!ipcRenderer) {\n      throw new Error(\n        'Cannot use ElectronLocalFile without ipcRenderer from electron',\n      )\n    }\n    this.ipcRenderer = ipcRenderer\n    this.filename = source\n  }\n\n  private async getFd(): Promise<number> {\n    if (!this.filename) {\n      throw new Error('no file path specified')\n    }\n    if (!this.fd) {\n      this.fd = this.ipcRenderer.invoke('open', this.filename, 'r') as Promise<\n        number\n      >\n    }\n    return this.fd\n  }\n\n  async read(\n    buffer: Buffer,\n    offset = 0,\n    length: number,\n    position = 0,\n  ): Promise<{ buffer: Buffer; bytesRead: number }> {\n    const fetchLength = Math.min(buffer.length - offset, length)\n    const fd = await this.getFd()\n    const res = (await this.ipcRenderer.invoke(\n      'read',\n      fd,\n      buffer,\n      offset,\n      fetchLength,\n      position,\n    )) as { buffer: Buffer; bytesRead: number }\n    // TODO: This looks like a buffer, but fails Buffer.isBuffer(), so we have\n    // to coerce it. Why?\n    res.buffer = Buffer.from(res.buffer)\n    // Copy into input buffer to match node's fs.promises.read() behavior.\n    res.buffer.copy(buffer)\n    return res\n  }\n\n  async readFile(_: FilehandleOptions = {}): Promise<Buffer | string> {\n    if (!this.filename) {\n      throw new Error('no file path specified')\n    }\n\n    const result = await this.ipcRenderer.invoke('readFile', this.filename)\n\n    return result.byteLength !== undefined ? Buffer.from(result) : result\n  }\n\n  // todo memoize\n  async stat(): Promise<Stats> {\n    return this.ipcRenderer.invoke('stat', await this.getFd()) as Promise<Stats>\n  }\n}\n","// takes an array or Map or Set (anything iterable with values()) of Maps\n// and lets you query them as one Map\nexport default class CompositeMap<T, U> {\n  private submaps: Map<T, U>[]\n\n  constructor(submaps: Map<T, U>[]) {\n    this.submaps = submaps\n  }\n\n  has(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return true\n      }\n    }\n    return false\n  }\n\n  get(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return submap.get(id)\n      }\n    }\n    return undefined\n  }\n\n  *values() {\n    for (const key of this.keys()) {\n      yield this.get(key) as U\n    }\n  }\n\n  *keys() {\n    const keys = new Set<T>()\n    for (const submap of this.submaps.values()) {\n      for (const key of submap.keys()) {\n        keys.add(key)\n      }\n    }\n    for (const key of keys) {\n      yield key\n    }\n  }\n\n  find<V>(f: (arg0: U) => V) {\n    for (const submap of this.submaps.values()) {\n      for (const value of submap.values()) {\n        const found = f(value)\n        if (found) {\n          return value\n        }\n      }\n    }\n    return undefined\n  }\n\n  *[Symbol.iterator]() {\n    for (const key of this.keys()) {\n      yield [key, this.get(key)]\n    }\n  }\n\n  *entries() {\n    for (const k of this.keys()) {\n      yield [k, this.get(k)]\n    }\n  }\n}\n","import { BigWig, Feature as BBIFeature } from '@gmod/bbi'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { map, mergeAll } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { rectifyStats, UnrectifiedFeatureStats } from '@jbrowse/core/util/stats'\n\nimport configSchema from './configSchema'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nexport default class BigWigAdapter extends BaseFeatureDataAdapter {\n  private bigwig: BigWig\n\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  public constructor(config: Instance<typeof configSchema>) {\n    super(config)\n    this.bigwig = new BigWig({\n      filehandle: openLocation(readConfObject(config, 'bigWigLocation')),\n    })\n  }\n\n  private async setup(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    statusCallback('Downloading bigwig header')\n    const result = await this.bigwig.getHeader(opts)\n    statusCallback('')\n    return result\n  }\n\n  public async getRefNames(opts?: BaseOptions) {\n    const header = await this.setup(opts)\n    return Object.keys(header.refsByName)\n  }\n\n  public async refIdToName(refId: number) {\n    const h = await this.setup()\n    return (h.refsByNumber[refId] || { name: undefined }).name\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const header = await this.setup(opts)\n    return rectifyStats(header.totalSummary as UnrectifiedFeatureStats)\n  }\n\n  public getFeatures(region: NoAssemblyRegion, opts: WiggleOptions = {}) {\n    const { refName, start, end } = region\n    const {\n      bpPerPx = 0,\n      signal,\n      resolution = 1,\n      statusCallback = () => {},\n    } = opts\n    return ObservableCreate<Feature>(async observer => {\n      statusCallback('Downloading bigwig data')\n      const ob = await this.bigwig.getFeatureStream(refName, start, end, {\n        ...opts,\n        basesPerSpan: bpPerPx / resolution,\n      })\n      ob.pipe(\n        mergeAll(),\n        map((record: BBIFeature) => {\n          return new SimpleFeature({\n            id: `${refName}:${record.start}-${record.end}`,\n            data: { ...record, refName },\n          })\n        }),\n      ).subscribe(observer)\n    }, signal)\n  }\n\n  public freeResources(): void {}\n}\nconst adapterCapabilities = BigWigAdapter.capabilities\nexport { adapterCapabilities }\n","import shortid from 'shortid'\nimport { types } from 'mobx-state-tree'\nimport propTypes from 'prop-types'\nimport { PropTypes as MxPropTypes } from 'mobx-react'\n\nexport const ElementId = types.optional(types.identifier, shortid.generate)\n\n// PropTypes that are useful when working with instances of these in react components\nexport const PropTypes = {\n  Region: propTypes.shape({\n    refName: propTypes.string.isRequired,\n    start: propTypes.number.isRequired,\n    end: propTypes.number.isRequired,\n  }),\n  ConfigSchema: MxPropTypes.objectOrObservableObject,\n  Feature: propTypes.shape({\n    get: propTypes.func.isRequired,\n    id: propTypes.func.isRequired,\n  }),\n}\n\nexport const NoAssemblyRegion = types\n  .model('NoAssemblyRegion', {\n    refName: types.string,\n    start: types.number,\n    end: types.number,\n    reversed: types.optional(types.boolean, false),\n  })\n  .actions(self => ({\n    setRefName(newRefName: string): void {\n      self.refName = newRefName\n    },\n  }))\n\nexport const Region = types.compose(\n  'Region',\n  NoAssemblyRegion,\n  types.model({\n    assemblyName: types.string,\n  }),\n)\n\nexport const LocalPathLocation = types.model('LocalPathLocation', {\n  localPath: types.string, // TODO: refine\n})\n\nexport const BlobLocation = types.model('BlobLocation', {\n  name: types.string, // TODO: refine\n  blobId: types.string,\n})\n\nexport const UriLocationRaw = types.model('UriLocation', {\n  uri: types.string, // TODO: refine\n  baseUri: types.maybe(types.string),\n})\n\nexport const UriLocation = types.snapshotProcessor(UriLocationRaw, {\n  postProcessor: snap => {\n    const { baseUri, ...rest } = snap\n    if (!baseUri) {\n      return rest\n    }\n    return snap\n  },\n})\n\nexport const FileLocation = types.union(\n  LocalPathLocation,\n  UriLocation,\n  BlobLocation,\n)\n","import { getParent, isRoot, IAnyStateTreeNode } from 'mobx-state-tree'\nimport { objectHash } from './index'\nimport { PreFileLocation, FileLocation } from './types'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\nimport { readConfObject } from '../configuration'\n\n/* utility functions for use by track models and so forth */\n\nexport function getTrackAssemblyNames(\n  track: IAnyStateTreeNode & { configuration: AnyConfigurationModel },\n) {\n  const trackConf = track.configuration\n  const trackAssemblyNames = readConfObject(trackConf, 'assemblyNames')\n  if (!trackAssemblyNames) {\n    // Check if it's an assembly sequence track\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parent = getParent<any>(track.configuration)\n    if ('sequence' in parent) {\n      return [readConfObject(parent, 'name')]\n    }\n  }\n  return trackAssemblyNames as string[]\n}\n\n/** return the rpcSessionId of the highest parent node in the tree that has an rpcSessionId */\n\nexport function getRpcSessionId(thisNode: IAnyStateTreeNode) {\n  interface NodeWithRpcSessionId extends IAnyStateTreeNode {\n    rpcSessionId: string\n  }\n  let highestRpcSessionId\n  for (let node = thisNode; !isRoot(node); node = getParent(node)) {\n    if ('rpcSessionId' in node) {\n      highestRpcSessionId = (node as NodeWithRpcSessionId).rpcSessionId\n    }\n  }\n  if (!highestRpcSessionId) {\n    throw new Error(\n      'getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute',\n    )\n  }\n  return highestRpcSessionId\n}\n\n/**\n * given an MST node, get the renderprops of the first parent container that has\n * renderProps\n * @param node -\n * @returns renderprops, or empty object if none found\n */\nexport function getParentRenderProps(node: IAnyStateTreeNode) {\n  for (\n    let currentNode = getParent(node);\n    !isRoot(currentNode);\n    currentNode = getParent(currentNode)\n  ) {\n    if ('renderProps' in currentNode) {\n      return currentNode.renderProps\n    }\n  }\n\n  return {}\n}\n\nexport const UNKNOWN = 'UNKNOWN'\nexport const UNSUPPORTED = 'UNSUPPORTED'\n\nlet blobMap: { [key: string]: File } = {}\n\n// get a specific blob\nexport function getBlob(id: string) {\n  return blobMap[id]\n}\n\n// used to export entire context to webworker\nexport function getBlobMap() {\n  return blobMap\n}\n\n// used in new contexts like webworkers\nexport function setBlobMap(map: { [key: string]: File }) {\n  blobMap = map\n}\n\n// blob files are stored in a global map\nexport function storeBlobLocation(location: PreFileLocation) {\n  if (location && 'blob' in location) {\n    // possibly we should be more clear about when this is not undefined, and\n    // also allow mix of blob and url for index and file\n    // @ts-ignore\n    const blobId = `b${+Date.now()}`\n    blobMap[blobId] = location.blob\n    return { name: location?.blob.name, blobId }\n  }\n  return location\n}\n\nexport function guessAdapter(\n  file: FileLocation,\n  index: FileLocation | undefined,\n  getFileName: (f: FileLocation) => string,\n  adapterHint?: string,\n) {\n  function makeIndex(location: FileLocation, suffix: string) {\n    if ('uri' in location) {\n      return { uri: location.uri + suffix }\n    }\n    if ('localPath' in location) {\n      return { localPath: location.localPath + suffix }\n    }\n    return location\n  }\n\n  const fileName = getFileName(file)\n  const indexName = index && getFileName(index)\n  function makeIndexType(\n    name: string | undefined,\n    typeA: string,\n    typeB: string,\n  ) {\n    return name?.toUpperCase().endsWith(typeA) ? typeA : typeB\n  }\n\n  if (/\\.bam$/i.test(fileName) || adapterHint === 'BamAdapter') {\n    return {\n      type: 'BamAdapter',\n      bamLocation: file,\n      index: {\n        location: index || makeIndex(file, '.bai'),\n        indexType: makeIndexType(indexName, 'CSI', 'BAI'),\n      },\n    }\n  }\n\n  if (/\\.cram$/i.test(fileName) || adapterHint === 'CramAdapter') {\n    return {\n      type: 'CramAdapter',\n      cramLocation: file,\n      craiLocation: index || makeIndex(file, '.crai'),\n    }\n  }\n\n  if (/\\.gff3?$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.gff3?\\.b?gz$/i.test(fileName) || adapterHint === 'Gff3TabixAdapter') {\n    return {\n      type: 'Gff3TabixAdapter',\n      gffGzLocation: file,\n      index: {\n        location: index || makeIndex(file, '.tbi'),\n        indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n      },\n    }\n  }\n\n  if (/\\.gtf?$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.vcf$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.vcf\\.b?gz$/i.test(fileName) || adapterHint === 'VcfTabixAdapter') {\n    return {\n      type: 'VcfTabixAdapter',\n      vcfGzLocation: file,\n      index: {\n        location: index || makeIndex(file, 'tbi'),\n        indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n      },\n    }\n  }\n\n  if (/\\.vcf\\.idx$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.bed$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (/\\.bed\\.b?gz$/i.test(fileName) || adapterHint === 'BedTabixAdapter') {\n    return {\n      type: 'BedTabixAdapter',\n      bedGzLocation: file,\n      index: {\n        location: index || makeIndex(file, '.tbi'),\n        indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n      },\n    }\n  }\n\n  if (/\\.(bb|bigbed)$/i.test(fileName) || adapterHint === 'BigBedAdapter') {\n    return {\n      type: 'BigBedAdapter',\n      bigBedLocation: file,\n    }\n  }\n\n  if (/\\.(bw|bigwig)$/i.test(fileName) || adapterHint === 'BigWigAdapter') {\n    return {\n      type: 'BigWigAdapter',\n      bigWigLocation: file,\n    }\n  }\n\n  if (\n    /\\.(fa|fasta|fas|fna|mfa)$/i.test(fileName) ||\n    adapterHint === 'IndexedFastaAdapter'\n  ) {\n    return {\n      type: 'IndexedFastaAdapter',\n      fastaLocation: file,\n      faiLocation: index || makeIndex(file, '.fai'),\n    }\n  }\n\n  if (\n    /\\.(fa|fasta|fas|fna|mfa)\\.b?gz$/i.test(fileName) ||\n    adapterHint === 'BgzipFastaAdapter'\n  ) {\n    return {\n      type: 'BgzipFastaAdapter',\n      fastaLocation: file,\n      faiLocation: makeIndex(file, '.fai'),\n      gziLocation: makeIndex(file, '.gzi'),\n    }\n  }\n\n  if (/\\.2bit$/i.test(fileName) || adapterHint === 'TwoBitAdapter') {\n    return {\n      type: 'TwoBitAdapter',\n      twoBitLocation: file,\n    }\n  }\n\n  if (/\\.sizes$/i.test(fileName)) {\n    return {\n      type: 'UNSUPPORTED',\n    }\n  }\n\n  if (\n    /\\/trackData.jsonz?$/i.test(fileName) ||\n    adapterHint === 'NCListAdapter'\n  ) {\n    return {\n      type: 'NCListAdapter',\n      rootUrlTemplate: file,\n    }\n  }\n\n  if (/\\/sparql$/i.test(fileName) || adapterHint === 'SPARQLAdapter') {\n    return {\n      type: 'SPARQLAdapter',\n      endpoint: file,\n    }\n  }\n\n  if (/\\.hic/i.test(fileName) || adapterHint === 'HicAdapter') {\n    return {\n      type: 'HicAdapter',\n      hicLocation: file,\n    }\n  }\n\n  if (/\\.paf/i.test(fileName) || adapterHint === 'PAFAdapter') {\n    return {\n      type: 'PAFAdapter',\n      pafLocation: file,\n    }\n  }\n\n  return {\n    type: UNKNOWN,\n  }\n}\n\nexport function guessTrackType(adapterType: string): string {\n  const known: { [key: string]: string | undefined } = {\n    BamAdapter: 'AlignmentsTrack',\n    CramAdapter: 'AlignmentsTrack',\n    BgzipFastaAdapter: 'ReferenceSequenceTrack',\n    BigWigAdapter: 'QuantitativeTrack',\n    IndexedFastaAdapter: 'ReferenceSequenceTrack',\n    TwoBitAdapter: 'ReferenceSequenceTrack',\n    VcfTabixAdapter: 'VariantTrack',\n    HicAdapter: 'HicTrack',\n    PAFAdapter: 'SyntenyTrack',\n  }\n  return known[adapterType] || 'FeatureTrack'\n}\n\nexport function generateUnsupportedTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unsupported)`,\n    description: `Support not yet implemented for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n\nexport function generateUnknownTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unknown)`,\n    description: `Could not determine track type for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n","import { blue, green, red, amber } from '@material-ui/core/colors'\nimport { createMuiTheme, ThemeOptions } from '@material-ui/core/styles'\nimport { PaletteOptions } from '@material-ui/core/styles/createPalette'\nimport deepmerge from 'deepmerge'\n\nconst refTheme = createMuiTheme()\n\n// use this if we ever want to add some top-level thing to the theme\n// declare module '@material-ui/core/styles/createMuiTheme' {\n//   interface Theme {\n//     status: {\n//       topLevelThing: string\n//     }\n//   }\n//   interface ThemeOptions {\n//     status?: {\n//       topLevelThing?: string\n//     }\n//   }\n// }\n\ndeclare module '@material-ui/core/styles/createPalette' {\n  interface Palette {\n    tertiary: Palette['primary']\n    quaternary: Palette['primary']\n    bases: {\n      A: Palette['primary']\n      C: Palette['primary']\n      G: Palette['primary']\n      T: Palette['primary']\n    }\n  }\n  interface PaletteOptions {\n    tertiary?: PaletteOptions['primary']\n    quaternary?: PaletteOptions['primary']\n    bases?: {\n      A?: PaletteOptions['primary']\n      C?: PaletteOptions['primary']\n      G?: PaletteOptions['primary']\n      T?: PaletteOptions['primary']\n    }\n  }\n}\n\nconst midnight = '#0D233F'\nconst grape = '#721E63'\nconst forest = '#135560'\nconst mandarin = '#FFB11D'\n\nexport const jbrowseDefaultPalette = {\n  // type: 'dark',\n  primary: { main: midnight },\n  secondary: { main: grape },\n  tertiary: refTheme.palette.augmentColor({ main: forest }),\n  quaternary: refTheme.palette.augmentColor({ main: mandarin }),\n  stopCodon: '#e22',\n  startCodon: '#3e3',\n  bases: {\n    A: refTheme.palette.augmentColor(green),\n    C: refTheme.palette.augmentColor(blue),\n    G: refTheme.palette.augmentColor(amber),\n    T: refTheme.palette.augmentColor(red),\n  },\n}\n\nexport function createJBrowseDefaultProps(/* palette: PaletteOptions = {} */) {\n  return {\n    MuiButton: {\n      size: 'small' as 'small',\n    },\n    MuiFilledInput: {\n      margin: 'dense' as 'dense',\n    },\n    MuiFormControl: {\n      margin: 'dense' as 'dense',\n    },\n    MuiFormHelperText: {\n      margin: 'dense' as 'dense',\n    },\n    MuiIconButton: {\n      size: 'small' as 'small',\n    },\n    MuiInputBase: {\n      margin: 'dense' as 'dense',\n    },\n    MuiList: {\n      dense: true,\n    },\n    MuiListItem: {\n      dense: true,\n    },\n    MuiOutlinedInput: {\n      margin: 'dense' as 'dense',\n    },\n    MuiFab: {\n      size: 'small' as 'small',\n    },\n    MuiTable: {\n      size: 'small' as 'small',\n    },\n    MuiTextField: {\n      margin: 'dense' as 'dense',\n      size: 'small' as 'small',\n    },\n    MuiToolbar: {\n      variant: 'dense' as 'dense',\n    },\n    MuiSvgIcon: {\n      fontSize: 'small' as 'small',\n    },\n    MuiToggleButtonGroup: {\n      size: 'small' as 'small',\n    },\n    MuiCheckbox: {\n      size: 'small' as 'small',\n    },\n    MuiLink: {\n      underline: 'always' as 'always',\n    },\n  }\n}\n\nexport function createJBrowseDefaultOverrides(palette: PaletteOptions = {}) {\n  const generatedPalette = deepmerge(jbrowseDefaultPalette, palette)\n  return {\n    MuiIconButton: {\n      colorSecondary: {\n        color: generatedPalette.tertiary.main,\n      },\n    },\n    MuiButton: {\n      textSecondary: {\n        color: generatedPalette.tertiary.main,\n      },\n    },\n    MuiFab: {\n      secondary: {\n        backgroundColor: generatedPalette.quaternary.main,\n      },\n    },\n    MuiLink: {\n      root: {\n        color: generatedPalette.tertiary.main,\n      },\n    },\n    MuiAccordionSummary: {\n      root: {\n        background: generatedPalette.tertiary.main,\n        '&$expanded': {\n          // overrides the subclass e.g. .MuiAccordionSummary-root-311.MuiAccordionSummary-expanded-312\n          minHeight: 0,\n          margin: 0,\n          color: generatedPalette.tertiary.contrastText,\n        },\n        margin: 0,\n        minHeight: 0,\n        padding: '0px 24px',\n      },\n      content: {\n        '&$expanded': {\n          margin: '8px 0px',\n        },\n        margin: '8px 0px',\n        color: generatedPalette.tertiary.contrastText,\n      },\n      expanded: {\n        // empty block needed to keep small\n      },\n    },\n    // makes menus more compact\n    MuiMenuItem: {\n      root: {\n        paddingTop: 3,\n        paddingBottom: 3,\n      },\n    },\n\n    // the below two are linked to make menus more compact\n    MuiListItemIcon: {\n      root: {\n        minWidth: 32,\n      },\n    },\n    MuiListItemText: {\n      inset: {\n        paddingLeft: 32,\n      },\n    },\n  }\n}\n\nexport const jbrowseBaseTheme: ThemeOptions = {\n  palette: jbrowseDefaultPalette,\n  typography: { fontSize: 12 },\n  spacing: 4,\n  props: createJBrowseDefaultProps(),\n  overrides: createJBrowseDefaultOverrides(),\n}\n\nexport function createJBrowseTheme(theme?: ThemeOptions) {\n  if (!theme) {\n    return createMuiTheme(jbrowseBaseTheme)\n  }\n  if (theme.palette?.tertiary) {\n    theme = {\n      ...theme,\n      palette: {\n        ...theme.palette,\n        tertiary: refTheme.palette.augmentColor(theme.palette.tertiary),\n      },\n    }\n  }\n  if (theme.palette?.quaternary) {\n    theme = {\n      ...theme,\n      palette: {\n        ...theme.palette,\n        quaternary: refTheme.palette.augmentColor(theme.palette.quaternary),\n      },\n    }\n  }\n  theme = {\n    ...theme,\n    props: deepmerge(createJBrowseDefaultProps(), theme.props || {}),\n    overrides: deepmerge(\n      createJBrowseDefaultOverrides(theme.palette),\n      theme.overrides || {},\n    ),\n  }\n  return createMuiTheme(deepmerge(jbrowseBaseTheme, theme))\n}\n","import React from 'react'\n\ntype LogoVariant = 'color' | 'black' | 'white'\n\ninterface LogoProps {\n  variant?: LogoVariant\n}\n\nfunction getColors(variant?: LogoVariant) {\n  if (variant === 'black') {\n    return {\n      midnight: '#808080',\n      forrest: '#666666',\n      grape: '#4d4d4d',\n      mandarin: '#333333',\n      gray: '#1a1a1a',\n    }\n  }\n  if (variant === 'white') {\n    return {\n      midnight: '#ffffff',\n      forrest: '#e6e6e6',\n      grape: '#cccccc',\n      mandarin: '#b3b3b3',\n      gray: '#999999',\n    }\n  }\n  return {\n    midnight: '#0d233f',\n    forrest: '#135560',\n    grape: '#721e63',\n    mandarin: '#ffb11d',\n    gray: '#dadada',\n  }\n}\n\nexport function Logomark({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 175 175\">\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nexport function LogoFull({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 641 175\">\n      <Text variant={variant} />\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nfunction Icon({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <>\n      <path\n        style={{ fill: colors.midnight }}\n        d=\"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z\"\n      />\n      <path\n        style={{ fill: colors.forrest }}\n        d=\"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z\"\n      />\n      <path\n        style={{ fill: colors.grape }}\n        d=\"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z\"\n      />\n      <path\n        style={{ fill: colors.mandarin }}\n        d=\"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z\"\n      />\n      <path\n        style={{ fill: colors.gray }}\n        d=\"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z\"\n      />\n    </>\n  )\n}\n\nfunction Text({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <g\n      aria-label=\"JBrowse\"\n      transform=\"translate(213.084 144.241)\"\n      style={{ fill: colors.midnight }}\n    >\n      <path d=\"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z\" />\n      <path d=\"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z\" />\n      <path d=\"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z\" />\n      <path d=\"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z\" />\n      <path d=\"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z\" />\n      <path d=\"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z\" />\n      <path d=\"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z\" />\n    </g>\n  )\n}\n","import { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport React, { useEffect, useState, useRef } from 'react'\n\nconst useStyles = makeStyles({\n  horizontalHandle: {\n    cursor: 'row-resize',\n    width: '100%',\n  },\n  verticalHandle: {\n    cursor: 'col-resize',\n    height: '100%',\n  },\n  flexbox_verticalHandle: {\n    cursor: 'col-resize',\n    alignSelf: 'stretch', // the height: 100% is actually unable to function inside flexbox\n  },\n  flexbox_horizontalHandle: {\n    cursor: 'row-resize',\n    alignSelf: 'stretch', // similar to above\n  },\n})\n\ninterface ResizeHandleProps {\n  onDrag: (arg: number) => number\n  vertical?: boolean\n  flexbox?: boolean\n  className?: string\n  [props: string]: unknown\n}\n\nfunction ResizeHandle({\n  onDrag,\n  vertical = false,\n  flexbox = false,\n  className: originalClassName,\n  ...props\n}: ResizeHandleProps) {\n  const [mouseDragging, setMouseDragging] = useState(false)\n  const prevPos = useRef(0)\n  const classes = useStyles()\n\n  useEffect(() => {\n    function mouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const pos = event[vertical ? 'clientX' : 'clientY']\n      const distance = pos - prevPos.current\n      if (distance) {\n        const actualDistance = onDrag(distance)\n        prevPos.current += actualDistance\n      }\n    }\n\n    function mouseUp() {\n      setMouseDragging(false)\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', mouseMove, true)\n      window.addEventListener('mouseup', mouseUp, true)\n      return () => {\n        window.removeEventListener('mousemove', mouseMove, true)\n        window.removeEventListener('mouseup', mouseUp, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, onDrag, vertical])\n\n  let className\n  if (flexbox) {\n    if (vertical) {\n      className = classes.flexbox_verticalHandle\n    } else {\n      className = classes.flexbox_horizontalHandle\n    }\n  } else if (vertical) {\n    className = classes.verticalHandle\n  } else {\n    className = classes.horizontalHandle\n  }\n\n  return (\n    <div\n      data-resizer=\"true\"\n      onMouseDown={event => {\n        event.preventDefault()\n        const pos = event[vertical ? 'clientX' : 'clientY']\n        prevPos.current = pos\n        setMouseDragging(true)\n      }}\n      role=\"presentation\"\n      className={clsx(className, originalClassName)}\n      {...props}\n    />\n  )\n}\n\nexport default ResizeHandle\n","import React from 'react'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport ResizeHandle from './ResizeHandle'\n\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    overflowY: 'auto',\n    height: '100%',\n    zIndex: theme.zIndex.drawer,\n    outline: 'none',\n    background: theme.palette.background.default,\n  },\n  resizeHandle: {\n    width: 4,\n    position: 'fixed',\n    top: 0,\n    zIndex: theme.zIndex.drawer + 1,\n  },\n}))\n\nfunction Drawer({ children, session }) {\n  const classes = useStyles()\n\n  return (\n    <Paper className={classes.paper} elevation={16} square>\n      <ResizeHandle\n        onDrag={session.resizeDrawer}\n        className={classes.resizeHandle}\n        vertical\n      />\n      {children}\n    </Paper>\n  )\n}\n\nDrawer.propTypes = {\n  children: PropTypes.node,\n  session: MobxPropTypes.observableObject.isRequired,\n}\n\nDrawer.defaultProps = {\n  children: null,\n}\n\nexport default observer(Drawer)\n","import React, { Suspense, useState } from 'react'\nimport {\n  AppBar,\n  IconButton,\n  ListItemSecondaryAction,\n  MenuItem,\n  Select,\n  Toolbar,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport CloseIcon from '@material-ui/icons/Close'\nimport MinimizeIcon from '@material-ui/icons/Minimize'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\nimport { useTheme } from '@material-ui/core/styles'\nimport Drawer from './Drawer'\n\nconst useStyles = makeStyles(theme => ({\n  drawerActions: {\n    float: 'right',\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.secondary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  drawerToolbar: {\n    paddingLeft: theme.spacing(2),\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n  drawerSelect: {\n    color: theme.palette.secondary.contrastText,\n  },\n  drawerLoading: {\n    margin: theme.spacing(2),\n  },\n  dropDownIcon: {\n    color: theme.palette.secondary.contrastText,\n  },\n}))\n\nconst DrawerHeader = observer(props => {\n  const { session, setToolbarHeight } = props\n  const { visibleWidget, activeWidgets } = session\n  const classes = useStyles()\n  const handleChange = (e, option) => {\n    session.showWidget(option.props.value)\n  }\n  const theme = useTheme()\n  return (\n    <AppBar\n      position=\"sticky\"\n      ref={ref => setToolbarHeight(ref?.getBoundingClientRect().height || 0)}\n      style={{ background: theme.palette.secondary.main }}\n    >\n      <Toolbar disableGutters className={classes.drawerToolbar}>\n        <Select\n          value={visibleWidget || ''}\n          data-testid=\"widget-drawer-selects\"\n          className={classes.drawerSelect}\n          classes={{ icon: classes.dropDownIcon }}\n          renderValue={selected => {\n            const {\n              HeadingComponent: HeadingComp,\n              heading: headingText,\n            } = getEnv(session).pluginManager.getWidgetType(selected.type)\n            return (\n              <Typography variant=\"h6\" color=\"inherit\">\n                {HeadingComp ? (\n                  <HeadingComp model={selected} />\n                ) : (\n                  headingText || undefined\n                )}\n              </Typography>\n            )\n          }}\n          onChange={(e, value) => {\n            handleChange(e, value)\n          }}\n        >\n          {Array.from(activeWidgets.values()).map((widget, index) => {\n            const {\n              HeadingComponent: HeadingComp,\n              heading: headingText,\n            } = getEnv(session).pluginManager.getWidgetType(widget.type)\n            return (\n              <MenuItem\n                data-testid={`widget-drawer-selects-item-${widget.type}`}\n                key={`${widget.id}-${index}`}\n                value={widget}\n              >\n                <Typography variant=\"h6\" color=\"inherit\">\n                  {HeadingComp ? (\n                    <HeadingComp model={widget} />\n                  ) : (\n                    headingText || undefined\n                  )}\n                </Typography>\n                <ListItemSecondaryAction>\n                  <IconButton\n                    className={classes.drawerCloseButton}\n                    data-testid={`${widget.type}-drawer-delete`}\n                    color=\"inherit\"\n                    aria-label=\"Delete\"\n                    onClick={() => {\n                      session.hideWidget(widget)\n                    }}\n                  >\n                    <DeleteIcon />\n                  </IconButton>\n                </ListItemSecondaryAction>\n              </MenuItem>\n            )\n          })}\n        </Select>\n        <div className={classes.spacer} />\n        <div className={classes.drawerCloseButton}>\n          <IconButton\n            className={classes.drawerCloseButton}\n            data-testid=\"drawer-minimize\"\n            color=\"inherit\"\n            onClick={() => {\n              session.minimizeWidgetDrawer()\n            }}\n          >\n            <MinimizeIcon />\n          </IconButton>\n          <IconButton\n            data-testid=\"drawer-close\"\n            color=\"inherit\"\n            onClick={() => {\n              session.hideWidget(visibleWidget)\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        </div>\n      </Toolbar>\n    </AppBar>\n  )\n})\n\nconst DrawerWidget = observer(({ session }) => {\n  const { visibleWidget, activeWidgets } = session\n  const { pluginManager } = getEnv(session)\n  const { ReactComponent } = pluginManager.getWidgetType(visibleWidget.type)\n\n  // we track the toolbar height because components that use virtualized height\n  // want to be able to fill the contained, minus the toolbar height (the\n  // position static/sticky is included in AutoSizer estimates)\n  const [toolbarHeight, setToolbarHeight] = useState(0)\n\n  return (\n    <Drawer session={session} open={Boolean(activeWidgets.size)}>\n      <DrawerHeader session={session} setToolbarHeight={setToolbarHeight} />\n      <Suspense fallback={<div>Loading...</div>}>\n        <ReactComponent\n          model={visibleWidget}\n          session={session}\n          toolbarHeight={toolbarHeight}\n        />\n      </Suspense>\n    </Drawer>\n  )\n})\n\nexport default DrawerWidget\n","import Button from '@material-ui/core/Button'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport ArrowDropDown from '@material-ui/icons/ArrowDropDown'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useRef, useState } from 'react'\nimport Menu, { MenuItem } from './Menu'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n  },\n  buttonRoot: {\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nfunction DropDownMenu({\n  menuTitle,\n  session,\n  menuItems,\n}: {\n  menuTitle: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  session: any\n  menuItems: MenuItem[]\n}) {\n  const [open, setOpen] = useState(false)\n  const anchorEl = useRef(null)\n  const classes = useStyles()\n\n  function handleToggle() {\n    setOpen(!open)\n  }\n\n  function handleMenuItemClick(_event: unknown, callback: Function) {\n    callback(session)\n    handleClose()\n  }\n\n  function handleClose() {\n    setOpen(false)\n  }\n\n  return (\n    <div className={classes.root}>\n      <Button\n        ref={anchorEl}\n        onClick={handleToggle}\n        color=\"inherit\"\n        data-testid=\"dropDownMenuButton\"\n        classes={{ root: classes.buttonRoot }}\n      >\n        {menuTitle}\n        <ArrowDropDown />\n      </Button>\n      <Menu\n        anchorEl={anchorEl.current}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n        onMenuItemClick={handleMenuItemClick}\n        open={open}\n        onClose={handleClose}\n        menuItems={menuItems}\n      />\n    </div>\n  )\n}\n\nDropDownMenu.propTypes = {\n  menuTitle: PropTypes.string.isRequired,\n  menuItems: MobxPropTypes.arrayOrObservableArray.isRequired,\n  session: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(DropDownMenu)\n","import InputBase from '@material-ui/core/InputBase'\nimport Typography, { TypographyProps } from '@material-ui/core/Typography'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport React, { useEffect, useState } from 'react'\n\ntype Variant = TypographyProps['variant']\n\ntype EditableTypographyClassKey =\n  | 'input'\n  | 'inputBase'\n  | 'inputRoot'\n  | 'inputFocused'\n\nconst useStyles = makeStyles(theme => ({\n  input: {},\n  inputBase: {},\n  typography: {\n    top: 6,\n    left: 2,\n    position: 'absolute',\n    whiteSpace: 'nowrap',\n    visibility: 'hidden',\n  },\n  inputRoot: {\n    padding: theme.spacing(0.5),\n  },\n  inputFocused: {\n    borderStyle: 'solid',\n    borderRadius: theme.shape.borderRadius,\n    borderWidth: 2,\n  },\n}))\n\ninterface EditableTypographyPropTypes {\n  value: string\n  setValue: (value: string) => void\n  variant: Variant\n  classes?: Partial<Record<EditableTypographyClassKey, string>>\n}\n\n// using forwardRef so that MUI Tooltip can wrap this component\nconst EditableTypography = React.forwardRef(\n  (props: EditableTypographyPropTypes, ref: React.Ref<HTMLDivElement>) => {\n    const { value, setValue, variant, ...other } = props\n    const [editedValue, setEditedValue] = useState<string | undefined>()\n    const [width, setWidth] = useState(0)\n    const [sizerNode, setSizerNode] = useState<HTMLSpanElement | null>(null)\n    const [inputNode, setInputNode] = useState<HTMLInputElement | null>(null)\n    const [blur, setBlur] = useState(false)\n\n    useEffect(() => {\n      if (blur) {\n        inputNode && inputNode.blur()\n        setBlur(false)\n      }\n    }, [blur, inputNode])\n\n    const classes = useStyles(props)\n    const theme = useTheme()\n\n    const clientWidth = sizerNode && sizerNode.clientWidth\n    if (clientWidth && clientWidth !== width) {\n      setWidth(clientWidth)\n    }\n\n    const sizerRef = (node: HTMLSpanElement) => {\n      setSizerNode(node)\n    }\n\n    const inputRef = (node: HTMLInputElement) => {\n      setInputNode(node)\n    }\n\n    function handleBlur() {\n      if (editedValue && editedValue !== value) {\n        setValue(editedValue)\n      }\n      setEditedValue(undefined)\n    }\n\n    function handleKeyDown(event: React.KeyboardEvent<HTMLInputElement>) {\n      if (event.key === 'Enter') {\n        inputNode && inputNode.blur()\n      } else if (event.key === 'Escape') {\n        setEditedValue(undefined)\n        setBlur(true)\n      }\n    }\n\n    function handleChange(event: React.ChangeEvent<HTMLInputElement>) {\n      setEditedValue(event.target.value)\n    }\n\n    return (\n      <div {...other} ref={ref}>\n        <div style={{ position: 'relative' }}>\n          <Typography\n            ref={sizerRef}\n            component=\"span\"\n            variant={variant}\n            className={classes.typography}\n          >\n            {editedValue === undefined ? value : editedValue}\n          </Typography>\n        </div>\n        <InputBase\n          inputRef={inputRef}\n          className={classes.inputBase}\n          inputProps={{\n            style: {\n              width,\n              ...(variant && variant !== 'inherit' && variant !== 'srOnly'\n                ? theme.typography[variant]\n                : {}),\n            },\n          }}\n          classes={{\n            input: classes.input,\n            root: classes.inputRoot,\n            focused: classes.inputFocused,\n          }}\n          value={editedValue === undefined ? value : editedValue}\n          onChange={handleChange}\n          onKeyDown={handleKeyDown}\n          onBlur={handleBlur}\n        />\n      </div>\n    )\n  },\n)\n\nexport default EditableTypography\n","import IconButton from '@material-ui/core/IconButton'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport CloseIcon from '@material-ui/icons/Close'\nimport Alert from '@material-ui/lab/Alert'\nimport { observer } from 'mobx-react'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport React, { useEffect, useState } from 'react'\nimport { AbstractSessionModel, NotificationLevel } from '../util'\n\ntype SnackbarMessage = [string, NotificationLevel]\n\ninterface SnackbarSession extends AbstractSessionModel {\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => unknown\n}\n\nfunction MessageSnackbar({\n  session,\n}: {\n  session: SnackbarSession & IAnyStateTreeNode\n}) {\n  const [open, setOpen] = useState(false)\n  const [snackbarMessage, setSnackbarMessage] = useState<\n    SnackbarMessage | undefined\n  >()\n\n  const { popSnackbarMessage, snackbarMessages } = session\n\n  const latestMessage = snackbarMessages.length\n    ? snackbarMessages[snackbarMessages.length - 1]\n    : null\n\n  useEffect(() => {\n    let timeoutId: NodeJS.Timer\n\n    if (snackbarMessage) {\n      if (!latestMessage) {\n        setSnackbarMessage(undefined)\n      } else if (snackbarMessage[0] !== latestMessage[0]) {\n        setOpen(false)\n        timeoutId = setTimeout(() => {\n          setSnackbarMessage(latestMessage)\n          setOpen(true)\n        }, 100)\n      }\n    } else if (latestMessage) {\n      setSnackbarMessage(latestMessage)\n      setOpen(true)\n    }\n\n    return () => {\n      clearTimeout(timeoutId)\n    }\n  }, [latestMessage, snackbarMessage])\n\n  const handleClose = (_event: unknown, reason?: string) => {\n    if (reason === 'clickaway') {\n      return\n    }\n    popSnackbarMessage()\n    setOpen(false)\n  }\n\n  const [message, level] = snackbarMessage || []\n  return (\n    <Snackbar\n      open={open && !!message}\n      onClose={handleClose}\n      action={\n        <IconButton aria-label=\"close\" color=\"inherit\" onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      }\n    >\n      <Alert onClose={handleClose} severity={level || 'warning'}>\n        {message}\n      </Alert>\n    </Snackbar>\n  )\n}\n\nexport default observer(MessageSnackbar)\n","import {\n  SvgIconProps,\n  IconButton,\n  IconButtonProps as IconButtonPropsType,\n  Paper,\n  makeStyles,\n  useTheme,\n  Tooltip,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport MenuIcon from '@material-ui/icons/Menu'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { ContentRect, withContentRect } from 'react-measure'\n\nimport { IBaseViewModel } from '../pluggableElementTypes/models'\nimport EditableTypography from './EditableTypography'\nimport Menu from './Menu'\n\nconst useStyles = makeStyles(theme => ({\n  viewContainer: {\n    overflow: 'hidden',\n    background: theme.palette.secondary.main,\n    margin: theme.spacing(0.5),\n  },\n  icon: {\n    color: theme.palette.secondary.contrastText,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  iconRoot: {\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.secondary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  listItemIconRoot: {\n    minWidth: 28,\n  },\n  listItemInset: {\n    paddingLeft: 28,\n  },\n  menuItemDense: {\n    paddingLeft: theme.spacing(1),\n    paddingRight: 26,\n    paddingTop: 0,\n    paddingBottom: 0,\n  },\n  secondaryActionRoot: {\n    right: theme.spacing(1),\n  },\n  input: {\n    paddingBottom: 0,\n    paddingTop: 2,\n  },\n  inputBase: {\n    color: theme.palette.secondary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.secondary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.primary.main,\n    backgroundColor: theme.palette.secondary.light,\n  },\n}))\n\nconst ViewMenu = observer(\n  ({\n    model,\n    IconButtonProps,\n    IconProps,\n  }: {\n    model: IBaseViewModel\n    IconButtonProps: IconButtonPropsType\n    IconProps: SvgIconProps\n  }) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n\n    if (!(model.menuItems && model.menuItems.length)) {\n      return null\n    }\n\n    return (\n      <>\n        <IconButton\n          {...IconButtonProps}\n          aria-label=\"more\"\n          aria-controls=\"view-menu\"\n          aria-haspopup=\"true\"\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n          data-testid=\"view_menu_icon\"\n        >\n          <MenuIcon {...IconProps} />\n        </IconButton>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onMenuItemClick={(_event, callback) => {\n            callback()\n            setAnchorEl(undefined)\n          }}\n          onClose={() => {\n            setAnchorEl(undefined)\n          }}\n          menuItems={model.menuItems}\n        />\n      </>\n    )\n  },\n)\n\nexport default withContentRect('bounds')(\n  observer(\n    ({\n      view,\n      onClose,\n      style,\n      children,\n      contentRect,\n      measureRef,\n    }: {\n      view: IBaseViewModel\n      onClose: () => void\n      style: React.CSSProperties\n      children: React.ReactNode\n      contentRect: ContentRect\n      measureRef: React.RefObject<HTMLDivElement>\n    }) => {\n      const classes = useStyles()\n      const theme = useTheme()\n      const padWidth = theme.spacing(1)\n\n      let width = 0\n      if (contentRect.bounds) {\n        ;({ width } = contentRect.bounds)\n      }\n      useEffect(() => {\n        if (width) {\n          if (isAlive(view)) {\n            view.setWidth(width - padWidth * 2)\n          }\n        }\n      }, [padWidth, view, width])\n\n      const scrollRef = useRef<HTMLDivElement>(null)\n      // scroll the view into view when first mounted\n      // note that this effect will run only once, because of\n      // the empty array second param\n      useEffect(() => {\n        if (scrollRef?.current?.scrollIntoView) {\n          scrollRef.current.scrollIntoView({ block: 'center' })\n        }\n      }, [])\n\n      return (\n        <Paper\n          elevation={12}\n          ref={measureRef}\n          className={classes.viewContainer}\n          style={{ ...style, padding: `0px ${padWidth}px ${padWidth}px` }}\n        >\n          <div ref={scrollRef} style={{ display: 'flex' }}>\n            <ViewMenu\n              model={view}\n              IconButtonProps={{\n                classes: { root: classes.iconRoot },\n                edge: 'start',\n              }}\n              IconProps={{ className: classes.icon }}\n            />\n            <div className={classes.grow} />\n            <Tooltip title=\"Rename view\" arrow>\n              <EditableTypography\n                value={\n                  view.displayName ||\n                  // @ts-ignore\n                  (view.assemblyNames\n                    ? // @ts-ignore\n                      view.assemblyNames.join(',')\n                    : 'Untitled view')\n                }\n                setValue={val => {\n                  view.setDisplayName(val)\n                }}\n                variant=\"body2\"\n                classes={{\n                  input: classes.input,\n                  inputBase: classes.inputBase,\n                  inputRoot: classes.inputRoot,\n                  inputFocused: classes.inputFocused,\n                }}\n              />\n            </Tooltip>\n            <div className={classes.grow} />\n            <IconButton\n              data-testid=\"close_view\"\n              classes={{ root: classes.iconRoot }}\n              edge=\"end\"\n              onClick={onClose}\n            >\n              <CloseIcon className={classes.icon} />\n            </IconButton>\n          </div>\n          <Paper>{children}</Paper>\n        </Paper>\n      )\n    },\n  ),\n)\n","import React, { Suspense } from 'react'\nimport { AppBar, Fab, Toolbar, Tooltip, makeStyles } from '@material-ui/core'\nimport LaunchIcon from '@material-ui/icons/Launch'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\nimport DrawerWidget from './DrawerWidget'\nimport DropDownMenu from './DropDownMenu'\nimport EditableTypography from './EditableTypography'\nimport { LogoFull } from './Logo'\nimport Snackbar from './Snackbar'\nimport ViewContainer from './ViewContainer'\n\nconst useStyles = makeStyles(theme => ({\n  '@global': {\n    html: {\n      'font-family': 'Roboto',\n    },\n    /* Based on: https://www.digitalocean.com/community/tutorials/css-scrollbars */\n    /* The emerging W3C standard\n       that is currently Firefox-only */\n    '*': {\n      'scrollbar-width': 'auto',\n      'scrollbar-color': 'rgba(0,0,0,.5) rgba(128,128,128)',\n    },\n    /* Works on Chrome/Edge/Safari */\n    '*::-webkit-scrollbar': {\n      '-webkit-appearance': 'none',\n      width: '12px',\n    },\n    '*::-webkit-scrollbar-thumb': {\n      'background-color': 'rgba(0,0,0,.5)',\n      '-webkit-box-shadow': '0 0 1px rgba(255,255,255,.5)',\n    },\n  },\n  root: {\n    display: 'grid',\n    height: '100vh',\n    width: '100%',\n  },\n  fab: {\n    float: 'right',\n    position: 'sticky',\n    marginTop: theme.spacing(2),\n    bottom: theme.spacing(2),\n    right: theme.spacing(2),\n  },\n  menuBarAndComponents: {\n    gridColumn: 'main',\n    display: 'grid',\n    gridTemplateRows: '[menubar] min-content [components] auto',\n    height: '100vh',\n  },\n  menuBar: {\n    gridRow: 'menubar',\n  },\n  components: {\n    overflowY: 'auto',\n    gridRow: 'components',\n  },\n  appBar: {\n    flexGrow: 1,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  inputBase: {\n    color: theme.palette.primary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.primary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.secondary.main,\n    backgroundColor: theme.palette.primary.light,\n  },\n}))\n\nconst App = observer(({ session, HeaderButtons }) => {\n  const classes = useStyles()\n  const { pluginManager } = getEnv(session)\n  const {\n    visibleWidget,\n    drawerWidth,\n    minimized,\n    activeWidgets,\n    savedSessionNames,\n    name,\n    menus,\n    views,\n  } = session\n\n  function handleNameChange(newName) {\n    if (savedSessionNames && savedSessionNames.includes(newName)) {\n      session.notify(\n        `Cannot rename session to \"${newName}\", a saved session with that name already exists`,\n        'warning',\n      )\n    } else {\n      session.renameCurrentSession(newName)\n    }\n  }\n  return (\n    <div\n      className={classes.root}\n      style={{\n        gridTemplateColumns: `[main] 1fr${\n          visibleWidget && !minimized ? ` [drawer] ${drawerWidth}px` : ''\n        }`,\n      }}\n    >\n      {session.DialogComponent ? (\n        <Suspense fallback={<div />}>\n          <session.DialogComponent\n            handleClose={() => session.setDialogComponent(undefined, undefined)}\n            {...session.DialogProps}\n          />\n        </Suspense>\n      ) : null}\n      <div className={classes.menuBarAndComponents}>\n        <div className={classes.menuBar}>\n          <AppBar className={classes.appBar} position=\"static\">\n            <Toolbar>\n              {menus.map(menu => (\n                <DropDownMenu\n                  key={menu.label}\n                  menuTitle={menu.label}\n                  menuItems={menu.menuItems}\n                  session={session}\n                />\n              ))}\n              <div className={classes.grow} />\n              <Tooltip title=\"Rename Session\" arrow>\n                <EditableTypography\n                  value={name}\n                  setValue={handleNameChange}\n                  variant=\"body1\"\n                  classes={{\n                    inputBase: classes.inputBase,\n                    inputRoot: classes.inputRoot,\n                    inputFocused: classes.inputFocused,\n                  }}\n                />\n              </Tooltip>\n              {HeaderButtons}\n              <div className={classes.grow} />\n              <div style={{ width: 150, maxHeight: 48 }}>\n                <LogoFull variant=\"white\" />\n              </div>\n            </Toolbar>\n          </AppBar>\n        </div>\n        <div className={classes.components}>\n          {views.map(view => {\n            const viewType = pluginManager.getViewType(view.type)\n            if (!viewType) {\n              throw new Error(`unknown view type ${view.type}`)\n            }\n            const { ReactComponent } = viewType\n            return (\n              <ViewContainer\n                key={`view-${view.id}`}\n                view={view}\n                onClose={() => session.removeView(view)}\n              >\n                <Suspense fallback={<div>Loading...</div>}>\n                  <ReactComponent\n                    model={view}\n                    session={session}\n                    getTrackType={pluginManager.getTrackType}\n                  />\n                </Suspense>\n              </ViewContainer>\n            )\n          })}\n\n          {/* blank space at the bottom of screen allows scroll */}\n          <div style={{ height: 300 }} />\n        </div>\n      </div>\n\n      {activeWidgets.size > 0 && minimized ? (\n        <div className={classes.fab}>\n          <Fab\n            color=\"primary\"\n            size=\"small\"\n            aria-label=\"show\"\n            data-testid=\"drawer-maximize\"\n            style={{ float: 'right' }}\n            onClick={() => {\n              session.showWidgetDrawer()\n            }}\n          >\n            <LaunchIcon />\n          </Fab>\n        </div>\n      ) : null}\n\n      {visibleWidget && !minimized ? <DrawerWidget session={session} /> : null}\n\n      <Snackbar session={session} />\n    </div>\n  )\n})\n\nexport default App\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport ReactPropTypes from 'prop-types'\nimport React, { useRef, useEffect } from 'react'\nimport { ImageBitmapType } from '../util/offscreenCanvasPonyfill'\n\nfunction PrerenderedCanvas(props: {\n  width: number\n  height: number\n  highResolutionScaling: number\n  style: any\n  imageData: any\n  showSoftClip?: boolean\n}) {\n  const {\n    width,\n    height,\n    highResolutionScaling,\n    style,\n    imageData,\n    showSoftClip,\n  } = props\n  const featureCanvas = useRef<HTMLCanvasElement>(null)\n\n  useEffect(() => {\n    if (!imageData) {\n      return\n    }\n    const canvas = featureCanvas.current\n    if (!canvas) {\n      return\n    }\n    const context = canvas.getContext('2d')\n    if (!context) {\n      return\n    }\n    if (imageData.commands) {\n      imageData.commands.forEach((command: any) => {\n        if (command.type === 'strokeStyle') {\n          context.strokeStyle = command.style\n        } else if (command.type === 'fillStyle') {\n          context.fillStyle = command.style\n        } else if (command.type === 'font') {\n          context.font = command.style\n        } else {\n          // @ts-ignore\n          context[command.type](...command.args)\n        }\n      })\n    } else if (imageData instanceof ImageBitmapType) {\n      context.drawImage(imageData, 0, 0)\n    } else if (imageData.dataURL) {\n      const img = new Image()\n      img.onload = () => context.drawImage(img, 0, 0)\n      img.src = imageData.dataURL\n    }\n  }, [imageData])\n\n  const softClipString = showSoftClip ? '_softclipped' : ''\n  return (\n    <canvas\n      data-testid={`prerendered_canvas${softClipString}`}\n      ref={featureCanvas}\n      width={width * highResolutionScaling}\n      height={height * highResolutionScaling}\n      style={{ width, height, ...style }}\n    />\n  )\n}\n\nPrerenderedCanvas.propTypes = {\n  height: ReactPropTypes.number.isRequired,\n  width: ReactPropTypes.number.isRequired,\n  highResolutionScaling: ReactPropTypes.number,\n  style: ReactPropTypes.objectOf(ReactPropTypes.any),\n  imageData: ReactPropTypes.any,\n  // config: ReactPropTypes.objectOf(ReactPropTypes.any),\n}\nPrerenderedCanvas.defaultProps = {\n  imageData: undefined,\n  highResolutionScaling: 1,\n  style: {},\n  // config: {},\n}\n\nexport default PrerenderedCanvas\n","import Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport React from 'react'\n\nexport default ({\n  onClose,\n  open,\n  onFactoryReset,\n}: {\n  onClose: Function\n  open: boolean\n  onFactoryReset: Function\n}) => {\n  function handleDialogClose(action?: string) {\n    if (action === 'reset') {\n      onFactoryReset()\n    }\n    onClose()\n  }\n\n  return (\n    <Dialog open={open} onClose={() => handleDialogClose()}>\n      <DialogTitle id=\"alert-dialog-title\">Reset</DialogTitle>\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-description\">\n          Are you sure you want to reset? This will restore the default\n          configuration.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => handleDialogClose()} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          onClick={() => handleDialogClose('reset')}\n          color=\"primary\"\n          variant=\"contained\"\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import React, { useEffect, useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { Feature } from '../util/simpleFeature'\nimport { readConfObject } from '../configuration'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\n\nconst useStyles = makeStyles({\n  hoverLabel: {\n    border: '1px solid black',\n    position: 'absolute',\n    background: '#fffa',\n    pointerEvents: 'none',\n    zIndex: 10000,\n  },\n})\n\nconst Tooltip = ({\n  offsetX,\n  offsetY,\n  configuration,\n  feature,\n  timeout = 300,\n}: {\n  offsetX: number\n  offsetY: number\n  configuration: AnyConfigurationModel\n  feature?: Feature\n  timeout?: number\n}) => {\n  const classes = useStyles()\n  const [shown, setShown] = useState(false)\n  useEffect(() => {\n    // only show the loading message after short timeout to prevent excessive\n    // flickering\n    const handle = setTimeout(() => setShown(true), timeout)\n    return () => clearTimeout(handle)\n  })\n  if (feature && shown) {\n    const text = readConfObject(configuration, 'mouseover', { feature })\n    return (\n      <div\n        className={classes.hoverLabel}\n        style={{ left: offsetX, top: offsetY }}\n      >\n        {text}\n      </div>\n    )\n  }\n  return null\n}\n\nexport default observer(Tooltip)\n","import Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport PropTypes from 'prop-types'\nimport React, { useState } from 'react'\nimport FactoryResetDialog from './FactoryResetDialog'\n\nconst ResetComponent = ({\n  onFactoryReset,\n  resetButtonText,\n}: {\n  onFactoryReset: Function\n  resetButtonText: string\n}) => {\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  return (\n    <>\n      <Button\n        data-testid=\"fatal-error\"\n        color=\"primary\"\n        variant=\"contained\"\n        onClick={() => setDialogOpen(true)}\n      >\n        {resetButtonText}\n      </Button>\n      <FactoryResetDialog\n        onClose={() => setDialogOpen(false)}\n        open={dialogOpen}\n        onFactoryReset={onFactoryReset}\n      />\n    </>\n  )\n}\nResetComponent.propTypes = {\n  onFactoryReset: PropTypes.func.isRequired,\n  resetButtonText: PropTypes.string.isRequired,\n}\n\nconst FatalErrorDialog = ({\n  componentStack,\n  error,\n  onFactoryReset,\n  resetButtonText,\n}: {\n  componentStack: string\n  error: Error\n  onFactoryReset: Function\n  resetButtonText: string\n}) => {\n  return (\n    <Dialog open>\n      <DialogTitle style={{ backgroundColor: '#e88' }}>Fatal error</DialogTitle>\n      <DialogContent>\n        <pre>\n          {error.toString()}\n          {componentStack}\n        </pre>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => window.location.reload()}\n        >\n          Refresh\n        </Button>\n        <ResetComponent\n          onFactoryReset={onFactoryReset}\n          resetButtonText={resetButtonText}\n        />\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nFatalErrorDialog.propTypes = {\n  componentStack: PropTypes.string,\n  error: PropTypes.shape({}),\n  onFactoryReset: PropTypes.func.isRequired,\n  resetButtonText: PropTypes.string,\n}\n\nFatalErrorDialog.defaultProps = {\n  error: { message: 'No error message provided' },\n  componentStack: '',\n  resetButtonText: 'Factory Reset',\n}\n\nexport default FatalErrorDialog\n","import {\n  baseChordDisplayConfig,\n  BaseChordDisplayModel,\n} from '@jbrowse/plugin-circular-view'\n\nconst ChordVariantDisplayF = pluginManager => {\n  const { jbrequire } = pluginManager\n\n  const { types } = jbrequire('mobx-state-tree')\n  const { ConfigurationSchema, ConfigurationReference } = jbrequire(\n    '@jbrowse/core/configuration',\n  )\n  const { getContainingView } = jbrequire('@jbrowse/core/util')\n  const { getParentRenderProps } = jbrequire('@jbrowse/core/util/tracks')\n  const configSchema = ConfigurationSchema(\n    'ChordVariantDisplay',\n    {\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'StructuralVariantChordRenderer' },\n      ),\n    },\n    { baseConfiguration: baseChordDisplayConfig, explicitlyTyped: true },\n  )\n\n  const stateModel = types\n    .compose(\n      'ChordVariantDisplay',\n      BaseChordDisplayModel,\n      types.model({\n        type: types.literal('ChordVariantDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n      get renderProps() {\n        const view = getContainingView(self)\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n          radius: view.radiusPx,\n          blockDefinitions: this.blockDefinitions,\n          config: self.configuration.renderer,\n          onChordClick: self.onChordClick,\n        }\n      },\n    }))\n\n  return { stateModel, configSchema }\n}\n\n// http://localhost:3000/test_data/hs37d5.HG002-SequelII-CCS.sv.vcf.gz.tbi\n\n// render request is for 1.5x the current viewing window\n\n// tracks all have a height\n//\nexport default ChordVariantDisplayF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseChordDisplayComponentFactory } from '@jbrowse/plugin-circular-view'\nimport ChordVariantDisplay from './models/ChordVariantDisplay'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const DisplayType = lib['@jbrowse/core/pluggableElementTypes/DisplayType']\n\n  const { stateModel, configSchema } = load(ChordVariantDisplay)\n\n  return new DisplayType({\n    name: 'ChordVariantDisplay',\n    configSchema,\n    stateModel,\n    trackType: 'VariantTrack',\n    viewType: 'CircularView',\n    ReactComponent: BaseChordDisplayComponentFactory(pluginManager),\n  })\n}\n","import { getConf, ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  getContainingTrack,\n  getSession,\n  getContainingView,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\n\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { linearBasicDisplayModelFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport { LinearVariantDisplayConfigModel } from './configSchema'\n\nexport default function (configSchema: LinearVariantDisplayConfigModel) {\n  return types\n    .compose(\n      'LinearVariantDisplay',\n      linearBasicDisplayModelFactory(configSchema),\n      types.model({\n        type: types.literal('LinearVariantDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .actions(self => ({\n      async selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const { rpcManager } = session\n          const sessionId = getRpcSessionId(self)\n          const track = getContainingTrack(self)\n          const adapterConfig = getConf(track, 'adapter')\n          const header = await rpcManager.call(sessionId, 'CoreGetMetadata', {\n            adapterConfig,\n          })\n          const featureWidget = session.addWidget(\n            'VariantFeatureWidget',\n            'variantFeature',\n            {\n              featureData: feature.toJSON(),\n              view: getContainingView(self),\n              descriptions: header,\n            },\n          )\n          session.showWidget(featureWidget)\n        }\n\n        session.setSelection(feature)\n      },\n    }))\n}\n","const ChordRendererF = ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { useMemo } = jbrequire('react')\n  const { observer, PropTypes: MobxPropTypes } = jbrequire('mobx-react')\n  const { polarToCartesian } = jbrequire('@jbrowse/core/util')\n  const { readConfObject } = jbrequire('@jbrowse/core/configuration')\n\n  const { PropTypes: CommonPropTypes } = jbrequire(\n    '@jbrowse/core/util/types/mst',\n  )\n  const PropTypes = jbrequire('prop-types')\n\n  function bpToRadians(block, pos) {\n    const blockStart = block.region.elided ? 0 : block.region.start\n    const blockEnd = block.region.elided ? 0 : block.region.end\n    const bpOffset = block.flipped ? blockEnd - pos : pos - blockStart\n    const radians = bpOffset / block.bpPerRadian + block.startRadians\n    return radians\n  }\n\n  const Chord = observer(function Chord({\n    feature,\n    blocksForRefs,\n    radius,\n    config,\n    bezierRadius,\n    selected,\n    onClick,\n  }) {\n    // find the blocks that our start and end points belong to\n    const startBlock = blocksForRefs[feature.get('refName')]\n    if (!startBlock) {\n      return null\n    }\n    let svType\n    if (feature.get('INFO')) {\n      ;[svType] = feature.get('INFO').SVTYPE || []\n    } else if (feature.get('mate')) {\n      svType = 'mate'\n    }\n    let endPosition\n    let endBlock\n    if (svType === 'BND') {\n      // VCF BND\n      const breakendSpecification = (feature.get('ALT') || [])[0]\n      const matePosition = breakendSpecification.MatePosition.split(':')\n      endPosition = parseInt(matePosition[1], 10)\n      endBlock = blocksForRefs[matePosition[0]]\n    } else if (svType === 'TRA') {\n      // VCF TRA\n      const chr2 = ((feature.get('INFO') || {}).CHR2 || [])[0]\n      const end = ((feature.get('INFO') || {}).END || [])[0]\n      endPosition = parseInt(end, 10)\n      endBlock = blocksForRefs[chr2]\n    } else if (svType === 'mate') {\n      // generic simplefeatures arcs\n      const mate = feature.get('mate')\n      const chr2 = mate.refName\n      endPosition = mate.start\n      endBlock = blocksForRefs[chr2]\n    }\n    if (endBlock) {\n      const startPos = feature.get('start')\n      const startRadians = bpToRadians(startBlock, startPos)\n      const endRadians = bpToRadians(endBlock, endPosition)\n      const startXY = polarToCartesian(radius, startRadians)\n      const endXY = polarToCartesian(radius, endRadians)\n      const controlXY = polarToCartesian(\n        bezierRadius,\n        (endRadians + startRadians) / 2,\n      )\n\n      let strokeColor\n      if (selected) {\n        strokeColor = readConfObject(config, 'strokeColorSelected', { feature })\n      } else {\n        strokeColor = readConfObject(config, 'strokeColor', { feature })\n      }\n      const hoverStrokeColor = readConfObject(config, 'strokeColorHover', {\n        feature,\n      })\n      return (\n        <path\n          data-testid={`chord-${feature.id()}`}\n          d={['M', ...startXY, 'Q', ...controlXY, ...endXY].join(' ')}\n          style={{ stroke: strokeColor }}\n          onClick={evt =>\n            onClick(feature, startBlock.region, endBlock.region, evt)\n          }\n          onMouseOver={evt => {\n            if (!selected) {\n              evt.target.style.stroke = hoverStrokeColor\n            }\n          }}\n          onMouseOut={evt => {\n            if (!selected) {\n              evt.target.style.stroke = strokeColor\n            }\n          }}\n        />\n      )\n    }\n\n    return null\n  })\n\n  function StructuralVariantChords(props) {\n    const {\n      features,\n      config,\n      displayModel,\n      blockDefinitions,\n      radius,\n      bezierRadius,\n      displayModel: { selectedFeatureId },\n\n      onChordClick,\n    } = props\n    // make a map of refName -> blockDefinition\n    const blocksForRefsMemo = useMemo(() => {\n      const blocksForRefs = {}\n      blockDefinitions.forEach(block => {\n        const regions = block.region.elided\n          ? block.region.regions\n          : [block.region]\n        regions.forEach(region => {\n          blocksForRefs[region.refName] = block\n        })\n      })\n      return blocksForRefs\n    }, [blockDefinitions])\n    // console.log(blocksForRefs)\n    const chords = []\n    for (const [id, feature] of features) {\n      const selected = String(selectedFeatureId) === String(feature.id())\n      chords.push(\n        <Chord\n          key={id}\n          feature={feature}\n          config={config}\n          displayModel={displayModel}\n          radius={radius}\n          bezierRadius={bezierRadius}\n          blocksForRefs={blocksForRefsMemo}\n          selected={selected}\n          onClick={onChordClick}\n        />,\n      )\n    }\n    const trackStyleId = `chords-${displayModel.id}`\n    return (\n      <g id={trackStyleId} data-testid=\"structuralVariantChordRenderer\">\n        <style\n          // eslint-disable-next-line react/no-danger\n          dangerouslySetInnerHTML={{\n            __html: `\n          #${trackStyleId} > path {\n            cursor: crosshair;\n            fill: none;\n          }\n`,\n          }}\n        />\n        {chords}\n      </g>\n    )\n  }\n\n  StructuralVariantChords.propTypes = {\n    features: PropTypes.instanceOf(Map).isRequired,\n    config: CommonPropTypes.ConfigSchema.isRequired,\n    displayModel: MobxPropTypes.objectOrObservableObject,\n    blockDefinitions: PropTypes.arrayOf(MobxPropTypes.objectOrObservableObject)\n      .isRequired,\n    radius: PropTypes.number.isRequired,\n    bezierRadius: PropTypes.number.isRequired,\n    selectedFeatureId: PropTypes.string,\n    onChordClick: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n  }\n\n  StructuralVariantChords.defaultProps = {\n    displayModel: undefined,\n    selectedFeatureId: '',\n    onChordClick: undefined,\n  }\n\n  return observer(StructuralVariantChords)\n}\n\nexport default ChordRendererF\n","import ReactComponentFactory from './ReactComponent'\n\nconst ChordRendererConfigF = pluginManager => {\n  const { jbrequire } = pluginManager\n  const ChordRendererType = jbrequire(\n    '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  )\n  const { ConfigurationSchema } = jbrequire('@jbrowse/core/configuration')\n\n  const ReactComponent = jbrequire(ReactComponentFactory)\n  const configSchema = ConfigurationSchema(\n    'StructuralVariantChordRenderer',\n    {\n      strokeColor: {\n        type: 'color',\n        description: 'the line color of each arc',\n        defaultValue: 'rgba(255,133,0,0.32)',\n        contextVariable: ['feature'],\n      },\n      strokeColorSelected: {\n        type: 'color',\n        description: 'the line color of an arc that has been selected',\n        defaultValue: 'black',\n        contextVariable: ['feature'],\n      },\n      strokeColorHover: {\n        type: 'color',\n        description:\n          'the line color of an arc that is being hovered over with the mouse',\n        defaultValue: '#555',\n        contextVariable: ['feature'],\n      },\n    },\n    { explicitlyTyped: true },\n  )\n  return new ChordRendererType({\n    name: 'StructuralVariantChordRenderer',\n    ReactComponent,\n    configSchema,\n    pluginManager,\n  })\n}\n\nexport default ChordRendererConfigF\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('VariantFeatureWidget', {})\n\nexport function stateModelFactory(pluginManager) {\n  return types\n    .model('VariantFeatureWidget', {\n      id: ElementId,\n      type: types.literal('VariantFeatureWidget'),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      featureData: types.frozen(),\n      descriptions: types.frozen(),\n    })\n    .actions(self => ({\n      setFeatureData(data) {\n        self.featureData = data\n      },\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n    }))\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'VcfTabixAdapter',\n  {\n    vcfGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf.gz' },\n    },\n    index: ConfigurationSchema('VcfIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.vcf.gz.tbi' },\n      },\n    }),\n  },\n  { explicitlyTyped: true },\n)\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport ChordVariantDisplay from './ChordVariantDisplay'\nimport {\n  configSchemaFactory as linearVariantDisplayConfigSchemaFactory,\n  modelFactory as linearVariantDisplayModelFactory,\n} from './LinearVariantDisplay'\nimport StructuralVariantChordRendererFactory from './StructuralVariantChordRenderer'\nimport {\n  configSchema as variantFeatureWidgetConfigSchema,\n  stateModelFactory as variantFeatureWidgetStateModelFactory,\n} from './VariantFeatureWidget'\nimport { configSchema as vcfTabixAdapterConfigSchema } from './VcfTabixAdapter'\n\nexport default class VariantsPlugin extends Plugin {\n  name = 'VariantsPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'VcfTabixAdapter',\n          configSchema: vcfTabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./VcfTabixAdapter/VcfTabixAdapter').then(r => r.default),\n        }),\n    )\n\n    pluginManager.addRendererType(() =>\n      pluginManager.jbrequire(StructuralVariantChordRendererFactory),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'VariantTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'VariantTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'VariantTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() =>\n      pluginManager.jbrequire(ChordVariantDisplay),\n    )\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearVariantDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearVariantDisplay',\n        configSchema,\n        stateModel: linearVariantDisplayModelFactory(configSchema),\n        trackType: 'VariantTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'VariantFeatureWidget',\n          heading: 'Feature details',\n          configSchema: variantFeatureWidgetConfigSchema,\n          stateModel: variantFeatureWidgetStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./VariantFeatureWidget/VariantFeatureWidget'),\n          ),\n        }),\n    )\n  }\n}\n\nexport { default as VcfFeature } from './VcfTabixAdapter/VcfFeature'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\nexport function LinearVariantDisplayConfigFactory(\n  pluginManager: PluginManager,\n) {\n  const configSchema = linearBasicDisplayConfigSchemaFactory(pluginManager)\n\n  return ConfigurationSchema(\n    'LinearVariantDisplay',\n    {},\n    { baseConfiguration: configSchema, explicitlyTyped: true },\n  )\n}\n\nexport type LinearVariantDisplayConfigModel = ReturnType<\n  typeof LinearVariantDisplayConfigFactory\n>\nexport type LinearVariantDisplayConfig = Instance<\n  LinearVariantDisplayConfigModel\n>\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot, getParent } from 'mobx-state-tree'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport ListItem from '@material-ui/core/ListItem'\nimport Typography from '@material-ui/core/Typography'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Button from '@material-ui/core/Button'\nimport Tooltip from '@material-ui/core/Tooltip'\n\nimport IconButton from '@material-ui/core/IconButton'\nimport CloseIcon from '@material-ui/icons/Close'\nimport LockIcon from '@material-ui/icons/Lock'\n\nimport { getSession } from '@jbrowse/core/util'\nimport type { BasePlugin } from '@jbrowse/core/util/types'\nimport { isSessionWithSessionPlugins } from '@jbrowse/core/util/types'\nimport { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  closeDialog: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  dialogContainer: {\n    margin: 15,\n  },\n}))\n\nfunction LockedPlugin() {\n  return (\n    <Tooltip\n      style={{ marginRight: '0.5rem' }}\n      title=\"This plugin was installed by an admin. It cannot be removed.\"\n    >\n      <LockIcon />\n    </Tooltip>\n  )\n}\n\nfunction InstalledPlugin({\n  plugin,\n  model,\n}: {\n  plugin: BasePlugin\n  model: PluginStoreModel\n}) {\n  const classes = useStyles()\n\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  const session = getSession(model)\n  const sessionSnapShot = getSnapshot(session)\n  const { sessionPlugins } = sessionSnapShot\n  const isSessionPlugin = sessionPlugins?.some(\n    (p: BasePlugin) => `${p.name}Plugin` === plugin.name,\n  )\n\n  const rootModel = getParent(model, 3)\n  const { jbrowse, adminMode } = rootModel\n\n  return (\n    <>\n      <ListItem key={plugin.name}>\n        {adminMode || isSessionPlugin ? (\n          <IconButton\n            aria-label=\"removePlugin\"\n            data-testid={`removePlugin-${plugin.name}`}\n            onClick={() => setDialogOpen(true)}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : (\n          <LockedPlugin />\n        )}\n        <Typography>{plugin.name}</Typography>\n      </ListItem>\n      <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)}>\n        <DialogTitle>\n          <IconButton\n            className={classes.closeDialog}\n            aria-label=\"close-dialog\"\n            onClick={() => setDialogOpen(false)}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n        <div className={classes.dialogContainer}>\n          <>\n            <Typography>\n              Please confirm that you want to remove {plugin.name}:\n            </Typography>\n            <br />\n            <div style={{ display: 'flex', justifyContent: 'center' }}>\n              <Button\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={() => {\n                  setDialogOpen(false)\n                  // avoid showing runtime plugin warning\n                  window.setTimeout(() => {\n                    if (adminMode) {\n                      jbrowse.removePlugin(plugin.name)\n                    } else if (isSessionWithSessionPlugins(session)) {\n                      session.removeSessionPlugin(plugin.name)\n                    }\n                  }, 500)\n                }}\n              >\n                Confirm\n              </Button>\n            </div>\n          </>\n        </div>\n      </Dialog>\n    </>\n  )\n}\n\nexport default observer(InstalledPlugin)\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nimport List from '@material-ui/core/List'\nimport Typography from '@material-ui/core/Typography'\n\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type { BasePlugin } from '@jbrowse/core/util/types'\n\nimport { PluginStoreModel } from '../model'\nimport InstalledPlugin from './InstalledPlugin'\n\nfunction InstalledPluginsList({\n  pluginManager,\n  model,\n}: {\n  pluginManager: PluginManager\n  model: PluginStoreModel\n}) {\n  const { plugins } = pluginManager as PluginManager\n\n  const corePlugins = plugins\n    .filter(p => pluginManager.pluginMetadata[p.name]?.isCore)\n    .map(p => p.name)\n\n  const externalPlugins = plugins.filter(\n    plugin => !corePlugins.includes(plugin.name),\n  )\n\n  return (\n    <List>\n      {externalPlugins.length ? (\n        externalPlugins\n          .filter(plugin =>\n            plugin.name.toLowerCase().includes(model.filterText.toLowerCase()),\n          )\n          .map(plugin => (\n            <InstalledPlugin key={plugin.name} plugin={plugin} model={model} />\n          ))\n      ) : (\n        <Typography>No plugins currently installed</Typography>\n      )}\n    </List>\n  )\n}\n\nexport default observer(InstalledPluginsList)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv, getParent } from 'mobx-state-tree'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport Link from '@material-ui/core/Link'\nimport Typography from '@material-ui/core/Typography'\nimport Card from '@material-ui/core/Card'\nimport CardActions from '@material-ui/core/CardActions'\nimport CardContent from '@material-ui/core/CardContent'\nimport Button from '@material-ui/core/Button'\n\nimport PersonIcon from '@material-ui/icons/Person'\nimport AddIcon from '@material-ui/icons/Add'\nimport CheckIcon from '@material-ui/icons/Check'\n\nimport { getSession } from '@jbrowse/core/util'\nimport type { JBrowsePlugin } from '@jbrowse/core/util/types'\nimport { isSessionWithSessionPlugins } from '@jbrowse/core/util/types'\n\nimport type { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  card: {\n    margin: '1em',\n  },\n  icon: {\n    marginLeft: '0.5em',\n    marginRight: '0.5em',\n  },\n  bold: {\n    fontWeight: 600,\n  },\n  dataField: {\n    display: 'flex',\n    alignItems: 'center',\n    margin: '0.4em 0em',\n  },\n}))\n\nfunction PluginCard({\n  plugin,\n  model,\n  adminMode,\n}: {\n  plugin: JBrowsePlugin\n  model: PluginStoreModel\n  adminMode: boolean\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { pluginManager } = getEnv(model)\n  const isInstalled = pluginManager.hasPlugin(`${plugin.name}Plugin`)\n  const [tempDisabled, setTempDisabled] = useState(false)\n  const disableButton = isInstalled || tempDisabled\n\n  const rootModel = getParent(model, 3)\n  const { jbrowse } = rootModel\n\n  return (\n    <Card variant=\"outlined\" key={plugin.name} className={classes.card}>\n      <CardContent>\n        <div className={classes.dataField}>\n          <Typography variant=\"h5\">\n            <Link\n              href={`${plugin.location}#readme`}\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              {plugin.name}\n            </Link>\n          </Typography>\n        </div>\n        <div className={classes.dataField}>\n          <PersonIcon style={{ marginRight: '0.5em' }} />\n          <Typography>{plugin.authors.join(', ')}</Typography>\n        </div>\n        <Typography className={classes.bold}>Description:</Typography>\n        <Typography>{plugin.description}</Typography>\n      </CardContent>\n      <CardActions>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          disabled={disableButton}\n          startIcon={isInstalled ? <CheckIcon /> : <AddIcon />}\n          onClick={() => {\n            if (adminMode) {\n              jbrowse.addPlugin({ name: plugin.name, url: plugin.url })\n            } else if (isSessionWithSessionPlugins(session)) {\n              session.addSessionPlugin(plugin)\n            }\n            setTempDisabled(true)\n          }}\n        >\n          {isInstalled ? 'Installed' : 'Install'}\n        </Button>\n      </CardActions>\n    </Card>\n  )\n}\n\nexport default observer(PluginCard)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getRoot } from 'mobx-state-tree'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\n\nimport IconButton from '@material-ui/core/IconButton'\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  closeDialog: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  dialogContainer: {\n    margin: 15,\n    display: 'flex',\n    flexDirection: 'column',\n  },\n}))\n\nfunction CustomPluginForm({\n  open,\n  onClose,\n  model,\n}: {\n  open: boolean\n  onClose: Function\n  model: PluginStoreModel\n}) {\n  const classes = useStyles()\n  const [formInput, setFormInput] = useState({\n    name: '',\n    url: '',\n  })\n\n  const handleChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setFormInput({\n      ...formInput,\n      [event.target.name]: event.target.value,\n    })\n  }\n\n  const rootModel = getRoot(model)\n  const { jbrowse } = rootModel\n\n  const handleSubmit = () => {\n    jbrowse.addPlugin({ name: formInput.name, url: formInput.url })\n  }\n\n  return (\n    <Dialog open={open} onClose={() => onClose(false)}>\n      <DialogTitle>\n        <IconButton\n          className={classes.closeDialog}\n          aria-label=\"close-dialog\"\n          onClick={() => onClose(false)}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n\n      <div className={classes.dialogContainer}>\n        <TextField\n          id=\"name-input\"\n          name=\"name\"\n          label=\"Plugin name\"\n          variant=\"outlined\"\n          value={formInput.name}\n          onChange={handleChange}\n          multiline\n        />\n        <TextField\n          id=\"url-input\"\n          name=\"url\"\n          label=\"Plugin URL\"\n          variant=\"outlined\"\n          value={formInput.url}\n          onChange={handleChange}\n          multiline\n        />\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          style={{ marginTop: '1.5rem' }}\n          onClick={handleSubmit}\n        >\n          Add plugin\n        </Button>\n      </div>\n    </Dialog>\n  )\n}\n\nexport default observer(CustomPluginForm)\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\n\nimport {\n  Accordion,\n  AccordionSummary,\n  TextField,\n  InputAdornment,\n  Button,\n  IconButton,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\n\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ClearIcon from '@material-ui/icons/Clear'\nimport InfoOutlinedIcon from '@material-ui/icons/InfoOutlined'\n\nimport type { JBrowsePlugin, BasePlugin } from '@jbrowse/core/util/types'\n\nimport { getSession, isElectron } from '@jbrowse/core/util'\nimport InstalledPluginsList from './InstalledPluginsList'\nimport PluginCard from './PluginCard'\nimport CustomPluginForm from './CustomPluginForm'\n\nimport { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(theme => ({\n  accordion: {\n    marginTop: '1em',\n  },\n  expandIcon: {\n    color: '#fff',\n  },\n  searchBox: {\n    marginBottom: theme.spacing(2),\n  },\n  adminBadge: {\n    margin: '0.5em',\n    borderRadius: 3,\n    // this is the quaternary color in JB2 palette\n    backgroundColor: '#FFB11D',\n    padding: '1em',\n    display: 'flex',\n    alignContent: 'center',\n  },\n  customPluginButton: {\n    margin: '0.5em',\n    display: 'flex',\n    justifyContent: 'center',\n  },\n}))\n\nfunction PluginStoreWidget({ model }: { model: PluginStoreModel }) {\n  const classes = useStyles()\n  const [pluginArray, setPluginArray] = useState([])\n  const [customPluginFormOpen, setCustomPluginFormOpen] = useState(false)\n  const { adminMode } = getSession(model)\n  const { pluginManager } = getEnv(model)\n\n  useEffect(() => {\n    let killed = false\n\n    ;(async () => {\n      const fetchResult = await fetch(\n        'https://jbrowse.org/plugin-store/plugins.json',\n      )\n      if (!fetchResult.ok) {\n        throw new Error('Failed to fetch plugin data')\n      }\n      const array = await fetchResult.json()\n      if (!killed) {\n        setPluginArray(array.plugins)\n      }\n    })()\n\n    return () => {\n      killed = true\n    }\n  }, [])\n\n  return (\n    <div>\n      {adminMode && (\n        <>\n          {!isElectron && (\n            <div className={classes.adminBadge}>\n              <InfoOutlinedIcon style={{ marginRight: '0.3em' }} />\n              <Typography>\n                You are using the <code>admin-server</code>. Any changes you\n                make will be saved to your configuration file. You also have the\n                ability to add custom plugins that are not in the store.\n              </Typography>\n            </div>\n          )}\n          <div className={classes.customPluginButton}>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={() => setCustomPluginFormOpen(true)}\n            >\n              Add custom plugin\n            </Button>\n          </div>\n          <CustomPluginForm\n            open={customPluginFormOpen}\n            onClose={setCustomPluginFormOpen}\n            model={model}\n          />\n        </>\n      )}\n      <TextField\n        className={classes.searchBox}\n        label=\"Filter plugins\"\n        value={model.filterText}\n        onChange={event => model.setFilterText(event.target.value)}\n        fullWidth\n        InputProps={{\n          endAdornment: (\n            <InputAdornment position=\"end\">\n              <IconButton\n                color=\"secondary\"\n                onClick={() => model.clearFilterText()}\n              >\n                <ClearIcon />\n              </IconButton>\n            </InputAdornment>\n          ),\n        }}\n      />\n      <Accordion defaultExpanded>\n        <AccordionSummary\n          expandIcon={<ExpandMoreIcon className={classes.expandIcon} />}\n        >\n          <Typography variant=\"h5\">Installed plugins</Typography>\n        </AccordionSummary>\n        <div style={{ margin: '1em' }}>\n          <InstalledPluginsList pluginManager={pluginManager} model={model} />\n        </div>\n      </Accordion>\n      <Accordion defaultExpanded>\n        <AccordionSummary\n          expandIcon={<ExpandMoreIcon className={classes.expandIcon} />}\n        >\n          <Typography variant=\"h5\">Available plugins</Typography>\n        </AccordionSummary>\n        {pluginArray\n          .filter((plugin: BasePlugin) => {\n            return plugin.name\n              .toLowerCase()\n              .includes(model.filterText.toLowerCase())\n          })\n          .map(plugin => (\n            <PluginCard\n              key={(plugin as JBrowsePlugin).name}\n              plugin={plugin}\n              model={model}\n              adminMode={!!adminMode}\n            />\n          ))}\n      </Accordion>\n    </div>\n  )\n}\n\nexport default observer(PluginStoreWidget)\n","// this is all the stuff that the pluginManager re-exports for plugins to use\nimport React from 'react'\nimport * as ReactDom from 'react-dom'\nimport * as mobx from 'mobx'\nimport * as mst from 'mobx-state-tree'\nimport * as mxreact from 'mobx-react'\nimport PropTypes from 'prop-types'\n\nimport * as MUIStyles from '@material-ui/core/styles'\n\n// @material-ui components\nimport * as MUICore from '@material-ui/core'\nimport * as MUIUtils from '@material-ui/core/utils'\nimport MUISvgIcon from '@material-ui/core/SvgIcon'\nimport * as MUILab from '@material-ui/lab'\nimport * as MUIDataGrid from '@material-ui/data-grid'\nimport MUIBox from '@material-ui/core/Box'\nimport MUIButton from '@material-ui/core/Button'\nimport MUIButtonGroup from '@material-ui/core/ButtonGroup'\nimport MUICard from '@material-ui/core/Card'\nimport MUICardContent from '@material-ui/core/CardContent'\nimport MUICheckbox from '@material-ui/core/Checkbox'\nimport MUIContainer from '@material-ui/core/Container'\nimport MUIDialog from '@material-ui/core/Dialog'\nimport MUIFormLabel from '@material-ui/core/FormLabel'\nimport MUIFormControl from '@material-ui/core/FormControl'\nimport MUIFormControlLabel from '@material-ui/core/FormControlLabel'\nimport MUIFormGroup from '@material-ui/core/FormGroup'\nimport MUIGrid from '@material-ui/core/Grid'\nimport MUIIcon from '@material-ui/core/Icon'\nimport MUIIconButton from '@material-ui/core/IconButton'\nimport MUIInputAdornment from '@material-ui/core/InputAdornment'\nimport MUILinearProgress from '@material-ui/core/LinearProgress'\nimport MUIListItemIcon from '@material-ui/core/ListItemIcon'\nimport MUIListItemText from '@material-ui/core/ListItemText'\nimport MUIMenu from '@material-ui/core/Menu'\nimport MUIMenuItem from '@material-ui/core/MenuItem'\nimport MUIRadio from '@material-ui/core/Radio'\nimport MUIRadioGroup from '@material-ui/core/RadioGroup'\nimport MUISelect from '@material-ui/core/Select'\nimport MUISnackbar from '@material-ui/core/Snackbar'\nimport MUISnackbarContent from '@material-ui/core/SnackbarContent'\nimport MUITextField from '@material-ui/core/TextField'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport MUITypography from '@material-ui/core/Typography'\n\n// material-ui lab\nimport ToggleButton from '@material-ui/lab/ToggleButton'\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup'\n\nimport * as BaseAdapterExports from '../data_adapters/BaseAdapter'\n\nimport * as BaseFeatureDetail from '../BaseFeatureWidget/BaseFeatureDetail'\n\nimport Base1DView from '../util/Base1DViewModel'\nimport ViewType from '../pluggableElementTypes/ViewType'\nimport AdapterType from '../pluggableElementTypes/AdapterType'\nimport DisplayType from '../pluggableElementTypes/DisplayType'\nimport TrackType from '../pluggableElementTypes/TrackType'\nimport WidgetType from '../pluggableElementTypes/WidgetType'\n\nimport * as pluggableElementTypeModels from '../pluggableElementTypes/models'\nimport ServerSideRendererType from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport CircularChordRendererType from '../pluggableElementTypes/renderers/CircularChordRendererType'\nimport BoxRendererType from '../pluggableElementTypes/renderers/BoxRendererType'\n\nimport * as Configuration from '../configuration'\nimport Plugin from '../Plugin'\nimport * as coreUi from '../ui'\nimport * as coreUtil from '../util'\nimport * as coreColor from '../util/color'\nimport * as trackUtils from '../util/tracks'\nimport * as coreIo from '../util/io'\nimport * as coreMstReflection from '../util/mst-reflection'\nimport * as rxjs from '../util/rxjs'\nimport * as MUIColors from './material-ui-colors'\nimport * as mstTypes from '../util/types/mst'\n\nimport ReExportsList from './list'\n\nconst libs = {\n  mobx,\n  'mobx-state-tree': mst,\n  react: React,\n  'react-dom': ReactDom,\n  'mobx-react': mxreact,\n  'prop-types': PropTypes,\n\n  // material-ui 1st-level components\n  '@material-ui/core': MUICore,\n  // special case so plugins can easily use @material-ui/icons; don't remove\n  '@material-ui/core/SvgIcon': MUISvgIcon,\n  '@material-ui/core/utils': MUIUtils,\n  // end special case\n  '@material-ui/lab': MUILab,\n  '@material-ui/data-grid': MUIDataGrid,\n\n  // material-ui subcomponents, should get rid of these\n  '@material-ui/core/colors': MUIColors,\n  '@material-ui/core/styles': MUIStyles,\n  '@material-ui/core/Box': MUIBox,\n  '@material-ui/core/Button': MUIButton,\n  '@material-ui/core/ButtonGroup': MUIButtonGroup,\n  '@material-ui/core/Card': MUICard,\n  '@material-ui/core/CardContent': MUICardContent,\n  '@material-ui/core/Container': MUIContainer,\n  '@material-ui/core/Checkbox': MUICheckbox,\n  '@material-ui/core/Dialog': MUIDialog,\n  '@material-ui/core/FormGroup': MUIFormGroup,\n  '@material-ui/core/FormLabel': MUIFormLabel,\n  '@material-ui/core/FormControl': MUIFormControl,\n  '@material-ui/core/FormControlLabel': MUIFormControlLabel,\n  '@material-ui/core/Grid': MUIGrid,\n  '@material-ui/core/Icon': MUIIcon,\n  '@material-ui/core/IconButton': MUIIconButton,\n  '@material-ui/core/InputAdornment': MUIInputAdornment,\n  '@material-ui/core/LinearProgress': MUILinearProgress,\n  '@material-ui/core/ListItemIcon': MUIListItemIcon,\n  '@material-ui/core/ListItemText': MUIListItemText,\n  '@material-ui/core/Menu': MUIMenu,\n  '@material-ui/core/MenuItem': MUIMenuItem,\n  '@material-ui/core/RadioGroup': MUIRadioGroup,\n  '@material-ui/core/Radio': MUIRadio,\n  '@material-ui/core/Select': MUISelect,\n  '@material-ui/core/Snackbar': MUISnackbar,\n  '@material-ui/core/SnackbarContent': MUISnackbarContent,\n  '@material-ui/core/TextField': MUITextField,\n  '@material-ui/core/Tooltip': MUITooltip,\n  '@material-ui/core/Typography': MUITypography,\n\n  // @material-ui lab\n  '@material-ui/lab/ToggleButton': ToggleButton,\n  '@material-ui/lab/ToggleButtonGroup': ToggleButtonGroup,\n\n  '@jbrowse/core/Plugin': Plugin,\n  '@jbrowse/core/pluggableElementTypes/ViewType': ViewType,\n  '@jbrowse/core/pluggableElementTypes/AdapterType': AdapterType,\n  '@jbrowse/core/pluggableElementTypes/DisplayType': DisplayType,\n  '@jbrowse/core/pluggableElementTypes/TrackType': TrackType,\n  '@jbrowse/core/pluggableElementTypes/WidgetType': WidgetType,\n\n  '@jbrowse/core/pluggableElementTypes/models': pluggableElementTypeModels,\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType': ServerSideRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType': CircularChordRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType': BoxRendererType,\n  '@jbrowse/core/configuration': Configuration,\n  '@jbrowse/core/util/types/mst': mstTypes,\n  '@jbrowse/core/ui': coreUi,\n  '@jbrowse/core/util': coreUtil,\n  '@jbrowse/core/util/color': coreColor,\n  '@jbrowse/core/util/tracks': trackUtils,\n  '@jbrowse/core/util/Base1DViewModel': Base1DView,\n  '@jbrowse/core/util/io': coreIo,\n  '@jbrowse/core/util/mst-reflection': coreMstReflection,\n  '@jbrowse/core/util/rxjs': rxjs,\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail': BaseFeatureDetail,\n\n  '@jbrowse/core/data_adapters/BaseAdapter': BaseAdapterExports,\n}\n\n// make sure that all the items in the ReExports/list array (used by build systems and such)\n// are included here. it's OK if there are some additional ones that are not in the list\nReExportsList.forEach(name => {\n  if (!(name in libs)) {\n    throw new Error(`ReExports/modules is missing ${name}`)\n  }\n})\n\nexport default libs\n","export default [\n  'mobx',\n  'mobx-state-tree',\n  'react',\n  'react-dom',\n  'mobx-react',\n  'prop-types',\n\n  '@material-ui/core',\n  '@material-ui/core/SvgIcon',\n  '@material-ui/core/utils',\n  '@material-ui/lab',\n  '@material-ui/data-grid',\n\n  '@jbrowse/core/Plugin',\n  '@jbrowse/core/pluggableElementTypes/ViewType',\n  '@jbrowse/core/pluggableElementTypes/AdapterType',\n  '@jbrowse/core/pluggableElementTypes/DisplayType',\n  '@jbrowse/core/pluggableElementTypes/TrackType',\n  '@jbrowse/core/pluggableElementTypes/WidgetType',\n\n  '@jbrowse/core/pluggableElementTypes/models',\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType',\n  '@jbrowse/core/configuration',\n  '@jbrowse/core/util/types/mst',\n  '@jbrowse/core/ui',\n  '@jbrowse/core/util',\n  '@jbrowse/core/util/color',\n  '@jbrowse/core/util/tracks',\n  '@jbrowse/core/util/Base1DViewModel',\n  '@jbrowse/core/util/io',\n  '@jbrowse/core/util/mst-reflection',\n  '@jbrowse/core/util/rxjs',\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail',\n\n  '@jbrowse/core/data_adapters/BaseAdapter',\n]\n","import modules from './modules'\n\nexport default modules\n","import PluginManager from './PluginManager'\nimport { AnyConfigurationSchemaType } from './configuration/configurationSchema'\n\n/**\n * base class for a JBrowse plugin\n */\nexport default abstract class Plugin {\n  abstract name: string\n\n  url?: string\n\n  version?: string\n\n  install(_pluginManager: PluginManager): void {}\n\n  configure(_pluginManager: PluginManager): void {}\n\n  configurationSchema: AnyConfigurationSchemaType | undefined = undefined\n}\n\nexport type PluginConstructor = new (...args: unknown[]) => Plugin\n","import { Observable, merge } from 'rxjs'\nimport { takeUntil } from 'rxjs/operators'\nimport { isStateTreeNode, getSnapshot } from 'mobx-state-tree'\nimport { ObservableCreate } from '../util/rxjs'\nimport { checkAbortSignal, hashCode, observeAbortSignal } from '../util'\nimport { Feature } from '../util/simpleFeature'\nimport {\n  AnyConfigurationModel,\n  ConfigurationSchema,\n} from '../configuration/configurationSchema'\nimport { getSubAdapterType } from './dataAdapterCache'\nimport { Region, NoAssemblyRegion } from '../util/types'\nimport { blankStats, rectifyStats, scoresToStats } from '../util/stats'\n\nexport interface BaseOptions {\n  signal?: AbortSignal\n  bpPerPx?: number\n  sessionId?: string\n  statusCallback?: (message: string) => void\n  headers?: Record<string, string>\n  [key: string]: unknown\n}\n\n// see\n// https://www.typescriptlang.org/docs/handbook/2/classes.html#abstract-construct-signatures\n// for why this is the abstract construct signature\nexport interface AnyAdapter {\n  new (\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n  ): AnyDataAdapter\n}\n\nexport type AnyDataAdapter =\n  | BaseAdapter\n  | BaseFeatureDataAdapter\n  | BaseRefNameAliasAdapter\n  | RegionsAdapter\n  | SequenceAdapter\n\n// generates a short \"id fingerprint\" from the config passed to the base\n// feature adapter by recursively enumerating props, but if config is too big\n// does not process entire config (FromConfigAdapter for example can be large)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction idMaker(args: any, id = '') {\n  const keys = Object.keys(args)\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i]\n    if (id.length > 5000) {\n      break\n    }\n    if (typeof args[key] === 'object' && args[key]) {\n      id += idMaker(args[key], id)\n    } else {\n      id += `${key}-${args[key]};`\n    }\n  }\n  return hashCode(id)\n}\n\nexport abstract class BaseAdapter {\n  public id: string\n\n  static capabilities = [] as string[]\n\n  config: AnyConfigurationModel\n\n  getSubAdapter?: getSubAdapterType\n\n  constructor(\n    config: AnyConfigurationModel = ConfigurationSchema('empty', {}).create(),\n    getSubAdapter?: getSubAdapterType,\n  ) {\n    this.config = config\n    this.getSubAdapter = getSubAdapter\n    // note: we use switch on jest here for more simple feature IDs\n    // in test environment\n    if (typeof jest === 'undefined') {\n      const data = isStateTreeNode(config) ? getSnapshot(config) : config\n      this.id = `${idMaker(data)}`\n    } else {\n      this.id = 'test'\n    }\n  }\n\n  /**\n   * Called to provide a hint that data tied to a certain region will not be\n   * needed for the forseeable future and can be purged from caches, etc\n   * @param region - Region\n   */\n  public abstract freeResources(region: Region): void\n}\n\n/**\n * Base class for feature adapters to extend. Defines some methods that\n * subclasses must implement.\n */\nexport abstract class BaseFeatureDataAdapter extends BaseAdapter {\n  /**\n   * Get all reference sequence names used in the data source\n   *\n   * NOTE: If an adapter is unable to determine the reference sequence names,\n   * the array will be empty\n   * @param opts - Feature adapter options\n   */\n  public abstract async getRefNames(opts?: BaseOptions): Promise<string[]>\n  // public abstract async getRefNames(opts?: BaseOptions): Promise<string[]>\n  //   await this.setup()\n  //   const { refNames } = this.metadata\n  //   return refNames\n  // }\n\n  /**\n   * Get features from the data source that overlap a region\n   * @param region - Region\n   * @param options - Feature adapter options\n   * @returns Observable of Feature objects in the region\n   */\n  public abstract getFeatures(\n    region: Region,\n    opts?: BaseOptions,\n  ): Observable<Feature>\n  // public abstract getFeatures(\n  //   region: Region,\n  //   opts: BaseOptions,\n  // ): Observable<Feature> {\n  //   return ObservableCreate(observer => {\n  //     const records = getRecords(assembly, refName, start, end)\n  //     records.forEach(record => {\n  //       observer.next(this.recordToFeature(record))\n  //     })\n  //     observer.complete()\n  //   })\n  // }\n\n  /**\n   * Return \"header info\" that is fetched from the data file, or other info\n   * that would not simply be in the config of the file. The return value can\n   * be `{tag:string, data: any}[]` e.g. list of tags with their values which\n   * is how VCF,BAM,CRAM return values for getInfo or it can be a nested JSON\n   * object\n   */\n  public async getHeader(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Return info that is primarily used for interpreting the data that is there,\n   * primarily in reference to being used for augmenting feature details panels\n   */\n  public async getMetadata(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   */\n  public getFeaturesInRegion(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const hasData = await this.hasDataForRefName(region.refName, opts)\n      checkAbortSignal(opts.signal)\n      if (!hasData) {\n        // console.warn(`no data for ${region.refName}`)\n        observer.complete()\n      } else {\n        this.getFeatures(region, opts)\n          .pipe(takeUntil(observeAbortSignal(opts.signal)))\n          .subscribe(observer)\n      }\n    })\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters\n   * that are frequently called on multiple regions simultaneously may\n   * want to implement a more efficient custom version of this method.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   * @param regions - Regions\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the regions\n   */\n  public getFeaturesInMultipleRegions(\n    regions: Region[],\n    opts: BaseOptions = {},\n  ) {\n    const obs = merge(\n      ...regions.map(region => {\n        return ObservableCreate<Feature>(async observer => {\n          const hasData = await this.hasDataForRefName(region.refName, opts)\n          checkAbortSignal(opts.signal)\n          if (!hasData) {\n            // console.warn(`no data for ${region.refName}`)\n            observer.complete()\n          } else {\n            this.getFeatures(region, opts).subscribe(observer)\n          }\n        })\n      }),\n    )\n\n    if (opts.signal) {\n      return obs.pipe(takeUntil(observeAbortSignal(opts.signal)))\n    }\n    return obs\n  }\n\n  /**\n   * Check if the store has data for the given reference name.\n   * @param refName - Name of the reference sequence\n   * @returns Whether data source has data for the given reference name\n   */\n  public async hasDataForRefName(refName: string, opts: BaseOptions = {}) {\n    const refNames = await this.getRefNames(opts)\n    return refNames.includes(refName)\n  }\n\n  public async getRegionStats(region: Region, opts?: BaseOptions) {\n    const feats = this.getFeatures(region, opts)\n    return scoresToStats(region, feats)\n  }\n\n  public async getMultiRegionStats(regions: Region[] = [], opts?: BaseOptions) {\n    if (!regions.length) {\n      return blankStats()\n    }\n    const feats = await Promise.all(\n      regions.map(region => this.getRegionStats(region, opts)),\n    )\n\n    const scoreMax = feats\n      .map(s => s.scoreMax)\n      .reduce((acc, curr) => Math.max(acc, curr))\n    const scoreMin = feats\n      .map(s => s.scoreMin)\n      .reduce((acc, curr) => Math.min(acc, curr))\n    const scoreSum = feats.map(s => s.scoreSum).reduce((a, b) => a + b, 0)\n    const scoreSumSquares = feats\n      .map(s => s.scoreSumSquares)\n      .reduce((a, b) => a + b, 0)\n    const featureCount = feats\n      .map(s => s.featureCount)\n      .reduce((a, b) => a + b, 0)\n    const basesCovered = feats\n      .map(s => s.basesCovered)\n      .reduce((a, b) => a + b, 0)\n\n    return rectifyStats({\n      scoreMin,\n      scoreMax,\n      featureCount,\n      basesCovered,\n      scoreSumSquares,\n      scoreSum,\n    })\n  }\n}\n\nexport interface RegionsAdapter extends BaseAdapter {\n  getRegions(opts: BaseOptions): Promise<NoAssemblyRegion[]>\n}\n\nexport interface SequenceAdapter\n  extends BaseFeatureDataAdapter,\n    RegionsAdapter {}\n\nexport function isSequenceAdapter(\n  thing: AnyDataAdapter,\n): thing is SequenceAdapter {\n  return 'getRegions' in thing && 'getFeatures' in thing\n}\n\nexport function isRegionsAdapter(\n  thing: AnyDataAdapter,\n): thing is RegionsAdapter {\n  return 'getRegions' in thing\n}\n\nexport function isFeatureAdapter(\n  thing: AnyDataAdapter,\n): thing is BaseFeatureDataAdapter {\n  return 'getFeatures' in thing\n}\n\nexport interface Alias {\n  refName: string\n  aliases: string[]\n}\nexport interface BaseRefNameAliasAdapter extends BaseAdapter {\n  getRefNameAliases(opts: BaseOptions): Promise<Alias[]>\n}\nexport function isRefNameAliasAdapter(\n  thing: object,\n): thing is BaseRefNameAliasAdapter {\n  return 'getRefNameAliases' in thing\n}\n","// import tenaciousFetch from 'tenacious-fetch'\n\nimport { HttpRangeFetcher } from 'http-range-fetcher'\nimport { Buffer } from 'buffer'\nimport { RemoteFile, GenericFilehandle } from 'generic-filehandle'\n\n// function unReplacePath() {\n//   throw new Error('unimplemented') // TODO\n// }\n\nfunction getfetch(url: RequestInfo, opts: RequestInit = {}): Promise<Response> {\n  return fetch(url, {\n    method: 'GET',\n    credentials: 'same-origin',\n    // retries: 5,\n    // retryDelay: 1000, // 1 sec, 2 sec, 3 sec\n    // retryStatus: [500, 404, 503],\n    // onRetry: ({ retriesLeft }: { retriesLeft: number }) => {\n    //   console.warn(\n    //     `${url} request failed, retrying (${retriesLeft} retries left)`,\n    //   )\n    // },\n    ...opts,\n  })\n}\n\nasync function fetchBinaryRange(\n  url: string,\n  start: number,\n  end: number,\n  options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n) {\n  const requestDate = new Date()\n  const requestHeaders = { ...options.headers, range: `bytes=${start}-${end}` }\n  const res = await getfetch(url, {\n    ...options,\n    headers: requestHeaders,\n    // onRetry: ({ retriesLeft }: { retriesLeft: number }) => {\n    //   console.warn(\n    //     `${url} bytes ${start}-${end} request failed, retrying (${retriesLeft} retries left)`,\n    //   )\n    // },\n  })\n  const responseDate = new Date()\n  if (res.status !== 206 && res.status !== 200) {\n    throw new Error(\n      `HTTP ${res.status} when fetching ${url} bytes ${start}-${end}`,\n    )\n  }\n\n  // translate the Headers object into a regular key -> value object.\n  // will miss duplicate headers of course\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const headers: Record<string, any> = {}\n  for (const [k, v] of res.headers.entries()) {\n    headers[k] = v\n  }\n\n  if (res.status === 200) {\n    throw new Error(\n      `HTTP ${res.status} when fetching ${url} bytes ${start}-${end}`,\n    )\n  }\n\n  // return the response headers, and the data buffer\n  const arrayBuffer = await res.arrayBuffer()\n  return {\n    headers,\n    requestDate,\n    responseDate,\n    buffer: Buffer.from(arrayBuffer),\n  }\n}\n\nconst globalRangeCache = new HttpRangeFetcher({\n  fetch: fetchBinaryRange,\n  size: 500 * 1024 * 1024, // 500MB\n  chunkSize: 2 ** 17, // 128KB\n  maxFetchSize: 100 * 1024 * 1024,\n  minimumTTL: 300000000,\n})\n\nasync function globalCacheFetch(\n  url: RequestInfo,\n  opts?: RequestInit,\n): Promise<Response> {\n  // if it is a range request, route it through the global range cache\n  const requestHeaders = opts && opts.headers\n  let range\n  if (requestHeaders) {\n    if (requestHeaders instanceof Headers) {\n      range = requestHeaders.get('range')\n    } else if (Array.isArray(requestHeaders)) {\n      ;[, range] = requestHeaders.find(([key]) => key === 'range') || [\n        undefined,\n        undefined,\n      ]\n    } else {\n      range = requestHeaders.range\n    }\n  }\n  if (range) {\n    const rangeParse = /bytes=(\\d+)-(\\d+)/.exec(range)\n    if (rangeParse) {\n      const [, start, end] = rangeParse\n      const s = parseInt(start, 10)\n      const e = parseInt(end, 10)\n      const response = await (globalRangeCache.getRange(url, s, e - s + 1, {\n        signal: opts && opts.signal,\n      }) as ReturnType<typeof fetchBinaryRange>)\n      const { headers } = response\n      return new Response(response.buffer, { status: 206, headers })\n    }\n  }\n\n  return getfetch(url, opts)\n}\nexport function clearCache() {\n  globalRangeCache.reset()\n}\n\nexport function openUrl(url: string): GenericFilehandle {\n  return new RemoteFile(String(url), {\n    fetch: globalCacheFetch,\n  })\n}\n","import { LocalFile, BlobFile, GenericFilehandle } from 'generic-filehandle'\nimport ElectronLocalFile from './ElectronLocalFile'\nimport ElectronRemoteFile from './ElectronRemoteFile'\nimport { openUrl as rangeFetcherOpenUrl } from './rangeFetcher'\nimport {\n  FileLocation,\n  LocalPathLocation,\n  UriLocation,\n  BlobLocation,\n} from '../types'\nimport { getBlob } from '../tracks'\n\ndeclare global {\n  interface Window {\n    electron?: import('electron').AllElectron\n  }\n}\n\n// this is recommended in a later comment in https://github.com/electron/electron/issues/2288\n// for detecting electron in a renderer process, which is the one that has node enabled for us\n// const isElectron = process.versions.electron\n// const i2 = process.versions.hasOwnProperty('electron')\nconst isElectron = /electron/i.test(\n  typeof navigator !== 'undefined' ? navigator.userAgent : '',\n)\n\nexport const openUrl = (arg: string) => {\n  return isElectron ? new ElectronRemoteFile(arg) : rangeFetcherOpenUrl(arg)\n}\n\nfunction isUriLocation(location: FileLocation): location is UriLocation {\n  return 'uri' in location\n}\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\nexport function openLocation(location: FileLocation): GenericFilehandle {\n  if (!location) {\n    throw new Error('must provide a location to openLocation')\n  }\n  if (isElectron) {\n    if (isUriLocation(location)) {\n      return new ElectronRemoteFile(location.uri)\n    }\n    if (isLocalPathLocation(location)) {\n      return new ElectronLocalFile(location.localPath)\n    }\n  } else {\n    if (isUriLocation(location)) {\n      return openUrl(\n        location.baseUri\n          ? new URL(location.uri, location.baseUri).href\n          : location.uri,\n      )\n    }\n    if (isLocalPathLocation(location)) {\n      return new LocalFile(location.localPath)\n    }\n  }\n  if (isBlobLocation(location)) {\n    // special case where blob is not directly stored on the model, use a getter\n    const blob = getBlob(location.blobId)\n    if (!blob) {\n      throw new Error(\n        `file (\"${location.name}\") was opened locally from a previous session. To restore it, go to track settings and reopen the file`,\n      )\n    }\n    return new BlobFile(blob)\n  }\n  throw new Error('invalid fileLocation')\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const baseLinearDisplayConfigSchema = ConfigurationSchema(\n  'BaseLinearDisplay',\n  {\n    maxDisplayedBpPerPx: {\n      type: 'number',\n      description: 'maximum bpPerPx that is displayed in the view',\n      defaultValue: Number.MAX_VALUE,\n    },\n  },\n  { explicitIdentifier: 'displayId' },\n)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observer, PropTypes } from 'mobx-react'\nimport React from 'react'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from './Block'\n\nconst useStyles = makeStyles({\n  linearBlocks: {\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    position: 'absolute',\n    minHeight: '100%',\n    display: 'flex',\n  },\n  heightOverflowed: {\n    position: 'absolute',\n    color: 'rgb(77,77,77)',\n    borderBottom: '2px solid rgb(77,77,77)',\n    textShadow: 'white 0px 0px 1px',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    fontWeight: 'bold',\n    textAlign: 'center',\n    zIndex: 2000,\n    boxSizing: 'border-box',\n  },\n})\nconst RenderedBlocks = observer(\n  ({ model }: { model: BaseLinearDisplayModel }) => {\n    const classes = useStyles()\n    const { blockDefinitions, blockState } = model\n    return (\n      <>\n        {blockDefinitions.map(block => {\n          if (block instanceof ContentBlock) {\n            const state = blockState.get(block.key)\n\n            return (\n              <ContentBlockComponent\n                block={block}\n                key={`${model.id}-${block.key}`}\n              >\n                {state && state.ReactComponent ? (\n                  <state.ReactComponent model={state} />\n                ) : null}\n                {state && state.maxHeightReached ? (\n                  <div\n                    className={classes.heightOverflowed}\n                    style={{\n                      top: state.layout.getTotalHeight() - 16,\n                      pointerEvents: 'none',\n                      height: 16,\n                    }}\n                  >\n                    Max height reached\n                  </div>\n                ) : null}\n              </ContentBlockComponent>\n            )\n          }\n          if (block instanceof ElidedBlock) {\n            return (\n              <ElidedBlockComponent\n                key={`${model.id}-${block.key}`}\n                width={block.widthPx}\n              />\n            )\n          }\n          if (block instanceof InterRegionPaddingBlock) {\n            return (\n              <InterRegionPaddingBlockComponent\n                key={block.key}\n                width={block.widthPx}\n                style={{ background: 'none' }}\n                boundary={block.variant === 'boundary'}\n              />\n            )\n          }\n          throw new Error(`invalid block type ${typeof block}`)\n        })}\n      </>\n    )\n  },\n)\nfunction LinearBlocks({ model }: { model: BaseLinearDisplayModel }) {\n  const classes = useStyles()\n  const { blockDefinitions } = model\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const viewModel = getContainingView(model) as any\n  return (\n    <div\n      data-testid=\"Blockset\"\n      className={classes.linearBlocks}\n      style={{\n        left: blockDefinitions.offsetPx - viewModel.offsetPx,\n      }}\n    >\n      <RenderedBlocks model={model} />\n    </div>\n  )\n}\n\nLinearBlocks.propTypes = {\n  model: PropTypes.observableObject.isRequired,\n}\n\nexport { RenderedBlocks, useStyles }\nexport default observer(LinearBlocks)\n","import { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { useTheme, makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React, { useState, useRef } from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport LinearBlocks from './LinearBlocks'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nconst useStyles = makeStyles({\n  display: {\n    position: 'relative',\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    width: '100%',\n    minHeight: '100%',\n  },\n})\nconst Tooltip = observer(\n  (props: { model: BaseLinearDisplayModel; mouseCoord: [number, number] }) => {\n    const { model, mouseCoord } = props\n    const { featureUnderMouse } = model\n    const mouseover = featureUnderMouse\n      ? getConf(model, 'mouseover', { feature: featureUnderMouse })\n      : undefined\n    return mouseover ? (\n      <MUITooltip title={mouseover} open placement=\"right\">\n        <div\n          style={{\n            position: 'absolute',\n            left: mouseCoord[0],\n            top: mouseCoord[1],\n          }}\n        >\n          {' '}\n        </div>\n      </MUITooltip>\n    ) : null\n  },\n)\n\ntype Coord = [number, number]\nconst BaseLinearDisplay = observer(\n  (props: { model: BaseLinearDisplayModel; children?: React.ReactNode }) => {\n    const classes = useStyles()\n    const theme = useTheme()\n\n    const [mouseCoord, setMouseCoord] = useState<Coord>([0, 0])\n    const [contextCoord, setContextCoord] = useState<Coord>()\n    const ref = useRef<HTMLDivElement>(null)\n    const { model, children } = props\n    const {\n      TooltipComponent,\n      DisplayMessageComponent,\n      contextMenuItems,\n      height,\n      setContextMenuFeature,\n    } = model\n\n    return (\n      <div\n        ref={ref}\n        data-testid={`display-${getConf(model, 'displayId')}`}\n        className={classes.display}\n        onContextMenu={event => {\n          event.preventDefault()\n          if (contextCoord) {\n            // There's already a context menu open, so close it\n            setContextCoord(undefined)\n          } else if (ref.current) {\n            setContextCoord([event.clientX, event.clientY])\n          }\n        }}\n        onMouseMove={event => {\n          if (ref.current) {\n            const rect = ref.current.getBoundingClientRect()\n            setMouseCoord([event.clientX - rect.left, event.clientY - rect.top])\n          }\n        }}\n        role=\"presentation\"\n      >\n        {DisplayMessageComponent ? (\n          <DisplayMessageComponent model={model} />\n        ) : (\n          <LinearBlocks {...props} />\n        )}\n        {children}\n        <TooltipComponent\n          model={model}\n          height={height}\n          mouseCoord={mouseCoord}\n        />\n\n        <Menu\n          open={Boolean(contextCoord) && Boolean(contextMenuItems.length)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setContextCoord(undefined)\n          }}\n          onClose={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          onExit={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={\n            contextCoord\n              ? { top: contextCoord[1], left: contextCoord[0] }\n              : undefined\n          }\n          style={{ zIndex: theme.zIndex.tooltip }}\n          menuItems={contextMenuItems}\n          data-testid=\"base_linear_display_context_menu\"\n        />\n      </div>\n    )\n  },\n)\n\nexport default BaseLinearDisplay\nexport { Tooltip }\n","import React, { useEffect, useState } from 'react'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Button from '@material-ui/core/Button'\nimport RefreshIcon from '@material-ui/icons/Refresh'\n\nconst useStyles = makeStyles(theme => ({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: theme.palette.action.disabledBackground,\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n  blockMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n  blockError: {\n    padding: theme.spacing(2),\n    width: '100%',\n    whiteSpace: 'normal',\n    color: theme.palette.error.main,\n    overflowY: 'auto',\n  },\n  blockReactNodeMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    textAlign: 'center',\n  },\n  dots: {\n    '&::after': {\n      display: 'inline-block',\n      animation: '$ellipsis 1.5s infinite',\n      content: '\".\"',\n      width: '1em',\n      textAlign: 'left',\n    },\n  },\n  '@keyframes ellipsis': {\n    '0%': {\n      content: '\".\"',\n    },\n    '33%': {\n      content: '\"..\"',\n    },\n    '66%': {\n      content: '\"...\"',\n    },\n  },\n}))\n\nfunction Repeater({ children }: { children: React.ReactNode }) {\n  return (\n    <div style={{ display: 'flex' }}>\n      {children}\n      {children}\n    </div>\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LoadingMessage = observer(({ model }: { model: any }) => {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    let killed = false\n    const timeout = setTimeout(() => {\n      if (!killed) {\n        setShown(true)\n      }\n    }, 300)\n    return () => {\n      clearTimeout(timeout)\n      killed = true\n    }\n  }, [])\n\n  const { status: blockStatus } = model\n  const { message: displayStatus } = getParent(model, 2)\n  const status = displayStatus || blockStatus\n  return (\n    <>\n      {shown ? (\n        <div className={classes.loading}>\n          <div className={classes.dots}>{status ? `${status}` : 'Loading'}</div>\n        </div>\n      ) : null}\n    </>\n  )\n})\n\nfunction BlockMessage({\n  messageContent,\n}: {\n  messageContent: string | React.ReactNode\n}) {\n  const classes = useStyles()\n\n  return typeof messageContent === 'string' ? (\n    <Typography variant=\"body2\" className={classes.blockMessage}>\n      {messageContent}\n    </Typography>\n  ) : (\n    <div className={classes.blockReactNodeMessage}>{messageContent}</div>\n  )\n}\n\nfunction BlockError({\n  error,\n  reload,\n  displayHeight,\n}: {\n  error: Error\n  reload: () => void\n  displayHeight: number\n}) {\n  const classes = useStyles()\n  return (\n    <div className={classes.blockError} style={{ height: displayHeight }}>\n      {reload ? (\n        <>\n          <Button\n            data-testid=\"reload_button\"\n            onClick={reload}\n            startIcon={<RefreshIcon />}\n          >\n            Reload\n          </Button>\n          {`${error}`}\n        </>\n      ) : (\n        <Typography color=\"error\" variant=\"body2\">\n          {`${error}`}\n        </Typography>\n      )}\n    </div>\n  )\n}\n\nconst ServerSideRenderedBlockContent = observer(\n  ({\n    model,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    model: any\n  }) => {\n    if (model.error) {\n      return (\n        <Repeater>\n          <BlockError\n            error={model.error}\n            reload={model.reload}\n            displayHeight={getParentRenderProps(model).displayModel.height}\n          />\n        </Repeater>\n      )\n    }\n    if (model.message) {\n      return (\n        <Repeater>\n          <BlockMessage messageContent={model.message} />\n        </Repeater>\n      )\n    }\n    if (!model.filled) {\n      return (\n        <Repeater>\n          <LoadingMessage model={model} />\n        </Repeater>\n      )\n    }\n    return model.reactElement\n  },\n)\n\nexport default ServerSideRenderedBlockContent\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, getParent, isAlive, cast, Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport { AbstractDisplayModel } from '@jbrowse/core/util/types'\nimport React from 'react'\n\nimport {\n  assembleLocString,\n  makeAbortableReaction,\n  getSession,\n  getContainingDisplay,\n} from '@jbrowse/core/util'\nimport {\n  getTrackAssemblyNames,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\n\nimport ServerSideRenderedBlockContent from '../components/ServerSideRenderedBlockContent'\n\n// the MST state of a single server-side-rendered block in a display\nconst blockState = types\n  .model('BlockState', {\n    key: types.string,\n    region: Region,\n    isLeftEndOfDisplayedRegion: false,\n    isRightEndOfDisplayedRegion: false,\n  })\n  // NOTE: all this volatile stuff has to be filled in at once, so that it stays consistent\n  .volatile(() => ({\n    renderInProgress: undefined as AbortController | undefined,\n    filled: false,\n    reactElement: undefined as React.ReactElement | undefined,\n    features: undefined as Map<string, Feature> | undefined,\n    layout: undefined as any,\n    status: '',\n    error: undefined as Error | undefined,\n    message: undefined as string | undefined,\n    maxHeightReached: false,\n    ReactComponent: ServerSideRenderedBlockContent,\n    renderProps: undefined as any,\n  }))\n  .actions(self => {\n    let renderInProgress: undefined | AbortController\n    return {\n      afterAttach() {\n        const display = getContainingDisplay(self)\n        makeAbortableReaction(\n          self as any,\n          renderBlockData,\n          renderBlockEffect as any, // reaction doesn't expect async here\n          {\n            name: `${display.id}/${assembleLocString(self.region)} rendering`,\n            delay: display.renderDelay,\n            fireImmediately: true,\n          },\n          this.setLoading,\n          this.setRendered,\n          this.setError,\n        )\n      },\n      setStatus(message: string) {\n        self.status = message\n      },\n      setLoading(abortController: AbortController) {\n        if (renderInProgress !== undefined) {\n          if (!renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n        }\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = abortController\n      },\n      setMessage(messageText: string) {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        self.filled = false\n        self.message = messageText\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      setRendered(\n        props:\n          | {\n              reactElement: React.ReactElement\n              features: Map<string, Feature>\n              layout: any\n              maxHeightReached: boolean\n              renderProps: any\n            }\n          | undefined,\n      ) {\n        if (!props) {\n          return\n        }\n        const {\n          reactElement,\n          features,\n          layout,\n          maxHeightReached,\n          renderProps,\n        } = props\n        self.filled = true\n        self.message = undefined\n        self.reactElement = reactElement\n        self.features = features\n        self.layout = layout\n        self.error = undefined\n        self.maxHeightReached = maxHeightReached\n        self.renderProps = renderProps\n        renderInProgress = undefined\n      },\n      setError(error: Error) {\n        console.error(error)\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.maxHeightReached = false\n        self.error = error\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      reload() {\n        self.renderInProgress = undefined\n        self.filled = false\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.message = undefined\n        self.maxHeightReached = false\n        self.ReactComponent = ServerSideRenderedBlockContent\n        self.renderProps = undefined\n        getParent(self, 2).reload()\n      },\n      beforeDestroy() {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        const display = getContainingDisplay(self)\n        const { rpcManager } = getSession(self)\n        const { rendererType } = display\n        const { renderArgs } = renderBlockData(cast(self))\n        // renderArgs can be undefined if an error occured in this block\n        if (renderArgs) {\n          rendererType\n            .freeResourcesInClient(\n              rpcManager,\n              JSON.parse(JSON.stringify(renderArgs)),\n            )\n            .catch((e: Error) => {\n              // just console.error if it's something while it's being destroyed\n              console.warn('Error while destroying block', e)\n            })\n        }\n      },\n    }\n  })\n\nexport default blockState\nexport type BlockStateModel = typeof blockState\nexport type BlockModel = Instance<BlockStateModel>\n\n// calls the render worker to render the block content not using a flow for\n// this, because the flow doesn't work with autorun\nexport function renderBlockData(\n  self: Instance<BlockStateModel>,\n  optDisplay?: AbstractDisplayModel,\n) {\n  try {\n    const display = optDisplay || (getContainingDisplay(self) as any)\n    const { assemblyManager, rpcManager } = getSession(display)\n    const {\n      adapterConfig,\n      renderProps,\n      rendererType,\n      error: displayError,\n      parentTrack,\n    } = display\n    const assemblyNames = getTrackAssemblyNames(parentTrack)\n    const regionAsm = self.region.assemblyName\n    if (\n      !assemblyNames.includes(regionAsm) &&\n      !assemblyNames.find(name => assemblyManager.get(name)?.hasName(regionAsm))\n    ) {\n      throw new Error(\n        `region assembly (${regionAsm}) does not match track assemblies (${assemblyNames})`,\n      )\n    }\n\n    const { config } = renderProps\n    // This line is to trigger the mobx reaction when the config changes\n    // It won't trigger the reaction if it doesn't think we're accessing it\n    readConfObject(config)\n\n    const sessionId = getRpcSessionId(display)\n    const cannotBeRenderedReason = display.regionCannotBeRendered(self.region)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps,\n      cannotBeRenderedReason,\n      displayError,\n      renderArgs: {\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            self.setStatus(message)\n          }\n        },\n        assemblyName: self.region.assemblyName,\n        regions: [self.region],\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId,\n        blockKey: self.key,\n        timeout: 1000000, // 10000,\n      },\n    }\n  } catch (e) {\n    return { displayError: e }\n  }\n}\n\ninterface RenderProps {\n  displayError: Error\n  rendererType: any\n  renderProps: { [key: string]: any }\n  rpcManager: { call: Function }\n  cannotBeRenderedReason: string\n  renderArgs: { [key: string]: any }\n}\n\ninterface ErrorProps {\n  displayError: string\n}\n\nasync function renderBlockEffect(\n  props: RenderProps | ErrorProps,\n  signal: AbortSignal,\n  self: Instance<BlockStateModel>,\n) {\n  const {\n    rendererType,\n    renderProps,\n    rpcManager,\n    renderArgs,\n    cannotBeRenderedReason,\n    displayError,\n  } = props as RenderProps\n  if (!isAlive(self)) {\n    return undefined\n  }\n\n  if (displayError) {\n    self.setError(displayError)\n    return undefined\n  }\n  if (cannotBeRenderedReason) {\n    self.setMessage(cannotBeRenderedReason)\n    return undefined\n  }\n\n  if (renderProps.notReady) {\n    return undefined\n  }\n\n  const {\n    reactElement,\n    features,\n    layout,\n    maxHeightReached,\n  } = await rendererType.renderInClient(rpcManager, {\n    ...renderArgs,\n    ...renderProps,\n    signal,\n  })\n  return {\n    reactElement,\n    features,\n    layout,\n    maxHeightReached,\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any,react/no-danger */\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  getContainingView,\n  getSession,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { Region } from '@jbrowse/core/util/types'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport { autorun } from 'mobx'\nimport { addDisposer, Instance, isAlive, types, getEnv } from 'mobx-state-tree'\nimport RBush from 'rbush'\nimport React from 'react'\nimport { Tooltip } from '../components/BaseLinearDisplay'\nimport BlockState, { renderBlockData } from './serverSideRenderedBlock'\n\nimport { LinearGenomeViewModel, ExportSvgOptions } from '../../LinearGenomeView'\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\ntype LayoutRecord = [number, number, number, number]\n\nconst minDisplayHeight = 20\nconst defaultDisplayHeight = 100\nexport const BaseLinearDisplay = types\n  .compose(\n    'BaseLinearDisplay',\n    BaseDisplay,\n    types.model({\n      height: types.optional(\n        types.refinement(\n          'displayHeight',\n          types.number,\n          n => n >= minDisplayHeight,\n        ),\n        defaultDisplayHeight,\n      ),\n      blockState: types.map(BlockState),\n      userBpPerPxLimit: types.maybe(types.number),\n    }),\n  )\n  .volatile(() => ({\n    message: '',\n    featureIdUnderMouse: undefined as undefined | string,\n    contextMenuFeature: undefined as undefined | Feature,\n    additionalContextMenuItemCallbacks: [] as Function[],\n    scrollTop: 0,\n  }))\n  .views(self => ({\n    get blockType(): 'staticBlocks' | 'dynamicBlocks' {\n      return 'staticBlocks'\n    },\n    get blockDefinitions() {\n      const { blockType } = this\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (!view.initialized) {\n        throw new Error('view not initialized yet')\n      }\n      return view[blockType]\n    },\n  }))\n  .views(self => ({\n    /**\n     * set limit to config amount, or user amount if they force load,\n     */\n    get maxViewBpPerPx() {\n      return self.userBpPerPxLimit || getConf(self, 'maxDisplayedBpPerPx')\n    },\n\n    /**\n     * how many milliseconds to wait for the display to\n     * \"settle\" before re-rendering a block\n     */\n    get renderDelay() {\n      return 50\n    },\n\n    get TooltipComponent(): React.FC<any> {\n      return (Tooltip as unknown) as React.FC\n    },\n\n    /**\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (isAlive(self)) {\n        const session = getSession(self)\n        const { selection } = session\n        // does it quack like a feature?\n        if (isFeature(selection)) {\n          return selection.id()\n        }\n      }\n      return undefined\n    },\n    /**\n     * if a display-level message should be displayed instead of the blocks,\n     * make this return a react component\n     */\n    get DisplayMessageComponent() {\n      return undefined as undefined | React.FC<any>\n    },\n  }))\n  .views(self => {\n    let stale = false // used to make rtree refresh, the mobx reactivity fails for some reason\n    let rbush: Record<string, RBush<Layout>> = {}\n    return {\n      /**\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       */\n      get features() {\n        const featureMaps = []\n        for (const block of self.blockState.values()) {\n          if (block && block.features) {\n            featureMaps.push(block.features)\n          }\n        }\n        stale = true\n        return new CompositeMap<string, Feature>(featureMaps)\n      },\n\n      get featureUnderMouse() {\n        return self.featureIdUnderMouse\n          ? this.features.get(self.featureIdUnderMouse)\n          : undefined\n      },\n\n      /**\n       * returns per-base block layouts as the data structure\n       * `Map<blockKey, Map<featureId, LayoutRecord>>`\n       *\n       * this per-block is needed to avoid cross-contamination of\n       * layouts across blocks especially when building the rtree\n       */\n      get blockLayoutFeatures() {\n        const layoutMaps = new Map<string, Map<string, LayoutRecord>>()\n        for (const block of self.blockState.values()) {\n          if (block && block.layout && block.layout.rectangles) {\n            layoutMaps.set(block.key, block.layout.getRectangles())\n          }\n        }\n        stale = true\n        return layoutMaps\n      },\n      /**\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       *\n       * when you are not using the rtree you can use this\n       * method because it still provides a stable reference\n       * of a featureId to a layout record (when using the\n       * rtree, you cross contaminate the coordinates)\n       */\n      get layoutFeatures() {\n        const layoutMaps = []\n        for (const block of self.blockState.values()) {\n          if (block && block.layout && block.layout.rectangles) {\n            layoutMaps.push(block.layout.getRectangles())\n          }\n        }\n        stale = true // make rtree refresh\n        return new CompositeMap<string, LayoutRecord>(layoutMaps)\n      },\n\n      get rtree() {\n        if (stale) {\n          rbush = {} as Record<string, RBush<Layout>>\n          for (const [blockKey, layoutFeatures] of this.blockLayoutFeatures) {\n            rbush[blockKey] = new RBush()\n            const r = rbush[blockKey]\n            for (const [key, layout] of layoutFeatures) {\n              r.insert({\n                minX: layout[0],\n                minY: layout[1],\n                maxX: layout[2],\n                maxY: layout[3],\n                name: key,\n              })\n            }\n          }\n          stale = false\n        }\n        return rbush\n      },\n      getFeatureOverlapping(blockKey: string, x: number, y: number) {\n        const rect = { minX: x, minY: y, maxX: x + 1, maxY: y + 1 }\n        const rtree = this.rtree[blockKey]\n        return rtree && rtree.collides(rect) ? rtree.search(rect) : []\n      },\n    }\n  })\n  .actions(self => ({\n    afterAttach() {\n      // watch the parent's blocks to update our block state when they change\n      const blockWatchDisposer = autorun(() => {\n        // create any blocks that we need to create\n        const blocksPresent: { [key: string]: boolean } = {}\n        const view = getContainingView(self) as LinearGenomeViewModel\n        if (view.initialized) {\n          self.blockDefinitions.contentBlocks.forEach(block => {\n            blocksPresent[block.key] = true\n            if (!self.blockState.has(block.key)) {\n              this.addBlock(block.key, block)\n            }\n          })\n          // delete any blocks we need go delete\n          self.blockState.forEach((_, key) => {\n            if (!blocksPresent[key]) {\n              this.deleteBlock(key)\n            }\n          })\n        }\n      })\n\n      addDisposer(self, blockWatchDisposer)\n    },\n    setHeight(displayHeight: number) {\n      if (displayHeight > minDisplayHeight) {\n        self.height = displayHeight\n      } else {\n        self.height = minDisplayHeight\n      }\n      return self.height\n    },\n    resizeHeight(distance: number) {\n      const oldHeight = self.height\n      const newHeight = this.setHeight(self.height + distance)\n      return newHeight - oldHeight\n    },\n    setScrollTop(scrollTop: number) {\n      self.scrollTop = scrollTop\n    },\n    // sets the new bpPerPxLimit if user chooses to force load\n    setUserBpPerPxLimit(limit: number) {\n      self.userBpPerPxLimit = limit\n    },\n    // base display reload does nothing, see specialized displays for details\n    setMessage(message: string) {\n      self.message = message\n    },\n    addBlock(key: string, block: BaseBlock) {\n      self.blockState.set(\n        key,\n        BlockState.create({\n          key,\n          region: block.toRegion(),\n        }),\n      )\n    },\n    deleteBlock(key: string) {\n      self.blockState.delete(key)\n    },\n    selectFeature(feature: Feature) {\n      const session = getSession(self)\n      if (isSessionModelWithWidgets(session)) {\n        const featureWidget = session.addWidget(\n          'BaseFeatureWidget',\n          'baseFeature',\n          { featureData: feature.toJSON(), view: getContainingView(self) },\n        )\n        session.showWidget(featureWidget)\n      }\n      if (isSelectionContainer(session)) {\n        session.setSelection(feature)\n      }\n    },\n    clearFeatureSelection() {\n      const session = getSession(self)\n      session.clearSelection()\n    },\n    setFeatureIdUnderMouse(feature: string | undefined) {\n      self.featureIdUnderMouse = feature\n    },\n    reload() {\n      const temp = JSON.parse(JSON.stringify(self.blockState))\n      Object.keys(temp).forEach(blockState => {\n        temp[blockState].key += '-reload'\n      })\n      self.blockState = temp\n    },\n    addAdditionalContextMenuItemCallback(callback: Function) {\n      self.additionalContextMenuItemCallbacks.push(callback)\n    },\n    setContextMenuFeature(feature?: Feature) {\n      self.contextMenuFeature = feature\n    },\n  }))\n  .views(self => ({\n    regionCannotBeRenderedText(_region: Region) {\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (view && view.bpPerPx > self.maxViewBpPerPx) {\n        return 'Zoom in to see features'\n      }\n      return ''\n    },\n\n    /**\n     * @param region -\n     * @returns falsy if the region is fine to try rendering. Otherwise,\n     *  return a react node + string of text.\n     *  string of text describes why it cannot be rendered\n     *  react node allows user to force load at current setting\n     */\n    regionCannotBeRendered(_region: Region) {\n      const view = getContainingView(self) as LinearGenomeViewModel\n      if (view && view.bpPerPx > self.maxViewBpPerPx) {\n        return (\n          <>\n            <Typography component=\"span\" variant=\"body2\">\n              Zoom in to see features or{' '}\n            </Typography>\n            <Button\n              data-testid=\"reload_button\"\n              onClick={() => {\n                self.setUserBpPerPxLimit(view.bpPerPx)\n                self.reload()\n              }}\n              variant=\"outlined\"\n            >\n              Force Load\n            </Button>\n            <Typography component=\"span\" variant=\"body2\">\n              (force load may be slow)\n            </Typography>\n          </>\n        )\n      }\n      return undefined\n    },\n\n    get trackMenuItems(): MenuItem[] {\n      return []\n    },\n    // distinct set of display items that are particular to this display type.\n    // for base, there are none\n    //\n    // note: this attribute is helpful when composing together multiple\n    // subdisplays so that you don't repeat the \"about this track\" from each\n    // child display\n    get composedTrackMenuItems(): MenuItem[] {\n      return []\n    },\n    get contextMenuItems() {\n      const { pluginManager } = getEnv(self)\n      const contextMenuItems = self.contextMenuFeature\n        ? [\n            {\n              label: 'Open feature details',\n              icon: MenuOpenIcon,\n              onClick: () => {\n                if (self.contextMenuFeature) {\n                  self.selectFeature(self.contextMenuFeature)\n                }\n              },\n            },\n          ]\n        : []\n\n      self.additionalContextMenuItemCallbacks.forEach(callback => {\n        const menuItems = callback(self.contextMenuFeature, self, pluginManager)\n        contextMenuItems.push(...menuItems)\n      })\n      return contextMenuItems\n    },\n    get composedRenderProps() {\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n        onFeatureClick(_: unknown, featureId: string | undefined) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            const feature = self.features.get(f)\n            self.selectFeature(feature as Feature)\n          }\n        },\n        onClick() {\n          self.clearFeatureSelection()\n        },\n        // similar to click but opens a menu with further options\n        onFeatureContextMenu(_: unknown, featureId: string | undefined) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            // feature id under mouse passed to context menu\n            self.setContextMenuFeature(self.features.get(f))\n          }\n        },\n\n        onMouseMove(_: unknown, featureId: string | undefined) {\n          self.setFeatureIdUnderMouse(featureId)\n        },\n\n        onMouseLeave(_: unknown) {\n          self.setFeatureIdUnderMouse(undefined)\n        },\n\n        onContextMenu() {\n          self.setContextMenuFeature(undefined)\n          self.clearFeatureSelection()\n        },\n      }\n    },\n    get renderProps() {\n      return this.composedRenderProps\n    },\n  }))\n  .actions(self => ({\n    async renderSvg(opts: ExportSvgOptions & { overrideHeight: number }) {\n      const { height, id } = self\n      const { overrideHeight } = opts\n      const view = getContainingView(self) as LinearGenomeViewModel\n      const {\n        offsetPx: viewOffsetPx,\n        roundedDynamicBlocks: dynamicBlocks,\n        width,\n      } = view\n\n      const renderings = await Promise.all(\n        dynamicBlocks.map(block => {\n          const blockState = BlockState.create({\n            key: block.key,\n            region: block,\n          })\n\n          // regionCannotBeRendered can return jsx so look for plaintext\n          // version, or just get the default if none available\n          const cannotBeRenderedReason =\n            self.regionCannotBeRenderedText(block) ||\n            self.regionCannotBeRendered(block)\n\n          if (cannotBeRenderedReason) {\n            return {\n              reactElement: (\n                <>\n                  <rect x={0} y={0} width={width} height={20} fill=\"#aaa\" />\n                  <text x={0} y={15}>\n                    {cannotBeRenderedReason}\n                  </text>\n                </>\n              ),\n            }\n          }\n\n          const {\n            rpcManager,\n            renderArgs,\n            renderProps,\n            rendererType,\n          } = renderBlockData(blockState, self)\n\n          return rendererType.renderInClient(rpcManager, {\n            ...renderArgs,\n            ...renderProps,\n            exportSVG: opts,\n          })\n        }),\n      )\n\n      return (\n        <>\n          {renderings.map((rendering, index) => {\n            const { offsetPx } = dynamicBlocks[index]\n            const offset = offsetPx - viewOffsetPx\n            // stabalize clipid under test for snapshot\n            const clipid = `clip-${\n              typeof jest === 'undefined' ? id : 'jest'\n            }-${index}`\n            return (\n              <React.Fragment key={`frag-${index}`}>\n                <defs>\n                  <clipPath id={clipid}>\n                    <rect\n                      x={0}\n                      y={0}\n                      width={width}\n                      height={overrideHeight || height}\n                    />\n                  </clipPath>\n                </defs>\n                <g transform={`translate(${offset} 0)`}>\n                  <g clipPath={`url(#${clipid})`}>\n                    {React.isValidElement(rendering.reactElement) ? (\n                      rendering.reactElement\n                    ) : (\n                      <g dangerouslySetInnerHTML={{ __html: rendering.html }} />\n                    )}\n                  </g>\n                </g>\n              </React.Fragment>\n            )\n          })}\n        </>\n      )\n    },\n  }))\n  .postProcessSnapshot(self => {\n    const { blockState, ...rest } = self\n    return rest\n  })\n\nexport type BaseLinearDisplayStateModel = typeof BaseLinearDisplay\nexport type BaseLinearDisplayModel = Instance<BaseLinearDisplayStateModel>\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBareDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearBareDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      get renderProps() {\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          config: self.configuration.renderer,\n        }\n      },\n\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n}\n","import { lazy } from 'react'\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { getSession } from '@jbrowse/core/util'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport { types, getEnv, Instance } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\n\nconst stateModelFactory = (configSchema: AnyConfigurationSchemaType) =>\n  types\n    .compose(\n      'LinearBasicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearBasicDisplay'),\n        trackShowLabels: types.maybe(types.boolean),\n        trackDisplayMode: types.maybe(types.string),\n        trackMaxHeight: types.maybe(types.number),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n\n      get showLabels() {\n        const showLabels = getConf(self, ['renderer', 'showLabels'])\n        return self.trackShowLabels !== undefined\n          ? self.trackShowLabels\n          : showLabels\n      },\n\n      get maxHeight() {\n        const maxHeight = getConf(self, ['renderer', 'maxHeight'])\n        return self.trackMaxHeight !== undefined\n          ? self.trackMaxHeight\n          : maxHeight\n      },\n\n      get displayMode() {\n        const displayMode = getConf(self, ['renderer', 'displayMode'])\n        return self.trackDisplayMode !== undefined\n          ? self.trackDisplayMode\n          : displayMode\n      },\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            showLabels: this.showLabels,\n            displayMode: this.displayMode,\n            maxHeight: this.maxHeight,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n\n    .actions(self => ({\n      toggleShowLabels() {\n        self.trackShowLabels = !self.showLabels\n      },\n      setDisplayMode(val: string) {\n        self.trackDisplayMode = val\n      },\n      setMaxHeight(val: number) {\n        self.trackMaxHeight = val\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get renderProps() {\n          const config = self.rendererConfig\n\n          return {\n            ...self.composedRenderProps,\n            ...getParentRenderProps(self),\n            config,\n          }\n        },\n        get trackMenuItems(): MenuItem[] {\n          const displayModes = [\n            'compact',\n            'reducedRepresentation',\n            'normal',\n            'collapse',\n          ]\n          return [\n            ...trackMenuItems,\n            {\n              label: 'Show labels',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showLabels,\n              onClick: () => {\n                self.toggleShowLabels()\n              },\n            },\n            {\n              label: 'Display mode',\n              icon: VisibilityIcon,\n              subMenu: displayModes.map(val => ({\n                label: val,\n                onClick: () => {\n                  self.setDisplayMode(val)\n                },\n              })),\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetMaxHeightDlg, {\n                  model: self,\n                })\n              },\n            },\n          ]\n        },\n      }\n    })\n\nexport type FeatureTrackStateModel = ReturnType<typeof stateModelFactory>\nexport type FeatureTrackModel = Instance<FeatureTrackStateModel>\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nexport default function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBasicDisplay',\n    {\n      mouseover: {\n        type: 'string',\n        description: 'what to display in a given mouseover',\n        defaultValue: `jexl:get(feature,'name')`,\n\n        contextVariable: ['feature'],\n      },\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n      // overrides base\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 1000,\n      },\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import { lazy } from 'react'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport LineStyleIcon from '@material-ui/icons/LineStyle'\nimport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  baseLinearDisplayConfigSchema,\n  BlockModel,\n} from './BaseLinearDisplay'\nimport {\n  configSchemaFactory as linearBareDisplayConfigSchemaFactory,\n  stateModelFactory as LinearBareDisplayStateModelFactory,\n} from './LinearBareDisplay'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n  stateModelFactory as linearGenomeViewStateModelFactory,\n  renderToSvg,\n} from './LinearGenomeView'\n\nimport {\n  configSchema as linearBasicDisplayConfigSchemaFactory,\n  modelFactory as linearBasicDisplayModelFactory,\n} from './LinearBasicDisplay'\n\nexport default class LinearGenomeViewPlugin extends Plugin {\n  name = 'LinearGenomeViewPlugin'\n\n  exports = {\n    BaseLinearDisplayComponent,\n    BaseLinearDisplay,\n    baseLinearDisplayConfigSchema,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'FeatureTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'FeatureTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'FeatureTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'BasicTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'BasicTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'BasicTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBareDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBareDisplay',\n        configSchema,\n        stateModel: LinearBareDisplayStateModelFactory(configSchema),\n        trackType: 'BasicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBasicDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBasicDisplay',\n        configSchema,\n        stateModel: linearBasicDisplayModelFactory(configSchema),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          name: 'LinearGenomeView',\n          stateModel: linearGenomeViewStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./LinearGenomeView/components/LinearGenomeView'),\n          ),\n        }),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Linear genome view',\n        icon: LineStyleIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearGenomeView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseLinearDisplayComponent,\n  BaseLinearDisplay,\n  baseLinearDisplayConfigSchema,\n  linearBareDisplayConfigSchemaFactory,\n  linearBasicDisplayConfigSchemaFactory,\n  linearBasicDisplayModelFactory,\n  renderToSvg,\n}\n\nexport type { LinearGenomeViewModel, LinearGenomeViewStateModel, BlockModel }\n\nexport type { BaseLinearDisplayModel } from './BaseLinearDisplay'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBareDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","/**\n * Abstract feature object\n */\nexport interface Feature {\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(name: string): any\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  set(name: string, val: any): void\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  tags(): string[]\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined\n\n  /*\n   * Convert to JSON\n   */\n  toJSON(): SimpleFeatureSerialized\n}\n\nexport function isFeature(thing: unknown): thing is Feature {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    typeof (thing as Feature).get === 'function' &&\n    typeof (thing as Feature).id === 'function'\n  )\n}\n\nexport interface SimpleFeatureArgs {\n  /** key-value data, must include 'start' and 'end' */\n  data: {}\n  /** optional parent feature */\n  parent?: Feature\n  /** unique identifier. can also be in data.uniqueId */\n  id: string | number // thing that can be stringified easily\n}\n\n// subfeatures do not have to have uniqueId\ninterface SimpleFeatureSerializedNoId {\n  [key: string]: unknown\n  parentId?: string\n  subfeatures?: SimpleFeatureSerializedNoId[]\n}\n\n// base serialized feature has to have a uniqueId\nexport interface SimpleFeatureSerialized extends SimpleFeatureSerializedNoId {\n  subfeatures?: SimpleFeatureSerializedNoId[]\n  uniqueId: string\n}\n\nfunction isSimpleFeatureSerialized(\n  args: SimpleFeatureSerialized | SimpleFeatureArgs,\n): args is SimpleFeatureSerialized {\n  return 'uniqueId' in args && typeof args.data !== 'object'\n}\n\n/**\n * Simple implementation of a feature object.\n */\nexport default class SimpleFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private data: Record<string, any>\n\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  /**\n   * @param args - SimpleFeature args\n   *\n   * Note: args.data.subfeatures can be an array of these same args,\n   * which will be inflated to more instances of this class.\n   */\n  public constructor(args: SimpleFeatureArgs | SimpleFeatureSerialized) {\n    if (isSimpleFeatureSerialized(args)) {\n      this.data = args\n    } else {\n      this.data = args.data || {}\n      // load handle from args.parent (not args.data.parent)\n      // this reason is because if args is an object, it likely isn't properly loaded with\n      // parent as a Feature reference (probably a raw parent ID or something instead)\n      this.parentHandle = args.parent\n    }\n\n    // the feature id comes from\n    // args.id, args.data.uniqueId, or args.uniqueId due to this initialization\n    const id = isSimpleFeatureSerialized(args) ? args.uniqueId : args.id\n    if (id === undefined || id === null) {\n      throw new Error(\n        'SimpleFeature requires a unique `id` or `data.uniqueId` attribute',\n      )\n    }\n    this.uniqueId = String(id)\n\n    if (!(this.data.aliases || this.data.end - this.data.start >= 0)) {\n      throw new Error(\n        `invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`,\n      )\n    }\n\n    // inflate any subfeatures that are not already feature objects\n    const { subfeatures } = this.data\n    if (subfeatures) {\n      for (let i = 0; i < subfeatures.length; i += 1) {\n        if (typeof subfeatures[i].get !== 'function') {\n          subfeatures[i].strand = subfeatures[i].strand || this.data.strand\n          subfeatures[i] = new SimpleFeature({\n            id: subfeatures[i].uniqueId || `${id}-${i}`,\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            data: subfeatures[i] as Record<string, any>,\n            parent: this,\n          })\n        }\n      }\n    }\n  }\n\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public get(name: string): any {\n    return this.data[name]\n  }\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public set(name: string, val: any): void {\n    this.data[name] = val\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  public tags(): string[] {\n    return Object.keys(this.data)\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  public id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  public parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  public children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  public toJSON(): SimpleFeatureSerialized {\n    const d = { ...this.data, uniqueId: this.id() } as SimpleFeatureSerialized\n    const p = this.parent()\n    if (p) {\n      d.parentId = p.id()\n    }\n    const c = this.children()\n    if (c) {\n      d.subfeatures = c.map(child => child.toJSON())\n    }\n    return d\n  }\n\n  public static fromJSON(json: SimpleFeatureSerialized) {\n    return new SimpleFeature({ ...json })\n  }\n}\n","import { Observable, Observer } from 'rxjs'\nimport { takeUntil } from 'rxjs/operators'\nimport { observeAbortSignal } from '.'\n\n/**\n * Wrapper for rxjs Observable.create with improved error handling and\n * aborting support\n * @param func - observer function, could be async\n */\nexport function ObservableCreate<T>(\n  func: (arg: Observer<T>) => void | Promise<void>,\n  signal?: AbortSignal,\n): Observable<T> {\n  return Observable.create((observer: Observer<T>) => {\n    try {\n      const ret = func(observer)\n      // catch async errors\n      if (ret && ret.catch) {\n        ret.catch((error: Error) => observer.error(error))\n      }\n    } catch (error) {\n      // catch sync errors\n      observer.error(error)\n    }\n  }).pipe(takeUntil(observeAbortSignal(signal)))\n}\n","import { ConfigurationSchema } from '../../configuration'\n\nexport default ConfigurationSchema(\n  'BaseConnection',\n  {\n    name: {\n      type: 'string',\n      defaultValue: 'nameOfConnection',\n      description: 'a unique name for this connection',\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'optional list of names of assemblies in this connection',\n    },\n  },\n  { explicitlyTyped: true, explicitIdentifier: 'connectionId' },\n)\n","import { types } from 'mobx-state-tree'\n\nexport default pluginManager => {\n  return types\n    .model('Connection', {\n      name: types.identifier,\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n    })\n    .actions(self => ({\n      afterAttach() {\n        if (!self.tracks.length) {\n          self.connect(self.configuration)\n        }\n      },\n      addTrackConf(trackConf) {\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      addTrackConfs(trackConfs) {\n        const length = self.tracks.push(...trackConfs)\n        return self.tracks.slice(length - 1 - trackConfs.length, length - 1)\n      },\n      setTrackConfs(trackConfs) {\n        self.tracks = trackConfs\n        return self.tracks\n      },\n      clear() {},\n    }))\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { getParent, Instance, types, isRoot, getEnv } from 'mobx-state-tree'\nimport React from 'react'\nimport { getConf } from '../../configuration'\nimport { MenuItem } from '../../ui'\nimport { getParentRenderProps } from '../../util/tracks'\nimport { ElementId } from '../../util/types/mst'\n\nexport const BaseDisplay = types\n  .model('BaseDisplay', {\n    id: ElementId,\n    type: types.string,\n    rpcDriverName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    rendererTypeName: '',\n    error: undefined as Error | undefined,\n  }))\n  .views(self => ({\n    get RenderingComponent(): React.FC<{\n      model: typeof self\n      onHorizontalScroll?: Function\n      blockState?: Record<string, any>\n    }> {\n      const { pluginManager } = getEnv(self)\n      const displayType = pluginManager.getDisplayType(self.type)\n      return displayType.ReactComponent as React.FC<{\n        model: typeof self\n        onHorizontalScroll?: Function\n        blockState?: Record<string, any>\n      }>\n    },\n\n    get DisplayBlurb(): React.FC<{ model: typeof self }> | null {\n      return null\n    },\n\n    get adapterConfig() {\n      return getConf(this.parentTrack, 'adapter')\n    },\n\n    get parentTrack() {\n      let track = getParent(self)\n      while (!(track.configuration && getConf(track, 'trackId'))) {\n        if (isRoot(track)) {\n          throw new Error(`No parent track found for ${self.type} ${self.id}`)\n        }\n        track = getParent(track)\n      }\n      return track\n    },\n\n    /**\n     * the react props that are passed to the Renderer when data\n     * is rendered in this display\n     */\n    get renderProps() {\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n      }\n    },\n\n    /**\n     * the pluggable element type object for this display's\n     * renderer\n     */\n    get rendererType() {\n      const { pluginManager } = getEnv(self)\n      const RendererType = pluginManager.getRendererType(self.rendererTypeName)\n      if (!RendererType) {\n        throw new Error(`renderer \"${self.rendererTypeName}\" not found`)\n      }\n      if (!RendererType.ReactComponent) {\n        throw new Error(\n          `renderer ${self.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n        )\n      }\n      return RendererType\n    },\n\n    /**\n     * if a display-level message should be displayed instead,\n     * make this return a react component\n     */\n    get DisplayMessageComponent() {\n      return undefined as undefined | React.FC<any>\n    },\n\n    get trackMenuItems(): MenuItem[] {\n      return []\n    },\n\n    get viewMenuActions(): MenuItem[] {\n      return []\n    },\n    /**\n     * @param region -\n     * @returns falsy if the region is fine to try rendering. Otherwise,\n     *  return a react node + string of text.\n     *  string of text describes why it cannot be rendered\n     *  react node allows user to force load at current setting\n     */\n    regionCannotBeRendered(/* region */) {\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    setError(error?: Error) {\n      self.error = error\n    },\n    setRpcDriverName(rpcDriverName: string) {\n      self.rpcDriverName = rpcDriverName\n    },\n    // base display reload does nothing, see specialized displays for details\n    reload() {},\n  }))\n\nexport type BaseDisplayStateModel = typeof BaseDisplay\nexport type BaseDisplayModel = Instance<BaseDisplayStateModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { transaction } from 'mobx'\nimport {\n  getRoot,\n  Instance,\n  resolveIdentifier,\n  types,\n  getEnv,\n} from 'mobx-state-tree'\nimport { getConf } from '../../configuration'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '../../configuration/configurationSchema'\nimport PluginManager from '../../PluginManager'\nimport { MenuItem } from '../../ui'\nimport { getContainingView, getSession } from '../../util'\nimport { isSessionModelWithConfigEditing } from '../../util/types'\nimport { ElementId } from '../../util/types/mst'\n\n// these MST models only exist for tracks that are *shown*.\n// they should contain only UI state for the track, and have\n// a reference to a track configuration (stored under\n// session.configuration.assemblies.get(assemblyName).tracks).\n\n// note that multiple displayed tracks could use the same configuration.\nexport function createBaseTrackModel(\n  pluginManager: PluginManager,\n  trackType: string,\n  baseTrackConfig: AnyConfigurationSchemaType,\n) {\n  return types\n    .model(trackType, {\n      id: ElementId,\n      type: types.literal(trackType),\n      configuration: ConfigurationReference(baseTrackConfig),\n      displays: types.array(\n        pluginManager.pluggableMstType('display', 'stateModel'),\n      ),\n    })\n    .views(self => ({\n      get rpcSessionId() {\n        return self.configuration.trackId\n      },\n\n      get name() {\n        return getConf(self, 'name')\n      },\n\n      /**\n       * the PluggableElementType for the currently defined adapter\n       */\n      get adapterType() {\n        const adapterConfig = getConf(self, 'adapter')\n        const { pluginManager: pm } = getEnv(self)\n        if (!adapterConfig) {\n          throw new Error(`no adapter configuration provided for ${self.type}`)\n        }\n        const adapterType = pm.getAdapterType(adapterConfig.type)\n        if (!adapterType) {\n          throw new Error(`unknown adapter type ${adapterConfig.type}`)\n        }\n        return adapterType\n      },\n\n      get viewMenuActions(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.displays.forEach(display => {\n          menuItems.push(...display.viewMenuActions)\n        })\n        return menuItems\n      },\n      get canConfigure() {\n        const session = getSession(self)\n        return (\n          isSessionModelWithConfigEditing(session) &&\n          // @ts-ignore\n          (session.adminMode ||\n            // @ts-ignore\n            session.sessionTracks.find(track => {\n              return track.trackId === self.configuration.trackId\n            }))\n        )\n      },\n      // distinct set of track items that are particular to this track type.\n      // for base, there are none\n      //\n      // note: this attribute is helpful when composing together multiple\n      // subtracks\n      get composedTrackMenuItems(): MenuItem[] {\n        return []\n      },\n    }))\n    .actions(self => ({\n      activateConfigurationUI() {\n        const session = getSession(self)\n        const view = getContainingView(self)\n        if (isSessionModelWithConfigEditing(session)) {\n          // @ts-ignore\n          const trackConf = session.editTrackConfiguration(self.configuration)\n          if (trackConf && trackConf !== self.configuration) {\n            // @ts-ignore\n            view.hideTrack(self.configuration)\n            // @ts-ignore\n            view.showTrack(trackConf)\n          }\n        }\n      },\n      showDisplay(displayId: string, initialSnapshot = {}) {\n        const displayTypeConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'display',\n        )\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          displayId,\n        )\n        const displayType = pluginManager.getDisplayType(configuration.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${configuration.type}`)\n        }\n        const display = displayType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n        self.displays.push(display)\n      },\n\n      hideDisplay(displayId: string) {\n        const displayTypeConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'display',\n        )\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          displayId,\n        )\n        // if we have any displays with that configuration, turn them off\n        const shownDisplays = self.displays.filter(\n          d => d.configuration === configuration,\n        )\n        transaction(() => shownDisplays.forEach(d => self.displays.remove(d)))\n        return shownDisplays.length\n      },\n      replaceDisplay(\n        oldDisplayId: string,\n        newDisplayId: string,\n        initialSnapshot = {},\n      ) {\n        const displayIdx = self.displays.findIndex(\n          d => d.configuration.displayId === oldDisplayId,\n        )\n        if (displayIdx === -1) {\n          throw new Error(\n            `could not find display id ${oldDisplayId} to replace`,\n          )\n        }\n        const displayTypeConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'display',\n        )\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          newDisplayId,\n        )\n        const displayType = pluginManager.getDisplayType(configuration.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${configuration.type}`)\n        }\n        self.displays.splice(displayIdx, 1, {\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n      },\n    }))\n    .views(self => ({\n      get trackMenuItems(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.displays.forEach(display => {\n          menuItems.push(...display.trackMenuItems)\n        })\n        const displayChoices: MenuItem[] = []\n        const view = getContainingView(self)\n        const viewType = pluginManager.getViewType(view.type)\n        const compatibleDisplayTypes = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const compatibleDisplays = self.configuration.displays.filter(\n          (displayConf: any) =>\n            compatibleDisplayTypes.includes(displayConf.type),\n        )\n        const shownId = self.displays[0].configuration.displayId\n        if (compatibleDisplays.length > 1) {\n          displayChoices.push(\n            { type: 'divider' },\n            { type: 'subHeader', label: 'Display types' },\n          )\n          compatibleDisplays.forEach((displayConf: any) => {\n            displayChoices.push({\n              type: 'radio',\n              label: `${displayConf.type}`,\n              onClick: () => {\n                self.replaceDisplay(shownId, displayConf.displayId)\n              },\n              checked: displayConf.displayId === shownId,\n            })\n          })\n        }\n        return [...menuItems, ...displayChoices]\n      },\n    }))\n}\n\nexport type BaseTrackStateModel = ReturnType<typeof createBaseTrackModel>\nexport type BaseTrackModel = Instance<BaseTrackStateModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, Instance } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../../configuration'\nimport PluginManager from '../../PluginManager'\n\nexport function createBaseTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseTrack',\n    {\n      name: {\n        description: 'descriptive name of the track',\n        type: 'string',\n        defaultValue: 'Track',\n      },\n      assemblyNames: {\n        description: 'name of the assembly (or assemblies) track belongs to',\n        type: 'stringArray',\n        defaultValue: ['assemblyName'],\n      },\n      description: {\n        description: 'a description of the track',\n        type: 'string',\n        defaultValue: '',\n      },\n      category: {\n        description: 'the category and sub-categories of a track',\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n      // see corresponding entry in circular-view ChordTrack\n      // no config slot editor exists for this at the time being\n      // configRelationships: {\n      //   type: 'configRelationships',\n      //   model: types.array(\n      //     types.model('Relationship', {\n      //       type: types.string,\n      //       target: types.maybe(types.reference(base)),\n      //     }),\n      //   ),\n      //   defaultValue: [],\n      // },\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n\nexport type BaseTrackConfigModel = ReturnType<typeof createBaseTrackConfig>\nexport type BaseTrackConfig = Instance<BaseTrackConfigModel>\n","/* eslint-disable no-underscore-dangle */\nimport uri2path from 'file-uri-to-path'\nimport {\n  Fetcher,\n  FilehandleOptions,\n  GenericFilehandle,\n  PolyfilledResponse,\n  Stats,\n} from 'generic-filehandle'\nimport ElectronLocalFile from './ElectronLocalFile'\nimport { isAbortException } from '../index'\n\ndeclare global {\n  interface Window {\n    electron?: import('electron').AllElectron\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst { electron } = typeof window !== 'undefined' ? window : ({} as any)\n\nclass ElectronRemoteFileError extends Error {\n  public status: number | undefined\n}\n\ninterface SerializedResponse {\n  buffer: Buffer\n  url: string\n  status: number\n  statusText: string\n  headers: string[][]\n}\n\nexport default class ElectronRemoteFile implements GenericFilehandle {\n  protected url: string\n\n  protected _stat?: Stats\n\n  protected fetch?: Fetcher\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  protected baseOverrides: any = {}\n\n  private nodeFetchFallback = false\n\n  private ipcRenderer: import('electron').IpcRenderer\n\n  public constructor(source: string, opts: FilehandleOptions = {}) {\n    let ipcRenderer\n    if (electron) {\n      ipcRenderer = electron.ipcRenderer\n    }\n    if (!ipcRenderer) {\n      throw new Error(\n        'Cannot use ElectronLocalFile without ipcRenderer from electron',\n      )\n    }\n    this.ipcRenderer = ipcRenderer\n\n    this.url = source\n\n    // if it is a file URL, monkey-patch ourselves to act like a LocalFile\n    if (source.startsWith('file://')) {\n      const path = uri2path(source)\n      if (!path) {\n        throw new TypeError('invalid file url')\n      }\n      const localFile = new ElectronLocalFile(path)\n      this.read = localFile.read.bind(localFile)\n      this.readFile = localFile.readFile.bind(localFile)\n      this.stat = localFile.stat.bind(localFile)\n      return\n    }\n\n    const fetcharg = opts.fetch || window.fetch\n    if (!fetch) {\n      throw new TypeError(\n        `no fetch function supplied, and none found in global environment`,\n      )\n    }\n    this.fetch = fetcharg\n\n    if (opts.overrides) {\n      this.baseOverrides = opts.overrides\n    }\n  }\n\n  private async getBufferFromResponse(\n    response: PolyfilledResponse,\n  ): Promise<Buffer> {\n    if (typeof response.buffer === 'function') {\n      return response.buffer()\n    }\n    if (typeof response.arrayBuffer === 'function') {\n      const resp = await response.arrayBuffer()\n      return Buffer.from(resp)\n    }\n    throw new TypeError(\n      'invalid HTTP response object, has no buffer method, and no arrayBuffer method',\n    )\n  }\n\n  private nodeFetch = async (\n    input: RequestInfo,\n    init?: RequestInit,\n  ): Promise<Response> => {\n    if (init) {\n      init.signal = undefined\n    }\n    const serializedResponse = (await this.ipcRenderer.invoke(\n      'fetch',\n      input,\n      init,\n    )) as SerializedResponse\n    const { buffer, headers, status, statusText } = serializedResponse\n    const response = new Response(buffer, { status, statusText, headers })\n    return response\n  }\n\n  protected async getFetch(\n    opts: FilehandleOptions,\n  ): Promise<PolyfilledResponse> {\n    if (!this.fetch) {\n      throw new Error(\n        'a fetch function must be available unless using a file:// url',\n      )\n    }\n    if (!this.url) {\n      throw new Error('no URL specified')\n    }\n    const myfetch = this.nodeFetchFallback ? this.nodeFetch : this.fetch\n    const { headers = {}, signal, overrides = {} } = opts\n    const requestOptions = {\n      headers,\n      method: 'GET',\n      redirect: 'follow',\n      mode: 'cors',\n      signal,\n      ...this.baseOverrides,\n      ...overrides,\n    }\n    let response\n    try {\n      response = await myfetch(this.url, requestOptions)\n    } catch (error) {\n      if (!isAbortException(error)) {\n        if (this.nodeFetchFallback) {\n          throw error\n        }\n        console.warn('received error, falling back to node-fetch', error)\n        this.nodeFetchFallback = true\n        return this.getFetch(opts)\n      }\n      // rethrow abort\n      throw error\n    }\n\n    if (!this._stat) {\n      // try to parse out the size of the remote file\n      if (requestOptions.headers && requestOptions.headers.range) {\n        const contentRange = response.headers.get('content-range')\n        const sizeMatch = /\\/(\\d+)$/.exec(contentRange || '')\n        if (sizeMatch && sizeMatch[1]) {\n          this._stat = { size: parseInt(sizeMatch[1], 10) }\n        }\n      } else {\n        const contentLength = response.headers.get('content-length')\n        if (contentLength) {\n          this._stat = { size: parseInt(contentLength, 10) }\n        }\n      }\n    }\n    return response\n  }\n\n  protected async headFetch(): Promise<PolyfilledResponse> {\n    return this.getFetch({ overrides: { method: 'HEAD' } })\n  }\n\n  public async read(\n    buffer: Buffer,\n    offset = 0,\n    length: number,\n    position = 0,\n    opts: FilehandleOptions = {},\n  ): Promise<{ bytesRead: number; buffer: Buffer }> {\n    opts.headers = opts.headers || {}\n    if (length < Infinity) {\n      opts.headers.range = `bytes=${position}-${position + length}`\n    } else if (length === Infinity && position !== 0) {\n      opts.headers.range = `bytes=${position}-`\n    }\n\n    const response = await this.getFetch(opts)\n    if (\n      (response.status === 200 && position === 0) ||\n      response.status === 206\n    ) {\n      const responseData = await this.getBufferFromResponse(response)\n      const bytesCopied = responseData.copy(\n        buffer,\n        offset,\n        0,\n        Math.min(length, responseData.length),\n      )\n\n      return { bytesRead: bytesCopied, buffer }\n    }\n\n    // TODO: try harder here to gather more information about what the problem is\n    throw new Error(`HTTP ${response.status} fetching ${this.url}`)\n  }\n\n  public async readFile(\n    options: FilehandleOptions | string = {},\n  ): Promise<Buffer | string> {\n    let encoding\n    let opts\n    if (typeof options === 'string') {\n      encoding = options\n      opts = {}\n    } else {\n      encoding = options.encoding\n      opts = options\n      delete opts.encoding\n    }\n    const response = await this.getFetch(opts)\n    if (response.status !== 200) {\n      const err = new ElectronRemoteFileError(\n        `HTTP ${response.status} fetching ${this.url}`,\n      )\n      err.status = response.status\n      throw err\n    }\n    if (encoding === 'utf8') {\n      return response.text()\n    }\n    if (encoding) {\n      throw new Error(`unsupported encoding: ${encoding}`)\n    }\n    return this.getBufferFromResponse(response)\n  }\n\n  public async stat(): Promise<Stats> {\n    if (!this._stat) {\n      await this.headFetch()\n    }\n    if (!this._stat) {\n      await this.read(Buffer.allocUnsafe(10), 0, 10, 0)\n    }\n    if (!this._stat) {\n      throw new Error(`unable to determine size of file at ${this.url}`)\n    }\n    return this._stat\n  }\n}\n","/* eslint-disable no-restricted-globals */\nimport url from 'url'\nimport domLoadScript from 'load-script2'\n\nimport { PluginConstructor } from './Plugin'\nimport { ConfigurationSchema } from './configuration'\n\nimport ReExports from './ReExports'\n\nexport const PluginSourceConfigurationSchema = ConfigurationSchema(\n  'PluginSource',\n  {\n    name: {\n      type: 'string',\n      defaultValue: '',\n    },\n    url: {\n      type: 'string',\n      defaultValue: '',\n    },\n  },\n)\n\nexport interface PluginDefinition {\n  name?: string\n  url: string\n}\n\nexport interface PluginRecord {\n  plugin: PluginConstructor\n  definition: PluginDefinition\n}\n\nexport default class PluginLoader {\n  definitions: PluginDefinition[] = []\n\n  constructor(pluginDefinitions: PluginDefinition[] = []) {\n    this.definitions = JSON.parse(JSON.stringify(pluginDefinitions))\n  }\n\n  loadScript(scriptUrl: string): Promise<void> {\n    if (document && document.getElementsByTagName) {\n      return domLoadScript(scriptUrl)\n    }\n    // @ts-ignore\n    if (self && self.importScripts) {\n      return new Promise((resolve, reject) => {\n        try {\n          // @ts-ignore\n          self.importScripts(scriptUrl)\n        } catch (error) {\n          reject(error || new Error(`failed to load ${scriptUrl}`))\n          return\n        }\n        resolve()\n      })\n    }\n    throw new Error(\n      'cannot figure out how to load external JS scripts in this environment',\n    )\n  }\n\n  async loadPlugin(definition: PluginDefinition): Promise<PluginConstructor> {\n    const parsedUrl = url.parse(definition.url)\n    if (\n      !parsedUrl.protocol ||\n      parsedUrl.protocol === 'http:' ||\n      parsedUrl.protocol === 'https:'\n    ) {\n      await this.loadScript(definition.url)\n      const moduleName = definition.name\n      const umdName = `JBrowsePlugin${moduleName}`\n      // Based on window-or-global\n      // https://github.com/purposeindustries/window-or-global/blob/322abc71de0010c9e5d9d0729df40959e1ef8775/lib/index.js\n      const scope =\n        (typeof self === 'object' && self.self === self && self) ||\n        (typeof global === 'object' && global.global === global && global) ||\n        this\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const plugin = (scope as any)[umdName] as { default: PluginConstructor }\n      if (!plugin) {\n        throw new Error(\n          `plugin ${moduleName} failed to load, ${scope.constructor.name}.${umdName} is undefined`,\n        )\n      }\n\n      return plugin.default\n    }\n    throw new Error(\n      `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n    )\n  }\n\n  installGlobalReExports(target: WindowOrWorkerGlobalScope | NodeJS.Global) {\n    // @ts-ignore\n    target.JBrowseExports = {}\n    Object.entries(ReExports).forEach(([moduleName, module]) => {\n      // @ts-ignore\n      target.JBrowseExports[moduleName] = module\n    })\n  }\n\n  async load(): Promise<PluginRecord[]> {\n    return Promise.all(\n      this.definitions.map(async definition => ({\n        plugin: await this.loadPlugin(definition),\n        definition,\n      })),\n    )\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { reduce, filter, toArray } from 'rxjs/operators'\nimport { Observable } from 'rxjs'\nimport { getTagAlt } from '../util'\nimport {\n  parseCigar,\n  getNextRefPos,\n  getModificationPositions,\n  Mismatch,\n} from '../BamAdapter/MismatchParser'\n\ninterface SNPCoverageOptions extends BaseOptions {\n  filters?: SerializableFilterChain\n}\n\nfunction mismatchLen(mismatch: Mismatch) {\n  return !isInterbase(mismatch.type) ? mismatch.length : 1\n}\n\nfunction isInterbase(type: string) {\n  return type === 'softclip' || type === 'hardclip' || type === 'insertion'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction inc(bin: any, strand: number, type: string, field: string) {\n  if (!bin[type][field]) {\n    bin[type][field] = { total: 0, strands: { '-1': 0, '0': 0, '1': 0 } }\n  }\n  bin[type][field].total++\n  bin[type][field].strands[strand]++\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction dec(bin: any, strand: number, type: string, field: string) {\n  if (!bin[type][field]) {\n    bin[type][field] = { total: 0, strands: { '-1': 0, '0': 0, '1': 0 } }\n  }\n  bin[type][field].total--\n  bin[type][field].strands[strand]--\n}\n\nexport default class SNPCoverageAdapter extends BaseFeatureDataAdapter {\n  protected async configure() {\n    const subadapterConfig = readConfObject(this.config, 'subadapter')\n    const sequenceConf = readConfObject(this.config, [\n      'subadapter',\n      'sequenceAdapter',\n    ])\n    const dataAdapter = await this.getSubAdapter?.(subadapterConfig)\n\n    const sequenceAdapter = sequenceConf\n      ? await this.getSubAdapter?.(sequenceConf)\n      : undefined\n\n    if (!dataAdapter) {\n      throw new Error('Failed to get subadapter')\n    }\n\n    return {\n      subadapter: dataAdapter.dataAdapter as BaseFeatureDataAdapter,\n      sequenceAdapter: sequenceAdapter?.dataAdapter as\n        | BaseFeatureDataAdapter\n        | undefined,\n    }\n  }\n\n  getFeatures(region: Region, opts: SNPCoverageOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { subadapter } = await this.configure()\n      let stream = subadapter.getFeatures(region, opts)\n\n      if (opts.filters) {\n        const { filters } = opts\n        stream = stream.pipe(filter(f => filters.passes(f, opts)))\n      }\n\n      const bins = await this.generateCoverageBins(stream, region, opts)\n\n      bins.forEach((bin, index) => {\n        if (bin.total) {\n          observer.next(\n            new SimpleFeature({\n              id: `${this.id}-${region.start}-${index}`,\n              data: {\n                score: bin.total,\n                snpinfo: bin,\n                start: region.start + index,\n                end: region.start + index + 1,\n                refName: region.refName,\n              },\n            }),\n          )\n        }\n      })\n\n      observer.complete()\n    }, opts.signal)\n  }\n\n  async getRefNames(opts: BaseOptions = {}) {\n    const { subadapter } = await this.configure()\n    return subadapter.getRefNames(opts)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  /**\n   * Generates coverage bins from features which details\n   * the reference, mismatches, strands, and coverage info\n   * @param features - Features of region to be passed in\n   * @param region - Region\n   * @param bpPerPx - base pairs per pixel\n   * @returns Array of nested frequency tables\n   */\n  async generateCoverageBins(\n    features: Observable<Feature>,\n    region: Region,\n    opts: { bpPerPx?: number; colorBy?: { type: string; tag?: string } },\n  ) {\n    const { colorBy } = opts\n    const { sequenceAdapter } = await this.configure()\n    const { refName, start, end } = region\n    const binMax = Math.ceil(region.end - region.start)\n\n    // bins contain cov feature if they contribute to coverage, or noncov which\n    // are interbase or other features that don't contribute to coverage.\n    // delskips are elements that don't contribute to coverage, but should be\n    // reported also (and are not interbase)\n    type BinType = { total: number; strands: { [key: string]: number } }\n    const initBins = Array.from({ length: binMax }, () => ({\n      total: 0,\n      lowqual: {} as BinType,\n      cov: {} as BinType,\n      delskips: {} as BinType,\n      noncov: {} as BinType,\n      ref: {} as BinType,\n    }))\n\n    // request an extra +1 on the end to get CpG crossing region boundary\n    let regionSeq: string | undefined\n\n    if (sequenceAdapter) {\n      const [feat] = await sequenceAdapter\n        .getFeatures({ refName, start, end: end + 1, assemblyName: 'na' })\n        .pipe(toArray())\n        .toPromise()\n      regionSeq = feat?.get('seq')\n    }\n\n    return features\n      .pipe(\n        reduce((bins, feature) => {\n          const cigar = feature.get('CIGAR')\n          const fstart = feature.get('start')\n          const fend = feature.get('end')\n          const fstrand = feature.get('strand')\n          const cigarOps = parseCigar(cigar)\n\n          for (let j = fstart; j < fend; j++) {\n            const i = j - region.start\n            if (i >= 0 && i < bins.length) {\n              const bin = bins[i]\n              bin.total++\n              inc(bin, fstrand, 'ref', 'ref')\n            }\n          }\n\n          if (colorBy?.type === 'modifications') {\n            const seq = feature.get('seq')\n            const mm = getTagAlt(feature, 'MM', 'Mm') || ''\n\n            const ml =\n              (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n\n            const probabilities = ml\n              ? (typeof ml === 'string' ? ml.split(',').map(e => +e) : ml).map(\n                  e => e / 255,\n                )\n              : (getTagAlt(feature, 'MP', 'Mp') as string)\n                  .split('')\n                  .map(s => s.charCodeAt(0) - 33)\n                  .map(elt => Math.min(1, elt / 50))\n\n            let probIndex = 0\n            getModificationPositions(mm, seq).forEach(({ type, positions }) => {\n              const mod = `mod_${type}`\n              for (const pos of getNextRefPos(cigarOps, positions)) {\n                const epos = pos + fstart - region.start\n                if (epos >= 0 && epos < bins.length && pos + fstart < fend) {\n                  const bin = bins[epos]\n                  if (probabilities[probIndex] > 0.5) {\n                    inc(bin, fstrand, 'cov', mod)\n                  } else {\n                    inc(bin, fstrand, 'lowqual', mod)\n                  }\n                }\n                probIndex++\n              }\n            })\n          }\n\n          // methylation based coloring takes into account both reference\n          // sequence CpG detection and reads\n          else if (colorBy?.type === 'methylation') {\n            if (!regionSeq) {\n              throw new Error(\n                'no region sequence detected, need sequenceAdapter configuration',\n              )\n            }\n            const seq = feature.get('seq')\n            const mm = getTagAlt(feature, 'MM', 'Mm') || ''\n            const methBins = new Array(region.end - region.start).fill(0)\n\n            getModificationPositions(mm, seq).forEach(({ type, positions }) => {\n              // we are processing methylation\n              if (type === 'm') {\n                for (const pos of getNextRefPos(cigarOps, positions)) {\n                  const epos = pos + fstart - region.start\n                  if (epos >= 0 && epos < methBins.length) {\n                    methBins[epos] = 1\n                  }\n                }\n              }\n            })\n\n            for (let j = fstart; j < fend; j++) {\n              const i = j - region.start\n              if (i >= 0 && i < bins.length) {\n                const l2 = regionSeq[i + 1]\n                const l1 = regionSeq[i]\n                const bin = bins[i]\n                // color\n                if (l1.toUpperCase() === 'C' && l2.toUpperCase() === 'G') {\n                  if (methBins[i]) {\n                    inc(bin, fstrand, 'cov', 'meth')\n                    dec(bin, fstrand, 'ref', 'ref')\n                  } else {\n                    inc(bin, fstrand, 'cov', 'unmeth')\n                    dec(bin, fstrand, 'ref', 'ref')\n                  }\n                }\n              }\n            }\n          }\n\n          // normal SNP based coloring\n          else {\n            const mismatches = feature.get('mismatches')\n            for (let i = 0; i < mismatches?.length; i++) {\n              const mismatch = mismatches[i] as Mismatch\n              const mstart = fstart + mismatch.start\n              for (let j = mstart; j < mstart + mismatchLen(mismatch); j++) {\n                const epos = j - region.start\n                if (epos >= 0 && epos < bins.length) {\n                  const bin = bins[epos]\n                  const { base, type } = mismatch\n                  const interbase = isInterbase(type)\n                  if (!interbase) {\n                    dec(bin, fstrand, 'ref', 'ref')\n                  } else {\n                    inc(bin, fstrand, 'noncov', type)\n                  }\n\n                  if (type === 'deletion' || type === 'skip') {\n                    inc(bin, fstrand, 'delskips', type)\n                    bin.total--\n                  } else if (!interbase) {\n                    inc(bin, fstrand, 'cov', base)\n                  }\n                }\n              }\n            }\n          }\n\n          return bins\n        }, initBins),\n      )\n      .toPromise()\n  }\n}\n\nconst { capabilities } = SNPCoverageAdapter\nexport { capabilities }\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"81539e22f8620ca5f799.worker.js\");\n};","/* eslint curly:error */\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport default class AdapterType extends PluggableElementBase {\n  AdapterClass?: AnyAdapter\n\n  getAdapterClass?: () => Promise<AnyAdapter>\n\n  configSchema: AnyConfigurationSchemaType\n\n  adapterCapabilities: string[]\n\n  constructor(\n    stuff: {\n      name: string\n      configSchema: AnyConfigurationSchemaType\n      adapterCapabilities?: string[]\n    } & (\n      | { AdapterClass: AnyAdapter }\n      | { getAdapterClass: () => Promise<AnyAdapter> }\n    ),\n  ) {\n    super(stuff)\n    if ('AdapterClass' in stuff) {\n      this.AdapterClass = stuff.AdapterClass\n    } else if ('getAdapterClass' in stuff) {\n      this.getAdapterClass = stuff.getAdapterClass\n    } else {\n      throw new Error(\n        `no AdapterClass or getAdapterClass is defined for adapter type ${this.name}`,\n      )\n    }\n    this.configSchema = stuff.configSchema\n    this.adapterCapabilities = stuff.adapterCapabilities || []\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyReactComponentType } from '../util'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class DisplayType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  ReactComponent: AnyReactComponentType\n\n  trackType: string\n\n  viewType: string\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    trackType: string\n    viewType: string\n    configSchema: AnyConfigurationSchemaType\n    ReactComponent: AnyReactComponentType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.ReactComponent = stuff.ReactComponent\n    this.trackType = stuff.trackType\n    this.viewType = stuff.viewType\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for display ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for display ${this.name}`)\n    }\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent provided for display ${this.name}`)\n    }\n    if (!this.trackType) {\n      throw new Error(`no trackType provided for display ${this.name}`)\n    }\n    if (!this.viewType) {\n      throw new Error(`no viewType provided for display ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../util'\n\nexport default class ConnectionType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayName: string\n\n  description: string\n\n  url: string\n\n  configEditorComponent?: AnyReactComponentType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n    displayName: string\n    description: string\n    configEditorComponent?: AnyReactComponentType\n    url: string\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.displayName = stuff.displayName\n    this.description = stuff.description\n    this.url = stuff.url\n    this.configEditorComponent = stuff.configEditorComponent\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for connection ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema defined for connection ${this.name}`)\n    }\n  }\n}\n","/* ---------------- for the RPC client ----------------- */\n\nlet abortSignalCounter = 0\nexport type RemoteAbortSignal = { abortSignalId: number }\nconst abortSignalIds: WeakMap<AbortSignal, number> = new WeakMap() // map of abortsignal => numerical ID\n\n/**\n * assign an ID to the given abort signal and return a plain object representation\n * @param signal - the signal to serialize\n * @param callfunc - function used to call\n *  a remote method, will be called like callfunc('signalAbort', signalId)\n */\nexport function serializeAbortSignal(\n  signal: AbortSignal,\n  callfunc: (name: string, abortSignalId: number) => void,\n): RemoteAbortSignal {\n  let abortSignalId = abortSignalIds.get(signal)\n  if (!abortSignalId) {\n    abortSignalCounter += 1\n    abortSignalIds.set(signal, abortSignalCounter)\n    abortSignalId = abortSignalCounter\n    signal.addEventListener('abort', () => {\n      const signalId = abortSignalIds.get(signal)\n      if (signalId !== undefined) {\n        callfunc('signalAbort', signalId)\n      }\n    })\n  }\n  return { abortSignalId }\n}\n\n/* ---------------- for the RPC server ----------------- */\n\n/**\n * test whether a given object\n * @param thing - the thing to test\n * @returns true if the thing is a remote abort signal\n */\nexport function isRemoteAbortSignal(\n  thing: unknown,\n): thing is RemoteAbortSignal {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'abortSignalId' in thing &&\n    // @ts-ignore\n    typeof thing.abortSignalId === 'number'\n  )\n}\n\n// the server side keeps a set of surrogate abort controllers that can be\n// aborted based on ID\nconst surrogateAbortControllers: Map<number, AbortController> = new Map() // numerical ID => surrogate abort controller\n\n/**\n * deserialize the result of serializeAbortSignal into an AbortSignal\n *\n * @param signal -\n * @returns an abort signal that corresponds to the given ID\n */\nexport function deserializeAbortSignal({\n  abortSignalId,\n}: RemoteAbortSignal): AbortSignal {\n  let surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n  if (!surrogateAbortController) {\n    surrogateAbortController = new AbortController()\n    surrogateAbortControllers.set(abortSignalId, surrogateAbortController)\n  }\n  return surrogateAbortController.signal\n}\n\n/**\n * fire an abort signal from a remote abort signal ID\n *\n * @param abortSignalId -\n */\nexport function remoteAbort(props: { signalId: number }) {\n  const { signalId: abortSignalId } = props\n  const surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n\n  if (surrogateAbortController) {\n    surrogateAbortController.abort()\n  }\n}\n\nexport function remoteAbortRpcHandler() {\n  return {\n    signalAbort: remoteAbort,\n  }\n}\n","import PluginManager from '../PluginManager'\nimport PluggableElementBase from './PluggableElementBase'\nimport { setBlobMap, getBlobMap } from '../util/tracks'\n\nimport {\n  deserializeAbortSignal,\n  isRemoteAbortSignal,\n  RemoteAbortSignal,\n} from '../rpc/remoteAbortSignals'\n\nexport type RpcMethodConstructor = new (pm: PluginManager) => RpcMethodType\n\nexport default abstract class RpcMethodType extends PluggableElementBase {\n  pluginManager: PluginManager\n\n  name = 'UNKNOWN'\n\n  constructor(pluginManager: PluginManager) {\n    super({ name: '' })\n    this.pluginManager = pluginManager\n  }\n\n  async serializeArguments(args: {}, _rpcDriverClassName: string): Promise<{}> {\n    const blobMap = getBlobMap()\n    return { ...args, blobMap }\n  }\n\n  async deserializeArguments<\n    SERIALIZED extends {\n      signal?: RemoteAbortSignal\n      blobMap?: Record<string, File>\n    }\n  >(serializedArgs: SERIALIZED, _rpcDriverClassName: string) {\n    if (serializedArgs.blobMap) {\n      setBlobMap(serializedArgs.blobMap)\n    }\n    const { signal } = serializedArgs\n    if (signal && isRemoteAbortSignal(signal)) {\n      return { ...serializedArgs, signal: deserializeAbortSignal(signal) }\n    }\n\n    return { ...serializedArgs, signal: undefined }\n  }\n\n  abstract async execute(\n    serializedArgs: unknown,\n    rpcDriverClassName: string,\n  ): Promise<unknown>\n\n  async serializeReturn(\n    originalReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ) {\n    return originalReturn\n  }\n\n  async deserializeReturn(\n    serializedReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ): Promise<unknown> {\n    return serializedReturn\n  }\n}\n","import { types } from 'mobx-state-tree'\nimport PluginManager from '../PluginManager'\nimport { ConfigurationSchema } from '../configuration'\nimport { ElementId } from '../util/types/mst'\n\nconst configSchema = ConfigurationSchema('BaseFeatureWidget', {})\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('BaseFeatureWidget', {\n      id: ElementId,\n      type: types.literal('BaseFeatureWidget'),\n      featureData: types.frozen(),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      setFeatureData(data: Record<string, unknown>) {\n        self.featureData = data\n      },\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n    }))\n}\n\nexport { configSchema, stateModelFactory }\n","import jsonStableStringify from 'json-stable-stringify'\nimport { SnapshotIn } from 'mobx-state-tree'\nimport PluginManager from '../PluginManager'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyDataAdapter } from './BaseAdapter'\nimport { Region } from '../util/types'\n\nfunction adapterConfigCacheKey(\n  adapterConfig: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  return `${jsonStableStringify(adapterConfig)}`\n}\n\ninterface AdapterCacheEntry {\n  dataAdapter: AnyDataAdapter\n  sessionIds: Set<string>\n}\n\nlet adapterCache: Record<string, AdapterCacheEntry> = {}\n\n/**\n * instantiate a data adapter, or return an already-instantiated one if we have one with the same\n * configuration\n *\n * @param pluginManager -\n * @param sessionId - session ID of the associated worker session.\n *   used for reference counting\n * @param adapterConfigSnapshot - plain-JS configuration snapshot for the adapter\n */\nexport async function getAdapter(\n  pluginManager: PluginManager,\n  sessionId: string,\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  // cache the adapter object\n  const cacheKey = adapterConfigCacheKey(adapterConfigSnapshot)\n  if (!adapterCache[cacheKey]) {\n    const adapterType = (adapterConfigSnapshot || {}).type\n    if (!adapterType) {\n      throw new Error(\n        'could not determine adapter type from adapter config snapshot',\n      )\n    }\n    const dataAdapterType = pluginManager.getAdapterType(adapterType)\n    if (!dataAdapterType) {\n      throw new Error(`unknown data adapter type ${adapterType}`)\n    }\n\n    // instantiate the data adapter's config schema so it gets its defaults,\n    // callbacks, etc\n    const adapterConfig = dataAdapterType.configSchema.create(\n      adapterConfigSnapshot,\n      { pluginManager },\n    )\n\n    const getSubAdapter = getAdapter.bind(null, pluginManager, sessionId)\n\n    // instantiate the adapter itself with its config schema, and a bound\n    // func that it can use to get any inner adapters\n    // (such as sequence adapters or wrapped subadapters) that it needs\n    //\n    const { AdapterClass, getAdapterClass } = dataAdapterType\n\n    // @ts-ignore\n    const CLASS = AdapterClass || (await getAdapterClass())\n    if (!CLASS) {\n      throw new Error('Failed to get adapter')\n    }\n\n    const dataAdapter = new CLASS(adapterConfig, getSubAdapter)\n\n    // store it in our cache\n    adapterCache[cacheKey] = {\n      dataAdapter,\n      sessionIds: new Set([sessionId]),\n    }\n  }\n\n  const cacheEntry = adapterCache[cacheKey]\n  cacheEntry.sessionIds.add(sessionId)\n\n  return cacheEntry\n}\n\n/**\n * this is a callback that is passed to adapters that\n * allows them to get any sub-adapters that they need\n * internally, staying with the same worker session ID\n */\nexport type getSubAdapterType = (\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) => ReturnType<typeof getAdapter>\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function freeAdapterResources(specification: Record<string, any>) {\n  let deleteCount = 0\n\n  const specKeys = Object.keys(specification)\n\n  // if we don't specify a range, delete any adapters that are\n  // only associated with that session\n  if (specKeys.length === 1 && specKeys[0] === 'sessionId') {\n    const { sessionId } = specification\n    Object.entries(adapterCache).forEach(([cacheKey, cacheEntry]) => {\n      cacheEntry.sessionIds.delete(sessionId)\n      if (cacheEntry.sessionIds.size === 0) {\n        deleteCount += 1\n        delete adapterCache[cacheKey]\n      }\n    })\n  } else {\n    // otherwise call freeResources on all the cached data adapters\n    Object.values(adapterCache).forEach(cacheEntry => {\n      if (!cacheEntry.dataAdapter.freeResources) {\n        console.warn(cacheEntry.dataAdapter, 'does not implement freeResources')\n      } else {\n        const regions =\n          specification.regions ||\n          (specification.region ? [specification.region] : [])\n        regions.forEach((region: Region) => {\n          if (region.refName !== undefined) {\n            cacheEntry.dataAdapter.freeResources(region)\n          }\n        })\n      }\n    })\n  }\n\n  return deleteCount\n}\n\nexport function clearAdapterCache() {\n  adapterCache = {}\n}\n","import { toArray } from 'rxjs/operators'\nimport {\n  freeAdapterResources,\n  getAdapter,\n} from '../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../pluggableElementTypes/RpcMethodType'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport { RemoteAbortSignal } from './remoteAbortSignals'\nimport {\n  BaseFeatureDataAdapter,\n  isFeatureAdapter,\n} from '../data_adapters/BaseAdapter'\nimport { Region } from '../util/types'\nimport { checkAbortSignal, renameRegionsIfNeeded } from '../util'\nimport SimpleFeature, { SimpleFeatureSerialized } from '../util/simpleFeature'\n\nexport class CoreGetRefNames extends RpcMethodType {\n  name = 'CoreGetRefNames'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      return dataAdapter.getRefNames(deserializedArgs)\n    }\n    return []\n  }\n}\n\nexport class CoreGetFileInfo extends RpcMethodType {\n  name = 'CoreGetInfo'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getHeader(deserializedArgs)\n      : null\n  }\n}\n\nexport class CoreGetMetadata extends RpcMethodType {\n  name = 'CoreGetMetadata'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getMetadata(deserializedArgs)\n      : null\n  }\n}\n\nexport class CoreGetFeatures extends RpcMethodType {\n  name = 'CoreGetFeatures'\n\n  async deserializeReturn(feats: SimpleFeatureSerialized[]) {\n    return feats.map(feat => {\n      return new SimpleFeature(feat)\n    })\n  }\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      region: Region\n      adapterConfig: {}\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { sessionId, adapterConfig, region } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (isFeatureAdapter(dataAdapter)) {\n      const ret = dataAdapter.getFeatures(region)\n      const r = await ret.pipe(toArray()).toPromise()\n      return r.map(f => f.toJSON())\n    }\n    return []\n  }\n}\n\n/**\n * free up any resources (e.g. cached adapter objects)\n * that are only associated with the given track ID.\n *\n * returns number of objects deleted\n */\nexport class CoreFreeResources extends RpcMethodType {\n  name = 'CoreFreeResources'\n\n  async execute(specification: {}) {\n    let deleteCount = 0\n\n    deleteCount += freeAdapterResources(specification)\n\n    // pass the freeResources hint along to all the renderers as well\n    this.pluginManager.getRendererTypes().forEach(renderer => {\n      const count = renderer.freeResources(/* specification */)\n      if (count) {\n        deleteCount += count\n      }\n    })\n\n    return deleteCount\n  }\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  assemblyName: string\n  regions: Region[]\n  adapterConfig: {}\n  rendererType: string\n}\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport class CoreRender extends RpcMethodType {\n  name = 'CoreRender'\n\n  async serializeArguments(args: RenderArgs, rpcDriverClassName: string) {\n    const assemblyManager = this.pluginManager.rootModel?.session\n      ?.assemblyManager\n    const renamedArgs = assemblyManager\n      ? await renameRegionsIfNeeded(assemblyManager, args)\n      : args\n\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return renamedArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return RendererType.serializeArgsInClient(renamedArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriverClassName: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriverClassName !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(\n        args,\n        rpcDriverClassName,\n      )\n    }\n    const { sessionId, adapterConfig, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (!(dataAdapter instanceof BaseFeatureDataAdapter)) {\n      throw new Error(\n        `CoreRender cannot handle this type of data adapter ${dataAdapter}`,\n      )\n    }\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    const renderArgs = {\n      ...deserializedArgs,\n      dataAdapter,\n    }\n\n    const result =\n      rpcDriverClassName === 'MainThreadRpcDriver'\n        ? await RendererType.render(renderArgs)\n        : await RendererType.renderInWorker(renderArgs)\n\n    checkAbortSignal(signal)\n    return result\n  }\n\n  async deserializeReturn(\n    serializedReturn: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriverClassName: string,\n  ): Promise<unknown> {\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return serializedReturn\n    }\n\n    const { rendererType } = args\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n    return RendererType.deserializeResultsInClient(\n      serializedReturn as ResultsSerialized,\n      args,\n    )\n  }\n}\n\nfunction validateRendererType<T>(rendererType: string, RendererType: T) {\n  if (!RendererType) {\n    throw new Error(`renderer \"${rendererType}\" not found`)\n  }\n  // @ts-ignore\n  if (!RendererType.ReactComponent) {\n    throw new Error(\n      `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n    )\n  }\n\n  if (!(RendererType instanceof ServerSideRendererType)) {\n    throw new Error(\n      'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n    )\n  }\n  return RendererType\n}\n","import { lazy } from 'react'\nimport { configSchema, stateModelFactory } from './BaseFeatureWidget'\nimport Plugin from './Plugin'\nimport PluginManager from './PluginManager'\nimport * as coreRpcMethods from './rpc/coreRpcMethods'\nimport WidgetType from './pluggableElementTypes/WidgetType'\n\n/** the core plugin, which registers types that ALL JBrowse applications are expected to need. */\nexport default class CorePlugin extends Plugin {\n  name = 'CorePlugin'\n\n  install(pluginManager: PluginManager) {\n    // register all our core rpc methods\n    Object.values(coreRpcMethods).forEach(RpcMethod => {\n      pluginManager.addRpcMethod(() => new RpcMethod(pluginManager))\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'BaseFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./BaseFeatureWidget/BaseFeatureDetail'),\n        ),\n      })\n    })\n  }\n}\n","import {\n  types,\n  IAnyType,\n  IAnyModelType,\n  isModelType,\n  isType,\n} from 'mobx-state-tree'\n\nimport PluggableElementBase from './pluggableElementTypes/PluggableElementBase'\nimport RendererType from './pluggableElementTypes/renderers/RendererType'\nimport AdapterType from './pluggableElementTypes/AdapterType'\nimport TrackType from './pluggableElementTypes/TrackType'\nimport DisplayType from './pluggableElementTypes/DisplayType'\nimport ViewType from './pluggableElementTypes/ViewType'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport ConnectionType from './pluggableElementTypes/ConnectionType'\nimport RpcMethodType from './pluggableElementTypes/RpcMethodType'\n\nimport {\n  ConfigurationSchema,\n  isBareConfigurationSchemaType,\n} from './configuration'\n\nimport Plugin from './Plugin'\nimport ReExports from './ReExports'\n\nimport {\n  PluggableElementType,\n  PluggableElementMember,\n} from './pluggableElementTypes'\nimport { AnyConfigurationSchemaType } from './configuration/configurationSchema'\nimport { AbstractRootModel } from './util'\nimport CorePlugin from './CorePlugin'\nimport createJexlInstance from './util/jexl'\nimport { PluginDefinition } from './PluginLoader'\n\n/** little helper class that keeps groups of callbacks that are\nthen run in a specified order by group */\nclass PhasedScheduler<PhaseName extends string> {\n  phaseCallbacks = new Map<PhaseName, Function[]>()\n\n  phaseOrder: PhaseName[] = []\n\n  constructor(...phaseOrder: PhaseName[]) {\n    this.phaseOrder = phaseOrder\n  }\n\n  add(phase: PhaseName, callback: Function) {\n    if (!this.phaseOrder.includes(phase)) {\n      throw new Error(`unknown phase ${phase}`)\n    }\n    let phaseCallbacks = this.phaseCallbacks.get(phase)\n    if (!phaseCallbacks) {\n      phaseCallbacks = []\n      this.phaseCallbacks.set(phase, phaseCallbacks)\n    }\n    phaseCallbacks.push(callback)\n  }\n\n  run() {\n    this.phaseOrder.forEach(phaseName => {\n      const phaseCallbacks = this.phaseCallbacks.get(phaseName)\n      if (phaseCallbacks) {\n        phaseCallbacks.forEach(callback => callback())\n      }\n    })\n  }\n}\n\ntype PluggableElementTypeGroup =\n  | 'renderer'\n  | 'adapter'\n  | 'display'\n  | 'track'\n  | 'connection'\n  | 'view'\n  | 'widget'\n  | 'rpc method'\n\n/** internal class that holds the info for a certain element type */\nclass TypeRecord<ElementClass extends PluggableElementBase> {\n  registeredTypes: { [name: string]: ElementClass } = {}\n\n  baseClass: // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  | { new (...args: any[]): ElementClass }\n    // covers abstract class case\n    | (Function & {\n        prototype: ElementClass\n      })\n\n  typeName: string\n\n  constructor(\n    typeName: string,\n    elementType: // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    | { new (...args: any[]): ElementClass }\n      // covers abstract class case\n      | (Function & {\n          prototype: ElementClass\n        }),\n  ) {\n    this.typeName = typeName\n    this.baseClass = elementType\n  }\n\n  add(name: string, t: ElementClass) {\n    this.registeredTypes[name] = t\n  }\n\n  has(name: string) {\n    return name in this.registeredTypes\n  }\n\n  get(name: string) {\n    if (!this.has(name)) {\n      throw new Error(\n        `${this.typeName} '${name}' not found, perhaps its plugin is not loaded or its plugin has not added it.`,\n      )\n    }\n    return this.registeredTypes[name]\n  }\n\n  all() {\n    return Object.values(this.registeredTypes)\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AnyFunction = (...args: any) => any\n\n/**\n * free-form string-to-unknown mapping of metadata related to the instance\n * of this plugin. `isCore` is typically set to `Boolean(true)` if the plugin was\n * loaded as part of the \"core\" set of plugins for this application.\n * Can also use this metadata to stash other things about why the plugin is\n * loaded, such as where it came from, what plugin depends on it, etc.\n */\nexport type PluginMetadata = Record<string, unknown>\n\nexport interface PluginLoadRecord {\n  metadata?: PluginMetadata\n  plugin: Plugin\n}\nexport interface RuntimePluginLoadRecord extends PluginLoadRecord {\n  definition: PluginDefinition\n}\n\nexport default class PluginManager {\n  plugins: Plugin[] = []\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  jexl: any = createJexlInstance()\n\n  pluginMetadata: Record<string, PluginMetadata> = {}\n\n  runtimePluginDefinitions: PluginDefinition[] = []\n\n  elementCreationSchedule = new PhasedScheduler<PluggableElementTypeGroup>(\n    'renderer',\n    'adapter',\n    'display',\n    'track',\n    'connection',\n    'view',\n    'widget',\n    'rpc method',\n  )\n\n  rendererTypes = new TypeRecord('RendererType', RendererType)\n\n  adapterTypes = new TypeRecord('AdapterType', AdapterType)\n\n  trackTypes = new TypeRecord('TrackType', TrackType)\n\n  displayTypes = new TypeRecord('DisplayType', DisplayType)\n\n  connectionTypes = new TypeRecord('ConnectionType', ConnectionType)\n\n  viewTypes = new TypeRecord('ViewType', ViewType)\n\n  widgetTypes = new TypeRecord('WidgetType', WidgetType)\n\n  rpcMethods = new TypeRecord('RpcMethodType', RpcMethodType)\n\n  configured = false\n\n  rootModel?: AbstractRootModel\n\n  constructor(initialPlugins: (Plugin | PluginLoadRecord)[] = []) {\n    // add the core plugin\n    this.addPlugin({ plugin: new CorePlugin(), metadata: { isCore: true } })\n\n    // add all the initial plugins\n    initialPlugins.forEach(plugin => {\n      this.addPlugin(plugin)\n    })\n  }\n\n  pluginConfigurationSchemas() {\n    const configurationSchemas: { [key: string]: unknown } = {}\n    this.plugins.forEach(plugin => {\n      if (plugin.configurationSchema) {\n        configurationSchemas[plugin.name] = plugin.configurationSchema\n      }\n    })\n    return configurationSchemas\n  }\n\n  addPlugin(load: Plugin | PluginLoadRecord | RuntimePluginLoadRecord) {\n    if (this.configured) {\n      throw new Error('JBrowse already configured, cannot add plugins')\n    }\n    const [plugin, metadata = {}] =\n      load instanceof Plugin ? [load, {}] : [load.plugin, load.metadata]\n\n    if (this.plugins.includes(plugin)) {\n      throw new Error('plugin already installed')\n    }\n\n    this.pluginMetadata[plugin.name] = metadata\n    if ('definition' in load) {\n      this.runtimePluginDefinitions.push(load.definition)\n    }\n    plugin.install(this)\n    this.plugins.push(plugin)\n    return this\n  }\n\n  getPlugin(name: string) {\n    return this.plugins.find(p => p.name === name)\n  }\n\n  hasPlugin(name: string) {\n    return this.getPlugin(name) !== undefined\n  }\n\n  createPluggableElements() {\n    // run the creation callbacks for each element type in order.\n    // see elementCreationSchedule above for the creation order\n    this.elementCreationSchedule.run()\n    delete this.elementCreationSchedule\n    return this\n  }\n\n  setRootModel(rootModel: AbstractRootModel) {\n    this.rootModel = rootModel\n  }\n\n  configure() {\n    if (this.configured) {\n      throw new Error('already configured')\n    }\n\n    this.plugins.forEach(plugin => plugin.configure(this))\n\n    this.configured = true\n\n    // console.log(JSON.stringify(getSnapshot(model)))\n\n    return this\n  }\n\n  getElementTypeRecord(\n    groupName: PluggableElementTypeGroup,\n  ): TypeRecord<PluggableElementBase> {\n    switch (groupName) {\n      case 'adapter':\n        return this.adapterTypes\n      case 'connection':\n        return this.connectionTypes\n      case 'widget':\n        return this.widgetTypes\n      case 'renderer':\n        return this.rendererTypes\n      case 'display':\n        return this.displayTypes\n      case 'track':\n        return this.trackTypes\n      case 'view':\n        return this.viewTypes\n      case 'rpc method':\n        return this.rpcMethods\n      default:\n        throw new Error(`invalid element type '${groupName}'`)\n    }\n  }\n\n  addElementType(\n    groupName: PluggableElementTypeGroup,\n    creationCallback: (pluginManager: PluginManager) => PluggableElementType,\n  ) {\n    if (typeof creationCallback !== 'function') {\n      throw new Error(\n        'must provide a callback function that returns the new type object',\n      )\n    }\n    const typeRecord = this.getElementTypeRecord(groupName)\n\n    this.elementCreationSchedule.add(groupName, () => {\n      const newElement = creationCallback(this)\n      if (!newElement.name) {\n        throw new Error(`cannot add a ${groupName} with no name`)\n      }\n\n      if (typeRecord.has(newElement.name)) {\n        throw new Error(\n          `${groupName} ${newElement.name} already registered, cannot register it again`,\n        )\n      }\n\n      typeRecord.add(newElement.name, newElement)\n    })\n\n    return this\n  }\n\n  getElementType(groupName: PluggableElementTypeGroup, typeName: string) {\n    const typeRecord = this.getElementTypeRecord(groupName)\n    return typeRecord.get(typeName)\n  }\n\n  getElementTypesInGroup(groupName: PluggableElementTypeGroup) {\n    const typeRecord = this.getElementTypeRecord(groupName)\n    return typeRecord.all()\n  }\n\n  /** get a MST type for the union of all specified pluggable MST types */\n  pluggableMstType(\n    typeGroup: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember,\n    fallback: IAnyType = types.maybe(types.null),\n  ) {\n    const pluggableTypes: IAnyModelType[] = []\n    this.getElementTypeRecord(typeGroup)\n      .all()\n      .forEach(t => {\n        const thing = t[fieldName]\n        if (isType(thing) && isModelType(thing)) {\n          pluggableTypes.push(thing)\n        }\n      })\n\n    // try to smooth over the case when no types are registered, mostly\n    // encountered in tests\n    if (pluggableTypes.length === 0) {\n      console.warn(\n        `No JBrowse pluggable types found matching ('${typeGroup}','${fieldName}')`,\n      )\n      return fallback\n    }\n    return types.union(...pluggableTypes)\n  }\n\n  /** get a MST type for the union of all specified pluggable config schemas */\n  pluggableConfigSchemaType(\n    typeGroup: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember = 'configSchema',\n  ) {\n    const pluggableTypes: AnyConfigurationSchemaType[] = []\n    this.getElementTypeRecord(typeGroup)\n      .all()\n      .forEach(t => {\n        const thing = t[fieldName]\n        if (isBareConfigurationSchemaType(thing)) {\n          pluggableTypes.push(thing)\n        }\n      })\n    if (pluggableTypes.length === 0) {\n      pluggableTypes.push(ConfigurationSchema('Null', {}))\n    }\n    return types.union(...pluggableTypes)\n  }\n\n  jbrequireCache = new Map()\n\n  lib = ReExports\n\n  load = <FTYPE extends AnyFunction>(lib: FTYPE): ReturnType<FTYPE> => {\n    if (!this.jbrequireCache.has(lib)) {\n      this.jbrequireCache.set(lib, lib(this))\n    }\n    return this.jbrequireCache.get(lib)\n  }\n\n  /**\n   * Get the re-exported version of the given package name.\n   * Throws an error if the package is not re-exported by the plugin manager.\n   *\n   * @returns the library's default export\n   */\n  jbrequire = (\n    lib: keyof typeof ReExports | AnyFunction | { default: AnyFunction },\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any => {\n    if (typeof lib === 'string') {\n      const pack = this.lib[lib]\n      if (!pack) {\n        throw new TypeError(\n          `No jbrequire re-export defined for package '${lib}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`,\n        )\n      }\n      return pack\n    }\n\n    if (typeof lib === 'function') {\n      return this.load(lib)\n    }\n\n    if (lib.default) {\n      return this.jbrequire(lib.default)\n    }\n\n    throw new TypeError(\n      'lib passed to jbrequire must be either a string or a function',\n    )\n  }\n\n  getRendererType(typeName: string): RendererType {\n    return this.rendererTypes.get(typeName)\n  }\n\n  getRendererTypes(): RendererType[] {\n    return this.rendererTypes.all()\n  }\n\n  getAdapterType(typeName: string): AdapterType {\n    return this.adapterTypes.get(typeName)\n  }\n\n  getTrackType(typeName: string): TrackType {\n    return this.trackTypes.get(typeName)\n  }\n\n  getDisplayType(typeName: string): DisplayType {\n    return this.displayTypes.get(typeName)\n  }\n\n  getViewType(typeName: string): ViewType {\n    return this.viewTypes.get(typeName)\n  }\n\n  getWidgetType(typeName: string): WidgetType {\n    return this.widgetTypes.get(typeName)\n  }\n\n  getConnectionType(typeName: string): ConnectionType {\n    return this.connectionTypes.get(typeName)\n  }\n\n  getRpcMethodType(methodName: string): RpcMethodType {\n    return this.rpcMethods.get(methodName)\n  }\n\n  addRendererType(\n    creationCallback: (pluginManager: PluginManager) => RendererType,\n  ): this {\n    return this.addElementType('renderer', creationCallback)\n  }\n\n  addAdapterType(\n    creationCallback: (pluginManager: PluginManager) => AdapterType,\n  ): this {\n    return this.addElementType('adapter', creationCallback)\n  }\n\n  addTrackType(\n    creationCallback: (pluginManager: PluginManager) => TrackType,\n  ): this {\n    // Goes through the already-created displays and registers the ones that\n    // specify this track type\n    const callback = () => {\n      const track = creationCallback(this)\n      ;(this.getElementTypesInGroup('display') as DisplayType[]).forEach(\n        display => {\n          if (\n            display.trackType === track.name &&\n            // track may have already added the displayType in its creationCallback\n            !track.displayTypes.includes(display)\n          ) {\n            track.addDisplayType(display)\n          }\n        },\n      )\n      return track\n    }\n    return this.addElementType('track', callback)\n  }\n\n  addDisplayType(\n    creationCallback: (pluginManager: PluginManager) => DisplayType,\n  ): this {\n    return this.addElementType('display', creationCallback)\n  }\n\n  addViewType(\n    creationCallback: (pluginManager: PluginManager) => ViewType,\n  ): this {\n    const callback = () => {\n      const newView = creationCallback(this)\n      ;(this.getElementTypesInGroup('display') as DisplayType[]).forEach(\n        display => {\n          if (\n            display.viewType === newView.name &&\n            // view may have already added the displayType in its creationCallback\n            !newView.displayTypes.includes(display)\n          ) {\n            newView.addDisplayType(display)\n          }\n        },\n      )\n      return newView\n    }\n    return this.addElementType('view', callback)\n  }\n\n  addWidgetType(\n    creationCallback: (pluginManager: PluginManager) => WidgetType,\n  ): this {\n    return this.addElementType('widget', creationCallback)\n  }\n\n  addConnectionType(\n    creationCallback: (pluginManager: PluginManager) => ConnectionType,\n  ): this {\n    return this.addElementType('connection', creationCallback)\n  }\n\n  addRpcMethod(\n    creationCallback: (pluginManager: PluginManager) => RpcMethodType,\n  ): this {\n    return this.addElementType('rpc method', creationCallback)\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { readConfObject } from '../configuration'\n\ninterface AnalyticsObj {\n  [key: string]: any\n}\n\ninterface Track {\n  [key: string]: any\n}\n\nexport async function writeAWSAnalytics(\n  rootModel: any,\n  initialTimeStamp: number,\n  sessionQuery?: string | null,\n) {\n  const url = 'https://analytics.jbrowse.org/api/v1'\n\n  const multiAssemblyTracks = rootModel.jbrowse.tracks.filter(\n    (track: any) => (readConfObject(track, 'assemblyNames') || []).length > 1,\n  ).length\n\n  const savedSessionCount = Object.keys(localStorage).filter(name =>\n    name.includes('localSaved-'),\n  ).length\n\n  const { jbrowse: config, session, version: ver } = rootModel\n  const { tracks, assemblies, plugins } = config\n\n  // stats to be recorded in db\n  const stats: AnalyticsObj = {\n    ver,\n    'plugins-count': plugins?.length || 0,\n    'plugin-names': plugins?.map((p: any) => p.name).join(','),\n    'assemblies-count': assemblies.length,\n    'tracks-count': tracks.length,\n    'session-tracks-count': session?.sessionTracks.length || 0,\n    'open-views': session?.views.length || 0,\n    'synteny-tracks-count': multiAssemblyTracks,\n    'saved-sessions-count': savedSessionCount,\n\n    // field if existing session param in query before autogenerated param\n    'existing-session-param-type': sessionQuery?.split('-')[0] || 'none',\n\n    // screen geometry\n    'scn-h': window.screen.height,\n    'scn-w': window.screen.width,\n\n    // window geometry\n    'win-h': window.innerHeight,\n    'win-w': window.innerWidth,\n\n    electron: typeof window !== 'undefined' && Boolean(window.electron),\n    loadTime: (Date.now() - initialTimeStamp) / 1000,\n    jb2: true,\n  }\n\n  // stringifies the track type counts, gets processed in lambda\n  tracks.forEach((track: Track) => {\n    stats[`track-types-${track.type}`] =\n      stats[`track-types-${track.type}`] + 1 || 1\n  })\n\n  // stringifies the session track type counts, gets processed in lambda\n  session?.sessionTracks.forEach((track: Track) => {\n    stats[`sessionTrack-types-${track.type}`] =\n      stats[`sessionTrack-types-${track.type}`] + 1 || 1\n  })\n\n  // put stats into a query string for get request\n  const qs = Object.keys(stats)\n    .map(key => `${key}=${stats[key]}`)\n    .join('&')\n\n  return fetch(`${url}?${qs}`)\n}\n\nexport async function writeGAAnalytics(\n  rootModel: any,\n  initialTimeStamp: number,\n) {\n  const jbrowseUser = 'UA-7115575-5'\n  const stats: AnalyticsObj = {\n    'tracks-count': rootModel.jbrowse.tracks.length, // this is all possible tracks\n    ver: rootModel.version,\n    electron: typeof window !== 'undefined' && Boolean(window.electron),\n    loadTime: Date.now() - initialTimeStamp,\n    pluginNames:\n      rootModel.jbrowse.plugins?.map((plugin: any) => plugin.name) || '',\n  }\n\n  // create script\n  let analyticsScript =\n    \"(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\"\n  analyticsScript +=\n    '(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),'\n  analyticsScript +=\n    'm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)'\n  analyticsScript +=\n    \"})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\"\n  analyticsScript += `ga('create', '${jbrowseUser}', 'auto', 'jbrowseTracker');`\n\n  const gaData: AnalyticsObj = {}\n  const googleDimensions = 'tracks-count ver electron loadTime pluginNames'\n\n  googleDimensions.split(/\\s+/).forEach((key, index) => {\n    gaData[`dimension${index + 1}`] = stats[key]\n  })\n\n  gaData.metric1 = Math.round(stats.loadTime)\n\n  analyticsScript += `ga('jbrowseTracker.send', 'pageview',${JSON.stringify(\n    gaData,\n  )});`\n\n  const analyticsScriptNode = document.createElement('script')\n  analyticsScriptNode.innerHTML = analyticsScript\n\n  document.getElementsByTagName('head')[0].appendChild(analyticsScriptNode)\n}\n","import { toUrlSafeB64 } from '@jbrowse/core/util'\n\nimport AES from 'crypto-js/aes'\nimport Utf8 from 'crypto-js/enc-utf8'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      Array.from(window.crypto.getRandomValues(new Uint8Array(length * 2)))\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replace(/[+/]/g, '')\n    .substring(0, length)\n}\n\nconst encrypt = (text: string, password: string) => {\n  return AES.encrypt(text, password).toString()\n}\n\nconst decrypt = (text: string, password: string) => {\n  const bytes = AES.decrypt(text, password)\n  return bytes.toString(Utf8)\n}\n\n// recusively checks config for callbacks and removes them\n// was used to parse and delete, commented out for later if needed\n// const deleteCallbacks = (key: any) => {\n//   if (Array.isArray(key)) {\n//     key.forEach(a => {\n//       deleteCallbacks(a)\n//     })\n//   } else if (key && typeof key === 'object') {\n//     Object.entries(key).forEach(([innerKey, value]) => {\n//       if (typeof value === 'string' && value.startsWith('function')) {\n//         delete key[innerKey] // removing sets it to the default callback\n//       } else deleteCallbacks(key[innerKey])\n//     })\n//   }\n// }\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: Record<string, unknown>,\n  url: string,\n  referer: string,\n) {\n  const sess = `${toUrlSafeB64(JSON.stringify(session))}`\n  const password = generateUID(5)\n  const encryptedSession = encrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n  signal?: AbortSignal,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]\n  const url = `${baseUrl}?sessionId=${sessionId}`\n\n  const response = await fetch(url, {\n    signal,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n\n  const json = await response.json()\n  return decrypt(json.session, password)\n}\n","import React from 'react'\nimport {\n  createCanvas,\n  PonyfillOffscreenCanvas,\n  createImageBitmap,\n} from './offscreenCanvasPonyfill'\nimport { blobToDataURL } from '.'\n\nexport async function renderToAbstractCanvas(\n  width: number,\n  height: number,\n  opts: {\n    exportSVG?: { rasterizeLayers?: boolean }\n    highResolutionScaling: number\n  },\n  cb: Function,\n) {\n  const { exportSVG, highResolutionScaling = 1 } = opts\n  if (exportSVG && !exportSVG.rasterizeLayers) {\n    const fakeCanvas = new PonyfillOffscreenCanvas(width, height)\n    const fakeCtx = fakeCanvas.getContext('2d')\n    await cb(fakeCtx)\n    return {\n      reactElement: fakeCanvas.getSerializedSvg(),\n    }\n  }\n  if (exportSVG && exportSVG.rasterizeLayers) {\n    const scale = 4\n    const canvas = createCanvas(Math.ceil(width * scale), height * scale)\n    const ctx = canvas.getContext('2d')\n    ctx.scale(scale, scale)\n    await cb(ctx)\n\n    // two methods needed for converting canvas to PNG, one for webworker\n    // offscreen canvas, one for main thread\n    return {\n      reactElement: (\n        <image\n          width={width}\n          height={height}\n          xlinkHref={\n            canvas.convertToBlob\n              ? await blobToDataURL(\n                  await canvas.convertToBlob({\n                    type: 'image/png',\n                  }),\n                )\n              : canvas.toDataURL()\n          }\n        />\n      ),\n    }\n  }\n\n  const canvas = createCanvas(\n    Math.ceil(width * highResolutionScaling),\n    height * highResolutionScaling,\n  )\n  const ctx = canvas.getContext('2d')\n  ctx.scale(highResolutionScaling, highResolutionScaling)\n  await cb(ctx)\n\n  return { imageData: await createImageBitmap(canvas) }\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { ThemeOptions } from '@material-ui/core'\nimport { ScaleOpts } from './util'\n\nexport interface RenderArgs extends FeatureRenderArgs {\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n  displayCrossHatches: boolean\n  ticks: { values: number[] }\n  theme: ThemeOptions\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n}\n\nexport type {\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n}\n\nexport default abstract class WiggleBaseRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const { height, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    const res = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      (ctx: CanvasRenderingContext2D) =>\n        this.draw(ctx, {\n          ...renderProps,\n          features,\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features,\n      height,\n      width,\n    }\n  }\n\n  /*\n   * draw features to context given props, to be used by derived renderer\n   * classes\n   */\n  abstract draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserialized,\n  ): void\n}\n","import { observer } from 'mobx-react'\nimport React, { useRef } from 'react'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\n\nfunction WiggleRendering(props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  onMouseLeave: Function\n  onMouseMove: Function\n  onFeatureClick: Function\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n    onFeatureClick = () => {},\n  } = props\n  const [region] = regions\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number) {\n    // calculates feature under mouse\n    let offset = 0\n    if (ref.current) {\n      offset = ref.current.getBoundingClientRect().left\n    }\n    const offsetX = eventClientX - offset\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n    let featureUnderMouse\n    for (const feature of features.values()) {\n      if (clientBp <= feature.get('end') && clientBp >= feature.get('start')) {\n        featureUnderMouse = feature\n        break\n      }\n    }\n    return featureUnderMouse\n  }\n  return (\n    <div\n      ref={ref}\n      data-testid=\"wiggle-rendering-test\"\n      onMouseMove={event => {\n        const featureUnderMouse = getFeatureUnderMouse(event.clientX)\n        onMouseMove(\n          event,\n          featureUnderMouse ? featureUnderMouse.id() : undefined,\n        )\n      }}\n      onClick={event => {\n        const featureUnderMouse = getFeatureUnderMouse(event.clientX)\n        onFeatureClick(\n          event,\n          featureUnderMouse ? featureUnderMouse.id() : undefined,\n        )\n      }}\n      onMouseLeave={event => onMouseLeave(event)}\n      role=\"presentation\"\n      className=\"WiggleRendering\"\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n}\n\nexport default observer(WiggleRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BigWigAdapter',\n  {\n    bigWigLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bw' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { scaleLinear, scaleLog, scaleQuantize } from 'd3-scale'\n\nexport interface ScaleOpts {\n  domain: number[]\n  range: number[]\n  scaleType: string\n  pivotValue?: number\n  inverted: boolean\n}\n/**\n * produces a d3-scale from arguments. applies a \"nice domain\" adjustment\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - range [min,max]\n *   - bounds [min,max]\n *   - scaleType (linear or log)\n *   - pivotValue (number)\n *   - inverted (boolean)\n */\nexport function getScale({\n  domain = [],\n  range = [],\n  scaleType,\n  pivotValue,\n  inverted,\n}: ScaleOpts) {\n  let scale\n  const [min, max] = domain\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain')\n  }\n  if (scaleType === 'linear') {\n    scale = scaleLinear()\n  } else if (scaleType === 'log') {\n    scale = scaleLog()\n    scale.base(2)\n  } else if (scaleType === 'quantize') {\n    scale = scaleQuantize()\n  } else {\n    throw new Error('undefined scaleType')\n  }\n  scale.domain(pivotValue !== undefined ? [min, pivotValue, max] : [min, max])\n  // console.log('before', scale.domain())\n  scale.nice()\n\n  const [rangeMin, rangeMax] = range\n  if (rangeMin === undefined || rangeMax === undefined) {\n    throw new Error('invalid range')\n  }\n  scale.range(inverted ? range.slice().reverse() : range)\n\n  // console.log('after', scale.domain())\n  return scale\n}\n/**\n * gets the origin for drawing the graph. for linear this is 0, for log this is arbitrarily set to log(1)==0\n *\n * @param scaleType -\n */\nexport function getOrigin(scaleType: string /* , pivot, stats */) {\n  // if (pivot) {\n  //   if (pivot === 'mean') {\n  //     return stats.scoreMean || 0\n  //   }\n  //   if (pivot === 'zero') {\n  //     return 0\n  //   }\n  //   return parseFloat()\n  // }\n  // if (scaleType === 'z_score') {\n  //   return stats.scoreMean || 0\n  // }\n  if (scaleType === 'log') {\n    return 1\n  }\n  return 0\n}\n\n/**\n * produces a \"nice\" domain that actually rounds down to 0 for the min\n * or 0 to the max depending on if all values are positive or negative\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - bounds [min,max]\n *   - mean\n *   - stddev\n *   - scaleType (linear or log)\n */\nexport function getNiceDomain({\n  scaleType,\n  domain,\n  bounds,\n}: {\n  scaleType: string\n  domain: number[]\n  bounds: number[]\n}) {\n  const [minScore, maxScore] = bounds\n  let [min, max] = domain\n\n  if (scaleType === 'linear') {\n    if (max < 0) {\n      max = 0\n    }\n    if (min > 0) {\n      min = 0\n    }\n  }\n  if (scaleType === 'log') {\n    // if the min is 0, assume that it's just something\n    // with no read coverage and that we should ignore it in calculations\n    // if it's greater than 1 pin to 1 for the full range also\n    // otherwise, we may see bigwigs with fractional values\n    if (min === 0 || min > 1) {\n      min = 1\n    }\n  }\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain')\n  }\n  if (minScore !== undefined && minScore !== Number.MIN_VALUE) {\n    min = minScore\n  }\n  if (maxScore !== undefined && maxScore !== Number.MAX_VALUE) {\n    max = maxScore\n  }\n  const getScaleType = (type: string) => {\n    if (type === 'linear') {\n      return scaleLinear()\n    }\n    if (type === 'log') {\n      const scale = scaleLog()\n      scale.base(2)\n      return scale\n    }\n    if (type === 'quantize') {\n      return scaleQuantize()\n    }\n    throw new Error(`undefined scaleType ${type}`)\n  }\n  const scale = getScaleType(scaleType)\n\n  scale.domain([min, max])\n  scale.nice()\n  return scale.domain() as [number, number]\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'WiggleRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of track, overrides posColor and negColor',\n      defaultValue: '#f0f',\n    },\n    posColor: {\n      type: 'color',\n      description: 'the color to use when the score is positive',\n      defaultValue: 'blue',\n    },\n    negColor: {\n      type: 'color',\n      description: 'the color to use when the score is negative',\n      defaultValue: 'red',\n    },\n    highlightColor: {\n      type: 'color',\n      description: 'the color of highlights over the wiggle track',\n      defaultValue: 'rgba(255,255,0,0.5)',\n    },\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    renderType: {\n      type: 'stringEnum',\n      model: types.enumeration('Rendering type', ['xyplot', 'density', 'line']),\n      description: 'The type of rendering for wiggle data to use',\n      defaultValue: 'xyplot',\n    },\n    filled: {\n      type: 'boolean',\n      description: 'fill in histogram',\n      defaultValue: true,\n    },\n    bicolorPivot: {\n      type: 'stringEnum',\n      model: types.enumeration('Scale type', [\n        'numeric',\n        'mean',\n        'z_score',\n        'none',\n      ]),\n      description: 'type of bicolor pivot',\n      defaultValue: 'numeric',\n    },\n    bicolorPivotValue: {\n      type: 'number',\n      defaultValue: 0,\n      description: 'value to use for bicolor pivot',\n    },\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  readConfObject,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getScale } from '../util'\n\nimport ConfigSchema from '../configSchema'\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\n\nexport { default as ReactComponent } from '../WiggleRendering'\n\nexport default class DensityRenderer extends WiggleBaseRenderer {\n  draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { features, regions, bpPerPx, scaleOpts, height, config } = props\n    const [region] = regions\n    const pivot = readConfObject(config, 'bicolorPivot')\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    let colorCallback\n    let colorScale: ReturnType<typeof getScale>\n    if (readConfObject(config, 'color') === '#f0f') {\n      // default color, use posColor/negColor instead\n      colorScale =\n        pivot !== 'none'\n          ? getScale({\n              ...scaleOpts,\n              pivotValue,\n              range: [negColor, 'white', posColor],\n            })\n          : getScale({ ...scaleOpts, range: ['white', posColor] })\n      colorCallback = (feature: Feature) => colorScale(feature.get('score'))\n    } else {\n      colorCallback = (feature: Feature) =>\n        readConfObject(config, 'color', { feature })\n    }\n\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + 0.3 // fudge factor for subpixel rendering\n      ctx.fillStyle = colorCallback(feature)\n      ctx.fillRect(leftPx, 0, w, height)\n    }\n  }\n}\nexport const configSchema = ConfigurationSchema(\n  'DensityRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { YSCALEBAR_LABEL_OFFSET } from '../models/model'\n\nconst toP = (s = 0) => parseFloat(s.toPrecision(6))\n\nconst useStyles = makeStyles(theme => ({\n  popper: {\n    fontSize: '0.8em',\n\n    // important to have a zIndex directly on the popper itself\n    // @material-ui/Tooltip uses popper and has similar thing\n    zIndex: theme.zIndex.tooltip,\n\n    // needed to avoid rapid mouseLeave/mouseEnter on popper\n    pointerEvents: 'none',\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: 0,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\nfunction TooltipContents(props: { feature: Feature }) {\n  const { feature } = props\n  const ref = feature.get('refName')\n  const displayRef = `${ref ? `${ref}:` : ''}`\n  const start = (feature.get('start') + 1).toLocaleString('en-US')\n  const end = feature.get('end').toLocaleString('en-US')\n  const coord = start === end ? start : `${start}..${end}`\n  const loc = `${displayRef}${coord}`\n\n  return feature.get('summary') !== undefined ? (\n    <div>\n      {loc}\n      <br />\n      Max: {toP(feature.get('maxScore'))}\n      <br />\n      Avg: {toP(feature.get('score'))}\n      <br />\n      Min: {toP(feature.get('minScore'))}\n    </div>\n  ) : (\n    <div>\n      {loc}\n      <br />\n      {`${toP(feature.get('score'))}`}\n    </div>\n  )\n}\n\ntype Coord = [number, number]\nconst Tooltip = observer(\n  ({\n    model,\n    height,\n    mouseCoord,\n  }: {\n    model: any\n    height: number\n    mouseCoord: Coord\n  }) => {\n    const { featureUnderMouse } = model\n    const classes = useStyles()\n\n    return featureUnderMouse ? (\n      <>\n        <MUITooltip\n          placement=\"right-start\"\n          className={classes.popper}\n          open\n          title={<TooltipContents feature={featureUnderMouse} />}\n        >\n          <div\n            style={{\n              position: 'absolute',\n              left: mouseCoord[0],\n              top: 5,\n            }}\n          >\n            {' '}\n          </div>\n        </MUITooltip>\n        <div\n          className={classes.hoverVertical}\n          style={{\n            left: mouseCoord[0],\n            height: height - YSCALEBAR_LABEL_OFFSET * 2,\n          }}\n        />\n      </>\n    ) : null\n  },\n)\n\nexport default Tooltip\n","import { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { Axis, LEFT, RIGHT } from 'react-d3-axis'\nimport { WiggleDisplayModel } from '../models/model'\n\nexport const YScaleBar = observer(\n  ({\n    model,\n    orientation,\n  }: {\n    model: WiggleDisplayModel\n    orientation?: string\n  }) => {\n    const { ticks } = model\n\n    return (\n      <Axis\n        {...ticks}\n        format={(n: number) => n}\n        style={{ orient: orientation === 'left' ? LEFT : RIGHT }}\n      />\n    )\n  },\n)\n\nconst LinearWiggleDisplay = observer((props: { model: WiggleDisplayModel }) => {\n  const { model } = props\n  const { ready, stats, height, needsScalebar } = model\n  return (\n    <div>\n      <BaseLinearDisplayComponent {...props} />\n      {ready && stats && needsScalebar ? (\n        <svg\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 300,\n            pointerEvents: 'none',\n            height,\n            width: 50,\n          }}\n        >\n          <YScaleBar model={model} />\n        </svg>\n      ) : null}\n    </div>\n  )\n})\n\nexport default LinearWiggleDisplay\n","import React, { lazy } from 'react'\nimport {\n  ConfigurationReference,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport {\n  isAbortException,\n  getSession,\n  getContainingView,\n  isSelectionContainer,\n} from '@jbrowse/core/util'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { autorun, observable, when } from 'mobx'\nimport { addDisposer, isAlive, types, getEnv, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\nimport { FeatureStats } from '@jbrowse/core/util/stats'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { axisPropsFromTickScale } from 'react-d3-axis'\nimport { getNiceDomain, getScale } from '../../util'\n\nimport Tooltip from '../components/Tooltip'\nimport { YScaleBar } from '../components/WiggleDisplayComponent'\n\nconst SetMinMaxDlg = lazy(() => import('../components/SetMinMaxDialog'))\nconst SetColorDlg = lazy(() => import('../components/SetColorDialog'))\n\n// fudge factor for making all labels on the YScalebar visible\nexport const YSCALEBAR_LABEL_OFFSET = 5\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'XYPlotRenderer'],\n  ['density', 'DensityRenderer'],\n  ['line', 'LinePlotRenderer'],\n])\n\nfunction logb(x: number, y: number) {\n  return Math.log(y) / Math.log(x)\n}\nfunction round(v: number, b = 1.5) {\n  return (v >= 0 ? 1 : -1) * Math.pow(b, 1 + Math.floor(logb(b, Math.abs(v))))\n}\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) =>\n  types\n    .compose(\n      'LinearWiggleDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearWiggleDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        selectedRendering: types.optional(types.string, ''),\n        resolution: types.optional(types.number, 1),\n        fill: types.maybe(types.boolean),\n        color: types.maybe(types.string),\n        summaryScoreMode: types.maybe(types.string),\n        rendererTypeNameState: types.maybe(types.string),\n        scale: types.maybe(types.string),\n        autoscale: types.maybe(types.string),\n        displayCrossHatches: types.maybe(types.boolean),\n        constraints: types.optional(\n          types.model({\n            max: types.maybe(types.number),\n            min: types.maybe(types.number),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      ready: false,\n      message: undefined as undefined | string,\n      stats: observable({ scoreMin: 0, scoreMax: 50 }),\n      statsFetchInProgress: undefined as undefined | AbortController,\n    }))\n    .actions(self => ({\n      updateStats(stats: { scoreMin: number; scoreMax: number }) {\n        self.stats.scoreMin = stats.scoreMin\n        self.stats.scoreMax = stats.scoreMax\n        self.ready = true\n      },\n      setColor(color: string) {\n        self.color = color\n      },\n\n      setLoading(aborter: AbortController) {\n        const { statsFetchInProgress: statsFetch } = self\n        if (statsFetch !== undefined && !statsFetch.signal.aborted) {\n          statsFetch.abort()\n        }\n        self.statsFetchInProgress = aborter\n      },\n\n      // this overrides the BaseLinearDisplayModel to avoid popping up a\n      // feature detail display, but still sets the feature selection on the\n      // model so listeners can detect a click\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n      setResolution(res: number) {\n        self.resolution = res\n      },\n\n      setFill(fill: boolean) {\n        self.fill = fill\n      },\n\n      toggleLogScale() {\n        if (self.scale !== 'log') {\n          self.scale = 'log'\n        } else {\n          self.scale = 'linear'\n        }\n      },\n\n      setScaleType(scale?: string) {\n        self.scale = scale\n      },\n\n      setSummaryScoreMode(val: string) {\n        self.summaryScoreMode = val\n      },\n\n      setAutoscale(val: string) {\n        self.autoscale = val\n      },\n\n      setMaxScore(val?: number) {\n        self.constraints.max = val\n      },\n\n      setRendererType(val: string) {\n        self.rendererTypeNameState = val\n      },\n\n      setMinScore(val?: number) {\n        self.constraints.min = val\n      },\n\n      toggleCrossHatches() {\n        self.displayCrossHatches = !self.displayCrossHatches\n      },\n\n      setCrossHatches(cross: boolean) {\n        self.displayCrossHatches = cross\n      },\n    }))\n    .views(self => ({\n      get TooltipComponent(): React.FC {\n        return (Tooltip as unknown) as React.FC\n      },\n\n      get adapterTypeName() {\n        return self.adapterConfig.type\n      },\n\n      get rendererTypeName() {\n        const viewName =\n          self.rendererTypeNameState || getConf(self, 'defaultRendering')\n        const rendererType = rendererTypes.get(viewName)\n        if (!rendererType) {\n          throw new Error(`unknown alignments view name ${viewName}`)\n        }\n        return rendererType\n      },\n\n      // subclasses can define these, as snpcoverage track does\n      get filters() {\n        return undefined\n      },\n\n      get scaleType() {\n        return self.scale || getConf(self, 'scaleType')\n      },\n      get filled() {\n        return typeof self.fill !== 'undefined'\n          ? self.fill\n          : readConfObject(this.rendererConfig, 'filled')\n      },\n\n      get maxScore() {\n        const { max } = self.constraints\n        return max !== undefined ? max : getConf(self, 'maxScore')\n      },\n\n      get minScore() {\n        const { min } = self.constraints\n        return min !== undefined ? min : getConf(self, 'minScore')\n      },\n\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', this.rendererTypeName]) || {}\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            filled: self.fill,\n            scaleType: this.scaleType,\n            displayCrossHatches: self.displayCrossHatches,\n            summaryScoreMode: self.summaryScoreMode,\n            color: self.color,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => {\n      let oldDomain: [number, number] = [0, 0]\n      return {\n        get summaryScoreModeSetting() {\n          return (\n            self.summaryScoreMode ||\n            readConfObject(self.rendererConfig, 'summaryScoreMode')\n          )\n        },\n        get domain() {\n          const { stats, scaleType, minScore, maxScore } = self\n\n          const ret = getNiceDomain({\n            domain: [stats.scoreMin, stats.scoreMax],\n            bounds: [minScore, maxScore],\n            scaleType,\n          })\n          const headroom = getConf(self, 'headroom') || 0\n\n          // avoid weird scalebar if log value and empty region displayed\n          if (scaleType === 'log' && ret[1] === Number.MIN_VALUE) {\n            return [0, Number.MIN_VALUE]\n          }\n\n          // heuristic to just give some extra headroom on bigwig scores if no\n          // maxScore/minScore specified (they have MAX_VALUE/MIN_VALUE if so)\n          if (maxScore === Number.MAX_VALUE && ret[1] > 1.0) {\n            ret[1] = round(ret[1] + headroom)\n          }\n          if (minScore === Number.MIN_VALUE && ret[0] < -1.0) {\n            ret[0] = round(ret[0] - headroom)\n          }\n\n          // avoid returning a new object if it matches the old value\n          if (JSON.stringify(oldDomain) !== JSON.stringify(ret)) {\n            oldDomain = ret\n          }\n\n          return oldDomain\n        },\n\n        get needsScalebar() {\n          return (\n            self.rendererTypeName === 'XYPlotRenderer' ||\n            self.rendererTypeName === 'LinePlotRenderer'\n          )\n        },\n        get scaleOpts() {\n          return {\n            domain: this.domain,\n            stats: self.stats,\n            autoscaleType: this.autoscaleType,\n            scaleType: self.scaleType,\n            inverted: getConf(self, 'inverted'),\n          }\n        },\n\n        get canHaveFill() {\n          return self.rendererTypeName === 'XYPlotRenderer'\n        },\n\n        get autoscaleType() {\n          return self.autoscale || getConf(self, 'autoscale')\n        },\n\n        get displayCrossHatchesSetting() {\n          return (\n            self.displayCrossHatches ||\n            readConfObject(self.rendererConfig, 'displayCrossHatches')\n          )\n        },\n      }\n    })\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get ticks() {\n          const { scaleType, domain, height } = self\n          const range = [\n            height - YSCALEBAR_LABEL_OFFSET,\n            YSCALEBAR_LABEL_OFFSET,\n          ]\n          const scale = getScale({\n            scaleType,\n            domain,\n            range,\n            inverted: getConf(self, 'inverted'),\n          })\n          const ticks = height < 50 ? 2 : 4\n          return axisPropsFromTickScale(scale, ticks)\n        },\n        get renderProps() {\n          return {\n            ...self.composedRenderProps,\n            ...getParentRenderProps(self),\n            notReady: !self.ready,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            config: self.rendererConfig,\n            scaleOpts: self.scaleOpts,\n            resolution: self.resolution,\n            height: self.height,\n            ticks: this.ticks,\n            displayCrossHatches: self.displayCrossHatches,\n            filters: self.filters,\n          }\n        },\n\n        get adapterCapabilities() {\n          const { adapterCapabilities } = pluginManager.getAdapterType(\n            self.adapterTypeName,\n          )\n          return adapterCapabilities\n        },\n\n        get hasResolution() {\n          return this.adapterCapabilities.includes('hasResolution')\n        },\n\n        get hasGlobalStats() {\n          return this.adapterCapabilities.includes('hasGlobalStats')\n        },\n\n        get composedTrackMenuItems() {\n          return [\n            ...(this.hasResolution\n              ? [\n                  {\n                    label: 'Resolution',\n                    subMenu: [\n                      {\n                        label: 'Finer resolution',\n                        onClick: () => {\n                          self.setResolution(self.resolution * 5)\n                        },\n                      },\n                      {\n                        label: 'Coarser resolution',\n                        onClick: () => {\n                          self.setResolution(self.resolution / 5)\n                        },\n                      },\n                    ],\n                  },\n                  {\n                    label: 'Summary score mode',\n                    subMenu: ['min', 'max', 'avg', 'whiskers'].map(elt => {\n                      return {\n                        label: elt,\n                        onClick: () => self.setSummaryScoreMode(elt),\n                      }\n                    }),\n                  },\n                ]\n              : []),\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: self.filled\n                      ? 'Turn off histogram fill'\n                      : 'Turn on histogram fill',\n                    onClick: () => {\n                      self.setFill(!self.filled)\n                    },\n                  },\n                ]\n              : []),\n            {\n              label:\n                self.scaleType === 'log' ? 'Set linear scale' : 'Set log scale',\n              onClick: () => {\n                self.toggleLogScale()\n              },\n            },\n            {\n              type: 'checkbox',\n              label: 'Draw cross hatches',\n              checked: self.displayCrossHatchesSetting,\n              onClick: () => {\n                self.toggleCrossHatches()\n              },\n            },\n\n            ...(Object.keys(getConf(self, 'renderers') || {}).length > 1\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: [...rendererTypes.keys()].map(key => ({\n                      label: key,\n                      onClick: () => self.setRendererType(key),\n                    })),\n                  },\n                ]\n              : []),\n            {\n              label: 'Autoscale type',\n              subMenu: [\n                ['local', 'Local'],\n                ...(this.hasGlobalStats\n                  ? [\n                      ['global', 'Global'],\n                      ['globalsd', 'Global  3'],\n                    ]\n                  : []),\n                ['localsd', 'Local  3'],\n              ].map(([val, label]) => {\n                return {\n                  label,\n                  onClick() {\n                    self.setAutoscale(val)\n                  },\n                }\n              }),\n            },\n            {\n              label: 'Set min/max score',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetMinMaxDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Set color',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetColorDlg, {\n                  model: self,\n                })\n              },\n            },\n          ]\n        },\n\n        get trackMenuItems() {\n          return [...trackMenuItems, ...this.composedTrackMenuItems]\n        },\n      }\n    })\n    .actions(self => {\n      const superReload = self.reload\n      const superRenderSvg = self.renderSvg\n\n      type ExportSvgOpts = Parameters<typeof superRenderSvg>[0]\n\n      async function getStats(opts: {\n        headers?: Record<string, string>\n        signal?: AbortSignal\n        filters?: string[]\n      }): Promise<FeatureStats> {\n        const { rpcManager } = getSession(self)\n        const nd = getConf(self, 'numStdDev') || 3\n        const { adapterConfig, autoscaleType } = self\n        const sessionId = getRpcSessionId(self)\n        const params = {\n          sessionId,\n          adapterConfig,\n          statusCallback: (message: string) => {\n            if (isAlive(self)) {\n              self.setMessage(message)\n            }\n          },\n          ...opts,\n        }\n        if (autoscaleType === 'global' || autoscaleType === 'globalsd') {\n          const results: FeatureStats = (await rpcManager.call(\n            sessionId,\n            'WiggleGetGlobalStats',\n            params,\n          )) as FeatureStats\n          const { scoreMin, scoreMean, scoreStdDev } = results\n          // globalsd uses heuristic to avoid unnecessary scoreMin<0\n          // if the scoreMin is never less than 0\n          // helps with most coverage bigwigs just being >0\n          return autoscaleType === 'globalsd'\n            ? {\n                ...results,\n                scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n                scoreMax: scoreMean + nd * scoreStdDev,\n              }\n            : results\n        }\n        if (autoscaleType === 'local' || autoscaleType === 'localsd') {\n          const { dynamicBlocks, bpPerPx } = getContainingView(self) as LGV\n          const results = (await rpcManager.call(\n            sessionId,\n            'WiggleGetMultiRegionStats',\n            {\n              ...params,\n              assemblyName: getTrackAssemblyNames(self.parentTrack)[0],\n              regions: JSON.parse(\n                JSON.stringify(\n                  dynamicBlocks.contentBlocks.map(region => {\n                    const { start, end } = region\n                    return {\n                      ...region,\n                      start: Math.floor(start),\n                      end: Math.ceil(end),\n                    }\n                  }),\n                ),\n              ),\n              bpPerPx,\n            },\n          )) as FeatureStats\n          const { scoreMin, scoreMean, scoreStdDev } = results\n\n          // localsd uses heuristic to avoid unnecessary scoreMin<0\n          // if the scoreMin is never less than 0\n          // helps with most coverage bigwigs just being >0\n          return autoscaleType === 'localsd'\n            ? {\n                ...results,\n                scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n                scoreMax: scoreMean + nd * scoreStdDev,\n              }\n            : results\n        }\n        if (autoscaleType === 'zscale') {\n          return rpcManager.call(\n            sessionId,\n            'WiggleGetGlobalStats',\n            params,\n          ) as Promise<FeatureStats>\n        }\n        throw new Error(`invalid autoscaleType '${autoscaleType}'`)\n      }\n      return {\n        // re-runs stats and refresh whole display on reload\n        async reload() {\n          self.setError()\n          const aborter = new AbortController()\n          const stats = await getStats({\n            signal: aborter.signal,\n            filters: self.filters,\n          })\n          if (isAlive(self)) {\n            self.updateStats(stats)\n            superReload()\n          }\n        },\n        afterAttach() {\n          addDisposer(\n            self,\n            autorun(\n              async () => {\n                try {\n                  const aborter = new AbortController()\n                  const view = getContainingView(self) as LGV\n                  self.setLoading(aborter)\n\n                  if (!view.initialized) {\n                    return\n                  }\n\n                  if (view.bpPerPx > self.maxViewBpPerPx) {\n                    return\n                  }\n\n                  const stats = await getStats({\n                    signal: aborter.signal,\n                    filters: self.filters,\n                  })\n\n                  if (isAlive(self)) {\n                    self.updateStats(stats)\n                  }\n                } catch (e) {\n                  if (!isAbortException(e) && isAlive(self)) {\n                    self.setError(e)\n                  }\n                }\n              },\n              { delay: 1000 },\n            ),\n          )\n        },\n        async renderSvg(opts: ExportSvgOpts) {\n          await when(() => self.ready && !!self.regionCannotBeRenderedText)\n          const { needsScalebar, stats } = self\n          const { offsetPx } = getContainingView(self) as LGV\n          return (\n            <>\n              <g id=\"snpcov\">{await superRenderSvg(opts)}</g>\n              {needsScalebar && stats ? (\n                <g transform={`translate(${Math.max(-offsetPx, 0)})`}>\n                  <YScaleBar\n                    model={self as WiggleDisplayModel}\n                    orientation=\"left\"\n                  />\n                </g>\n              ) : null}\n            </>\n          )\n        },\n      }\n    })\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport Color from 'color'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getOrigin, getScale } from '../util'\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../LinearWiggleDisplay/models/model'\n\nexport default class XYPlotRenderer extends WiggleBaseRenderer {\n  draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      bpPerPx,\n      regions,\n      scaleOpts,\n      height: unadjustedHeight,\n      config,\n      ticks: { values },\n      displayCrossHatches,\n    } = props\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const offset = YSCALEBAR_LABEL_OFFSET\n    const height = unadjustedHeight - offset * 2\n\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    const filled = readConfObject(config, 'filled')\n    const clipColor = readConfObject(config, 'clipColor')\n    const highlightColor = readConfObject(config, 'highlightColor')\n    const summaryScoreMode = readConfObject(config, 'summaryScoreMode')\n    const scale = getScale({ ...scaleOpts, range: [0, height] })\n    const originY = getOrigin(scaleOpts.scaleType)\n    const [niceMin, niceMax] = scale.domain()\n\n    const toY = (n: number) => height - scale(n) + offset\n    const toHeight = (n: number) => toY(originY) - toY(n)\n\n    const colorCallback =\n      readConfObject(config, 'color') === '#f0f'\n        ? (_: Feature, score: number) =>\n            score < pivotValue ? negColor : posColor\n        : (feature: Feature, _score: number) =>\n            readConfObject(config, 'color', { feature })\n\n    ctx.strokeStyle = 'grey'\n    ctx.moveTo(0, toY(0))\n    ctx.lineTo(width, toY(0))\n    ctx.stroke()\n\n    const crossingOrigin = niceMin < pivotValue && niceMax > pivotValue\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      let score = feature.get('score')\n      const maxr = feature.get('maxScore')\n      const minr = feature.get('minScore')\n\n      const lowClipping = score < niceMin\n      const highClipping = score > niceMax\n      const w = rightPx - leftPx + 0.4 // fudge factor for subpixel rendering\n\n      const summary = feature.get('summary')\n\n      if (summaryScoreMode === 'max') {\n        score = summary ? maxr : score\n        ctx.fillStyle = colorCallback(feature, score)\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      } else if (summaryScoreMode === 'min') {\n        score = summary ? minr : score\n        ctx.fillStyle = colorCallback(feature, score)\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      } else if (summaryScoreMode === 'whiskers') {\n        const c = colorCallback(feature, score)\n        if (summary) {\n          ctx.fillStyle = crossingOrigin\n            ? colorCallback(feature, maxr)\n            : Color(c).lighten(0.6).toString()\n          ctx.fillRect(\n            leftPx,\n            toY(maxr),\n            w,\n            filled ? toHeight(maxr) - toHeight(score) : 1,\n          )\n        }\n\n        // normal\n        ctx.fillStyle =\n          crossingOrigin && summary\n            ? Color(colorCallback(feature, maxr)).mix(\n                Color(colorCallback(feature, minr)),\n              )\n            : c\n        ctx.fillRect(\n          leftPx,\n          toY(score),\n          w,\n          filled ? toHeight(score) - (summary ? toHeight(minr) : 0) : 1,\n        )\n\n        // min\n        if (summary) {\n          ctx.fillStyle = crossingOrigin\n            ? colorCallback(feature, minr)\n            : Color(c).darken(0.6).toString()\n          ctx.fillRect(leftPx, toY(minr), w, filled ? toHeight(minr) : 1)\n        }\n      } else {\n        ctx.fillStyle = colorCallback(feature, score)\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      }\n\n      if (highClipping) {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, 0, w, 4)\n      } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, unadjustedHeight - 4, w, 4)\n      }\n      if (feature.get('highlighted')) {\n        ctx.fillStyle = highlightColor\n        ctx.fillRect(leftPx, 0, w, height)\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from '../configSchema'\n\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default } from './XYPlotRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'XYPlotRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { getScale } from '../util'\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../LinearWiggleDisplay/models/model'\n\nexport default class LinePlotRenderer extends WiggleBaseRenderer {\n  draw(ctx, props) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      scaleOpts,\n      height: unadjustedHeight,\n      ticks: { values },\n      displayCrossHatches,\n      config,\n    } = props\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    const offset = YSCALEBAR_LABEL_OFFSET\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const height = unadjustedHeight - offset * 2\n    const clipColor = readConfObject(config, 'clipColor')\n    const highlightColor = readConfObject(config, 'highlightColor')\n    const scale = getScale({ ...scaleOpts, range: [0, height] })\n    const [niceMin, niceMax] = scale.domain()\n    const toY = rawscore => height - scale(rawscore) + offset\n    const colorCallback =\n      readConfObject(config, 'color') === '#f0f'\n        ? () => 'grey'\n        : feature => readConfObject(config, 'color', { feature })\n\n    ctx.strokeStyle = 'grey'\n    ctx.moveTo(0, toY(0))\n    ctx.lineTo(width, toY(0))\n    ctx.stroke()\n\n    let lastVal\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const score = feature.get('score')\n      const lowClipping = score < niceMin\n      const highClipping = score > niceMax\n      const w = rightPx - leftPx + 0.3 // fudge factor for subpixel rendering\n\n      const c = colorCallback(feature)\n\n      ctx.strokeStyle = c\n      ctx.beginPath()\n      if (!region.reversed) {\n        ctx.moveTo(\n          leftPx,\n          toY(typeof lastVal !== 'undefined' ? lastVal : score),\n        )\n        ctx.lineTo(leftPx, toY(score))\n        ctx.lineTo(rightPx, toY(score))\n      } else {\n        ctx.moveTo(\n          rightPx,\n          toY(typeof lastVal !== 'undefined' ? lastVal : score),\n        )\n        ctx.lineTo(rightPx, toY(score))\n        ctx.lineTo(leftPx, toY(score))\n      }\n      ctx.stroke()\n      lastVal = score\n\n      if (highClipping) {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, 0, w, 4)\n      } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, height - 4, w, height)\n      }\n      if (feature.get('highlighted')) {\n        ctx.fillStyle = highlightColor\n        ctx.fillRect(leftPx, 0, w, height)\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from '../configSchema'\n\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default } from './LinePlotRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'LinePlotRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { FeatureStats } from '@jbrowse/core/util/stats'\n\nexport class WiggleGetGlobalStats extends RpcMethodType {\n  name = 'WiggleGetGlobalStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriverClassName: string,\n  ): Promise<FeatureStats> {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      // @ts-ignore\n      if (dataAdapter.capabilities.includes('hasGlobalStats')) {\n        // @ts-ignore\n        return dataAdapter.getGlobalStats(deserializedArgs)\n      }\n      throw new Error('Data adapter does not support global stats')\n    }\n    throw new Error('Data adapter not found')\n  }\n}\n\nexport class WiggleGetMultiRegionStats extends RpcMethodType {\n  name = 'WiggleGetMultiRegionStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n  ) {\n    const assemblyManager = this.pluginManager.rootModel?.session\n      ?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters && args.filters.toJSON().filters,\n    })\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      return dataAdapter.getMultiRegionStats(regions, deserializedArgs)\n    }\n    throw new Error('Data adapter not found')\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport WiggleBaseRenderer from './WiggleBaseRenderer'\nimport WiggleRendering from './WiggleRendering'\nimport {\n  configSchema as bigWigAdapterConfigSchema,\n  adapterCapabilities,\n} from './BigWigAdapter'\nimport DensityRenderer, {\n  configSchema as densityRendererConfigSchema,\n  ReactComponent as DensityRendererReactComponent,\n} from './DensityRenderer'\nimport * as utils from './util'\nimport {\n  configSchemaFactory as linearWiggleDisplayConfigSchemaFactory,\n  modelFactory as linearWiggleDisplayModelFactory,\n  ReactComponent as LinearWiggleDisplayReactComponent,\n  YSCALEBAR_LABEL_OFFSET,\n} from './LinearWiggleDisplay'\nimport XYPlotRenderer, {\n  configSchema as xyPlotRendererConfigSchema,\n  ReactComponent as XYPlotRendererReactComponent,\n} from './XYPlotRenderer'\nimport LinePlotRenderer, {\n  configSchema as linePlotRendererConfigSchema,\n  ReactComponent as LinePlotRendererReactComponent,\n} from './LinePlotRenderer'\nimport {\n  WiggleGetGlobalStats,\n  WiggleGetMultiRegionStats,\n} from './WiggleRPC/rpcMethods'\n\nexport default class WigglePlugin extends Plugin {\n  name = 'WigglePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'QuantitativeTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'QuantitativeTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'QuantitativeTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearWiggleDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearWiggleDisplay',\n        configSchema,\n        stateModel: linearWiggleDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'QuantitativeTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearWiggleDisplayReactComponent,\n      })\n    })\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BigWigAdapter',\n          configSchema: bigWigAdapterConfigSchema,\n          adapterCapabilities,\n          getAdapterClass: () =>\n            import('./BigWigAdapter/BigWigAdapter').then(r => r.default),\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new DensityRenderer({\n          name: 'DensityRenderer',\n          ReactComponent: DensityRendererReactComponent,\n          configSchema: densityRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new LinePlotRenderer({\n          name: 'LinePlotRenderer',\n          ReactComponent: LinePlotRendererReactComponent,\n          configSchema: linePlotRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new XYPlotRenderer({\n          name: 'XYPlotRenderer',\n          ReactComponent: XYPlotRendererReactComponent,\n          configSchema: xyPlotRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRpcMethod(() => new WiggleGetGlobalStats(pluginManager))\n    pluginManager.addRpcMethod(\n      () => new WiggleGetMultiRegionStats(pluginManager),\n    )\n  }\n\n  exports = {\n    LinearWiggleDisplayReactComponent,\n    XYPlotRendererReactComponent,\n    XYPlotRenderer,\n    xyPlotRendererConfigSchema,\n    utils,\n    WiggleBaseRenderer,\n    linearWiggleDisplayModelFactory,\n  }\n}\n\nexport * from './util'\n\nexport { WiggleRendering }\nexport { WiggleBaseRenderer }\nexport { LinearWiggleDisplayReactComponent, linearWiggleDisplayModelFactory }\nexport { YSCALEBAR_LABEL_OFFSET }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const XYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'XYPlotRenderer',\n  ).configSchema\n  const DensityRendererConfigSchema = pluginManager.getRendererType(\n    'DensityRenderer',\n  ).configSchema\n  const LinePlotRendererConfigSchema = pluginManager.getRendererType(\n    'LinePlotRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearWiggleDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['density', 'xyplot', 'line']),\n        defaultValue: 'xyplot',\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        DensityRenderer: DensityRendererConfigSchema,\n        XYPlotRenderer: XYPlotRendererConfigSchema,\n        LinePlotRenderer: LinePlotRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('AlignmentsFeatureWidget', {})\n\nexport default function stateModelFactory(pluginManager) {\n  return types\n    .model('AlignmentsFeatureWidget', {\n      id: ElementId,\n      type: types.literal('AlignmentsFeatureWidget'),\n      featureData: types.frozen(),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      setFeatureData(data) {\n        self.featureData = data\n      },\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n    }))\n}\n\nexport { configSchema, stateModelFactory }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'BamAdapter',\n    {\n      bamLocation: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.bam' },\n      },\n      index: ConfigurationSchema('BamIndex', {\n        indexType: {\n          model: types.enumeration('IndexType', ['BAI', 'CSI']),\n          type: 'stringEnum',\n          defaultValue: 'BAI',\n        },\n        location: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.bam.bai' },\n        },\n      }),\n      chunkSizeLimit: {\n        type: 'number',\n        defaultValue: 100000000,\n      },\n      fetchSizeLimit: {\n        type: 'number',\n        defaultValue: 500000000,\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","import configSchema from './configSchema'\n\nexport default (/* pluginManager: PluginManager */) => {\n  return {\n    configSchema,\n    getAdapterClass: () => import('./BamAdapter').then(r => r.default),\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default (pluginManager: PluginManager) => {\n  const { types } = pluginManager.lib['mobx-state-tree']\n  return types.late(() =>\n    ConfigurationSchema(\n      'CramAdapter',\n      {\n        cramLocation: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.cram' },\n        },\n        craiLocation: {\n          type: 'fileLocation',\n          defaultValue: { uri: '/path/to/my.cram.crai' },\n        },\n        sequenceAdapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  return {\n    configSchema: pluginManager.load(configSchemaF),\n    getAdapterClass: () => import('./CramAdapter').then(r => r.default),\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'HtsgetBamAdapter',\n    {\n      htsgetBase: {\n        type: 'string',\n        defaultValue: '',\n      },\n      htsgetTrackId: {\n        type: 'string',\n        defaultValue: '',\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","import configSchema from './configSchema'\n\nexport default (/* pluginManager: PluginManager */) => {\n  return {\n    configSchema,\n    getAdapterClass: () => import('./HtsgetBamAdapter').then(r => r.default),\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nconst configModelFactory = (pluginManager: PluginManager) => {\n  const PileupDisplayConfigSchema = pluginManager.getDisplayType(\n    'LinearPileupDisplay',\n  ).configSchema\n  const SNPCoverageDisplayConfigSchema = pluginManager.getDisplayType(\n    'LinearSNPCoverageDisplay',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearAlignmentsDisplay',\n    {\n      pileupDisplay: PileupDisplayConfigSchema,\n      snpCoverageDisplay: SNPCoverageDisplayConfigSchema,\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type AlignmentsConfigModel = ReturnType<typeof configModelFactory>\nexport default configModelFactory\n","import React from 'react'\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport deepEqual from 'fast-deep-equal'\nimport { autorun, when } from 'mobx'\nimport { addDisposer, getSnapshot, Instance, types } from 'mobx-state-tree'\nimport { getContainingTrack } from '@jbrowse/core/util'\nimport { AlignmentsConfigModel } from './configSchema'\n\nconst minDisplayHeight = 20\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AlignmentsConfigModel,\n) => {\n  return types\n    .compose(\n      'LinearAlignmentsDisplay',\n      BaseDisplay,\n      types.model({\n        PileupDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearPileupDisplay').stateModel,\n        ),\n        SNPCoverageDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearSNPCoverageDisplay').stateModel,\n        ),\n        snpCovHeight: 45,\n        type: types.literal('LinearAlignmentsDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        height: 250,\n        showCoverage: true,\n        showPileup: true,\n      }),\n    )\n    .volatile(() => ({\n      scrollTop: 0,\n    }))\n    .actions(self => ({\n      toggleCoverage() {\n        self.showCoverage = !self.showCoverage\n      },\n      togglePileup() {\n        self.showPileup = !self.showPileup\n      },\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n      setSNPCoverageHeight(n: number) {\n        self.snpCovHeight = n\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get pileupDisplayConfig() {\n          const conf = getConf(self, 'pileupDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearPileupDisplay',\n            name: `${getConf(track, 'name')} pileup`,\n            displayId: `${self.configuration.displayId}_pileup_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        get layoutFeatures() {\n          return self.PileupDisplay.layoutFeatures\n        },\n\n        get features() {\n          return self.PileupDisplay.features\n        },\n\n        get DisplayBlurb() {\n          return self.PileupDisplay?.DisplayBlurb\n        },\n\n        get sortedBy() {\n          return self.PileupDisplay.sortedBy\n        },\n        get sortedByPosition() {\n          return self.PileupDisplay.sortedByPosition\n        },\n        get sortedByRefName() {\n          return self.PileupDisplay.sortedByRefName\n        },\n\n        get snpCoverageDisplayConfig() {\n          const conf = getConf(self, 'snpCoverageDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearSNPCoverageDisplay',\n            name: `${getConf(track, 'name')} snp coverage`,\n            displayId: `${self.configuration.displayId}_snpcoverage_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        get trackMenuItems(): MenuItem[] {\n          return [\n            ...trackMenuItems,\n            {\n              type: 'subMenu',\n              label: 'Pileup settings',\n              subMenu: self.PileupDisplay.composedTrackMenuItems,\n            },\n            {\n              type: 'subMenu',\n              label: 'SNPCoverage settings',\n              subMenu: [\n                ...self.SNPCoverageDisplay.composedTrackMenuItems,\n                ...self.SNPCoverageDisplay.extraTrackMenuItems,\n              ],\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      setSNPCoverageDisplay(displayConfig: AnyConfigurationModel) {\n        self.SNPCoverageDisplay = {\n          type: 'LinearSNPCoverageDisplay',\n          configuration: displayConfig,\n          height: self.snpCovHeight,\n        }\n      },\n      setUserBpPerPxLimit(limit: number) {\n        self.PileupDisplay.setUserBpPerPxLimit(limit)\n        self.SNPCoverageDisplay.setUserBpPerPxLimit(limit)\n      },\n      setPileupDisplay(displayConfig: AnyConfigurationModel) {\n        self.PileupDisplay = {\n          type: 'LinearPileupDisplay',\n          configuration: displayConfig,\n        }\n      },\n      setHeight(displayHeight: number) {\n        if (displayHeight > minDisplayHeight) {\n          self.height = displayHeight\n        } else {\n          self.height = minDisplayHeight\n        }\n        return self.height\n      },\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (!self.SNPCoverageDisplay) {\n              self.setSNPCoverageDisplay(self.snpCoverageDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.snpCoverageDisplayConfig,\n                getSnapshot(self.SNPCoverageDisplay.configuration),\n              )\n            ) {\n              self.SNPCoverageDisplay.setHeight(self.snpCovHeight)\n              self.SNPCoverageDisplay.setConfig(self.snpCoverageDisplayConfig)\n            }\n\n            if (!self.PileupDisplay) {\n              self.setPileupDisplay(self.pileupDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.pileupDisplayConfig,\n                getSnapshot(self.PileupDisplay.configuration),\n              )\n            ) {\n              self.PileupDisplay.setConfig(self.pileupDisplayConfig)\n            }\n\n            // propagate the filterBy setting from pileupdisplay to snpcoverage\n            // note: the snpcoverage display is not able to control filterBy\n            // itself\n            if (\n              self.PileupDisplay.filterBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.filterBy),\n                getSnapshot(self.SNPCoverageDisplay.filterBy),\n              )\n            ) {\n              self.SNPCoverageDisplay.setFilterBy(\n                getSnapshot(self.PileupDisplay.filterBy),\n              )\n            }\n            if (\n              self.PileupDisplay.colorBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.colorBy),\n                self.SNPCoverageDisplay.colorBy\n                  ? getSnapshot(self.SNPCoverageDisplay.colorBy)\n                  : {},\n              )\n            ) {\n              self.SNPCoverageDisplay.setColorBy(\n                getSnapshot(self.PileupDisplay.colorBy),\n              )\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setSNPCoverageHeight(self.SNPCoverageDisplay.height)\n          }),\n        )\n      },\n      async renderSvg(opts: { rasterizeLayers?: boolean }) {\n        const pileupHeight = self.height - self.SNPCoverageDisplay.height\n        await when(() => self.PileupDisplay.ready)\n        return (\n          <>\n            <g>{await self.SNPCoverageDisplay.renderSvg(opts)}</g>\n            <g transform={`translate(0 ${self.SNPCoverageDisplay.height})`}>\n              {\n                await self.PileupDisplay.renderSvg({\n                  ...opts,\n                  overrideHeight: pileupHeight,\n                })\n              }\n            </g>\n          </>\n        )\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type AlignmentsDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type AlignmentsDisplayModel = Instance<AlignmentsDisplayStateModel>\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { AlignmentsDisplayModel } from '../models/model'\n\nfunction AlignmentsDisplay({ model }: { model: AlignmentsDisplayModel }) {\n  const { PileupDisplay, SNPCoverageDisplay, showPileup, showCoverage } = model\n  return (\n    <div\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      style={{ position: 'relative' }}\n    >\n      <div data-testid=\"Blockset-snpcoverage\">\n        {showCoverage ? (\n          <SNPCoverageDisplay.RenderingComponent model={SNPCoverageDisplay} />\n        ) : null}\n      </div>\n      <ResizeHandle\n        onDrag={delta => {\n          if (SNPCoverageDisplay) {\n            SNPCoverageDisplay.setHeight(SNPCoverageDisplay.height + delta)\n            return delta\n          }\n          return 0\n        }}\n        style={{\n          position: 'absolute',\n          top: showCoverage ? SNPCoverageDisplay.height + 2 : 0,\n          height: 3,\n        }}\n      />\n\n      <div\n        data-testid=\"Blockset-pileup\"\n        style={{\n          position: 'absolute',\n          top: showCoverage ? SNPCoverageDisplay.height + 5 : 0,\n          height: 3,\n        }}\n      >\n        {showPileup ? (\n          <PileupDisplay.RenderingComponent model={PileupDisplay} />\n        ) : null}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(AlignmentsDisplay)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nfunction PileupConfigFactory(pluginManager: PluginManager) {\n  const PileupRendererConfigSchema = pluginManager.getRendererType(\n    'PileupRenderer',\n  ).configSchema\n  const SvgFeatureRendererConfigSchema = pluginManager.getRendererType(\n    'SvgFeatureRenderer',\n  ).configSchema\n\n  // modify config schema to take in a sub coverage display\n  return ConfigurationSchema(\n    'LinearPileupDisplay',\n    {\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup', 'svg']),\n        defaultValue: 'pileup',\n      },\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer: PileupRendererConfigSchema,\n        SvgFeatureRenderer: SvgFeatureRendererConfigSchema,\n      }),\n      renderer: '',\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 100,\n      },\n      colorScheme: {\n        type: 'stringEnum',\n        model: types.enumeration('colorScheme', [\n          'strand',\n          'normal',\n          'insertSize',\n          'insertSizeAndOrientation',\n          'mappingQuality',\n          'tag',\n        ]),\n        description: 'color scheme to use',\n        defaultValue: 'normal',\n      },\n    },\n    {\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type LinearPileupDisplayConfigModel = ReturnType<\n  typeof PileupConfigFactory\n>\nexport type LinearPileupDisplayConfig = Instance<LinearPileupDisplayConfigModel>\nexport default PileupConfigFactory\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport Typography from '@material-ui/core/Typography'\n\nexport interface LinearPileupDisplayBlurbProps {\n  model: {\n    sortedBy?: {\n      pos: number\n      refName: number\n      type: string\n    }\n  }\n}\n\nfunction LinearPileupDisplayBlurb(props: LinearPileupDisplayBlurbProps) {\n  const { model } = props\n  const { sortedBy } = model\n  return sortedBy ? (\n    <div\n      data-testid={`blurb-${model.sortedBy}`}\n      style={{ backgroundColor: 'white' }}\n    >\n      <Typography color=\"secondary\" variant=\"caption\">\n        {model.sortedBy\n          ? `Sorted by ${sortedBy.type.toLowerCase()} at ${sortedBy.refName}:${\n              sortedBy.pos\n            }`\n          : null}\n      </Typography>\n    </div>\n  ) : null\n}\nexport default observer(LinearPileupDisplayBlurb)\n","import { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nimport { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nexport async function getUniqueTagValues(\n  self: IAnyStateTreeNode & { adapterConfig: AnyConfigurationModel },\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n\nexport async function getUniqueModificationValues(\n  self: IAnyStateTreeNode,\n  adapterConfig: AnyConfigurationModel,\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    sessionId,\n    'PileupGetVisibleModifications',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n","import { lazy } from 'react'\nimport {\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport {\n  getSession,\n  isSessionModelWithWidgets,\n  getContainingView,\n} from '@jbrowse/core/util'\n\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  LinearGenomeViewModel,\n  BaseLinearDisplay,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { cast, types, addDisposer, getEnv, Instance } from 'mobx-state-tree'\nimport copy from 'copy-to-clipboard'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport SortIcon from '@material-ui/icons/Sort'\nimport PaletteIcon from '@material-ui/icons/Palette'\nimport FilterListIcon from '@material-ui/icons/ClearAll'\n\nimport { autorun, observable } from 'mobx'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { LinearPileupDisplayConfigModel } from './configSchema'\nimport LinearPileupDisplayBlurb from './components/LinearPileupDisplayBlurb'\n\nimport { getUniqueTagValues, getUniqueModificationValues } from '../shared'\n\nconst ColorByTagDlg = lazy(() => import('./components/ColorByTag'))\nconst FilterByTagDlg = lazy(() => import('./components/FilterByTag'))\nconst SortByTagDlg = lazy(() => import('./components/SortByTag'))\nconst SetFeatureHeightDlg = lazy(() => import('./components/SetFeatureHeight'))\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\nconst ModificationsDlg = lazy(() => import('./components/ColorByModifications'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: LinearPileupDisplayConfigModel,\n) =>\n  types\n    .compose(\n      'LinearPileupDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearPileupDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showSoftClipping: false,\n        featureHeight: types.maybe(types.number),\n        noSpacing: types.maybe(types.boolean),\n        fadeLikelihood: types.maybe(types.boolean),\n        trackMaxHeight: types.maybe(types.number),\n        mismatchAlpha: types.maybe(types.boolean),\n        sortedBy: types.maybe(\n          types.model({\n            type: types.string,\n            pos: types.number,\n            tag: types.maybe(types.string),\n            refName: types.string,\n            assemblyName: types.string,\n          }),\n        ),\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n            extra: types.frozen(),\n          }),\n        ),\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1536),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      colorTagMap: observable.map<string, string>({}),\n      modificationTagMap: observable.map<string, string>({}),\n      ready: false,\n      currBpPerPx: 0,\n    }))\n    .actions(self => ({\n      setReady(flag: boolean) {\n        self.ready = flag\n      },\n      setCurrBpPerPx(n: number) {\n        self.currBpPerPx = n\n      },\n      setMaxHeight(n: number) {\n        self.trackMaxHeight = n\n      },\n      setFeatureHeight(n: number) {\n        self.featureHeight = n\n      },\n      setNoSpacing(flag: boolean) {\n        self.noSpacing = flag\n      },\n\n      setColorScheme(colorScheme: { type: string; tag?: string }) {\n        self.colorTagMap = observable.map({}) // clear existing mapping\n        self.colorBy = cast(colorScheme)\n        self.ready = false\n      },\n\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const totalKeys = [...self.modificationTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n\n      updateColorTagMap(uniqueTag: string[]) {\n        // pale color scheme https://cran.r-project.org/web/packages/khroma/vignettes/tol.html e.g. \"tol_light\"\n        const colorPalette = [\n          '#BBCCEE',\n          'pink',\n          '#CCDDAA',\n          '#EEEEBB',\n          '#FFCCCC',\n          'lightblue',\n          'lightgreen',\n          'tan',\n          '#CCEEFF',\n          'lightsalmon',\n        ]\n\n        uniqueTag.forEach(value => {\n          if (!self.colorTagMap.has(value)) {\n            const totalKeys = [...self.colorTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.colorTagMap.set(value, newColor)\n          }\n        })\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { rpcManager } = getSession(self)\n                const { sortedBy, colorBy, renderProps } = self\n                const view = getContainingView(self) as LGV\n\n                // continually generate the vc pairing, set and rerender if any\n                // new values seen\n                if (colorBy?.tag) {\n                  const uniqueTagSet = await getUniqueTagValues(\n                    self,\n                    colorBy,\n                    view.staticBlocks,\n                  )\n                  self.updateColorTagMap(uniqueTagSet)\n                }\n\n                if (colorBy?.type === 'modifications') {\n                  const uniqueModificationsSet = await getUniqueModificationValues(\n                    self,\n                    getConf(self.parentTrack, ['adapter']),\n                    colorBy,\n                    view.staticBlocks,\n                  )\n                  self.updateModificationColorMap(uniqueModificationsSet)\n                }\n\n                if (sortedBy) {\n                  const { pos, refName, assemblyName } = sortedBy\n\n                  const region = {\n                    start: pos,\n                    end: (pos || 0) + 1,\n                    refName,\n                    assemblyName,\n                  }\n\n                  // render just the sorted region first\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                  await (self.rendererType as any).renderInClient(rpcManager, {\n                    assemblyName,\n                    regions: [region],\n                    adapterConfig: self.adapterConfig,\n                    rendererType: self.rendererType.name,\n                    sessionId: getRpcSessionId(self),\n                    timeout: 1000000,\n                    ...renderProps,\n                  })\n                  self.setReady(true)\n                  self.setCurrBpPerPx(view.bpPerPx)\n                } else {\n                  self.setReady(true)\n                }\n              } catch (error) {\n                console.error(error)\n                self.setError(error)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n      },\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'AlignmentsFeatureWidget',\n            'alignmentFeature',\n            { featureData: feature.toJSON(), view: getContainingView(self) },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n\n      clearSelected() {\n        self.sortedBy = undefined\n      },\n\n      // uses copy-to-clipboard and generates notification\n      copyFeatureToClipboard(feature: Feature) {\n        const copiedFeature = feature.toJSON()\n        delete copiedFeature.uniqueId\n        const session = getSession(self)\n        copy(JSON.stringify(copiedFeature, null, 4))\n        session.notify('Copied to clipboard', 'success')\n      },\n\n      toggleSoftClipping() {\n        self.showSoftClipping = !self.showSoftClipping\n      },\n      toggleMismatchAlpha() {\n        self.mismatchAlpha = !self.mismatchAlpha\n      },\n\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n\n      setSortedBy(type: string, tag?: string) {\n        const { centerLineInfo } = getContainingView(self) as LGV\n        if (!centerLineInfo) {\n          return\n        }\n        const { refName, assemblyName, offset } = centerLineInfo\n        const centerBp = Math.round(offset) + 1\n        const centerRefName = refName\n\n        if (centerBp < 0) {\n          return\n        }\n\n        self.sortedBy = {\n          type,\n          pos: centerBp,\n          refName: centerRefName,\n          assemblyName,\n          tag,\n        }\n        self.ready = false\n      },\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n    }))\n    .actions(self => {\n      // resets the sort object and refresh whole display on reload\n      const superReload = self.reload\n\n      return {\n        reload() {\n          self.clearSelected()\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      get maxHeight() {\n        const conf = getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.trackMaxHeight !== undefined\n          ? self.trackMaxHeight\n          : conf.maxHeight\n      },\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            height: self.featureHeight,\n            noSpacing: self.noSpacing,\n            maxHeight: this.maxHeight,\n            mismatchAlpha: self.mismatchAlpha,\n          },\n          getEnv(self),\n        )\n      },\n      get featureHeightSetting() {\n        return (\n          self.featureHeight || readConfObject(this.rendererConfig, 'height')\n        )\n      },\n      get mismatchAlphaSetting() {\n        return self.mismatchAlpha !== undefined\n          ? self.mismatchAlpha\n          : readConfObject(this.rendererConfig, 'mismatchAlpha')\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType) {\n            throw new Error(`unknown alignments view name ${viewName}`)\n          }\n          return rendererType\n        },\n\n        get contextMenuItems() {\n          const feat = self.contextMenuFeature\n          const contextMenuItems = feat\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    self.clearFeatureSelection()\n                    if (feat) {\n                      self.selectFeature(feat)\n                    }\n                  },\n                },\n                {\n                  label: 'Copy info to clipboard',\n                  icon: ContentCopyIcon,\n                  onClick: () => {\n                    if (feat) {\n                      self.copyFeatureToClipboard(feat)\n                    }\n                  },\n                },\n              ]\n            : []\n          self.additionalContextMenuItemCallbacks.forEach(\n            (callback: Function) => {\n              const menuItems = callback(feat, self, pluginManager)\n              contextMenuItems.push(...menuItems)\n            },\n          )\n          return contextMenuItems\n        },\n\n        get DisplayBlurb() {\n          return LinearPileupDisplayBlurb\n        },\n\n        get filters() {\n          let filters: string[] = []\n          if (self.filterBy) {\n            const { flagInclude, flagExclude } = self.filterBy\n            filters = [\n              `jexl:((get(feature,'flags')&${flagInclude})==${flagInclude}) && !(get(feature,'flags')&${flagExclude})`,\n            ]\n            if (self.filterBy.tagFilter) {\n              const { tag, value } = self.filterBy.tagFilter\n              filters.push(\n                `jexl:\"${value}\" =='*' ? getTag(feature,\"${tag}\") != undefined : getTag(feature,\"${tag}\") == \"${value}\"`,\n              )\n            }\n            if (self.filterBy.readName) {\n              const { readName } = self.filterBy\n              filters.push(`jexl:get(feature,'name') == \"${readName}\"`)\n            }\n          }\n          return new SerializableFilterChain({ filters })\n        },\n\n        get renderProps() {\n          const view = getContainingView(self) as LGV\n          return {\n            ...self.composedRenderProps,\n            ...getParentRenderProps(self),\n            notReady:\n              !self.ready ||\n              (self.sortedBy && self.currBpPerPx !== view.bpPerPx),\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            sortedBy: self.sortedBy,\n            colorBy: self.colorBy,\n            colorTagMap: JSON.parse(JSON.stringify(self.colorTagMap)),\n            modificationTagMap: JSON.parse(\n              JSON.stringify(self.modificationTagMap),\n            ),\n            filters: this.filters,\n            showSoftClip: self.showSoftClipping,\n            config: self.rendererConfig,\n          }\n        },\n\n        get composedTrackMenuItems() {\n          return [\n            {\n              label: 'Show soft clipping',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSoftClipping,\n              onClick: () => {\n                self.toggleSoftClipping()\n                // if toggling from off to on, will break sort for this track\n                // so clear it\n                if (self.showSoftClipping) {\n                  self.clearSelected()\n                }\n              },\n            },\n            {\n              label: 'Sort by',\n              icon: SortIcon,\n              disabled: self.showSoftClipping,\n              subMenu: [\n                ...['Start location', 'Read strand', 'Base pair'].map(\n                  option => {\n                    return {\n                      label: option,\n                      onClick: () => self.setSortedBy(option),\n                    }\n                  },\n                ),\n                {\n                  label: 'Sort by tag...',\n                  onClick: () =>\n                    getSession(self).setDialogComponent(SortByTagDlg, {\n                      model: self,\n                    }),\n                },\n                {\n                  label: 'Clear sort',\n                  onClick: () => self.clearSelected(),\n                },\n              ],\n            },\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Normal',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'normal' })\n                  },\n                },\n                {\n                  label: 'Mapping quality',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'mappingQuality' })\n                  },\n                },\n                {\n                  label: 'Strand',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'strand' })\n                  },\n                },\n                {\n                  label: 'Pair orientation',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'pairOrientation' })\n                  },\n                },\n                {\n                  label: 'Per-base quality',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'perBaseQuality' })\n                  },\n                },\n                {\n                  label: 'Modifications or methylation',\n                  onClick: () => {\n                    getSession(self).setDialogComponent(ModificationsDlg, {\n                      model: self,\n                    })\n                  },\n                },\n                {\n                  label: 'Insert size',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'insertSize' })\n                  },\n                },\n                {\n                  label: 'Stranded paired-end',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'reverseTemplate' })\n                  },\n                },\n                {\n                  label: 'Color by tag...',\n                  onClick: () => {\n                    getSession(self).setDialogComponent(ColorByTagDlg, {\n                      model: self,\n                    })\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).setDialogComponent(FilterByTagDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Set feature height',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetFeatureHeightDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).setDialogComponent(SetMaxHeightDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Fade mismatches by quality',\n              type: 'checkbox',\n              checked: self.mismatchAlphaSetting,\n              onClick: () => {\n                self.toggleMismatchAlpha()\n              },\n            },\n          ]\n        },\n\n        get trackMenuItems() {\n          return [...trackMenuItems, ...this.composedTrackMenuItems]\n        },\n      }\n    })\n\nexport type LinearPileupDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearPileupDisplayModel = Instance<LinearPileupDisplayStateModel>\n\nexport default stateModelFactory\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nconst useStyles = makeStyles(theme => ({\n  popper: {\n    fontSize: '0.8em',\n    zIndex: theme.zIndex.tooltip, // important to have a zIndex directly on the popper itself, material-ui Tooltip uses popper and has similar thing\n    pointerEvents: 'none', // needed to avoid rapid mouseLeave/mouseEnter on popper\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: 0,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\ntype Count = {\n  [key: string]: {\n    total: number\n    strands: { [key: string]: number }\n  }\n}\n\nfunction TooltipContents({ feature }: { feature: Feature }) {\n  const refName = feature.get('refName')\n  const start = (feature.get('start') + 1).toLocaleString('en-US')\n  const end = feature.get('end').toLocaleString('en-US')\n  const loc = `${refName ? `${refName}:` : ''}${\n    start === end ? start : `${start}..${end}`\n  }`\n\n  const info = feature.get('snpinfo') as {\n    ref: Count\n    cov: Count\n    lowqual: Count\n    noncov: Count\n    delskips: Count\n    total: number\n  }\n\n  const { total, ref, cov, noncov, lowqual, delskips } = info\n  return (\n    <div>\n      <table>\n        <caption>{loc}</caption>\n        <thead>\n          <tr>\n            <th>Base</th>\n            <th>Count</th>\n            <th>% of Total</th>\n            <th>Strands</th>\n            <th>Source</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td>Total</td>\n            <td>{total}</td>\n            <td />\n          </tr>\n\n          {Object.entries({ ref, cov, noncov, delskips, lowqual }).map(\n            ([key, entry]) => {\n              return (\n                <React.Fragment key={key}>\n                  {Object.entries(entry).map(([base, score]) => {\n                    const { strands } = score\n                    return (\n                      <tr key={base}>\n                        <td>{base.toUpperCase()}</td>\n                        <td>{score.total}</td>\n                        <td>\n                          {base === 'total'\n                            ? '---'\n                            : `${Math.floor((score.total / total) * 100)}%`}\n                        </td>\n                        <td>\n                          {strands['-1'] ? `${strands['-1']}(-)` : ''}\n                          {strands['1'] ? `${strands['1']}(+)` : ''}\n                        </td>\n                        <td>{key}</td>\n                      </tr>\n                    )\n                  })}\n                </React.Fragment>\n              )\n            },\n          )}\n        </tbody>\n      </table>\n    </div>\n  )\n}\n\ntype Coord = [number, number]\nconst Tooltip = observer(\n  ({\n    model,\n    height,\n    mouseCoord,\n  }: {\n    model: any\n    height: number\n    mouseCoord: Coord\n  }) => {\n    const { featureUnderMouse } = model\n    const classes = useStyles()\n\n    return featureUnderMouse ? (\n      <>\n        <MUITooltip\n          placement=\"right-start\"\n          className={classes.popper}\n          open\n          title={<TooltipContents feature={featureUnderMouse} />}\n        >\n          <div\n            style={{\n              position: 'absolute',\n              left: mouseCoord[0],\n              top: 0,\n            }}\n          >\n            {' '}\n          </div>\n        </MUITooltip>\n        <div\n          className={classes.hoverVertical}\n          style={{ left: mouseCoord[0], height }}\n        />\n      </>\n    ) : null\n  },\n)\n\nexport default Tooltip\n","import { addDisposer, types, cast, getEnv, getSnapshot } from 'mobx-state-tree'\nimport { observable, autorun } from 'mobx'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport {\n  AnyConfigurationSchemaType,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport Tooltip from '../components/Tooltip'\nimport { getUniqueModificationValues } from '../../shared'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([['snpcoverage', 'SNPCoverageRenderer']])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) =>\n  types\n    .compose(\n      'LinearSNPCoverageDisplay',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        type: types.literal('LinearSNPCoverageDisplay'),\n        drawInterbaseCounts: types.maybe(types.boolean),\n        drawIndicators: types.maybe(types.boolean),\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1536),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      modificationTagMap: observable.map({}),\n    }))\n    .actions(self => ({\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n      setColorBy(colorBy?: { type: string; tag?: string }) {\n        self.colorBy = cast(colorBy)\n      },\n\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        let i = 0\n\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const newColor = colorPalette[i++]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n    }))\n    .views(self => ({\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            drawInterbaseCounts:\n              self.drawInterbaseCounts === undefined\n                ? configBlob.drawInterbaseCounts\n                : self.drawInterbaseCounts,\n            drawIndicators:\n              self.drawIndicators === undefined\n                ? configBlob.drawIndicators\n                : self.drawIndicators,\n          },\n          getEnv(self),\n        )\n      },\n      get drawInterbaseCountsSetting() {\n        return self.drawInterbaseCounts !== undefined\n          ? self.drawInterbaseCounts\n          : readConfObject(this.rendererConfig, 'drawInterbaseCounts')\n      },\n      get drawIndicatorsSetting() {\n        return self.drawIndicators !== undefined\n          ? self.drawIndicators\n          : readConfObject(this.rendererConfig, 'drawIndicators')\n      },\n\n      get modificationsReady() {\n        return self.colorBy?.type === 'modifications'\n          ? Object.keys(JSON.parse(JSON.stringify(self.modificationTagMap)))\n              .length > 0\n          : true\n      },\n      get renderProps() {\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          notReady: !self.ready || !this.modificationsReady,\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: self.rendererConfig,\n          scaleOpts: self.scaleOpts,\n          resolution: self.resolution,\n          height: self.height,\n          ticks: self.ticks,\n          displayCrossHatches: self.displayCrossHatches,\n          filters: self.filters,\n          modificationTagMap: JSON.parse(\n            JSON.stringify(self.modificationTagMap),\n          ),\n\n          // must use getSnapshot because otherwise changes to e.g. just the\n          // colorBy.type are not read\n          colorBy: self.colorBy ? getSnapshot(self.colorBy) : undefined,\n        }\n      },\n    }))\n    .actions(self => ({\n      toggleDrawIndicators() {\n        self.drawIndicators = !self.drawIndicatorsSetting\n      },\n      toggleDrawInterbaseCounts() {\n        self.drawInterbaseCounts = !self.drawInterbaseCountsSetting\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { colorBy } = self\n                const { staticBlocks } = getContainingView(self) as LGV\n                if (colorBy?.type === 'modifications') {\n                  const vals = await getUniqueModificationValues(\n                    self,\n                    getConf(self.parentTrack, 'adapter'),\n                    colorBy,\n                    staticBlocks,\n                  )\n                  self.updateModificationColorMap(vals)\n                }\n              } catch (error) {\n                console.error(error)\n                self.setError(error)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n      },\n    }))\n\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get TooltipComponent() {\n          return Tooltip\n        },\n\n        get adapterConfig() {\n          const subadapter = getConf(self.parentTrack, 'adapter')\n          return {\n            type: 'SNPCoverageAdapter',\n            subadapter,\n          }\n        },\n\n        get rendererTypeName() {\n          return rendererTypes.get('snpcoverage')\n        },\n\n        get needsScalebar() {\n          return true\n        },\n\n        get contextMenuItems() {\n          return []\n        },\n\n        get extraTrackMenuItems() {\n          return [\n            {\n              label: 'Draw insertion/clipping indicators',\n              type: 'checkbox',\n              checked: self.drawIndicatorsSetting,\n              onClick: () => {\n                self.toggleDrawIndicators()\n              },\n            },\n            {\n              label: 'Draw insertion/clipping counts',\n              type: 'checkbox',\n              checked: self.drawInterbaseCountsSetting,\n              onClick: () => {\n                self.toggleDrawInterbaseCounts()\n              },\n            },\n          ]\n        },\n        get trackMenuItems() {\n          return [\n            ...trackMenuItems,\n            ...self.composedTrackMenuItems,\n            ...this.extraTrackMenuItems,\n          ]\n        },\n        // The SNPCoverage filters are called twice because the BAM/CRAM features\n        // pass filters and then the SNPCoverage score features pass through\n        // here, and are already have 'snpinfo' are passed through\n        get filters() {\n          let filters: string[] = []\n          if (self.filterBy) {\n            const { flagInclude, flagExclude } = self.filterBy\n            filters = [\n              `jexl:get(feature,'snpinfo') != undefined ? true : ` +\n                `((get(feature,'flags')&${flagInclude})==${flagInclude}) && ` +\n                `!((get(feature,'flags')&${flagExclude}))`,\n            ]\n\n            if (self.filterBy.tagFilter) {\n              const { tag, value } = self.filterBy.tagFilter\n              filters.push(\n                `jexl:get(feature,'snpinfo') != undefined ? true : ` +\n                  `\"${value}\" =='*' ? getTag(feature,\"${tag}\") != undefined : ` +\n                  `getTag(feature,\"${tag}\") == \"${value}\"`,\n              )\n            }\n            if (self.filterBy.readName) {\n              const { readName } = self.filterBy\n              filters.push(\n                `jexl:get(feature,'snpinfo') != undefined ? true : ` +\n                  `get(feature,'name') == \"${readName}\"`,\n              )\n            }\n          }\n          return new SerializableFilterChain({ filters })\n        },\n      }\n    })\n\nexport type SNPCoverageDisplayModel = ReturnType<typeof stateModelFactory>\n\nexport default stateModelFactory\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport React, { MouseEvent, useRef, useState, useEffect } from 'react'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nfunction PileupRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: { type: string; pos: number; refName: string }\n  colorBy?: { type: string; tag?: string }\n  onMouseMove?: (event: React.MouseEvent, featureId: string | undefined) => void\n}) {\n  const {\n    onMouseMove,\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n    colorBy,\n  } = props\n  const {\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n    blockLayoutFeatures,\n  } = displayModel || {}\n  const [region] = regions\n  const highlightOverlayCanvas = useRef<HTMLCanvasElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] = useState(\n    false,\n  )\n  useEffect(() => {\n    const canvas = highlightOverlayCanvas.current\n    if (!canvas) {\n      return\n    }\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    let rect\n    let blockLayout\n\n    if (\n      selectedFeatureId &&\n      (blockLayout = blockLayoutFeatures.get(blockKey)) &&\n      (rect = blockLayout.get(selectedFeatureId))\n    ) {\n      const [leftBp, topPx, rightBp, bottomPx] = rect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.shadowColor = '#222266'\n      ctx.shadowBlur = 10\n      ctx.lineJoin = 'bevel'\n      ctx.lineWidth = 2\n      ctx.strokeStyle = '#00b8ff'\n      ctx.strokeRect(\n        leftPx - 2,\n        rectTop - 2,\n        rightPx - leftPx + 4,\n        rectHeight + 4,\n      )\n      ctx.clearRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n    const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n    if (\n      highlightedFeature &&\n      (blockLayout = blockLayoutFeatures.get(blockKey)) &&\n      (rect = blockLayout.get(highlightedFeature))\n    ) {\n      const [leftBp, topPx, rightBp, bottomPx] = rect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.fillStyle = '#0003'\n      ctx.fillRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n  }, [\n    bpPerPx,\n    region,\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n    blockKey,\n    blockLayoutFeatures,\n  ])\n\n  function onMouseDown(event: MouseEvent) {\n    setMouseIsDown(true)\n    setMovedDuringLastMouseDown(false)\n    callMouseHandler('MouseDown', event)\n  }\n\n  function onMouseEnter(event: MouseEvent) {\n    callMouseHandler('MouseEnter', event)\n  }\n\n  function onMouseOut(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onMouseOver(event: MouseEvent) {\n    callMouseHandler('MouseOver', event)\n  }\n\n  function onMouseUp(event: MouseEvent) {\n    setMouseIsDown(false)\n    callMouseHandler('MouseUp', event)\n  }\n\n  function onClick(event: MouseEvent) {\n    if (!movedDuringLastMouseDown) {\n      callMouseHandler('Click', event)\n    }\n  }\n\n  function onMouseLeave(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onContextMenu(event: MouseEvent) {\n    callMouseHandler('ContextMenu', event)\n  }\n\n  function mouseMove(event: MouseEvent) {\n    if (mouseIsDown) {\n      setMovedDuringLastMouseDown(true)\n    }\n    let offsetX = 0\n    let offsetY = 0\n    if (highlightOverlayCanvas.current) {\n      offsetX = highlightOverlayCanvas.current.getBoundingClientRect().left\n      offsetY = highlightOverlayCanvas.current.getBoundingClientRect().top\n    }\n    offsetX = event.clientX - offsetX\n    offsetY = event.clientY - offsetY\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n\n    const feats = displayModel.getFeatureOverlapping(\n      blockKey,\n      clientBp,\n      offsetY,\n    )\n    const featIdUnderMouse = feats.length ? feats[0].name : undefined\n\n    if (onMouseMove) {\n      onMouseMove(event, featIdUnderMouse)\n    }\n  }\n\n  function callMouseHandler(handlerName: string, event: MouseEvent) {\n    // @ts-ignore\n    const featureHandler = props[`onFeature${handlerName}`]\n    // @ts-ignore\n    const canvasHandler = props[`on${handlerName}`]\n    if (featureHandler && featureIdUnderMouse) {\n      featureHandler(event, featureIdUnderMouse)\n    } else if (canvasHandler) {\n      canvasHandler(event, featureIdUnderMouse)\n    }\n  }\n\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      data-testid={`pileup-${\n        sortedBy || colorBy\n          ? `${sortedBy?.type || ''}${colorBy?.type || ''}${colorBy?.tag || ''}`\n          : 'normal'\n      }`}\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n      <canvas\n        data-testid=\"pileup_overlay_canvas\"\n        width={canvasWidth}\n        height={height}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n        className=\"highlightOverlayCanvas\"\n        ref={highlightOverlayCanvas}\n        onMouseDown={event => onMouseDown(event)}\n        onMouseEnter={event => onMouseEnter(event)}\n        onMouseOut={event => onMouseOut(event)}\n        onMouseOver={event => onMouseOver(event)}\n        onMouseUp={event => onMouseUp(event)}\n        onMouseLeave={event => onMouseLeave(event)}\n        onMouseMove={event => mouseMove(event)}\n        onClick={event => onClick(event)}\n        onContextMenu={event => onContextMenu(event)}\n        onFocus={() => {}}\n        onBlur={() => {}}\n      />\n    </div>\n  )\n}\n\nexport default observer(PileupRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'PileupRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a pileup alignment',\n      defaultValue: `#c8c8c8`,\n      contextVariable: ['feature'],\n    },\n\n    orientationType: {\n      type: 'stringEnum',\n      model: types.enumeration('orientationType', ['fr', 'rf', 'ff']),\n      defaultValue: 'fr',\n      description:\n        'read sequencer orienation. fr is normal \"reads pointing at each other ---> <--- while some other sequencers can use other options',\n    },\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    minSubfeatureWidth: {\n      type: 'number',\n      description:\n        'the minimum width in px for a pileup mismatch feature. use for increasing mismatch marker widths when zoomed out to e.g. 1px or 0.5px',\n      defaultValue: 0,\n    },\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a pileup rendering',\n      defaultValue: 1200,\n    },\n    maxClippingSize: {\n      type: 'integer',\n      description: 'the max clip size to be used in a pileup rendering',\n      defaultValue: 10000,\n    },\n    height: {\n      type: 'number',\n      description: 'the height of each feature in a pileup alignment',\n      defaultValue: 7,\n      contextVariable: ['feature'],\n    },\n    noSpacing: {\n      type: 'boolean',\n      description: 'remove spacing between features',\n      defaultValue: false,\n    },\n    largeInsertionIndicatorScale: {\n      type: 'number',\n      description:\n        'scale at which to draw the large insertion indicators (bp/pixel)',\n      defaultValue: 10,\n    },\n    mismatchAlpha: {\n      type: 'boolean',\n      defaultValue: false,\n      description: 'Fade low quality mismatches',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import deepEqual from 'fast-deep-equal'\nimport { LayoutSession } from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nexport interface PileupLayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n  sortedBy: unknown\n  showSoftClip: unknown\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedPileupLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n  sortedBy: unknown\n  showSoftClip: boolean\n}\n// Sorting and revealing soft clip changes the layout of Pileup renderer\n// Adds extra conditions to see if cached layout is valid\nexport class PileupLayoutSession extends LayoutSession {\n  sortedBy: unknown\n\n  showSoftClip = false\n\n  constructor(args: PileupLayoutSessionProps) {\n    super(args)\n    this.config = args.config\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedPileupLayout) {\n    return (\n      super.cachedLayoutIsValid(cachedLayout) &&\n      this.showSoftClip === cachedLayout.showSoftClip &&\n      deepEqual(this.sortedBy, cachedLayout.sortedBy)\n    )\n  }\n\n  cachedLayout: CachedPileupLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n        sortedBy: this.sortedBy,\n        showSoftClip: this.showSoftClip,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n","import { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { toArray } from 'rxjs/operators'\nimport BoxRendererType, {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as BoxRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { Theme } from '@material-ui/core'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { bpSpanPx, iterMap } from '@jbrowse/core/util'\nimport Color from 'color'\nimport { Region } from '@jbrowse/core/util/types'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { BaseLayout } from '@jbrowse/core/util/layouts/BaseLayout'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  Mismatch,\n  parseCigar,\n  getModificationPositions,\n  getNextRefPos,\n} from '../BamAdapter/MismatchParser'\nimport { sortFeature } from './sortUtil'\nimport { getTagAlt, orientationTypes } from '../util'\n\nimport {\n  PileupLayoutSession,\n  PileupLayoutSessionProps,\n} from './PileupLayoutSession'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nexport type {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n}\n\nfunction getColorBaseMap(theme: Theme) {\n  return {\n    A: theme.palette.bases.A.main,\n    C: theme.palette.bases.C.main,\n    G: theme.palette.bases.G.main,\n    T: theme.palette.bases.T.main,\n    deletion: '#808080', // gray\n  }\n}\n\nexport interface RenderArgsDeserialized extends BoxRenderArgsDeserialized {\n  colorBy?: { type: string; tag?: string }\n  colorTagMap?: Record<string, string>\n  modificationTagMap?: Record<string, string>\n  sortedBy?: {\n    type: string\n    pos: number\n    refName: string\n    assemblyName: string\n    tag?: string\n  }\n  showSoftClip: boolean\n  highResolutionScaling: number\n}\n\nexport interface RenderArgsDeserializedWithFeaturesAndLayout\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n  regionSequence?: string\n}\n\ninterface LayoutRecord {\n  feature: Feature\n  leftPx: number\n  rightPx: number\n  topPx: number\n  heightPx: number\n}\n\nconst alignmentColoring: { [key: string]: string } = {\n  color_fwd_strand_not_proper: '#ECC8C8',\n  color_rev_strand_not_proper: '#BEBED8',\n  color_fwd_strand: '#EC8B8B',\n  color_rev_strand: '#8F8FD8',\n  color_fwd_missing_mate: '#D11919',\n  color_rev_missing_mate: '#1919D1',\n  color_fwd_diff_chr: '#000',\n  color_rev_diff_chr: '#969696',\n  color_pair_lr: '#c8c8c8',\n  color_pair_rr: 'navy',\n  color_pair_rl: 'teal',\n  color_pair_ll: 'green',\n  color_nostrand: '#999',\n  color_interchrom: 'orange',\n  color_longinsert: 'red',\n  color_shortinsert: 'pink',\n}\n\ninterface LayoutFeature {\n  heightPx: number\n  topPx: number\n  feature: Feature\n}\n\nfunction shouldDrawMismatches(type?: string) {\n  return !['methylation', 'modifications'].includes(type || '')\n}\n\nexport default class PileupRenderer extends BoxRendererType {\n  supportsSVG = true\n\n  // get width and height of chars the height is an approximation: width\n  // letter M is approximately the height\n  getCharWidthHeight(ctx: CanvasRenderingContext2D) {\n    const charWidth = ctx.measureText('A').width\n    const charHeight = ctx.measureText('M').width\n    return { charWidth, charHeight }\n  }\n\n  layoutFeature(\n    feature: Feature,\n    layout: BaseLayout<Feature>,\n    config: AnyConfigurationModel,\n    bpPerPx: number,\n    region: Region,\n    showSoftClip?: boolean,\n  ): LayoutRecord | null {\n    let expansionBefore = 0\n    let expansionAfter = 0\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const seq: string = feature.get('seq')\n\n    // Expand the start and end of feature when softclipping enabled\n    if (showSoftClip && seq) {\n      for (let i = 0; i < mismatches.length; i += 1) {\n        const { type, start, cliplen = 0 } = mismatches[i]\n        if (type === 'softclip') {\n          start === 0 ? (expansionBefore = cliplen) : (expansionAfter = cliplen)\n        }\n      }\n    }\n\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      region,\n      bpPerPx,\n    )\n\n    let heightPx = readConfObject(config, 'height', { feature })\n    const displayMode = readConfObject(config, 'displayMode', { feature })\n    if (displayMode === 'compact') {\n      heightPx /= 3\n    }\n    if (feature.get('refName') !== region.refName) {\n      throw new Error(\n        `feature ${feature.id()} is not on the current region's reference sequence ${\n          region.refName\n        }`,\n      )\n    }\n    const topPx = layout.addRect(\n      feature.id(),\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      heightPx,\n    )\n    if (topPx === null) {\n      return null\n    }\n\n    return {\n      feature,\n      leftPx,\n      rightPx,\n      topPx: displayMode === 'collapse' ? 0 : topPx,\n      heightPx,\n    }\n  }\n\n  // expands region for clipping to use. possible improvement: use average read\n  // size to set the heuristic maxClippingSize expansion (e.g. short reads\n  // don't have to expand a softclipping size a lot, but long reads might)\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    const { config, showSoftClip } = renderArgs\n\n    const maxClippingSize = readConfObject(config, 'maxClippingSize')\n    const { start, end } = region\n    const len = end - start\n    const bpExpansion = Math.max(\n      len,\n      showSoftClip ? Math.round(maxClippingSize) : 0,\n    )\n\n    return {\n      ...region,\n      start: Math.floor(Math.max(start - bpExpansion, 0)),\n      end: Math.ceil(end + bpExpansion),\n    }\n  }\n\n  colorByOrientation(feature: Feature, config: AnyConfigurationModel) {\n    return alignmentColoring[\n      this.getOrientation(feature, config) || 'color_nostrand'\n    ]\n  }\n\n  getOrientation(feature: Feature, config: AnyConfigurationModel) {\n    const orientationType = readConfObject(config, 'orientationType') as\n      | 'fr'\n      | 'ff'\n      | 'rf'\n    const type = orientationTypes[orientationType]\n    const orientation = type[feature.get('pair_orientation') as string]\n    const map: { [key: string]: string } = {\n      LR: 'color_pair_lr',\n      RR: 'color_pair_rr',\n      RL: 'color_pair_rl',\n      LL: 'color_pair_ll',\n    }\n    return map[orientation]\n  }\n\n  colorByInsertSize(feature: Feature, _config: AnyConfigurationModel) {\n    return feature.get('is_paired') &&\n      feature.get('seq_id') !== feature.get('next_seq_id')\n      ? '#555'\n      : `hsl(${Math.abs(feature.get('template_length')) / 10},50%,50%)`\n  }\n\n  colorByStranded(feature: Feature, _config: AnyConfigurationModel) {\n    const flags = feature.get('flags')\n    const strand = feature.get('strand')\n    // is paired\n    if (flags & 1) {\n      const revflag = flags & 64\n      const flipper = revflag ? -1 : 1\n      // proper pairing\n      if (flags & 2) {\n        return strand * flipper === 1 ? 'color_rev_strand' : 'color_fwd_strand'\n      }\n      if (feature.get('multi_segment_next_segment_unmapped')) {\n        return strand * flipper === 1\n          ? 'color_rev_missing_mate'\n          : 'color_fwd_missing_mate'\n      }\n      if (feature.get('seq_id') === feature.get('next_seq_id')) {\n        return strand * flipper === 1\n          ? 'color_rev_strand_not_proper'\n          : 'color_fwd_strand_not_proper'\n      }\n      // should only leave aberrant chr\n      return strand === 1 ? 'color_fwd_diff_chr' : 'color_rev_diff_chr'\n    }\n    return strand === 1 ? 'color_fwd_strand' : 'color_rev_strand'\n  }\n\n  colorByPerBaseQuality(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    _config: AnyConfigurationModel,\n    region: Region,\n    bpPerPx: number,\n  ) {\n    const { feature, topPx, heightPx } = feat\n    const qual: string = feature.get('qual') || ''\n    const scores = qual.split(' ').map(val => +val)\n    const cigarOps = parseCigar(feature.get('CIGAR'))\n    const width = 1 / bpPerPx\n    const start = feature.get('start')\n\n    for (let i = 0, j = 0, k = 0; k < scores.length; i += 2, k++) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        k += len\n      } else if (op === 'D' || op === 'N') {\n        j += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        for (let m = 0; m < len; m++) {\n          const score = scores[k + m]\n          ctx.fillStyle = `hsl(${score === 255 ? 150 : score * 1.5},55%,50%)`\n          const [leftPx] = bpSpanPx(\n            start + j + m,\n            start + j + m + 1,\n            region,\n            bpPerPx,\n          )\n          ctx.fillRect(leftPx, topPx, width + 0.5, heightPx)\n        }\n        j += len\n      }\n    }\n  }\n\n  // ML stores probabilities as array of numerics and MP is scaled phred scores\n  // https://github.com/samtools/hts-specs/pull/418/files#diff-e765c6479316309f56b636f88189cdde8c40b854c7bdcce9ee7fe87a4e76febcR596\n  //\n  // if we have ML or Ml, it is an 8bit probability, divide by 255\n  //\n  // if we have MP or Mp it is phred scaled ASCII, which can go up to 90 but\n  // has very high likelihood basecalls at that point, we really only care\n  // about low qual calls <20 approx\n  //\n  colorByModifications(\n    ctx: CanvasRenderingContext2D,\n    layoutFeature: LayoutFeature,\n    _config: AnyConfigurationModel,\n    region: Region,\n    bpPerPx: number,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { feature, topPx, heightPx } = layoutFeature\n    const { modificationTagMap = {} } = props\n\n    const mm = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n\n    const ml = (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n\n    const probabilities = ml\n      ? (typeof ml === 'string' ? ml.split(',').map(e => +e) : ml).map(\n          e => e / 255,\n        )\n      : (getTagAlt(feature, 'MP', 'Mp') as string)\n          .split('')\n          .map(s => s.charCodeAt(0) - 33)\n          .map(elt => Math.min(1, elt / 50))\n\n    const cigar = feature.get('CIGAR')\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const seq = feature.get('seq')\n    const cigarOps = parseCigar(cigar)\n\n    const modifications = getModificationPositions(mm, seq)\n\n    // probIndex applies across multiple modifications e.g.\n    let probIndex = 0\n    modifications.forEach(({ type, positions }) => {\n      const col = modificationTagMap[type] || 'black'\n      const base = Color(col)\n      for (const readPos of getNextRefPos(cigarOps, positions)) {\n        if (readPos >= 0 && start + readPos < end) {\n          const [leftPx, rightPx] = bpSpanPx(\n            start + readPos,\n            start + readPos + 1,\n            region,\n            bpPerPx,\n          )\n\n          // give it a little boost of 0.1 to not make them fully\n          // invisible to avoid confusion\n          ctx.fillStyle = base\n            .alpha(probabilities[probIndex] + 0.1)\n            .hsl()\n            .string()\n          ctx.fillRect(leftPx, topPx, rightPx - leftPx + 0.5, heightPx)\n        }\n        probIndex++\n      }\n    })\n  }\n\n  // Color by methylation is slightly modified version of color by\n  // modifications\n  //\n  colorByMethylation(\n    ctx: CanvasRenderingContext2D,\n    layoutFeature: LayoutFeature,\n    _config: AnyConfigurationModel,\n    region: Region,\n    bpPerPx: number,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { regionSequence } = props\n    const { feature, topPx, heightPx } = layoutFeature\n\n    const mm: string = getTagAlt(feature, 'MM', 'Mm') || ''\n\n    if (!regionSequence) {\n      throw new Error('region sequence required for methylation')\n    }\n\n    const cigar = feature.get('CIGAR')\n    const fstart = feature.get('start')\n    const fend = feature.get('end')\n    const seq = feature.get('seq')\n    const cigarOps = parseCigar(cigar)\n    const { start: rstart, end: rend } = region\n\n    const methBins = new Array(rend - rstart).fill(0)\n    getModificationPositions(mm, seq).forEach(({ type, positions }) => {\n      if (type === 'm' && positions) {\n        for (const pos of getNextRefPos(cigarOps, positions)) {\n          const epos = pos + fstart - rstart\n          if (epos >= 0 && epos < methBins.length) {\n            methBins[epos] = 1\n          }\n        }\n      }\n    })\n\n    for (let j = fstart; j < fend; j++) {\n      const i = j - rstart\n      if (i >= 0 && i < methBins.length) {\n        const l2 = regionSequence[i + 1]\n        const l1 = regionSequence[i]\n        // color\n        if (l1.toUpperCase() === 'C' && l2.toUpperCase() === 'G') {\n          const [leftPx, rightPx] = bpSpanPx(\n            rstart + i,\n            rstart + i + 1,\n            region,\n            bpPerPx,\n          )\n          if (methBins[i]) {\n            ctx.fillStyle = 'red'\n          } else {\n            ctx.fillStyle = 'blue'\n          }\n          ctx.fillRect(leftPx, topPx, rightPx - leftPx + 0.5, heightPx)\n        }\n      }\n    }\n  }\n\n  drawRect(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserialized,\n  ) {\n    const { regions, bpPerPx } = props\n    const { heightPx, topPx, feature } = feat\n    const [region] = regions\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start'),\n      feature.get('end'),\n      region,\n      bpPerPx,\n    )\n    const flip = region.reversed ? -1 : 1\n    const strand = feature.get('strand') * flip\n    if (bpPerPx < 10) {\n      if (strand === -1) {\n        ctx.beginPath()\n        ctx.moveTo(leftPx - 5, topPx + heightPx / 2)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx)\n        ctx.lineTo(leftPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      } else {\n        ctx.beginPath()\n        ctx.moveTo(leftPx, topPx)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx + 5, topPx + heightPx / 2)\n        ctx.lineTo(rightPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      }\n    } else {\n      ctx.fillRect(leftPx, topPx, rightPx - leftPx, heightPx)\n    }\n  }\n\n  drawAlignmentRect(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { config, bpPerPx, regions, colorBy, colorTagMap = {} } = props\n    const { tag = '', type: colorType = '' } = colorBy || {}\n    const { feature } = feat\n    const region = regions[0]\n\n    // first pass for simple color changes that change the color of the\n    // alignment\n    switch (colorType) {\n      case 'insertSize':\n        ctx.fillStyle = this.colorByInsertSize(feature, config)\n        break\n      case 'strand':\n        ctx.fillStyle = feature.get('strand') === -1 ? '#8F8FD8' : '#EC8B8B'\n        break\n      case 'mappingQuality':\n        ctx.fillStyle = `hsl(${feature.get('mq')},50%,50%)`\n        break\n\n      case 'pairOrientation':\n        ctx.fillStyle = this.colorByOrientation(feature, config)\n        break\n      case 'stranded':\n        ctx.fillStyle = alignmentColoring[this.colorByStranded(feature, config)]\n        break\n      case 'xs':\n      case 'tag': {\n        const tags = feature.get('tags')\n        const val = tags ? tags[tag] : feature.get(tag)\n\n        // special for for XS/TS tag\n        if (tag === 'XS' || tag === 'TS') {\n          const map: { [key: string]: string | undefined } = {\n            '-': 'color_rev_strand',\n            '+': 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // lower case 'ts' from minimap2 is flipped from xs\n        if (tag === 'ts') {\n          const map: { [key: string]: string } = {\n            '-':\n              feature.get('strand') === -1\n                ? 'color_fwd_strand'\n                : 'color_rev_strand',\n            '+':\n              feature.get('strand') === -1\n                ? 'color_rev_strand'\n                : 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // tag is not one of the autofilled tags, has color-value pairs from\n        // fetchValues\n        else {\n          const foundValue = colorTagMap[val]\n          ctx.fillStyle = foundValue || 'color_nostrand'\n        }\n        break\n      }\n      case 'insertSizeAndPairOrientation':\n        break\n\n      case 'normal':\n      default:\n        ctx.fillStyle = readConfObject(config, 'color', { feature })\n        break\n    }\n\n    this.drawRect(ctx, feat, props)\n\n    // second pass for color types that render per-base things that go over the\n    // existing drawing\n    switch (colorType) {\n      case 'perBaseQuality':\n        this.colorByPerBaseQuality(ctx, feat, config, region, bpPerPx)\n        break\n\n      case 'modifications':\n        this.colorByModifications(ctx, feat, config, region, bpPerPx, props)\n        break\n\n      case 'methylation':\n        this.colorByMethylation(ctx, feat, config, region, bpPerPx, props)\n        break\n    }\n  }\n\n  drawMismatches(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n    theme: Theme,\n    colorForBase: { [key: string]: string },\n    opts: {\n      mismatchAlpha?: boolean\n      drawSNPs?: boolean\n      drawIndels?: boolean\n    },\n  ) {\n    const { mismatchAlpha, drawSNPs = true, drawIndels = true } = opts\n    const { config, bpPerPx, regions } = props\n    const { heightPx, topPx, feature } = feat\n    const { charWidth, charHeight } = this.getCharWidthHeight(ctx)\n    const [region] = regions\n    const start = feature.get('start')\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n    const insertionScale = readConfObject(\n      config,\n      'largeInsertionIndicatorScale',\n    )\n    const pxPerBp = Math.min(1 / bpPerPx, 2)\n    const w = Math.max(minFeatWidth, pxPerBp)\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const heightLim = charHeight - 2\n\n    function getAlphaColor(baseColor: string, mismatch: { qual?: number }) {\n      let color = baseColor\n      if (mismatchAlpha && mismatch.qual !== undefined) {\n        color = Color(baseColor)\n          .alpha(Math.min(1, mismatch.qual / 50))\n          .hsl()\n          .string()\n      }\n      return color\n    }\n\n    // two pass rendering: first pass, draw all the mismatches except wide\n    // insertion markers\n    for (let i = 0; i < mismatches.length; i += 1) {\n      const mismatch = mismatches[i]\n      const [mismatchLeftPx, mismatchRightPx] = bpSpanPx(\n        start + mismatch.start,\n        start + mismatch.start + mismatch.length,\n        region,\n        bpPerPx,\n      )\n      const mismatchWidthPx = Math.max(\n        minFeatWidth,\n        Math.abs(mismatchLeftPx - mismatchRightPx),\n      )\n      if (mismatch.type === 'mismatch' && drawSNPs) {\n        const baseColor = colorForBase[mismatch.base] || '#888'\n\n        ctx.fillStyle = getAlphaColor(baseColor, mismatch)\n\n        ctx.fillRect(mismatchLeftPx, topPx, mismatchWidthPx, heightPx)\n\n        if (mismatchWidthPx >= charWidth && heightPx >= heightLim) {\n          // normal SNP coloring\n          ctx.fillStyle = getAlphaColor(\n            theme.palette.getContrastText(baseColor),\n            mismatch,\n          )\n          ctx.fillText(\n            mismatch.base,\n            mismatchLeftPx + (mismatchWidthPx - charWidth) / 2 + 1,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'deletion' && drawIndels) {\n        const baseColor = colorForBase.deletion\n        ctx.fillStyle = baseColor\n        ctx.fillRect(mismatchLeftPx, topPx, mismatchWidthPx, heightPx)\n        if (mismatchWidthPx >= charWidth && heightPx >= heightLim) {\n          ctx.fillStyle = theme.palette.getContrastText(baseColor)\n          ctx.fillText(\n            mismatch.base,\n            mismatchLeftPx + (mismatchWidthPx - charWidth) / 2 + 1,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'insertion' && drawIndels) {\n        ctx.fillStyle = 'purple'\n        const pos = mismatchLeftPx - 1\n        const len = +mismatch.base || mismatch.length\n        if (len < 10) {\n          ctx.fillRect(pos, topPx, w, heightPx)\n          if (1 / bpPerPx >= charWidth) {\n            ctx.fillRect(pos - w, topPx, w * 3, 1)\n            ctx.fillRect(pos - w, topPx + heightPx - 1, w * 3, 1)\n          }\n          if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n            ctx.fillText(\n              `(${mismatch.base})`,\n              mismatchLeftPx + 2,\n              topPx + heightPx,\n            )\n          }\n        }\n      } else if (mismatch.type === 'hardclip' || mismatch.type === 'softclip') {\n        ctx.fillStyle = mismatch.type === 'hardclip' ? 'red' : 'blue'\n        const pos = mismatchLeftPx - 1\n        ctx.fillRect(pos, topPx + 1, w, heightPx - 2)\n        ctx.fillRect(pos - w, topPx, w * 3, 1)\n        ctx.fillRect(pos - w, topPx + heightPx - 1, w * 3, 1)\n        if (mismatchWidthPx >= charWidth && heightPx >= heightLim) {\n          ctx.fillText(\n            `(${mismatch.base})`,\n            mismatchLeftPx + 2,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'skip') {\n        // fix to avoid bad rendering\n        // note that this was also related to chrome bug https://bugs.chromium.org/p/chro>\n        // ref #1236\n        if (mismatchLeftPx + mismatchWidthPx > 0) {\n          ctx.clearRect(\n            mismatchLeftPx,\n            topPx,\n            // make small exons more visible when zoomed far out\n            mismatchWidthPx - (bpPerPx > 10 ? 1.5 : 0),\n            heightPx,\n          )\n        }\n        ctx.fillStyle = '#333'\n        ctx.fillRect(mismatchLeftPx, topPx + heightPx / 2, mismatchWidthPx, 2)\n      }\n    }\n\n    // second pass, draw wide insertion markers on top\n    if (drawIndels) {\n      for (let i = 0; i < mismatches.length; i += 1) {\n        const mismatch = mismatches[i]\n        const [mismatchLeftPx] = bpSpanPx(\n          feature.get('start') + mismatch.start,\n          feature.get('start') + mismatch.start + mismatch.length,\n          region,\n          bpPerPx,\n        )\n        const len = +mismatch.base || mismatch.length\n        const txt = `${len}`\n        if (mismatch.type === 'insertion' && len >= 10) {\n          if (bpPerPx > insertionScale) {\n            ctx.fillStyle = 'purple'\n            ctx.fillRect(mismatchLeftPx - 1, topPx, 2, heightPx)\n          } else if (heightPx > charHeight) {\n            const rect = ctx.measureText(txt)\n            const padding = 5\n            ctx.fillStyle = 'purple'\n            ctx.fillRect(\n              mismatchLeftPx - rect.width / 2 - padding,\n              topPx,\n              rect.width + 2 * padding,\n              heightPx,\n            )\n            ctx.fillStyle = 'white'\n            ctx.fillText(txt, mismatchLeftPx - rect.width / 2, topPx + heightPx)\n          } else {\n            const padding = 2\n            ctx.fillStyle = 'purple'\n            ctx.fillRect(mismatchLeftPx - padding, topPx, 2 * padding, heightPx)\n          }\n        }\n      }\n    }\n  }\n\n  drawSoftClipping(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n    config: AnyConfigurationModel,\n    theme: Theme,\n  ) {\n    const { feature, topPx, heightPx } = feat\n    const { regions, bpPerPx } = props\n    const [region] = regions\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const seq = feature.get('seq')\n    const { charWidth, charHeight } = this.getCharWidthHeight(ctx)\n    const colorForBase: { [key: string]: string } = {\n      A: theme.palette.bases.A.main,\n      C: theme.palette.bases.C.main,\n      G: theme.palette.bases.G.main,\n      T: theme.palette.bases.T.main,\n      deletion: '#808080', // gray\n    }\n\n    // Display all bases softclipped off in lightened colors\n    if (seq) {\n      mismatches\n        .filter(mismatch => mismatch.type === 'softclip')\n        .forEach(mismatch => {\n          const softClipLength = mismatch.cliplen || 0\n          const softClipStart =\n            mismatch.start === 0\n              ? feature.get('start') - softClipLength\n              : feature.get('start') + mismatch.start\n\n          for (let k = 0; k < softClipLength; k += 1) {\n            const base = seq.charAt(k + mismatch.start)\n\n            // If softclip length+start is longer than sequence, no need to\n            // continue showing base\n            if (!base) {\n              return\n            }\n\n            const [softClipLeftPx, softClipRightPx] = bpSpanPx(\n              softClipStart + k,\n              softClipStart + k + 1,\n              region,\n              bpPerPx,\n            )\n            const softClipWidthPx = Math.max(\n              minFeatWidth,\n              Math.abs(softClipLeftPx - softClipRightPx),\n            )\n\n            // Black accounts for IUPAC ambiguity code bases such as N that\n            // show in soft clipping\n            const baseColor = colorForBase[base] || '#000000'\n            ctx.fillStyle = baseColor\n            ctx.fillRect(softClipLeftPx, topPx, softClipWidthPx, heightPx)\n\n            if (softClipWidthPx >= charWidth && heightPx >= charHeight - 5) {\n              ctx.fillStyle = theme.palette.getContrastText(baseColor)\n              ctx.fillText(\n                base,\n                softClipLeftPx + (softClipWidthPx - charWidth) / 2 + 1,\n                topPx + heightPx,\n              )\n            }\n          }\n        })\n    }\n  }\n\n  async makeImageData(\n    ctx: CanvasRenderingContext2D,\n    layoutRecords: any, // eslint-disable-line @typescript-eslint/no-explicit-any\n    props: RenderArgsDeserializedWithFeaturesAndLayout,\n  ) {\n    const { layout, config, showSoftClip, colorBy, theme: configTheme } = props\n    const mismatchAlpha = readConfObject(config, 'mismatchAlpha')\n    const theme = createJBrowseTheme(configTheme)\n    const colorForBase = getColorBaseMap(theme)\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n    ctx.font = 'bold 10px Courier New,monospace'\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layoutRecords.forEach((feat: any) => {\n      if (feat === null) {\n        return\n      }\n\n      const { feature, topPx, heightPx } = feat\n\n      ctx.fillStyle = readConfObject(config, 'color', { feature })\n      this.drawAlignmentRect(ctx, { feature, topPx, heightPx }, props)\n      this.drawMismatches(ctx, feat, props, theme, colorForBase, {\n        mismatchAlpha,\n\n        drawSNPs: shouldDrawMismatches(colorBy?.type),\n        drawIndels: shouldDrawMismatches(colorBy?.type),\n      })\n      if (showSoftClip) {\n        this.drawSoftClipping(ctx, feat, props, config, theme)\n      }\n    })\n  }\n\n  // we perform a full layout before render as a separate method because the\n  // layout determines the height of the canvas that we use to render\n  layoutFeats(props: RenderArgsDeserializedWithFeaturesAndLayout) {\n    const {\n      layout,\n      features,\n      sortedBy,\n      config,\n      bpPerPx,\n      showSoftClip,\n      regions,\n    } = props\n    const [region] = regions\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n\n    const sortedFeatures =\n      sortedBy && sortedBy.type && region.start === sortedBy.pos\n        ? sortFeature(features, sortedBy)\n        : null\n    const featureMap = sortedFeatures || features\n    const layoutRecords = iterMap(\n      featureMap.values(),\n      feature =>\n        this.layoutFeature(\n          feature,\n          layout,\n          config,\n          bpPerPx,\n          region,\n          showSoftClip,\n        ),\n      featureMap.size,\n    )\n    return layoutRecords\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const { bpPerPx, regions } = renderProps\n    const features = await this.getFeatures(renderProps)\n    const layout = this.createLayoutInWorker(renderProps)\n\n    const layoutRecords = this.layoutFeats({ ...renderProps, features, layout })\n\n    // @ts-ignore\n    const { dataAdapter: sequenceAdapter } = renderProps.adapterConfig\n      .sequenceAdapter\n      ? await getAdapter(\n          this.pluginManager,\n          renderProps.sessionId,\n          // @ts-ignore\n          renderProps.adapterConfig.sequenceAdapter,\n        )\n      : {}\n    const [region] = regions\n    const [feat] = sequenceAdapter\n      ? await (sequenceAdapter as BaseFeatureDataAdapter)\n          .getFeatures({\n            start: region.start,\n            end: region.end + 1,\n            refName: region.refName,\n            assemblyName: region.assemblyName,\n          })\n          .pipe(toArray())\n          .toPromise()\n      : []\n    const regionSequence = feat?.get('seq')\n\n    const width = (region.end - region.start) / bpPerPx\n    const height = Math.max(layout.getTotalHeight(), 1)\n\n    const res = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      (ctx: CanvasRenderingContext2D) =>\n        this.makeImageData(ctx, layoutRecords, {\n          ...renderProps,\n          layout,\n          features,\n          regionSequence,\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n      maxHeightReached: layout.maxHeightReached,\n    }\n  }\n\n  createSession(args: PileupLayoutSessionProps) {\n    return new PileupLayoutSession(args)\n  }\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { Mismatch } from '../BamAdapter/MismatchParser'\n\ninterface SortObject {\n  pos: number\n  type: string\n  tag?: string\n}\nexport const sortFeature = (\n  features: Map<string, Feature>,\n  sortedBy: SortObject,\n) => {\n  const featureArray = Array.from(features.values())\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // only sort on features that intersect center line, append those outside post-sort\n  featureArray.forEach(innerArray => {\n    const feature = innerArray\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(innerArray)\n    } else {\n      featuresOutsideCenter.push(innerArray)\n    }\n  })\n\n  const isCram = featureArray.length ? featureArray[0].get('tags') : false\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    case 'tag': {\n      const tag = sortedBy.tag as string\n      const getTag = (f: Feature, t: string) => {\n        return isCram ? f.get('tags')[t] : f.get(t)\n      }\n      const isString =\n        featuresInCenterLine[0] &&\n        typeof getTag(featuresInCenterLine[0], tag) === 'string'\n      if (isString) {\n        featuresInCenterLine.sort((a, b) =>\n          getTag(b, tag).localeCompare(getTag(a, tag)),\n        )\n      } else {\n        featuresInCenterLine.sort(\n          (a, b) => (getTag(b, tag) || 0) - (getTag(a, tag) || 0),\n        )\n      }\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseSortArray: [string, Mismatch][] = []\n      featuresInCenterLine.forEach(feature => {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        mismatches.forEach(mismatch => {\n          const start = feature.get('start')\n          const offset = start + mismatch.start + 1\n          const consuming =\n            mismatch.type === 'insertion' || mismatch.type === 'softclip'\n          const len = consuming ? 0 : mismatch.length\n          if (pos >= offset && pos < offset + len) {\n            baseSortArray.push([feature.id(), mismatch])\n          }\n        })\n      })\n\n      const baseMap = new Map(baseSortArray)\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode = bMismatch && bMismatch.base.toUpperCase()\n        const bcode = aMismatch && aMismatch.base.toUpperCase()\n        if (acode === bcode && acode === '*') {\n          // @ts-ignore\n          return aMismatch.length - bMismatch.length\n        }\n        return (\n          (acode ? acode.charCodeAt(0) : 0) - (bcode ? bcode.charCodeAt(0) : 0)\n        )\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  const sortedMap = new Map(\n    featuresInCenterLine\n      .concat(featuresOutsideCenter)\n      .map(feature => [feature.id(), feature]),\n  )\n\n  return sortedMap\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n\nexport default (pluginManager: PluginManager) =>\n  types.late(() =>\n    ConfigurationSchema(\n      'SNPCoverageAdapter',\n      {\n        subadapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaFactory from './configSchema'\nimport { capabilities } from './SNPCoverageAdapter'\n\nexport default (pluginManager: PluginManager) => {\n  return {\n    getAdapterClass: () => import('./SNPCoverageAdapter').then(r => r.default),\n    configSchema: configSchemaFactory(pluginManager),\n    adapterCapabilities: capabilities,\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    indicatorThreshold: {\n      type: 'number',\n      description:\n        'the proportion of reads containing a insertion/clip indicator',\n      defaultValue: 0.3,\n    },\n    drawInterbaseCounts: {\n      type: 'boolean',\n      description:\n        'draw count \"upsidedown histogram\" of the interbase events that don\\'t contribute to the coverage count so are not drawn in the normal histogram',\n      defaultValue: true,\n    },\n    drawIndicators: {\n      type: 'boolean',\n      description:\n        'draw a triangular indicator where an event has been detected',\n      defaultValue: true,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { RenderArgsDeserialized as FeatureRenderArgsDeserialized } from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport {\n  getOrigin,\n  getScale,\n  ScaleOpts,\n  WiggleBaseRenderer,\n  YSCALEBAR_LABEL_OFFSET,\n} from '@jbrowse/plugin-wiggle'\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  ticks: { values: number[] }\n  displayCrossHatches: boolean\n  modificationTagMap: Record<string, string>\n}\n\nexport default class SNPCoverageRenderer extends WiggleBaseRenderer {\n  // note: the snps are drawn on linear scale even if the data is drawn in log\n  // scape hence the two different scales being used\n  draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      scaleOpts,\n      height: unadjustedHeight,\n      theme: configTheme,\n      config: cfg,\n      displayCrossHatches,\n      ticks: { values },\n      modificationTagMap,\n    } = props\n    const theme = createJBrowseTheme(configTheme)\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const offset = YSCALEBAR_LABEL_OFFSET\n    const height = unadjustedHeight - offset * 2\n\n    const opts = { ...scaleOpts, range: [0, height] }\n    const viewScale = getScale(opts)\n    const snpViewScale = getScale({ ...opts, scaleType: 'linear' })\n    const originY = getOrigin(scaleOpts.scaleType)\n    const snpOriginY = getOrigin('linear')\n\n    const indicatorThreshold = readConfObject(cfg, 'indicatorThreshold')\n    const drawInterbaseCounts = readConfObject(cfg, 'drawInterbaseCounts')\n    const drawIndicators = readConfObject(cfg, 'drawIndicators')\n\n    // get the y coordinate that we are plotting at, this can be log scale\n    const toY = (n: number) => height - viewScale(n) + offset\n    const toHeight = (n: number) => toY(originY) - toY(n)\n\n    // this is always linear scale, even when plotted on top of log scale\n    const snpToY = (n: number) => height - snpViewScale(n) + offset\n    const snpToHeight = (n: number) => snpToY(snpOriginY) - snpToY(n)\n\n    const colorForBase: { [key: string]: string } = {\n      A: theme.palette.bases.A.main,\n      C: theme.palette.bases.C.main,\n      G: theme.palette.bases.G.main,\n      T: theme.palette.bases.T.main,\n      total: 'lightgrey',\n      insertion: 'purple',\n      softclip: 'blue',\n      hardclip: 'red',\n      meth: 'red',\n      unmeth: 'blue',\n      ref: 'lightgrey',\n    }\n\n    // Use two pass rendering, which helps in visualizing the SNPs at higher\n    // bpPerPx First pass: draw the gray background\n    ctx.fillStyle = colorForBase.total\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + 0.3\n      const score = feature.get('score') as number\n      ctx.fillRect(leftPx, toY(score), w, toHeight(score))\n    }\n    ctx.fillStyle = 'grey'\n    ctx.beginPath()\n    ctx.lineTo(0, 0)\n    ctx.moveTo(0, width)\n    ctx.stroke()\n\n    // Second pass: draw the SNP data, and add a minimum feature width of 1px\n    // which can be wider than the actual bpPerPx This reduces overdrawing of\n    // the grey background over the SNPs\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      type Counts = {\n        [key: string]: { total: number; strands: { [key: string]: number } }\n      }\n      const snpinfo = feature.get('snpinfo') as {\n        cov: Counts\n        noncov: Counts\n        total: number\n      }\n      const w = Math.max(rightPx - leftPx + 0.3, 1)\n      const totalScore = snpinfo.total\n\n      Object.entries(snpinfo.cov)\n        .sort(([a], [b]) => {\n          if (a < b) {\n            return -1\n          }\n          if (a > b) {\n            return 1\n          }\n          return 0\n        })\n        .reduce((curr, [base, { total }]) => {\n          ctx.fillStyle =\n            colorForBase[base] ||\n            modificationTagMap[base.replace('mod_', '')] ||\n            'red'\n          ctx.fillRect(leftPx, snpToY(total + curr), w, snpToHeight(total))\n          return curr + total\n        }, 0)\n\n      const interbaseEvents = Object.entries(snpinfo.noncov)\n      const indicatorHeight = 4.5\n      if (drawInterbaseCounts) {\n        interbaseEvents.reduce((curr, [base, { total }]) => {\n          ctx.fillStyle = colorForBase[base]\n          ctx.fillRect(\n            leftPx - 0.6,\n            indicatorHeight + snpToHeight(curr),\n            1.2,\n            snpToHeight(total),\n          )\n          return curr + total\n        }, 0)\n      }\n\n      if (drawIndicators) {\n        let accum = 0\n        let max = 0\n        let maxBase = ''\n        interbaseEvents.forEach(([base, { total }]) => {\n          accum += total\n          if (total > max) {\n            max = total\n            maxBase = base\n          }\n        })\n\n        // avoid drawing a bunch of indicators if coverage is very low e.g.\n        // less than 7\n        if (accum > totalScore * indicatorThreshold && totalScore > 7) {\n          ctx.fillStyle = colorForBase[maxBase]\n          ctx.beginPath()\n          ctx.moveTo(leftPx - 3, 0)\n          ctx.lineTo(leftPx + 3, 0)\n          ctx.lineTo(leftPx, indicatorHeight)\n          ctx.fill()\n        }\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(140,140,140,0.8)'\n      values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from './configSchema'\n\nexport { WiggleRendering as ReactComponent } from '@jbrowse/plugin-wiggle'\nexport { default } from './SNPCoverageRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { toArray } from 'rxjs/operators'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getTagAlt } from '../util'\nimport { getModificationTypes } from '../BamAdapter/MismatchParser'\n\nexport class PileupGetGlobalValueForTag extends RpcMethodType {\n  name = 'PileupGetGlobalValueForTag'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, args)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId, regions, tag } = deserializedArgs\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const tags = feature.get('tags')\n      const val = tags ? tags[tag] : feature.get(tag)\n      if (val !== undefined) {\n        uniqueValues.add(`${val}`)\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n\nexport class PileupGetVisibleModifications extends RpcMethodType {\n  name = 'PileupGetVisibleModifications'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    return renameRegionsIfNeeded(assemblyManager, args)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const val = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n      if (val !== undefined) {\n        getModificationTypes(val).forEach(t => uniqueValues.add(t))\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\nimport {\n  configSchema as alignmentsFeatureDetailConfigSchema,\n  stateModelFactory as alignmentsFeatureDetailStateModelFactory,\n} from './AlignmentsFeatureDetail'\nimport BamAdapterF from './BamAdapter'\nimport * as MismatchParser from './BamAdapter/MismatchParser'\nimport CramAdapterF from './CramAdapter'\nimport HtsgetBamAdapterF from './HtsgetBamAdapter'\nimport {\n  configSchemaFactory as linearAligmentsDisplayConfigSchemaFactory,\n  modelFactory as linearAlignmentsDisplayModelFactory,\n  ReactComponent as LinearAlignmentsDisplayReactComponent,\n} from './LinearAlignmentsDisplay'\nimport {\n  configSchemaFactory as linearPileupDisplayConfigSchemaFactory,\n  modelFactory as linearPileupDisplayModelFactory,\n} from './LinearPileupDisplay'\nimport {\n  configSchemaFactory as linearSNPCoverageDisplayConfigSchemaFactory,\n  modelFactory as linearSNPCoverageDisplayModelFactory,\n} from './LinearSNPCoverageDisplay'\nimport PileupRenderer, {\n  configSchema as pileupRendererConfigSchema,\n  ReactComponent as PileupRendererReactComponent,\n} from './PileupRenderer'\nimport SNPCoverageAdapterF from './SNPCoverageAdapter'\nimport SNPCoverageRenderer, {\n  configSchema as SNPCoverageRendererConfigSchema,\n  ReactComponent as SNPCoverageRendererReactComponent,\n} from './SNPCoverageRenderer'\nimport {\n  PileupGetGlobalValueForTag,\n  PileupGetVisibleModifications,\n} from './PileupRPC/rpcMethods'\n\nexport { MismatchParser }\n\nexport default class AlignmentsPlugin extends Plugin {\n  name = 'AlignmentsPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'AlignmentsTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      const track = new TrackType({\n        name: 'AlignmentsTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'AlignmentsTrack',\n          configSchema,\n        ),\n      })\n      const linearAlignmentsDisplay = pluginManager.getDisplayType(\n        'LinearAlignmentsDisplay',\n      )\n      // Add LinearAlignmentsDisplay here so that it has priority over the other\n      // linear displays (defaults to order the displays are added, but we have\n      // to add the Pileup and SNPCoverage displays first).\n      track.addDisplayType(linearAlignmentsDisplay)\n      return track\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearPileupDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearPileupDisplay',\n        configSchema,\n        stateModel: linearPileupDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearSNPCoverageDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearSNPCoverageDisplay',\n        configSchema,\n        stateModel: linearSNPCoverageDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearWiggleDisplayReactComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearAligmentsDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearAlignmentsDisplay',\n        configSchema,\n        stateModel: linearAlignmentsDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'AlignmentsTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearAlignmentsDisplayReactComponent,\n      })\n    })\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'AlignmentsFeatureWidget',\n          heading: 'Feature details',\n          configSchema: alignmentsFeatureDetailConfigSchema,\n          stateModel: alignmentsFeatureDetailStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./AlignmentsFeatureDetail/AlignmentsFeatureDetail'),\n          ),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BamAdapter',\n          ...pluginManager.load(BamAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SNPCoverageAdapter',\n          ...pluginManager.load(SNPCoverageAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'CramAdapter',\n          ...pluginManager.load(CramAdapterF),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'HtsgetBamAdapter',\n          ...pluginManager.load(HtsgetBamAdapterF),\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new PileupRenderer({\n          name: 'PileupRenderer',\n          ReactComponent: PileupRendererReactComponent,\n          configSchema: pileupRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new SNPCoverageRenderer({\n          name: 'SNPCoverageRenderer',\n          ReactComponent: SNPCoverageRendererReactComponent,\n          configSchema: SNPCoverageRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRpcMethod(\n      () => new PileupGetGlobalValueForTag(pluginManager),\n    )\n    pluginManager.addRpcMethod(\n      () => new PileupGetVisibleModifications(pluginManager),\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SNPCoverageConfigFactory(pluginManager: PluginManager) {\n  const SNPCoverageRendererConfigSchema = pluginManager.getRendererType(\n    'SNPCoverageRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearSNPCoverageDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description:\n          'performs local autoscaling (no other options for SNP Coverage available)',\n      },\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n      maxDisplayedBpPerPx: {\n        type: 'number',\n        description: 'maximum bpPerPx that is displayed in the view',\n        defaultValue: 100,\n      },\n      headroom: {\n        type: 'number',\n        description:\n          'round the upper value of the domain scale to the nearest N',\n        defaultValue: 0,\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        SNPCoverageRenderer: SNPCoverageRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BigBedAdapter',\n  {\n    bigBedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bb' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'BedTabixAdapter',\n  {\n    bedGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz' },\n    },\n\n    index: ConfigurationSchema('TabixIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.bed.gz.tbi' },\n      },\n    }),\n\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema as bigBedAdapterConfigSchema } from './BigBedAdapter'\nimport { configSchema as bedTabixAdapterConfigSchema } from './BedTabixAdapter'\n\nexport default class BedPlugin extends Plugin {\n  name = 'BedPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BigBedAdapter',\n          configSchema: bigBedAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BigBedAdapter/BigBedAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BedTabixAdapter',\n          configSchema: bedTabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BedTabixAdapter/BedTabixAdapter').then(r => r.default),\n        }),\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('BreakpointAlignmentsWidget', {})\n\nconst stateModel = types\n  .model('BreakpointAlignmentsWidget', {\n    id: ElementId,\n    type: types.literal('BreakpointAlignmentsWidget'),\n    featureData: types.frozen(),\n  })\n  .actions(self => ({\n    setFeatureData(data) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = undefined\n    },\n  }))\n\nexport { configSchema, stateModel }\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { MenuItem } from '@jbrowse/core/ui'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport { types, Instance } from 'mobx-state-tree'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport isObject from 'is-object'\n\n// https://stackoverflow.com/a/49186706/2129219\n// the array-intersection package on npm has a large kb size, and we are just\n// intersecting open track ids so simple is better\nfunction intersect<T>(a1: T[] = [], a2: T[] = [], ...rest: T[]): T[] {\n  const a12 = a1.filter(value => a2.includes(value))\n  if (rest.length === 0) {\n    return a12\n  }\n  // @ts-ignore\n  return intersect(a12, ...rest)\n}\n\nexport const VIEW_DIVIDER_HEIGHT = 3\n\nexport interface Breakend {\n  MateDirection: string\n  Join: string\n  Replacement: string\n  MatePosition: string\n}\n\nexport type LayoutRecord = [number, number, number, number]\n\nexport default function stateModelFactory(pluginManager: any) {\n  const { jbrequire } = pluginManager\n  const {\n    types: jbrequiredTypes,\n    getParent,\n    onAction,\n    addDisposer,\n    getPath,\n  } = jbrequire('mobx-state-tree')\n  const { BaseViewModel } = jbrequire(\n    '@jbrowse/core/pluggableElementTypes/models',\n  )\n\n  const minHeight = 40\n  const defaultHeight = 400\n  const model = (jbrequiredTypes as Instance<typeof types>)\n    .model('BreakpointSplitView', {\n      type: types.literal('BreakpointSplitView'),\n      headerHeight: 0,\n      height: types.optional(\n        types.refinement(\n          'viewHeight',\n          types.number,\n          (n: number) => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n      trackSelectorType: 'hierarchical',\n      showIntraviewLinks: true,\n      linkViews: false,\n      interactToggled: false,\n      views: types.array(\n        pluginManager.getViewType('LinearGenomeView')\n          .stateModel as LinearGenomeViewStateModel,\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      // Find all track ids that match across multiple views\n      get matchedTracks(): string[] {\n        return intersect(\n          // @ts-ignore expects at least two params but this is fine\n          ...self.views.map(view =>\n            view.tracks.map(t => t.configuration.trackId),\n          ),\n        )\n      },\n\n      get menuItems(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.views.forEach((view, idx) => {\n          if (view.menuItems) {\n            menuItems.push({\n              label: `View ${idx + 1} Menu`,\n              subMenu: view.menuItems,\n            })\n          }\n        })\n        return menuItems\n      },\n\n      get viewDividerHeight() {\n        return VIEW_DIVIDER_HEIGHT\n      },\n\n      // Get tracks with a given trackId across multiple views\n      getMatchedTracks(trackConfigId: string) {\n        return self.views\n          .map(view => view.getTrack(trackConfigId))\n          .filter(f => !!f)\n      },\n\n      // Paired reads are handled slightly differently than split reads\n      hasPairedReads(trackConfigId: string) {\n        return this.getTrackFeatures(trackConfigId).find(\n          f => f.get('flags') & 64,\n        )\n      },\n\n      // Translocation features are handled differently\n      // since they do not have a mate e.g. they are one sided\n      hasTranslocations(trackConfigId: string) {\n        return this.getTrackFeatures(trackConfigId).find(\n          f => f.get('type') === 'translocation',\n        )\n      },\n\n      // Get a composite map of featureId->feature map for a track\n      // across multiple views\n      getTrackFeatures(trackConfigId: string) {\n        const tracks = this.getMatchedTracks(trackConfigId)\n        return new CompositeMap<string, Feature>(\n          (tracks || []).map(t => t.displays[0].features),\n        )\n      },\n\n      // Getting \"matched\" TRA means just return all TRA\n      getMatchedTranslocationFeatures(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const feats: Feature[][] = []\n        const alreadySeen = new Set<string>()\n\n        for (const f of features.values()) {\n          if (!alreadySeen.has(f.id())) {\n            if (f.get('ALT')[0] === '<TRA>') {\n              feats.push([f])\n            }\n          }\n          alreadySeen.add(f.id())\n        }\n\n        return feats\n      },\n\n      // Returns paired BND features across multiple views by inspecting\n      // the ALT field to get exact coordinate matches\n      getMatchedBreakendFeatures(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const candidates: Record<string, Feature[]> = {}\n        const alreadySeen = new Set<string>()\n\n        for (const f of features.values()) {\n          if (!alreadySeen.has(f.id())) {\n            if (f.get('type') === 'breakend') {\n              f.get('ALT').forEach((a: Breakend | string) => {\n                const cur = `${f.get('refName')}:${f.get('start') + 1}`\n                if (isObject(a)) {\n                  const alt = a as Breakend\n                  if (!candidates[cur]) {\n                    candidates[alt.MatePosition] = [f]\n                  } else {\n                    candidates[cur].push(f)\n                  }\n                }\n              })\n            }\n          }\n          alreadySeen.add(f.id())\n        }\n\n        return Object.values(candidates).filter(v => v.length > 1)\n      },\n\n      // this finds candidate alignment features, aimed at plotting split reads\n      // from BAM/CRAM files\n      getMatchedAlignmentFeatures(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const candidates: Record<string, Feature[]> = {}\n        const alreadySeen = new Set<string>()\n\n        // this finds candidate features that share the same name\n        for (const feature of features.values()) {\n          const id = feature.id()\n          const unmapped = feature.get('flags') & 4\n          if (!alreadySeen.has(id) && !unmapped) {\n            const n = feature.get('name')\n            if (!candidates[n]) {\n              candidates[n] = []\n            }\n            candidates[n].push(feature)\n          }\n          alreadySeen.add(feature.id())\n        }\n\n        return Object.values(candidates).filter(v => v.length > 1)\n      },\n\n      // this finds candidate alignment features, aimed at plotting split reads\n      // from BAM/CRAM files\n      getBadlyPairedAlignments(trackId: string) {\n        const features = this.getTrackFeatures(trackId)\n        const candidates: Record<string, Feature[]> = {}\n        const alreadySeen = new Set<string>()\n\n        // this finds candidate features that share the same name\n        for (const feature of features.values()) {\n          const flags = feature.get('flags')\n          const id = feature.id()\n          const unmapped = flags & 4\n          const correctlyPaired = flags & 2\n\n          if (!alreadySeen.has(id) && !correctlyPaired && !unmapped) {\n            const n = feature.get('name')\n            if (!candidates[n]) {\n              candidates[n] = []\n            }\n            candidates[n].push(feature)\n          }\n          alreadySeen.add(feature.id())\n        }\n\n        return Object.values(candidates).filter(v => v.length > 1)\n      },\n\n      getMatchedFeaturesInLayout(trackConfigId: string, features: Feature[][]) {\n        // use reverse to search the second track first\n        const tracks = this.getMatchedTracks(trackConfigId)\n\n        const calc = (track: any, feat: Feature) =>\n          track.displays[0].layoutFeatures.get(feat.id())\n\n        return features.map(c =>\n          c.map(feature => {\n            const level = tracks.findIndex(track => calc(track, feature))\n            const layout = calc(tracks[level], feature)\n            return {\n              feature,\n              layout,\n              level,\n            }\n          }),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(\n            self,\n            ({\n              name,\n              path,\n              args,\n            }: {\n              name: string\n              path: string\n              args: any[]\n            }) => {\n              if (self.linkViews) {\n                const actions = [\n                  'horizontalScroll',\n                  'zoomTo',\n                  'setScaleFactor',\n                  'showTrack',\n                  'toggleTrack',\n                  'hideTrack',\n                  'setTrackLabels',\n                  'toggleCenterLine',\n                ]\n                if (actions.includes(name) && path) {\n                  this.onSubviewAction(name, path, args)\n                }\n              }\n            },\n          ),\n        )\n      },\n\n      onSubviewAction(actionName: string, path: string, args: any[]) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args[0])\n          }\n        })\n      },\n\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        self.views.forEach(v => v.setWidth(newWidth))\n      },\n\n      removeView(view: Instance<LinearGenomeViewStateModel>) {\n        self.views.remove(view)\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setHeaderHeight(height: number) {\n        self.headerHeight = height\n      },\n\n      toggleInteract() {\n        self.interactToggled = !self.interactToggled\n      },\n      toggleIntraviewLinks() {\n        self.showIntraviewLinks = !self.showIntraviewLinks\n      },\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n    }))\n\n  const stateModel = (jbrequiredTypes as typeof types).compose(\n    BaseViewModel,\n    model,\n  )\n\n  return { stateModel }\n}\n\nexport type BreakpointView = ReturnType<typeof stateModelFactory>\nexport type BreakpointViewStateModel = BreakpointView['stateModel']\nexport type BreakpointViewModel = Instance<BreakpointViewStateModel>\n","import { useState, useEffect } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport { clamp } from '@jbrowse/core/util'\nimport { LayoutRecord } from './model'\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nfunction cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: Instance<LinearGenomeViewStateModel>[],\n  trackConfigId: string,\n  level: number,\n) {\n  const track = views[level].trackRefs[trackConfigId]\n  return track?.getBoundingClientRect().top || 0\n}\n\nexport function getPxFromCoordinate(\n  view: Instance<LinearGenomeViewStateModel>,\n  refName: string,\n  coord: number,\n) {\n  return ((view.bpToPx({ refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n}\n\n// get's the yposition of a layout record in a track\nexport function yPos(\n  trackConfigId: string,\n  level: number,\n  views: Instance<LinearGenomeViewStateModel>[],\n  tracks: {\n    displays: [\n      {\n        height: number\n        scrollTop: number\n        SNPCoverageDisplay?: { height: number }\n        showCoverage?: boolean\n      },\n    ]\n  }[], // basic track requirements\n  c: LayoutRecord,\n) {\n  const display = tracks[level].displays[0]\n  const min = 0\n  const max = display.height\n  let offset = 0\n  const { showCoverage, SNPCoverageDisplay } = display\n  if (SNPCoverageDisplay && showCoverage) {\n    offset = SNPCoverageDisplay.height + 5\n  }\n  return (\n    clamp(c[TOP] - display.scrollTop + cheight(c) / 2 + offset, min, max) +\n    heightFromSpecificLevel(views, trackConfigId, level) +\n    display.scrollTop\n  )\n}\n\n// we combo a useEffect and useState combo to force rerender on snap\n// changing. the setup of this being a useEffect+useState makes it\n// re-render once the useEffect is called, which is generally the\n// \"next frame\". If we removed the below use\nexport const useNextFrame = (variable: unknown) => {\n  const [, setNextFrameState] = useState()\n  useEffect(() => {\n    setNextFrameState(variable)\n  }, [variable])\n}\n","import React, { useState } from 'react'\nimport Path from 'svg-path-generator'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport { yPos, useNextFrame, getPxFromCoordinate } from '../util'\nimport { BreakpointViewModel } from '../model'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\nconst AlignmentConnections = observer(\n  ({\n    model,\n    trackConfigId,\n    parentRef,\n  }: {\n    model: BreakpointViewModel\n    trackConfigId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views, showIntraviewLinks } = model\n    const { assemblyManager } = getSession(model)\n\n    const session = getSession(model)\n    const snap = getSnapshot(model)\n    useNextFrame(snap)\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n    if (!assembly) {\n      return null\n    }\n\n    const totalFeatures = model.getTrackFeatures(trackConfigId)\n    const features = model.hasPairedReads(trackConfigId)\n      ? model.getBadlyPairedAlignments(trackConfigId)\n      : model.getMatchedAlignmentFeatures(trackConfigId)\n    const layoutMatches = model.getMatchedFeaturesInLayout(\n      trackConfigId,\n      features,\n    )\n    layoutMatches.forEach(m => {\n      m.sort((a, b) => a.feature.get('clipPos') - b.feature.get('clipPos'))\n    })\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n\n    let yOffset = 0\n    if (parentRef.current) {\n      const rect = parentRef.current.getBoundingClientRect()\n      yOffset = rect.top\n    }\n    return (\n      <g\n        stroke=\"#333\"\n        fill=\"none\"\n        data-testid={\n          layoutMatches.length ? `${trackConfigId}-loaded` : trackConfigId\n        }\n      >\n        {layoutMatches.map(chunk => {\n          const ret = []\n          // we follow a path in the list of chunks, not from top to bottom, just in series\n          // following x1,y1 -> x2,y2\n          for (let i = 0; i < chunk.length - 1; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n\n            if (!c1 || !c2) {\n              console.warn('received null layout for a overlay feature')\n              return null\n            }\n\n            // disable rendering connections in a single level\n            if (!showIntraviewLinks && level1 === level2) {\n              return null\n            }\n            const f1origref = f1.get('refName')\n            const f2origref = f2.get('refName')\n            const f1ref = assembly.getCanonicalRefName(f1origref)\n            const f2ref = assembly.getCanonicalRefName(f2origref)\n\n            if (!f1ref || !f2ref) {\n              throw new Error(`unable to find ref for ${f1ref || f2ref}`)\n            }\n            const x1 = getPxFromCoordinate(\n              views[level1],\n              f1ref,\n              c1[f1.get('strand') === -1 ? LEFT : RIGHT],\n            )\n            const x2 = getPxFromCoordinate(\n              views[level2],\n              f2ref,\n              c2[f2.get('strand') === -1 ? RIGHT : LEFT],\n            )\n            const reversed1 = views[level1].pxToBp(x1).reversed\n            const reversed2 = views[level2].pxToBp(x2).reversed\n\n            const tracks = views.map(v => v.getTrack(trackConfigId))\n\n            const y1 = yPos(trackConfigId, level1, views, tracks, c1) - yOffset\n            const y2 = yPos(trackConfigId, level2, views, tracks, c2) - yOffset\n\n            // possible todo: use totalCurveHeight to possibly make alternative\n            // squiggle if the S is too small\n            const path = Path()\n              .moveTo(x1, y1)\n              .curveTo(\n                x1 + 200 * f1.get('strand') * (reversed1 ? -1 : 1),\n                y1,\n                x2 - 200 * f2.get('strand') * (reversed2 ? -1 : 1),\n                y2,\n                x2,\n                y2,\n              )\n              .end()\n            const id = `${f1.id()}-${f2.id()}`\n            ret.push(\n              <path\n                d={path}\n                key={id}\n                data-testid=\"r1\"\n                strokeWidth={mouseoverElt === id ? 5 : 1}\n                onClick={() => {\n                  const featureWidget = session.addWidget?.(\n                    'BreakpointAlignmentsWidget',\n                    'breakpointAlignments',\n                    {\n                      featureData: {\n                        feature1: (\n                          totalFeatures.get(f1.id()) || { toJSON: () => {} }\n                        ).toJSON(),\n                        feature2: (\n                          totalFeatures.get(f2.id()) || { toJSON: () => {} }\n                        ).toJSON(),\n                      },\n                    },\n                  )\n                  session.showWidget?.(featureWidget)\n                }}\n                onMouseOver={() => setMouseoverElt(id)}\n                onMouseOut={() => setMouseoverElt(undefined)}\n              />,\n            )\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default AlignmentConnections\n","import React, { useState } from 'react'\nimport Path from 'svg-path-generator'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getSession } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\nimport { BreakpointViewModel, Breakend } from '../model'\n\nconst [LEFT] = [0, 1, 2, 3]\n\nfunction findMatchingAlt(feat1: Feature, feat2: Feature) {\n  const candidates: Record<string, Breakend> = {}\n  feat1.get('ALT').forEach((alt: Breakend) => {\n    candidates[alt.MatePosition] = alt\n  })\n  return candidates[`${feat2.get('refName')}:${feat2.get('start') + 1}`]\n}\n\nconst Breakends = observer(\n  ({\n    model,\n    trackConfigId,\n    parentRef: ref,\n  }: {\n    model: BreakpointViewModel\n    trackConfigId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views } = model\n    const session = getSession(model)\n    const { assemblyManager } = session\n\n    const totalFeatures = model.getTrackFeatures(trackConfigId)\n    const features = model.getMatchedBreakendFeatures(trackConfigId)\n    const layoutMatches = model.getMatchedFeaturesInLayout(\n      trackConfigId,\n      features,\n    )\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n    const snap = getSnapshot(model)\n    useNextFrame(snap)\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n\n    if (!assembly) {\n      return null\n    }\n\n    let yoff = 0\n    if (ref.current) {\n      const rect = ref.current.getBoundingClientRect()\n      yoff = rect.top\n    }\n\n    return (\n      <g\n        stroke=\"green\"\n        strokeWidth={5}\n        fill=\"none\"\n        data-testid={\n          layoutMatches.length ? `${trackConfigId}-loaded` : trackConfigId\n        }\n      >\n        {layoutMatches.map(chunk => {\n          const ret = []\n          // we follow a path in the list of chunks, not from top to bottom,\n          // just in series following x1,y1 -> x2,y2\n          for (let i = 0; i < chunk.length - 1; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n            const id = f1.id()\n\n            const relevantAlt = findMatchingAlt(f1, f2)\n            if (!c1 || !c2) {\n              return null\n            }\n            const f1origref = f1.get('refName')\n            const f2origref = f2.get('refName')\n            const f1ref = assembly.getCanonicalRefName(f1origref)\n            const f2ref = assembly.getCanonicalRefName(f2origref)\n            if (!f1ref || !f2ref) {\n              throw new Error(`unable to find ref for ${f1ref || f2ref}`)\n            }\n            const x1 = getPxFromCoordinate(views[level1], f1ref, c1[LEFT])\n            const x2 = getPxFromCoordinate(views[level2], f2ref, c2[LEFT])\n            const reversed1 = views[level1].pxToBp(x1).reversed\n            const reversed2 = views[level2].pxToBp(x2).reversed\n\n            const tracks = views.map(v => v.getTrack(trackConfigId))\n            const y1 = yPos(trackConfigId, level1, views, tracks, c1) - yoff\n            const y2 = yPos(trackConfigId, level2, views, tracks, c2) - yoff\n            if (!relevantAlt) {\n              console.warn(\n                'the relevant ALT allele was not found, cannot render',\n              )\n            } else {\n              const path = Path()\n                .moveTo(\n                  x1 -\n                    20 *\n                      (relevantAlt.Join === 'left' ? -1 : 1) *\n                      (reversed1 ? -1 : 1),\n                  y1,\n                )\n                .lineTo(x1, y1)\n                .lineTo(x2, y2)\n                .lineTo(\n                  x2 -\n                    20 *\n                      (relevantAlt.MateDirection === 'left' ? 1 : -1) *\n                      (reversed2 ? -1 : 1),\n                  y2,\n                )\n                .end()\n              ret.push(\n                <path\n                  d={path}\n                  key={JSON.stringify(path)}\n                  strokeWidth={id === mouseoverElt ? 10 : 5}\n                  onClick={() => {\n                    const featureWidget = session.addWidget?.(\n                      'VariantFeatureWidget',\n                      'variantFeature',\n                      {\n                        featureData: totalFeatures.get(id),\n                      },\n                    )\n                    session.showWidget?.(featureWidget)\n                  }}\n                  onMouseOver={() => setMouseoverElt(id)}\n                  onMouseOut={() => setMouseoverElt(undefined)}\n                />,\n              )\n            }\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default Breakends\n","import React from 'react'\nimport { withSize } from 'react-sizeme'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport { makeStyles } from '@material-ui/core/styles'\n\n// icons\nimport LocationSearching from '@material-ui/icons/LocationSearching'\nimport LocationDisabled from '@material-ui/icons/LocationDisabled'\nimport LeakAdd from '@material-ui/icons/LeakAdd'\nimport LeakRemove from '@material-ui/icons/LeakRemove'\nimport LinkIcon from '@material-ui/icons/Link'\nimport LinkOffIcon from '@material-ui/icons/LinkOff'\n\nimport { BreakpointViewModel } from '../model'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst useStyles = makeStyles((theme: any) => ({\n  headerBar: {\n    gridArea: '1/1/auto/span 2',\n    display: 'flex',\n  },\n  iconButton: {},\n  spacer: {\n    flexGrow: 1,\n  },\n  emphasis: {\n    background: theme.palette.secondary.main,\n    padding: theme.spacing(1),\n  },\n  hovered: {\n    background: theme.palette.secondary.light,\n  },\n  displayName: {\n    background: theme.palette.secondary.main,\n    paddingTop: 3,\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1),\n  },\n  inputBase: {\n    color: theme.palette.secondary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.secondary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.primary.main,\n    backgroundColor: theme.palette.secondary.light,\n  },\n}))\n\nconst InteractWithSquiggles = observer(\n  ({ model }: { model: BreakpointViewModel }) => {\n    const classes = useStyles()\n    return (\n      <IconButton\n        onClick={() => model.toggleInteract()}\n        className={classes.iconButton}\n        title=\"Toggle interacting with the overlay\"\n      >\n        {model.interactToggled ? <LocationSearching /> : <LocationDisabled />}\n      </IconButton>\n    )\n  },\n)\n\nconst LinkViews = observer(({ model }: { model: BreakpointViewModel }) => {\n  const classes = useStyles()\n  return (\n    <IconButton\n      onClick={() => model.toggleLinkViews()}\n      className={classes.iconButton}\n      title=\"Toggle linked scrolls and behavior across views\"\n    >\n      {model.linkViews ? (\n        <LinkIcon color=\"secondary\" />\n      ) : (\n        <LinkOffIcon color=\"secondary\" />\n      )}\n    </IconButton>\n  )\n})\n\nconst Sync = observer(({ model }: { model: BreakpointViewModel }) => {\n  const classes = useStyles()\n  return (\n    <IconButton\n      onClick={model.toggleIntraviewLinks}\n      className={classes.iconButton}\n      title=\"Toggle rendering intraview links\"\n    >\n      {model.showIntraviewLinks ? (\n        <LeakAdd color=\"secondary\" />\n      ) : (\n        <LeakRemove color=\"secondary\" />\n      )}\n    </IconButton>\n  )\n})\n\nconst Header = observer(\n  ({\n    model,\n    size,\n  }: {\n    model: BreakpointViewModel\n    size: { height: number }\n  }) => {\n    const classes = useStyles()\n\n    model.setHeaderHeight(size.height)\n    return (\n      <div className={classes.headerBar}>\n        <LinkViews model={model} />\n        <InteractWithSquiggles model={model} />\n        <Sync model={model} />\n\n        <div className={classes.spacer} />\n      </div>\n    )\n  },\n)\n\nexport default withSize({ monitorHeight: true })(Header)\n","import Path from 'svg-path-generator'\nimport { getSession } from '@jbrowse/core/util'\n\nimport { observer } from 'mobx-react'\nimport React, { useState } from 'react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\nimport { BreakpointViewModel, LayoutRecord } from '../model'\n\nconst [LEFT] = [0, 1, 2, 3]\n\nconst Translocations = observer(\n  ({\n    model,\n    trackConfigId,\n    parentRef: ref,\n  }: {\n    model: BreakpointViewModel\n    trackConfigId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views } = model\n    const session = getSession(model)\n    const features = model.getMatchedTranslocationFeatures(trackConfigId)\n    const totalFeatures = model.getTrackFeatures(trackConfigId)\n    const layoutMatches = model.getMatchedFeaturesInLayout(\n      trackConfigId,\n      features,\n    )\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n    const snap = getSnapshot(model)\n    useNextFrame(snap)\n    const { assemblyManager } = session\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n    if (!assembly) {\n      return null\n    }\n\n    let yOffset = 0\n    if (ref.current) {\n      const rect = ref.current.getBoundingClientRect()\n      yOffset = rect.top\n    }\n\n    // we hardcode the TRA to go to the \"other view\" and if there is none, we\n    // just return null here note: would need to do processing of the INFO\n    // CHR2/END and see which view could contain those coordinates to really\n    // do it properly\n    if (views.length < 2) {\n      return null\n    }\n    return (\n      <g\n        fill=\"none\"\n        stroke=\"green\"\n        strokeWidth={5}\n        data-testid={\n          layoutMatches.length ? `${trackConfigId}-loaded` : trackConfigId\n        }\n      >\n        {layoutMatches.map(chunk => {\n          // we follow a path in the list of chunks, not from top to bottom,\n          // just in series following x1,y1 -> x2,y2\n          const ret = []\n          for (let i = 0; i < chunk.length; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const level2 = level1 === 0 ? 1 : 0\n            const id = f1.id()\n            if (!c1) {\n              return null\n            }\n\n            const info = f1.get('INFO')\n            const chr2 = info.CHR2[0]\n            const end2 = info.END[0]\n            const [myDirection, mateDirection] = info.STRANDS[0].split('')\n\n            const r = getPxFromCoordinate(views[level2], chr2, end2)\n            if (r) {\n              const c2: LayoutRecord = [r, 0, r + 1, 0]\n\n              const x1 = getPxFromCoordinate(\n                views[level1],\n                f1.get('refName'),\n                c1[LEFT],\n              )\n              const x2 = r\n              const reversed1 = views[level1].pxToBp(x1).reversed\n              const reversed2 = views[level2].pxToBp(x2).reversed\n\n              const tracks = views.map(v => v.getTrack(trackConfigId))\n              const y1 =\n                yPos(trackConfigId, level1, views, tracks, c1) - yOffset\n              const y2 =\n                yPos(trackConfigId, level2, views, tracks, c2) - yOffset\n\n              const path = Path()\n                .moveTo(\n                  x1 -\n                    20 * (myDirection === '+' ? 1 : -1) * (reversed1 ? -1 : 1),\n                  y1,\n                )\n                .lineTo(x1, y1)\n                .lineTo(x2, y2)\n                .lineTo(\n                  x2 -\n                    20 *\n                      (mateDirection === '+' ? 1 : -1) *\n                      (reversed2 ? -1 : 1),\n                  y2,\n                )\n                .end()\n              ret.push(\n                <path\n                  d={path}\n                  key={JSON.stringify(path)}\n                  strokeWidth={id === mouseoverElt ? 10 : 5}\n                  onClick={() => {\n                    const featureWidget = session.addWidget?.(\n                      'VariantFeatureWidget',\n                      'variantFeature',\n                      {\n                        featureData: (\n                          totalFeatures.get(id) || { toJSON: () => {} }\n                        ).toJSON(),\n                      },\n                    )\n                    session.showWidget?.(featureWidget)\n                  }}\n                  onMouseOver={() => setMouseoverElt(id)}\n                  onMouseOut={() => setMouseoverElt(undefined)}\n                />,\n              )\n            }\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default Translocations\n","import React, { useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { BreakpointViewModel, VIEW_DIVIDER_HEIGHT } from '../model'\nimport AlignmentConnections from './AlignmentConnections'\nimport Breakends from './Breakends'\nimport Header from './Header'\nimport Translocations from './Translocations'\n\nconst useStyles = makeStyles(theme => {\n  return {\n    root: {\n      position: 'relative',\n      marginBottom: theme.spacing(1),\n      overflow: 'hidden',\n    },\n    breakpointMarker: {\n      position: 'absolute',\n      top: 0,\n      height: '100%',\n      width: '3px',\n      background: 'magenta',\n    },\n    viewDivider: {\n      background: theme.palette.secondary.main,\n      height: VIEW_DIVIDER_HEIGHT,\n    },\n    container: {\n      display: 'grid',\n    },\n    overlay: {\n      display: 'flex',\n      width: '100%',\n      gridArea: '1/1',\n      '& path': {\n        cursor: 'crosshair',\n        fill: 'none',\n      },\n    },\n    content: {\n      gridArea: '1/1',\n    },\n  }\n})\n\nconst Overlay = observer(\n  (props: {\n    parentRef: React.RefObject<SVGSVGElement>\n    model: BreakpointViewModel\n    trackConfigId: string\n  }) => {\n    const { model, trackConfigId } = props\n    const tracks = model.getMatchedTracks(trackConfigId)\n    if (\n      tracks[0].type === 'PileupTrack' ||\n      tracks[0].type === 'AlignmentsTrack'\n    ) {\n      return <AlignmentConnections {...props} />\n    }\n    if (tracks[0].type === 'VariantTrack') {\n      return model.hasTranslocations(trackConfigId) ? (\n        <Translocations {...props} />\n      ) : (\n        <Breakends {...props} />\n      )\n    }\n    return null\n  },\n)\n\nconst BreakpointSplitView = observer(\n  ({ model }: { model: BreakpointViewModel }) => {\n    const classes = useStyles()\n    const { views } = model\n    const { pluginManager } = getEnv(model)\n    const ref = useRef(null)\n\n    return (\n      <div>\n        <Header model={model} />\n        <div className={classes.container}>\n          <div className={classes.content}>\n            <div style={{ position: 'relative' }}>\n              {views.map((view, idx) => {\n                const { ReactComponent } = pluginManager.getViewType(view.type)\n                const viewComponent = (\n                  <ReactComponent key={view.id} model={view} />\n                )\n                if (idx === views.length - 1) {\n                  return viewComponent\n                }\n                return [\n                  viewComponent,\n                  <div\n                    key={`${view.id}-divider`}\n                    className={classes.viewDivider}\n                  />,\n                ]\n              })}\n            </div>\n          </div>\n          <div className={classes.overlay}>\n            <svg\n              ref={ref}\n              style={{\n                width: '100%',\n                zIndex: 10,\n                pointerEvents: model.interactToggled ? undefined : 'none',\n              }}\n            >\n              {model.matchedTracks.map(id => {\n                // note: we must pass ref down, because the child component\n                // needs to getBoundingClientRect on the this components SVG,\n                // and we cannot rely on using getBoundingClientRect in this\n                // component to make sure this works because if it gets\n                // shifted around by another element, this will not re-render\n                // necessarily\n                return (\n                  <Overlay\n                    parentRef={ref}\n                    key={id}\n                    model={model}\n                    trackConfigId={id}\n                  />\n                )\n              })}\n            </svg>\n          </div>\n        </div>\n      </div>\n    )\n  },\n)\n\nexport default BreakpointSplitView\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getSession } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport BreakpointSplitViewComponent from './components/BreakpointSplitView'\nimport BreakpointSplitViewModel from './model'\n\nclass BreakpointSplitViewType extends ViewType {\n  snapshotFromBreakendFeature(feature: Feature, view: LinearGenomeViewModel) {\n    const breakendSpecification = (feature.get('ALT') || [])[0]\n    const startPos = feature.get('start')\n    let endPos\n    const bpPerPx = 10\n\n    // TODO: Figure this out for multiple assembly names\n    const { assemblyName } = view.displayedRegions[0]\n    const { assemblyManager } = getSession(view)\n    const assembly = assemblyManager.get(assemblyName)\n\n    if (!assembly) {\n      throw new Error(`assembly ${assemblyName} not found`)\n    }\n    if (!assembly.regions) {\n      throw new Error(`assembly ${assemblyName} regions not loaded`)\n    }\n    const { getCanonicalRefName } = assembly as Assembly\n    const featureRefName = getCanonicalRefName(feature.get('refName'))\n    const topRegion = assembly.regions.find(\n      f => f.refName === String(featureRefName),\n    )\n\n    let mateRefName: string | undefined\n    let startMod = 0\n    let endMod = 0\n\n    if (breakendSpecification) {\n      // a VCF breakend feature\n      if (breakendSpecification === '<TRA>') {\n        const INFO = feature.get('INFO') || []\n        endPos = INFO.END[0] - 1\n        mateRefName = getCanonicalRefName(INFO.CHR2[0])\n      } else {\n        const matePosition = breakendSpecification.MatePosition.split(':')\n        endPos = parseInt(matePosition[1], 10) - 1\n        mateRefName = getCanonicalRefName(matePosition[0])\n        if (breakendSpecification.Join === 'left') {\n          startMod = -1\n        }\n        if (breakendSpecification.MateDirection === 'left') {\n          endMod = -1\n        }\n      }\n\n      // if (breakendSpecification.Join === 'left') {\n      // marker -1, else 0\n\n      // if (breakendSpecification.MateDirection === 'left') {\n      // marker -1, else 0\n    } else if (feature.get('mate')) {\n      // a generic 'mate' feature\n      const mate = feature.get('mate')\n      mateRefName = getCanonicalRefName(mate.refName)\n      endPos = mate.start\n    }\n\n    if (!mateRefName) {\n      console.warn(\n        `unable to resolve mate refName ${mateRefName} in reference genome`,\n      )\n      return {}\n    }\n\n    const bottomRegion = assembly.regions.find(\n      f => f.refName === String(mateRefName),\n    )\n\n    if (!topRegion || !bottomRegion) {\n      console.warn(\n        `unable to find the refName for the top or bottom of the breakpoint view`,\n      )\n      return {}\n    }\n\n    const topMarkedRegion = [{ ...topRegion }, { ...topRegion }]\n    const bottomMarkedRegion = [{ ...bottomRegion }, { ...bottomRegion }]\n    topMarkedRegion[0].end = startPos + startMod\n    topMarkedRegion[1].start = startPos + startMod\n    bottomMarkedRegion[0].end = endPos + endMod\n    bottomMarkedRegion[1].start = endPos + endMod\n    const snapshot = {\n      type: 'BreakpointSplitView',\n      views: [\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: topMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (topRegion.start + feature.get('start')) / bpPerPx,\n        },\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: bottomMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (bottomRegion.start + endPos) / bpPerPx,\n        },\n      ],\n      displayName: `${\n        feature.get('name') || feature.get('id') || 'breakend'\n      } split detail`,\n    }\n    return snapshot\n  }\n}\n\nexport default (pluginManager: PluginManager) => {\n  const { load } = pluginManager\n\n  const { stateModel } = load(BreakpointSplitViewModel)\n\n  return new BreakpointSplitViewType({\n    name: 'BreakpointSplitView',\n    stateModel,\n    ReactComponent: BreakpointSplitViewComponent,\n  })\n}\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  configSchema as alignmentsFeatureDetailConfigSchema,\n  stateModel as alignmentsFeatureDetailStateModel,\n} from './BreakpointAlignmentsFeatureDetail'\nimport BreakpointSplitViewFactory from './BreakpointSplitView'\n\nexport default class BreakpointSplitViewPlugin extends Plugin {\n  name = 'BreakpointSplitViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(BreakpointSplitViewFactory),\n    )\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'BreakpointAlignmentsWidget',\n          heading: 'Breakpoint feature details',\n          configSchema: alignmentsFeatureDetailConfigSchema,\n          stateModel: alignmentsFeatureDetailStateModel,\n          ReactComponent: lazy(\n            () =>\n              import(\n                './BreakpointAlignmentsFeatureDetail/BreakpointAlignmentsFeatureDetail'\n              ),\n          ),\n        }),\n    )\n  }\n\n  configure() {}\n}\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'UCSCTrackHubConnection',\n  {\n    hubTxtLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'http://mysite.com/path/to/hub.txt' },\n      description: 'location of the hub file (usually called hub.txt)',\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'optional list of genomes to import from this track hub, if empty all genomes will be imported',\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","// These are the assemblies for which there is a sequence file located at\n// http://hgdownload.soe.ucsc.edu/goldenPath/${assemblyName}/bigZips/${assemblyName}.2bit\n// This list was generated by `getUcscAssemblies.js`\n\nexport default `ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9`.split(/\\r?\\n/)\n","import { objectHash } from '@jbrowse/core/util'\nimport { GenomesFile, HubFile, TrackDbFile } from '@gmod/ucsc-hub'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport {\n  generateUnsupportedTrackConf,\n  generateUnknownTrackConf,\n} from '@jbrowse/core/util/tracks'\nimport ucscAssemblies from './ucscAssemblies'\n\nexport { ucscAssemblies }\n\nexport async function fetchHubFile(hubFileLocation) {\n  try {\n    const hubFileText = await openLocation(hubFileLocation).readFile('utf8')\n    return new HubFile(hubFileText)\n  } catch (error) {\n    throw new Error(`Not a valid hub.txt file, got error: '${error}'`)\n  }\n}\n\nexport async function fetchGenomesFile(genomesFileLocation) {\n  const genomesFileText = await openLocation(genomesFileLocation).readFile(\n    'utf8',\n  )\n  return new GenomesFile(genomesFileText)\n}\n\nexport async function fetchTrackDbFile(trackDbFileLocation) {\n  const trackDbFileText = await openLocation(trackDbFileLocation).readFile(\n    'utf8',\n  )\n  return new TrackDbFile(trackDbFileText)\n}\n\nexport function generateTracks(\n  trackDb,\n  trackDbFileLocation,\n  assemblyName,\n  sequenceAdapter,\n) {\n  const tracks = []\n\n  trackDb.forEach((track, trackName) => {\n    const trackKeys = Array.from(track.keys())\n    const parentTrackKeys = [\n      'superTrack',\n      'compositeTrack',\n      'container',\n      'view',\n    ]\n    if (trackKeys.some(key => parentTrackKeys.includes(key))) {\n      return\n    }\n    const parentTracks = []\n    let currentTrackName = trackName\n    do {\n      currentTrackName = trackDb.get(currentTrackName).get('parent')\n      if (currentTrackName) {\n        ;[currentTrackName] = currentTrackName.split(' ')\n        parentTracks.push(trackDb.get(currentTrackName))\n      }\n    } while (currentTrackName)\n    parentTracks.reverse()\n    const categories = parentTracks.map(parentTrack =>\n      parentTrack.get('shortLabel'),\n    )\n    const res = makeTrackConfig(\n      track,\n      categories,\n      trackDbFileLocation,\n      trackDb,\n      sequenceAdapter,\n    )\n    res.trackId = `ucsc-trackhub-${objectHash(res)}`\n    res.assemblyNames = [assemblyName]\n    tracks.push(res)\n  })\n\n  return tracks\n}\n\nfunction makeTrackConfig(\n  track,\n  categories,\n  trackDbFileLocation,\n  trackDb,\n  sequenceAdapter,\n) {\n  let trackType = track.get('type')\n  if (!trackType) {\n    trackType = trackDb.get(track.get('parent')).get('type')\n  }\n  let baseTrackType = trackType.split(' ')[0]\n  if (\n    baseTrackType === 'bam' &&\n    track.get('bigDataUrl').toLowerCase().endsWith('cram')\n  ) {\n    baseTrackType = 'cram'\n  }\n  let bigDataLocation\n  if (trackDbFileLocation.uri) {\n    bigDataLocation = {\n      uri: new URL(track.get('bigDataUrl'), trackDbFileLocation.uri).href,\n    }\n  } else {\n    bigDataLocation = { localPath: track.get('bigDataUrl') }\n  }\n  let bigDataIndexLocation\n\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.bai`,\n                trackDbFileLocation.uri,\n              ).href,\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? { localPath: track.get('bigDataIndex') }\n          : { localPath: `${track.get('bigDataUrl')}.bai` }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bed5FloatScore':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedGraph':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedRnaElements':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigBarChart':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigBed':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigGenePred':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigChain':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigInteract':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigMaf':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigPsl':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigWig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'coloredExon':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.crai`,\n                trackDbFileLocation.uri,\n              ).href,\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? { localPath: track.get('bigDataIndex') }\n          : { localPath: `${track.get('bigDataUrl')}.crai` }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          cramLocation: bigDataLocation,\n          craiLocation: bigDataIndexLocation,\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'narrowPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigNarrowPeak':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'peptideMapping':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'vcfTabix':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.tbi`,\n                trackDbFileLocation.uri,\n              ).href,\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? { localPath: track.get('bigDataIndex') }\n          : { localPath: `${track.get('bigDataUrl')}.tbi` }\n      }\n      return {\n        type: 'VariantTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'VcfTabixAdapter',\n          vcfGzLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'wigMaf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'hic':\n      return {\n        type: 'HicTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'HicAdapter',\n          hicLocation: bigDataLocation,\n        },\n      }\n    case 'halSnake':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n\n    default:\n      return generateUnknownTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n  }\n}\n","import { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport {\n  fetchGenomesFile,\n  fetchHubFile,\n  fetchTrackDbFile,\n  generateTracks,\n} from './ucscTrackHub'\n\nexport default function UCSCTrackHubConnection(pluginManager) {\n  return types.compose(\n    'UCSCTrackHubConnection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('UCSCTrackHubConnection'),\n      })\n      .actions(self => ({\n        connect() {\n          const connectionName = readConfObject(self.configuration, 'name')\n          const hubFileLocation = readConfObject(\n            self.configuration,\n            'hubTxtLocation',\n          )\n          const session = getSession(self)\n          fetchHubFile(hubFileLocation)\n            .then(hubFile => {\n              let genomesFileLocation\n              if (hubFileLocation.uri) {\n                genomesFileLocation = {\n                  uri: new URL(hubFile.get('genomesFile'), hubFileLocation.uri)\n                    .href,\n                }\n              } else {\n                genomesFileLocation = { localPath: hubFile.get('genomesFile') }\n              }\n              return Promise.all([\n                hubFile,\n                fetchGenomesFile(genomesFileLocation),\n              ])\n            })\n            .then(([hubFile, genomesFile]) => {\n              const trackDbData = []\n              for (const [genomeName, genome] of genomesFile) {\n                const assemblyNames = readConfObject(\n                  self.configuration,\n                  'assemblyNames',\n                )\n                if (\n                  assemblyNames.length > 0 &&\n                  !assemblyNames.includes(genomeName)\n                ) {\n                  break\n                }\n                const assemblyConf = session.assemblies.find(\n                  assembly => readConfObject(assembly, 'name') === genomeName,\n                )\n                if (!assemblyConf) {\n                  throw new Error(\n                    `Cannot find assembly for \"${genomeName}\" from the genomes file for connection \"${connectionName}\"`,\n                  )\n                }\n                let trackDbFileLocation\n                if (hubFileLocation.uri) {\n                  trackDbFileLocation = {\n                    uri: new URL(\n                      genome.get('trackDb'),\n                      new URL(hubFile.get('genomesFile'), hubFileLocation.uri),\n                    ).href,\n                  }\n                } else {\n                  trackDbFileLocation = {\n                    localPath: genome.get('trackDb'),\n                  }\n                }\n                trackDbData.push(\n                  Promise.all([\n                    trackDbFileLocation,\n                    fetchTrackDbFile(trackDbFileLocation),\n                    genomeName,\n                    assemblyConf,\n                  ]),\n                )\n              }\n              return Promise.all([...trackDbData])\n            })\n            .then(trackDbData => {\n              for (const [\n                trackDbFileLocation,\n                trackDbFile,\n                genomeName,\n                assemblyConf,\n              ] of trackDbData) {\n                const sequenceAdapter = readConfObject(assemblyConf, [\n                  'sequence',\n                  'adapter',\n                ])\n                const tracks = generateTracks(\n                  trackDbFile,\n                  trackDbFileLocation,\n                  genomeName,\n                  sequenceAdapter,\n                )\n                self.addTrackConfs(tracks)\n              }\n            })\n            .catch(error => {\n              console.error(error)\n              session.notify(\n                `There was a problem connecting to the UCSC Track Hub \"${self.name}\". Please make sure you have entered a valid hub.txt file. The error that was thrown is: \"${error}\"`,\n                'error',\n              )\n              session.breakConnection(self.configuration)\n            })\n        },\n      })),\n  )\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  guessAdapter,\n  guessTrackType,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\n\nfunction isAbsoluteUrl(url: string) {\n  try {\n    new URL(url)\n    return true\n  } catch (error) {\n    return url.startsWith('/')\n  }\n}\n\nfunction getFileName(track: FileLocation) {\n  const uri = 'uri' in track ? track.uri : undefined\n  const localPath = 'localPath' in track ? track.localPath : undefined\n  const blob = 'blobId' in track ? track : undefined\n  return (\n    blob?.name ||\n    uri?.slice(uri.lastIndexOf('/') + 1) ||\n    localPath?.slice(localPath.lastIndexOf('/') + 1) ||\n    ''\n  )\n}\n\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('AddTrackModel', {\n      id: ElementId,\n      type: types.literal('AddTrackWidget'),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({\n      trackSource: 'fromFile',\n      trackData: undefined as FileLocation | undefined,\n      indexTrackData: undefined as FileLocation | undefined,\n\n      // alts\n      altAssemblyName: '',\n      altTrackName: '',\n      altTrackType: '',\n\n      adapterHint: '',\n    }))\n    .actions(self => ({\n      setAdapterHint(obj: string) {\n        self.adapterHint = obj\n      },\n      setTrackSource(str: string) {\n        self.trackSource = str\n      },\n      setTrackData(obj: FileLocation) {\n        self.trackData = obj\n      },\n      setIndexTrackData(obj: FileLocation) {\n        self.indexTrackData = obj\n      },\n      setAssembly(str: string) {\n        self.altAssemblyName = str\n      },\n      setTrackName(str: string) {\n        self.altTrackName = str\n      },\n      setTrackType(str: string) {\n        self.altTrackType = str\n      },\n\n      clearData() {\n        self.trackSource = ''\n        self.altTrackName = ''\n        self.altTrackType = ''\n        self.altAssemblyName = ''\n        self.adapterHint = ''\n        self.indexTrackData = { uri: '' }\n        self.trackData = { uri: '' }\n      },\n    }))\n    .views(self => ({\n      get trackAdapter() {\n        const { trackData, indexTrackData, adapterHint } = self\n\n        return trackData\n          ? guessAdapter(trackData, indexTrackData, getFileName, adapterHint)\n          : undefined\n      },\n\n      get trackName() {\n        return (\n          self.altTrackName ||\n          (self.trackData ? getFileName(self.trackData) : '')\n        )\n      },\n\n      get isFtp() {\n        const { trackData: track, indexTrackData: index } = self\n        return !!(\n          (index && 'uri' in index && index.uri.startsWith('ftp://')) ||\n          (track && 'uri' in track && track.uri.startsWith('ftp://'))\n        )\n      },\n\n      get isRelativeTrackUrl() {\n        const { trackData } = self\n        return trackData && 'uri' in trackData && !isAbsoluteUrl(trackData.uri)\n      },\n      get isRelativeIndexUrl() {\n        const { indexTrackData: index } = self\n        return index && 'uri' in index && !isAbsoluteUrl(index.uri)\n      },\n      get isRelativeUrl() {\n        return this.isRelativeIndexUrl || this.isRelativeTrackUrl\n      },\n\n      get trackHttp() {\n        const { trackData: track } = self\n        return track && 'uri' in track && track.uri.startsWith('http://')\n      },\n      get indexHttp() {\n        const { indexTrackData: index } = self\n        return index && 'uri' in index && index.uri.startsWith('http://')\n      },\n\n      get wrongProtocol() {\n        return (\n          window.location.protocol === 'https:' &&\n          (this.trackHttp || this.indexHttp)\n        )\n      },\n\n      get unsupported() {\n        return this.trackAdapter?.type === UNSUPPORTED\n      },\n\n      get assembly() {\n        return self.altAssemblyName || self.view.assemblyNames?.[0]\n      },\n\n      get trackType() {\n        return (\n          self.altTrackType ||\n          (this.trackAdapter ? guessTrackType(this.trackAdapter.type) : '')\n        )\n      },\n    }))\n    .views(self => ({\n      get warningMessage() {\n        if (self.isFtp) {\n          return `Warning: JBrowse cannot access files using the ftp protocol`\n        } else if (self.isRelativeUrl) {\n          return `Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.`\n        } else if (self.wrongProtocol) {\n          return `Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol`\n        }\n        return ''\n      },\n    }))\n}\n\nexport type AddTrackStateModel = ReturnType<typeof f>\nexport type AddTrackModel = Instance<AddTrackStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('AddTrackWidget', {})\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default types.model('AddConnectionModel', {\n  id: ElementId,\n  type: types.literal('AddConnectionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModel } from './model'\nexport const configSchema = ConfigurationSchema('AddConnectionWidget', {})\n","import { types, getParent } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nconst hasAnyOverlap = (a1 = [], a2 = []) =>\n  !!a1.find(value => a2.includes(value))\n\nfunction passesFilter(filter, config) {\n  const name = getTrackName(config)\n  const categories = readConfObject(config, 'category') || []\n  const regexp = new RegExp(filter, 'i')\n  return (\n    !!name.match(regexp) || categories.filter(cat => !!cat.match(regexp)).length\n  )\n}\n\nfunction getTrackName(config) {\n  if (!config.trackId) {\n    throw new Error('not a track')\n  }\n  return (\n    readConfObject(config, 'name') ||\n    `Reference sequence (${readConfObject(getParent(config), 'name')})`\n  )\n}\n\nexport function generateHierarchy(model, trackConfigurations, collapsed) {\n  const hierarchy = { children: [] }\n  const { filterText, view } = model\n\n  trackConfigurations\n    .filter(trackConf => passesFilter(filterText, trackConf))\n    .forEach(trackConf => {\n      // copy the categories since this array can be mutated downstream\n      const categories = [...(readConfObject(trackConf, 'category') || [])]\n\n      // silly thing where if trackId ends with sessionTrack, then push it to\n      // a category that starts with a space to force sort to the top...\n      // double whammy hackyness\n      if (trackConf.trackId.endsWith('sessionTrack')) {\n        categories.unshift(' Session tracks')\n      }\n\n      let currLevel = hierarchy\n\n      // find existing category to put track into or create it\n      for (let i = 0; i < categories.length; i++) {\n        const category = categories[i]\n        const ret = currLevel.children.find(c => c.name === category)\n        const id = categories.slice(0, i + 1).join(',')\n        if (!ret) {\n          const n = {\n            children: [],\n            name: category,\n            id,\n            state: { expanded: !collapsed.get(id) },\n          }\n          currLevel.children.push(n)\n          currLevel = n\n        } else {\n          currLevel = ret\n        }\n      }\n\n      // using splice here tries to group leaf nodes above hierarchical nodes\n      currLevel.children.splice(\n        currLevel.children.findIndex(elt => elt.children.length),\n        0,\n        {\n          id: trackConf.trackId,\n          name: getTrackName(trackConf),\n          conf: trackConf,\n          checked: !!view.tracks.find(f => f.configuration === trackConf),\n          children: [],\n        },\n      )\n    })\n\n  return hierarchy.children\n}\n\nexport default pluginManager =>\n  types\n    .model('HierarchicalTrackSelectorWidget', {\n      id: ElementId,\n      type: types.literal('HierarchicalTrackSelectorWidget'),\n      collapsed: types.map(types.boolean),\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      collapsedCategories: types.map(types.string, types.boolean),\n    })\n    .actions(self => ({\n      setView(view) {\n        self.view = view\n      },\n      toggleCategory(pathName) {\n        self.collapsed.set(pathName, !self.collapsed.get(pathName))\n      },\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText) {\n        self.filterText = newText\n      },\n    }))\n    .views(self => ({\n      getRefSeqTrackConf(assemblyName) {\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        const trackConf = assembly?.configuration.sequence\n        const viewType = pluginManager.getViewType(self.view.type)\n        if (trackConf) {\n          for (const display of trackConf.displays) {\n            if (\n              viewType.displayTypes.find(\n                displayType => displayType.name === display.type,\n              )\n            ) {\n              return trackConf\n            }\n          }\n        }\n        return undefined\n      },\n      trackConfigurations(assemblyName) {\n        if (!self.view) {\n          return []\n        }\n        const session = getSession(self)\n        const { tracks: trackConfigurations, assemblyManager } = session\n        const assembly = assemblyManager.get(assemblyName)\n        if (!assembly) {\n          return []\n        }\n        const refseq = self.getRefSeqTrackConf(assemblyName)\n        // filter out tracks that don't match the current assembly (check all\n        // assembly aliases) and display types\n        return (refseq ? [refseq] : []).concat([\n          ...trackConfigurations\n            .filter(conf => {\n              const trackConfAssemblies = readConfObject(conf, 'assemblyNames')\n              const { allAliases } = assembly\n              return hasAnyOverlap(allAliases, trackConfAssemblies)\n            })\n            .filter(conf => {\n              const { displayTypes } = pluginManager.getViewType(self.view.type)\n              const compatibleDisplays = displayTypes.map(\n                display => display.name,\n              )\n              const trackDisplays = conf.displays.map(display => display.type)\n              return hasAnyOverlap(compatibleDisplays, trackDisplays)\n            }),\n        ])\n      },\n\n      get assemblyNames() {\n        return self.view ? self.view.assemblyNames : []\n      },\n\n      connectionTrackConfigurations(assemblyName, connection) {\n        if (!self.view) {\n          return []\n        }\n        const trackConfigurations = connection.tracks\n        const session = getSession(self)\n        const { assemblyManager } = session\n        const assembly = assemblyManager.get(assemblyName)\n\n        if (!(assembly && assembly.initialized)) {\n          return []\n        }\n\n        // filter out tracks that don't match the current display types\n        return trackConfigurations\n          .filter(conf => {\n            const trackConfAssemblies = readConfObject(conf, 'assemblyNames')\n            const { allAliases } = assembly\n            return hasAnyOverlap(allAliases, trackConfAssemblies)\n          })\n          .filter(conf => {\n            const { displayTypes } = pluginManager.getViewType(self.view.type)\n            const compatibleDisplays = displayTypes.map(display => display.name)\n            const trackDisplays = conf.displays.map(display => display.type)\n            return hasAnyOverlap(compatibleDisplays, trackDisplays)\n          })\n      },\n\n      hierarchy(assemblyName) {\n        const hier = generateHierarchy(\n          self,\n          self.trackConfigurations(assemblyName),\n          self.collapsed,\n        )\n\n        const session = getSession(self)\n        const conns = session.connectionInstances\n          .filter(conn => {\n            const configAssemblyNames = readConfObject(\n              conn.configuration,\n              'assemblyNames',\n            )\n            if (configAssemblyNames.length === 0) {\n              return true\n            }\n            return configAssemblyNames.includes(assemblyName)\n          })\n          .map((conn, index) => {\n            const c = session.connections[index]\n            return {\n              id: c.connectionId,\n              name: readConfObject(c, 'name'),\n              children: this.connectionHierarchy(assemblyName, conn),\n              state: {\n                expanded: true,\n              },\n            }\n          })\n\n        return {\n          name: 'Root',\n          id: 'Root',\n          children: [\n            { name: 'Tracks', id: 'Tracks', children: hier },\n            ...conns,\n          ],\n        }\n      },\n\n      connectionHierarchy(assemblyName, connection) {\n        return generateHierarchy(\n          self,\n          self.connectionTrackConfigurations(assemblyName, connection),\n          self.collapsed,\n        )\n      },\n\n      // This recursively gets tracks from lower paths\n      allTracksInCategoryPath(path, connection, assemblyName) {\n        let currentHier = connection\n          ? self.connectionHierarchy(connection)\n          : self.hierarchy(assemblyName)\n        path.forEach(pathItem => {\n          currentHier = currentHier.get(pathItem) || new Map()\n        })\n        let tracks = {}\n        currentHier.forEach((contents, name) => {\n          if (contents.trackId) {\n            tracks[contents.trackId] = contents\n          } else {\n            tracks = Object.assign(\n              tracks,\n              self.allTracksInCategoryPath(path.concat([name])),\n            )\n          }\n        })\n        return tracks\n      },\n    }))\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema(\n  'HierarchicalTrackSelectorWidget',\n  {},\n)\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('PluginStoreModel', {\n      id: ElementId,\n      type: types.literal('PluginStoreWidget'),\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n}\n\nexport type PluginStoreStateModel = ReturnType<typeof f>\nexport type PluginStoreModel = Instance<PluginStoreStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as ReactComponent } from './components/PluginStoreWidget'\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('PluginStoreWidget', {})\n","import { lazy } from 'react'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SessionWithWidgets, isAbstractMenuManager } from '@jbrowse/core/util'\nimport NoteAddIcon from '@material-ui/icons/NoteAdd'\nimport InputIcon from '@material-ui/icons/Input'\nimport ExtensionIcon from '@material-ui/icons/Extension'\nimport {\n  configSchema as ucscConfigSchema,\n  modelFactory as ucscModelFactory,\n} from './ucsc-trackhub'\nimport {\n  stateModelFactory as AddTrackStateModelFactory,\n  configSchema as AddTrackConfigSchema,\n} from './AddTrackWidget'\nimport {\n  stateModel as AddConnectionStateModel,\n  configSchema as AddConnectionConfigSchema,\n} from './AddConnectionWidget'\nimport {\n  stateModelFactory as HierarchicalTrackSelectorStateModelFactory,\n  configSchema as HierarchicalTrackSelectorConfigSchema,\n} from './HierarchicalTrackSelectorWidget'\nimport {\n  stateModelFactory as PluginStoreStateModelFactory,\n  configSchema as PluginStoreConfigSchema,\n} from './PluginStoreWidget'\n\nconst SetDefaultSession = lazy(() => import('./SetDefaultSession'))\n\nconst AssemblyManager = lazy(() => import('./AssemblyManager'))\n\nexport default class extends Plugin {\n  name = 'DataManagementPlugin'\n\n  exports = {\n    AssemblyManager,\n    SetDefaultSession,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'UCSCTrackHubConnection',\n          configSchema: ucscConfigSchema,\n          stateModel: ucscModelFactory(pluginManager),\n          displayName: 'UCSC Track Hub',\n          description: 'A track or assembly hub in the Track Hub format',\n          url: '//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro',\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HierarchicalTrackSelectorWidget',\n        heading: 'Available tracks',\n        configSchema: HierarchicalTrackSelectorConfigSchema,\n        stateModel: HierarchicalTrackSelectorStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () =>\n            import(\n              './HierarchicalTrackSelectorWidget/components/HierarchicalTrackSelector'\n            ),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AddTrackWidget',\n        heading: 'Add a track',\n        configSchema: AddTrackConfigSchema,\n        stateModel: AddTrackStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./AddTrackWidget/components/AddTrackWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AddConnectionWidget',\n        heading: 'Add a connection',\n        configSchema: AddConnectionConfigSchema,\n        stateModel: AddConnectionStateModel,\n        ReactComponent: lazy(\n          () => import('./AddConnectionWidget/components/AddConnectionWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'PluginStoreWidget',\n        heading: 'Plugin store',\n        configSchema: PluginStoreConfigSchema,\n        stateModel: PluginStoreStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./PluginStoreWidget/components/PluginStoreWidget'),\n        ),\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('File', {\n        label: 'Open track',\n        icon: NoteAddIcon,\n        onClick: (session: SessionWithWidgets) => {\n          if (session.views.length === 0) {\n            session.notify('Please open a view to add a track first')\n          } else if (session.views.length >= 1) {\n            const widget = session.addWidget(\n              'AddTrackWidget',\n              'addTrackWidget',\n              { view: session.views[0].id },\n            )\n            session.showWidget(widget)\n            if (session.views.length > 1) {\n              session.notify(\n                `This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right`,\n              )\n            }\n          }\n        },\n      })\n      pluginManager.rootModel.appendToMenu('File', {\n        label: 'Open connection',\n        icon: InputIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget(\n            'AddConnectionWidget',\n            'addConnectionWidget',\n          )\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.appendToMenu('File', {\n        label: 'Plugin store',\n        icon: ExtensionIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget(\n            'PluginStoreWidget',\n            'pluginStoreWidget',\n          )\n          session.showWidget(widget)\n        },\n      })\n    }\n  }\n}\n\nexport { AssemblyManager, SetDefaultSession }\n","import { makeStyles } from '@material-ui/core/styles'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\n\nconst useStyles = makeStyles({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    textAlign: 'center',\n  },\n  error: {\n    display: 'block',\n    color: 'red',\n    width: '30em',\n    wordWrap: 'normal',\n    whiteSpace: 'normal',\n  },\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  }, [])\n\n  return shown ? (\n    <div data-testid=\"loading-synteny\" className={classes.loading}>\n      Loading &hellip;\n      <LinearProgress />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const classes = useStyles()\n  return <div className={classes.blockMessage}>{messageText}</div>\n}\nBlockMessage.propTypes = {\n  messageText: PropTypes.string.isRequired,\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const classes = useStyles()\n  return <div className={classes.blockError}>{error.message}</div>\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst ServerSideRenderedBlockContent = observer(({ model }: { model: any }) => {\n  if (model.error) {\n    return <BlockError error={model.error} data-testid=\"reload_button\" />\n  }\n  if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  }\n  if (!model.filled) {\n    return <LoadingMessage />\n  }\n  return model.reactElement\n})\n\nexport default ServerSideRenderedBlockContent\n","import { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { DotplotDisplayModel } from '..'\n\nconst DotplotDisplay: React.FC<{\n  model: DotplotDisplayModel\n  children?: React.ReactNode\n}> = props => {\n  const { model, children } = props\n  const { offsetX = 0, offsetY = 0 } = model.data || {}\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const view = getContainingView(model) as any\n  const top = view.vview.offsetPx - offsetY\n  const left = -(view.hview.offsetPx - offsetX)\n  return (\n    <div style={{ position: 'relative' }}>\n      <div\n        style={{\n          position: 'absolute',\n          top,\n          left,\n        }}\n      >\n        <model.ReactComponent2 {...props} />\n        {children}\n      </div>\n    </div>\n  )\n}\nDotplotDisplay.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  children: PropTypes.element,\n}\n\nDotplotDisplay.defaultProps = {\n  children: null,\n}\nexport default observer(DotplotDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  getConf,\n  readConfObject,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport React from 'react'\n\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\nimport { DotplotViewModel } from '../DotplotView/model'\n\nexport { default as ReactComponent } from './components/DotplotDisplay'\n\nexport function configSchemaFactory(pluginManager: any) {\n  return ConfigurationSchema(\n    'DotplotDisplay',\n    {\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'DotplotRenderer' },\n      ),\n    },\n    { explicitIdentifier: 'displayId', explicitlyTyped: true },\n  )\n}\n\nexport function stateModelFactory(configSchema: any) {\n  return types\n    .compose(\n      'DotplotDisplay',\n      BaseDisplay,\n      types\n        .model({\n          type: types.literal('DotplotDisplay'),\n          configuration: ConfigurationReference(configSchema),\n        })\n        .volatile(() => ({\n          renderInProgress: undefined as AbortController | undefined,\n          filled: false,\n          data: undefined as any,\n          reactElement: undefined as React.ReactElement | undefined,\n          message: undefined as string | undefined,\n          renderingComponent: undefined as any,\n          ReactComponent2: (ServerSideRenderedBlockContent as unknown) as React.FC,\n        })),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, 'renderer').type\n      },\n      get renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: self.configuration.renderer,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self as any,\n            () => renderBlockData(self as any),\n            (blockData): any => {\n              return blockData ? renderBlockEffect(blockData) : undefined\n            },\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 1000,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        setRendered(args: {\n          data: any\n          reactElement: React.ReactElement\n          renderingComponent: React.Component\n        }) {\n          if (args === undefined) {\n            return\n          }\n          const { data, reactElement, renderingComponent } = args\n          self.filled = true\n          self.message = undefined\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        setError(error: Error) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\n\nfunction renderBlockData(self: DotplotDisplayModel) {\n  const { rpcManager } = getSession(self)\n  const { renderProps, rendererType } = self\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as DotplotViewModel\n\n  // Alternative to readConfObject(config) is below\n  // used because renderProps is something under our control.\n  // Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n  getSnapshot(parent)\n\n  if (parent.initialized) {\n    const { viewWidth, viewHeight, borderSize, borderX, borderY } = parent\n    return {\n      rendererType,\n      rpcManager,\n      renderProps: {\n        ...renderProps,\n        view: getSnapshot(parent),\n        width: viewWidth,\n        height: viewHeight,\n        borderSize,\n        borderX,\n        borderY,\n      },\n      renderArgs: {\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId: getRpcSessionId(self),\n        timeout: 1000000, // 10000,\n      },\n    }\n  }\n  return undefined\n}\n\nasync function renderBlockEffect(\n  props: ReturnType<typeof renderBlockData> | undefined,\n) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const { rendererType, rpcManager, renderArgs, renderProps } = props\n\n  const { reactElement, ...data } = await (rendererType as any).renderInClient(\n    rpcManager,\n    {\n      ...renderArgs,\n      ...renderProps,\n    },\n  )\n\n  return { reactElement, data, renderingComponent: rendererType.ReactComponent }\n}\n\nexport type DotplotDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotDisplayModel = Instance<DotplotDisplayStateModel>\n","import { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { RenderArgsDeserialized } from '../DotplotRenderer'\n\nfunction DotplotRendering(props: RenderArgsDeserialized) {\n  return <PrerenderedCanvas {...props} />\n}\n\nexport default observer(DotplotRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'DotplotRenderer',\n  {\n    drawMode: {\n      type: 'stringEnum',\n      description: 'drawing mode',\n      model: types.enumeration('Rendering', ['normal']),\n      defaultValue: 'normal',\n    },\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a synteny',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    lineWidth: {\n      type: 'number',\n      description: 'width of the lines to be drawn',\n      defaultValue: 1.5,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { filter, toArray } from 'rxjs/operators'\nimport { Feature } from '../../util/simpleFeature'\nimport { Region } from '../../util/types'\nimport ServerSideRenderer, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from './ServerSideRendererType'\nimport RpcManager from '../../rpc/RpcManager'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport type { RenderResults }\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  blockKey: string\n}\n\nexport default class ComparativeServerSideRenderer extends ServerSideRenderer {\n  /**\n   * directly modifies the render arguments to prepare\n   * them to be serialized and sent to the worker.\n   *\n   * the base class replaces the `displayModel` param\n   * (which on the client is a MST model) with a stub\n   * that only contains the `selectedFeature`, since\n   * this is the only part of the track model that most\n   * renderers read.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs) {\n    const deserializedArgs = {\n      ...args,\n      displayModel: {},\n    }\n\n    return super.serializeArgsInClient(deserializedArgs)\n  }\n\n  // deserialize some of the results that came back from the worker\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserialized = super.deserializeResultsInClient(result, args)\n    return { ...deserialized, blockKey: args.blockKey }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then\n   * calls `render` with the RPC manager.\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    return rpcManager.call(\n      args.sessionId,\n      'ComparativeRender',\n      args,\n    ) as Promise<ResultsSerialized>\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    if (!renderArgs.filters) {\n      return true\n    }\n    return renderArgs.filters.passes(feature, renderArgs)\n  }\n\n  async getFeatures(renderArgs: any) {\n    const { dataAdapter, signal } = renderArgs\n\n    let regions = [] as Region[]\n\n    // @ts-ignore this is instantiated by the getFeatures call\n    regions = renderArgs.regions\n\n    if (!regions || regions.length === 0) {\n      console.warn('no regions supplied to comparative renderer')\n      return []\n    }\n\n    const requestRegions = regions.map(r => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.floor(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    // note that getFeaturesInMultipleRegions does not do glyph expansion\n    const featureObservable = dataAdapter.getFeaturesInMultipleRegions(\n      requestRegions,\n      {\n        signal,\n      },\n    )\n\n    return featureObservable\n      .pipe(\n        // @ts-ignore\n        filter(feature => this.featurePassesFilters(renderArgs, feature)),\n        toArray(),\n      )\n      .toPromise()\n  }\n}\n","import {\n  Instance,\n  SnapshotIn,\n  cast,\n  types,\n  getParent,\n  getSnapshot,\n  addDisposer,\n  resolveIdentifier,\n  getRoot,\n} from 'mobx-state-tree'\n\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { observable, autorun, transaction } from 'mobx'\nimport { BaseTrackStateModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport {\n  getSession,\n  minmax,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nfunction approxPixelStringLen(str: string) {\n  return str.length * 0.7 * 12\n}\n\ntype Coord = [number, number]\n\n// Used in the renderer\n// ref https://mobx-state-tree.js.org/concepts/volatiles on volatile state used here\nexport const Dotplot1DView = Base1DView.extend(self => {\n  const scaleFactor = observable.box(1)\n  return {\n    views: {\n      get dynamicBlocks() {\n        return calculateDynamicBlocks(self, false, false)\n      },\n      get scaleFactor() {\n        return scaleFactor.get()\n      },\n    },\n    actions: {\n      setScaleFactor(n: number) {\n        scaleFactor.set(n)\n      },\n    },\n  }\n})\n\nexport type Dotplot1DViewModel = Instance<typeof Dotplot1DView>\n\nconst DotplotHView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent(self).viewWidth\n    },\n  },\n}))\n\nconst DotplotVView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent(self).viewHeight\n    },\n  },\n}))\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types.compose(\n    BaseViewModel,\n    types\n      .model('DotplotView', {\n        id: ElementId,\n        type: types.literal('DotplotView'),\n        headerHeight: 0,\n        height: 600,\n        borderSize: 20,\n        tickSize: 5,\n        vtextRotation: 0,\n        htextRotation: -90,\n        fontSize: 15,\n        trackSelectorType: 'hierarchical',\n        assemblyNames: types.array(types.string),\n        hview: types.optional(DotplotHView, {}),\n        vview: types.optional(DotplotVView, {}),\n\n        tracks: types.array(\n          pluginManager.pluggableMstType(\n            'track',\n            'stateModel',\n          ) as BaseTrackStateModel,\n        ),\n\n        // this represents tracks specific to this view\n        // specifically used for read vs ref dotplots where\n        // this track would not really apply elsewhere\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n\n        // this represents assemblies in the specialized\n        // read vs ref dotplot view\n        viewAssemblyConfigs: types.array(types.frozen()),\n      })\n      .volatile(() => ({\n        volatileWidth: undefined as number | undefined,\n        error: undefined as Error | undefined,\n        borderX: 100,\n        borderY: 100,\n      }))\n      .views(self => ({\n        get width(): number {\n          if (!self.volatileWidth) {\n            throw new Error('width not initialized')\n          }\n          return self.volatileWidth\n        },\n      }))\n      .views(self => ({\n        get initialized() {\n          return (\n            self.volatileWidth !== undefined &&\n            self.hview.displayedRegions.length > 0 &&\n            self.vview.displayedRegions.length > 0\n          )\n        },\n        get loading() {\n          return self.assemblyNames.length > 0 && !this.initialized\n        },\n        get viewWidth() {\n          return self.width - self.borderX\n        },\n        get viewHeight() {\n          return self.height - self.borderY\n        },\n        get views() {\n          return [self.hview, self.vview]\n        },\n\n        get renderProps() {\n          return {\n            ...getParentRenderProps(self),\n            highResolutionScaling: getConf(\n              getSession(self),\n              'highResolutionScaling',\n            ),\n          }\n        },\n      }))\n      .actions(self => ({\n        afterAttach() {\n          const session = getSession(self)\n          addDisposer(\n            self,\n            autorun(\n              () => {\n                if (self.volatileWidth !== undefined) {\n                  const axis = [self.viewWidth, self.viewHeight]\n                  const views = [self.hview, self.vview]\n                  if (!self.initialized) {\n                    self.assemblyNames.forEach((name, index) => {\n                      const assembly = session.assemblyManager.get(name)\n                      if (assembly) {\n                        const { regions } = assembly\n                        if (regions && regions.length) {\n                          const regionsSnapshot = getSnapshot(regions)\n                          if (regionsSnapshot) {\n                            transaction(() => {\n                              views[index].setDisplayedRegions(regionsSnapshot)\n                              views[index].setBpPerPx(\n                                views[index].totalBp / axis[index],\n                              )\n                            })\n                          }\n                        }\n                      }\n                    })\n                  }\n                }\n              },\n              { delay: 1000 },\n            ),\n          )\n          addDisposer(\n            self,\n            autorun(() => {\n              // make sure we have a width on the view before trying to load\n              if (self.volatileWidth !== undefined) {\n                const padding = 10\n                // these are set via autorun to avoid dependency cycle\n                this.setBorderY(\n                  Math.max(\n                    self.hview.dynamicBlocks.contentBlocks.reduce(\n                      (a, b) =>\n                        Math.max(\n                          a,\n                          approxPixelStringLen(b.refName.slice(0, 30)),\n                        ),\n                      0,\n                    ) + padding,\n                    100,\n                  ),\n                )\n                this.setBorderX(\n                  Math.max(\n                    self.vview.dynamicBlocks.contentBlocks.reduce(\n                      (a, b) =>\n                        Math.max(\n                          a,\n                          approxPixelStringLen(b.refName.slice(0, 30)),\n                        ),\n                      0,\n                    ) + padding,\n                    100,\n                  ),\n                )\n              }\n            }),\n          )\n        },\n        setBorderX(n: number) {\n          self.borderX = n\n        },\n        setBorderY(n: number) {\n          self.borderY = n\n        },\n        setWidth(newWidth: number) {\n          self.volatileWidth = newWidth\n        },\n        setHeight(newHeight: number) {\n          self.height = newHeight\n        },\n\n        setError(e: Error) {\n          self.error = e\n        },\n\n        closeView() {\n          getParent(self, 2).removeView(self)\n        },\n\n        setHeaderHeight(height: number) {\n          self.headerHeight = height\n        },\n\n        zoomOutButton() {\n          self.hview.zoomOut()\n          self.vview.zoomOut()\n        },\n        zoomInButton() {\n          self.hview.zoomIn()\n          self.vview.zoomIn()\n        },\n        activateTrackSelector() {\n          if (self.trackSelectorType === 'hierarchical') {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const session: any = getSession(self)\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n          throw new Error(\n            `invalid track selector type ${self.trackSelectorType}`,\n          )\n        },\n\n        showTrack(trackId: string, initialSnapshot = {}) {\n          const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n            'track',\n          )\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          const trackType = pluginManager.getTrackType(configuration.type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${configuration.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const displayConf = configuration.displays.find(\n            (d: AnyConfigurationModel) => {\n              if (\n                viewType.displayTypes.find(\n                  displayType => displayType.name === d.type,\n                )\n              ) {\n                return true\n              }\n              return false\n            },\n          )\n          if (!displayConf) {\n            throw new Error(\n              `could not find a compatible display for view type ${self.type}`,\n            )\n          }\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        hideTrack(trackId: string) {\n          const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n            'track',\n          )\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          // if we have any tracks with that configuration, turn them off\n          const shownTracks = self.tracks.filter(\n            t => t.configuration === configuration,\n          )\n          transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n          return shownTracks.length\n        },\n\n        toggleTrack(trackId: string) {\n          // if we have any tracks with that configuration, turn them off\n          const hiddenCount = this.hideTrack(trackId)\n          // if none had that configuration, turn one on\n          if (!hiddenCount) {\n            this.showTrack(trackId)\n          }\n        },\n        setAssemblyNames(assemblyNames: string[]) {\n          self.assemblyNames = cast(assemblyNames)\n        },\n        setViews(arr: SnapshotIn<Base1DViewModel>[]) {\n          self.hview = cast(arr[0])\n          self.vview = cast(arr[1])\n        },\n\n        getCoords(mousedown: Coord, mouseup: Coord) {\n          const [xmin, xmax] = minmax(mouseup[0], mousedown[0])\n          const [ymin, ymax] = minmax(mouseup[1], mousedown[1])\n          return Math.abs(xmax - xmin) > 3 && Math.abs(ymax - ymin) > 3\n            ? [\n                self.hview.pxToBp(xmin),\n                self.hview.pxToBp(xmax),\n                self.vview.pxToBp(self.viewHeight - ymin),\n                self.vview.pxToBp(self.viewHeight - ymax),\n              ]\n            : undefined\n        },\n\n        zoomIn(mousedown: Coord, mouseup: Coord) {\n          const result = this.getCoords(mousedown, mouseup)\n          if (result) {\n            const [x1, x2, y1, y2] = result\n            self.hview.moveTo(x1, x2)\n            self.vview.moveTo(y2, y1)\n          }\n        },\n        onDotplotView(mousedown: Coord, mouseup: Coord) {\n          const result = this.getCoords(mousedown, mouseup)\n          if (result) {\n            const [x1, x2, y1, y2] = result\n            const session = getSession(self)\n\n            const d1 = Dotplot1DView.create({\n              ...getSnapshot(self.hview),\n              minimumBlockWidth: 0,\n              interRegionPaddingWidth: 0,\n            })\n            const d2 = Dotplot1DView.create({\n              ...getSnapshot(self.vview),\n              minimumBlockWidth: 0,\n              interRegionPaddingWidth: 0,\n            })\n            d1.setVolatileWidth(self.hview.width)\n            d2.setVolatileWidth(self.vview.width)\n            d1.moveTo(x1, x2)\n            d2.moveTo(y2, y1)\n            d1.zoomTo(d1.bpPerPx / (self.width / self.hview.width), 0)\n            d2.zoomTo(d2.bpPerPx / (self.width / self.vview.width), 0)\n\n            // add the specific evidence tracks to the LGVs in the split view\n            // note: scales the bpPerPx by scaling proportional of the dotplot\n            // width to the eventual lgv width\n            const tracks: {\n              type: string\n              configuration: AnyConfigurationModel\n              displays: {\n                type: string\n                configuration: AnyConfigurationModel\n              }[]\n            }[] = []\n            self.tracks.forEach(track => {\n              const trackConf = track.configuration\n              const displayConf = trackConf.displays.find(\n                (display: AnyConfigurationModel) =>\n                  display.type === 'LinearSyntenyDisplay',\n              )\n              if (displayConf) {\n                tracks.push({\n                  type: trackConf.type,\n                  configuration: trackConf,\n                  displays: [\n                    { type: displayConf.type, configuration: displayConf },\n                  ],\n                })\n              }\n            })\n            const viewSnapshot = {\n              type: 'LinearSyntenyView',\n              views: [\n                {\n                  type: 'LinearGenomeView',\n                  ...getSnapshot(d1),\n                  tracks: [],\n                  hideHeader: true,\n                },\n                {\n                  type: 'LinearGenomeView',\n                  ...getSnapshot(d2),\n                  tracks: [],\n                  hideHeader: true,\n                },\n              ],\n              tracks,\n            }\n\n            session.addView('LinearSyntenyView', viewSnapshot)\n          }\n        },\n      }))\n      .views(self => ({\n        get menuItems() {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            return [\n              {\n                label: 'Open track selector',\n                onClick: self.activateTrackSelector,\n              },\n            ]\n          }\n          return []\n        },\n      })),\n  )\n}\n\nexport type DotplotViewStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotViewModel = Instance<DotplotViewStateModel>\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  createCanvas,\n  createImageBitmap,\n} from '@jbrowse/core/util/offscreenCanvasPonyfill'\nimport { Instance } from 'mobx-state-tree'\nimport ComparativeServerSideRendererType, {\n  RenderArgsDeserialized as ComparativeRenderArgsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { Dotplot1DView } from '../DotplotView/model'\n\ntype Dim = Instance<typeof Dotplot1DView>\n\nconst { parseCigar } = MismatchParser\n\nexport interface RenderArgsDeserialized\n  extends ComparativeRenderArgsDeserialized {\n  height: number\n  width: number\n  highResolutionScaling: number\n  view: { hview: Dim; vview: Dim }\n}\n\nexport default class DotplotRenderer extends ComparativeServerSideRendererType {\n  async makeImageData(props: RenderArgsDeserialized & { views: Dim[] }) {\n    const {\n      highResolutionScaling: scale = 1,\n      width,\n      height,\n      config,\n      views,\n    } = props\n\n    const canvas = createCanvas(Math.ceil(width * scale), height * scale)\n    const ctx = canvas.getContext('2d')\n    const lineWidth = readConfObject(config, 'lineWidth')\n    ctx.lineWidth = lineWidth\n    ctx.scale(scale, scale)\n    ctx.fillStyle = readConfObject(config, 'color')\n    const [hview, vview] = views\n    const db1 = hview.dynamicBlocks.contentBlocks[0].offsetPx\n    const db2 = vview.dynamicBlocks.contentBlocks[0].offsetPx\n    ;(hview.features || []).forEach(feature => {\n      const start = feature.get('start')\n      const end = feature.get('end')\n      const refName = feature.get('refName')\n      const mate = feature.get('mate')\n      const mateRef = mate.refName\n      // const identity = feature.get('numMatches') / feature.get('blockLen')\n      // ctx.fillStyle = `hsl(${identity * 150},50%,50%)`\n      const color = readConfObject(config, 'color', { feature })\n      ctx.fillStyle = color\n      ctx.strokeStyle = color\n      const b10 = hview.bpToPx({ refName, coord: start })\n      const b20 = hview.bpToPx({ refName, coord: end })\n      const e10 = vview.bpToPx({ refName: mateRef, coord: mate.start })\n      const e20 = vview.bpToPx({ refName: mateRef, coord: mate.end })\n      if (\n        b10 !== undefined &&\n        b20 !== undefined &&\n        e10 !== undefined &&\n        e20 !== undefined\n      ) {\n        const b1 = b10 - db1\n        const b2 = b20 - db1\n        const e1 = e10 - db2\n        const e2 = e20 - db2\n        if (Math.abs(b1 - b2) < 3 && Math.abs(e1 - e2) < 3) {\n          ctx.fillRect(\n            b1 - lineWidth / 2,\n            height - e1 - lineWidth / 2,\n            lineWidth,\n            lineWidth,\n          )\n        } else {\n          let currX = b1\n          let currY = e1\n          const cigar = feature.get('cg') || feature.get('CIGAR')\n          if (cigar) {\n            const cigarOps = parseCigar(cigar)\n            ctx.beginPath()\n            for (let i = 0; i < cigarOps.length; i += 2) {\n              const val = +cigarOps[i]\n              const op = cigarOps[i + 1]\n\n              const prevX = currX\n              const prevY = currY\n\n              if (op === 'M' || op === '=' || op === 'X') {\n                currX += val / hview.bpPerPx\n                currY += val / vview.bpPerPx\n              } else if (op === 'D' || op === 'N') {\n                currX += val / hview.bpPerPx\n              } else if (op === 'I') {\n                currY += val / vview.bpPerPx\n              }\n              ctx.moveTo(prevX, height - prevY)\n              ctx.lineTo(currX, height - currY)\n            }\n            ctx.stroke()\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(b1, height - e1)\n            ctx.lineTo(b2, height - e2)\n            ctx.stroke()\n          }\n        }\n      } else {\n        console.warn(\n          `feature at ${refName}:${start}-${end} ${mateRef}:${mate.start}-${mate.end} not plotted, fell outside of range ${b10} ${b20} ${e10} ${e20}`,\n        )\n      }\n    })\n    return createImageBitmap(canvas)\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const {\n      width,\n      height,\n      view: { hview, vview },\n    } = renderProps\n    const dimensions = [width, height]\n    const realizedViews = [hview, vview].map((snap, idx) => {\n      const view = Dotplot1DView.create(snap)\n      view.setVolatileWidth(dimensions[idx])\n      return view\n    })\n    await Promise.all(\n      realizedViews.map(async view => {\n        view.setFeatures(\n          await this.getFeatures({\n            ...renderProps,\n            regions: view.dynamicBlocks.contentBlocks,\n          }),\n        )\n      }),\n    )\n    const imageData = await this.makeImageData({\n      ...renderProps,\n      views: realizedViews,\n    })\n\n    const results = await super.render({\n      ...renderProps,\n      height,\n      width,\n      imageData,\n    })\n\n    return {\n      ...results,\n      imageData,\n      height,\n      width,\n      offsetX: realizedViews[0].dynamicBlocks.blocks[0].offsetPx,\n      offsetY: realizedViews[1].dynamicBlocks.blocks[0].offsetPx,\n    }\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  FileLocation,\n  NoAssemblyRegion,\n  Region,\n} from '@jbrowse/core/util/types'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport QuickLRU from '@jbrowse/core/util/QuickLRU'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\n\ninterface PafRecord {\n  records: NoAssemblyRegion[]\n  extra: {\n    blockLen: number\n    mappingQual: number\n    numMatches: number\n    strand: string\n  }\n}\n\nexport default class PAFAdapter extends BaseFeatureDataAdapter {\n  private cache = new AbortablePromiseCache({\n    cache: new QuickLRU({ maxSize: 1 }),\n    fill: (data: BaseOptions, signal?: AbortSignal) => {\n      return this.setup({ ...data, signal })\n    },\n  })\n\n  private assemblyNames: string[]\n\n  private pafLocation: GenericFilehandle\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    const pafLocation = readConfObject(config, 'pafLocation') as FileLocation\n    const assemblyNames = readConfObject(config, 'assemblyNames') as string[]\n    this.pafLocation = openLocation(pafLocation)\n    this.assemblyNames = assemblyNames\n  }\n\n  async setup(opts?: BaseOptions) {\n    const text = (await this.pafLocation.readFile({\n      encoding: 'utf8',\n      ...opts,\n    })) as string\n    const pafRecords: PafRecord[] = []\n    text.split('\\n').forEach((line: string, index: number) => {\n      if (line.length) {\n        const [\n          chr1,\n          queryRefSeqLen,\n          start1,\n          end1,\n          strand,\n          chr2,\n          targetRefSeqLen,\n          start2,\n          end2,\n          numMatches,\n          blockLen,\n          mappingQual,\n          ...fields\n        ] = line.split('\\t')\n\n        const rest = Object.fromEntries(\n          fields.map(field => {\n            const r = field.indexOf(':')\n            const fieldName = field.slice(0, r)\n            const fieldValue = field.slice(r + 3)\n            return [fieldName, fieldValue]\n          }),\n        )\n\n        pafRecords[index] = {\n          records: [\n            { refName: chr1, start: +start1, end: +end1 },\n            { refName: chr2, start: +start2, end: +end2 },\n          ],\n          extra: {\n            numMatches: +numMatches,\n            blockLen: +blockLen,\n            strand,\n            mappingQual: +mappingQual,\n            ...rest,\n          },\n        }\n      }\n    })\n    return pafRecords\n  }\n\n  async hasDataForRefName() {\n    // determining this properly is basically a call to getFeatures\n    // so is not really that important, and has to be true or else\n    // getFeatures is never called (BaseAdapter filters it out)\n    return true\n  }\n\n  async getRefNames() {\n    // we cannot determine this accurately\n    return []\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const pafRecords = await this.cache.get('initialize', opts, opts.signal)\n\n      // The index of the assembly name in the region list corresponds to\n      // the adapter in the subadapters list\n      const index = this.assemblyNames.indexOf(region.assemblyName)\n      if (index !== -1) {\n        for (let i = 0; i < pafRecords.length; i++) {\n          const { extra, records } = pafRecords[i]\n          const { start, end, refName } = records[index]\n          if (records[index].refName === region.refName) {\n            if (doesIntersect2(region.start, region.end, start, end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `row_${i}`,\n                  start,\n                  end,\n                  refName,\n                  syntenyId: i,\n                  mate: {\n                    start: records[+!index].start,\n                    end: records[+!index].end,\n                    refName: records[+!index].refName,\n                  },\n                  ...extra,\n                }),\n              )\n            }\n          }\n        }\n      }\n\n      observer.complete()\n    })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'PAFAdapter',\n  {\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n    pafLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.paf' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { checkAbortSignal, renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport ComparativeServerSideRendererType, {\n  RenderArgs as ComparativeRenderArgs,\n  RenderArgsSerialized as ComparativeRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\n\ninterface RenderArgs extends ComparativeRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\ninterface RenderArgsSerialized extends ComparativeRenderArgsSerialized {\n  adapterConfig: {}\n  rendererType: string\n}\n\n/**\n * call a synteny renderer with the given args\n * param views: a set of views that each contain a set of regions\n * used instead of passing regions directly as in render()\n */\nexport default class ComparativeRender extends RpcMethodType {\n  name = 'ComparativeRender'\n\n  async serializeArguments(args: RenderArgs, rpcDriverClassName: string) {\n    const assemblyManager = this.pluginManager.rootModel?.session\n      ?.assemblyManager\n    const renamedArgs = assemblyManager\n      ? await renameRegionsIfNeeded(assemblyManager, args)\n      : args\n\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return renamedArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = this.pluginManager.getRendererType(rendererType)\n\n    if (!(RendererType instanceof ComparativeServerSideRendererType)) {\n      throw new Error(\n        'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n      )\n    }\n\n    return RendererType.serializeArgsInClient(renamedArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriverClassName: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriverClassName !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(\n        args,\n        rpcDriverClassName,\n      )\n    }\n    const { sessionId, adapterConfig, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (!(dataAdapter instanceof BaseFeatureDataAdapter)) {\n      throw new Error(\n        `ComparativeRender cannot handle this type of data adapter ${dataAdapter}`,\n      )\n    }\n\n    const RendererType = this.pluginManager.getRendererType(rendererType)\n\n    if (!RendererType) {\n      throw new Error(`renderer \"${rendererType}\" not found`)\n    }\n    if (!RendererType.ReactComponent) {\n      throw new Error(\n        `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n      )\n    }\n\n    if (!(RendererType instanceof ComparativeServerSideRendererType)) {\n      throw new Error(\n        'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n      )\n    }\n\n    const renderArgs = {\n      ...deserializedArgs,\n      dataAdapter,\n    }\n\n    const result =\n      rpcDriverClassName === 'MainThreadRpcDriver'\n        ? await RendererType.render(renderArgs)\n        : await RendererType.renderInWorker(renderArgs)\n    checkAbortSignal(signal)\n    return result\n  }\n\n  async deserializeReturn(\n    serializedReturn: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriverClassName: string,\n  ): Promise<unknown> {\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return serializedReturn\n    }\n\n    const { rendererType } = args\n    const RendererType = this.pluginManager.getRendererType(rendererType)\n    if (!RendererType) {\n      throw new Error(`renderer \"${rendererType}\" not found`)\n    }\n    if (!RendererType.ReactComponent) {\n      throw new Error(\n        `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n      )\n    }\n    if (!(RendererType instanceof ComparativeServerSideRendererType)) {\n      throw new Error(\n        'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n      )\n    }\n    return RendererType.deserializeResultsInClient(\n      serializedReturn as ResultsSerialized,\n      args,\n    )\n  }\n}\n","import { lazy } from 'react'\nimport Plugin from '@jbrowse/core/Plugin'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport AddIcon from '@material-ui/icons/Add'\nimport { autorun } from 'mobx'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  isAbstractMenuManager,\n  getSession,\n} from '@jbrowse/core/util'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { AbstractDisplayModel } from '@jbrowse/core/util/types'\nimport TimelineIcon from '@material-ui/icons/Timeline'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport {\n  configSchemaFactory as dotplotDisplayConfigSchemaFactory,\n  stateModelFactory as dotplotDisplayStateModelFactory,\n  ReactComponent as DotplotDisplayReactComponent,\n} from './DotplotDisplay'\nimport DotplotRenderer, {\n  configSchema as dotplotRendererConfigSchema,\n  ReactComponent as DotplotRendererReactComponent,\n} from './DotplotRenderer'\nimport stateModelFactory from './DotplotView/model'\n\nimport {\n  configSchema as PAFAdapterConfigSchema,\n  AdapterClass as PAFAdapter,\n} from './PAFAdapter'\nimport ComparativeRender from './DotplotRenderer/ComparativeRenderRpc'\n\nconst { parseCigar } = MismatchParser\n\ninterface Track {\n  id: string\n  type: string\n  displays: {\n    addAdditionalContextMenuItemCallback: Function\n    additionalContextMenuItemCallbacks: Function[]\n    id: string\n    type: string\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    PileupDisplay: any\n  }[]\n}\ninterface View {\n  tracks: Track[]\n  views?: View[]\n  type: string\n}\ninterface Session {\n  views: View[]\n}\nfunction getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nfunction getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nfunction getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nfunction getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\ninterface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  seqLength: number\n}\n\nexport default class DotplotPlugin extends Plugin {\n  name = 'DotplotPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() => {\n      return new ViewType({\n        name: 'DotplotView',\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./DotplotView/components/DotplotView'),\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = dotplotDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'DotplotDisplay',\n        configSchema,\n        stateModel: dotplotDisplayStateModelFactory(configSchema),\n        trackType: 'SyntenyTrack',\n        viewType: 'DotplotView',\n        ReactComponent: DotplotDisplayReactComponent,\n      })\n    })\n\n    pluginManager.addRendererType(\n      () =>\n        new DotplotRenderer({\n          name: 'DotplotRenderer',\n          configSchema: dotplotRendererConfigSchema,\n          ReactComponent: DotplotRendererReactComponent,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'PAFAdapter',\n          configSchema: PAFAdapterConfigSchema,\n          AdapterClass: PAFAdapter,\n        }),\n    )\n\n    // install our comparative rendering rpc callback\n    pluginManager.addRpcMethod(() => new ComparativeRender(pluginManager))\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Dotplot view',\n        icon: TimelineIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('DotplotView', {})\n        },\n      })\n    }\n\n    const cb = (\n      feature: Feature,\n      display: AbstractDisplayModel & IAnyStateTreeNode,\n    ) => {\n      const { parentTrack } = display\n      return feature\n        ? [\n            {\n              label: 'Dotplot of read vs ref',\n              icon: AddIcon,\n              onClick: () => {\n                const session = getSession(display)\n                const clipPos = feature.get('clipPos')\n                const cigar = feature.get('CIGAR')\n                const flags = feature.get('flags')\n                const SA: string =\n                  (feature.get('tags')\n                    ? feature.get('tags').SA\n                    : feature.get('SA')) || ''\n                const readName = feature.get('name')\n                const readAssembly = `${readName}_assembly`\n                const [trackAssembly] = getConf(parentTrack, 'assemblyNames')\n                const assemblyNames = [trackAssembly, readAssembly]\n                const trackId = `track-${Date.now()}`\n                const trackName = `${readName}_vs_${trackAssembly}`\n                const supplementaryAlignments = SA.split(';')\n                  .filter(aln => !!aln)\n                  .map((aln, index) => {\n                    const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n                    const saLengthOnRef = getLengthOnRef(saCigar)\n                    const saLength = getLength(saCigar)\n                    const saLengthSansClipping = getLengthSansClipping(saCigar)\n                    const saStrandNormalized = saStrand === '-' ? -1 : 1\n                    const saClipPos = getClip(saCigar, saStrandNormalized)\n                    const saRealStart = +saStart - 1\n                    return {\n                      refName: saRef,\n                      start: saRealStart,\n                      end: saRealStart + saLengthOnRef,\n                      seqLength: saLength,\n                      clipPos: saClipPos,\n                      CIGAR: saCigar,\n                      assemblyName: trackAssembly,\n                      strand: saStrandNormalized,\n                      uniqueId: `${feature.id()}_SA${index}`,\n                      mate: {\n                        start: saClipPos,\n                        end: saClipPos + saLengthSansClipping,\n                        refName: readName,\n                      },\n                    }\n                  })\n\n                const feat = feature.toJSON()\n                feat.mate = {\n                  refName: readName,\n                  start: clipPos,\n                  end: clipPos + getLengthSansClipping(cigar),\n                }\n\n                // if secondary alignment or supplementary, calculate length\n                // from SA[0]'s CIGAR which is the primary alignments.\n                // otherwise it is the primary alignment just use seq.length if\n                // primary alignment\n                const totalLength = getLength(\n                  flags & 2048 ? supplementaryAlignments[0].CIGAR : cigar,\n                )\n\n                const features = [\n                  feat,\n                  ...supplementaryAlignments,\n                ] as ReducedFeature[]\n\n                features.sort((a, b) => a.clipPos - b.clipPos)\n\n                const refLength = features.reduce(\n                  (a, f) => a + f.end - f.start,\n                  0,\n                )\n\n                session.addView('DotplotView', {\n                  type: 'DotplotView',\n                  hview: {\n                    offsetPx: 0,\n                    bpPerPx: refLength / 800,\n                    minimumBlockWidth: 0,\n                    interRegionPaddingWidth: 0,\n                    displayedRegions: features.map(f => {\n                      return {\n                        start: f.start,\n                        end: f.end,\n                        refName: f.refName,\n                        assemblyName: trackAssembly,\n                      }\n                    }),\n                  },\n                  vview: {\n                    offsetPx: 0,\n                    bpPerPx: totalLength / 400,\n                    minimumBlockWidth: 0,\n                    interRegionPaddingWidth: 0,\n                    displayedRegions: [\n                      {\n                        assemblyName: readAssembly,\n                        start: 0,\n                        end: totalLength,\n                        refName: readName,\n                      },\n                    ],\n                  },\n                  viewTrackConfigs: [\n                    {\n                      type: 'SyntenyTrack',\n                      assemblyNames,\n                      adapter: {\n                        type: 'FromConfigAdapter',\n                        features,\n                      },\n                      trackId,\n                      name: trackName,\n                    },\n                  ],\n                  viewAssemblyConfigs: [\n                    {\n                      name: readAssembly,\n                      sequence: {\n                        type: 'ReferenceSequenceTrack',\n                        trackId: `${readName}_${Date.now()}`,\n                        adapter: {\n                          type: 'FromConfigSequenceAdapter',\n                          features: [feature.toJSON()],\n                        },\n                      },\n                    },\n                  ],\n                  assemblyNames,\n                  tracks: [\n                    {\n                      configuration: trackId,\n                      type: 'SyntenyTrack',\n                      displays: [\n                        {\n                          type: 'DotplotDisplay',\n                          configuration: `${trackId}-DotplotDisplay`,\n                        },\n                      ],\n                    },\n                  ],\n                  displayName: `${readName} vs ${trackAssembly}`,\n                })\n              },\n            },\n          ]\n        : []\n    }\n    function addContextMenu(view: View) {\n      if (view.type === 'LinearGenomeView') {\n        view.tracks.forEach(track => {\n          if (track.type === 'AlignmentsTrack') {\n            track.displays.forEach(display => {\n              if (\n                display.type === 'LinearPileupDisplay' &&\n                !display.additionalContextMenuItemCallbacks.includes(cb)\n              ) {\n                display.addAdditionalContextMenuItemCallback(cb)\n              } else if (\n                display.type === 'LinearAlignmentsDisplay' &&\n                display.PileupDisplay &&\n                !display.PileupDisplay.additionalContextMenuItemCallbacks.includes(\n                  cb,\n                )\n              ) {\n                display.PileupDisplay.addAdditionalContextMenuItemCallback(cb)\n              }\n            })\n          }\n        })\n      }\n    }\n    autorun(() => {\n      const session = pluginManager.rootModel?.session as Session | undefined\n      if (session) {\n        session.views.forEach(view => {\n          if (view.views) {\n            view.views.forEach(v => addContextMenu(v))\n          } else {\n            addContextMenu(view)\n          }\n        })\n      }\n    })\n  }\n}\n","import { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\nfunction makeFilters(displayModel) {\n  const filters = []\n  const { filterOut } = displayModel\n  for (const attrName of filterOut.keys()) {\n    for (const value of filterOut.get(attrName).keys()) {\n      if (filterOut.get(attrName).get(value)) {\n        filters.push(`jexl:get(feature,'${attrName}') != '${value}'`)\n      }\n    }\n  }\n  return filters\n}\n\nexport default configSchema => {\n  return types.compose(\n    'LinearFilteringDisplay',\n    BaseLinearDisplay,\n    types\n      .model({\n        type: types.literal('LinearFilteringDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        hideExpressions: types.optional(types.array(types.string), () => []),\n        height: 193,\n        filterControlsHeight: 70,\n        dragHandleHeight: 3,\n        filterOut: types.map(types.map(types.boolean)), // model[attrName][value] = true if filtering out\n      })\n      .views(self => ({\n        get renderProps() {\n          const filters = makeFilters(self)\n          return {\n            ...getParentRenderProps(self),\n            ...this.composedRenderProps,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            config: self.configuration.renderer,\n            filters,\n          }\n        },\n        get innerDisplayHeight() {\n          return self.height - self.dragHandleHeight - self.filterControlsHeight\n        },\n        get filterControlsMinHeight() {\n          return Math.min(self.filterControlsMaxHeight, 40)\n        },\n        get filterControlsMaxHeight() {\n          return Math.max(self.height - 20, 0)\n        },\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }))\n      .actions(self => ({\n        setFilterControlsHeight(newHeight) {\n          if (newHeight > self.filterControlsMinHeight) {\n            if (newHeight < self.filterControlsMaxHeight) {\n              self.filterControlsHeight = newHeight\n            } else {\n              self.filterControlsHeight = self.filterControlsMaxHeight\n            }\n          } else {\n            self.filterControlsHeight = self.filterControlsMinHeight\n          }\n          return self.filterControlsHeight\n        },\n        resizeFilterControls(distance) {\n          const oldHeight = self.filterControlsHeight\n          const newHeight = self.setFilterControlsHeight(\n            self.filterControlsHeight - distance,\n          )\n          return oldHeight - newHeight\n        },\n        toggleFilter(attrName, value, checked) {\n          if (!self.filterOut.has(attrName)) {\n            self.filterOut.set(attrName, {})\n          }\n          const values = self.filterOut.get(attrName)\n          values.set(String(value), !checked)\n        },\n      })),\n  )\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport { withStyles } from '@material-ui/core/styles'\nimport Typography from '@material-ui/core/Typography'\nimport { reaction } from 'mobx'\nimport { observer, PropTypes as MxPropTypes } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React, { Component } from 'react'\n\nconst styles = theme => ({\n  root: {\n    background: theme.palette.background.default,\n    overflow: 'auto',\n    paddingTop: 0,\n    paddingBottom: theme.spacing(1),\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1),\n    display: 'flex',\n    flexWrap: 'wrap',\n  },\n  header: {\n    width: '100%',\n  },\n  title: {\n    // fontSize: '80%',\n  },\n})\n\nfunction visibleValues(model, attrName) {\n  const { features, filterOut } = model\n  const values = new Set()\n  for (const feature of features.values()) {\n    values.add(feature.get(attrName))\n  }\n  if (filterOut.has(attrName)) {\n    for (const value of filterOut.get(attrName).keys()) {\n      values.add(value)\n    }\n  }\n  return Array.from(values.values()).sort()\n}\n\nconst AttributeFilter = withStyles(styles)(\n  observer(({ attrName, model, classes, values }) => (\n    <FormControl component=\"fieldset\" className={classes.formControl}>\n      <FormLabel component=\"legend\">{attrName}</FormLabel>\n      <FormGroup row>\n        {!values.length ? (\n          <FormHelperText style={{ marginRight: '1em' }}>\n            no values seen yet\n          </FormHelperText>\n        ) : (\n          values.map(value => (\n            <FormControlLabel\n              key={`${attrName}-${value}`}\n              control={\n                <Checkbox\n                  checked={\n                    !(\n                      model.filterOut.has(attrName) &&\n                      model.filterOut.get(attrName).get(String(value))\n                    )\n                  }\n                  onChange={evt =>\n                    model.toggleFilter(attrName, value, evt.target.checked)\n                  }\n                />\n              }\n              label={value}\n            />\n          ))\n        )}\n      </FormGroup>\n    </FormControl>\n  )),\n)\n\nAttributeFilter.propTypes = {\n  attrName: ReactPropTypes.string.isRequired,\n  model: MxPropTypes.objectOrObservableObject.isRequired,\n  values: ReactPropTypes.arrayOf(ReactPropTypes.string).isRequired,\n}\n\nclass FilterControls extends Component {\n  constructor(props) {\n    super(props)\n    this.state = { seenAttributes: {} }\n    const { model } = props\n    this.autorunDisposer = reaction(\n      () => {\n        const newSeenAttributes = {}\n        getConf(model, 'filterAttributes').forEach(attrName => {\n          if (!newSeenAttributes[attrName]) {\n            newSeenAttributes[attrName] = {}\n          }\n          visibleValues(model, attrName).forEach(value => {\n            newSeenAttributes[attrName][value] = true\n          })\n        })\n        return newSeenAttributes\n      },\n      newSeenAttributes => {\n        this.setState(state => {\n          const seenAttributes = {}\n          Object.keys(newSeenAttributes).forEach(attrName => {\n            seenAttributes[attrName] = {\n              ...(state.seenAttributes[attrName] || {}),\n              ...newSeenAttributes[attrName],\n            }\n          })\n          return { seenAttributes }\n        })\n      },\n      { delay: 400 },\n    )\n  }\n\n  componentWillUnmount() {\n    this.autorunDisposer()\n  }\n\n  render() {\n    const { classes, style, model } = this.props\n    const { seenAttributes } = this.state\n    return (\n      <div style={style} className={classes.root}>\n        <div className={classes.header}>\n          <Typography\n            className={classes.title}\n            variant=\"subtitle2\"\n            gutterBottom\n          >\n            Filters\n          </Typography>\n        </div>\n        {Object.keys(seenAttributes)\n          .sort()\n          .map(attrName => (\n            <AttributeFilter\n              key={attrName}\n              attrName={attrName}\n              model={model}\n              values={Object.keys(seenAttributes[attrName]).sort()}\n            />\n          ))}\n      </div>\n    )\n  }\n}\nFilterControls.propTypes = {\n  classes: ReactPropTypes.shape({\n    root: ReactPropTypes.string,\n    header: ReactPropTypes.string,\n    title: ReactPropTypes.string,\n  }).isRequired,\n  style: ReactPropTypes.shape({ height: ReactPropTypes.any }),\n  model: MxPropTypes.objectOrObservableObject.isRequired,\n}\n\nFilterControls.defaultProps = { style: {} }\n\nexport default withStyles(styles)(observer(FilterControls))\n","import { ResizeHandle } from '@jbrowse/core/ui'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes } from 'mobx-react'\nimport React from 'react'\nimport FilterControls from './FilterControls'\n\nconst useStyles = makeStyles(theme => ({\n  display: {\n    background: 'white',\n    height: '100%',\n    overflow: 'hidden',\n  },\n  innerDisplay: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n  },\n  filterControls: {\n    background: theme.palette.background.default,\n  },\n}))\n\nfunction LinearFilteringDisplay(props) {\n  const { model } = props\n  const classes = useStyles()\n  const { innerDisplayHeight, filterControlsHeight, dragHandleHeight } = model\n  return (\n    <div className={classes.display}>\n      <div\n        className={classes.innerDisplay}\n        style={{ height: innerDisplayHeight }}\n      >\n        <BaseLinearDisplayComponent {...props} />\n      </div>\n      <ResizeHandle\n        onDrag={model.resizeFilterControls}\n        style={{\n          height: dragHandleHeight,\n          background: '#ccc',\n          boxSizing: 'border-box',\n          borderTop: '1px solid #fafafa',\n        }}\n      />\n      <FilterControls style={{ height: filterControlsHeight }} {...props} />\n    </div>\n  )\n}\n\nLinearFilteringDisplay.propTypes = {\n  model: PropTypes.observableObject.isRequired,\n}\n\nexport default observer(LinearFilteringDisplay)\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchemaFactory as linearFilteringDisplayConfigSchemaFactory,\n  modelFactory as linearFilteringDisplayModelFactory,\n  ReactComponent as LinearFilteringDisplayReactComponent,\n} from './LinearFilteringDisplay'\n\nexport default class extends Plugin {\n  name = 'FilteringTrackPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearFilteringDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearFilteringDisplay',\n        configSchema,\n        stateModel: linearFilteringDisplayModelFactory(configSchema),\n        trackType: 'FilteringTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearFilteringDisplayReactComponent,\n      })\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\nexport { default as modelFactory } from './model'\nexport { default as ReactComponent } from './components/LinearFilteringDisplay'\n\nexport function configSchemaFactory(pluginManager) {\n  return ConfigurationSchema(\n    'LinearFilteringDisplay',\n    {\n      filterAttributes: {\n        type: 'stringArray',\n        defaultValue: ['type'],\n        description: 'list of feature attributes to use for filtering',\n      },\n    },\n    {\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'Gff3TabixAdapter',\n  {\n    gffGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff.gz' },\n    },\n    index: ConfigurationSchema('Gff3TabixIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.gff.gz.tbi' },\n      },\n    }),\n    dontRedispatch: {\n      type: 'stringArray',\n      defaultValue: ['chromosome', 'region'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport { configSchema as gff3TabixAdapterConfigSchema } from './Gff3TabixAdapter'\n\nexport default class extends Plugin {\n  name = 'GFF3TabixPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'Gff3TabixAdapter',\n          configSchema: gff3TabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./Gff3TabixAdapter/Gff3TabixAdapter').then(r => r.default),\n        }),\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'NCListAdapter',\n  {\n    rootUrlTemplate: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my/{refseq}/trackData.json' },\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of refNames used by the NCList used for aliasing',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'JBrowse1Connection',\n  {\n    dataDirLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'http://mysite.com/jbrowse/data/' },\n      description:\n        'the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/',\n    },\n    assemblyNames: {\n      description:\n        'name of the assembly the connection belongs to, should be a single entry',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","import getValue from 'get-value'\nimport { Track, Source } from './types'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isTrack(arg: any): arg is Track {\n  return arg && arg.label && typeof arg.label === 'string'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isSource(arg: any): arg is Source {\n  return arg && arg.url && typeof arg.url === 'string'\n}\n\n/**\n * updates a with values from b, recursively\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype Obj = Record<string, any>\nexport function deepUpdate(a: Obj, b: Obj): Obj {\n  for (const prop of Object.keys(b)) {\n    if (\n      prop in a &&\n      typeof b[prop] === 'object' &&\n      typeof a[prop] === 'object'\n    ) {\n      deepUpdate(a[prop], b[prop])\n    } else if (\n      typeof a[prop] === 'undefined' ||\n      typeof b[prop] !== 'undefined'\n    ) {\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * replace variables in a template string with values\n * @param template - String with variable names in curly brackets\n * e.g., `http://foo/{bar}?arg={baz.foo}`\n * @param fillWith - object with attribute-value mappings\n * e.g., `{ 'bar': 'someurl', 'baz': { 'foo': 42 } }`\n * @returns the template string with variables in fillWith replaced\n * e.g., 'htp://foo/someurl?arg=valueforbaz'\n */\nexport function fillTemplate(template: string, fillWith: Obj): string {\n  return template.replace(\n    /\\{([\\w\\s.]+)\\}/g,\n    (match, varName: string): string => {\n      varName = varName.replace(/\\s+/g, '') // remove all whitespace\n      const fill = getValue(fillWith, varName)\n      if (fill !== undefined) {\n        if (typeof fill === 'function') {\n          return fill(varName)\n        }\n        return fill\n      }\n      if (fillWith.callback) {\n        // @ts-ignore\n        const v = fillWith.callback.call(this, varName)\n        if (v !== undefined) {\n          return v\n        }\n      }\n      return match\n    },\n  )\n}\n\n/**\n * Clones objects (including DOM nodes) and all children.\n * Warning: do not clone cyclic structures\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n * @param src - The object to clone\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function clone(src: any): any {\n  if (\n    !src ||\n    typeof src !== 'object' ||\n    Object.prototype.toString.call(src) === '[object Function]'\n  ) {\n    // null, undefined, any non-object, or function\n    return src // anything\n  }\n  if (src.nodeType && 'cloneNode' in src) {\n    // DOM Node\n    return src.cloneNode(true) // Node\n  }\n  if (src instanceof Date) {\n    // Date\n    return new Date(src.getTime()) // Date\n  }\n  if (src instanceof RegExp) {\n    // RegExp\n    return new RegExp(src) // RegExp\n  }\n  let r\n  let i\n  let l\n  if (Array.isArray(src)) {\n    // array\n    r = []\n    for (i = 0, l = src.length; i < l; ++i) {\n      if (i in src) {\n        r[i] = clone(src[i])\n      }\n    }\n    // we don't clone functions for performance reasons\n    //    }else if(d.isFunction(src)){\n    //      // function\n    //      r = function(){ return src.apply(this, arguments); };\n  } else {\n    // generic objects\n    r = src.constructor ? new src.constructor() : {}\n  }\n  return mixin(r, src, clone)\n}\n\n/**\n * Copies/adds all properties of source to dest; returns dest.\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n *\n * All properties, including functions (sometimes termed \"methods\"), excluding\n * any non-standard extensions found in Object.prototype, are copied/added to\n * dest. Copying/adding each particular property is delegated to copyFunc\n * (if any); copyFunc defaults to the Javascript assignment operator if not\n * provided. Notice that by default, mixin executes a so-called \"shallow copy\"\n * and aggregate types are copied/added by reference.\n * @param dest - The object to which to copy/add all properties contained in\n * source.\n * @param source - The object from which to draw all properties to copy into dest.\n * @param copyFunc - The process used to copy/add a property in source; defaults\n * to the Javascript assignment operator.\n * @returns dest, as modified\n */\nfunction mixin(dest: Obj, source: Obj, copyFunc: Function): Obj {\n  let name\n  let s\n  const empty = {}\n  for (name in source) {\n    // the (!(name in empty) || empty[name] !== s) condition avoids copying\n    // properties in \"source\" inherited from Object.prototype.\t For example,\n    // if dest has a custom toString() method, don't overwrite it with the\n    // toString() method that source inherited from Object.prototype\n    s = source[name]\n    if (\n      !(name in dest) ||\n      // @ts-ignore\n      (dest[name] !== s && (!(name in empty) || empty[name] !== s))\n    ) {\n      dest[name] = copyFunc ? copyFunc(s) : s\n    }\n  }\n\n  return dest // Object\n}\n","/* eslint no-cond-assign: [\"error\", \"except-parens\"] */\nimport getValue from 'get-value'\nimport setValue from 'set-value'\nimport { objectHash } from '@jbrowse/core/util'\nimport { isSource, isTrack } from './util'\nimport { Config, Track, Source, Store, Names } from './types'\n\nexport function parseJB1Json(config: Config | string, url: string): Config {\n  if (typeof config === 'string') {\n    let parsedConf\n    try {\n      parsedConf = JSON.parse(config)\n    } catch (error) {\n      throw new Error(`${error} when parsing configuration.`)\n    }\n    return regularizeConf(parsedConf, url)\n  }\n  return regularizeConf(config, url)\n}\n\nexport function parseJB1Conf(config: string, url: string): Config {\n  let parsedConf\n  try {\n    parsedConf = parse(config, url)\n  } catch (error) {\n    throw new Error(`${error} when parsing configuration.`)\n  }\n  return regularizeConf(parsedConf, url)\n}\n\nfunction isAlwaysArray(varName: string): boolean {\n  if (varName === 'include') {\n    return true\n  }\n  return false\n}\n\nfunction parse(text: string, url: string): Config {\n  let section: string[] = []\n  let keyPath: string[] | undefined\n  let operation: string\n  let value: string | undefined\n  const data: Config = { tracks: {} }\n  let lineNumber: number\n\n  function recordVal(): void {\n    if (value !== undefined) {\n      let parsedValue:\n        | string\n        | number\n        | boolean\n        | string[]\n        | number[]\n        | boolean[]\n      try {\n        // parse json\n        const match = value.match(/^json:(.+)/i)\n        if (match) {\n          parsedValue = JSON.parse(match[1])\n        }\n        // parse numbers if it looks numeric\n        else if (/^[+-]?[\\d.,]+([eE][-+]?\\d+)?$/.test(value)) {\n          parsedValue = parseFloat(value.replace(/,/g, ''))\n        } else {\n          parsedValue = value\n        }\n\n        if (!keyPath) {\n          throw new Error(`Error parsing in section ${section.join(' - ')}`)\n        }\n        const path = section.concat(keyPath).join('.')\n        if (operation === '+=') {\n          let existing = getValue(data, path)\n          if (existing) {\n            if (!Array.isArray(existing)) {\n              existing = [existing]\n            }\n          } else {\n            existing = []\n          }\n\n          existing.push(parsedValue)\n          parsedValue = existing\n        }\n        if (parsedValue === 'true') {\n          parsedValue = true\n        }\n        if (parsedValue === 'false') {\n          parsedValue = false\n        }\n        setValue(data, path, parsedValue)\n      } catch (e) {\n        throw new Error(\n          `syntax error${url ? ` in ${url}` : ''}${\n            lineNumber ? ` at line ${lineNumber - 1}` : ''\n          }`,\n        )\n      }\n    }\n  }\n\n  text.split('\\n').forEach((textLine, i): void => {\n    lineNumber = i + 1\n    const line = textLine.replace(/^\\s*#.+/, '')\n\n    // new section\n    let match: RegExpMatchArray | null\n    if ((match = line.match(/^\\s*\\[([^\\]]+)/))) {\n      // new section\n      recordVal()\n      keyPath = undefined\n      value = undefined\n      section = match[1].trim().split(/\\s*\\.\\s*/)\n      if (section.length === 1 && section[0].toLowerCase() === 'general') {\n        section = []\n      }\n    }\n    // new value\n    else if (\n      (match = line.match(\n        value === undefined ? /^([^+=]+)(\\+?=)(.*)/ : /^(\\S[^+=]+)(\\+?=)(.*)/,\n      ))\n    ) {\n      recordVal()\n      keyPath = match[1].trim().split(/\\s*\\.\\s*/)\n      ;[, , operation] = match\n      if (isAlwaysArray(section.concat(keyPath).join('.'))) {\n        operation = '+='\n      }\n      value = match[3].trim()\n    }\n    // add to existing array value\n    else if (\n      keyPath !== undefined &&\n      (match = line.match(/^\\s{0,4}\\+\\s*(.+)/))\n    ) {\n      recordVal()\n      operation = '+='\n      value = match[1].trim()\n    }\n    // add to existing value\n    else if (value !== undefined && (match = line.match(/^\\s+(\\S.*)/))) {\n      value += value.length ? ` ${match[1].trim()}` : match[1].trim()\n    }\n    // done with last value\n    else {\n      recordVal()\n      keyPath = undefined\n      value = undefined\n    }\n  })\n\n  recordVal()\n\n  return data\n}\n\n/**\n * Applies defaults and any other necessary tweaks to the loaded configuration.\n * @param conf - the object containing the configuration, which it modifies\n * in-place\n * @param url - URL of the config file\n * @returns the same object it was passed\n */\nexport function regularizeConf(conf: Config, url: string): Config {\n  // if tracks is not an array, convert it to one\n  if (conf.tracks && !Array.isArray(conf.tracks)) {\n    // if it's a single track config, wrap it in an arrayref\n    if (isTrack(conf.tracks)) {\n      conf.tracks = [conf.tracks]\n    }\n    // otherwise, coerce it to an array\n    else {\n      const tracks: Track[] = []\n      for (const label of Object.keys(conf.tracks)) {\n        const track = conf.tracks[label]\n        if (isTrack(track)) {\n          tracks.push(track)\n        } else {\n          tracks.push({ label, ...track })\n        }\n      }\n      conf.tracks = tracks\n    }\n  }\n\n  // regularize trackMetadata.sources\n  const meta = conf.trackMetadata\n  if (meta && meta.sources) {\n    // if it's a single source config, wrap it in an arrayref\n    if (typeof meta.sources === 'string') {\n      meta.sources = [meta.sources]\n    }\n    if (isSource(meta.sources)) {\n      meta.sources = [meta.sources]\n    }\n\n    if (!Array.isArray(meta.sources)) {\n      const sources: Source[] = []\n      for (const name of Object.keys(meta.sources)) {\n        const source = meta.sources[name]\n        if (!('name' in source)) {\n          source.name = name\n        }\n        sources.push(source)\n      }\n      meta.sources = sources\n    }\n\n    // coerce any string source defs to be URLs, and try to detect their types\n    meta.sources = meta.sources.map(\n      (sourceDef: string | Source): Source => {\n        if (typeof sourceDef === 'string') {\n          const newSourceDef: Source = { url: sourceDef }\n          const typeMatch = sourceDef.match(/\\.(\\w+)$/)\n          if (typeMatch) {\n            newSourceDef.type = typeMatch[1].toLowerCase()\n          }\n          return newSourceDef\n        }\n        return sourceDef\n      },\n    )\n  }\n\n  conf.sourceUrl = conf.sourceUrl || url\n  if (conf.sourceUrl.startsWith('/')) {\n    conf.sourceUrl = new URL(conf.sourceUrl, window.location.href).href\n  }\n  conf.baseUrl = conf.baseUrl || new URL('.', conf.sourceUrl).href\n  if (conf.baseUrl.length && !conf.baseUrl.endsWith('/')) {\n    conf.baseUrl += '/'\n  }\n\n  if (conf.sourceUrl) {\n    // set a default baseUrl in each of the track and store confs, and the names\n    // conf, if needed\n    const addBase: (Track | Store | Names)[] = []\n    if (conf.tracks) {\n      addBase.push(...conf.tracks)\n    }\n    if (conf.stores) {\n      addBase.push(...Object.values(conf.stores))\n    }\n    if (conf.names) {\n      addBase.push(conf.names)\n    }\n\n    addBase.forEach((t): void => {\n      if (!t.baseUrl) {\n        t.baseUrl = conf.baseUrl || '/'\n      }\n    })\n\n    // resolve the refSeqs and nameUrl if present\n    if (conf.refSeqs && typeof conf.refSeqs === 'string') {\n      conf.refSeqs = new URL(conf.refSeqs, conf.sourceUrl).href\n    }\n    if (conf.nameUrl) {\n      conf.nameUrl = new URL(conf.nameUrl, conf.sourceUrl).href\n    }\n  }\n\n  conf.stores = conf.stores || {}\n  ;(conf.tracks || []).forEach((trackConfig: Track): void => {\n    // if there is a `config` subpart, just copy its keys in to the top-level\n    // config\n    if (trackConfig.config) {\n      const c = trackConfig.config\n      delete trackConfig.config\n      trackConfig = { ...c, ...trackConfig }\n    }\n\n    // skip if it's a new-style track def\n    if (trackConfig.store) {\n      return\n    }\n\n    let trackClassName: string\n    if (trackConfig.type === 'FeatureTrack') {\n      trackClassName = 'JBrowse/View/Track/HTMLFeatures'\n    } else if (trackConfig.type === 'ImageTrack') {\n      trackClassName = 'JBrowse/View/Track/FixedImage'\n    } else if (trackConfig.type === 'ImageTrack.Wiggle') {\n      trackClassName = 'JBrowse/View/Track/FixedImage/Wiggle'\n    } else if (trackConfig.type === 'SequenceTrack') {\n      trackClassName = 'JBrowse/View/Track/Sequence'\n    } else {\n      trackClassName = regularizeClass('JBrowse/View/Track', trackConfig.type)\n    }\n\n    trackConfig.type = trackClassName\n\n    synthesizeTrackStoreConfig(conf, trackConfig)\n\n    if (trackConfig.histograms) {\n      if (!trackConfig.histograms.baseUrl) {\n        trackConfig.histograms.baseUrl = trackConfig.baseUrl\n      }\n      synthesizeTrackStoreConfig(conf, trackConfig.histograms)\n    }\n  })\n\n  return conf\n}\n\n/**\n * prefix class name with `root` if it contains no slashes\n * @param root - Prefix root\n * @param className - class name\n */\nfunction regularizeClass(root: string, className: string | undefined): string {\n  if (!className) {\n    return ''\n  }\n  if (!className.includes('/')) {\n    className = `${root}/${className}`\n  }\n  className = className.replace(/^\\//, '')\n  return className\n}\n\nfunction guessStoreClass(\n  trackConfig: Track | undefined,\n  urlTemplate: string,\n): string {\n  if (!trackConfig) {\n    return ''\n  }\n  if (trackConfig.type && trackConfig.type.includes('/FixedImage')) {\n    return `JBrowse/Store/TiledImage/Fixed${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  }\n  if (/\\.jsonz?$/i.test(urlTemplate)) {\n    return `JBrowse/Store/SeqFeature/NCList${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  }\n  if (/\\.bam$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BAM'\n  }\n  if (/\\.cram$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/CRAM'\n  }\n  if (/\\.gff3?$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/GFF3'\n  }\n  if (/\\.bed$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BED'\n  }\n  if (/\\.vcf.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/VCFTabix'\n  }\n  if (/\\.gff3?.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/GFF3Tabix'\n  }\n  if (/\\.bed.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BEDTabix'\n  }\n  if (/\\.(bw|bigwig)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BigWig'\n  }\n  if (/\\.(bb|bigbed)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BigBed'\n  }\n  if (/\\.(fa|fasta)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/IndexedFasta'\n  }\n  if (/\\.(fa|fasta)\\.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BgzipIndexedFasta'\n  }\n  if (/\\.2bit$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/TwoBit'\n  }\n  if (trackConfig.type && trackConfig.type.endsWith('/Sequence')) {\n    return 'JBrowse/Store/Sequence/StaticChunked'\n  }\n  return ''\n}\n\nfunction synthesizeTrackStoreConfig(\n  mainConf: Config,\n  trackConfig: Track,\n): void {\n  // figure out what data store class to use with the track, applying some\n  // defaults if it is not explicit in the configuration\n  const { urlTemplate = '' } = trackConfig\n\n  let storeClass: string\n  if (trackConfig.storeClass) {\n    storeClass = regularizeClass('JBrowse/Store', trackConfig.storeClass)\n  } else {\n    storeClass = guessStoreClass(trackConfig, urlTemplate)\n  }\n\n  if (!storeClass) {\n    console.warn(\n      `Unable to determine an appropriate data store to use with track '${trackConfig.label}', please explicitly specify a storeClass in the configuration.`,\n    )\n    return\n  }\n\n  // synthesize a separate store conf\n  const storeConf: Store = { ...trackConfig, type: storeClass }\n\n  // if this is the first sequence store we see, and we have no refseqs store\n  // defined explicitly, make this the refseqs store.\n  if (\n    (storeClass === 'JBrowse/Store/Sequence/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/TwoBit' ||\n      storeClass === 'JBrowse/Store/Sequence/TwoBit' ||\n      trackConfig.useAsRefSeqStore) &&\n    !(mainConf.stores && mainConf.stores.refseqs)\n  ) {\n    storeConf.name = 'refseqs'\n  } else {\n    storeConf.name = `store${objectHash(storeConf)}`\n  }\n  // record it\n  if (!mainConf.stores) {\n    mainConf.stores = {}\n  }\n  mainConf.stores[storeConf.name] = storeConf\n\n  // connect it to the track conf\n  trackConfig.store = storeConf.name\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { parseJB1Json, parseJB1Conf, regularizeConf } from './jb1ConfigParse'\nimport { clone, deepUpdate, fillTemplate } from './util'\nimport {\n  JBLocation,\n  UriLocation,\n  LocalPathLocation,\n  Config,\n  Track,\n  Include,\n} from './types'\n\nfunction isUriLocation(location: JBLocation): location is UriLocation {\n  return (location as UriLocation).uri !== undefined\n}\n\nfunction isLocalPathLocation(\n  location: JBLocation,\n): location is LocalPathLocation {\n  return (location as LocalPathLocation).localPath !== undefined\n}\n\nexport async function fetchJb1(\n  dataRoot: JBLocation = { uri: '' },\n  baseConfig: Config = {\n    include: ['{dataRoot}/trackList.json', '{dataRoot}/tracks.conf'],\n  },\n  baseConfigRoot: JBLocation = { uri: '' },\n): Promise<Config> {\n  const protocol = 'uri' in dataRoot ? 'uri' : 'localPath'\n  const dataRootReg = JSON.parse(JSON.stringify(dataRoot))\n  let dataRootLocation = ''\n  if (isUriLocation(dataRoot)) {\n    dataRootLocation = dataRoot.uri\n  }\n  if (isLocalPathLocation(dataRoot)) {\n    dataRootLocation = dataRoot.localPath\n  }\n  if (dataRootLocation.endsWith('/')) {\n    dataRootReg[protocol] = dataRootLocation.slice(\n      0,\n      dataRootLocation.length - 1,\n    )\n  }\n  if (\n    (isUriLocation(baseConfigRoot) && baseConfigRoot.uri) ||\n    (isLocalPathLocation(baseConfigRoot) && baseConfigRoot.localPath)\n  ) {\n    const baseProtocol = 'uri' in baseConfigRoot ? 'uri' : 'localPath'\n    let baseConfigLocation = ''\n    if (isUriLocation(baseConfigRoot)) {\n      baseConfigLocation = baseConfigRoot.uri\n    }\n    if (isLocalPathLocation(baseConfigRoot)) {\n      baseConfigLocation = baseConfigRoot.localPath\n    }\n    if (baseConfigLocation.endsWith('/')) {\n      baseConfigLocation = baseConfigLocation.slice(\n        0,\n        baseConfigLocation.length - 1,\n      )\n    }\n    let newConfig: Config = {}\n    for (const conf of ['jbrowse.conf', 'jbrowse_conf.json']) {\n      let fetchedConfig = null\n      try {\n        // @ts-ignore\n        fetchedConfig = await fetchConfigFile({\n          [baseProtocol]: `${baseConfigLocation}/${conf}`,\n        })\n      } catch (error) {\n        console.error(\n          `tried to access ${baseConfigLocation}/${conf}, but failed`,\n        )\n      }\n      newConfig = mergeConfigs(newConfig, fetchedConfig) || {}\n    }\n    if (dataRootReg[protocol]) {\n      newConfig.dataRoot = dataRootReg[protocol]\n    }\n    return createFinalConfig(newConfig)\n  }\n  const newConfig = regularizeConf(baseConfig, window.location.href)\n  if (dataRootReg[protocol]) {\n    newConfig.dataRoot = dataRootReg[protocol]\n  }\n  return createFinalConfig(newConfig)\n}\n\nexport async function createFinalConfig(\n  baseConfig: Config,\n  defaults = configDefaults,\n): Promise<Config> {\n  const configWithDefaults = deepUpdate(clone(defaults), baseConfig)\n  let finalConfig = await loadIncludes(configWithDefaults)\n  finalConfig = mergeConfigs(finalConfig, baseConfig) || finalConfig\n  fillTemplates(finalConfig, finalConfig)\n  validateConfig(finalConfig)\n  return finalConfig\n}\n\nexport async function fetchConfigFile(location: JBLocation): Promise<Config> {\n  const result = await openLocation(location).readFile('utf8')\n  if (typeof result !== 'string') {\n    throw new Error(`Error opening location: ${location}`)\n  }\n  if (isUriLocation(location)) {\n    return parseJb1(result, location.uri)\n  }\n  if (isLocalPathLocation(location)) {\n    return parseJb1(result, location.localPath)\n  }\n  return parseJb1(result)\n}\n\nexport function parseJb1(config: string, url = ''): Config {\n  if (config.trim().startsWith('{')) {\n    return parseJB1Json(config, url)\n  }\n  return parseJB1Conf(config, url)\n}\n\n/**\n * Merges config object b into a. Properties in b override those in a.\n */\nfunction mergeConfigs(a: Config | null, b: Config | null): Config | null {\n  if (b === null) {\n    return null\n  }\n\n  if (a === null) {\n    a = {}\n  }\n\n  for (const prop of Object.keys(b)) {\n    if (prop === 'tracks' && prop in a) {\n      const aTracks = a[prop] || []\n      const bTracks = b[prop] || []\n      if (Array.isArray(aTracks) && Array.isArray(bTracks)) {\n        a[prop] = mergeTrackConfigs(aTracks || [], bTracks || [])\n      } else {\n        throw new Error(\n          `Track config has not been properly regularized: ${aTracks} ${bTracks}`,\n        )\n      }\n    } else if (\n      !noRecursiveMerge(prop) &&\n      prop in a &&\n      // @ts-ignore\n      typeof b[prop] === 'object' &&\n      // @ts-ignore\n      typeof a[prop] === 'object'\n    ) {\n      // @ts-ignore\n      a[prop] = deepUpdate(a[prop], b[prop])\n    } else if (prop === 'dataRoot') {\n      if (\n        a[prop] === undefined ||\n        (a[prop] === 'data' && b[prop] !== undefined)\n      ) {\n        a[prop] = b[prop]\n      }\n      // @ts-ignore\n    } else if (a[prop] === undefined || b[prop] !== undefined) {\n      // @ts-ignore\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * Special-case merging of two `tracks` configuration arrays.\n */\nfunction mergeTrackConfigs(a: Track[], b: Track[]): Track[] {\n  if (!b.length) {\n    return a\n  }\n\n  // index the tracks in `a` by track label\n  const aTracks: Record<string, Track> = {}\n  a.forEach((t, i): void => {\n    t.index = i\n    aTracks[t.label] = t\n  })\n\n  b.forEach((bT): void => {\n    const aT = aTracks[bT.label]\n    if (aT) {\n      mergeConfigs(aT, bT)\n    } else {\n      a.push(bT)\n    }\n  })\n\n  return a\n}\n\n/**\n * Recursively fetch, parse, and merge all the includes in the given config\n * object.  Calls the callback with the resulting configuration when finished.\n * @param inputConfig - Config to load includes into\n */\nasync function loadIncludes(inputConfig: Config): Promise<Config> {\n  inputConfig = clone(inputConfig)\n\n  async function loadRecur(\n    config: Config,\n    upstreamConf: Config,\n  ): Promise<Config> {\n    const sourceUrl = config.sourceUrl || config.baseUrl\n    if (!sourceUrl) {\n      throw new Error(\n        `Could not determine source URL: ${JSON.stringify(config)}`,\n      )\n    }\n    const newUpstreamConf = mergeConfigs(clone(upstreamConf), config)\n    if (!newUpstreamConf) {\n      throw new Error('Problem merging configs')\n    }\n    const includes = fillTemplates(\n      regularizeIncludes(config.include || []),\n      newUpstreamConf,\n    )\n    delete config.include\n\n    const loads = includes.map(\n      async (include): Promise<Config> => {\n        include.cacheBuster = inputConfig.cacheBuster\n        const includedData = await fetchConfigFile({\n          uri: new URL(include.url, sourceUrl).href,\n        })\n        return loadRecur(includedData, newUpstreamConf)\n      },\n    )\n    const includedDataObjects = await Promise.all(loads)\n    includedDataObjects.forEach((includedData): void => {\n      config = mergeConfigs(config, includedData) || config\n    })\n    return config\n  }\n\n  return loadRecur(inputConfig, {})\n}\n\nfunction regularizeIncludes(\n  includes: Include | string | (Include | string)[] | null,\n): Include[] {\n  if (!includes) {\n    return []\n  }\n\n  // coerce include to an array\n  if (!Array.isArray(includes)) {\n    includes = [includes]\n  }\n\n  return includes.map(\n    (include): Include => {\n      // coerce bare strings in the includes to URLs\n      if (typeof include === 'string') {\n        include = { url: include }\n      }\n\n      // set defaults for format and version\n      if (!('format' in include)) {\n        include.format = include.url.endsWith('.conf') ? 'conf' : 'JB_json'\n      }\n      if (include.format === 'JB_json' && !('version' in include)) {\n        include.version = 1\n      }\n      return include\n    },\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction fillTemplates<T extends any>(subconfig: T, config: Config): T {\n  if (!subconfig) {\n    return subconfig\n  }\n  if (Array.isArray(subconfig)) {\n    for (let i = 0; i < subconfig.length; i += 1) {\n      subconfig[i] = fillTemplates(subconfig[i], config)\n    }\n  } else if (typeof subconfig === 'object') {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const sub = subconfig as Record<string, any>\n    for (const name of Object.keys(sub)) {\n      sub[name] = fillTemplates(sub[name], config)\n    }\n  } else if (typeof subconfig === 'string') {\n    // @ts-ignore\n    return fillTemplate(subconfig, config)\n  }\n\n  return subconfig\n}\n\n/**\n * list of config properties that should not be recursively merged\n * @param propName - name of config property\n */\nfunction noRecursiveMerge(propName: string): boolean {\n  return propName === 'datasets'\n}\n\nconst configDefaults = {\n  tracks: [],\n\n  containerID: 'GenomeBrowser',\n  dataRoot: 'data',\n  show_tracklist: true,\n  show_nav: true,\n  show_menu: true,\n  show_overview: true,\n  show_fullviewlink: true,\n  update_browser_title: true,\n  updateBrowserURL: true,\n\n  refSeqs: '{dataRoot}/seq/refSeqs.json',\n  include: ['jbrowse.conf', 'jbrowse_conf.json'],\n  nameUrl: '{dataRoot}/names/root.json',\n\n  datasets: {\n    _DEFAULT_EXAMPLES: true,\n    volvox: { url: '?data=sample_data/json/volvox', name: 'Volvox Example' },\n    modencode: {\n      url: '?data=sample_data/json/modencode',\n      name: 'MODEncode Example',\n    },\n    yeast: { url: '?data=sample_data/json/yeast', name: 'Yeast Example' },\n  },\n\n  highlightSearchedRegions: false,\n  highResolutionMode: 'auto',\n}\n\n/**\n * Examine the loaded and merged configuration for errors.  Throws\n * exceptions if it finds anything amiss.\n * @returns nothing meaningful\n */\nfunction validateConfig(config: Config): void {\n  if (!config.tracks) {\n    config.tracks = []\n  }\n  if (!config.baseUrl) {\n    throw new Error('Must provide a `baseUrl` in configuration')\n  }\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { objectHash } from '@jbrowse/core/util'\nimport {\n  generateUnknownTrackConf,\n  generateUnsupportedTrackConf,\n  guessAdapter,\n  guessTrackType,\n  UNKNOWN,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\nimport { JBLocation, Track, RefSeqs, RefSeq } from './types'\n\ninterface Jb2Track {\n  trackId: string\n  name: string\n  description?: string\n  category?: string[]\n  adapter?: Jb2Adapter\n  type?: string\n  defaultRendering?: string\n}\n\ninterface Jb2Adapter {\n  type: string\n  features?: Jb2Feature[]\n  bamLocation?: Jb2Location\n  cramLocation?: Jb2Location\n  craiLocation?: Jb2Location\n  fastaLocation?: Jb2Location\n  faiLocation?: Jb2Location\n  gziLocation?: Jb2Location\n  twoBitLocation?: Jb2Location\n  bigWigLocation?: Jb2Location\n  bigBedLocation?: Jb2Location\n  vcfGzLocation?: Jb2Location\n  gffGzLocation?: Jb2Location\n  bedGzLocation?: Jb2Location\n  index?: { location: Jb2Location; indexType?: string }\n  rootUrlTemplate?: Jb2Location\n  sequenceAdapter?: Jb2Adapter\n}\n\ninterface Jb2Feature {\n  refName: string\n  uniqueId: string\n  start: number\n  end: number\n}\n\ninterface Jb2Location {\n  uri?: string\n  localPath?: string\n  blobId?: string\n}\n\nexport function convertTrackConfig(\n  jb1TrackConfig: Track,\n  dataRoot: string,\n  sequenceAdapter: Jb2Adapter,\n): Jb2Track {\n  const jb2TrackConfig: Jb2Track = {\n    trackId: objectHash(jb1TrackConfig),\n    name: jb1TrackConfig.key || jb1TrackConfig.label,\n  }\n\n  const description =\n    jb1TrackConfig.metadata &&\n    (jb1TrackConfig.metadata.description || jb1TrackConfig.metadata.Description)\n  if (description) {\n    jb2TrackConfig.description = description\n  }\n\n  const category =\n    jb1TrackConfig.category ||\n    (jb1TrackConfig.metadata && jb1TrackConfig.metadata.category)\n  jb2TrackConfig.category = category ? category.split(/\\s*\\/\\s*/) : []\n\n  const { storeClass } = jb1TrackConfig\n  if (!jb1TrackConfig.urlTemplate) {\n    if (!(storeClass && storeClass.endsWith('FromConfig'))) {\n      const trackIdentifier = jb1TrackConfig.key || jb1TrackConfig.label\n      console.warn(\n        `Could not import JBrowse1 track \"${trackIdentifier}\" because it does not have a \"urlTemplate\" or is not a \"FromConfig\" track`,\n      )\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        trackIdentifier,\n        jb2TrackConfig.category,\n      )\n    }\n    return generateFromConfigTrackConfig(jb1TrackConfig, jb2TrackConfig)\n  }\n\n  const resolveUrlTemplate = (urlTemplate: string) => {\n    return new URL(urlTemplate, `${dataRoot}/`).href\n      .replace(/%7B/gi, '{')\n      .replace(/%7D/gi, '}')\n  }\n  const urlTemplate = resolveUrlTemplate(jb1TrackConfig.urlTemplate)\n\n  if (storeClass) {\n    if (storeClass === 'JBrowse/Store/SeqFeature/BAM') {\n      const adapter: Jb2Adapter = {\n        type: 'BamAdapter',\n        bamLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.baiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.baiUrlTemplate) },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate) },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = { location: { uri: `${urlTemplate}.bai` } }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/CRAM') {\n      const adapter: Jb2Adapter = {\n        type: 'CramAdapter',\n        cramLocation: { uri: urlTemplate },\n        sequenceAdapter,\n      }\n      if (jb1TrackConfig.craiUrlTemplate) {\n        adapter.craiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.craiUrlTemplate),\n        }\n      } else {\n        adapter.craiLocation = { uri: `${urlTemplate}.crai` }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/NCList') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'NCListAdapter',\n          rootUrlTemplate: { uri: urlTemplate },\n        },\n      }\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/BigWig' ||\n      storeClass === 'JBrowse/Store/BigWig'\n    ) {\n      if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n        jb2TrackConfig.defaultRendering = 'xyplot'\n      } else if (\n        jb1TrackConfig.type &&\n        jb1TrackConfig.type.endsWith('Density')\n      ) {\n        jb2TrackConfig.defaultRendering = 'density'\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'QuantitativeTrack',\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: { uri: urlTemplate },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTabix') {\n      const adapter: Jb2Adapter = {\n        type: 'VcfTabixAdapter',\n        vcfGzLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate) },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate) },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = { location: { uri: `${urlTemplate}.tbi` } }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'VariantTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTribble') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `VCFTribble (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `GFF3 (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BigBed') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: { uri: urlTemplate },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3Tabix') {\n      const adapter: Jb2Adapter = {\n        type: 'Gff3TabixAdapter',\n        gffGzLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate) },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate) },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = { location: { uri: `${urlTemplate}.tbi` } }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BED') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `BED (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BEDTabix') {\n      const adapter: Jb2Adapter = {\n        type: 'BedTabixAdapter',\n        bedGzLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate) },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: { uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate) },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = { location: { uri: `${urlTemplate}.tbi` } }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GTF') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `GTF (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/StaticChunked'\n    ) {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `StaticChunked (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/UnindexedFasta') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `UnindexedFasta (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.faiUrlTemplate) {\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n        }\n      } else {\n        adapter.faiLocation = { uri: `${urlTemplate}.fai` }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'SequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'BgzipFastaAdapter',\n        fastaLocation: { uri: urlTemplate },\n      }\n      if (jb1TrackConfig.faiUrlTemplate) {\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n        }\n      } else {\n        adapter.faiLocation = { uri: `${urlTemplate}.fai` }\n      }\n      if (jb1TrackConfig.gziUrlTemplate) {\n        adapter.gziLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.gziUrlTemplate),\n        }\n      } else {\n        adapter.gziLocation = { uri: `${urlTemplate}.gzi` }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/TwoBit') {\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter: {\n          type: 'TwoBitAdapter',\n          twoBitLocation: { uri: urlTemplate },\n        },\n      }\n    }\n  }\n\n  // If we don't recogize the store class, make a best effort to guess by file type\n  jb2TrackConfig.adapter = guessAdapter(\n    { uri: urlTemplate },\n    undefined,\n    () => urlTemplate,\n  )\n  if (!jb2TrackConfig.adapter) {\n    throw new Error('Could not determine adapter')\n  }\n\n  if (jb2TrackConfig.adapter.type === UNSUPPORTED) {\n    return generateUnsupportedTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n  if (jb2TrackConfig.adapter.type === UNKNOWN) {\n    return generateUnknownTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n\n  jb2TrackConfig.type = guessTrackType(jb2TrackConfig.adapter.type)\n\n  if (jb2TrackConfig.type === 'QuantitativeTrack') {\n    if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n      jb2TrackConfig.defaultRendering = 'xyplot'\n    } else if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('Density')) {\n      jb2TrackConfig.defaultRendering = 'density'\n    }\n  }\n\n  return jb2TrackConfig\n}\n\nfunction generateFromConfigTrackConfig(\n  jb1TrackConfig: Track,\n  jb2TrackConfig: Jb2Track,\n): Jb2Track {\n  const jb1Features = jb1TrackConfig.features || []\n  const jb2Features = jb1Features.map(\n    (feature): Jb2Feature => {\n      const jb2Feature: Jb2Feature = JSON.parse(JSON.stringify(feature))\n      jb2Feature.refName = feature.seq_id\n      jb2Feature.uniqueId = `${feature.seq_id}:${feature.start}-${\n        feature.end\n      }:${feature.name || ''}`\n      return jb2Feature\n    },\n  )\n  jb2TrackConfig.adapter = {\n    type: 'FromConfigAdapter',\n    features: jb2Features,\n  }\n  jb2TrackConfig.type = 'FeatureTrack'\n  return jb2TrackConfig\n}\n\nexport async function createRefSeqsAdapter(\n  refSeqs: string | RefSeqs,\n): Promise<Jb2Adapter> {\n  if (typeof refSeqs === 'string') {\n    // assume refSeqs is a url if it is string\n    refSeqs = {\n      url: refSeqs,\n    }\n  }\n\n  // check refseq urls\n  if (refSeqs.url) {\n    if (refSeqs.url.match(/.fai$/)) {\n      return {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: {\n          uri: refSeqs.url.slice(0, -4),\n        },\n        faiLocation: {\n          uri: refSeqs.url,\n        },\n      }\n    }\n    if (refSeqs.url.match(/.2bit$/)) {\n      return {\n        type: 'TwoBitAdapter',\n        twoBitLocation: { uri: refSeqs.url },\n      }\n    }\n    if (refSeqs.url.match(/.fa$/)) {\n      throw new Error('Unindexed FASTA adapter not available')\n    }\n    if (refSeqs.url.match(/.sizes/)) {\n      throw new Error('chromosome SIZES adapter not available')\n    }\n    const refSeqsJson = await openLocation({ uri: refSeqs.url }).readFile(\n      'utf8',\n    )\n    const refSeqsData: RefSeq[] = JSON.parse(refSeqsJson as string)\n    return refSeqAdapterFromConfig(refSeqsData)\n  }\n  if ('data' in refSeqs) {\n    return refSeqAdapterFromConfig(refSeqs.data || [])\n  }\n  throw new Error(\n    `Could not determine adapter for JBrowse1 refSeqs: ${\n      refSeqs.url || JSON.stringify(refSeqs)\n    }`,\n  )\n}\n\nfunction refSeqAdapterFromConfig(refSeqsData: RefSeq[]): Jb2Adapter {\n  const features = refSeqsData.map(\n    (refSeq): Jb2Feature => ({\n      refName: refSeq.name,\n      uniqueId: refSeq.name,\n      start: refSeq.start,\n      end: refSeq.end,\n    }),\n  )\n  return {\n    type: 'FromConfigAdapter',\n    features,\n  }\n}\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\n\nimport { fetchJb1 } from './jb1ConfigLoad'\nimport { convertTrackConfig } from './jb1ToJb2'\n\nexport default function (pluginManager) {\n  return types.compose(\n    'JBrowse1Connection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('JBrowse1Connection'),\n      })\n      .actions(self => ({\n        connect() {\n          const dataDirLocation = readConfObject(\n            self.configuration,\n            'dataDirLocation',\n          )\n          const session = getSession(self)\n          fetchJb1(dataDirLocation)\n            .then(config => {\n              const assemblyName = readConfObject(\n                self.configuration,\n                'assemblyNames',\n              )[0]\n              if (!assemblyName) {\n                throw new Error(\n                  'assembly name required for JBrowse 1 connection',\n                )\n              }\n              const assemblyConf = session.assemblies.find(\n                assembly => readConfObject(assembly, 'name') === assemblyName,\n              )\n              const sequenceAdapter = readConfObject(assemblyConf, [\n                'sequence',\n                'adapter',\n              ])\n              const jb2Tracks = config.tracks.map(jb1Track => {\n                const jb2Track = convertTrackConfig(\n                  jb1Track,\n                  config.dataRoot,\n                  sequenceAdapter,\n                )\n                jb2Track.assemblyNames = [assemblyName]\n                return jb2Track\n              })\n              self.setTrackConfs(jb2Tracks)\n            })\n            .catch(error => {\n              console.error(error)\n              session.notify(\n                `There was a problem connecting to the JBrowse 1 data directory \"${self.name}\". Please make sure you have entered a valid location. The error that was thrown is: \"${error}\"`,\n                'error',\n              )\n              session.breakConnection(self.configuration)\n            })\n        },\n      })),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema as ncListAdapterConfigSchema } from './NCListAdapter'\nimport {\n  configSchema as jbrowse1ConfigSchema,\n  modelFactory as jbrowse1ModelFactory,\n} from './JBrowse1Connection'\n\nexport default class LegacyJBrowsePlugin extends Plugin {\n  name = 'LegacyJBrowsePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'NCListAdapter',\n          configSchema: ncListAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./NCListAdapter/NCListAdapter').then(r => r.default),\n        }),\n    )\n\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'JBrowse1Connection',\n          configSchema: jbrowse1ConfigSchema,\n          stateModel: jbrowse1ModelFactory(pluginManager),\n          displayName: 'JBrowse 1 Data',\n          description: 'A JBrowse 1 data directory',\n          url: '//jbrowse.org/',\n        }),\n    )\n  }\n}\n","import { makeStyles } from '@material-ui/core/styles'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\n\nconst useStyles = makeStyles({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    textAlign: 'center',\n  },\n  error: {\n    display: 'block',\n    color: 'red',\n    width: '30em',\n    wordWrap: 'normal',\n    whiteSpace: 'normal',\n  },\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  })\n\n  return shown ? (\n    <div data-testid=\"loading-synteny\" className={classes.loading}>\n      Loading &hellip;\n      <LinearProgress />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const classes = useStyles()\n  return <div className={classes.blockMessage}>{messageText}</div>\n}\nBlockMessage.propTypes = {\n  messageText: PropTypes.string.isRequired,\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const classes = useStyles()\n  return <div className={classes.blockError}>{error.message}</div>\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst ServerSideRenderedBlockContent = observer(({ model }: { model: any }) => {\n  if (model.error) {\n    return <BlockError error={model.error} />\n  }\n  if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  }\n  if (!model.filled) {\n    return <LoadingMessage />\n  }\n  return model.reactElement\n})\n\nexport default ServerSideRenderedBlockContent\n","import { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { LinearComparativeDisplay as LCD } from '..'\n\nconst LinearComparativeDisplay: React.FC<{\n  model: LCD\n  children?: React.ReactNode\n}> = props => {\n  const { model, children } = props\n  return (\n    <div>\n      <model.ReactComponent2 {...props} />\n      {children}\n    </div>\n  )\n}\nLinearComparativeDisplay.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  children: PropTypes.element,\n}\n\nLinearComparativeDisplay.defaultProps = {\n  children: null,\n}\nexport default observer(LinearComparativeDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  getConf,\n  readConfObject,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport React from 'react'\nimport { LinearComparativeViewModel } from '../LinearComparativeView/model'\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\n\nexport { default as ReactComponent } from './components/LinearComparativeDisplay'\n\nexport function configSchemaFactory(pluginManager: any) {\n  return ConfigurationSchema(\n    'LinearComparativeDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport function stateModelFactory(configSchema: any) {\n  return types\n    .compose(\n      'LinearComparativeDisplay',\n      BaseDisplay,\n      types.model({\n        type: types.literal('LinearComparativeDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        height: 100,\n      }),\n    )\n    .volatile((/* self */) => ({\n      renderInProgress: undefined as AbortController | undefined,\n      filled: false,\n      data: undefined as any,\n      reactElement: undefined as React.ReactElement | undefined,\n      message: undefined as string | undefined,\n      renderingComponent: undefined as any,\n      ReactComponent2: (ServerSideRenderedBlockContent as unknown) as React.FC,\n    }))\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, 'renderer').type\n      },\n      get renderProps() {\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self as any,\n            renderBlockData as any,\n            renderBlockEffect as any,\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 1000,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        setRendered(args: {\n          data: any\n          reactElement: React.ReactElement\n          renderingComponent: React.Component\n        }) {\n          const { data, reactElement, renderingComponent } = args\n          self.filled = true\n          self.message = undefined\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        setError(error: Error) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\nfunction renderBlockData(self: LinearComparativeDisplay) {\n  const { rpcManager } = getSession(self) as any\n  const display = self\n\n  const {\n    renderProps,\n    rendererType,\n  }: { renderProps: any; rendererType: any } = display\n\n  // Alternative to readConfObject(config) is below\n  // used because renderProps is something under our control.\n  // Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as LinearComparativeViewModel\n  const sessionId = getRpcSessionId(self)\n  getSnapshot(parent)\n\n  return {\n    rendererType,\n    rpcManager,\n    renderProps: {\n      ...renderProps,\n      view: getSnapshot(parent),\n    },\n    renderArgs: {\n      adapterConfig,\n      rendererType: rendererType.name,\n      sessionId,\n      timeout: 1000000,\n    },\n  }\n}\n\nasync function renderBlockEffect(props: ReturnType<typeof renderBlockData>) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const { rendererType, rpcManager, renderProps, renderArgs } = props\n\n  const { reactElement, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    {\n      ...renderArgs,\n      ...renderProps,\n    },\n  )\n\n  return { reactElement, data, renderingComponent: rendererType.ReactComponent }\n}\n\nexport type LinearComparativeDisplayModel = ReturnType<typeof stateModelFactory>\nexport type LinearComparativeDisplay = Instance<LinearComparativeDisplayModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { transaction } from 'mobx'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  types,\n  getParent,\n  onAction,\n  addDisposer,\n  Instance,\n  resolveIdentifier,\n  getPath,\n  SnapshotIn,\n  cast,\n  ISerializedActionCall,\n  getRoot,\n} from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  const { jbrequire } = pluginManager\n  const { ElementId } = jbrequire('@jbrowse/core/util/types/mst')\n\n  const defaultHeight = 400\n  return types\n    .compose(\n      'LinearComparativeView',\n      BaseViewModel,\n      types.model({\n        id: ElementId,\n        type: types.literal('LinearComparativeView'),\n        height: defaultHeight,\n        trackSelectorType: 'hierarchical',\n        showIntraviewLinks: true,\n        linkViews: false,\n        interactToggled: false,\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n\n        // this represents tracks specific to this view\n        // specifically used for read vs ref dotplots where\n        // this track would not really apply elsewhere\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      headerHeight: 0,\n      width: 800,\n    }))\n    .views(self => ({\n      get initialized() {\n        return self.views.length > 0\n      },\n\n      get refNames() {\n        return (self.views || []).map(v => [\n          ...new Set(v.staticBlocks.map(m => m.refName)),\n        ])\n      },\n\n      get assemblyNames() {\n        return [...new Set(self.views.map(v => v.assemblyNames).flat())]\n      },\n\n      // // Get a composite map of featureId->feature map for a track\n      // // across multiple views\n      //\n      // getTrackFeatures(trackIds: string[]) {\n      //   // @ts-ignore\n      //   const tracks = trackIds.map(t => resolveIdentifier(getSession(self), t))\n      //   return new CompositeMap<string, Feature>(tracks.map(t => t.features))\n      // },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(self, (param: ISerializedActionCall) => {\n            if (self.linkViews) {\n              const { name, path, args } = param\n              const actions = [\n                'horizontalScroll',\n                'zoomTo',\n                'setScaleFactor',\n                'showTrack',\n                'hideTrack',\n                'toggleTrack',\n              ]\n              if (actions.includes(name) && path) {\n                this.onSubviewAction(name, path, args)\n              }\n            }\n          }),\n        )\n      },\n\n      // automatically removes session assemblies associated with this view\n      // e.g. read vs ref\n      beforeDestroy() {\n        const session = getSession(self)\n        self.assemblyNames.forEach(name => {\n          if (name.endsWith('-temp')) {\n            session.removeAssembly?.(name)\n          }\n        })\n      },\n\n      onSubviewAction(actionName: string, path: string, args: any[] = []) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args[0])\n          }\n        })\n      },\n\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        self.views.forEach(v => v.setWidth(newWidth))\n      },\n      setHeight(newHeight: number) {\n        self.height = newHeight\n      },\n\n      setViews(views: SnapshotIn<LinearGenomeViewModel>[]) {\n        self.views = cast(views)\n      },\n\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setHeaderHeight(height: number) {\n        self.headerHeight = height\n      },\n\n      toggleInteract() {\n        self.interactToggled = !self.interactToggled\n      },\n      toggleIntraviewLinks() {\n        self.showIntraviewLinks = !self.showIntraviewLinks\n      },\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n          return undefined\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = this.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n        }\n      },\n\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n    }))\n    .views(self => ({\n      get menuItems(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.views.forEach((view, idx) => {\n          if (view.menuItems) {\n            menuItems.push({\n              label: `View ${idx + 1} Menu`,\n              subMenu: view.menuItems,\n            })\n          }\n        })\n        menuItems.push({\n          label: 'Open track selector',\n          onClick: self.activateTrackSelector,\n          icon: TrackSelectorIcon,\n        })\n        return menuItems\n      },\n    }))\n}\n\nexport type LinearComparativeViewStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearComparativeViewModel = Instance<\n  LinearComparativeViewStateModel\n>\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport modelFactory from './model'\n\nexport default ({ jbrequire }: PluginManager) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n  return new ViewType({\n    name: 'LinearComparativeView',\n    stateModel: jbrequire(modelFactory),\n    ReactComponent: lazy(() => import('./components/LinearComparativeView')),\n  })\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport {\n  getConf,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getContainingView } from '@jbrowse/core/util'\nimport {\n  configSchemaFactory as baseConfigFactory,\n  stateModelFactory as baseModelFactory,\n} from '../LinearComparativeDisplay'\nimport { LinearSyntenyViewModel } from '../LinearSyntenyView/model'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSyntenyDisplay',\n    {\n      trackIds: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'LinearSyntenyRenderer' },\n      ),\n      middle: { type: 'boolean', defaultValue: true },\n    },\n    {\n      baseConfiguration: baseConfigFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport function stateModelFactory(\n  configSchema: ReturnType<typeof configSchemaFactory>,\n) {\n  return types\n    .compose(\n      'LinearSyntenyDisplay',\n      baseModelFactory(configSchema),\n      types.model({\n        type: types.literal('LinearSyntenyDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      get highResolutionScaling() {\n        return 1\n      },\n      get renderProps() {\n        const parentView = getContainingView(self) as LinearSyntenyViewModel\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: getConf(self, 'renderer'),\n          width: parentView.width,\n          height: 100,\n        }\n      },\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n      get adapterConfig() {\n        // TODO possibly enriches with the adapters from associated trackIds\n        return {\n          name: self.parentTrack.configuration.adapter.type,\n          assemblyNames: getConf(self, 'assemblyNames'),\n          ...getConf(self.parentTrack, 'adapter'),\n        }\n      },\n\n      get trackIds() {\n        return getConf(self, 'trackIds') as string[]\n      },\n    }))\n}\n\nexport type LinearSyntenyDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearSyntenyDisplayModel = Instance<LinearSyntenyDisplayStateModel>\n","import { clamp } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nexport type LayoutRecord = [number, number, number, number]\n\nexport interface ReducedLinearGenomeView {\n  bpPerPx: number\n  offsetPx: number\n  staticBlocks: Region[]\n  dynamicBlocks: Region[]\n  displayedRegions: Region[]\n  headerHeight: number\n  scaleBarHeight: number\n  height: number\n  features: Feature[]\n  tracks: {\n    scrollTop: number\n    height: number\n    configuration: string\n    layoutFeatures: [string, LayoutRecord][]\n    skip: number\n  }[]\n}\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nexport function cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: ReducedLinearGenomeView[],\n  trackConfigId: string,\n  level: number,\n) {\n  const heightUpUntilThisPoint = views\n    .slice(0, level)\n    .map(v => v.height + 7)\n    .reduce((a, b) => a + b, 0)\n\n  return (\n    heightUpUntilThisPoint +\n    views[level].headerHeight +\n    views[level].scaleBarHeight +\n    getTrackPos(views[level], trackConfigId) +\n    1\n  )\n}\n\nexport function getTrackPos(\n  view: ReducedLinearGenomeView,\n  trackConfigId: string,\n) {\n  const idx = view.tracks.findIndex(t => t.configuration === trackConfigId)\n  let accum = 0\n  for (let i = 0; i < idx; i += 1) {\n    accum += view.tracks[i].height + 3 // +1px for trackresizehandle\n  }\n  return accum\n}\n\n// Uses bpToPx to get the screen pixel coordinates but ignores some conditions\n// where bpToPx could return undefined\nexport function getPxFromCoordinate(\n  view: ReducedLinearGenomeView,\n  refName: string,\n  coord: number,\n) {\n  return (\n    ((bpToPx(view, { refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n  )\n}\n\n// Retrieves the y-position of a layout record in a track\n// If track not found returns 0\nexport function overlayYPos(\n  trackConfigId: string,\n  level: number,\n  views: ReducedLinearGenomeView[],\n  c: LayoutRecord,\n  cond: boolean,\n) {\n  const track = views[level].tracks.find(t => t.configuration === trackConfigId)\n  const ypos = track\n    ? clamp(c[TOP] - (track.scrollTop || 0), 0, track.height) +\n      heightFromSpecificLevel(views, trackConfigId, level) +\n      track.skip\n    : 0\n\n  return ypos + (cond ? cheight(c) : 0)\n}\n\n// Returns the pixel screen position of a refName:coord input, or undefined if\n// the input could not be located. Uses view.displayedRegions as a representation\n// of what is on the screen\n//\n// Note: does not consider that this refName:coord input could multi-match\nfunction bpToPx(\n  view: ReducedLinearGenomeView,\n  { refName, coord }: { refName: string; coord: number },\n) {\n  let offsetBp = 0\n\n  const index = view.displayedRegions.findIndex(r => {\n    if (refName === r.refName && coord >= r.start && coord <= r.end) {\n      offsetBp += coord - r.start\n      return true\n    }\n    offsetBp += r.end - r.start\n    return false\n  })\n  const foundRegion = view.displayedRegions[index]\n  if (foundRegion) {\n    return {\n      index,\n      offsetPx: Math.round(offsetBp / view.bpPerPx),\n    }\n  }\n  return undefined\n}\n\n// Returns either 0 or height depending on condition\nexport function interstitialYPos(cond: boolean, height: number) {\n  return cond ? 5 : height - 5\n}\n\nexport function* generateMatches(\n  l1: Feature[] = [],\n  l2: Feature[] = [],\n  cb: (arg0: Feature) => number,\n) {\n  let i = 0\n  let j = 0\n  while (i < l1.length && j < l2.length) {\n    const a = cb(l1[i])\n    const b = cb(l2[j])\n    if (a < b) {\n      i++\n    } else if (b < a) {\n      j++\n    } else {\n      yield [l1[i], l2[j]]\n      i++\n      j++\n    }\n  }\n}\n","import React, { useRef, useMemo, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport SimpleFeature, {\n  SimpleFeatureSerialized,\n  Feature,\n} from '@jbrowse/core/util/simpleFeature'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { interstitialYPos, overlayYPos, generateMatches } from '../../util'\nimport { LinearSyntenyViewModel } from '../../LinearSyntenyView/model'\nimport { LinearComparativeDisplay } from '../../LinearComparativeDisplay'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\ntype RectTuple = [number, number, number, number]\n\nconst { parseCigar } = MismatchParser\n\nfunction px(\n  view: LinearGenomeViewModel,\n  arg: { refName: string; coord: number },\n) {\n  return (view.bpToPx(arg) || {}).offsetPx || 0\n}\n\nfunction layoutMatches(features: Feature[][]) {\n  const matches = []\n  for (let i = 0; i < features.length; i++) {\n    for (let j = i; j < features.length; j++) {\n      if (i !== j) {\n        for (const [f1, f2] of generateMatches(features[i], features[j], feat =>\n          feat.get('syntenyId'),\n        )) {\n          matches.push([\n            {\n              feature: f1,\n              level: i,\n              refName: f1.get('refName'),\n              layout: [f1.get('start'), 0, f1.get('end'), 10] as RectTuple,\n            },\n            {\n              feature: f2,\n              level: j,\n              refName: f2.get('refName'),\n              layout: [f2.get('start'), 0, f2.get('end'), 10] as RectTuple,\n            },\n          ])\n        }\n      }\n    }\n  }\n  return matches\n}\n\n/**\n * A block whose content is rendered outside of the main thread and hydrated by\n * this component.\n */\nfunction LinearSyntenyRendering(props: {\n  width: number\n  height: number\n  displayModel: LinearComparativeDisplay\n  highResolutionScaling: number\n  features: SimpleFeatureSerialized[][]\n  trackIds: string[]\n}) {\n  const ref = useRef<HTMLCanvasElement>(null)\n  const {\n    height,\n    width,\n    displayModel = {},\n    highResolutionScaling = 1,\n    features,\n    trackIds,\n  } = props\n\n  const deserializedFeatures = useMemo(\n    () =>\n      features.map(level => {\n        return level\n          .map(f => new SimpleFeature(f))\n          .sort((a, b) => a.get('syntenyId') - b.get('syntenyId'))\n      }),\n    [features],\n  )\n  const matches = layoutMatches(deserializedFeatures)\n  const views = useMemo(() => {\n    try {\n      const parentView =\n        'type' in displayModel\n          ? (getContainingView(displayModel) as LinearSyntenyViewModel)\n          : undefined\n      return parentView?.views\n    } catch (e) {\n      console.warn('parent view gone')\n      return null\n    }\n  }, [displayModel])\n\n  const offsets = views?.map(view => view.offsetPx)\n  useEffect(() => {\n    if (!ref.current || !offsets || !views) {\n      return\n    }\n    if (!isAlive(displayModel)) {\n      return\n    }\n    const ctx = ref.current.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.clearRect(0, 0, width, height)\n    ctx.scale(highResolutionScaling, highResolutionScaling)\n    ctx.fillStyle = getConf(displayModel, ['renderer', 'color'])\n    ctx.strokeStyle = getConf(displayModel, ['renderer', 'color'])\n    const showIntraviewLinks = false\n    const middle = true\n    const hideTiny = false\n    matches.forEach(m => {\n      // we follow a path in the list of chunks, not from top to bottom, just\n      // in series following x1,y1 -> x2,y2\n      for (let i = 0; i < m.length - 1; i += 1) {\n        const { layout: c1, feature: f1, level: l1, refName: ref1 } = m[i]\n        const { layout: c2, feature: f2, level: l2, refName: ref2 } = m[i + 1]\n        const v1 = views[l1]\n        const v2 = views[l2]\n\n        if (!c1 || !c2) {\n          console.warn('received null layout for a overlay feature')\n          return\n        }\n\n        // disable rendering connections in a single level\n        if (!showIntraviewLinks && l1 === l2) {\n          continue\n        }\n        const length1 = f1.get('end') - f1.get('start')\n        const length2 = f2.get('end') - f2.get('start')\n\n        if ((length1 < v1.bpPerPx || length2 < v2.bpPerPx) && hideTiny) {\n          continue\n        }\n\n        const x11 = px(v1, { refName: ref1, coord: c1[LEFT] }) - offsets[l1]\n        const x12 = px(v1, { refName: ref1, coord: c1[RIGHT] }) - offsets[l1]\n        const x21 = px(v2, { refName: ref2, coord: c2[LEFT] }) - offsets[l2]\n        const x22 = px(v2, { refName: ref2, coord: c2[RIGHT] }) - offsets[l2]\n\n        const y1 = middle\n          ? interstitialYPos(l1 < l2, height)\n          : // prettier-ignore\n            // @ts-ignore\n            overlayYPos(trackIds[0], l1, views, c1, l1 < l2)\n        const y2 = middle\n          ? interstitialYPos(l2 < l1, height)\n          : // prettier-ignore\n            // @ts-ignore\n            overlayYPos(trackIds[1], l2, views, c2, l2 < l1)\n\n        // drawing a line if the results are thin results in much less\n        // pixellation than filling in a thin polygon\n        if (length1 < v1.bpPerPx || length2 < v2.bpPerPx) {\n          ctx.beginPath()\n          ctx.moveTo(x11, y1)\n          ctx.lineTo(x21, y2)\n          ctx.stroke()\n        } else {\n          let currX1 = x11\n          let currX2 = x21\n\n          // flip the direction of the CIGAR drawing in horizontally flipped\n          // modes\n          const rev1 = x11 < x12 ? 1 : -1\n          const rev2 = x21 < x22 ? 1 : -1\n\n          const cigar = f1.get('cg') || f1.get('CIGAR')\n          if (cigar) {\n            const cigarOps = parseCigar(cigar)\n            for (let j = 0; j < cigarOps.length; j += 2) {\n              const val = +cigarOps[j]\n              const op = cigarOps[j + 1]\n\n              const prevX1 = currX1\n              const prevX2 = currX2\n\n              if (op === 'M' || op === '=') {\n                ctx.fillStyle = '#f003'\n                currX1 += (val / views[0].bpPerPx) * rev1\n                currX2 += (val / views[1].bpPerPx) * rev2\n              } else if (op === 'X') {\n                ctx.fillStyle = 'brown'\n                currX1 += (val / views[0].bpPerPx) * rev1\n                currX2 += (val / views[1].bpPerPx) * rev2\n              } else if (op === 'D') {\n                ctx.fillStyle = '#00f3'\n                currX1 += (val / views[0].bpPerPx) * rev1\n              } else if (op === 'N') {\n                ctx.fillStyle = '#0a03'\n                currX1 += (val / views[0].bpPerPx) * rev1\n              } else if (op === 'I') {\n                ctx.fillStyle = '#ff03'\n                currX2 += (val / views[1].bpPerPx) * rev2\n              }\n              ctx.beginPath()\n              ctx.moveTo(prevX1, y1)\n              ctx.lineTo(currX1, y1)\n              ctx.lineTo(currX2, y2)\n              ctx.lineTo(prevX2, y2)\n              ctx.closePath()\n              ctx.fill()\n            }\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(x11, y1)\n            ctx.lineTo(x12, y1)\n            ctx.lineTo(x22, y2)\n            ctx.lineTo(x21, y2)\n            ctx.closePath()\n            ctx.fill()\n          }\n        }\n      }\n    })\n  }, [\n    displayModel,\n    highResolutionScaling,\n    trackIds,\n    width,\n    views,\n    offsets,\n    height,\n    matches,\n  ])\n\n  return (\n    <canvas\n      ref={ref}\n      data-testid=\"synteny_canvas\"\n      width={width}\n      height={height}\n    />\n  )\n}\n\nexport default observer(LinearSyntenyRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LinearSyntenyRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a synteny',\n      defaultValue: 'rgb(255,100,100,0.3)',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import ComparativeServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport React from 'react'\n\nexport default class LinearSyntenyRenderer extends ComparativeServerSideRendererType {\n  async render(renderProps: {\n    height: number\n    width: number\n    view: { views: Base1DViewModel[] }\n  }) {\n    const {\n      width,\n      view: { views },\n    } = renderProps\n    const realizedViews = views.map(snap => {\n      const view = Base1DView.create(snap)\n      view.setVolatileWidth(width)\n      return view\n    })\n    const features = await Promise.all(\n      realizedViews.map(view =>\n        this.getFeatures({\n          ...renderProps,\n          regions: view.staticBlocks.contentBlocks,\n        }),\n      ),\n    )\n\n    const serializedFeatures = JSON.parse(JSON.stringify(features))\n    for (let i = 0; i < serializedFeatures.length; i++) {\n      for (let j = 0; j < serializedFeatures[i].length; j++) {\n        // eslint-disable-next-line no-underscore-dangle\n        serializedFeatures[i][j]._level = i\n      }\n    }\n\n    return {\n      reactElement: React.createElement(this.ReactComponent, {\n        ...renderProps,\n        features,\n      }),\n      features: serializedFeatures,\n    }\n  }\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport baseModel from '../LinearComparativeView/model'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types.compose(\n    baseModel(pluginManager),\n    types.model('LinearSyntenyView', {\n      type: types.literal('LinearSyntenyView'),\n    }),\n  )\n}\nexport type LinearSyntenyViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearSyntenyViewModel = Instance<LinearSyntenyViewStateModel>\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport modelFactory from './model'\n\nexport default (pluginManager: PluginManager) => {\n  const { jbrequire } = pluginManager\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n  return new ViewType({\n    name: 'LinearSyntenyView',\n    stateModel: jbrequire(modelFactory),\n    ReactComponent: lazy(() => import('./components/LinearSyntenyView')),\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region, FileLocation } from '@jbrowse/core/util/types'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { tap } from 'rxjs/operators'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport QuickLRU from '@jbrowse/core/util/QuickLRU'\n\ntype RowToGeneNames = {\n  name1: string\n  name2: string\n  score: number\n}[]\n\ninterface GeneNameToRows {\n  [key: string]: number[]\n}\n\nexport default class MCScanAnchorsAdapter extends BaseFeatureDataAdapter {\n  private cache = new AbortablePromiseCache({\n    cache: new QuickLRU({ maxSize: 1 }),\n    fill: () => this.setup(),\n  })\n\n  private initialized = false\n\n  private geneNameToRows: GeneNameToRows = {}\n\n  private rowToGeneName: RowToGeneNames = []\n\n  // @ts-ignore\n  private subadapters: BaseFeatureDataAdapter[]\n\n  // @ts-ignore\n  private assemblyNames: string[]\n\n  // @ts-ignore\n  private mcscanAnchorsLocation: GenericFilehandle\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  public async configure() {\n    const subadapters = readConfObject(this.config, 'subadapters')\n    const assemblyNames = readConfObject(this.config, 'assemblyNames')\n    this.mcscanAnchorsLocation = openLocation(\n      readConfObject(this.config, 'mcscanAnchorsLocation') as FileLocation,\n    )\n\n    this.subadapters = await Promise.all(\n      subadapters.map(async (subadapter: any) => {\n        const dataAdapter = (await this.getSubAdapter?.(subadapter))\n          ?.dataAdapter\n        if (dataAdapter instanceof BaseFeatureDataAdapter) {\n          return dataAdapter\n        }\n        throw new Error(\n          `invalid subadapter type '${this.config.subadapter.type}'`,\n        )\n      }),\n    )\n\n    this.assemblyNames = assemblyNames\n  }\n\n  async setup() {\n    if (!this.initialized) {\n      await this.configure()\n      const text = (await this.mcscanAnchorsLocation.readFile('utf8')) as string\n      text.split('\\n').forEach((line: string, index: number) => {\n        if (line.length && line !== '###') {\n          const [name1, name2, score] = line.split('\\t')\n          if (this.geneNameToRows[name1] === undefined) {\n            this.geneNameToRows[name1] = []\n          }\n          if (this.geneNameToRows[name2] === undefined) {\n            this.geneNameToRows[name2] = []\n          }\n          this.geneNameToRows[name1].push(index)\n          this.geneNameToRows[name2].push(index)\n          this.rowToGeneName[index] = { name1, name2, score: +score }\n        }\n      })\n      this.initialized = true\n    }\n  }\n\n  async hasDataForRefName() {\n    // determining this properly is basically a call to getFeatures\n    // so is not really that important, and has to be true or else\n    // getFeatures is never called (BaseFeatureDataAdapter filters it out)\n    return true\n  }\n\n  async getRefNames() {\n    // we cannot determine this accurately\n    return []\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      await this.cache.get('initialize', opts, opts.signal)\n\n      // The index of the assembly name in the region list corresponds to\n      // the adapter in the subadapters list\n      const index = this.assemblyNames.indexOf(region.assemblyName)\n      if (index !== -1) {\n        const features = this.subadapters[index].getFeatures(region)\n        await features\n          .pipe(\n            tap(feature => {\n              // We first fetch from the NCList and connect each result\n              // with the anchor file via geneNameToRows. Note that each\n              // gene name can correspond to multiple rows\n              const rows = this.geneNameToRows[feature.get('name')] || []\n              rows.forEach(row => {\n                observer.next(\n                  new SimpleFeature({\n                    ...feature.toJSON(),\n                    syntenyId: row,\n                  }),\n                )\n              })\n            }),\n          )\n          .toPromise()\n      }\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'MCScanAnchorsAdapter',\n  {\n    mcscanAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/mcscan.anchors' },\n    },\n    subadapters: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React, { useEffect, useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  CircularProgress,\n  Checkbox,\n  FormControlLabel,\n  TextField,\n  Typography,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport AddIcon from '@material-ui/icons/Add'\nimport CalendarIcon from '@material-ui/icons/CalendarViewDay'\nimport { ConfigurationSchema, getConf } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  getSession,\n  getContainingView,\n  getContainingTrack,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util'\n\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { autorun } from 'mobx'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  configSchemaFactory as linearComparativeDisplayConfigSchemaFactory,\n  ReactComponent as LinearComparativeDisplayReactComponent,\n  stateModelFactory as linearComparativeDisplayStateModelFactory,\n} from './LinearComparativeDisplay'\nimport LinearComparativeViewFactory from './LinearComparativeView'\nimport {\n  configSchemaFactory as linearSyntenyDisplayConfigSchemaFactory,\n  stateModelFactory as linearSyntenyDisplayStateModelFactory,\n} from './LinearSyntenyDisplay'\nimport LinearSyntenyRenderer, {\n  configSchema as linearSyntenyRendererConfigSchema,\n  ReactComponent as LinearSyntenyRendererReactComponent,\n} from './LinearSyntenyRenderer'\nimport LinearSyntenyViewFactory from './LinearSyntenyView'\nimport {\n  AdapterClass as MCScanAnchorsAdapter,\n  configSchema as MCScanAnchorsConfigSchema,\n} from './MCScanAnchorsAdapter'\n\nconst { parseCigar } = MismatchParser\n\ninterface Track {\n  id: string\n  type: string\n  displays: {\n    addAdditionalContextMenuItemCallback: Function\n    additionalContextMenuItemCallbacks: Function[]\n    id: string\n    type: string\n    PileupDisplay: any\n  }[]\n}\ninterface View {\n  tracks: Track[]\n  views?: View[]\n  type: string\n}\ninterface Session {\n  views: View[]\n}\nfunction getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nfunction getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nfunction getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\nfunction getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\ninterface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  strand: number\n  seqLength: number\n  syntenyId?: number\n  uniqueId: string\n  mate: {\n    refName: string\n    start: number\n    end: number\n    syntenyId?: number\n    uniqueId?: string\n  }\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: 300,\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction getTag(f: Feature, tag: string) {\n  const tags = f.get('tags')\n  return tags ? tags[tag] : f.get(tag)\n}\n\nfunction WindowSizeDlg(props: {\n  feature: Feature\n  handleClose: () => void\n  track: any\n}) {\n  const classes = useStyles()\n  const { track, feature: preFeature, handleClose } = props\n\n  // window size stored as string, because it corresponds to a textfield which\n  // is parsed as number on submit\n  const [window, setWindowSize] = useState('0')\n  const [error, setError] = useState<Error>()\n  const windowSize = +window\n  const [primaryFeature, setPrimaryFeature] = useState<Feature>()\n  const [qualTrack, setQualTrack] = useState(false)\n\n  // we need to fetch the primary alignment if the selected feature is 2048.\n  // this should be the first in the list of the SA tag\n  useEffect(() => {\n    let done = false\n    ;(async () => {\n      if (preFeature.get('flags') & 2048) {\n        const SA: string = getTag(preFeature, 'SA') || ''\n        const primaryAln = SA.split(';')[0]\n        const [saRef, saStart] = primaryAln.split(',')\n        const { rpcManager } = getSession(track)\n        const adapterConfig = getConf(track, 'adapter')\n        const sessionId = getRpcSessionId(track)\n        const feats = (await rpcManager.call(sessionId, 'CoreGetFeatures', {\n          adapterConfig,\n          sessionId,\n          region: { refName: saRef, start: +saStart - 1, end: +saStart },\n        })) as any[]\n        const primaryFeat = feats.find(\n          f =>\n            f.get('name') === preFeature.get('name') &&\n            !(f.get('flags') & 2048),\n        )\n        if (!done) {\n          setPrimaryFeature(primaryFeat)\n        }\n      } else {\n        setPrimaryFeature(preFeature)\n      }\n    })()\n\n    return () => {\n      done = true\n    }\n  }, [preFeature, track])\n\n  function onSubmit() {\n    try {\n      const feature = primaryFeature || preFeature\n      const session = getSession(track)\n      const view = getContainingView(track)\n      const cigar = feature.get('CIGAR')\n      const clipPos = getClip(cigar, 1)\n      const flags = feature.get('flags')\n      const qual = feature.get('qual') as string\n      const SA: string = getTag(feature, 'SA') || ''\n      const readName = feature.get('name')\n\n      // the suffix -temp is used in the beforeDetach handler to\n      // automatically remove itself from the session when this view is\n      // destroyed\n      const readAssembly = `${readName}_assembly-temp`\n      const [trackAssembly] = getConf(track, 'assemblyNames')\n      const assemblyNames = [trackAssembly, readAssembly]\n      const trackId = `track-${Date.now()}`\n      const trackName = `${readName}_vs_${trackAssembly}`\n\n      // get the canonical refname for the read because if the\n      // read.get('refName') is chr1 and the actual fasta refName is 1 then no\n      // tracks can be opened on the top panel of the linear read vs ref\n      const { assemblyManager } = session\n      const assembly = assemblyManager.get(trackAssembly)\n\n      const supplementaryAlignments = SA.split(';')\n        .filter(aln => !!aln)\n        .map((aln, index) => {\n          const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n          const saLengthOnRef = getLengthOnRef(saCigar)\n          const saLength = getLength(saCigar)\n          const saLengthSansClipping = getLengthSansClipping(saCigar)\n          const saStrandNormalized = saStrand === '-' ? -1 : 1\n          const saClipPos = getClip(saCigar, 1)\n          const saRealStart = +saStart - 1\n          return {\n            refName: saRef,\n            start: saRealStart,\n            end: saRealStart + saLengthOnRef,\n            seqLength: saLength,\n            clipPos: saClipPos,\n            CIGAR: saCigar,\n            assemblyName: trackAssembly,\n            strand: saStrandNormalized,\n            uniqueId: `${feature.id()}_SA${index}`,\n            mate: {\n              start: saClipPos,\n              end: saClipPos + saLengthSansClipping,\n              refName: readName,\n            },\n          }\n        })\n\n      const feat = feature.toJSON()\n      feat.clipPos = clipPos\n\n      feat.mate = {\n        refName: readName,\n        start: clipPos,\n        end: clipPos + getLengthSansClipping(cigar),\n      }\n\n      // if secondary alignment or supplementary, calculate length from SA[0]'s\n      // CIGAR which is the primary alignments. otherwise it is the primary\n      // alignment just use seq.length if primary alignment\n      const totalLength =\n        flags & 2048\n          ? getLength(supplementaryAlignments[0].CIGAR)\n          : getLength(cigar)\n\n      const features = [feat, ...supplementaryAlignments] as ReducedFeature[]\n\n      features.forEach((f, index) => {\n        f.refName = assembly?.getCanonicalRefName(f.refName) || f.refName\n        f.syntenyId = index\n        f.mate.syntenyId = index\n        f.mate.uniqueId = `${f.uniqueId}_mate`\n      })\n      features.sort((a, b) => a.clipPos - b.clipPos)\n\n      const featSeq = feature.get('seq')\n\n      // the config feature store includes synthetic mate features\n      // mapped to the read assembly\n      const configFeatureStore = features.concat(\n        // @ts-ignore\n        features.map(f => f.mate),\n      )\n\n      const expand = 2 * windowSize\n      const refLength = features.reduce(\n        (a, f) => a + f.end - f.start + expand,\n        0,\n      )\n\n      const seqTrackId = `${readName}_${Date.now()}`\n      const sequenceTrackConf = getConf(assembly, 'sequence')\n      const lgvRegions = features\n        .map(f => {\n          return {\n            ...f,\n            start: Math.max(0, f.start - windowSize),\n            end: f.end + windowSize,\n            assemblyName: trackAssembly,\n          }\n        })\n        .sort((a, b) => a.clipPos - b.clipPos)\n\n      session.addAssembly?.({\n        name: `${readAssembly}`,\n        sequence: {\n          type: 'ReferenceSequenceTrack',\n          trackId: seqTrackId,\n          assemblyNames: [readAssembly],\n          adapter: {\n            type: 'FromConfigSequenceAdapter',\n            noAssemblyManager: true,\n            features: [\n              {\n                start: 0,\n                end: totalLength,\n                seq: featSeq,\n                refName: readName,\n                uniqueId: `${Math.random()}`,\n              },\n            ],\n          },\n        },\n      })\n\n      session.addView('LinearSyntenyView', {\n        type: 'LinearSyntenyView',\n        views: [\n          {\n            type: 'LinearGenomeView',\n            hideHeader: true,\n            offsetPx: 0,\n            bpPerPx: refLength / view.width,\n            displayedRegions: lgvRegions,\n            tracks: [\n              {\n                id: `${Math.random()}`,\n                type: 'ReferenceSequenceTrack',\n                assemblyNames: [trackAssembly],\n                configuration: sequenceTrackConf.trackId,\n                displays: [\n                  {\n                    id: `${Math.random()}`,\n                    type: 'LinearReferenceSequenceDisplay',\n                    showReverse: false,\n                    showTranslation: false,\n                    height: 35,\n                    configuration: `${seqTrackId}-LinearReferenceSequenceDisplay`,\n                  },\n                ],\n              },\n            ],\n          },\n          {\n            type: 'LinearGenomeView',\n            hideHeader: true,\n            offsetPx: 0,\n            bpPerPx: totalLength / view.width,\n            displayedRegions: [\n              {\n                assemblyName: readAssembly,\n                start: 0,\n                end: totalLength,\n                refName: readName,\n              },\n            ],\n            tracks: [\n              {\n                id: `${Math.random()}`,\n                type: 'ReferenceSequenceTrack',\n                configuration: seqTrackId,\n                displays: [\n                  {\n                    id: `${Math.random()}`,\n                    type: 'LinearReferenceSequenceDisplay',\n                    showReverse: false,\n                    showTranslation: false,\n                    height: 35,\n                    configuration: `${seqTrackId}-LinearReferenceSequenceDisplay`,\n                  },\n                ],\n              },\n              ...(qualTrack\n                ? [\n                    {\n                      id: `${Math.random()}`,\n                      type: 'QuantitativeTrack',\n                      configuration: {\n                        trackId: 'qualTrack',\n                        assemblyNames: [readAssembly],\n                        name: 'Read quality',\n                        type: 'QuantitativeTrack',\n                        adapter: {\n                          type: 'FromConfigAdapter',\n                          noAssemblyManager: true,\n                          features: qual.split(' ').map((score, index) => {\n                            return {\n                              start: index,\n                              end: index + 1,\n                              refName: readName,\n                              score: +score,\n                              uniqueId: `feat_${index}`,\n                            }\n                          }),\n                        },\n                      },\n                      displays: [\n                        {\n                          id: `${Math.random()}`,\n                          type: 'LinearWiggleDisplay',\n                          height: 100,\n                        },\n                      ],\n                    },\n                  ]\n                : []),\n            ],\n          },\n        ],\n        viewTrackConfigs: [\n          {\n            type: 'SyntenyTrack',\n            assemblyNames,\n            adapter: {\n              type: 'FromConfigAdapter',\n              features: configFeatureStore,\n            },\n            trackId,\n            name: trackName,\n          },\n        ],\n        tracks: [\n          {\n            configuration: trackId,\n            type: 'SyntenyTrack',\n            displays: [\n              {\n                type: 'LinearSyntenyDisplay',\n                configuration: `${trackId}-LinearSyntenyDisplay`,\n              },\n            ],\n          },\n        ],\n        displayName: `${readName} vs ${trackAssembly}`,\n      })\n      handleClose()\n    } catch (e) {\n      console.error(e)\n      setError(e)\n    }\n  }\n\n  return (\n    <Dialog\n      open\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">\n        Set window size\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {!primaryFeature ? (\n          <div>\n            <Typography>\n              To accurately perform comparison we are fetching the primary\n              alignment. Loading primary feature...\n            </Typography>\n            <CircularProgress />\n          </div>\n        ) : (\n          <div className={classes.root}>\n            <Typography>\n              Show an extra window size around each part of the split alignment.\n              Using a larger value can allow you to see more genomic context.\n            </Typography>\n            {error ? <Typography color=\"error\">{`${error}`}</Typography> : null}\n\n            <TextField\n              value={window}\n              onChange={event => {\n                setWindowSize(event.target.value)\n              }}\n              label=\"Set window size\"\n            />\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={qualTrack}\n                  onChange={() => setQualTrack(val => !val)}\n                />\n              }\n              label=\"Show qual track\"\n            />\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              style={{ marginLeft: 20 }}\n              onClick={onSubmit}\n            >\n              Submit\n            </Button>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport default class extends Plugin {\n  name = 'LinearComparativeViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(LinearComparativeViewFactory),\n    )\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(LinearSyntenyViewFactory),\n    )\n\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'SyntenyTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'SyntenyTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'SyntenyTrack',\n          configSchema,\n        ),\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearComparativeDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearComparativeDisplay',\n        configSchema,\n        stateModel: linearComparativeDisplayStateModelFactory(configSchema),\n        trackType: 'SyntenyTrack',\n        viewType: 'LinearComparativeView',\n        ReactComponent: LinearComparativeDisplayReactComponent,\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearSyntenyDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearSyntenyDisplay',\n        configSchema,\n        stateModel: linearSyntenyDisplayStateModelFactory(configSchema),\n        trackType: 'SyntenyTrack',\n        viewType: 'LinearSyntenyView',\n        ReactComponent: LinearComparativeDisplayReactComponent,\n      })\n    })\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'MCScanAnchorsAdapter',\n          configSchema: MCScanAnchorsConfigSchema,\n          AdapterClass: MCScanAnchorsAdapter,\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new LinearSyntenyRenderer({\n          name: 'LinearSyntenyRenderer',\n          configSchema: linearSyntenyRendererConfigSchema,\n          ReactComponent: LinearSyntenyRendererReactComponent,\n          pluginManager,\n        }),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Linear synteny view',\n        icon: CalendarIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearSyntenyView', {})\n        },\n      })\n    }\n\n    const callback = (feature: Feature, display: any) => {\n      return feature\n        ? [\n            {\n              label: 'Linear read vs ref',\n              icon: AddIcon,\n              onClick: () => {\n                getSession(display).setDialogComponent(WindowSizeDlg, {\n                  track: getContainingTrack(display),\n                  feature,\n                })\n              },\n            },\n          ]\n        : []\n    }\n\n    function checkCallback(obj: any) {\n      return obj.additionalContextMenuItemCallbacks.includes(callback)\n    }\n    function addCallback(obj: any) {\n      obj.addAdditionalContextMenuItemCallback(callback)\n    }\n    function addContextMenu(view: View) {\n      if (view.type === 'LinearGenomeView') {\n        view.tracks.forEach(track => {\n          if (track.type === 'AlignmentsTrack') {\n            track.displays.forEach(display => {\n              if (\n                display.type === 'LinearPileupDisplay' &&\n                !checkCallback(display)\n              ) {\n                addCallback(display)\n              } else if (\n                display.type === 'LinearAlignmentsDisplay' &&\n                display.PileupDisplay &&\n                !checkCallback(display.PileupDisplay)\n              ) {\n                addCallback(display.PileupDisplay)\n              }\n            })\n          }\n        })\n      }\n    }\n    autorun(() => {\n      const session = pluginManager.rootModel?.session as Session | undefined\n      if (session) {\n        session.views.forEach(view => {\n          if (view.views) {\n            view.views.forEach(v => addContextMenu(v))\n          } else {\n            addContextMenu(view)\n          }\n        })\n      }\n    })\n  }\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearLollipopDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearLollipopDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      get blockType() {\n        return 'dynamicBlocks'\n      },\n      get renderDelay() {\n        return 500\n      },\n      get renderProps() {\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          config: self.configuration.renderer,\n        }\n      },\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction ScoreText({\n  feature,\n  config,\n  layoutRecord: {\n    y,\n    data: { anchorX, radiusPx, score },\n  },\n}) {\n  const innerColor = readConfObject(config, 'innerColor', { feature })\n\n  const scoreString = String(score)\n  const fontWidth = (radiusPx * 2) / scoreString.length\n  const fontHeight = fontWidth * 1.1\n  if (fontHeight < 12) {\n    return null\n  }\n  return (\n    <text\n      style={{ fontSize: fontHeight, fill: contrastingTextColor(innerColor) }}\n      x={anchorX}\n      y={y + radiusPx - fontHeight / 2.4}\n      textAnchor=\"middle\"\n      dominantBaseline=\"hanging\"\n    >\n      {scoreString}\n    </text>\n  )\n}\n\nScoreText.propTypes = {\n  feature: ReactPropTypes.shape({ get: ReactPropTypes.func.isRequired })\n    .isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }).isRequired,\n  }).isRequired,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nfunction Lollipop(props) {\n  const onFeatureMouseDown = event => {\n    const { onFeatureMouseDown: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseEnter = event => {\n    const { onFeatureMouseEnter: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOut = event => {\n    const { onFeatureMouseOut: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOver = event => {\n    const { onFeatureMouseOver: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseUp = event => {\n    const { onFeatureMouseUp: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseLeave = event => {\n    const { onFeatureMouseLeave: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseMove = event => {\n    const { onFeatureMouseMove: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureClick = event => {\n    const { onFeatureClick: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, feature.id())\n  }\n\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx, score },\n    },\n    selectedFeatureId,\n  } = props\n\n  const styleOuter = {\n    fill: readConfObject(config, 'strokeColor', { feature }),\n  }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    styleOuter.fill = 'red'\n  }\n\n  const styleInner = {\n    fill: readConfObject(config, 'innerColor', { feature }),\n  }\n\n  const strokeWidth = readConfObject(config, 'strokeWidth', { feature })\n\n  return (\n    <g data-testid={feature.id()}>\n      <title>{readConfObject(config, 'caption', { feature })}</title>\n      <circle\n        cx={anchorLocation}\n        cy={y + radiusPx}\n        r={radiusPx}\n        style={styleOuter}\n        onMouseDown={onFeatureMouseDown}\n        onMouseEnter={onFeatureMouseEnter}\n        onMouseOut={onFeatureMouseOut}\n        onMouseOver={onFeatureMouseOver}\n        onMouseUp={onFeatureMouseUp}\n        onMouseLeave={onFeatureMouseLeave}\n        onMouseMove={onFeatureMouseMove}\n        onClick={onFeatureClick}\n        onFocus={onFeatureMouseOver}\n        onBlur={onFeatureMouseOut}\n      />\n      {radiusPx - strokeWidth <= 2 ? null : (\n        <circle\n          cx={anchorLocation}\n          cy={y + radiusPx}\n          r={radiusPx - strokeWidth}\n          style={styleInner}\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n        />\n      )}\n      <ScoreText {...props} score={score} />\n    </g>\n  )\n}\nLollipop.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }),\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n\n  onFeatureMouseDown: ReactPropTypes.func,\n  onFeatureMouseEnter: ReactPropTypes.func,\n  onFeatureMouseOut: ReactPropTypes.func,\n  onFeatureMouseOver: ReactPropTypes.func,\n  onFeatureMouseUp: ReactPropTypes.func,\n  onFeatureMouseLeave: ReactPropTypes.func,\n  onFeatureMouseMove: ReactPropTypes.func,\n\n  // synthesized from mouseup and mousedown\n  onFeatureClick: ReactPropTypes.func,\n}\n\nLollipop.defaultProps = {\n  selectedFeatureId: undefined,\n\n  onFeatureMouseDown: undefined,\n  onFeatureMouseEnter: undefined,\n  onFeatureMouseOut: undefined,\n  onFeatureMouseOver: undefined,\n  onFeatureMouseUp: undefined,\n  onFeatureMouseLeave: undefined,\n  onFeatureMouseMove: undefined,\n\n  onFeatureClick: undefined,\n}\nexport default observer(Lollipop)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Stick(props) {\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx },\n    },\n    selectedFeatureId,\n  } = props\n\n  const style = { fill: readConfObject(config, 'bodyColor', { feature }) }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    style.fill = 'red'\n  }\n  return (\n    <line\n      x1={anchorLocation}\n      y1={0}\n      x2={anchorLocation}\n      y2={y + 2 * radiusPx}\n      stroke={readConfObject(config, 'stickColor', { feature })}\n      strokeWidth={readConfObject(config, 'stickWidth', { feature })}\n    />\n  )\n}\nStick.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({ radiusPx: ReactPropTypes.number.isRequired })\n      .isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\nStick.defaultProps = {\n  selectedFeatureId: undefined,\n}\n\nexport default observer(Stick)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { bpToPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport Lollipop from './Lollipop'\nimport Stick from './Stick'\n\nfunction LollipopRendering(props) {\n  const onMouseDown = event => {\n    const { onMouseDown: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseUp = event => {\n    const { onMouseUp: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseEnter = event => {\n    const { onMouseEnter: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseLeave = event => {\n    const { onMouseLeave: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseOver = event => {\n    const { onMouseOver: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseOut = event => {\n    const { onMouseOut: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onClick = event => {\n    const { onClick: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  function layoutFeat(args) {\n    const { feature, bpPerPx, region, layout } = args\n\n    const centerBp = Math.abs(feature.get('end') + feature.get('start')) / 2\n    const centerPx = bpToPx(centerBp, region, bpPerPx)\n    const radiusPx = readConfObject(args.config, 'radius', { feature })\n\n    if (!radiusPx) {\n      console.error(\n        new Error(\n          `lollipop radius ${radiusPx} configured for feature ${feature.id()}`,\n        ),\n      )\n    }\n    layout.add(feature.id(), centerPx, radiusPx * 2, radiusPx * 2, {\n      featureId: feature.id(),\n      anchorX: centerPx,\n      radiusPx,\n      score: readConfObject(args.config, 'score', { feature }),\n    })\n  }\n\n  const {\n    regions,\n    bpPerPx,\n    layout,\n    config,\n    features,\n    displayModel: { selectedFeatureId },\n  } = props\n\n  const [region] = regions\n  const sticksRendered = []\n  const lollipopsRendered = []\n  for (const feature of features.values()) {\n    layoutFeat({\n      feature,\n      bpPerPx,\n      region,\n      config,\n      layout,\n    })\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Stick\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`stick-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Lollipop\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`body-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const height = layout.getTotalHeight()\n\n  return (\n    <svg\n      className=\"LollipopRendering\"\n      width={width}\n      height={height}\n      style={{\n        position: 'relative',\n      }}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onFocus={onMouseEnter}\n      onBlur={onMouseLeave}\n      onClick={onClick}\n    >\n      {sticksRendered}\n      {lollipopsRendered}\n    </svg>\n  )\n}\n\nLollipopRendering.propTypes = {\n  layout: ReactPropTypes.shape({\n    getLayout: ReactPropTypes.func.isRequired,\n    add: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  regions: ReactPropTypes.arrayOf(CommonPropTypes.Region).isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  features: ReactPropTypes.instanceOf(Map),\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  displayModel: ReactPropTypes.shape({\n    /** id of the currently selected feature, if any */\n    selectedFeatureId: ReactPropTypes.string,\n  }),\n\n  onMouseDown: ReactPropTypes.func,\n  onMouseUp: ReactPropTypes.func,\n  onMouseEnter: ReactPropTypes.func,\n  onMouseLeave: ReactPropTypes.func,\n  onMouseOver: ReactPropTypes.func,\n  onMouseOut: ReactPropTypes.func,\n  onClick: ReactPropTypes.func,\n}\n\nLollipopRendering.defaultProps = {\n  displayModel: {},\n\n  features: new Map(),\n\n  onMouseDown: undefined,\n  onMouseUp: undefined,\n  onMouseEnter: undefined,\n  onMouseLeave: undefined,\n  onMouseOver: undefined,\n  onMouseOut: undefined,\n  onClick: undefined,\n}\n\nexport default observer(LollipopRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LollipopRenderer',\n  {\n    strokeColor: {\n      type: 'color',\n      description: 'the outer color of each lollipop',\n      defaultValue: 'green',\n      contextVariable: ['feature'],\n    },\n    innerColor: {\n      type: 'color',\n      description: 'the inner color of each lollipop',\n      defaultValue: '#7fc75f',\n      contextVariable: ['feature'],\n    },\n    strokeWidth: {\n      type: 'number',\n      description: 'width of the stroked border',\n      defaultValue: 4,\n      contextVariable: ['feature'],\n    },\n    radius: {\n      type: 'number',\n      description: 'radius in pixels of each lollipop body',\n      defaultValue: `jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))`,\n      contextVariable: ['feature'],\n    },\n    caption: {\n      type: 'string',\n      description:\n        'the tooltip caption displayed when the mouse hovers over a lollipop',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n    minStickLength: {\n      type: 'number',\n      description: 'minimum lollipop \"stick\" length, in pixels',\n      defaultValue: 5,\n    },\n    stickColor: {\n      type: 'color',\n      description: 'color of the lollipop stick',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    stickWidth: {\n      type: 'number',\n      description: 'width in pixels of the lollipop stick',\n      defaultValue: 2,\n      contextVariable: ['feature'],\n    },\n    score: {\n      type: 'number',\n      description:\n        'the \"score\" of each lollipop, displayed as a number in the center of the circle',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\ninterface LayoutItem {\n  uniqueId: string\n  anchorLocation: number\n  width: number\n  height: number\n  data: { score: number }\n}\n\ntype LayoutEntry = LayoutItem & { x: number; y: number }\n\ntype LayoutMap = Map<string, LayoutEntry>\n\nexport class FloatingLayout {\n  width: number\n\n  totalHeight = 0\n\n  constructor({ width }: { width: number }) {\n    if (!width) {\n      throw new Error('width required to make a new FloatingLayout')\n    }\n    this.width = width\n  }\n\n  items: LayoutItem[] = []\n\n  layout: LayoutMap = new Map()\n\n  layoutDirty = false\n\n  add(\n    uniqueId: string,\n    anchorLocation: number,\n    width: number,\n    height: number,\n    data: { score: number },\n  ) {\n    this.items.push({ uniqueId, anchorLocation, width, height, data })\n    this.layoutDirty = true\n  }\n\n  /**\n   * @returns Map of `uniqueId => {x,y,anchorLocation,width,height,data}`\n   */\n  getLayout(configuration?: AnyConfigurationModel) {\n    if (!this.layoutDirty) {\n      return this.layout\n    }\n    if (!configuration) {\n      throw new Error('configuration object required')\n    }\n\n    const minY = readConfObject(configuration, 'minStickLength')\n\n    // sort them by score ascending, so higher scores will always end up\n    // stacked last (toward the bottom)\n    const sorted = this.items.sort((a, b) => a.data.score - b.data.score)\n\n    // bump them\n    let maxBottom = 0\n    const layoutEntries: [string, LayoutEntry][] = Array(sorted.length)\n    for (let i = 0; i < sorted.length; i += 1) {\n      const currentItem = sorted[i]\n      const { anchorLocation, width, height } = currentItem\n      const start = anchorLocation - width / 2\n      const end = start + width\n      let top = minY\n      let bottom = top + height\n\n      // figure out how far down to put it\n      for (let j = 0; j < i; j += 1) {\n        const [, previouslyLayedOutItem] = layoutEntries[j]\n        const {\n          x: prevStart,\n          y: prevTop,\n          width: prevWidth,\n          height: prevHeight,\n        } = previouslyLayedOutItem\n        const prevEnd = prevStart + prevWidth\n        const prevBottom = prevTop + prevHeight\n        if (\n          doesIntersect2(prevStart, prevEnd, start, end) &&\n          doesIntersect2(prevTop, prevBottom, top, bottom)\n        ) {\n          // bump this one to the bottom of the previous one\n          top = prevBottom\n          bottom = top + height\n          j = -1 // we need to check all of them again after bumping\n        }\n      }\n\n      // record the entry and update the maxBottom\n      layoutEntries[i] = [\n        currentItem.uniqueId,\n        { ...currentItem, x: start, y: top },\n      ]\n      if (bottom > maxBottom) {\n        maxBottom = bottom\n      }\n    }\n\n    // try to tile them left to right all at the same level\n    // if they don't fit, try to alternate them on 2 levels, then 3\n    this.totalHeight = maxBottom\n    this.layout = new Map(layoutEntries)\n    this.layoutDirty = false\n    return this.layout\n  }\n\n  getTotalHeight() {\n    if (this.layoutDirty) {\n      throw new Error('getTotalHeight does not work when the layout is dirty.')\n    }\n    return this.totalHeight\n  }\n\n  serializeRegion() {\n    return this.toJSON()\n  }\n\n  toJSON() {\n    if (this.layoutDirty) {\n      throw new Error('toJSON does not work when the layout is dirty.')\n    }\n    return { pairs: [...this.getLayout()], totalHeight: this.getTotalHeight() }\n  }\n\n  static fromJSON() {\n    throw new Error('not supported')\n  }\n}\n\nexport class PrecomputedFloatingLayout {\n  layout: LayoutMap\n\n  totalHeight: number\n\n  constructor({\n    pairs,\n    totalHeight,\n  }: {\n    pairs: [string, LayoutEntry][]\n    totalHeight: number\n  }) {\n    this.layout = new Map(pairs)\n    this.totalHeight = totalHeight\n  }\n\n  add(uniqueId: string) {\n    if (!this.layout.has(uniqueId)) {\n      throw new Error(`layout error, precomputed layout is missing ${uniqueId}`)\n    }\n  }\n\n  getLayout() {\n    return this.layout\n  }\n\n  getTotalHeight() {\n    return this.totalHeight\n  }\n\n  static fromJSON(\n    json: ConstructorParameters<typeof PrecomputedFloatingLayout>[0],\n  ) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import BoxRendererType, {\n  LayoutSession,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { FloatingLayout, PrecomputedFloatingLayout } from './Layout'\n\nclass FloatingLayoutSession extends LayoutSession {\n  makeLayout() {\n    'sequenceAdapter'\n\n    const { end, start } = this.regions[0]\n    const widthPx = (end - start) / this.bpPerPx\n    return new MultiLayout(FloatingLayout, { width: widthPx })\n  }\n\n  layoutIsValid(/* layout */) {\n    return false // layout.left layout.width === this.width\n  }\n}\n\nexport default class extends BoxRendererType {\n  createSession(args) {\n    return new FloatingLayoutSession(args)\n  }\n\n  deserializeLayoutInClient(json) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  configSchemaFactory as linearLollipopDisplayConfigSchemaFactory,\n  stateModelFactory as LinearLollipopDisplayStateModelFactory,\n} from './LinearLollipopDisplay'\nimport LollipopRenderer, {\n  configSchema as lollipopRendererConfigSchema,\n  ReactComponent as LollipopRendererReactComponent,\n} from './LollipopRenderer'\n\nexport default class extends Plugin {\n  name = 'LollipopPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new LollipopRenderer({\n          name: 'LollipopRenderer',\n          ReactComponent: LollipopRendererReactComponent,\n          configSchema: lollipopRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearLollipopDisplayConfigSchemaFactory(\n        pluginManager,\n      )\n      return new DisplayType({\n        name: 'LinearLollipopDisplay',\n        configSchema,\n        stateModel: LinearLollipopDisplayStateModelFactory(configSchema),\n        trackType: 'LollipopTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearLollipopDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('AboutWidget', {})\n\nexport const stateModel = types.model('AboutWidget', {\n  id: ElementId,\n  type: types.literal('AboutWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('HelpWidget', {})\n\nexport const stateModel = types.model('HelpWidget', {\n  id: ElementId,\n  type: types.literal('HelpWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('ImportSessionWidget', {})\n\nexport const stateModel = types.model('ImportSessionWidget', {\n  id: ElementId,\n  type: types.literal('ImportSessionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('SessionManager', {})\n\nexport const stateModel = types.model('SessionManager', {\n  id: ElementId,\n  type: types.literal('SessionManager'),\n})\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  SessionWithWidgets,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util'\nimport FileCopyIcon from '@material-ui/icons/FileCopy'\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen'\nimport GetAppIcon from '@material-ui/icons/GetApp'\nimport HelpIcon from '@material-ui/icons/Help'\nimport InfoIcon from '@material-ui/icons/Info'\nimport PublishIcon from '@material-ui/icons/Publish'\nimport SaveIcon from '@material-ui/icons/Save'\nimport { saveAs } from 'file-saver'\nimport { getSnapshot, IAnyStateTreeNode } from 'mobx-state-tree'\nimport {\n  configSchema as aboutConfigSchema,\n  stateModel as aboutStateModel,\n} from './AboutWidget'\nimport {\n  configSchema as helpConfigSchema,\n  stateModel as helpStateModel,\n} from './HelpWidget'\nimport {\n  configSchema as importSessionConfigSchema,\n  stateModel as importSessionStateModel,\n} from './ImportSessionWidget'\nimport {\n  configSchema as sessionManagerConfigSchema,\n  stateModel as sessionManagerStateModel,\n} from './SessionManager'\n\nexport default class extends Plugin {\n  name = 'MenusPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AboutWidget',\n        heading: 'About',\n        configSchema: aboutConfigSchema,\n        stateModel: aboutStateModel,\n        ReactComponent: lazy(\n          () => import('./AboutWidget/components/AboutWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HelpWidget',\n        heading: 'Help',\n        configSchema: helpConfigSchema,\n        stateModel: helpStateModel,\n        ReactComponent: lazy(\n          () => import('./HelpWidget/components/HelpWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ImportSessionWidget',\n        heading: 'Import session',\n        configSchema: importSessionConfigSchema,\n        stateModel: importSessionStateModel,\n        ReactComponent: lazy(\n          () => import('./ImportSessionWidget/components/ImportSessionWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'SessionManager',\n        heading: 'Sessions',\n        configSchema: sessionManagerConfigSchema,\n        stateModel: sessionManagerStateModel,\n        ReactComponent: lazy(\n          () => import('./SessionManager/components/SessionManager'),\n        ),\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'About',\n        icon: InfoIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('AboutWidget', 'aboutWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'Help',\n        icon: HelpIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('HelpWidget', 'helpWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Export session',\n          icon: GetAppIcon,\n          onClick: (session: IAnyStateTreeNode) => {\n            const sessionBlob = new Blob(\n              [JSON.stringify({ session: getSnapshot(session) }, null, 2)],\n              { type: 'text/plain;charset=utf-8' },\n            )\n            saveAs(sessionBlob, 'session.json')\n          },\n        },\n        1,\n      )\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Import session',\n          icon: PublishIcon,\n          onClick: (session: SessionWithWidgets) => {\n            const widget = session.addWidget(\n              'ImportSessionWidget',\n              'importSessionWidget',\n            )\n            session.showWidget(widget)\n          },\n        },\n        1,\n      )\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Open session',\n          icon: FolderOpenIcon,\n          onClick: (session: SessionWithWidgets) => {\n            const widget = session.addWidget('SessionManager', 'sessionManager')\n            session.showWidget(widget)\n          },\n        },\n        1,\n      )\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Save session',\n          icon: SaveIcon,\n          onClick: (session: SessionWithWidgets) => {\n            // @ts-ignore\n            if (session.saveSessionToLocalStorage) {\n              // @ts-ignore\n              session.saveSessionToLocalStorage()\n              // @ts-ignore\n              session.notify(`Saved session \"${session.name}\"`, 'success')\n            }\n          },\n        },\n        1,\n      )\n      pluginManager.rootModel.insertInMenu(\n        'File',\n        {\n          label: 'Duplicate session',\n          icon: FileCopyIcon,\n          onClick: (session: AbstractSessionModel) => {\n            session.duplicateCurrentSession?.()\n          },\n        },\n        1,\n      )\n    }\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport format from 'string-template'\n\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\n\ninterface SPARQLEntry {\n  type: string\n  value: string\n  dataTypes?: string\n}\n\ninterface SPARQLBinding {\n  [key: string]: SPARQLEntry\n}\n\ninterface SPARQLResponseHead {\n  vars: string[]\n}\n\ninterface SPARQLResponseResults {\n  bindings: SPARQLBinding[]\n}\n\ninterface SPARQLResponse {\n  head: SPARQLResponseHead\n  results: SPARQLResponseResults\n}\n\ninterface SPARQLFeatureData {\n  start: number\n  end: number\n  strand: number\n  subfeatures?: SPARQLFeatureData[]\n  uniqueId: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [propName: string]: any\n}\n\ninterface SPARQLFeature {\n  data: SPARQLFeatureData\n}\n\nexport default class SPARQLAdapter extends BaseFeatureDataAdapter {\n  private endpoint: string\n\n  private queryTemplate: string\n\n  private refNamesQueryTemplate: string\n\n  private additionalQueryParams: string[]\n\n  private configRefNames: string[]\n\n  private refNames: string[] | undefined\n\n  public constructor(config: Instance<typeof MyConfigSchema>) {\n    super(config)\n    this.endpoint = readConfObject(config, 'endpoint').uri\n    this.queryTemplate = readConfObject(config, 'queryTemplate')\n    this.additionalQueryParams = readConfObject(config, 'additionalQueryParams')\n    this.refNamesQueryTemplate = readConfObject(config, 'refNamesQueryTemplate')\n    this.configRefNames = readConfObject(config, 'refNames')\n  }\n\n  public async getRefNames(opts: BaseOptions = {}): Promise<string[]> {\n    if (this.refNames) {\n      return this.refNames\n    }\n    let refNames = [] as string[]\n    if (this.refNamesQueryTemplate) {\n      const queryTemplate = encodeURIComponent(this.refNamesQueryTemplate)\n      const results = await this.querySparql(queryTemplate, opts)\n      refNames = this.resultsToRefNames(results)\n    } else if (this.configRefNames) {\n      refNames = this.configRefNames\n    }\n    this.refNames = refNames\n    return refNames\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const filledTemplate = encodeURIComponent(\n        format(this.queryTemplate, query),\n      )\n      const { refName } = query\n      const results = await this.querySparql(filledTemplate, opts)\n      this.resultsToFeatures(results, refName).forEach(feature => {\n        observer.next(feature)\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async querySparql(query: string, opts?: BaseOptions): Promise<any> {\n    let additionalQueryParams = ''\n    if (this.additionalQueryParams.length) {\n      additionalQueryParams = `&${this.additionalQueryParams.join('&')}`\n    }\n    const signal = opts && opts.signal\n    const response = await fetch(\n      `${this.endpoint}?query=${query}${additionalQueryParams}`,\n      {\n        headers: { accept: 'application/json,application/sparql-results+json' },\n        signal,\n      },\n    )\n    return response.json()\n  }\n\n  private resultsToRefNames(response: SPARQLResponse): string[] {\n    const rows = ((response || {}).results || {}).bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = response.head.vars\n    if (!fields.includes('refName')) {\n      throw new Error('\"refName\" not found in refNamesQueryTemplate response')\n    }\n    return rows.map(row => row.refName.value)\n  }\n\n  private resultsToFeatures(\n    results: SPARQLResponse,\n    refName: string,\n  ): SimpleFeature[] {\n    const rows = ((results || {}).results || {}).bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = results.head.vars\n    const requiredFields = ['start', 'end', 'uniqueId']\n    requiredFields.forEach(requiredField => {\n      if (!fields.includes(requiredField)) {\n        console.error(\n          `Required field ${requiredField} missing from feature data`,\n        )\n      }\n    })\n    const seenFeatures: Record<string, SPARQLFeature> = {}\n    rows.forEach(row => {\n      const rawData: Record<string, string>[] = [{}]\n      fields.forEach(field => {\n        if (field in row) {\n          const { value } = row[field]\n          let idx = 0\n          while (field.startsWith('sub_')) {\n            field = field.slice(4)\n            idx += 1\n          }\n          while (idx > rawData.length - 1) {\n            rawData.push({})\n          }\n          rawData[idx][field] = value\n        }\n      })\n\n      rawData.forEach((rd, idx) => {\n        const { uniqueId } = rd\n        if (idx < rawData.length - 1) {\n          rawData[idx + 1].parentUniqueId = uniqueId\n        }\n        seenFeatures[uniqueId] = {\n          data: {\n            ...rd,\n            uniqueId,\n            refName,\n            start: parseInt(rd.start, 10),\n            end: parseInt(rd.end, 10),\n            strand: parseInt(rd.strand, 10) || 0,\n          },\n        }\n      })\n    })\n\n    // resolve subfeatures, keeping only top-level features in seenFeatures\n    for (const [uniqueId, f] of Object.entries(seenFeatures)) {\n      const pid = f.data.parentUniqueId\n      delete f.data.parentUniqueId\n      if (pid) {\n        const p = seenFeatures[pid]\n        if (p) {\n          if (!p.data.subfeatures) {\n            p.data.subfeatures = []\n          }\n          p.data.subfeatures.push({\n            ...f.data,\n            uniqueId,\n          })\n          delete seenFeatures[uniqueId]\n        } else {\n          const subfeatures = Object.values(seenFeatures)\n            .map(sf => sf.data.subfeatures)\n            .filter(sf => !!sf)\n            .flat()\n          let found = false\n          for (const subfeature of subfeatures) {\n            if (subfeature && subfeature.uniqueId === pid) {\n              if (!subfeature.subfeatures) {\n                subfeature.subfeatures = []\n              }\n              subfeature.subfeatures.push({\n                ...f.data,\n                uniqueId,\n              })\n              delete seenFeatures[uniqueId]\n              found = true\n              break\n            } else if (subfeature && subfeature.subfeatures) {\n              subfeatures.push(...subfeature.subfeatures)\n            }\n          }\n          if (!found) {\n            console.error(`Could not find parentID ${pid}`)\n          }\n        }\n      }\n    }\n\n    return Object.keys(seenFeatures).map(\n      seenFeature =>\n        new SimpleFeature({\n          ...seenFeatures[seenFeature].data,\n          uniqueId: seenFeature,\n          subfeatures: seenFeatures[seenFeature].data.subfeatures,\n        }),\n    )\n  }\n\n  public async hasDataForRefName(\n    refName: string,\n    opts: BaseOptions = {},\n  ): Promise<boolean> {\n    const refNames = await this.getRefNames(opts)\n    if (refNames.length && !refNames.includes(refName)) {\n      return false\n    }\n    return true\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SPARQLAdapter',\n  {\n    endpoint: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'https://somesite.com/sparql' },\n      description: 'URL of the SPARQL endpoint',\n    },\n    queryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query where {start} {end} and {refName} will get replaced for each call',\n    },\n    refNamesQueryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query that returns the possible refNames in a ?refName column',\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Possible refNames used by the SPARQL endpoint (ignored if \"refNamesQueryTemplate\" is provided)',\n    },\n    additionalQueryParams: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Additional parameters to add to the query, e.g. \"format=JSON\"',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AdapterClass as SPARQLAdapterClass,\n  configSchema as sparqlAdapterConfigSchema,\n} from './SPARQLAdapter'\n\nexport default class RdfPlugin extends Plugin {\n  name = 'RdfPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SPARQLAdapter',\n          configSchema: sparqlAdapterConfigSchema,\n          AdapterClass: SPARQLAdapterClass,\n        }),\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BgzipFastaAdapter',\n  {\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz' },\n    },\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz.fai' },\n    },\n    gziLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz.gzi' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'ChromSizesAdapter',\n  {\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/species.chrom.sizes' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport {\n  bpSpanPx,\n  revcom,\n  complement,\n  defaultStarts,\n  defaultStops,\n  defaultCodonTable,\n  generateCodonTable,\n} from '@jbrowse/core/util'\n\ninterface MyProps {\n  exportSVG?: { rasterizeLayers: boolean }\n  features: Map<string, Feature>\n  regions: Region[]\n  bpPerPx: number\n  config: AnyConfigurationModel\n  highResolutionScaling: number\n  theme: any\n  showForward: boolean\n  showReverse: boolean\n  showTranslation: boolean\n}\n\nfunction Translation(props: {\n  codonTable: any\n  seq: string\n  frame: number\n  bpPerPx: number\n  region: Region\n  reverse?: boolean\n  height: number\n  y: number\n  theme?: any\n}) {\n  const {\n    codonTable,\n    seq,\n    frame,\n    bpPerPx,\n    region,\n    height,\n    y,\n    reverse = false,\n    theme,\n  } = props\n  const scale = bpPerPx\n\n  // the tilt variable normalizes the frame to where we are starting from,\n  // which increases consistency across blocks\n  const tilt = 3 - (region.start % 3)\n\n  // the effectiveFrame incorporates tilt and the frame to say what the\n  // effective frame that is plotted. The +3 is for when frame is -2 and this\n  // can otherwise result in effectiveFrame -1\n  const effectiveFrame = (frame + tilt + 3) % 3\n\n  const seqSliced = seq.slice(effectiveFrame)\n\n  const translated: { letter: string; codon: string }[] = []\n  for (let i = 0; i < seqSliced.length; i += 3) {\n    const codon = seqSliced.slice(i, i + 3)\n    const normalizedCodon = reverse ? revcom(codon) : codon\n    const aminoAcid = codonTable[normalizedCodon] || ''\n    translated.push({ letter: aminoAcid, codon: normalizedCodon.toUpperCase() })\n  }\n\n  const w = (1 / scale) * 3\n  const drop = region.start === 0 ? 0 : w\n  const render = 1 / bpPerPx >= 12\n  const width = (region.end - region.start) / bpPerPx\n\n  const map = ['#d8d8d8', '#adadad', '#8f8f8f'].reverse()\n  return (\n    <>\n      {translated.map((element, index) => {\n        const x = region.reversed\n          ? width - (w * (index + 1) + effectiveFrame / scale - drop)\n          : w * index + effectiveFrame / scale - drop\n        const { letter, codon } = element\n        return (\n          <React.Fragment key={`${index}-${letter}`}>\n            <rect\n              x={x}\n              y={y}\n              width={\n                render ? w : w + 0.7 /* small fudge factor when zoomed out*/\n              }\n              height={height}\n              stroke={render ? '#555' : 'none'}\n              fill={\n                defaultStarts.includes(codon)\n                  ? theme.palette.startCodon\n                  : defaultStops.includes(codon)\n                  ? theme.palette.stopCodon\n                  : map[Math.abs(frame)]\n              }\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction DNA(props: {\n  seq: string\n  theme: any\n  bpPerPx: number\n  height: number\n  region: Region\n  feature: Feature\n  y: number\n}) {\n  const { bpPerPx, region, feature, theme, height, seq, y } = props\n  const render = 1 / bpPerPx >= 12\n\n  const [leftPx, rightPx] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n  const reverse = region.reversed\n  const len = feature.get('end') - feature.get('start')\n  const w = Math.max((rightPx - leftPx) / len, 0.8)\n\n  return (\n    <>\n      {seq.split('').map((letter, index) => {\n        const color = theme.palette.bases[letter.toUpperCase()]\n        const x = reverse ? rightPx - (index + 1) * w : leftPx + index * w\n        return (\n          <React.Fragment key={index}>\n            <rect\n              x={x}\n              y={y}\n              width={w}\n              height={height}\n              fill={color ? color.main : '#aaa'}\n              stroke={render ? '#555' : 'none'}\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n                fill={color ? contrastingTextColor(color.main) : 'black'}\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nconst SequenceSVG = ({\n  regions,\n  theme: configTheme,\n  features = new Map(),\n  showReverse,\n  showForward,\n  showTranslation,\n  bpPerPx,\n}: any) => {\n  const [region] = regions\n  const theme = createJBrowseTheme(configTheme)\n  const codonTable = generateCodonTable(defaultCodonTable)\n  const height = 20\n  const [feature] = [...features.values()]\n  if (!feature) {\n    return null\n  }\n  const seq: string = feature.get('seq')\n  if (!seq) {\n    return null\n  }\n\n  // incrementer for the y-position of the current sequence being rendered\n  // (applies to both translation rows and dna rows)\n  let currY = -20\n\n  return (\n    <>\n      {/* the upper translation row. if the view is reversed, the reverse\n        translation is on the top */}\n      {showTranslation && (region.reversed ? showReverse : showForward)\n        ? [2, 1, 0].map(index => (\n            <Translation\n              key={`translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={region.reversed}\n            />\n          ))\n        : null}\n\n      {showForward ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? complement(seq) : seq}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {showReverse ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? seq : complement(seq)}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {/* the lower translation row. if the view is reversed, the forward\n        translation is on the bottom */}\n      {showTranslation && (region.reversed ? showForward : showReverse)\n        ? [0, -1, -2].map(index => (\n            <Translation\n              key={`rev-translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={!region.reversed}\n            />\n          ))\n        : null}\n    </>\n  )\n}\n\nconst Wrapper = ({ exportSVG, width, totalHeight, children }: any) => {\n  return exportSVG ? (\n    <>{children}</>\n  ) : (\n    <svg\n      width={width}\n      height={totalHeight}\n      style={{ width, height: totalHeight }}\n    >\n      {children}\n    </svg>\n  )\n}\n\nfunction Sequence(props: MyProps) {\n  const { regions, bpPerPx } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n  const totalHeight = 200\n\n  return (\n    <Wrapper {...props} totalHeight={totalHeight} width={width}>\n      <SequenceSVG {...props} />\n    </Wrapper>\n  )\n}\n\nexport default observer(Sequence)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'DivSequenceRenderer',\n  {\n    height: {\n      type: 'number',\n      description: 'height in pixels of each line of sequence',\n      defaultValue: 16,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'IndexedFastaAdapter',\n  {\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa' },\n    },\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.fai' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { configSchema as divSequenceRendererConfigSchema } from '../DivSequenceRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'LinearReferenceSequenceDisplay',\n  { renderer: divSequenceRendererConfigSchema },\n  { explicitIdentifier: 'displayId', explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'TwoBitAdapter',\n  {\n    twoBitLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.2bit' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'GCContentAdapter',\n    {\n      sequenceAdapter: pluginManager.pluggableConfigSchemaType('adapter'),\n    },\n    { explicitlyTyped: true },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  return {\n    configSchema: pluginManager.load(configSchemaF),\n    getAdapterClass: () => import('./GCContentAdapter').then(r => r.default),\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport { Region } from '@jbrowse/core/util/types'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { configSchema as bgzipFastaAdapterConfigSchema } from './BgzipFastaAdapter'\nimport { configSchema as chromSizesAdapterConfigSchema } from './ChromSizesAdapter'\nimport {\n  configSchema as divSequenceRendererConfigSchema,\n  ReactComponent as DivSequenceRendererReactComponent,\n} from './DivSequenceRenderer'\nimport { configSchema as indexedFastaAdapterConfigSchema } from './IndexedFastaAdapter'\nimport {\n  configSchema as linearReferenceSequenceDisplayConfigSchema,\n  modelFactory as linearReferenceSequenceDisplayModelFactory,\n} from './LinearReferenceSequenceDisplay'\nimport { configSchema as twoBitAdapterConfigSchema } from './TwoBitAdapter'\nimport GCContentAdapterF from './GCContentAdapter'\nimport { createReferenceSeqTrackConfig } from './referenceSeqTrackConfig'\n\n/* adjust in both directions */\nclass DivSequenceRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  getExpandedRegion(region: Region) {\n    return {\n      ...region,\n      start: Math.max(region.start - 3, 0),\n      end: region.end + 3,\n    }\n  }\n}\n\nexport default class SequencePlugin extends Plugin {\n  name = 'SequencePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'TwoBitAdapter',\n          configSchema: twoBitAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./TwoBitAdapter/TwoBitAdapter').then(r => r.default),\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'ChromSizesAdapter',\n          configSchema: chromSizesAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./ChromSizesAdapter/ChromSizesAdapter').then(\n              r => r.default,\n            ),\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'IndexedFastaAdapter',\n          configSchema: indexedFastaAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./IndexedFastaAdapter/IndexedFastaAdapter').then(\n              r => r.default,\n            ),\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BgzipFastaAdapter',\n          configSchema: bgzipFastaAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BgzipFastaAdapter/BgzipFastaAdapter').then(\n              r => r.default,\n            ),\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'GCContentAdapter',\n          ...pluginManager.load(GCContentAdapterF),\n        }),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = createReferenceSeqTrackConfig(pluginManager)\n\n      return new TrackType({\n        name: 'ReferenceSequenceTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'ReferenceSequenceTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const stateModel = linearReferenceSequenceDisplayModelFactory(\n        linearReferenceSequenceDisplayConfigSchema,\n      )\n      return {\n        name: 'LinearReferenceSequenceDisplay',\n        configSchema: linearReferenceSequenceDisplayConfigSchema,\n        stateModel,\n        trackType: 'ReferenceSequenceTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      }\n    })\n\n    pluginManager.addRendererType(\n      () =>\n        new DivSequenceRenderer({\n          name: 'DivSequenceRenderer',\n          ReactComponent: DivSequenceRendererReactComponent,\n          configSchema: divSequenceRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/*\nNote: this is primarily a copy of createBaseTrackConfig, except with a subset\nof the config slots, to avoid including fields that don't make sense for the\nReferenceSequenceTrack\n*/\nexport function createReferenceSeqTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ReferenceSequenceTrack',\n    {\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\nimport { getContainingView } from '@jbrowse/core/util'\n\nexport function modelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReferenceSequenceDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearReferenceSequenceDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showForward: types.optional(types.boolean, true),\n        showReverse: types.optional(types.boolean, true),\n        showTranslation: types.optional(types.boolean, true),\n        height: 180,\n      }),\n    )\n    .views(self => ({\n      get renderProps() {\n        const { showForward, showReverse, showTranslation } = self\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          config: self.configuration.renderer,\n          showForward,\n          showReverse,\n          showTranslation,\n        }\n      },\n      regionCannotBeRendered(/* region */) {\n        const view = getContainingView(self) as LinearGenomeViewModel\n        if (view && view.bpPerPx >= 1) {\n          return 'Zoom in to see sequence'\n        }\n        return undefined\n      },\n\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n    .actions(self => ({\n      toggleShowForward() {\n        self.showForward = !self.showForward\n      },\n      toggleShowReverse() {\n        self.showReverse = !self.showReverse\n      },\n      toggleShowTranslation() {\n        self.showTranslation = !self.showTranslation\n      },\n    }))\n    .views(self => ({\n      get trackMenuItems() {\n        return [\n          {\n            label: 'Show forward',\n            type: 'checkbox',\n            checked: self.showForward,\n            onClick: () => {\n              self.toggleShowForward()\n            },\n          },\n          {\n            label: 'Show reverse',\n            type: 'checkbox',\n            checked: self.showReverse,\n            onClick: () => {\n              self.toggleShowReverse()\n            },\n          },\n          {\n            label: 'Show translation',\n            type: 'checkbox',\n            checked: self.showTranslation,\n            onClick: () => {\n              self.toggleShowTranslation()\n            },\n          },\n        ]\n      },\n    }))\n}\n","import { inDevelopment } from '..'\n\ninterface AbsoluteCache {\n  dirty: boolean\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n  width?: number\n  height?: number\n}\n\nexport default class SceneGraph {\n  private name: string\n\n  public left: number\n\n  public top: number\n\n  public width: number\n\n  public height: number\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public data?: Record<string, any>\n\n  private children: Map<string, SceneGraph>\n\n  private absoluteCache: AbsoluteCache\n\n  public parent?: SceneGraph\n\n  /**\n   * note: all coordinates are inter-base or inter-pixel coordinates\n   */\n  constructor(\n    name: string,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data?: Record<string, any>,\n  ) {\n    if (\n      inDevelopment &&\n      (typeof name !== 'string' ||\n        typeof left !== 'number' ||\n        Number.isNaN(left) ||\n        typeof top !== 'number' ||\n        Number.isNaN(top) ||\n        typeof width !== 'number' ||\n        Number.isNaN(width) ||\n        typeof height !== 'number' ||\n        Number.isNaN(height))\n    ) {\n      throw new TypeError('invalid SceneGraph arguments')\n    }\n\n    this.name = name\n    this.left = left\n    this.top = top\n    this.width = width\n    this.height = height\n    this.data = data\n    this.children = new Map()\n    this.absoluteCache = { dirty: true }\n  }\n\n  addChild(\n    nameOrSceneGraph: string | SceneGraph,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data?: Record<string, any>,\n  ): SceneGraph {\n    let child: SceneGraph\n    if (nameOrSceneGraph instanceof SceneGraph) {\n      child = nameOrSceneGraph\n    } else {\n      child = new SceneGraph(nameOrSceneGraph, left, top, width, height, data)\n    }\n\n    if (!(child instanceof SceneGraph)) {\n      throw new TypeError(\n        'argument to addChild must be an array or a SceneGraph',\n      )\n    }\n\n    if (this.children.has(child.name)) {\n      throw new Error(`child named \"${child.name}\" already exists`)\n    }\n\n    // update the bounds to match the child\n    child.parent = this\n    const {\n      left: childLeft,\n      right: childRight,\n      top: childTop,\n      bottom: childBottom,\n    } = child.absolute\n    if (\n      childLeft !== undefined &&\n      childRight !== undefined &&\n      childTop !== undefined &&\n      childBottom !== undefined\n    ) {\n      this.expand(childLeft, childRight, childTop, childBottom)\n      this.children.set(child.name, child)\n    }\n    return child\n  }\n\n  getSubRecord(name: string): SceneGraph | undefined {\n    return this.children.get(name)\n  }\n\n  /**\n   * if the record does not already cover the given\n   * absolute extents, extend it to cover them\n   *\n   * @param left -\n   * @param right -\n   * @param top -\n   * @param bottom -\n   */\n  expand(\n    newLeft: number,\n    newRight: number,\n    newTop: number,\n    newBottom: number,\n  ): void {\n    const { left, right, top, bottom } = this.absolute\n    if (left !== undefined && newLeft < left) {\n      const diff = left - newLeft\n      this.width += diff\n      this.left -= diff\n    }\n    if (right !== undefined && newRight > right) {\n      this.width += newRight - right\n    }\n    if (top !== undefined && newTop < top) {\n      const diff = top - newTop\n      this.height += diff\n      this.top -= diff\n    }\n    if (bottom !== undefined && newBottom > bottom) {\n      this.height += newBottom - bottom\n    }\n    if (this.parent) {\n      this.parent.expand(newLeft, newRight, newTop, newBottom)\n    }\n    this.absoluteCache.dirty = true\n  }\n\n  get bottom(): number {\n    return this.top + this.height\n  }\n\n  get right(): number {\n    return this.left + this.width\n  }\n\n  walkParents(callback: Function): void {\n    if (this.parent) {\n      callback(this.parent)\n      this.parent.walkParents(callback)\n    }\n  }\n\n  walkChildren(callback: Function): void {\n    for (const sub of this.children.values()) {\n      callback(sub)\n      sub.walkChildren(callback)\n    }\n  }\n\n  get absolute(): AbsoluteCache {\n    if (this.absoluteCache.dirty) {\n      let xOffset = 0\n      let yOffset = 0\n      this.walkParents((node: SceneGraph) => {\n        xOffset += node.left\n        yOffset += node.top\n      })\n      this.absoluteCache = {\n        dirty: false,\n        left: this.left + xOffset,\n        right: this.right + xOffset,\n        top: this.top + yOffset,\n        bottom: this.bottom + yOffset,\n        width: this.width,\n        height: this.height,\n      }\n    }\n    return this.absoluteCache\n  }\n\n  move(x: number, y: number): void {\n    this.left += x\n    this.top += y\n\n    this.absoluteCache.dirty = true\n    this.walkChildren((c: SceneGraph) => {\n      c.absoluteCache.dirty = true\n    })\n    const { left, right, top, bottom } = this.absolute\n    if (\n      left !== undefined &&\n      right !== undefined &&\n      top !== undefined &&\n      bottom !== undefined\n    ) {\n      this.expand(left, right, top, bottom)\n    }\n  }\n}\n","import React from 'react'\n\nexport default function Label(props: {\n  text: string\n  x: number\n  y: number\n  color?: string\n  fontHeight?: number\n  featureWidth?: number\n  allowedWidthExpansion?: number\n  reversed?: boolean\n  fontWidthScaleFactor?: number\n}) {\n  const {\n    text,\n    x,\n    y,\n    color = 'black',\n    fontHeight = 13,\n    featureWidth,\n    reversed,\n    allowedWidthExpansion,\n    fontWidthScaleFactor = 0.6,\n  } = props\n\n  const fontWidth = fontHeight * fontWidthScaleFactor\n  const totalWidth =\n    featureWidth && allowedWidthExpansion\n      ? featureWidth + allowedWidthExpansion\n      : Infinity\n\n  return (\n    <text\n      x={reversed ? x + (featureWidth || 0) - fontWidth * text.length : x}\n      y={y + fontHeight}\n      style={{ fontSize: fontHeight, fill: color, cursor: 'default' }}\n    >\n      {fontWidth * text.length > totalWidth\n        ? `${text.slice(0, totalWidth / fontWidth)}...`\n        : text}\n    </text>\n  )\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport FeatureLabel from './FeatureLabel'\n\nfunction FeatureGlyph(props) {\n  const {\n    feature,\n    rootLayout,\n    selected,\n    config,\n    name,\n    shouldShowName,\n    description,\n    shouldShowDescription,\n    fontHeight,\n    allowedWidthExpansion,\n    reversed,\n  } = props\n\n  const featureLayout = rootLayout.getSubRecord(String(feature.id()))\n  const { GlyphComponent } = featureLayout.data\n\n  const glyphComponents = [\n    <GlyphComponent\n      key={`glyph-${feature.id()}`}\n      {...props}\n      feature={feature}\n      featureLayout={featureLayout}\n      selected={selected}\n    />,\n  ]\n\n  if (shouldShowName) {\n    glyphComponents.push(\n      <FeatureLabel\n        key={`glyph-name-${feature.id()}`}\n        text={name}\n        x={rootLayout.getSubRecord('nameLabel').absolute.left}\n        y={rootLayout.getSubRecord('nameLabel').absolute.top}\n        color={readConfObject(config, ['labels', 'nameColor'], { feature })}\n        fontHeight={fontHeight}\n        reversed={reversed}\n        featureWidth={featureLayout.width}\n        allowedWidthExpansion={allowedWidthExpansion}\n      />,\n    )\n  }\n\n  if (shouldShowDescription) {\n    glyphComponents.push(\n      <FeatureLabel\n        key={`glyph-description-${feature.id()}`}\n        text={description}\n        x={rootLayout.getSubRecord('descriptionLabel').absolute.left}\n        y={rootLayout.getSubRecord('descriptionLabel').absolute.top}\n        color={readConfObject(config, ['labels', 'descriptionColor'], {\n          feature,\n        })}\n        fontHeight={fontHeight}\n        featureWidth={featureLayout.width}\n        reversed={reversed}\n        allowedWidthExpansion={allowedWidthExpansion}\n      />,\n    )\n  }\n\n  return <g>{glyphComponents}</g>\n}\n\nFeatureGlyph.propTypes = {\n  feature: PropTypes.shape({\n    id: PropTypes.func.isRequired,\n    get: PropTypes.func.isRequired,\n  }).isRequired,\n  layout: PropTypes.shape({\n    addRect: PropTypes.func.isRequired,\n    getTotalHeight: PropTypes.func.isRequired,\n  }).isRequired,\n  rootLayout: PropTypes.shape({\n    addChild: PropTypes.func.isRequired,\n    getSubRecord: PropTypes.func.isRequired,\n  }).isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: PropTypes.number.isRequired,\n  reversed: PropTypes.bool,\n  selected: PropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  name: PropTypes.string,\n  shouldShowName: PropTypes.bool,\n  description: PropTypes.string,\n  shouldShowDescription: PropTypes.bool,\n  fontHeight: PropTypes.number,\n  allowedWidthExpansion: PropTypes.number,\n  movedDuringLastMouseDown: PropTypes.bool.isRequired,\n}\n\nFeatureGlyph.defaultProps = {\n  reversed: false,\n  selected: false,\n  name: '',\n  shouldShowName: false,\n  description: '',\n  shouldShowDescription: false,\n  fontHeight: undefined,\n  allowedWidthExpansion: undefined,\n}\n\nexport default observer(FeatureGlyph)\n","import { bpSpanPx } from '@jbrowse/core/util'\nimport SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { observer } from 'mobx-react'\nimport React from 'react'\n\ntype LayoutRecord = [number, number, number, number]\ninterface SvgOverlayProps {\n  region: Region\n  displayModel: {\n    blockLayoutFeatures: Map<string, Map<string, LayoutRecord>>\n    selectedFeatureId?: string\n    featureIdUnderMouse?: string\n    contextMenuFeature?: SimpleFeature\n  }\n  bpPerPx: number\n  blockKey: string\n  movedDuringLastMouseDown: boolean\n  onFeatureMouseDown?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseEnter?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOut?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOver?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseUp?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseLeave?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseMove?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  // synthesized from mouseup and mousedown\n  onFeatureClick?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureContextMenu?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n}\n\ninterface OverlayRectProps extends React.SVGProps<SVGRectElement> {\n  rect?: LayoutRecord\n  region: Region\n  bpPerPx: number\n}\n\nfunction OverlayRect({\n  rect,\n  region,\n  bpPerPx,\n  ...rectProps\n}: OverlayRectProps) {\n  if (!rect) {\n    return null\n  }\n  const [leftBp, topPx, rightBp, bottomPx] = rect\n  const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n  const rectTop = Math.round(topPx)\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const rectHeight = Math.round(bottomPx - topPx)\n  const width = rightPx - leftPx\n\n  if (leftPx + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(leftPx, 0)\n  const diff = leftWithinBlock - leftPx\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      x={leftWithinBlock - 2}\n      y={rectTop - 2}\n      width={widthWithinBlock + 4}\n      height={rectHeight + 4}\n      {...rectProps}\n    />\n  )\n}\n\nfunction SvgOverlay({\n  displayModel: {\n    blockLayoutFeatures,\n    selectedFeatureId,\n    featureIdUnderMouse,\n    contextMenuFeature,\n  },\n  blockKey,\n  region,\n  bpPerPx,\n  movedDuringLastMouseDown,\n  ...handlers\n}: SvgOverlayProps) {\n  const blockLayout = blockLayoutFeatures?.get(blockKey)\n  if (!blockLayout) {\n    return null\n  }\n  const mouseoverFeatureId = featureIdUnderMouse || contextMenuFeature?.id()\n\n  function onFeatureMouseDown(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseDown: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseEnter(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseEnter: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOut(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOut: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOver(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOver: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseUp(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseUp: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseLeave(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseLeave: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseMove(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseMove: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureClick(event: React.MouseEvent<SVGRectElement, MouseEvent>) {\n    if (movedDuringLastMouseDown) {\n      return undefined\n    }\n    const { onFeatureClick: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureContextMenu(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureContextMenu: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  return (\n    <>\n      {mouseoverFeatureId ? (\n        <OverlayRect\n          rect={blockLayout.get(mouseoverFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          fill=\"#000\"\n          fillOpacity=\"0.2\"\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onContextMenu={onFeatureContextMenu}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n          data-testid={mouseoverFeatureId}\n        />\n      ) : null}\n      {selectedFeatureId ? (\n        <OverlayRect\n          rect={blockLayout.get(selectedFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          stroke=\"#00b8ff\"\n          fill=\"none\"\n        />\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(SvgOverlay)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { emphasize } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Box(props) {\n  const { feature, region, config, featureLayout, selected, bpPerPx } = props\n  const screenWidth = (region.end - region.start) / bpPerPx\n\n  const color1 = readConfObject(config, 'color1', { feature })\n  let emphasizedColor1\n  try {\n    emphasizedColor1 = emphasize(color1, 0.3)\n  } catch (error) {\n    emphasizedColor1 = color1\n  }\n  const color2 = readConfObject(config, 'color2', { feature })\n\n  const { left, top, width, height } = featureLayout.absolute\n\n  if (left + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      data-testid={`box-${feature.id()}`}\n      x={leftWithinBlock}\n      y={top}\n      width={widthWithinBlock}\n      height={height}\n      fill={selected ? emphasizedColor1 : color1}\n      stroke={selected ? color2 : undefined}\n    />\n  )\n}\n\nBox.propTypes = {\n  feature: ReactPropTypes.shape({\n    get: ReactPropTypes.func.isRequired,\n    id: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  featureLayout: ReactPropTypes.shape({\n    absolute: ReactPropTypes.shape({\n      top: ReactPropTypes.number.isRequired,\n      left: ReactPropTypes.number.isRequired,\n      width: ReactPropTypes.number.isRequired,\n      height: ReactPropTypes.number.isRequired,\n    }),\n  }).isRequired,\n  selected: ReactPropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nBox.defaultProps = {\n  selected: false,\n}\n\nexport default observer(Box)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { emphasize } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport { isUTR } from './util'\n\nconst utrHeightFraction = 0.65\n\nfunction Chevron(props) {\n  const {\n    feature,\n    bpPerPx,\n    region,\n    config,\n    featureLayout,\n    selected,\n    reversed,\n  } = props\n\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const width = Math.max(featureLayout.absolute.width, 1)\n  const { left } = featureLayout.absolute\n  let { top, height } = featureLayout.absolute\n  if (isUTR(feature)) {\n    top += ((1 - utrHeightFraction) / 2) * height\n    height *= utrHeightFraction\n  }\n\n  const strand = feature.get('strand')\n  const direction = strand * (reversed ? -1 : 1)\n  const color = isUTR(feature)\n    ? readConfObject(config, 'color3', { feature })\n    : readConfObject(config, 'color1', { feature })\n  let emphasizedColor\n  try {\n    emphasizedColor = emphasize(color, 0.3)\n  } catch (error) {\n    emphasizedColor = color\n  }\n  const color2 = readConfObject(config, 'color2', { feature })\n\n  if (left + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <>\n      <rect\n        data-testid={feature.id()}\n        stroke={selected ? color2 : undefined}\n        fill={selected ? emphasizedColor : color}\n        x={leftWithinBlock}\n        y={top}\n        width={widthWithinBlock}\n        height={height}\n      />\n      {direction < 0 && diff === 0 ? (\n        <polygon\n          stroke={selected ? color2 : undefined}\n          fill={selected ? emphasizedColor : color}\n          points={[\n            [left, top],\n            [left - height / 2, top + height / 2],\n            [left, top + height],\n          ]}\n        />\n      ) : null}\n      {direction > 0 && leftWithinBlock + widthWithinBlock < screenWidth ? (\n        <polygon\n          stroke={selected ? color2 : undefined}\n          fill={selected ? emphasizedColor : color}\n          points={[\n            [leftWithinBlock + widthWithinBlock, top],\n            [leftWithinBlock + widthWithinBlock + height / 2, top + height / 2],\n            [leftWithinBlock + widthWithinBlock, top + height],\n          ]}\n        />\n      ) : null}\n    </>\n  )\n}\n\nChevron.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  featureLayout: ReactPropTypes.shape({\n    absolute: ReactPropTypes.shape({\n      top: ReactPropTypes.number.isRequired,\n      left: ReactPropTypes.number.isRequired,\n      width: ReactPropTypes.number.isRequired,\n      height: ReactPropTypes.number.isRequired,\n    }),\n  }).isRequired,\n  selected: ReactPropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  reversed: ReactPropTypes.bool,\n}\n\nChevron.defaultProps = {\n  selected: false,\n  reversed: false,\n}\n\nexport default observer(Chevron)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { emphasize } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Segments(props) {\n  const {\n    feature,\n    featureLayout,\n    selected,\n    config,\n    reversed,\n    // some subfeatures may be computed e.g. makeUTRs,\n    // so these are passed as a prop\n    // eslint-disable-next-line react/prop-types\n    subfeatures: subfeaturesProp,\n  } = props\n\n  const subfeatures = subfeaturesProp || feature.get('subfeatures')\n  const color2 = readConfObject(config, 'color2', { feature })\n  let emphasizedColor2\n  try {\n    emphasizedColor2 = emphasize(color2, 0.3)\n  } catch (error) {\n    emphasizedColor2 = color2\n  }\n  const { left, top, width, height } = featureLayout.absolute\n  const points = [\n    [left, top + height / 2],\n    [left + width, top + height / 2],\n  ]\n  const strand = feature.get('strand')\n  if (strand) {\n    points.push(\n      [left + width - height / 4, top + height / 4],\n      [left + width - height / 4, top + 3 * (height / 4)],\n      [left + width, top + height / 2],\n    )\n  }\n\n  return (\n    <>\n      <polyline\n        data-testid={feature.id()}\n        transform={\n          strand && ((!reversed && strand < 0) || (reversed && strand > 0))\n            ? `rotate(180,${left + width / 2},${top + height / 2})`\n            : undefined\n        }\n        points={points}\n        stroke={selected ? emphasizedColor2 : color2}\n      />\n      {\n        // eslint-disable-next-line react/prop-types\n        subfeatures.map(subfeature => {\n          const subfeatureId = String(subfeature.id())\n          const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n          // This subfeature got filtered out\n          if (!subfeatureLayout) {\n            return null\n          }\n          const { GlyphComponent } = subfeatureLayout.data\n          return (\n            <GlyphComponent\n              key={`glyph-${subfeatureId}`}\n              {...props}\n              feature={subfeature}\n              featureLayout={subfeatureLayout}\n              selected={selected}\n            />\n          )\n        })\n      }\n    </>\n  )\n}\n\nSegments.propTypes = {\n  feature: PropTypes.shape({\n    id: PropTypes.func.isRequired,\n    get: PropTypes.func.isRequired,\n  }).isRequired,\n  featureLayout: PropTypes.shape({\n    absolute: PropTypes.shape({\n      top: PropTypes.number.isRequired,\n      left: PropTypes.number.isRequired,\n      width: PropTypes.number.isRequired,\n      height: PropTypes.number.isRequired,\n    }),\n    getSubRecord: PropTypes.func.isRequired,\n  }).isRequired,\n  selected: PropTypes.bool,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  reversed: PropTypes.bool,\n}\n\nSegments.defaultProps = {\n  selected: false,\n  reversed: false,\n}\n\nexport default observer(Segments)\n","import { observer } from 'mobx-react'\nimport React from 'react'\nimport SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport Segments from './Segments'\nimport { layOutFeature, layOutSubfeatures } from './util'\n\nfunction ProcessedTranscript(props) {\n  // eslint-disable-next-line react/prop-types\n  const { feature, config } = props\n  const subfeatures = getSubparts(feature, config)\n\n  // we manually compute some subfeatures, so pass these separately\n  return <Segments {...props} subfeatures={subfeatures} />\n}\n\n// make a function that will filter features features according to the\n// subParts conf var\nfunction makeSubpartsFilter(confKey = 'subParts', config) {\n  let filter = readConfObject(config, confKey)\n\n  if (typeof filter == 'string') {\n    // convert to array\n    filter = filter.split(/\\s*,\\s*/)\n  }\n\n  if (Array.isArray(filter)) {\n    const typeNames = filter.map(typeName => typeName.toLowerCase())\n    return feature => {\n      return typeNames.includes(feature.get('type').toLowerCase())\n    }\n  }\n  if (typeof filter === 'function') {\n    return filter\n  }\n  return () => true\n}\n\nfunction filterSubpart(feature, config) {\n  return makeSubpartsFilter('subParts', config)(feature)\n}\n\nfunction isUTR(feature) {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n\nfunction makeUTRs(parent, subs) {\n  // based on Lincoln's UTR-making code in Bio::Graphics::Glyph::processed_transcript\n  const subparts = [...subs]\n\n  let codeStart = Infinity\n  let codeEnd = -Infinity\n\n  let haveLeftUTR\n  let haveRightUTR\n\n  // gather exons, find coding start and end, and look for UTRs\n  const exons = []\n  for (let i = 0; i < subparts.length; i++) {\n    const type = subparts[i].get('type')\n    if (/^cds/i.test(type)) {\n      if (codeStart > subparts[i].get('start')) {\n        codeStart = subparts[i].get('start')\n      }\n      if (codeEnd < subparts[i].get('end')) {\n        codeEnd = subparts[i].get('end')\n      }\n    } else if (/exon/i.test(type)) {\n      exons.push(subparts[i])\n    } else if (isUTR(subparts[i])) {\n      haveLeftUTR = subparts[i].get('start') === parent.get('start')\n      haveRightUTR = subparts[i].get('end') === parent.get('end')\n    }\n  }\n\n  // bail if we don't have exons and CDS\n  if (!(exons.length && codeStart < Infinity && codeEnd > -Infinity)) {\n    return subparts\n  }\n\n  // make sure the exons are sorted by coord\n  exons.sort((a, b) => a.get('start') - b.get('start'))\n\n  const strand = parent.get('strand')\n\n  // make the left-hand UTRs\n  let start\n  let end\n  if (!haveLeftUTR) {\n    for (let i = 0; i < exons.length; i++) {\n      start = exons[i].get('start')\n      if (start >= codeStart) {\n        break\n      }\n      end = codeStart > exons[i].get('end') ? exons[i].get('end') : codeStart\n      const type = strand >= 0 ? 'five_prime_UTR' : 'three_prime_UTR'\n      subparts.unshift(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  // make the right-hand UTRs\n  if (!haveRightUTR) {\n    for (let i = exons.length - 1; i >= 0; i--) {\n      end = exons[i].get('end')\n      if (end <= codeEnd) {\n        break\n      }\n\n      start = codeEnd < exons[i].get('start') ? exons[i].get('start') : codeEnd\n      const type = strand >= 0 ? 'three_prime_UTR' : 'five_prime_UTR'\n      subparts.push(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  return subparts\n}\n\nfunction getSubparts(f, config) {\n  let c = f.get('subfeatures')\n  if (!c || !c.length) {\n    return []\n  }\n  const hasUTRs = !!c.find(child => isUTR(child))\n  const isTranscript = ['mRNA', 'transcript'].includes(f.get('type'))\n  const impliedUTRs = !hasUTRs && isTranscript\n\n  // if we think we should use impliedUTRs, or it is specifically in the\n  // config, then makeUTRs\n  if (impliedUTRs || readConfObject(config, 'impliedUTRs')) {\n    c = makeUTRs(f, c)\n  }\n\n  return c.filter(element => filterSubpart(element, config))\n}\n\nProcessedTranscript.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  const subfeatures = getSubparts(feature, config)\n  layOutSubfeatures({\n    layout: subLayout,\n    subfeatures,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  return subLayout\n}\n\nexport default observer(ProcessedTranscript)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { chooseGlyphComponent, layOut, layOutFeature } from './util'\n\nfunction Subfeatures(props) {\n  const { feature, featureLayout, selected } = props\n\n  return (\n    <>\n      {feature.get('subfeatures').map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        const { GlyphComponent } = subfeatureLayout.data\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n    </>\n  )\n}\n\nSubfeatures.propTypes = {\n  feature: PropTypes.shape({ get: PropTypes.func.isRequired }).isRequired,\n  featureLayout: PropTypes.shape({\n    getSubRecord: PropTypes.func.isRequired,\n  }).isRequired,\n  selected: PropTypes.bool,\n  reversed: PropTypes.bool,\n}\n\nSubfeatures.defaultProps = {\n  selected: false,\n  reversed: false,\n}\n\nSubfeatures.layOut = ({ layout, feature, bpPerPx, reversed, config }) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  const displayMode = readConfObject(config, 'displayMode')\n  if (displayMode !== 'reducedRepresentation') {\n    const subfeatures = feature.get('subfeatures') || []\n    let topOffset = 0\n    subfeatures.forEach(subfeature => {\n      const SubfeatureGlyphComponent = chooseGlyphComponent(subfeature)\n      const subfeatureHeight = readConfObject(config, 'height', {\n        feature: subfeature,\n      })\n\n      const subSubLayout = (SubfeatureGlyphComponent.layOut || layOut)({\n        layout: subLayout,\n        feature: subfeature,\n        bpPerPx,\n        reversed,\n        config,\n      })\n      subSubLayout.move(0, topOffset)\n      topOffset +=\n        displayMode === 'collapse'\n          ? 0\n          : (displayMode === 'compact'\n              ? subfeatureHeight / 3\n              : subfeatureHeight) + 2\n    })\n  }\n  return subLayout\n}\n\nexport default observer(Subfeatures)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Box from './Box'\nimport Chevron from './Chevron'\nimport ProcessedTranscript from './ProcessedTranscript'\nimport Segments from './Segments'\nimport Subfeatures from './Subfeatures'\n\ninterface Glyph extends React.FunctionComponent {\n  layOut?: Function\n}\n\nexport function chooseGlyphComponent(feature: Feature): Glyph {\n  const type = feature.get('type')\n  const strand = feature.get('strand')\n  const subfeatures: Feature[] = feature.get('subfeatures')\n\n  if (subfeatures) {\n    const hasSubSub = subfeatures.find(subfeature => {\n      return !!subfeature.get('subfeatures')\n    })\n    if (hasSubSub) {\n      return Subfeatures\n    }\n    const transcriptTypes = ['mRNA', 'transcript']\n    if (\n      transcriptTypes.includes(type) &&\n      subfeatures.find(f => f.get('type') === 'CDS')\n    ) {\n      return ProcessedTranscript\n    }\n    return Segments\n  }\n  return [1, -1].includes(strand) ? Chevron : Box\n}\n\ninterface BaseLayOutArgs {\n  layout: SceneGraph\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n}\n\ninterface FeatureLayOutArgs extends BaseLayOutArgs {\n  feature: Feature\n}\n\ninterface SubfeatureLayOutArgs extends BaseLayOutArgs {\n  subfeatures: Feature[]\n}\n\nexport function layOut({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n}: FeatureLayOutArgs): SceneGraph {\n  const displayMode = readConfObject(config, 'displayMode')\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  if (displayMode !== 'reducedRepresentation') {\n    layOutSubfeatures({\n      layout: subLayout,\n      subfeatures: feature.get('subfeatures') || [],\n      bpPerPx,\n      reversed,\n      config,\n    })\n  }\n  return subLayout\n}\n\nexport function layOutFeature(args: FeatureLayOutArgs): SceneGraph {\n  const { layout, feature, bpPerPx, reversed, config } = args\n  const displayMode = readConfObject(config, 'displayMode')\n  const GlyphComponent =\n    displayMode === 'reducedRepresentation'\n      ? Chevron\n      : chooseGlyphComponent(feature)\n  const parentFeature = feature.parent()\n  let x = 0\n  if (parentFeature) {\n    x = reversed\n      ? (parentFeature.get('end') - feature.get('end')) / bpPerPx\n      : (feature.get('start') - parentFeature.get('start')) / bpPerPx\n  }\n  const height = readConfObject(config, 'height', { feature })\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const layoutParent = layout.parent\n  const top = layoutParent ? layoutParent.top : 0\n  const subLayout = layout.addChild(\n    String(feature.id()),\n    x,\n    displayMode === 'collapse' ? 0 : top,\n    width,\n    displayMode === 'compact' ? height / 2 : height,\n    { GlyphComponent },\n  )\n  return subLayout\n}\n\nexport function layOutSubfeatures(args: SubfeatureLayOutArgs): void {\n  const { layout: subLayout, subfeatures, bpPerPx, reversed, config } = args\n  subfeatures.forEach(subfeature => {\n    const SubfeatureGlyphComponent = chooseGlyphComponent(subfeature)\n    ;(SubfeatureGlyphComponent.layOut || layOut)({\n      layout: subLayout,\n      feature: subfeature,\n      bpPerPx,\n      reversed,\n      config,\n    })\n  })\n}\n\nexport function isUTR(feature: Feature): boolean {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { bpToPx } from '@jbrowse/core/util'\nimport SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React, { useEffect, useRef, useState, useCallback } from 'react'\nimport FeatureGlyph from './FeatureGlyph'\nimport SvgOverlay from './SvgOverlay'\nimport { chooseGlyphComponent, layOut } from './util'\n\nconst fontWidthScaleFactor = 0.6\nconst renderingStyle = {\n  position: 'relative',\n}\n\nfunction RenderedFeatureGlyph(props) {\n  const { feature, bpPerPx, region, config, displayMode, layout } = props\n  const { reversed } = region\n  const start = feature.get(reversed ? 'end' : 'start')\n  const startPx = bpToPx(start, region, bpPerPx)\n  const labelsAllowed = displayMode !== 'compact' && displayMode !== 'collapsed'\n\n  const rootLayout = new SceneGraph('root', 0, 0, 0, 0)\n  const GlyphComponent = chooseGlyphComponent(feature)\n  const featureLayout = (GlyphComponent.layOut || layOut)({\n    layout: rootLayout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n  })\n  let shouldShowName\n  let shouldShowDescription\n  let name\n  let description\n  let fontHeight\n  let expansion\n  if (labelsAllowed) {\n    const showLabels = readConfObject(config, 'showLabels')\n    fontHeight = readConfObject(config, ['labels', 'fontSize'], { feature })\n    expansion = readConfObject(config, 'maxFeatureGlyphExpansion') || 0\n    name = readConfObject(config, ['labels', 'name'], { feature }) || ''\n    shouldShowName = /\\S/.test(name) && showLabels\n\n    description =\n      readConfObject(config, ['labels', 'description'], { feature }) || ''\n    shouldShowDescription = /\\S/.test(description) && showLabels\n    const fontWidth = fontHeight * fontWidthScaleFactor\n    const textVerticalPadding = 2\n\n    let nameWidth = 0\n    if (shouldShowName) {\n      nameWidth = Math.round(\n        Math.min(String(name).length * fontWidth, rootLayout.width + expansion),\n      )\n      rootLayout.addChild(\n        'nameLabel',\n        0,\n        featureLayout.bottom + textVerticalPadding,\n        nameWidth,\n        fontHeight,\n      )\n    }\n\n    let descriptionWidth = 0\n    if (shouldShowDescription) {\n      const aboveLayout = shouldShowName\n        ? rootLayout.getSubRecord('nameLabel')\n        : featureLayout\n      descriptionWidth = Math.round(\n        Math.min(\n          String(description).length * fontWidth,\n          rootLayout.width + expansion,\n        ),\n      )\n      rootLayout.addChild(\n        'descriptionLabel',\n        0,\n        aboveLayout.bottom + textVerticalPadding,\n        descriptionWidth,\n        fontHeight,\n      )\n    }\n  }\n\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start'),\n    feature.get('start') + rootLayout.width * bpPerPx,\n    rootLayout.height,\n  )\n  if (topPx === null) {\n    return null\n  }\n  rootLayout.move(startPx, topPx)\n\n  return (\n    <FeatureGlyph\n      key={`svg-feature-${feature.id()}`}\n      feature={feature}\n      layout={layout}\n      rootLayout={rootLayout}\n      bpPerPx={bpPerPx}\n      config={config}\n      name={String(name)}\n      shouldShowName={shouldShowName}\n      description={String(description)}\n      shouldShowDescription={shouldShowDescription}\n      fontHeight={fontHeight}\n      allowedWidthExpansion={expansion}\n      reversed={region.reversed}\n      {...props}\n    />\n  )\n}\n\nRenderedFeatureGlyph.propTypes = {\n  layout: ReactPropTypes.shape({\n    addRect: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  displayMode: ReactPropTypes.string.isRequired,\n  region: CommonPropTypes.Region.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nconst RenderedFeatures = observer(props => {\n  const { features } = props\n  const featuresRendered = []\n  for (const feature of features.values()) {\n    featuresRendered.push(\n      <RenderedFeatureGlyph key={feature.id()} feature={feature} {...props} />,\n    )\n  }\n  return <>{featuresRendered}</>\n})\nRenderedFeatures.propTypes = {\n  features: ReactPropTypes.oneOfType([\n    ReactPropTypes.instanceOf(Map),\n    ReactPropTypes.arrayOf(ReactPropTypes.shape()),\n  ]),\n  layout: ReactPropTypes.shape({\n    addRect: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n}\n\nRenderedFeatures.defaultProps = {\n  features: [],\n}\n\nfunction SvgFeatureRendering(props) {\n  const {\n    layout,\n    blockKey,\n    regions,\n    bpPerPx,\n    features,\n    config,\n    displayModel,\n    exportSVG,\n  } = props\n  const [region] = regions || []\n  const width = (region.end - region.start) / bpPerPx\n  const displayMode = readConfObject(config, 'displayMode')\n\n  const ref = useRef()\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] = useState(\n    false,\n  )\n  const [height, setHeight] = useState(0)\n  const {\n    onMouseOut,\n    onMouseDown,\n    onMouseLeave,\n    onMouseEnter,\n    onMouseOver,\n    onMouseMove,\n    onMouseUp,\n    onClick,\n  } = props\n\n  const mouseDown = useCallback(\n    event => {\n      setMouseIsDown(true)\n      setMovedDuringLastMouseDown(false)\n      const handler = onMouseDown\n      if (!handler) {\n        return undefined\n      }\n      return handler(event)\n    },\n    [onMouseDown],\n  )\n\n  const mouseUp = useCallback(\n    event => {\n      setMouseIsDown(false)\n      const handler = onMouseUp\n      if (!handler) {\n        return undefined\n      }\n      return handler(event)\n    },\n    [onMouseUp],\n  )\n\n  const mouseEnter = useCallback(\n    event => {\n      const handler = onMouseEnter\n      if (!handler) {\n        return undefined\n      }\n      return handler(event)\n    },\n    [onMouseEnter],\n  )\n\n  const mouseLeave = useCallback(\n    event => {\n      const handler = onMouseLeave\n      if (!handler) {\n        return undefined\n      }\n      return handler(event)\n    },\n    [onMouseLeave],\n  )\n\n  const mouseOver = useCallback(\n    event => {\n      const handler = onMouseOver\n      if (!handler) {\n        return undefined\n      }\n      return handler(event)\n    },\n    [onMouseOver],\n  )\n\n  const mouseOut = useCallback(\n    event => {\n      const handler = onMouseOut\n      if (!handler) {\n        return undefined\n      }\n      return handler(event)\n    },\n    [onMouseOut],\n  )\n\n  const mouseMove = useCallback(\n    event => {\n      if (mouseIsDown) {\n        setMovedDuringLastMouseDown(true)\n      }\n      let offsetX = 0\n      let offsetY = 0\n      if (ref.current) {\n        offsetX = ref.current.getBoundingClientRect().left\n        offsetY = ref.current.getBoundingClientRect().top\n      }\n      offsetX = event.clientX - offsetX\n      offsetY = event.clientY - offsetY\n      const px = region.reversed ? width - offsetX : offsetX\n      const clientBp = region.start + bpPerPx * px\n\n      const feats = displayModel.getFeatureOverlapping(\n        blockKey,\n        clientBp,\n        offsetY,\n      )\n      const featureIdCurrentlyUnderMouse = feats.length\n        ? feats[0].name\n        : undefined\n\n      if (onMouseMove) {\n        onMouseMove(event, featureIdCurrentlyUnderMouse)\n      }\n    },\n    [\n      blockKey,\n      bpPerPx,\n      mouseIsDown,\n      onMouseMove,\n      region.reversed,\n      region.start,\n      displayModel,\n      width,\n    ],\n  )\n\n  const click = useCallback(\n    event => {\n      // don't select a feature if we are clicking and dragging\n      if (movedDuringLastMouseDown) {\n        return\n      }\n      if (onClick) {\n        onClick(event)\n      }\n    },\n    [movedDuringLastMouseDown, onClick],\n  )\n\n  useEffect(() => {\n    setHeight(layout.getTotalHeight())\n  }, [layout])\n\n  if (exportSVG) {\n    return (\n      <RenderedFeatures\n        features={features}\n        displayMode={displayMode}\n        {...props}\n        region={region}\n      />\n    )\n  }\n  return (\n    <div style={renderingStyle}>\n      <svg\n        ref={ref}\n        className=\"SvgFeatureRendering\"\n        width={`${width}px`}\n        height={`${height}px`}\n        onMouseDown={mouseDown}\n        onMouseUp={mouseUp}\n        onMouseEnter={mouseEnter}\n        onMouseLeave={mouseLeave}\n        onMouseOver={mouseOver}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n        onFocus={mouseEnter}\n        onBlur={mouseLeave}\n        onClick={click}\n        style={{ display: 'block' }}\n      >\n        <RenderedFeatures\n          features={features}\n          displayMode={displayMode}\n          {...props}\n          region={region}\n          movedDuringLastMouseDown={movedDuringLastMouseDown}\n        />\n        <SvgOverlay {...props} region={region} />\n      </svg>\n    </div>\n  )\n}\n\nSvgFeatureRendering.propTypes = {\n  layout: ReactPropTypes.shape({\n    addRect: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  regions: ReactPropTypes.arrayOf(CommonPropTypes.Region).isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  features: ReactPropTypes.oneOfType([\n    ReactPropTypes.instanceOf(Map),\n    ReactPropTypes.arrayOf(ReactPropTypes.shape()),\n  ]),\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  displayModel: ReactPropTypes.shape({\n    configuration: ReactPropTypes.shape({}),\n    getFeatureOverlapping: ReactPropTypes.func,\n    selectedFeatureId: ReactPropTypes.string,\n    featureIdUnderMouse: ReactPropTypes.string,\n  }),\n\n  onMouseDown: ReactPropTypes.func,\n  onMouseUp: ReactPropTypes.func,\n  onMouseEnter: ReactPropTypes.func,\n  onMouseLeave: ReactPropTypes.func,\n  onMouseOver: ReactPropTypes.func,\n  onMouseOut: ReactPropTypes.func,\n  onMouseMove: ReactPropTypes.func,\n  onClick: ReactPropTypes.func,\n  onContextMenu: ReactPropTypes.func,\n  onFeatureClick: ReactPropTypes.func,\n  onFeatureContextMenu: ReactPropTypes.func,\n  blockKey: ReactPropTypes.string,\n  exportSVG: ReactPropTypes.shape({}),\n}\n\nSvgFeatureRendering.defaultProps = {\n  displayModel: {},\n  exportSVG: undefined,\n\n  features: new Map(),\n  blockKey: undefined,\n\n  onMouseDown: undefined,\n  onMouseUp: undefined,\n  onMouseEnter: undefined,\n  onMouseLeave: undefined,\n  onMouseOver: undefined,\n  onMouseOut: undefined,\n  onMouseMove: undefined,\n  onClick: undefined,\n  onContextMenu: undefined,\n  onFeatureClick: undefined,\n  onFeatureContextMenu: undefined,\n}\n\nexport default observer(SvgFeatureRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'SvgFeatureRenderer',\n  {\n    color1: {\n      type: 'color',\n      description: 'the main color of each feature',\n      defaultValue: 'goldenrod',\n      contextVariable: ['feature'],\n    },\n    color2: {\n      type: 'color',\n      description:\n        'the secondary color of each feature, used for connecting lines, etc',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    color3: {\n      type: 'color',\n      description:\n        'the tertiary color of each feature, often used for contrasting fills, like on UTRs',\n      defaultValue: '#357089',\n      contextVariable: ['feature'],\n    },\n    height: {\n      type: 'number',\n      description: 'height in pixels of the main body of each feature',\n      defaultValue: 10,\n      contextVariable: ['feature'],\n    },\n    showLabels: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    labels: ConfigurationSchema('SvgFeatureLabels', {\n      name: {\n        type: 'string',\n        description:\n          'the primary name of the feature to show, if space is available',\n        defaultValue: `jexl:get(feature,'name') || get(feature,'id')`,\n        contextVariable: ['feature'],\n      },\n      nameColor: {\n        type: 'color',\n        description: 'the color of the name label, if shown',\n        defaultValue: 'black',\n        contextVariable: ['feature'],\n      },\n      description: {\n        type: 'string',\n        description: 'the text description to show, if space is available',\n        defaultValue: `jexl:get(feature,'note') || get(feature,'description')`,\n        contextVariable: ['feature'],\n      },\n      descriptionColor: {\n        type: 'color',\n        description: 'the color of the description, if shown',\n        defaultValue: 'blue',\n        contextVariable: ['feature'],\n      },\n      fontSize: {\n        type: 'number',\n        description:\n          'height in pixels of the text to use for names and descriptions',\n        defaultValue: 13,\n        contextVariable: ['feature'],\n      },\n    }),\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'reducedRepresentation',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    maxFeatureGlyphExpansion: {\n      type: 'number',\n      description:\n        \"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use\",\n      defaultValue: 500,\n    },\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a svg rendering',\n      defaultValue: 600,\n    },\n    subParts: {\n      type: 'string',\n      description: 'subparts for a glyph',\n      defaultValue: 'CDS,UTR,five_prime_UTR,three_prime_UTR',\n    },\n    impliedUTRs: {\n      type: 'boolean',\n      description: 'imply UTR from the exon and CDS differences',\n      defaultValue: false,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as svgFeatureRendererConfigSchema,\n  ReactComponent as SvgFeatureRendererReactComponent,\n} from './SvgFeatureRenderer'\n\nclass SvgFeatureRenderer extends BoxRendererType {\n  supportsSVG = true\n}\n\nexport default class SVGPlugin extends Plugin {\n  name = 'SVGPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new SvgFeatureRenderer({\n          name: 'SvgFeatureRenderer',\n          ReactComponent: SvgFeatureRendererReactComponent,\n          configSchema: svgFeatureRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n  }\n}\n\nexport { svgFeatureRendererConfigSchema, SvgFeatureRendererReactComponent }\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'TheTrackHubRegistryConnection',\n  {\n    trackDbId: {\n      type: 'string',\n      defaultValue: '',\n      description: 'id of the trackDb in The Track Hub Registry',\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","import { objectHash } from '@jbrowse/core/util'\nimport { generateUnsupportedTrackConf } from '@jbrowse/core/util/tracks'\n\nexport function generateTracks(trackDb, assemblyName, sequenceAdapter) {\n  // eslint-disable-next-line no-underscore-dangle\n  const { configuration } = trackDb._source\n  const subTracks = getSubtracks({ members: configuration })\n  return subTracks.map(subTrack => {\n    const ret = makeTrackConfig(\n      subTrack,\n      // eslint-disable-next-line no-underscore-dangle\n      trackDb._source.hub.url,\n      sequenceAdapter,\n    )\n    ret.trackId = `trackhub-registry-${objectHash(ret)}`\n    ret.assemblyNames = [assemblyName]\n    return ret\n  })\n\n  function getSubtracks(track, trackPath = []) {\n    if (track.members) {\n      return Object.values(track.members)\n        .map(subTrack =>\n          getSubtracks(\n            subTrack,\n            track.shortLabel ? trackPath.concat([track.shortLabel]) : trackPath,\n          ),\n        )\n        .flat()\n    }\n    track.categories = trackPath\n    return [track]\n  }\n}\n\nfunction makeTrackConfig(track, trackDbUrl, sequenceAdapter) {\n  const trackType = track.type\n  let baseTrackType = trackType.split(' ')[0].toLowerCase()\n  if (\n    baseTrackType === 'bam' &&\n    track.bigDataUrl.toLowerCase().endsWith('cram')\n  ) {\n    baseTrackType = 'cram'\n  }\n  const { bigDataUrl } = track\n  const bigDataLocation = {\n    uri: new URL(bigDataUrl, trackDbUrl).href,\n  }\n  const { categories } = track\n  let bigDataIndexLocation\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbUrl) {\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n            }\n      } else {\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex }\n          : { localPath: `${track.bigDataUrl}.bai` }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bed5floatscore':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedgraph':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedrnaelements':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbarchart':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbed':\n      return {\n        type: 'FeatureTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigchain':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'biginteract':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigpsl':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigwig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'coloredexon':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbUrl) {\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n            }\n      } else {\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex }\n          : { localPath: `${track.bigDataUrl}.bai` }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          bamLocation: bigDataLocation,\n          index: { location: bigDataIndexLocation },\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'narrowpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'peptidemapping':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'vcftabix':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    default:\n      throw new Error(`Unsupported track type: ${baseTrackType}`)\n  }\n}\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport { generateTracks } from './tracks'\n\nexport default function (pluginManager) {\n  return types.compose(\n    'TheTrackHubRegistryConnection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        type: types.literal('TheTrackHubRegistryConnection'),\n        configuration: ConfigurationReference(configSchema),\n      })\n      .actions(self => ({\n        connect(connectionConf) {\n          self.clear()\n          const trackDbId = readConfObject(connectionConf, 'trackDbId')\n          fetch(\n            `https://www.trackhubregistry.org/api/search/trackdb/${trackDbId}`,\n          )\n            .then(rawResponse => rawResponse.json())\n            .then(trackDb => {\n              // eslint-disable-next-line no-underscore-dangle\n              const assemblyName = trackDb._source.assembly.name\n              const session = getSession(self)\n              const assembly = session.assemblyManager.get(assemblyName)\n              const assemblyConf = assembly.configuration\n              const sequenceAdapter = readConfObject(assemblyConf, [\n                'sequence',\n                'adapter',\n              ])\n              self.setTrackConfs(\n                generateTracks(trackDb, assemblyName, sequenceAdapter),\n              )\n            })\n            .catch(error => {\n              console.error(error)\n            })\n        },\n      })),\n  )\n}\n","import { lazy } from 'react'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema, modelFactory } from './trackhub-registry'\n\nexport default class TrackHubRegistryPlugin extends Plugin {\n  name = 'TrackHubRegistryPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'TheTrackHubRegistryConnection',\n          configSchema,\n          configEditorComponent: lazy(\n            () => import('./trackhub-registry/TrackHubRegistrySelect'),\n          ),\n          stateModel: modelFactory(pluginManager),\n          displayName: 'The Track Hub Registry',\n          description: 'A hub from The Track Hub Registry',\n          url: '//trackhubregistry.org/',\n        }),\n    )\n  }\n}\n","export default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { types } = jbrequire('mobx-state-tree')\n\n  /** utility function for assembling the MST model of a column data type */\n  function MakeSpreadsheetColumnType(\n    name,\n    {\n      DataCellReactComponent = null,\n      FilterModelType = null,\n      compare,\n      displayName = undefined,\n      categoryName = undefined,\n    },\n  ) {\n    return types\n      .model(`ColumnDataType${name}`, {\n        type: types.literal(name),\n      })\n      .volatile(() => ({\n        DataCellReactComponent,\n        FilterModelType,\n        displayName: displayName || name,\n        categoryName,\n      }))\n      .views(() => ({\n        compare,\n        get hasFilter() {\n          return !!FilterModelType\n        },\n      }))\n  }\n\n  return MakeSpreadsheetColumnType\n}\n","import { doesIntersect2, isContainedWithin } from '@jbrowse/core/util/range'\nimport ClearIcon from '@material-ui/icons/Clear'\nimport { when } from '@jbrowse/core/util'\nimport MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { types, getType, getParent } = jbrequire('mobx-state-tree')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n\n  const { getPropertyType, getEnumerationValues, getSubType } = jbrequire(\n    '@jbrowse/core/util/mst-reflection',\n  )\n\n  const { compareLocs, getSession, parseLocString } = jbrequire(\n    '@jbrowse/core/util',\n  )\n\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const InputAdornment = jbrequire('@material-ui/core/InputAdornment')\n  const Select = jbrequire('@material-ui/core/Select')\n\n  const useStyles = makeStyles((/* theme */) => {\n    return {\n      textFilterControlAdornment: { marginRight: '-18px' },\n      textFilterControl: {\n        margin: [[0, 0, 0, '0.4rem']],\n        '& .MuiInput-formControl': {\n          marginTop: 8,\n        },\n        '& .MuiInputLabel-formControl': {\n          top: '-7px',\n          '&.MuiInputLabel-shrink': {\n            top: '-3px',\n          },\n        },\n      },\n    }\n  })\n\n  // React component for the column filter control\n  const FilterReactComponent = observer(({ filterModel }) => {\n    const classes = useStyles()\n    const operationChoices = getEnumerationValues(\n      getSubType(getPropertyType(getType(filterModel), 'operation')),\n    )\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"range\"\n          placeholder=\"chr1:100-200\"\n          error={filterModel.locStringIsInvalid}\n          value={filterModel.locString}\n          onChange={evt => filterModel.setLocString(evt.target.value)}\n          className={classes.textFilterControl}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => filterModel.setLocString('')}\n                  color=\"secondary\"\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </>\n    )\n  })\n\n  const OPERATIONS = [\n    'overlaps with',\n    'contained within',\n    'fully contains',\n    'does not overlap',\n    'not contained within',\n    'does not contain',\n  ]\n\n  // NOTE: assembly names, if present, are ignored in all of these predicates\n  const OPERATION_PREDICATES = {\n    'overlaps with': (cellLocation, specifiedLocation) => {\n      return (\n        cellLocation.refName === specifiedLocation.refName &&\n        doesIntersect2(\n          cellLocation.start,\n          cellLocation.end,\n          specifiedLocation.start,\n          specifiedLocation.end,\n        )\n      )\n    },\n    'contained within': (cellLocation, specifiedLocation) => {\n      return (\n        cellLocation.refName === specifiedLocation.refName &&\n        isContainedWithin(\n          cellLocation.start,\n          cellLocation.end,\n          specifiedLocation.start,\n          specifiedLocation.end,\n        )\n      )\n    },\n    'fully contains': (cellLocation, specifiedLocation) => {\n      return (\n        cellLocation.refName === specifiedLocation.refName &&\n        isContainedWithin(\n          specifiedLocation.start,\n          specifiedLocation.end,\n          cellLocation.start,\n          cellLocation.end,\n        )\n      )\n    },\n  }\n  OPERATION_PREDICATES['does not overlap'] = (\n    cellLocation,\n    specifiedLocation,\n  ) => {\n    return !OPERATION_PREDICATES['overlaps with'](\n      cellLocation,\n      specifiedLocation,\n    )\n  }\n  OPERATION_PREDICATES['not contained within'] = (\n    cellLocation,\n    specifiedLocation,\n  ) => {\n    return !OPERATION_PREDICATES['contained within'](\n      cellLocation,\n      specifiedLocation,\n    )\n  }\n  OPERATION_PREDICATES['does not contain'] = (\n    cellLocation,\n    specifiedLocation,\n  ) => {\n    return !OPERATION_PREDICATES['fully contains'](\n      cellLocation,\n      specifiedLocation,\n    )\n  }\n\n  // MST model for the column filter control\n  const FilterModelType = types\n    .model('ColumnLocStringFilter', {\n      type: types.literal('LocString'),\n      columnNumber: types.integer,\n      locString: '',\n      operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n    })\n    .views(self => ({\n      get locStringIsInvalid() {\n        if (self.locString) {\n          const parsed = self.parsedLocString\n          return (\n            !parsed ||\n            parsed.refName === '' ||\n            typeof parsed.start !== 'number' ||\n            typeof parsed.end !== 'number' ||\n            parsed.start > parsed.end\n          )\n        }\n        return false\n      },\n      get parsedLocString() {\n        const session = getSession(self)\n        const model = getParent(self, 3).spreadsheet\n        const { assemblyName } = model\n        try {\n          return parseLocString(self.locString, refName =>\n            session.assemblyManager.isValidRefName(refName, assemblyName),\n          )\n        } catch (e) {\n          return undefined\n        }\n      },\n      // returns a function that tests the given row\n      get predicate() {\n        if (!self.locString || self.locStringIsInvalid) {\n          return function alwaysTrue() {\n            return true\n          }\n        }\n\n        const { parsedLocString, operation, columnNumber } = self // avoid closing over self\n        return function stringPredicate(sheet, row) {\n          const { cellsWithDerived: cells } = row\n          const cell = cells[columnNumber]\n\n          if (!cell || !cell.text || !cell.extendedData) {\n            return false\n          }\n          const parsedCellText = cell.extendedData\n          if (!parsedCellText.refName) {\n            return false\n          }\n\n          const predicate = OPERATION_PREDICATES[operation]\n          if (!predicate) {\n            throw new Error(`\"${operation}\" not implemented in location filter`)\n          }\n\n          return predicate(parsedCellText, parsedLocString)\n        }\n      },\n    }))\n    .actions(self => ({\n      setLocString(s) {\n        self.locString = s\n      },\n      setOperation(op) {\n        self.operation = op\n      },\n    }))\n    .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n  // opens a new LGV at the location described in the locString in the cell text\n  async function locationLinkClick(spreadsheet, columnNumber, cell) {\n    const session = getSession(spreadsheet)\n    const { assemblyManager } = session\n    const { assemblyName } = spreadsheet\n    const { id } = getParent(spreadsheet)\n    const assembly = await assemblyManager.waitForAssembly(assemblyName)\n    try {\n      const loc = parseLocString(cell.text, name =>\n        assemblyManager.isValidRefName(name, spreadsheet.assemblyName),\n      )\n      const { refName } = loc\n      const canonicalRefName = assembly.getCanonicalRefName(refName)\n      const newDisplayedRegion = assembly.regions.find(\n        region => region.refName === canonicalRefName,\n      )\n\n      const newViewId = `${id}_${assemblyName}`\n      let view = session.views.find(v => v.id === newViewId)\n      if (!view) {\n        view = session.addView('LinearGenomeView', {\n          displayName: assemblyName,\n          id: newViewId,\n        })\n        await when(() => view.initialized)\n\n        // note that we have to clone this because otherwise it adds \"same object\n        // twice to the mst tree\"\n        view.setDisplayedRegions([\n          JSON.parse(JSON.stringify(newDisplayedRegion)),\n        ])\n      }\n      view.navToLocString(cell.text)\n    } catch (e) {\n      session.notify(`${e}`, 'error')\n    }\n  }\n\n  const DataCellReactComponent = observer(\n    ({ cell, columnNumber, spreadsheet }) => {\n      function click(evt) {\n        evt.preventDefault()\n        locationLinkClick(spreadsheet, columnNumber, cell)\n      }\n      return (\n        <a\n          onClick={click}\n          title=\"open a new linear genome view here\"\n          href=\"#link\"\n        >\n          {cell.text}\n        </a>\n      )\n    },\n  )\n\n  const LocStringColumnType = MakeSpreadsheetColumnType('LocString', {\n    categoryName: 'Location',\n    displayName: 'Full location',\n    compare(cellA, cellB) {\n      return compareLocs(cellA.extendedData, cellB.extendedData)\n    },\n    FilterModelType,\n    DataCellReactComponent,\n  })\n\n  return LocStringColumnType\n}\n","import ClearIcon from '@material-ui/icons/Clear'\nimport MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { types, getType } = jbrequire('mobx-state-tree')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n\n  const { getPropertyType, getEnumerationValues, getSubType } = jbrequire(\n    '@jbrowse/core/util/mst-reflection',\n  )\n\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const OPERATIONS = [\n    'equals',\n    'contains',\n    'does not contain',\n    'does not equal',\n    'starts with',\n    'ends with',\n  ]\n\n  // NOTE: assembly names, if present, are ignored in all of these predicates\n  const OPERATION_PREDICATES = {\n    contains: (textInCell, stringToFind) => {\n      return textInCell.toLowerCase().indexOf(stringToFind) !== -1\n    },\n    equals: (textInCell, stringToFind) => {\n      return textInCell.toLowerCase() === stringToFind\n    },\n    'starts with': (textInCell, stringToFind) => {\n      return textInCell.toLowerCase().indexOf(stringToFind) === 0\n    },\n    'ends with': (textInCell, stringToFind) => {\n      const index = textInCell.toLowerCase().indexOf(stringToFind)\n      if (index === -1) {\n        return false\n      }\n      return index === textInCell.length - stringToFind.length\n    },\n  }\n  OPERATION_PREDICATES['does not contain'] = (textInCell, stringToFind) => {\n    return !OPERATION_PREDICATES.contains(textInCell, stringToFind)\n  }\n  OPERATION_PREDICATES['does not equal'] = (textInCell, stringToFind) => {\n    return !OPERATION_PREDICATES.equals(textInCell, stringToFind)\n  }\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const InputAdornment = jbrequire('@material-ui/core/InputAdornment')\n  const Select = jbrequire('@material-ui/core/Select')\n\n  const useStyles = makeStyles((/* theme */) => {\n    return {\n      textFilterControlAdornment: { marginRight: '-18px' },\n      textFilterControl: {\n        margin: 0,\n        '& .MuiInput-formControl': {\n          marginTop: 8,\n        },\n        '& .MuiInputLabel-formControl': {\n          top: '-7px',\n          '&.MuiInputLabel-shrink': {\n            top: '-3px',\n          },\n        },\n      },\n    }\n  })\n\n  // React component for the column filter control\n  const FilterReactComponent = observer(({ filterModel }) => {\n    const classes = useStyles()\n    const operationChoices = getEnumerationValues(\n      getSubType(getPropertyType(getType(filterModel), 'operation')),\n    )\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"text\"\n          value={filterModel.stringToFind}\n          onChange={evt => filterModel.setString(evt.target.value)}\n          className={classes.textFilterControl}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => filterModel.setString('')}\n                  color=\"secondary\"\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </>\n    )\n  })\n\n  // MST model for the column filter control\n  const ColumnTextFilter = types\n    .model('ColumnTextFilter', {\n      type: types.literal('Text'),\n      columnNumber: types.integer,\n      stringToFind: '',\n      operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n    })\n    .views(self => ({\n      // returns a function that tests the given row\n      get predicate() {\n        const { stringToFind, columnNumber, operation } = self // avoid closing over self\n        if (!stringToFind) {\n          return function alwaysTrue() {\n            return true\n          }\n        }\n        const s = stringToFind.toLowerCase() // case insensitive match\n        return function stringPredicate(sheet, row) {\n          const { cellsWithDerived } = row\n          const cell = cellsWithDerived[columnNumber]\n          if (!cell || !cell.text) {\n            return false\n          }\n          const predicate = OPERATION_PREDICATES[operation]\n          if (!predicate) {\n            throw new Error(`\"${operation}\" not implemented in location filter`)\n          }\n          return predicate(cell.text, s)\n        }\n      },\n    }))\n    .actions(self => ({\n      setString(s) {\n        self.stringToFind = s\n      },\n      setOperation(op) {\n        self.operation = op\n      },\n    }))\n    .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n  const TextColumnType = MakeSpreadsheetColumnType('Text', {\n    compare(cellA, cellB) {\n      return cellA.text.localeCompare(cellB.text)\n    },\n    FilterModelType: ColumnTextFilter,\n  })\n\n  return { TextColumn: TextColumnType, FilterModelType: ColumnTextFilter }\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\nimport TextFactory from './Text'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { FilterModelType: NumberFilterModel } = jbrequire(TextFactory)\n\n  const FilterModelType = types.compose(\n    NumberFilterModel,\n    types.model({\n      type: types.literal('LocRef'),\n    }),\n  )\n\n  const LocRef = MakeSpreadsheetColumnType('LocRef', {\n    categoryName: 'Location',\n    displayName: 'Reference seq',\n    compare(cellA, cellB) {\n      return cellA.text.localeCompare(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return LocRef\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const { observer } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const TextField = jbrequire('@material-ui/core/TextField')\n  const MenuItem = jbrequire('@material-ui/core/MenuItem')\n  const Select = jbrequire('@material-ui/core/Select')\n\n  const OPERATIONS = [\n    'equals',\n    'greater than',\n    'less than',\n    'between',\n    'not between',\n  ]\n\n  // NOTE: assembly names, if present, are ignored in all of these predicates\n  const OPERATION_PREDICATES = {\n    equals: (numberInCell, firstNumber) => {\n      return numberInCell === firstNumber\n    },\n    'greater than': (numberInCell, firstNumber) => {\n      return numberInCell > firstNumber\n    },\n    'less than': (numberInCell, firstNumber) => {\n      return numberInCell < firstNumber\n    },\n    between: (numberInCell, firstNumber, secondNumber) => {\n      return numberInCell > firstNumber && numberInCell < secondNumber\n    },\n  }\n  OPERATION_PREDICATES['not between'] = (\n    numberInCell,\n    firstNumber,\n    secondNumber,\n  ) => {\n    return !OPERATION_PREDICATES.between(\n      numberInCell,\n      firstNumber,\n      secondNumber,\n    )\n  }\n\n  const useStyles = makeStyles((/* theme */) => {\n    return {\n      textFilterControlAdornment: { marginRight: '-18px' },\n      textFilterControl: {\n        margin: [[0, 0, 0, '0.4rem']],\n        '& .MuiInput-formControl': {\n          marginTop: 8,\n        },\n        '& .MuiInputLabel-formControl': {\n          top: '-7px',\n          '&.MuiInputLabel-shrink': {\n            top: '-3px',\n          },\n        },\n      },\n    }\n  })\n\n  // React component for the column filter control\n  const FilterReactComponent = observer(({ filterModel }) => {\n    const classes = useStyles()\n\n    const operationChoices = OPERATIONS\n\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"number\"\n          placeholder=\"123\"\n          type=\"number\"\n          error={filterModel.firstNumberIsInvalid}\n          defaultValue={filterModel.firstNumber}\n          onChange={evt => {\n            filterModel.setFirstNumber(parseFloat(evt.target.value))\n          }}\n          className={classes.textFilterControl}\n        />\n        {filterModel.operation !== 'between' &&\n        filterModel.operation !== 'not between' ? null : (\n          <>\n            {' and '}\n            <TextField\n              label=\"number\"\n              placeholder=\"456\"\n              type=\"number\"\n              error={filterModel.secondNumberIsInvalid}\n              defaultValue={filterModel.secondNumber}\n              onChange={evt =>\n                filterModel.setSecondNumber(parseFloat(evt.target.value))\n              }\n              className={classes.textFilterControl}\n            />\n          </>\n        )}\n      </>\n    )\n  })\n\n  // MST model for the column filter control\n  const FilterModelType = types\n    .model('ColumnNumberFilter', {\n      type: types.literal('Number'),\n      columnNumber: types.integer,\n      firstNumber: types.maybe(types.number),\n      secondNumber: types.maybe(types.number),\n      operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n    })\n    .views(self => ({\n      // returns a function that tests the given row\n      get predicate() {\n        if (typeof self.firstNumber !== 'number') {\n          return function alwaysTrue() {\n            return true\n          }\n        }\n\n        const { firstNumber, secondNumber, operation, columnNumber } = self // avoid closing over self\n        return function stringPredicate(sheet, row) {\n          const { cellsWithDerived } = row\n          const cell = cellsWithDerived[columnNumber]\n\n          if (!cell || !cell.text) {\n            return false\n          }\n\n          const parsedCellText = parseFloat(cell.text)\n          if (typeof parsedCellText !== 'number') {\n            return false\n          }\n\n          const predicate = OPERATION_PREDICATES[operation]\n          if (!predicate) {\n            throw new Error(`\"${operation}\" not implemented in location filter`)\n          }\n\n          return predicate(parsedCellText, firstNumber, secondNumber)\n        }\n      },\n    }))\n    .actions(self => ({\n      setFirstNumber(n) {\n        if (Number.isNaN(n) || typeof n !== 'number') {\n          self.firstNumber = undefined\n        } else {\n          self.firstNumber = n\n        }\n      },\n      setSecondNumber(n) {\n        if (Number.isNaN(n) || typeof n !== 'number') {\n          self.secondNumber = undefined\n        } else {\n          self.secondNumber = n\n        }\n      },\n      setOperation(op) {\n        self.operation = op\n      },\n    }))\n    .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n  const NumberColumn = MakeSpreadsheetColumnType('Number', {\n    compare(cellA, cellB) {\n      return parseFloat(cellA.text) - parseFloat(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return { NumberColumn, FilterModelType }\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\nimport NumberFactory from './Number'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { FilterModelType: NumberFilterModel } = jbrequire(NumberFactory)\n\n  const FilterModelType = types.compose(\n    NumberFilterModel,\n    types.model({\n      type: types.literal('LocStart'),\n    }),\n  )\n\n  const LocStart = MakeSpreadsheetColumnType('LocStart', {\n    categoryName: 'Location',\n    displayName: 'Start',\n    compare(cellA, cellB) {\n      return parseFloat(cellA.text) - parseFloat(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return LocStart\n}\n","import MakeSpreadsheetColumnTypeFactory from './MakeSpreadsheetColumnType'\nimport NumberFactory from './Number'\n\nexport default ({ jbrequire }) => {\n  const { types } = jbrequire('mobx-state-tree')\n  const MakeSpreadsheetColumnType = jbrequire(MakeSpreadsheetColumnTypeFactory)\n\n  const { FilterModelType: NumberFilterModel } = jbrequire(NumberFactory)\n\n  const FilterModelType = types.compose(\n    NumberFilterModel,\n    types.model({\n      type: types.literal('LocEnd'),\n    }),\n  )\n\n  const LocEnd = MakeSpreadsheetColumnType('LocEnd', {\n    categoryName: 'Location',\n    displayName: 'End',\n    compare(cellA, cellB) {\n      return parseFloat(cellA.text) - parseFloat(cellB.text)\n    },\n    FilterModelType,\n  })\n\n  return LocEnd\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport LocStringFactory from './LocString'\nimport LocRefFactory from './LocRef'\nimport LocStartFactory from './LocStart'\nimport LocEndFactory from './LocEnd'\nimport NumberFactory from './Number'\nimport TextFactory from './Text'\n\nexport default (pluginManager: PluginManager) => {\n  const { jbrequire } = pluginManager\n  const { types } = jbrequire('mobx-state-tree')\n\n  const { NumberColumn: Number } = jbrequire(NumberFactory)\n  const { TextColumn: Text } = jbrequire(TextFactory)\n\n  const ColumnTypes = {\n    Number,\n    Text,\n    LocString: jbrequire(LocStringFactory),\n    LocRef: jbrequire(LocRefFactory),\n    LocStart: jbrequire(LocStartFactory),\n    LocEnd: jbrequire(LocEndFactory),\n  }\n\n  const allColumnTypes = Object.values(ColumnTypes)\n  const AnyColumnType = types.union(...allColumnTypes)\n\n  return Object.freeze({\n    ColumnTypes,\n    AnyColumnType,\n    // make a type union of all the different filter model types\n    AnyFilterModelType: types.union(\n      ...allColumnTypes\n        .map(columnType => {\n          // just instantiate the blank types to get their filter model types\n          const { FilterModelType } = columnType.create({\n            type: columnType.properties.type.value,\n          })\n          return FilterModelType\n        })\n        // some column types might not have filter machinery, filter those out\n        .filter(t => !!t),\n    ),\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n\n  const CellModel = types.model('SpreadsheetCell', {\n    text: types.string,\n    extendedData: types.maybe(types.frozen()),\n  })\n\n  const RowModel = types\n    .model('SpreadsheetRow', {\n      id: types.identifier,\n      cells: types.array(CellModel),\n      extendedData: types.maybe(types.frozen()),\n      isSelected: false,\n    })\n    .actions(self => ({\n      toggleSelect() {\n        self.isSelected = !self.isSelected\n      },\n      unSelect() {\n        self.isSelected = false\n      },\n      select() {\n        self.isSelected = true\n      },\n      setExtendedData(data: unknown) {\n        self.extendedData = data\n      },\n    }))\n    .views(self => ({\n      get cellsWithDerived() {\n        const { columns } = getParent(self, 3)\n        let i = 0\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return columns.map((column: { isDerived: boolean; expr: any }) => {\n          if (column.isDerived) {\n            return column.expr.evalSync({\n              row: self,\n            })\n          }\n          return self.cells[i++]\n        })\n      },\n    }))\n\n  return RowModel\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Row from './Row'\n\nconst StaticRowSetComponentF = (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n  const RowModel = load(Row)\n\n  return types\n    .model('StaticRowSet', {\n      isLoaded: types.literal(true),\n      rows: types.array(RowModel),\n    })\n    .views(self => ({\n      get count() {\n        return self.rows.length\n      },\n\n      get passingFiltersCount() {\n        return this.sortedFilteredRows.length\n      },\n\n      get selectedCount() {\n        return this.selectedRows.length\n      },\n\n      get selectedAndPassingFiltersCount() {\n        return this.selectedFilteredRows.length\n      },\n\n      get sortedRows() {\n        const parent = getParent(self)\n        return self.rows.slice().sort(parent.rowSortingComparisonFunction)\n      },\n\n      get selectedRows() {\n        return self.rows.filter(r => r.isSelected)\n      },\n\n      get selectedFilteredRows() {\n        const sheet = getParent(self)\n        const view = getParent(sheet)\n        const { filterControls } = view\n        return this.selectedRows.filter(row =>\n          filterControls.rowPassesFilters(sheet, row),\n        )\n      },\n\n      // the set of all rows that pass the filters, sorted\n      get sortedFilteredRows() {\n        const sheet = getParent(self)\n        const view = getParent(sheet)\n        const { filterControls } = view\n        return self.rows\n          .filter(row => filterControls.rowPassesFilters(sheet, row))\n          .sort(sheet.rowSortingComparisonFunction)\n      },\n    }))\n    .actions(self => ({\n      unselectAll() {\n        self.rows.forEach(row => row.unSelect())\n      },\n    }))\n}\n\nexport default StaticRowSetComponentF\n","import { stringToJexlExpression } from '@jbrowse/core/util/jexlStrings'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSession } from '@jbrowse/core/util'\nimport { SnapshotIn, Instance, addDisposer } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport ColumnDataTypes from './ColumnDataTypes'\nimport StaticRowSetF from './StaticRowSet'\nimport RowF from './Row'\n\nconst SpreadsheetModelF = (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n\n  const { ColumnTypes, AnyColumnType } = load(ColumnDataTypes)\n\n  const StaticRowSetModel = load(StaticRowSetF)\n  type Row = Instance<ReturnType<typeof RowF>>\n\n  const ColumnDefinition = types\n    .model('ColumnDefinition', {\n      name: types.maybe(types.string),\n      dataType: types.optional(AnyColumnType, () => ({\n        type: 'Text',\n      })),\n      // set to true if column is derived from other columns\n      // if the column is derived, each cell will have a\n      // `derivationFunction` that is called to get its value\n      isDerived: false,\n      // if this cell is derived from other cells, execute this function to get the value\n      derivationFunctionText: types.maybe(types.string),\n    })\n    .views(self => ({\n      get expr() {\n        if (self.isDerived) {\n          // compile this as a jexl expression\n          return stringToJexlExpression(\n            String(self.derivationFunctionText),\n            pluginManager.jexl,\n          )\n        }\n        return undefined\n      },\n    }))\n\n  type RowMenuPosition = { anchorEl: Element; rowNumber: number } | null\n  const stateModel = types\n    .model('Spreadsheet', {\n      rowSet: types.optional(StaticRowSetModel, () =>\n        StaticRowSetModel.create(),\n      ),\n      columns: types.array(ColumnDefinition),\n      columnDisplayOrder: types.array(types.number),\n      hasColumnNames: false,\n\n      sortColumns: types.array(\n        types\n          .model('SortColumns', {\n            columnNumber: types.number,\n            descending: false,\n          })\n          .actions(self => ({\n            switchDirection() {\n              self.descending = !self.descending\n            },\n          })),\n      ),\n\n      assemblyName: types.maybe(types.string),\n    })\n    .volatile(() => ({\n      defaultDataType: ColumnTypes.Text,\n      rowMenuPosition: null as RowMenuPosition,\n      isLoaded: false,\n    }))\n    .views(self => ({\n      get initialized() {\n        const session = getSession(self)\n        const name = self.assemblyName\n        if (name) {\n          const asm = session.assemblyManager.get(name)\n          return asm && asm.initialized\n        }\n        return true\n      },\n      get hideRowSelection() {\n        // just delegates to parent\n        return getParent(self).hideRowSelection\n      },\n\n      // list of data type names to be made available in the column\n      // dropdown menu\n      get dataTypeChoices() {\n        const typeNames = Object.keys(\n          ColumnTypes,\n        ) as (keyof typeof ColumnTypes)[]\n        return typeNames.map(typeName => {\n          const dataType = ColumnTypes[typeName].create({ type: typeName })\n          const { displayName, categoryName } = dataType\n          return { typeName, displayName, categoryName }\n        })\n      },\n\n      rowSortingComparisonFunction(rowA: Row, rowB: Row) {\n        for (let i = 0; i < self.sortColumns.length; i += 1) {\n          const { columnNumber, descending } = self.sortColumns[i]\n          const { dataType } = self.columns[columnNumber]\n          const result = dataType.compare(\n            rowA.cellsWithDerived[columnNumber],\n            rowB.cellsWithDerived[columnNumber],\n          )\n          if (result) {\n            return descending ? -result : result\n          }\n        }\n        return 0\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(async () => {\n            const session = getSession(self)\n            const { assemblyManager } = session\n            try {\n              if (self.assemblyName) {\n                await assemblyManager.waitForAssembly(self.assemblyName)\n                this.setLoaded(true)\n              }\n            } catch (error) {\n              session.notify(\n                `failed to load assembly ${self.assemblyName} ${error}`,\n                'error',\n              )\n            }\n          }),\n        )\n      },\n\n      setLoaded(flag: boolean) {\n        self.isLoaded = flag\n      },\n\n      setRowMenuPosition(newPosition: RowMenuPosition) {\n        self.rowMenuPosition = newPosition\n      },\n\n      setSortColumns(\n        newSort: NonNullable<SnapshotIn<typeof self.sortColumns>>,\n      ) {\n        if (newSort) {\n          // @ts-ignore\n          self.sortColumns = newSort\n        }\n      },\n      setColumnType(columnNumber: number, newTypeName: string) {\n        self.columns[columnNumber].dataType = { type: newTypeName }\n      },\n      unselectAll() {\n        return self.rowSet.unselectAll()\n      },\n    }))\n\n  return stateModel\n}\n\nexport default SpreadsheetModelF\n","import { getSession } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// 30MB\nconst IMPORT_SIZE_LIMIT = 30_000_000\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const { types, getParent, getRoot } = lib['mobx-state-tree']\n  const { openLocation } = lib['@jbrowse/core/util/io']\n  const { readConfObject } = lib['@jbrowse/core/configuration']\n\n  const fileTypes = ['CSV', 'TSV', 'VCF', 'BED', 'BEDPE', 'STAR-Fusion']\n  const fileTypeParsers = {\n    CSV: () =>\n      import('../importAdapters/ImportUtils').then(r => r.parseCsvBuffer),\n    TSV: () =>\n      import('../importAdapters/ImportUtils').then(r => r.parseTsvBuffer),\n    VCF: () =>\n      import('../importAdapters/VcfImport').then(r => r.parseVcfBuffer),\n    BED: () =>\n      import('../importAdapters/BedImport').then(r => r.parseBedBuffer),\n    BEDPE: () =>\n      import('../importAdapters/BedImport').then(r => r.parseBedPEBuffer),\n    'STAR-Fusion': () =>\n      import('../importAdapters/STARFusionImport').then(\n        r => r.parseSTARFusionBuffer,\n      ),\n  }\n  // regexp used to guess the type of a file or URL from its file extension\n  const fileTypesRegexp = new RegExp(\n    `\\\\.(${fileTypes.join('|')})(\\\\.gz)?$`,\n    'i',\n  )\n\n  return types\n    .model('SpreadsheetImportWizard', {\n      fileType: types.optional(types.enumeration(fileTypes), 'CSV'),\n      hasColumnNameLine: true,\n      columnNameLineNumber: 1,\n      selectedAssemblyIdx: 0,\n    })\n    .volatile(() => ({\n      fileTypes,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      fileSource: undefined as any,\n      error: undefined as Error | undefined,\n      loading: false,\n    }))\n    .views(self => ({\n      get isReadyToOpen() {\n        return (\n          !self.error &&\n          self.fileSource &&\n          (self.fileSource.blob ||\n            self.fileSource.localPath ||\n            self.fileSource.uri)\n        )\n      },\n      get canCancel() {\n        return getParent(self).readyToDisplay\n      },\n      get assemblyChoices() {\n        return getRoot(self).jbrowse.assemblies\n      },\n      get selectedAssemblyName() {\n        const asm = getRoot(self).jbrowse.assemblies[self.selectedAssemblyIdx]\n        if (asm) {\n          return readConfObject(asm, 'name')\n        }\n        return undefined\n      },\n\n      get fileName() {\n        return (\n          self.fileSource.uri ||\n          self.fileSource.localPath ||\n          (self.fileSource.blob && self.fileSource.blob.name)\n        )\n      },\n\n      get requiresUnzip() {\n        return this.fileName.endsWith('gz')\n      },\n\n      isValidRefName(refName: string, assemblyName?: string) {\n        return getSession(self).assemblyManager.isValidRefName(\n          refName,\n          assemblyName,\n        )\n      },\n    }))\n    .actions(self => ({\n      setFileSource(newSource: unknown) {\n        self.fileSource = newSource\n        self.error = undefined\n\n        if (self.fileSource) {\n          // try to autodetect the file type, ignore errors\n          const name = self.fileName\n\n          if (name) {\n            const match = fileTypesRegexp.exec(name)\n            if (match && match[1]) {\n              if (match[1] === 'tsv' && name.includes('star-fusion')) {\n                self.fileType = 'STAR-Fusion'\n              } else {\n                self.fileType = match[1].toUpperCase()\n              }\n            }\n          }\n        }\n      },\n\n      setSelectedAssemblyIdx(idx: number) {\n        self.selectedAssemblyIdx = idx\n      },\n\n      toggleHasColumnNameLine() {\n        self.hasColumnNameLine = !self.hasColumnNameLine\n      },\n\n      setColumnNameLineNumber(newnumber: number) {\n        if (newnumber > 0) {\n          self.columnNameLineNumber = newnumber\n        }\n      },\n\n      setFileType(typeName: string) {\n        self.fileType = typeName\n      },\n\n      setError(error: Error) {\n        console.error(error)\n        self.loading = false\n        self.error = error\n      },\n\n      setLoaded() {\n        self.loading = false\n        self.error = undefined\n      },\n\n      cancelButton() {\n        self.error = undefined\n        getParent(self).setDisplayMode()\n      },\n\n      // fetch and parse the file, make a new Spreadsheet model for it,\n      // then set the parent to display it\n      async import() {\n        try {\n          if (!self.fileSource) {\n            return\n          }\n\n          if (self.loading) {\n            throw new Error('cannot import, load already in progress')\n          }\n          self.loading = true\n          const typeParser = await fileTypeParsers[\n            self.fileType as keyof typeof fileTypeParsers\n          ]()\n          if (!typeParser) {\n            throw new Error(`cannot open files of type '${self.fileType}'`)\n          }\n\n          const { unzip } = await import('@gmod/bgzf-filehandle')\n\n          const filehandle = openLocation(self.fileSource)\n          filehandle\n            .stat()\n            .then(stat => {\n              if (stat.size > IMPORT_SIZE_LIMIT) {\n                throw new Error(\n                  `File is too big. Tabular files are limited to at most ${(\n                    IMPORT_SIZE_LIMIT / 1000\n                  ).toLocaleString()}kb.`,\n                )\n              }\n            })\n            .then(() => filehandle.readFile())\n            .then(buffer => {\n              return self.requiresUnzip ? unzip(buffer) : buffer\n            })\n            .then(buffer => typeParser(buffer as Buffer, self))\n            .then(spreadsheet => {\n              this.setLoaded()\n              getParent(self).displaySpreadsheet(spreadsheet)\n            })\n            .catch(this.setError)\n        } catch (error) {\n          this.setError(error)\n        }\n      },\n    }))\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { SnapshotIn } from 'mobx-state-tree'\nimport ColumnDataTypes from './ColumnDataTypes'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { types, getParent } = lib['mobx-state-tree']\n\n  const { AnyFilterModelType: AnyColumnFilter } = load(ColumnDataTypes)\n\n  // filter that finds a simple string in any of the cells of a row\n  const RowFullTextFilter = types\n    .model('RowFullTextFilter', {\n      type: types.literal('RowFullText'),\n      stringToFind: '',\n    })\n    .views(self => ({\n      // returns a function that tests the given row\n      get predicate() {\n        let s = self.stringToFind // avoid closing over self\n        if (!s) {\n          return function alwaysTrue() {\n            return true\n          }\n        }\n        s = s.toLowerCase()\n        return function stringPredicate(\n          _sheet: unknown,\n          row: { cellsWithDerived: { text: string }[] },\n        ) {\n          const { cellsWithDerived } = row\n          for (\n            let columnNumber = 0;\n            columnNumber < cellsWithDerived.length;\n            columnNumber += 1\n          ) {\n            const cell = cellsWithDerived[columnNumber]\n            // note: case insensitive\n            if (cell.text && cell.text.toLowerCase().includes(s)) {\n              return true\n            }\n          }\n          return false\n        }\n      },\n    }))\n    .actions(self => ({\n      setString(s: string) {\n        self.stringToFind = s\n      },\n      clear() {\n        self.stringToFind = ''\n      },\n    }))\n\n  return types\n    .model('SpreadsheetFilterControls', {\n      rowFullText: types.optional(\n        RowFullTextFilter,\n        () =>\n          ({\n            type: 'RowFullText',\n            stringToFind: '',\n          } as SnapshotIn<typeof RowFullTextFilter>),\n      ),\n      columnFilters: types.array(AnyColumnFilter),\n    })\n    .views(self => ({\n      get filters() {\n        return [self.rowFullText, ...self.columnFilters].filter(f => !!f)\n      },\n      setRowFullTextFilter(stringToFind: string) {\n        // @ts-ignore\n        self.rowFullText = {\n          type: 'RowFullText',\n          stringToFind,\n        }\n      },\n      rowPassesFilters(sheet: unknown, row: unknown) {\n        for (let i = 0; i < this.filters.length; i += 1) {\n          if (!this.filters[i].predicate(sheet, row)) {\n            return false\n          }\n        }\n        return true\n      },\n    }))\n    .actions(self => ({\n      addBlankColumnFilter(columnNumber: number) {\n        const { dataType } = getParent(self).spreadsheet.columns[columnNumber]\n        self.columnFilters.push({\n          type: dataType.type,\n          columnNumber,\n        })\n      },\n      removeColumnFilter(filter: typeof AnyColumnFilter) {\n        return self.columnFilters.remove(filter)\n      },\n      clearAllFilters() {\n        self.columnFilters.clear()\n        self.rowFullText.clear()\n      },\n    }))\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { SnapshotIn, Instance } from 'mobx-state-tree'\nimport { getSession, InstanceOfModelReturnedBy } from '@jbrowse/core/util'\nimport DoneIcon from '@material-ui/icons/Done'\nimport Spreadsheet from './Spreadsheet'\nimport ImportWizard from './ImportWizard'\nimport FilterControls from './FilterControls'\n\nexport type MenuItemWithDisabledCallback = MenuItem & {\n  disabled?:\n    | boolean\n    | ((\n        viewModel: unknown,\n        spreadsheetModel: InstanceOfModelReturnedBy<typeof Spreadsheet>,\n        rowNumber: number,\n        row: Instance<ReturnType<typeof Spreadsheet>>['rowSet']['rows'][0],\n      ) => boolean)\n}\n\nconst defaultRowMenuItems: MenuItemWithDisabledCallback[] = [\n  {\n    label: 'Toggle select',\n    icon: DoneIcon,\n    onClick(\n      _view: unknown,\n      spreadsheet: Instance<ReturnType<typeof Spreadsheet>>,\n    ) {\n      const rowNumber = spreadsheet.rowMenuPosition?.rowNumber\n      if (rowNumber !== undefined) {\n        spreadsheet.rowSet.rows[rowNumber - 1].toggleSelect()\n      }\n    },\n  },\n]\n\nconst SpreadsheetViewModelF = (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const { mobx } = lib\n  const { types, getParent, getEnv } = lib['mobx-state-tree']\n  const { BaseViewModel } = lib['@jbrowse/core/pluggableElementTypes/models']\n\n  const SpreadsheetModel = load(Spreadsheet)\n  const ImportWizardModel = load(ImportWizard)\n  const FilterControlsModel = load(FilterControls)\n\n  const minHeight = 40\n  const defaultHeight = 440\n  const model = types\n    .model('SpreadsheetView', {\n      type: types.literal('SpreadsheetView'),\n      offsetPx: 0,\n      height: types.optional(\n        types.refinement(\n          'SpreadsheetViewHeight',\n          types.number,\n          n => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n\n      hideViewControls: false,\n      hideVerticalResizeHandle: false,\n      hideFilterControls: false,\n\n      filterControls: types.optional(FilterControlsModel, () =>\n        FilterControlsModel.create({}),\n      ),\n\n      // switch specifying whether we are showing the import wizard or the spreadsheet in our viewing area\n      mode: types.optional(\n        types.enumeration('SpreadsheetViewMode', ['import', 'display']),\n        'import',\n      ),\n      importWizard: types.optional(ImportWizardModel, () =>\n        ImportWizardModel.create(),\n      ),\n      spreadsheet: types.maybe(SpreadsheetModel),\n    })\n    .volatile(() => ({\n      width: 400,\n      rowMenuItems: mobx.observable(defaultRowMenuItems),\n    }))\n    .views(self => ({\n      get readyToDisplay() {\n        return !!self.spreadsheet && self.spreadsheet.isLoaded\n      },\n\n      get hideRowSelection() {\n        return !!getEnv(self).hideRowSelection\n      },\n\n      get outputRows() {\n        if (self.spreadsheet && self.spreadsheet.rowSet.isLoaded) {\n          const selected = self.spreadsheet.rowSet.selectedFilteredRows\n          if (selected.length) {\n            return selected\n          }\n          return self.spreadsheet.rowSet.sortedFilteredRows\n        }\n        return undefined\n      },\n\n      get assembly() {\n        if (self.spreadsheet && self.spreadsheet.assemblyName) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const assemblies = getSession(self).assemblies as any[]\n          const assembly = (assemblies || []).find(\n            asm =>\n              readConfObject(asm, 'name') === self.spreadsheet?.assemblyName,\n          )\n          if (assembly) {\n            return assembly\n          }\n        }\n        return undefined\n      },\n    }))\n    .actions(self => ({\n      setRowMenuItems(newItems: MenuItem[]) {\n        self.rowMenuItems.replace(newItems)\n      },\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        return self.width\n      },\n      setHeight(newHeight: number) {\n        if (newHeight > minHeight) {\n          self.height = newHeight\n        } else {\n          self.height = minHeight\n        }\n        return self.height\n      },\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n      resizeWidth(distance: number) {\n        const oldWidth = self.width\n        const newWidth = this.setWidth(self.width + distance)\n        return newWidth - oldWidth\n      },\n\n      /** load a new spreadsheet and set our mode to display it */\n      displaySpreadsheet(spreadsheet: SnapshotIn<typeof SpreadsheetModel>) {\n        self.filterControls.clearAllFilters()\n        // @ts-ignore\n        self.spreadsheet = spreadsheet\n        self.mode = 'display'\n      },\n\n      setImportMode() {\n        self.mode = 'import'\n      },\n\n      setDisplayMode() {\n        if (self.readyToDisplay) {\n          self.mode = 'display'\n        }\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return stateModel\n}\n\nexport default SpreadsheetViewModelF\n","import { lazy } from 'react'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport ViewComfyIcon from '@material-ui/icons/ViewComfy'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport stateModelFactory from './SpreadsheetView/models/SpreadsheetView'\n\nexport default class SpreadsheetViewPlugin extends Plugin {\n  name = 'SpreadsheetViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() => {\n      return new ViewType({\n        name: 'SpreadsheetView',\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./SpreadsheetView/components/SpreadsheetView'),\n        ),\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Spreadsheet view',\n        icon: ViewComfyIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SpreadsheetView', {})\n        },\n      })\n    }\n  }\n}\n","import FolderOpenIcon from '@material-ui/icons/FolderOpen'\n\nconst SvInspectorComponentF = pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const Grid = jbrequire('@material-ui/core/Grid')\n  const FormControlLabel = jbrequire('@material-ui/core/FormControlLabel')\n  const Checkbox = jbrequire('@material-ui/core/Checkbox')\n  const { ResizeHandle } = jbrequire('@jbrowse/core/ui')\n  const { grey } = jbrequire('@material-ui/core/colors')\n\n  const headerHeight = 52\n\n  const style = {\n    width: 4,\n    background: '#ccc',\n    boxSizing: 'border-box',\n    borderTop: '1px solid #fafafa',\n  }\n  const useStyles = makeStyles(theme => {\n    return {\n      root: {\n        marginBottom: theme.spacing(1),\n        background: 'white',\n        overflow: 'hidden',\n      },\n      header: {\n        overflow: 'hidden',\n        whiteSpace: 'nowrap',\n        boxSizing: 'border-box',\n        height: headerHeight,\n        background: grey[200],\n        // borderBottom: '1px solid #a2a2a2',\n      },\n      viewControls: {\n        margin: 0,\n      },\n      viewsContainer: {\n        display: 'flex',\n      },\n      spreadsheetViewContainer: {\n        borderRight: [['1px', 'solid', grey[400]]],\n        overflow: 'hidden',\n      },\n      circularViewOptions: {\n        padding: theme.spacing(1),\n        background: grey[200],\n      },\n    }\n  })\n\n  const ViewControls = observer(({ model }) => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const classes = useStyles()\n    return (\n      <Grid\n        className={classes.viewControls}\n        container\n        spacing={1}\n        direction=\"row\"\n        alignItems=\"center\"\n      >\n        <Grid item>\n          <IconButton\n            onClick={() => model.setImportMode()}\n            className={classes.iconButton}\n            title=\"open a tabular file\"\n            data-testid=\"sv_inspector_view_open\"\n            color=\"secondary\"\n          >\n            <FolderOpenIcon />\n          </IconButton>\n        </Grid>\n      </Grid>\n    )\n  })\n\n  const CircularViewOptions = observer(({ svInspector }) => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const classes = useStyles()\n\n    return (\n      <Grid\n        container\n        className={classes.circularViewOptions}\n        style={{ height: svInspector.circularViewOptionsBarHeight }}\n      >\n        <Grid item>\n          <FormControlLabel\n            control={\n              <Checkbox\n                className={classes.rowSelector}\n                checked={svInspector.onlyDisplayRelevantRegionsInCircularView}\n                onClick={evt =>\n                  svInspector.setOnlyDisplayRelevantRegionsInCircularView(\n                    evt.target.checked,\n                  )\n                }\n              />\n            }\n            label=\"show only regions with data\"\n          />\n        </Grid>\n      </Grid>\n    )\n  })\n\n  function SvInspectorView({ model }) {\n    const classes = useStyles()\n\n    const {\n      resizeHeight,\n      dragHandleHeight,\n      SpreadsheetViewReactComponent,\n      CircularViewReactComponent,\n      showCircularView,\n    } = model\n\n    return (\n      <div className={classes.root} data-testid={model.id}>\n        <Grid container direction=\"row\" className={classes.header}>\n          <Grid item>\n            <ViewControls model={model} />\n          </Grid>\n        </Grid>\n        <div className={classes.viewsContainer}>\n          <div className={classes.spreadsheetViewContainer}>\n            <SpreadsheetViewReactComponent model={model.spreadsheetView} />\n          </div>\n\n          {showCircularView ? (\n            <>\n              <ResizeHandle\n                onDrag={distance => {\n                  const ret1 = model.circularView.resizeWidth(-distance)\n                  const ret2 = model.spreadsheetView.resizeWidth(-ret1)\n                  return ret2\n                }}\n                vertical\n                flexbox\n                style={style}\n              />\n              <div\n                className={classes.circularViewContainer}\n                style={{ width: model.circularView.width }}\n              >\n                <CircularViewOptions svInspector={model} />\n                <CircularViewReactComponent model={model.circularView} />\n              </div>\n            </>\n          ) : null}\n        </div>\n        <ResizeHandle\n          onDrag={resizeHeight}\n          style={{\n            height: dragHandleHeight,\n            background: '#ccc',\n            boxSizing: 'border-box',\n            borderTop: '1px solid #fafafa',\n          }}\n        />\n      </div>\n    )\n  }\n  SvInspectorView.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  return observer(SvInspectorView)\n}\n\nexport default SvInspectorComponentF\n","// this file contains the rather verbose functions for\n// creating features from CSV/TSV lines\nexport default ({ jbrequire }) => {\n  const { parseLocString } = jbrequire('@jbrowse/core/util')\n\n  function makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  ) {\n    // load all the other data in the row into an `otherData` object\n    const otherData = {}\n    columns.forEach((column, columnNumber) => {\n      if (columnsAlreadyUsedInLocations.includes(columnNumber)) {\n        return\n      }\n      let { text } = row.cells[columnNumber]\n      if (column.dataType.type === 'Number') {\n        text = parseFloat(text)\n      }\n      otherData[column.name] = text\n    })\n\n    // make the final feature data out of otherData + the parsed locations\n    return {\n      ...otherData,\n      uniqueId: `sv-inspector-adhoc-${rowNumber}`,\n      refName: loc1.refName,\n      start: loc1.start,\n      end: loc1.end,\n      mate: {\n        refName: loc2.refName,\n        start: loc2.start,\n        end: loc2.end,\n      },\n    }\n  }\n\n  function makeAdHocSvFeatureFromTwoLocations(\n    columns,\n    locationColumnNumbers,\n    row,\n    rowNumber,\n    isValidRefName,\n  ) {\n    // use the first two locations we found (first according to *displayed* order)\n    const loc1 = parseLocString(\n      row.cells[locationColumnNumbers[0]].text,\n      isValidRefName,\n    )\n    const loc2 = parseLocString(\n      row.cells[locationColumnNumbers[1]].text,\n      isValidRefName,\n    )\n\n    const columnsAlreadyUsedInLocations = [\n      locationColumnNumbers[0],\n      locationColumnNumbers[1],\n    ]\n\n    return makeAdHocFeature(\n      columns,\n      columnsAlreadyUsedInLocations,\n      row,\n      loc1,\n      loc2,\n      rowNumber,\n    )\n  }\n\n  function makeAdHocSvFeatureFromTwoRefStartEndSets(\n    columns,\n    locRefColumnNumbers,\n    locStartColumnNumbers,\n    locEndColumnNumbers,\n    row,\n    rowNumber,\n  ) {\n    const textOf = colno => row.cells[colno].text\n    const loc1 = {\n      refName: textOf(locRefColumnNumbers[0]),\n      start: parseInt(textOf(locStartColumnNumbers[0]), 10) - 1,\n      end: parseInt(textOf(locEndColumnNumbers[0]), 10),\n    }\n    const loc2 = {\n      refName: textOf(locRefColumnNumbers[1]),\n      start: parseInt(textOf(locStartColumnNumbers[1]), 10) - 1,\n      end: parseInt(textOf(locEndColumnNumbers[1]), 10),\n    }\n    const columnsAlreadyUsedInLocations = [\n      locRefColumnNumbers[0],\n      locStartColumnNumbers[0],\n      locEndColumnNumbers[0],\n      locRefColumnNumbers[1],\n      locStartColumnNumbers[1],\n      locEndColumnNumbers[1],\n    ]\n    return makeAdHocFeature(\n      columns,\n      columnsAlreadyUsedInLocations,\n      row,\n      loc1,\n      loc2,\n      rowNumber,\n    )\n  }\n\n  // makes a feature data object (passed as `data` to a SimpleFeature constructor)\n  // out of table row if the row has 2 location columns. undefined if not\n  function makeAdHocSvFeature(sheet, rowNumber, row, isValidRefName) {\n    const { columns, columnDisplayOrder } = sheet\n    const columnTypes = {}\n    columnDisplayOrder.forEach(columnNumber => {\n      const columnDefinition = columns[columnNumber]\n      if (!columnTypes[columnDefinition.dataType.type]) {\n        columnTypes[columnDefinition.dataType.type] = []\n      }\n      columnTypes[columnDefinition.dataType.type].push(columnNumber)\n    })\n    const locationColumnNumbers = columnTypes.LocString || []\n    const locStartColumnNumbers = columnTypes.LocStart || []\n    const locEndColumnNumbers = columnTypes.LocEnd || []\n    const locRefColumnNumbers = columnTypes.LocRef || []\n\n    // if we have 2 or more columns of type location, make a feature from them\n    if (locationColumnNumbers.length >= 2) {\n      return makeAdHocSvFeatureFromTwoLocations(\n        columns,\n        locationColumnNumbers,\n        row,\n        rowNumber,\n        isValidRefName,\n      )\n    }\n    if (\n      locRefColumnNumbers.length >= 2 &&\n      locStartColumnNumbers.length >= 2 &&\n      locEndColumnNumbers.length >= 2\n    ) {\n      return makeAdHocSvFeatureFromTwoRefStartEndSets(\n        columns,\n        locRefColumnNumbers,\n        locStartColumnNumbers,\n        locEndColumnNumbers,\n        row,\n        rowNumber,\n      )\n    }\n    return undefined\n  }\n\n  return {\n    makeAdHocSvFeature,\n    makeAdHocSvFeatureFromTwoLocations,\n    makeAdHocSvFeatureFromTwoRefStartEndSets,\n  }\n}\n","import SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport adhocFeatureUtilsFactory from './adhocFeatureUtils'\n\nexport default pluginManager => {\n  const { jbrequire } = pluginManager\n  const { getSession } = jbrequire('@jbrowse/core/util')\n\n  const { makeAdHocSvFeature } = jbrequire(adhocFeatureUtilsFactory)\n\n  function getSerializedFeatureForRow(\n    session,\n    spreadsheetView,\n    row,\n    rowNumber,\n  ) {\n    if (row.extendedData) {\n      if (row.extendedData.vcfFeature) {\n        return row.extendedData.vcfFeature\n      }\n      if (row.extendedData.feature) {\n        return row.extendedData.feature\n      }\n    }\n    const adhocFeature = makeAdHocSvFeature(\n      spreadsheetView.spreadsheet,\n      rowNumber,\n      row,\n      session.assemblyManager.isValidRefName,\n    )\n    if (adhocFeature) {\n      return adhocFeature\n    }\n    return undefined\n  }\n\n  function breakpointSplitViewSnapshotFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  ) {\n    const session = getSession(spreadsheetView)\n    const featureData = getSerializedFeatureForRow(\n      session,\n      spreadsheet,\n      row,\n      rowNumber,\n    )\n    if (featureData) {\n      const feature = new SimpleFeature(featureData)\n      session.setSelection(feature)\n      const viewType = pluginManager.getViewType('BreakpointSplitView')\n      const { circularView } = svInspectorView\n      const viewSnapshot = viewType.snapshotFromBreakendFeature(\n        feature,\n        circularView,\n      )\n      return viewSnapshot\n    }\n    return undefined\n  }\n\n  function openBreakpointSplitViewFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  ) {\n    const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n      svInspectorView,\n      spreadsheetView,\n      spreadsheet,\n      row,\n      rowNumber,\n    )\n    if (viewSnapshot) {\n      // try to center the offsetPx\n      const { circularView } = svInspectorView\n      viewSnapshot.views[0].offsetPx -= circularView.width / 2 + 100\n      viewSnapshot.views[1].offsetPx -= circularView.width / 2 + 100\n\n      const session = getSession(spreadsheetView)\n      session.addView('BreakpointSplitView', viewSnapshot)\n    }\n  }\n\n  function canOpenBreakpointSplitViewFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  ) {\n    try {\n      const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n        svInspectorView,\n        spreadsheetView,\n        spreadsheet,\n        row,\n        rowNumber,\n      )\n      return Boolean(viewSnapshot)\n    } catch (e) {\n      return false\n    }\n  }\n\n  return {\n    getSerializedFeatureForRow,\n    breakpointSplitViewSnapshotFromTableRow,\n    canOpenBreakpointSplitViewFromTableRow,\n    openBreakpointSplitViewFromTableRow,\n  }\n}\n","import OpenInNewIcon from '@material-ui/icons/OpenInNew'\nimport breakpointSplitViewFromTableRowFactory from './breakpointSplitViewFromTableRow'\n\nfunction defaultOnChordClick(feature, chordTrack, pluginManager) {\n  const { jbrequire } = pluginManager\n  // const { getConf } = jbrequire('@jbrowse/core/configuration')\n  const { getContainingView, getSession } = jbrequire('@jbrowse/core/util')\n  // const { resolveIdentifier } = jbrequire('mobx-state-tree')\n\n  const session = getSession(chordTrack)\n  session.setSelection(feature)\n  const view = getContainingView(chordTrack)\n  const viewType = pluginManager.getViewType('BreakpointSplitView')\n  const viewSnapshot = viewType.snapshotFromBreakendFeature(feature, view)\n\n  // disabling this for now since there isn't a way to set configRelationships\n  // on the generated chord display from the SV inspector\n\n  // // open any evidence tracks defined in configRelationships for this track\n  // const tracks = getConf(chordTrack, 'configRelationships')\n  //   .map(entry => {\n  //     const type = pluginManager.pluggableConfigSchemaType('track')\n  //     const trackConfig = resolveIdentifier(type, session, entry.target)\n  //     return trackConfig\n  //       ? {\n  //           type: trackConfig.type,\n  //           height: 100,\n  //           configuration: trackConfig.trackId,\n  //           selectedRendering: '',\n  //         }\n  //       : null\n  //   })\n  //   .filter(f => !!f)\n  // viewSnapshot.views[0].tracks = tracks\n  // viewSnapshot.views[1].tracks = tracks\n\n  // try to center the offsetPx\n  viewSnapshot.views[0].offsetPx -= view.width / 2 + 100\n  viewSnapshot.views[1].offsetPx -= view.width / 2 + 100\n  viewSnapshot.featureData = feature.data\n\n  session.addView('BreakpointSplitView', viewSnapshot)\n}\n\nconst SvInspectorViewF = pluginManager => {\n  const { jbrequire } = pluginManager\n  const { autorun, reaction } = pluginManager.lib.mobx\n  const { types, getParent, addDisposer, getSnapshot } = pluginManager.lib[\n    'mobx-state-tree'\n  ]\n  const { BaseViewModel } = jbrequire(\n    '@jbrowse/core/pluggableElementTypes/models',\n  )\n  const { getSession } = jbrequire('@jbrowse/core/util')\n  const { readConfObject } = jbrequire('@jbrowse/core/configuration')\n\n  const SpreadsheetViewType = pluginManager.getViewType('SpreadsheetView')\n  const CircularViewType = pluginManager.getViewType('CircularView')\n\n  const minHeight = 400\n  const defaultHeight = 500\n  const headerHeight = 52\n  const circularViewOptionsBarHeight = 52\n\n  const {\n    canOpenBreakpointSplitViewFromTableRow,\n    openBreakpointSplitViewFromTableRow,\n    getSerializedFeatureForRow,\n  } = jbrequire(breakpointSplitViewFromTableRowFactory)\n\n  const model = types\n    .model('SvInspectorView', {\n      type: types.literal('SvInspectorView'),\n      dragHandleHeight: 4,\n      height: types.optional(\n        types.refinement(\n          'SvInspectorViewHeight',\n          types.number,\n          n => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n\n      onlyDisplayRelevantRegionsInCircularView: false,\n\n      // switch specifying whether we are showing the import wizard or the\n      // spreadsheet in our viewing area\n      mode: types.optional(\n        types.enumeration('SvInspectorViewMode', ['import', 'display']),\n        'import',\n      ),\n\n      spreadsheetView: types.optional(SpreadsheetViewType.stateModel, () =>\n        SpreadsheetViewType.stateModel.create({\n          type: 'SpreadsheetView',\n          hideViewControls: true,\n          hideVerticalResizeHandle: true,\n        }),\n      ),\n\n      circularView: types.optional(CircularViewType.stateModel, () =>\n        CircularViewType.stateModel.create({\n          type: 'CircularView',\n          hideVerticalResizeHandle: true,\n          hideTrackSelectorButton: true,\n          disableImportForm: true,\n        }),\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      get selectedRows() {\n        return self.spreadsheetView.rowSet.selectedRows\n      },\n\n      get assemblyName() {\n        const { assembly } = self.spreadsheetView\n        if (assembly) {\n          return readConfObject(assembly, 'name')\n        }\n        return undefined\n      },\n\n      get showCircularView() {\n        return self.spreadsheetView.mode === 'display'\n      },\n\n      get featuresAdapterConfigSnapshot() {\n        const session = getSession(self)\n        return {\n          type: 'FromConfigAdapter',\n          features: (self.spreadsheetView.outputRows || [])\n            .map((row, rowNumber) =>\n              getSerializedFeatureForRow(\n                session,\n                self.spreadsheetView,\n                row,\n                rowNumber,\n              ),\n            )\n            .filter(f => Boolean(f)),\n        }\n      },\n\n      // Promise<string[]> of refnames\n      get featuresRefNamesP() {\n        const {\n          AdapterClass: FromConfigAdapter,\n        } = pluginManager.getAdapterType('FromConfigAdapter')\n        const adapter = new FromConfigAdapter(\n          self.featuresAdapterConfigSnapshot,\n        )\n        return adapter.getRefNames()\n      },\n\n      get featuresCircularTrackConfiguration() {\n        pluginManager.jexl.addFunction(\n          'defaultOnChordClick',\n          defaultOnChordClick,\n        )\n        const configuration = {\n          type: 'VariantTrack',\n          trackId: `sv-inspector-variant-track-${self.id}`,\n          name: 'features from tabular data',\n          adapter: self.featuresAdapterConfigSnapshot,\n          assemblyNames: [self.assemblyName],\n          displays: [\n            {\n              type: 'ChordVariantDisplay',\n              displayId: `sv-inspector-variant-track-chord-display-${self.id}`,\n              onChordClick: `jexl:defaultOnChordClick(feature, track, pluginManager)`,\n              renderer: { type: 'StructuralVariantChordRenderer' },\n            },\n          ],\n        }\n        return configuration\n      },\n    }))\n    .volatile(() => ({\n      SpreadsheetViewReactComponent: SpreadsheetViewType.ReactComponent,\n      CircularViewReactComponent: CircularViewType.ReactComponent,\n      circularViewOptionsBarHeight,\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // synchronize subview widths\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const borderWidth = 1\n              if (self.showCircularView) {\n                const spreadsheetWidth = Math.round(self.width * 0.66)\n                const circularViewWidth = self.width - spreadsheetWidth\n                self.spreadsheetView.setWidth(spreadsheetWidth - borderWidth)\n                self.circularView.setWidth(circularViewWidth)\n              } else {\n                self.spreadsheetView.setWidth(self.width)\n              }\n            },\n            { name: 'SvInspectorView width binding' },\n          ),\n        )\n        // synchronize subview heights\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              self.spreadsheetView.setHeight(self.height - headerHeight)\n              self.circularView.setHeight(\n                self.height - headerHeight - circularViewOptionsBarHeight,\n              )\n            },\n            { name: 'SvInspectorView height binding' },\n          ),\n        )\n        // bind circularview displayedRegions to spreadsheet assembly, mediated by\n        // the onlyRelevantRegions toggle\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const {\n                assemblyName,\n                onlyDisplayRelevantRegionsInCircularView,\n                circularView,\n                featuresRefNamesP,\n              } = self\n              const { tracks } = circularView\n              const session = getSession(self)\n              if (assemblyName) {\n                const assembly = session.assemblyManager.get(assemblyName)\n                if (assembly) {\n                  let { regions: assemblyRegions } = assembly\n                  if (!assemblyRegions) {\n                    assemblyRegions = []\n                  } else {\n                    assemblyRegions = getSnapshot(assemblyRegions)\n                  }\n                  if (onlyDisplayRelevantRegionsInCircularView) {\n                    if (tracks.length === 1) {\n                      const {\n                        getCanonicalRefName,\n                      } = session.assemblyManager.get(assemblyName)\n\n                      featuresRefNamesP\n                        .then(featureRefNames => {\n                          // canonicalize the store's ref names if necessary\n                          const canonicalFeatureRefNames = new Set(\n                            featureRefNames.map(\n                              refName =>\n                                getCanonicalRefName(refName) || refName,\n                            ),\n                          )\n                          const displayedRegions = assemblyRegions.filter(r =>\n                            canonicalFeatureRefNames.has(r.refName),\n                          )\n                          circularView.setDisplayedRegions(\n                            JSON.parse(JSON.stringify(displayedRegions)),\n                          )\n                        })\n                        .catch(e => circularView.setError(e))\n                    }\n                  } else {\n                    circularView.setDisplayedRegions(assemblyRegions)\n                  }\n                } else {\n                  circularView.setDisplayedRegions([])\n                }\n              }\n            },\n            { name: 'SvInspectorView displayed regions bind' },\n          ),\n        )\n\n        // bind circularview tracks to our track snapshot view\n        addDisposer(\n          self,\n          reaction(\n            () => ({\n              generatedTrackConf:\n                self && self.featuresCircularTrackConfiguration,\n              assemblyName: self && self.assemblyName,\n            }),\n            data => {\n              if (!data) {\n                return\n              }\n              const { assemblyName, generatedTrackConf } = data\n              // hide any visible tracks\n              if (self.circularView.tracks.length) {\n                self.circularView.tracks.forEach(track => {\n                  self.circularView.hideTrack(track.configuration.trackId)\n                })\n              }\n\n              // put our track in as the only track\n              if (assemblyName && generatedTrackConf) {\n                self.circularView.addTrackConf(generatedTrackConf, {\n                  assemblyName,\n                })\n              }\n            },\n            {\n              name: 'SvInspectorView track configuration binding',\n              fireImmediately: true,\n            },\n          ),\n        )\n\n        // bind spreadsheetView row menu actions to us\n        addDisposer(\n          self,\n          autorun(() => {\n            self.spreadsheetView.setRowMenuItems(\n              // these are the MenuItem entries for the row menu actions in the spreadsheet view.\n              // these are installed into the child SpreadsheetView using an autorun below\n              [\n                {\n                  label: 'Open split detail view',\n                  icon: OpenInNewIcon,\n                  disabled(spreadsheetView, spreadsheet, rowNumber, row) {\n                    return !canOpenBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                  onClick(spreadsheetView, spreadsheet, rowNumber, row) {\n                    openBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                },\n              ],\n            )\n          }),\n        )\n      },\n      setWidth(newWidth) {\n        self.width = newWidth\n      },\n      setHeight(newHeight) {\n        if (newHeight > minHeight) {\n          self.height = newHeight\n        } else {\n          self.height = minHeight\n        }\n        return self.height\n      },\n      resizeHeight(distance) {\n        const oldHeight = self.height\n        const newHeight = self.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n\n      setImportMode() {\n        self.spreadsheetView.setImportMode()\n      },\n\n      setDisplayMode() {\n        self.spreadsheetView.setDisplayMode()\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setDisplayedRegions(regions) {\n        self.circularView.setDisplayedRegions(regions)\n      },\n\n      setOnlyDisplayRelevantRegionsInCircularView(val) {\n        self.onlyDisplayRelevantRegionsInCircularView = Boolean(val)\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return { stateModel }\n}\n\nexport default SvInspectorViewF\n","import ReactComponentFactory from './components/SvInspectorView'\nimport StateModelFactory from './models/SvInspectorView'\n\nconst SvInspectorViewF = ({ jbrequire }) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n\n  const ReactComponent = jbrequire(ReactComponentFactory)\n  const { stateModel } = jbrequire(StateModelFactory)\n\n  return new ViewType({ name: 'SvInspectorView', stateModel, ReactComponent })\n}\n\nexport default SvInspectorViewF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  AbstractSessionModel,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util/types'\nimport TableChartIcon from '@material-ui/icons/TableChart'\nimport SvInspectorViewTypeFactory from './SvInspectorView/SvInspectorViewType'\n\nexport default class SvInspectorViewPlugin extends Plugin {\n  name = 'SvInspectorViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(SvInspectorViewTypeFactory),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'SV inspector',\n        icon: TableChartIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SvInspectorView', {})\n        },\n      })\n    }\n  }\n}\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nfunction HicRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n}) {\n  const { width, height } = props\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n    </div>\n  )\n}\n\nexport default observer(HicRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'HicRenderer',\n  {\n    baseColor: {\n      type: 'color',\n      description: 'base color to be used in the hic alignment',\n      defaultValue: '#f00',\n    },\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a hic alignment',\n      defaultValue: `jexl:baseColor|alpha(min(1,count/(maxScore/20)))|hsl|colorString`,\n      contextVariable: ['count', 'maxScore', 'baseColor'],\n    },\n\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a hic rendering',\n      defaultValue: 600,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import Color from 'color'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport { Region } from '@jbrowse/core/util/types'\nimport { abortBreakPoint } from '@jbrowse/core/util'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { toArray } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\ninterface HicFeature {\n  bin1: number\n  bin2: number\n  counts: number\n}\n\ninterface HicDataAdapter extends BaseFeatureDataAdapter {\n  getResolution: (bp: number) => Promise<number>\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  regions: Region[]\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  regions: Region[]\n  dataAdapter: HicDataAdapter\n  bpPerPx: number\n  highResolutionScaling: number\n  resolution: number\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: HicFeature[]\n}\n\nexport type { RenderArgsSerialized, RenderResults }\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport type ResultsDeserialized = ServerSideResultsDeserialized\n\nexport default class HicRenderer extends ServerSideRendererType {\n  supportsSVG = true\n\n  async makeImageData(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { features, config, bpPerPx, signal, dataAdapter, resolution } = props\n    const res = await dataAdapter.getResolution(bpPerPx / resolution)\n    const w = res / (bpPerPx * Math.sqrt(2))\n    const baseColor = Color(readConfObject(config, 'baseColor'))\n    if (features.length) {\n      const offset = features[0].bin1\n      let maxScore = 0\n      let minBin = 0\n      let maxBin = 0\n      await abortBreakPoint(signal)\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        maxScore = Math.max(counts, maxScore)\n        minBin = Math.min(Math.min(bin1, bin2), minBin)\n        maxBin = Math.max(Math.max(bin1, bin2), maxBin)\n      }\n      await abortBreakPoint(signal)\n      ctx.rotate(-Math.PI / 4)\n      let start = Date.now()\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        ctx.fillStyle = readConfObject(config, 'color', {\n          count: counts,\n          maxScore,\n          baseColor,\n        })\n        ctx.fillRect((bin1 - offset) * w, (bin2 - offset) * w, w, w)\n        if (+Date.now() - start > 400) {\n          await abortBreakPoint(signal)\n          start = +Date.now()\n        }\n      }\n    }\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const { config, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    const height = readConfObject(config, 'maxHeight')\n    const features = await this.getFeatures(renderProps)\n\n    const res = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      (ctx: CanvasRenderingContext2D) => {\n        return this.makeImageData(ctx, {\n          ...renderProps,\n          features,\n        })\n      },\n    )\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      region: renderProps.regions[0],\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      height,\n      width,\n    }\n  }\n\n  async getFeatures(args: RenderArgsDeserialized) {\n    const { dataAdapter, regions } = args\n    const features = await dataAdapter\n      .getFeatures(regions[0], args)\n      .pipe(toArray())\n      .toPromise()\n    // cast to any to avoid return-type conflict, because the\n    // types of features returned by our getFeatures are quite\n    // different from the base interface\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return features as any\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nconst HicTrackConfigFactory = (pluginManager: PluginManager) => {\n  const HicRendererConfigSchema = pluginManager.getRendererType('HicRenderer')\n    .configSchema\n\n  return ConfigurationSchema(\n    'LinearHicDisplay',\n    { renderer: HicRendererConfigSchema },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type HicTrackConfigModel = ReturnType<typeof HicTrackConfigFactory>\nexport type HicTrackConfig = Instance<HicTrackConfigModel>\nexport default HicTrackConfigFactory\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types, getEnv } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\n\nexport default (configSchema: AnyConfigurationSchemaType) =>\n  types\n    .compose(\n      'LinearHicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearHicDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        resolution: types.optional(types.number, 1),\n      }),\n    )\n    .views(self => ({\n      get blockType() {\n        return 'dynamicBlocks'\n      },\n      get rendererTypeName() {\n        return 'HicRenderer'\n      },\n\n      /**\n       * the react props that are passed to the Renderer when data\n       * is rendered in this track\n       */\n      get renderProps() {\n        const config = self.rendererType.configSchema.create(\n          getConf(self, 'renderer') || {},\n          getEnv(self),\n        )\n\n        return {\n          ...self.composedRenderProps,\n          ...getParentRenderProps(self),\n          config,\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          resolution: self.resolution,\n        }\n      },\n    }))\n    .actions(self => ({\n      setResolution(n: number) {\n        self.resolution = n\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems } = self\n      return {\n        get composedTrackMenuItems() {\n          return [\n            {\n              label: 'Resolution',\n              subMenu: [\n                {\n                  label: 'Finer resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution * 2)\n                  },\n                },\n                {\n                  label: 'Coarser resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution / 2)\n                  },\n                },\n              ],\n            },\n          ]\n        },\n\n        get trackMenuItems() {\n          return [...trackMenuItems, ...this.composedTrackMenuItems]\n        },\n      }\n    })\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'HicAdapter',\n  {\n    hicLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.hic' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport Color from 'color'\nimport HicRenderer, {\n  configSchema as hicRendererConfigSchema,\n  ReactComponent as HicRendererReactComponent,\n} from './HicRenderer'\nimport {\n  configSchemaFactory as linearHicdisplayConfigSchemaFactory,\n  modelFactory as linearHicdisplayModelFactory,\n} from './LinearHicDisplay'\nimport hicAdapterConfigSchema from './HicAdapter/configSchema'\n\nexport default class HicPlugin extends Plugin {\n  name = 'HicPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'HicAdapter',\n          configSchema: hicAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./HicAdapter/HicAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addRendererType(\n      () =>\n        new HicRenderer({\n          name: 'HicRenderer',\n          ReactComponent: HicRendererReactComponent,\n          configSchema: hicRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'HicTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'HicTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'HicTrack',\n          configSchema,\n        ),\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearHicdisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearHicDisplay',\n        configSchema,\n        stateModel: linearHicdisplayModelFactory(configSchema),\n        trackType: 'HicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    pluginManager.jexl.addTransform('alpha', (color: Color, value: number) =>\n      color.alpha(value),\n    )\n    pluginManager.jexl.addTransform('hsl', (color: Color) => color.hsl())\n    pluginManager.jexl.addTransform('colorString', (color: Color) =>\n      color.string(),\n    )\n  }\n}\n","import Alignments from '@jbrowse/plugin-alignments'\nimport Bed from '@jbrowse/plugin-bed'\nimport BreakpointSplitView from '@jbrowse/plugin-breakpoint-split-view'\nimport CircularView from '@jbrowse/plugin-circular-view'\nimport Config from '@jbrowse/plugin-config'\nimport DataManagement from '@jbrowse/plugin-data-management'\nimport DotplotView from '@jbrowse/plugin-dotplot-view'\nimport Filtering from '@jbrowse/plugin-filtering'\nimport Gff3Tabix from '@jbrowse/plugin-gff3'\nimport LegacyJBrowse from '@jbrowse/plugin-legacy-jbrowse'\nimport LinearGenomeView from '@jbrowse/plugin-linear-genome-view'\nimport LinearComparativeView from '@jbrowse/plugin-linear-comparative-view'\nimport Lollipop from '@jbrowse/plugin-lollipop'\nimport Menus from '@jbrowse/plugin-menus'\nimport RDF from '@jbrowse/plugin-rdf'\nimport Sequence from '@jbrowse/plugin-sequence'\nimport SVG from '@jbrowse/plugin-svg'\nimport TrackHubRegistry from '@jbrowse/plugin-trackhub-registry'\nimport Variants from '@jbrowse/plugin-variants'\nimport Wiggle from '@jbrowse/plugin-wiggle'\nimport SpreadsheetViewPlugin from '@jbrowse/plugin-spreadsheet-view'\nimport SvInspectorPlugin from '@jbrowse/plugin-sv-inspector'\nimport HicPlugin from '@jbrowse/plugin-hic'\n\nconst corePlugins = [\n  SVG,\n  LinearGenomeView,\n  Alignments,\n  Bed,\n  CircularView,\n  Config,\n  DataManagement,\n  DotplotView,\n  Filtering,\n  Gff3Tabix,\n  LegacyJBrowse,\n  LinearComparativeView,\n  Lollipop,\n  Menus,\n  RDF,\n  Sequence,\n  TrackHubRegistry,\n  Variants,\n  Wiggle,\n  SpreadsheetViewPlugin,\n  SvInspectorPlugin,\n  BreakpointSplitView,\n  HicPlugin,\n]\n\nexport default corePlugins\n","import React, { useState, useEffect } from 'react'\nimport Button from '@material-ui/core/Button'\nimport ShareIcon from '@material-ui/icons/Share'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  Divider,\n  IconButton,\n  FormControl,\n  FormControlLabel,\n  Radio,\n  RadioGroup,\n  TextField,\n  Typography,\n} from '@material-ui/core'\n\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport CloseIcon from '@material-ui/icons/Close'\nimport copy from 'copy-to-clipboard'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { toUrlSafeB64 } from '@jbrowse/core/util'\nimport { shareSessionToDynamo } from './sessionSharing'\nimport { SessionModel } from './sessionModelFactory'\n\nconst useStyles = makeStyles(theme => ({\n  shareDiv: {\n    textAlign: 'center',\n    paddingLeft: '2px',\n  },\n  shareButton: {\n    '&:hover': {\n      backgroundColor: fade(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  loadingMessage: {\n    padding: theme.spacing(5),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nconst SHARE_URL_LOCALSTORAGE_KEY = 'jbrowse-shareURL'\n\nfunction SettingsDialog(props: {\n  open: boolean\n  onClose: Function\n  currentSetting: string\n}) {\n  const classes = useStyles()\n  const { onClose, open, currentSetting } = props\n  const [setting, setSetting] = useState(currentSetting)\n  const [infoDialogOpen, setInfoDialogOpen] = useState(false)\n\n  const handleClose = () => {\n    localStorage.setItem(SHARE_URL_LOCALSTORAGE_KEY, setting)\n    onClose(setting)\n  }\n\n  return (\n    <>\n      <Dialog onClose={handleClose} open={open}>\n        <DialogTitle>\n          Configure session sharing\n          {handleClose ? (\n            <IconButton className={classes.closeButton} onClick={handleClose}>\n              <CloseIcon />\n            </IconButton>\n          ) : null}\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            Select between generating long or short URLs for the session sharing\n            <IconButton onClick={() => setInfoDialogOpen(true)}>\n              <HelpOutlineIcon />\n            </IconButton>\n          </DialogContentText>\n          <FormControl component=\"fieldset\">\n            <RadioGroup\n              value={setting}\n              onChange={event => {\n                const val = event.target.value\n                setSetting(val)\n              }}\n            >\n              <FormControlLabel\n                value=\"short\"\n                control={<Radio />}\n                label=\"Short URL\"\n              />\n              <FormControlLabel\n                value=\"long\"\n                control={<Radio />}\n                label=\"Long URL\"\n              />\n            </RadioGroup>\n          </FormControl>\n        </DialogContent>\n      </Dialog>\n      <InfoDialog\n        open={infoDialogOpen}\n        onClose={() => {\n          setInfoDialogOpen(false)\n        }}\n      />\n    </>\n  )\n}\nfunction InfoDialog(props: { open: boolean; onClose: Function }) {\n  const classes = useStyles()\n  const { onClose, open } = props\n\n  const handleClose = () => {\n    onClose()\n  }\n\n  return (\n    <Dialog onClose={handleClose} open={open}>\n      <DialogTitle id=\"simple-dialog-title\">\n        Info about session URLs\n        {onClose ? (\n          <IconButton className={classes.closeButton} onClick={handleClose}>\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Because everything about the JBrowse session is encoded in the URL\n          (e.g. state of the tracks, views, features selected, etc.) the\n          sessions can get very long. Therefore, we created a URL shortener,\n          both as a convenience and because long URLs can break some programs.\n          Note that both the long and short URLs encode the same data, but due\n          to long URLs causing problems with some programs, we recommend sharing\n          short URLs.\n        </DialogContentText>\n        <DialogContentText>\n          We generate the short URLs in a secure manner which involves\n          encrypting the session on the client side with a random password\n          string and uploading them to a central database. Then the random\n          password is added to the URL but is not uploaded to the central\n          database, making these short URLs effectively &quot;end-to-end\n          encrypted&quot;\n        </DialogContentText>\n        <DialogContentText>\n          Only users with a share link can read the session.\n        </DialogContentText>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst ShareDialog = observer(\n  ({\n    handleClose,\n    session,\n  }: {\n    handleClose: () => void\n    session: SessionModel\n  }) => {\n    const classes = useStyles()\n    const [shortUrl, setShortUrl] = useState('')\n    const [loading, setLoading] = useState(true)\n    const [error, setError] = useState<Error>()\n    const [settingsDialogOpen, setSettingsDialogOpen] = useState(false)\n\n    const url = session.shareURL\n    const currentSetting =\n      localStorage.getItem(SHARE_URL_LOCALSTORAGE_KEY) || 'short'\n    const snap = getSnapshot(session)\n\n    useEffect(() => {\n      let cancelled = false\n      ;(async () => {\n        if (currentSetting === 'short') {\n          try {\n            setLoading(true)\n            const locationUrl = new URL(window.location.href)\n            const result = await shareSessionToDynamo(\n              snap,\n              url,\n              locationUrl.href,\n            )\n            if (!cancelled) {\n              setLoading(false)\n              const params = new URLSearchParams(locationUrl.search)\n              params.set('session', `share-${result.json.sessionId}`)\n              params.set('password', result.password)\n              locationUrl.search = params.toString()\n              setShortUrl(locationUrl.href)\n            }\n          } catch (e) {\n            setLoading(false)\n            setError(e)\n          }\n        }\n      })()\n\n      return () => {\n        cancelled = true\n      }\n    }, [currentSetting, url, snap])\n\n    // generate long URL\n    const sess = `${toUrlSafeB64(JSON.stringify(getSnapshot(session)))}`\n    const longUrl = new URL(window.location.href)\n    const longParams = new URLSearchParams(longUrl.search)\n    longParams.set('session', `encoded-${sess}`)\n    longUrl.search = longParams.toString()\n    return (\n      <>\n        <Dialog\n          maxWidth=\"xl\"\n          open\n          onClose={handleClose}\n          data-testid=\"share-dialog\"\n        >\n          <DialogTitle>\n            JBrowse Shareable Link\n            {handleClose ? (\n              <IconButton className={classes.closeButton} onClick={handleClose}>\n                <CloseIcon />\n              </IconButton>\n            ) : null}\n          </DialogTitle>\n          <Divider />\n\n          <>\n            <DialogContent>\n              <DialogContentText>\n                Copy the URL below to share your current JBrowse session.\n                <IconButton onClick={() => setSettingsDialogOpen(true)}>\n                  <SettingsIcon />\n                </IconButton>\n              </DialogContentText>\n            </DialogContent>\n\n            <DialogContent>\n              {currentSetting === 'short' ? (\n                error ? (\n                  <Typography color=\"error\">{`${error}`}</Typography>\n                ) : loading ? (\n                  <Typography>Generating short URL...</Typography>\n                ) : (\n                  <TextField\n                    label=\"URL\"\n                    value={shortUrl}\n                    InputProps={{\n                      readOnly: true,\n                    }}\n                    inputProps={{ 'data-testid': 'share-url-text' }}\n                    variant=\"filled\"\n                    style={{ width: '100%' }}\n                    onClick={event => {\n                      const target = event.target as HTMLTextAreaElement\n                      target.select()\n                    }}\n                    data-testid=\"share-url-field\"\n                  />\n                )\n              ) : (\n                <TextField\n                  label=\"URL\"\n                  value={longUrl.toString()}\n                  InputProps={{\n                    readOnly: true,\n                  }}\n                  variant=\"filled\"\n                  style={{ width: '100%' }}\n                  onClick={event => {\n                    const target = event.target as HTMLTextAreaElement\n                    target.select()\n                  }}\n                />\n              )}\n            </DialogContent>\n          </>\n          <DialogActions>\n            <Button\n              onClick={() => {\n                copy(shortUrl || longUrl.toString())\n                session.notify('Copied to clipboard', 'success')\n              }}\n              color=\"primary\"\n              startIcon={<ContentCopyIcon />}\n              disabled={currentSetting === 'short' && loading}\n            >\n              Copy URL to Clipboard\n            </Button>\n\n            <Button onClick={handleClose} color=\"primary\" autoFocus>\n              Close\n            </Button>\n          </DialogActions>\n        </Dialog>\n\n        <SettingsDialog\n          open={settingsDialogOpen}\n          onClose={() => {\n            setSettingsDialogOpen(false)\n          }}\n          currentSetting={currentSetting}\n        />\n      </>\n    )\n  },\n)\n\nconst ShareButton = observer((props: { session: SessionModel }) => {\n  const [open, setOpen] = useState(false)\n\n  const { session } = props\n  const classes = useStyles()\n\n  const handleClose = () => {\n    setOpen(false)\n  }\n\n  return (\n    <div className={classes.shareDiv}>\n      <Button\n        data-testid=\"share_button\"\n        onClick={async () => {\n          setOpen(true)\n        }}\n        size=\"small\"\n        color=\"inherit\"\n        startIcon={<ShareIcon />}\n        classes={{ root: classes.shareButton }}\n      >\n        Share\n      </Button>\n      {open ? (\n        <ShareDialog handleClose={handleClose} session={session} />\n      ) : null}\n    </div>\n  )\n})\n\nexport default ShareButton\n","import React from 'react'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport type DataManagementPluginType from '@jbrowse/plugin-data-management'\nimport { AppRootModel } from '@jbrowse/core/util/types'\nimport { observer } from 'mobx-react'\n\ninterface JBrowse {\n  defaultSession: {\n    name: string\n  }\n}\n\nfunction AdminComponent({ pluginManager }: { pluginManager: PluginManager }) {\n  const { rootModel } = pluginManager\n  const DataManagementPlugin = pluginManager.getPlugin('DataManagementPlugin')\n\n  if (!DataManagementPlugin) {\n    throw new Error('Data Management plugin must be installed')\n  }\n\n  const {\n    AssemblyManager,\n    SetDefaultSession,\n  } = (DataManagementPlugin as DataManagementPluginType).exports\n\n  const {\n    isAssemblyEditing,\n    isDefaultSessionEditing,\n    setDefaultSessionEditing,\n    setAssemblyEditing,\n    jbrowse,\n  } = rootModel as AppRootModel\n\n  return (\n    <>\n      <AssemblyManager\n        rootModel={rootModel}\n        open={isAssemblyEditing}\n        onClose={() => {\n          setAssemblyEditing(false)\n        }}\n      />\n      <SetDefaultSession\n        rootModel={rootModel}\n        open={isDefaultSessionEditing}\n        onClose={() => {\n          setDefaultSessionEditing(false)\n        }}\n        currentDefault={(jbrowse as JBrowse).defaultSession.name}\n      />\n    </>\n  )\n}\n\nexport default observer(AdminComponent)\n","import React, { useEffect } from 'react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { useQueryParam, StringParam } from 'use-query-params'\nimport { App, createJBrowseTheme } from '@jbrowse/core/ui'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport { ThemeProvider } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { onSnapshot } from 'mobx-state-tree'\nimport ShareButton from './ShareButton'\nimport AdminComponent from './AdminComponent'\n\nfunction deleteBaseUris(config) {\n  if (typeof config === 'object') {\n    for (const key of Object.keys(config)) {\n      if (typeof config[key] === 'object') {\n        deleteBaseUris(config[key])\n      } else if (key === 'uri') {\n        delete config.baseUri\n      }\n    }\n  }\n}\n\nconst JBrowse = observer(({ pluginManager }) => {\n  const [adminKey] = useQueryParam('adminKey', StringParam)\n  const [adminServer] = useQueryParam('adminServer', StringParam)\n  const [, setSessionId] = useQueryParam('session', StringParam)\n  const { rootModel } = pluginManager\n  const { error, jbrowse, session } = rootModel || {}\n  const { id: currentSessionId } = session\n\n  useEffect(() => {\n    setSessionId(`local-${currentSessionId}`)\n    window.JBrowseRootModel = rootModel\n    window.JBrowseSession = session\n  }, [currentSessionId, rootModel, session, setSessionId])\n\n  useEffect(() => {\n    onSnapshot(jbrowse, async snapshot => {\n      if (adminKey) {\n        const config = JSON.parse(JSON.stringify(snapshot))\n        deleteBaseUris(config)\n        const payload = { adminKey, config }\n\n        const response = await fetch(adminServer || `/updateConfig`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(payload),\n        })\n        if (!response.ok) {\n          const message = await response.text()\n          session.notify(\n            `Admin server error: ${response.status} (${response.statusText}) ${\n              message || ''\n            }`,\n          )\n        }\n      }\n    })\n  }, [jbrowse, session, adminKey, adminServer])\n\n  if (error) {\n    throw error\n  }\n\n  const theme = getConf(rootModel.jbrowse, 'theme')\n  return (\n    <ThemeProvider theme={createJBrowseTheme(theme)}>\n      <CssBaseline />\n      <App\n        session={session}\n        HeaderButtons={<ShareButton session={session} />}\n      />\n      {adminKey ? <AdminComponent pluginManager={pluginManager} /> : null}\n    </ThemeProvider>\n  )\n})\n\nexport default JBrowse\n","import jsonStableStringify from 'json-stable-stringify'\nimport { cast, getParent, IAnyType, types, Instance } from 'mobx-state-tree'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport { readConfObject } from '../configuration'\nimport {\n  BaseRefNameAliasAdapter,\n  RegionsAdapter,\n} from '../data_adapters/BaseAdapter'\nimport PluginManager from '../PluginManager'\nimport { Region } from '../util/types'\nimport { Region as MSTRegion } from '../util/types/mst'\nimport { makeAbortableReaction, when } from '../util'\nimport QuickLRU from '../util/QuickLRU'\n\n// Based on the UCSC Genome Browser chromosome color palette:\n// https://github.com/ucscGenomeBrowser/kent/blob/a50ed53aff81d6fb3e34e6913ce18578292bc24e/src/hg/inc/chromColors.h\n// Some colors darkened to have at least a 3:1 contrast ratio on a white\n// background\nconst refNameColors = [\n  'rgb(153, 102, 0)',\n  'rgb(102, 102, 0)',\n  'rgb(153, 153, 30)',\n  'rgb(204, 0, 0)',\n  'rgb(255, 0, 0)',\n  'rgb(255, 0, 204)',\n  'rgb(165, 132, 132)', // originally 'rgb(255, 204, 204)'\n  'rgb(204, 122, 0)', // originally rgb(255, 153, 0)'\n  'rgb(178, 142, 0)', // originally 'rgb(255, 204, 0)'\n  'rgb(153, 153, 0)', // originally 'rgb(255, 255, 0)'\n  'rgb(122, 153, 0)', // originally 'rgb(204, 255, 0)'\n  'rgb(0, 165, 0)', // originally 'rgb(0, 255, 0)'\n  'rgb(53, 128, 0)',\n  'rgb(0, 0, 204)',\n  'rgb(96, 145, 242)', // originally 'rgb(102, 153, 255)'\n  'rgb(107, 142, 178)', // originally 'rgb(153, 204, 255)'\n  'rgb(0, 165, 165)', // originally 'rgb(0, 255, 255)'\n  'rgb(122, 153, 153)', // originally 'rgb(204, 255, 255)'\n  'rgb(153, 0, 204)',\n  'rgb(204, 51, 255)',\n  'rgb(173, 130, 216)', // originally 'rgb(204, 153, 255)'\n  'rgb(102, 102, 102)',\n  'rgb(145, 145, 145)', // originally 'rgb(153, 153, 153)'\n  'rgb(142, 142, 142)', // originally 'rgb(204, 204, 204)'\n  'rgb(142, 142, 107)', // originally 'rgb(204, 204, 153)'\n  'rgb(96, 163, 48)', // originally 'rgb(121, 204, 61)'\n]\n\nasync function loadRefNameMap(\n  assembly: Assembly,\n  adapterConf: unknown,\n  options: BaseOptions,\n  signal?: AbortSignal,\n) {\n  const { sessionId } = options\n  await when(() => Boolean(assembly.regions && assembly.refNameAliases), {\n    signal,\n    name: 'when assembly ready',\n  })\n\n  const refNames = await assembly.rpcManager.call(\n    sessionId,\n    'CoreGetRefNames',\n    {\n      adapterConfig: adapterConf,\n      signal,\n      ...options,\n    },\n    { timeout: 1000000 },\n  )\n  const refNameMap: Record<string, string> = {}\n  const { refNameAliases } = assembly\n  if (!refNameAliases) {\n    throw new Error(`error loading assembly ${assembly.name}'s refNameAliases`)\n  }\n\n  refNames.forEach((refName: string) => {\n    checkRefName(refName)\n    const canon = assembly.getCanonicalRefName(refName)\n    if (canon) {\n      refNameMap[canon] = refName\n    }\n  })\n\n  // make the reversed map too\n  const reversed: Record<string, string> = {}\n  for (const [canonicalName, adapterName] of Object.entries(refNameMap)) {\n    reversed[adapterName] = canonicalName\n  }\n\n  return {\n    forwardMap: refNameMap,\n    reverseMap: reversed,\n  }\n}\n\nfunction checkRefName(refName: string) {\n  // Valid refName pattern from https://samtools.github.io/hts-specs/SAMv1.pdf\n  if (\n    !refName.match(\n      /[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*/,\n    )\n  ) {\n    throw new Error(`Encountered invalid refName: \"${refName}\"`)\n  }\n}\n\nfunction getAdapterId(adapterConf: unknown) {\n  return jsonStableStringify(adapterConf)\n}\n\ntype RefNameAliases = Record<string, string>\n\nexport interface BaseOptions {\n  signal?: AbortSignal\n  sessionId: string\n  statusCallback?: Function\n}\ninterface CacheData {\n  adapterConf: unknown\n  self: Assembly\n  sessionId: string\n  options: BaseOptions\n}\nexport default function assemblyFactory(\n  assemblyConfigType: IAnyType,\n  pluginManager: PluginManager,\n) {\n  const adapterLoads = new AbortablePromiseCache({\n    cache: new QuickLRU({ maxSize: 1000 }),\n    async fill(\n      args: CacheData,\n      abortSignal?: AbortSignal,\n      statusCallback?: Function,\n    ) {\n      const { adapterConf, self, options } = args\n      return loadRefNameMap(\n        self,\n        adapterConf,\n        { ...options, statusCallback },\n        abortSignal,\n      )\n    },\n  })\n\n  return types\n    .model({\n      configuration: types.safeReference(assemblyConfigType),\n      regions: types.maybe(types.array(MSTRegion)),\n      refNameAliases: types.maybe(types.map(types.string)),\n    })\n    .views(self => ({\n      get initialized() {\n        return Boolean(self.refNameAliases)\n      },\n      get name(): string {\n        return readConfObject(self.configuration, 'name')\n      },\n\n      get aliases(): string[] {\n        return readConfObject(self.configuration, 'aliases')\n      },\n\n      hasName(name: string) {\n        return this.name === name || this.aliases.includes(name)\n      },\n\n      get allAliases() {\n        return [this.name, ...this.aliases]\n      },\n      get refNames() {\n        return self.regions && self.regions.map(region => region.refName)\n      },\n      get allRefNames() {\n        if (!self.refNameAliases) {\n          return undefined\n        }\n        return Array.from(self.refNameAliases.keys())\n      },\n      get rpcManager() {\n        return getParent(self, 2).rpcManager\n      },\n      get refNameColors() {\n        const colors = readConfObject(\n          self.configuration,\n          'refNameColors',\n        ) as string[]\n        if (colors.length === 0) {\n          return refNameColors\n        }\n        return colors\n      },\n    }))\n    .views(self => ({\n      getCanonicalRefName(refName: string) {\n        if (!self.refNameAliases) {\n          throw new Error(\n            'aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called',\n          )\n        }\n        return self.refNameAliases.get(refName)\n      },\n      getRefNameColor(refName: string) {\n        const idx = self.refNames?.findIndex(r => r === refName)\n        if (idx === undefined || idx === -1) {\n          return undefined\n        }\n        return self.refNameColors[idx % self.refNameColors.length]\n      },\n      isValidRefName(refName: string) {\n        if (!self.refNameAliases) {\n          throw new Error(\n            'isValidRefName cannot be called yet, the assembly has not finished loading',\n          )\n        }\n        return !!this.getCanonicalRefName(refName)\n      },\n    }))\n    .actions(self => ({\n      setLoading() {},\n      setLoaded({\n        adapterRegionsWithAssembly,\n        refNameAliases,\n      }: {\n        adapterRegionsWithAssembly: Region[]\n        refNameAliases: RefNameAliases\n      }) {\n        this.setRegions(adapterRegionsWithAssembly)\n        this.setRefNameAliases(refNameAliases)\n      },\n      setError(error: Error) {\n        if (!getParent(self, 3).isAssemblyEditing) {\n          getParent(self, 3).setError(error)\n        }\n      },\n      setRegions(regions: Region[]) {\n        self.regions = cast(regions)\n      },\n      setRefNameAliases(refNameAliases: RefNameAliases) {\n        self.refNameAliases = cast(refNameAliases)\n      },\n      afterAttach() {\n        makeAbortableReaction(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          self as any,\n          // @ts-ignore\n          makeLoadAssemblyData(pluginManager),\n          loadAssemblyReaction,\n          { name: `${self.name} assembly loading`, fireImmediately: true },\n          this.setLoading,\n          this.setLoaded,\n          this.setError,\n        )\n      },\n    }))\n    .views(self => ({\n      getAdapterMapEntry(adapterConf: unknown, options: BaseOptions) {\n        const { signal, statusCallback, ...rest } = options\n        if (!options.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const adapterId = getAdapterId(adapterConf)\n        return adapterLoads.get(\n          adapterId,\n          {\n            adapterConf,\n            self: self as Assembly,\n            options: rest,\n          } as CacheData,\n          signal,\n          statusCallback,\n        )\n      },\n\n      /**\n       * get Map of `canonical-name -> adapter-specific-name`\n       */\n      async getRefNameMapForAdapter(adapterConf: unknown, opts: BaseOptions) {\n        if (!opts || !opts.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.forwardMap\n      },\n\n      /**\n       * get Map of `adapter-specific-name -> canonical-name`\n       */\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        opts: BaseOptions,\n      ) {\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.reverseMap\n      },\n    }))\n}\nfunction makeLoadAssemblyData(pluginManager: PluginManager) {\n  return (self: Assembly) => {\n    if (self.configuration) {\n      // use full configuration instead of snapshot of the config, the\n      // rpcManager normally receives a snapshot but we bypass rpcManager here\n      // to avoid spinning up a webworker\n      const sequenceAdapterConfig = self.configuration.sequence.adapter\n      const refNameAliasesAdapterConfig =\n        self.configuration.refNameAliases?.adapter\n      return {\n        sequenceAdapterConfig,\n        assemblyName: self.name,\n        refNameAliasesAdapterConfig,\n        pluginManager,\n      }\n    }\n    return undefined\n  }\n}\nasync function loadAssemblyReaction(\n  props: ReturnType<ReturnType<typeof makeLoadAssemblyData>> | undefined,\n  signal: AbortSignal,\n) {\n  if (!props) {\n    return\n  }\n\n  const {\n    sequenceAdapterConfig,\n    assemblyName,\n    refNameAliasesAdapterConfig,\n    pluginManager,\n  } = props\n\n  const dataAdapterType = pluginManager.getAdapterType(\n    sequenceAdapterConfig.type,\n  )\n  const { AdapterClass, getAdapterClass } = dataAdapterType\n  const CLASS = AdapterClass || (await getAdapterClass?.())\n  if (!CLASS) {\n    throw new Error('Failed to get adapter class')\n  }\n  const adapter = new CLASS(sequenceAdapterConfig) as RegionsAdapter\n  const adapterRegions = (await adapter.getRegions({ signal })) as Region[]\n\n  const adapterRegionsWithAssembly = adapterRegions.map(adapterRegion => {\n    const { refName } = adapterRegion\n    checkRefName(refName)\n    return { ...adapterRegion, assemblyName }\n  })\n  const refNameAliases: RefNameAliases = {}\n  if (refNameAliasesAdapterConfig) {\n    const refAliasAdapterType = pluginManager.getAdapterType(\n      refNameAliasesAdapterConfig.type,\n    )\n    const {\n      AdapterClass: RefAdapterClass,\n      getAdapterClass: getRefAdapterClass,\n    } = refAliasAdapterType\n    const REFCLASS = RefAdapterClass || (await getRefAdapterClass?.())\n    if (!REFCLASS) {\n      throw new Error('Failed to get REFCLASS')\n    }\n    const refNameAliasAdapter = new REFCLASS(\n      refNameAliasesAdapterConfig,\n    ) as BaseRefNameAliasAdapter\n    const refNameAliasesList = (await refNameAliasAdapter.getRefNameAliases({\n      signal,\n    })) as {\n      refName: string\n      aliases: string[]\n    }[]\n\n    refNameAliasesList.forEach(({ refName, aliases }) => {\n      aliases.forEach(alias => {\n        checkRefName(alias)\n        refNameAliases[alias] = refName\n      })\n    })\n  }\n\n  // add identity to the refNameAliases list\n  adapterRegionsWithAssembly.forEach(region => {\n    refNameAliases[region.refName] = region.refName\n  })\n  return { adapterRegionsWithAssembly, refNameAliases }\n}\nexport type Assembly = Instance<ReturnType<typeof assemblyFactory>>\n","import { reaction } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  IAnyType,\n  Instance,\n  types,\n} from 'mobx-state-tree'\nimport { when } from '../util'\nimport { readConfObject } from '../configuration'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\n\nimport assemblyFactory from './assembly'\nimport PluginManager from '../PluginManager'\n\nexport default function assemblyManagerFactory(\n  assemblyConfigType: IAnyType,\n  pluginManager: PluginManager,\n) {\n  const Assembly = assemblyFactory(assemblyConfigType, pluginManager)\n  return types\n    .model({\n      assemblies: types.array(Assembly),\n    })\n    .views(self => ({\n      get(assemblyName: string) {\n        return self.assemblies.find(assembly => assembly.hasName(assemblyName))\n      },\n\n      get assemblyList() {\n        // name is the explicit identifier and can be accessed without getConf,\n        // hence the union with {name:string}\n        return [\n          ...getParent(self).jbrowse.assemblies,\n          ...(getParent(self).session.sessionAssemblies || []),\n        ] as (AnyConfigurationModel & { name: string })[]\n      },\n\n      get rpcManager() {\n        return getParent(self).rpcManager\n      },\n      get pluginManager() {\n        return getParent(self).pluginManager\n      },\n      get allPossibleRefNames() {\n        let refNames: string[] = []\n        for (const assembly of self.assemblies) {\n          if (!assembly.allRefNames) {\n            return undefined\n          }\n          refNames = refNames.concat(assembly.allRefNames)\n        }\n        return refNames\n      },\n    }))\n    .views(self => ({\n      // use this method instead of assemblyManager.get(assemblyName)\n      // get an assembly with regions loaded\n      async waitForAssembly(assemblyName: string) {\n        if (!assemblyName) {\n          throw new Error('no assembly name supplied to waitForAssembly')\n        }\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          await when(() => Boolean(assembly.regions && assembly.refNameAliases))\n          return assembly\n        }\n        return undefined\n      },\n\n      async getRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        await when(() => Boolean(self.get(assemblyName)), {\n          signal: opts.signal,\n          name: 'when assembly ready',\n        })\n\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          return assembly.getRefNameMapForAdapter(adapterConf, opts)\n        }\n        return undefined\n      },\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        await when(() => Boolean(self.get(assemblyName)), {\n          signal: opts.signal,\n          name: 'when assembly ready',\n        })\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          return assembly.getReverseRefNameMapForAdapter(adapterConf, opts)\n        }\n        return undefined\n      },\n      isValidRefName(refName: string, assemblyName?: string) {\n        if (assemblyName) {\n          const assembly = self.get(assemblyName)\n          if (assembly) {\n            return assembly.isValidRefName(refName)\n          }\n          throw new Error(\n            `isValidRefName for ${assemblyName} failed, assembly does not exist`,\n          )\n        }\n        if (!self.allPossibleRefNames) {\n          throw new Error(\n            `isValidRefName not available, assemblyManager has not yet finished loading. If you are looking for a refname in a specific assembly, pass assembly argument`,\n          )\n        }\n        return self.allPossibleRefNames.includes(refName)\n      },\n    }))\n    .actions(self => ({\n      removeAssembly(asm: Instance<typeof Assembly>) {\n        self.assemblies.remove(asm)\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          reaction(\n            // have to slice it to be properly reacted to\n            () => self.assemblyList,\n            assemblyConfigs => {\n              self.assemblies.forEach(asm => {\n                if (!asm.configuration) {\n                  this.removeAssembly(asm)\n                }\n              })\n              assemblyConfigs.forEach(assemblyConfig => {\n                const existingAssemblyIdx = self.assemblies.findIndex(\n                  assembly =>\n                    assembly.name === readConfObject(assemblyConfig, 'name'),\n                )\n                if (existingAssemblyIdx === -1) {\n                  this.addAssembly(assemblyConfig)\n                }\n              })\n            },\n            { fireImmediately: true, name: 'assemblyManagerAfterAttach' },\n          ),\n        )\n      },\n\n      // this can take an active instance of an assembly, in which case it is\n      // referred to, or it can take an identifier e.g. assembly name, which is\n      // used as a reference. snapshots cannot be used\n      addAssembly(\n        assemblyConfig: Instance<typeof assemblyConfigType> | string,\n      ) {\n        self.assemblies.push({ configuration: assemblyConfig })\n      },\n\n      replaceAssembly(\n        idx: number,\n        assemblyConfig: Instance<typeof assemblyConfigType> | string,\n      ) {\n        self.assemblies[idx] = cast({\n          configuration: assemblyConfig,\n        })\n      },\n    }))\n}\n","import { SnapshotIn } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../configuration'\nimport PluginManager from '../PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  const BaseAssemblyConfigSchema = ConfigurationSchema(\n    'BaseAssembly',\n    {\n      aliases: {\n        type: 'stringArray',\n        defaultValue: [],\n        description: 'Other possible names for the assembly',\n      },\n      sequence: pluginManager.getTrackType('ReferenceSequenceTrack')\n        .configSchema,\n      refNameColors: {\n        type: 'stringArray',\n        defaultValue: [],\n        description:\n          'Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence.',\n      },\n    },\n    { explicitIdentifier: 'name' },\n  )\n\n  const AssemblyConfigSchema = ConfigurationSchema(\n    'Assembly',\n    {\n      refNameAliases: ConfigurationSchema('RefNameAliases', {\n        adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      }),\n    },\n    { baseConfiguration: BaseAssemblyConfigSchema },\n  )\n\n  function dispatcher(\n    snapshot:\n      | SnapshotIn<typeof BaseAssemblyConfigSchema>\n      | SnapshotIn<typeof AssemblyConfigSchema>,\n  ) {\n    if (!snapshot) {\n      return BaseAssemblyConfigSchema\n    }\n    const { refNameAliases } = snapshot\n    if (refNameAliases) {\n      return AssemblyConfigSchema\n    }\n    return BaseAssemblyConfigSchema\n  }\n\n  return {\n    assemblyConfigSchemas: [AssemblyConfigSchema, BaseAssemblyConfigSchema],\n    dispatcher,\n  }\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../configuration'\n\nconst MainThreadRpcDriverConfigSchema = ConfigurationSchema(\n  'MainThreadRpcDriver',\n  {},\n  { explicitlyTyped: true },\n)\nconst WebWorkerRpcDriverConfigSchema = ConfigurationSchema(\n  'WebWorkerRpcDriver',\n  {},\n  { explicitlyTyped: true },\n)\nconst ElectronRpcDriverConfigSchema = ConfigurationSchema(\n  'ElectronRpcDriver',\n  {},\n  { explicitlyTyped: true },\n)\n\nexport default ConfigurationSchema(\n  'RpcOptions',\n  {\n    defaultDriver: {\n      type: 'string',\n      description:\n        'the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend',\n      defaultValue: 'MainThreadRpcDriver',\n    },\n    drivers: types.optional(\n      types.map(\n        types.union(\n          MainThreadRpcDriverConfigSchema,\n          WebWorkerRpcDriverConfigSchema,\n          ElectronRpcDriverConfigSchema,\n        ),\n      ),\n      { MainThreadRpcDriver: { type: 'MainThreadRpcDriver' } },\n    ),\n  },\n  {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    actions: (self: any) => ({\n      addDriverConfig(configName: string, configSnapshot: { type: string }) {\n        self.drivers.set(configName, configSnapshot)\n      },\n    }),\n  },\n)\n","import { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport { objectFromEntries } from '../util'\nimport { serializeAbortSignal } from './remoteAbortSignals'\nimport PluginManager from '../PluginManager'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\n\nexport interface WorkerHandle {\n  status?: string\n  error?: Error\n  on?: (channel: string, callback: (message: string) => void) => void\n  off?: (channel: string, callback: (message: string) => void) => void\n  destroy(): void\n  call(\n    functionName: string,\n    args?: unknown,\n    options?: {\n      statusCallback?(message: string): void\n      timeout?: number\n      rpcDriverClassName: string\n    },\n  ): Promise<unknown>\n}\n\nexport interface RpcDriverConstructorArgs {\n  config: AnyConfigurationModel\n}\n\nfunction isClonable(thing: unknown): boolean {\n  if (typeof thing === 'function') {\n    return false\n  }\n  if (thing instanceof Error) {\n    return false\n  }\n  return true\n}\n\n// watches the given worker object, returns a promise that will be rejected if\n// the worker times out\nexport async function watchWorker(\n  worker: WorkerHandle,\n  pingTime: number,\n  rpcDriverClassName: string,\n) {\n  // first ping call has no timeout, wait for worker download\n  await worker.call('ping', [], { timeout: 100000000, rpcDriverClassName })\n\n  // after first ping succeeds, apply wait for timeout\n  return new Promise((_resolve, reject) => {\n    function delay() {\n      setTimeout(async () => {\n        try {\n          await worker.call('ping', [], {\n            timeout: pingTime * 2,\n            rpcDriverClassName,\n          })\n          delay()\n        } catch (e) {\n          reject(e)\n        }\n      }, pingTime)\n    }\n    delay()\n  })\n}\n\nfunction detectHardwareConcurrency() {\n  const mainThread = typeof window !== 'undefined'\n  const canDetect = mainThread && 'hardwareConcurrency' in window.navigator\n  if (mainThread && canDetect) {\n    return window.navigator.hardwareConcurrency\n  }\n  return 1\n}\nclass LazyWorker {\n  worker?: WorkerHandle\n\n  driver: BaseRpcDriver\n\n  constructor(driver: BaseRpcDriver) {\n    this.driver = driver\n  }\n\n  getWorker(pluginManager: PluginManager, rpcDriverClassName: string) {\n    if (!this.worker) {\n      const worker = this.driver.makeWorker(pluginManager)\n      watchWorker(worker, this.driver.maxPingTime, rpcDriverClassName).catch(\n        error => {\n          if (this.worker) {\n            console.warn(\n              `worker did not respond, killing and generating new one ${error}`,\n            )\n            this.worker.destroy()\n            this.worker.status = 'killed'\n            this.worker.error = error\n            this.worker = undefined\n          }\n        },\n      )\n      this.worker = worker\n    }\n    return this.worker\n  }\n}\n\nexport default abstract class BaseRpcDriver {\n  abstract name: string\n\n  private lastWorkerAssignment = -1\n\n  private workerAssignments = new Map<string, number>() // sessionId -> worker number\n\n  private workerCount = 0\n\n  abstract makeWorker(pluginManager: PluginManager): WorkerHandle\n\n  private workerPool?: LazyWorker[]\n\n  maxPingTime = 30000\n\n  workerCheckFrequency = 5000\n\n  config: AnyConfigurationModel\n\n  constructor(args: RpcDriverConstructorArgs) {\n    this.config = args.config\n  }\n\n  // filter the given object and just remove any non-clonable things from it\n  filterArgs<THING_TYPE>(\n    thing: THING_TYPE,\n    pluginManager: PluginManager,\n    sessionId: string,\n  ): THING_TYPE {\n    if (Array.isArray(thing)) {\n      return (thing\n        .filter(isClonable)\n        .map(t =>\n          this.filterArgs(t, pluginManager, sessionId),\n        ) as unknown) as THING_TYPE\n    }\n    if (typeof thing === 'object' && thing !== null) {\n      // AbortSignals are specially handled\n      if (thing instanceof AbortSignal) {\n        return (serializeAbortSignal(\n          thing,\n          this.remoteAbort.bind(this, pluginManager, sessionId),\n        ) as unknown) as THING_TYPE\n      }\n\n      if (isStateTreeNode(thing) && !isAlive(thing)) {\n        throw new Error('dead state tree node passed to RPC call')\n      }\n\n      // special case, don't try to iterate the file's subelements as the\n      // object entries below would\n      if (thing instanceof File) {\n        return thing\n      }\n\n      return objectFromEntries(\n        Object.entries(thing)\n          .filter(e => isClonable(e[1]))\n          .map(([k, v]) => [k, this.filterArgs(v, pluginManager, sessionId)]),\n      ) as THING_TYPE\n    }\n    return thing\n  }\n\n  remoteAbort(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    signalId: number,\n  ) {\n    const worker = this.getWorker(sessionId, pluginManager)\n    worker.call(\n      functionName,\n      { signalId },\n      { timeout: 1000000, rpcDriverClassName: this.name },\n    )\n  }\n\n  createWorkerPool(): LazyWorker[] {\n    const hardwareConcurrency = detectHardwareConcurrency()\n\n    const workerCount =\n      this.workerCount || Math.max(1, Math.ceil((hardwareConcurrency - 2) / 3))\n\n    return [...new Array(workerCount)].map(() => new LazyWorker(this))\n  }\n\n  getWorkerPool() {\n    if (!this.workerPool) {\n      const res = this.createWorkerPool()\n      this.workerPool = res\n      return res // making this several steps makes TS happy\n    }\n    return this.workerPool\n  }\n\n  getWorker(sessionId: string, pluginManager: PluginManager): WorkerHandle {\n    const workers = this.getWorkerPool()\n    let workerNumber = this.workerAssignments.get(sessionId)\n    if (workerNumber === undefined) {\n      const workerAssignment = (this.lastWorkerAssignment + 1) % workers.length\n      this.workerAssignments.set(sessionId, workerAssignment)\n      this.lastWorkerAssignment = workerAssignment\n      workerNumber = workerAssignment\n    }\n\n    // console.log(`${sessionId} -> worker ${workerNumber}`)\n    const worker = workers[workerNumber].getWorker(pluginManager, this.name)\n    if (!worker) {\n      throw new Error('no web workers registered for RPC')\n    }\n    return worker\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: { statusCallback?: (message: string) => void },\n    options = {},\n  ) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    const worker = this.getWorker(sessionId, pluginManager)\n    const rpcMethod = pluginManager.getRpcMethodType(functionName)\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const filteredAndSerializedArgs = this.filterArgs(\n      serializedArgs,\n      pluginManager,\n      sessionId,\n    )\n\n    // now actually call the worker\n    const callP = worker.call(functionName, filteredAndSerializedArgs, {\n      timeout: 5 * 60 * 1000, // 5 minutes\n      statusCallback: args.statusCallback,\n      rpcDriverClassName: this.name,\n      ...options,\n    })\n\n    // check every 5 seconds to see if the worker has been killed, and\n    // reject the killedP promise if it has\n    let killedCheckInterval: ReturnType<typeof setInterval>\n    const killedP = new Promise((_resolve, reject) => {\n      killedCheckInterval = setInterval(() => {\n        // must've been killed\n        if (worker.status === 'killed') {\n          reject(\n            new Error(\n              `operation timed out, worker process stopped responding, ${worker.error}`,\n            ),\n          )\n        }\n      }, this.workerCheckFrequency)\n    }).finally(() => {\n      clearInterval(killedCheckInterval)\n    })\n\n    // the result is a race between the actual result promise, and the \"killed\"\n    // promise. the killed promise will only actually win if the worker was\n    // killed before the call could return\n    const resultP = Promise.race([callP, killedP])\n\n    return rpcMethod.deserializeReturn(await resultP, args, this.name)\n  }\n}\n","import Rpc from '@librpc/web'\nimport shortid from 'shortid'\nimport BaseRpcDriver, { RpcDriverConstructorArgs } from './BaseRpcDriver'\nimport { PluginDefinition } from '../PluginLoader'\n\ninterface WebpackWorker {\n  new (): Worker\n  prototype: Worker\n}\n\ninterface WebWorkerRpcDriverConstructorArgs extends RpcDriverConstructorArgs {\n  WorkerClass: WebpackWorker\n}\n\nclass WebWorkerHandle extends Rpc.Client {\n  destroy(): void {\n    this.workers[0].terminate()\n  }\n\n  async call(\n    functionName: string,\n    args: Record<string, unknown>,\n    opts: {\n      statusCallback?: (arg0: string) => void\n      rpcDriverClassName: string\n    },\n  ) {\n    const { statusCallback, rpcDriverClassName } = opts\n    const channel = `message-${shortid.generate()}`\n    const listener = (message: string) => {\n      if (statusCallback) {\n        statusCallback(message)\n      }\n    }\n    this.on(channel, listener)\n    const result = await super.call(\n      functionName,\n      { ...args, channel, rpcDriverClassName },\n      opts,\n    )\n    this.off(channel, listener)\n    return result\n  }\n}\n\nexport default class WebWorkerRpcDriver extends BaseRpcDriver {\n  name = 'WebWorkerRpcDriver'\n\n  WorkerClass: WebpackWorker\n\n  workerBootConfiguration: { plugins: PluginDefinition[] }\n\n  constructor(\n    args: WebWorkerRpcDriverConstructorArgs,\n    workerBootConfiguration: { plugins: PluginDefinition[] },\n  ) {\n    super(args)\n    this.WorkerClass = args.WorkerClass\n    this.workerBootConfiguration = workerBootConfiguration\n  }\n\n  makeWorker() {\n    // note that we are making a Rpc.Client connection with a worker pool of one for each worker,\n    // because we want to do our own state-group-aware load balancing rather than using librpc's\n    // builtin round-robin\n    const worker = new WebWorkerHandle({ workers: [new this.WorkerClass()] })\n    // send the worker its boot configuration using info from the pluginManager\n    worker.workers[0].postMessage(this.workerBootConfiguration)\n    return worker\n  }\n}\n","import BaseRpcDriver, { RpcDriverConstructorArgs } from './BaseRpcDriver'\nimport PluginManager from '../PluginManager'\n\nclass DummyHandle {\n  destroy(): void {}\n\n  async call(\n    _functionName: string,\n    _filteredArgs?: {},\n    _options = {},\n  ): Promise<unknown> {\n    return undefined\n  }\n}\n\n/**\n * Stub RPC driver class that runs RPC functions in-band in the main thread.\n *\n * @param rpcFuncs - object containing runnable rpc functions\n */\nexport default class MainThreadRpcDriver extends BaseRpcDriver {\n  name = 'MainThreadRpcDriver'\n\n  makeWorker: () => DummyHandle\n\n  constructor(args: RpcDriverConstructorArgs) {\n    super(args)\n    this.makeWorker = (): DummyHandle => new DummyHandle()\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: {},\n  ): Promise<unknown> {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    const rpcMethod = pluginManager.getRpcMethodType(functionName)\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const result = await rpcMethod.execute(serializedArgs, this.name)\n    return rpcMethod.deserializeReturn(result, args, this.name)\n  }\n}\n","import shortid from 'shortid'\nimport BaseRpcDriver, { RpcDriverConstructorArgs } from './BaseRpcDriver'\nimport PluginManager from '../PluginManager'\nimport { PluginDefinition } from '../PluginLoader'\n\ndeclare global {\n  interface Window {\n    electronBetterIpc: {\n      ipcRenderer?: import('electron-better-ipc-extra').RendererProcessIpc\n    }\n    electron?: import('electron').AllElectron\n  }\n}\nconst { electronBetterIpc = {}, electron } =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  typeof window !== 'undefined' ? window : ({} as any)\n\ninterface ElectronRpcDriverConstructorArgs extends RpcDriverConstructorArgs {\n  workerCreationChannel: string\n}\n\nasync function wait(ms: number) {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms)\n  })\n}\n\ntype WorkerBootConfig = { plugins: PluginDefinition[] }\n\nclass WindowWorkerHandle {\n  private ipcRenderer: import('electron-better-ipc-extra').RendererProcessIpc\n\n  private window: import('electron').BrowserWindow\n\n  private config: WorkerBootConfig\n\n  private ready = false\n\n  constructor(\n    ipcRenderer: import('electron-better-ipc-extra').RendererProcessIpc,\n    window: import('electron').BrowserWindow,\n    config: WorkerBootConfig,\n  ) {\n    this.ipcRenderer = ipcRenderer\n    this.window = window\n    this.config = config\n  }\n\n  destroy(): void {\n    this.window.destroy()\n  }\n\n  // waits for a new worker to start, and then sends it its bootstrap configuration\n  async setup() {\n    if (!this.ready) {\n      let readyForConfig = false\n      while (!readyForConfig) {\n        await wait(1000)\n        readyForConfig = !!(await this.ipcRenderer.callRenderer(\n          this.window,\n          'ready_for_configuration',\n        ))\n      }\n\n      const result = await this.ipcRenderer.callRenderer(\n        this.window,\n        'configure',\n        this.config,\n      )\n      if (!result) {\n        throw new Error('failed to configure worker')\n      }\n      this.ready = true\n    }\n  }\n\n  async call(\n    functionName: string,\n    filteredArgs?: Record<string, unknown>,\n    opts: { statusCallback?: (arg0: string) => void } = {},\n  ): Promise<unknown> {\n    await this.setup()\n\n    const { statusCallback, ...rest } = opts\n    const channel = `message-${shortid.generate()}`\n    const listener = (_event: unknown, message: string) => {\n      if (opts.statusCallback) {\n        opts.statusCallback(message)\n      }\n    }\n    this.ipcRenderer.on(channel, listener)\n    const result = await this.ipcRenderer.callRenderer(\n      this.window,\n      'call',\n      functionName,\n      { ...filteredArgs, channel },\n      rest,\n    )\n    this.ipcRenderer.removeListener(channel, listener)\n    return result\n  }\n}\n\nexport default class ElectronRpcDriver extends BaseRpcDriver {\n  name = 'ElectronRpcDriver'\n\n  bootConfig: WorkerBootConfig\n\n  channel: string\n\n  constructor(\n    args: ElectronRpcDriverConstructorArgs,\n    bootConfig: WorkerBootConfig,\n  ) {\n    super(args)\n    const { workerCreationChannel } = args\n\n    this.bootConfig = bootConfig\n    this.channel = workerCreationChannel\n  }\n\n  makeWorker(): WindowWorkerHandle {\n    const { ipcRenderer } = electronBetterIpc\n    if (!ipcRenderer) {\n      throw new Error(\n        'Cannot use ElectronRpcDriver without ipcRenderer from electron-better-ipc-extra',\n      )\n    }\n    if (!electron) {\n      throw new Error(\n        'Cannot use ElectronRpcDriver without electron available globally',\n      )\n    }\n    const electronRemote = electron.remote\n    const workerId = ipcRenderer.sendSync(this.channel)\n    const window = electronRemote.BrowserWindow.fromId(workerId)\n    const worker = new WindowWorkerHandle(ipcRenderer, window, this.bootConfig)\n    return worker\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: {},\n    options = {},\n  ): Promise<unknown> {\n    const r = await super.call(\n      pluginManager,\n      sessionId,\n      functionName,\n      args,\n      options,\n    )\n\n    if (typeof r === 'object' && r !== null && 'imageData' in r) {\n      const img = new Image()\n      // @ts-ignore\n      img.src = r.imageData.dataURL\n      // @ts-ignore\n      r.imageData = img\n    }\n    return r\n  }\n}\n","import PluginManager from '../PluginManager'\nimport { readConfObject } from '../configuration'\n\nimport rpcConfigSchema from './configSchema'\nimport WebWorkerRpcDriver from './WebWorkerRpcDriver'\nimport MainThreadRpcDriver from './MainThreadRpcDriver'\nimport ElectronRpcDriver from './ElectronRpcDriver'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\nimport { PluginDefinition } from '../PluginLoader'\n\ntype DriverClass = WebWorkerRpcDriver | MainThreadRpcDriver | ElectronRpcDriver\ntype BackendConfigurations = {\n  WebWorkerRpcDriver?: Omit<\n    ConstructorParameters<typeof WebWorkerRpcDriver>[0],\n    'config'\n  >\n  MainThreadRpcDriver?: Omit<\n    ConstructorParameters<typeof MainThreadRpcDriver>[0],\n    'config'\n  >\n  ElectronRpcDriver?: Omit<\n    ConstructorParameters<typeof ElectronRpcDriver>[0],\n    'config'\n  >\n}\nconst DriverClasses = {\n  WebWorkerRpcDriver,\n  MainThreadRpcDriver,\n  ElectronRpcDriver,\n}\n\nexport default class RpcManager {\n  static configSchema = rpcConfigSchema\n\n  driverObjects: Map<string, DriverClass>\n\n  pluginManager: PluginManager\n\n  mainConfiguration: AnyConfigurationModel\n\n  backendConfigurations: BackendConfigurations\n\n  constructor(\n    pluginManager: PluginManager,\n    mainConfiguration: AnyConfigurationModel,\n    backendConfigurations: BackendConfigurations,\n  ) {\n    if (!mainConfiguration) {\n      throw new Error('RpcManager requires at least a main configuration')\n    }\n    this.pluginManager = pluginManager\n    this.mainConfiguration = mainConfiguration\n    this.backendConfigurations = backendConfigurations\n    this.driverObjects = new Map()\n  }\n\n  getDriver(backendName: keyof typeof DriverClasses): DriverClass {\n    const driver = this.driverObjects.get(backendName)\n    if (driver) {\n      return driver\n    }\n\n    const backendConfiguration = this.backendConfigurations[backendName]\n    const DriverClassImpl = DriverClasses[backendName]\n\n    if (!DriverClassImpl) {\n      throw new Error(`requested RPC driver \"${backendName}\" is not installed`)\n    } else if (!backendConfiguration) {\n      throw new Error(`requested RPC driver \"${backendName}\" is missing config`)\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const newDriver = new DriverClassImpl(backendConfiguration as any, {\n      plugins: this.pluginManager.runtimePluginDefinitions,\n    })\n    this.driverObjects.set(backendName, newDriver)\n    return newDriver\n  }\n\n  getDriverForCall(\n    _sessionId: string,\n    _functionName: string,\n    args: { rpcDriverName?: string },\n  ) {\n    const backendName =\n      args.rpcDriverName ||\n      readConfObject(this.mainConfiguration, 'defaultDriver')\n\n    return this.getDriver(backendName)\n  }\n\n  async call(sessionId: string, functionName: string, args: {}, opts = {}) {\n    // console.log(sessionId, functionName)\n    if (!sessionId) {\n      throw new Error('sessionId is required')\n    }\n    return this.getDriverForCall(sessionId, functionName, args).call(\n      this.pluginManager,\n      sessionId,\n      functionName,\n      args,\n      opts,\n    )\n  }\n}\n","import {\n  ConfigurationSchema,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport {\n  getParent,\n  getRoot,\n  getSnapshot,\n  resolveIdentifier,\n  types,\n} from 'mobx-state-tree'\nimport { toJS } from 'mobx'\n\n// poke some things for testing (this stuff will eventually be removed)\nwindow.getSnapshot = getSnapshot\nwindow.resolveIdentifier = resolveIdentifier\n\nexport default function JBrowseWeb(\n  pluginManager,\n  Session,\n  assemblyConfigSchemasType,\n) {\n  const JBrowseModel = types\n    .model('JBrowseWeb', {\n      configuration: ConfigurationSchema('Root', {\n        rpc: RpcManager.configSchema,\n        // possibly consider this for global config editor\n        highResolutionScaling: {\n          type: 'number',\n          defaultValue: 2,\n        },\n        shareURL: {\n          type: 'string',\n          defaultValue: 'https://share.jbrowse.org/api/v1/',\n        },\n        featureDetails: ConfigurationSchema('FeatureDetails', {\n          sequenceTypes: {\n            type: 'stringArray',\n            defaultValue: ['mRNA', 'transcript'],\n          },\n        }),\n        disableAnalytics: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n        theme: { type: 'frozen', defaultValue: {} },\n        ...pluginManager.pluginConfigurationSchemas(),\n      }),\n      plugins: types.array(types.frozen()),\n      assemblies: types.array(assemblyConfigSchemasType),\n      // track configuration is an array of track config schemas. multiple\n      // instances of a track can exist that use the same configuration\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n      connections: types.array(\n        pluginManager.pluggableConfigSchemaType('connection'),\n      ),\n      defaultSession: types.optional(types.frozen(Session), {\n        name: `New session`,\n      }),\n    })\n    .actions(self => ({\n      afterCreate() {\n        const seen = []\n        self.assemblyNames.forEach(assemblyName => {\n          if (!assemblyName) {\n            throw new Error('Encountered an assembly with no \"name\" defined')\n          }\n          if (seen.includes(assemblyName)) {\n            throw new Error(\n              `Found two assemblies with the same name: ${assemblyName}`,\n            )\n          } else {\n            seen.push(assemblyName)\n          }\n        })\n      },\n      addAssemblyConf(assemblyConf) {\n        const { name } = assemblyConf\n        if (!name) {\n          throw new Error('Can\\'t add assembly with no \"name\"')\n        }\n        const assembly = self.assemblies.find(asm => asm.name === name)\n        if (assembly) {\n          return assembly\n        }\n        const length = self.assemblies.push({\n          ...assemblyConf,\n          sequence: {\n            type: 'ReferenceSequenceTrack',\n            trackId: `${name}-${Date.now()}`,\n            ...(assemblyConf.sequence || {}),\n          },\n        })\n        return self.assemblies[length - 1]\n      },\n      removeAssemblyConf(assemblyName) {\n        const toRemove = self.assemblies.find(\n          assembly => assembly.name === assemblyName,\n        )\n        if (toRemove) {\n          self.assemblies.remove(toRemove)\n        }\n      },\n      addTrackConf(trackConf) {\n        const { type } = trackConf\n        if (!type) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const track = self.tracks.find(t => t.trackId === trackConf.trackId)\n        if (track) {\n          return track\n        }\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      addDisplayConf(trackId, displayConf) {\n        const { type } = displayConf\n        if (!type) {\n          throw new Error(`unknown display type ${type}`)\n        }\n        const track = self.tracks.find(t => t.trackId === trackId)\n        if (!track) {\n          throw new Error(`could not find track with id ${trackId}`)\n        }\n        return track.addDisplayConf(displayConf)\n      },\n      addConnectionConf(connectionConf) {\n        const { type } = connectionConf\n        if (!type) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connections.push(connectionConf)\n        return self.connections[length - 1]\n      },\n\n      deleteConnectionConf(configuration) {\n        const idx = self.connections.findIndex(\n          conn => conn.id === configuration.id,\n        )\n        if (idx === -1) {\n          return undefined\n        }\n        return self.connections.splice(idx, 1)\n      },\n\n      deleteTrackConf(trackConf) {\n        const { trackId } = trackConf\n        const idx = self.tracks.findIndex(t => t.trackId === trackId)\n        if (idx === -1) {\n          return undefined\n        }\n\n        return self.tracks.splice(idx, 1)\n      },\n      setDefaultSessionConf(sessionConf) {\n        let newDefault\n        if (getParent(self).session.name === sessionConf.name) {\n          newDefault = getSnapshot(sessionConf)\n        } else {\n          newDefault = toJS(sessionConf)\n        }\n        const { name } = newDefault\n        if (!name) {\n          throw new Error(`unable to set default session to ${name}`)\n        }\n        self.defaultSession = newDefault\n      },\n      addPlugin(plugin) {\n        self.plugins = [...self.plugins, plugin]\n        const rootModel = getRoot(self)\n        rootModel.setPluginsUpdated(true)\n      },\n      removePlugin(pluginName) {\n        self.plugins = self.plugins.filter(\n          plugin => `${plugin.name}Plugin` !== pluginName,\n        )\n        const rootModel = getRoot(self)\n        rootModel.setPluginsUpdated(true)\n      },\n    }))\n    .views(self => ({\n      get assemblyNames() {\n        return self.assemblies.map(assembly => readConfObject(assembly, 'name'))\n      },\n      get rpcManager() {\n        return getParent(self).rpcManager\n      },\n    }))\n\n  return types.snapshotProcessor(JBrowseModel, {\n    postProcessor(snapshot) {\n      function removeAttr(obj, attr) {\n        for (const prop in obj) {\n          if (prop === attr) {\n            delete obj[prop]\n          } else if (typeof obj[prop] === 'object') {\n            removeAttr(obj[prop])\n          }\n        }\n      }\n      removeAttr(snapshot, 'baseUri')\n      return snapshot\n    },\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { lazy } from 'react'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport {\n  readConfObject,\n  getConf,\n  isConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport {\n  Region,\n  NotificationLevel,\n  AbstractSessionModel,\n  TrackViewModel,\n  JBrowsePlugin,\n  DialogComponentType,\n} from '@jbrowse/core/util/types'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observable } from 'mobx'\nimport {\n  getMembers,\n  getParent,\n  getRoot,\n  getSnapshot,\n  getType,\n  IAnyStateTreeNode,\n  isAlive,\n  isModelType,\n  isReferenceType,\n  SnapshotIn,\n  types,\n  walk,\n  Instance,\n} from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport CopyIcon from '@material-ui/icons/FileCopy'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport InfoIcon from '@material-ui/icons/Info'\nimport shortid from 'shortid'\n\nconst AboutDialog = lazy(() => import('@jbrowse/core/ui/AboutDialog'))\n\ndeclare interface ReferringNode {\n  node: IAnyStateTreeNode\n  key: string\n}\n\nexport default function sessionModelFactory(\n  pluginManager: PluginManager,\n  assemblyConfigSchemasType = types.frozen(), // if not using sessionAssemblies\n) {\n  const minDrawerWidth = 128\n  const sessionModel = types\n    .model('JBrowseWebSessionModel', {\n      id: types.optional(types.identifier, shortid()),\n      name: types.string,\n      margin: 0,\n      drawerWidth: types.optional(\n        types.refinement(types.integer, width => width >= minDrawerWidth),\n        384,\n      ),\n      views: types.array(pluginManager.pluggableMstType('view', 'stateModel')),\n      widgets: types.map(\n        pluginManager.pluggableMstType('widget', 'stateModel'),\n      ),\n      activeWidgets: types.map(\n        types.safeReference(\n          pluginManager.pluggableMstType('widget', 'stateModel'),\n        ),\n      ),\n      connectionInstances: types.array(\n        pluginManager.pluggableMstType('connection', 'stateModel'),\n      ),\n      sessionTracks: types.array(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n      sessionConnections: types.array(\n        pluginManager.pluggableConfigSchemaType('connection'),\n      ),\n      sessionAssemblies: types.array(assemblyConfigSchemasType),\n      sessionPlugins: types.array(types.frozen()),\n      minimized: types.optional(types.boolean, false),\n    })\n    .volatile((/* self */) => ({\n      /**\n       * this is the globally \"selected\" object. can be anything.\n       * code that wants to deal with this should examine it to see what\n       * kind of thing it is.\n       */\n      selection: undefined,\n      /**\n       * this is the current \"task\" that is being performed in the UI.\n       * this is usually an object of the form\n       * `{ taskName: \"configure\", target: thing_being_configured }`\n       */\n      task: undefined,\n\n      DialogComponent: undefined as DialogComponentType | undefined,\n      DialogProps: undefined as any,\n    }))\n    .views(self => ({\n      get shareURL() {\n        return getConf(getParent(self).jbrowse, 'shareURL')\n      },\n      get rpcManager() {\n        return getParent(self).jbrowse.rpcManager as RpcManager\n      },\n      get configuration() {\n        return getParent(self).jbrowse.configuration\n      },\n      get assemblies() {\n        return getParent(self).jbrowse.assemblies\n      },\n      get assemblyNames() {\n        return getParent(self).jbrowse.assemblyNames\n      },\n      get tracks() {\n        return [...self.sessionTracks, ...getParent(self).jbrowse.tracks]\n      },\n      get connections() {\n        return [\n          ...self.sessionConnections,\n          ...getParent(self).jbrowse.connections,\n        ]\n      },\n      get adminMode() {\n        return getParent(self).adminMode\n      },\n      get savedSessions() {\n        return getParent(self).savedSessions\n      },\n      get previousAutosaveId() {\n        return getParent(self).previousAutosaveId\n      },\n      get savedSessionNames() {\n        return getParent(self).savedSessionNames\n      },\n      get history() {\n        return getParent(self).history\n      },\n      get menus() {\n        return getParent(self).menus\n      },\n      get assemblyManager() {\n        return getParent(self).assemblyManager\n      },\n      get version() {\n        return getParent(self).version\n      },\n      get renderProps() {\n        return { theme: readConfObject(this.configuration, 'theme') }\n      },\n      get visibleWidget() {\n        if (isAlive(self)) {\n          // returns most recently added item in active widgets\n          return Array.from(self.activeWidgets.values())[\n            self.activeWidgets.size - 1\n          ]\n        }\n        return undefined\n      },\n      /**\n       * See if any MST nodes currently have a types.reference to this object.\n       * @param object - object\n       * @returns An array where the first element is the node referring\n       * to the object and the second element is they property name the node is\n       * using to refer to the object\n       */\n      getReferring(object: IAnyStateTreeNode) {\n        const refs: ReferringNode[] = []\n        walk(getParent(self), node => {\n          if (isModelType(getType(node))) {\n            const members = getMembers(node)\n            Object.entries(members.properties).forEach(([key, value]) => {\n              // @ts-ignore\n              if (isReferenceType(value) && node[key] === object) {\n                refs.push({ node, key })\n              }\n            })\n          }\n        })\n        return refs\n      },\n    }))\n    .actions(self => ({\n      setDialogComponent(comp?: DialogComponentType, props?: any) {\n        self.DialogComponent = comp\n        self.DialogProps = props\n      },\n      setName(str: string) {\n        self.name = str\n      },\n\n      addAssembly(assemblyConfig: AnyConfigurationModel) {\n        self.sessionAssemblies.push(assemblyConfig)\n      },\n      addSessionPlugin(plugin: JBrowsePlugin) {\n        if (self.sessionPlugins.find(p => p.name === plugin.name)) {\n          throw new Error('session plugin cannot be installed twice')\n        }\n        self.sessionPlugins.push(plugin)\n        const rootModel = getRoot(self)\n        rootModel.setPluginsUpdated(true)\n      },\n      removeAssembly(assemblyName: string) {\n        const index = self.sessionAssemblies.findIndex(\n          asm => asm.name === assemblyName,\n        )\n        if (index !== -1) {\n          self.sessionAssemblies.splice(index, 1)\n        }\n      },\n      removeSessionPlugin(pluginName: string) {\n        const index = self.sessionPlugins.findIndex(\n          plugin => `${plugin.name}Plugin` === pluginName,\n        )\n        if (index !== -1) {\n          self.sessionPlugins.splice(index, 1)\n        }\n        const rootModel = getRoot(self)\n        rootModel.setPluginsUpdated(true)\n      },\n      makeConnection(\n        configuration: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const { type } = configuration\n        if (!type) {\n          throw new Error('track configuration has no `type` listed')\n        }\n        const name = readConfObject(configuration, 'name')\n        const connectionType = pluginManager.getConnectionType(type)\n        if (!connectionType) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const connectionData = {\n          ...initialSnapshot,\n          name,\n          type,\n          configuration,\n        }\n        const length = self.connectionInstances.push(connectionData)\n        return self.connectionInstances[length - 1]\n      },\n\n      removeReferring(\n        referring: any,\n        track: any,\n        callbacks: Function[],\n        dereferenceTypeCount: Record<string, number>,\n      ) {\n        referring.forEach(({ node }: ReferringNode) => {\n          let dereferenced = false\n          try {\n            // If a view is referring to the track config, remove the track\n            // from the view\n            const type = 'open track(s)'\n            const view = getContainingView(node) as TrackViewModel\n            callbacks.push(() => view.hideTrack(track.trackId))\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          } catch (err1) {\n            // ignore\n          }\n\n          // @ts-ignore\n          if (self.widgets.has(node.id)) {\n            // If a configuration editor widget has the track config\n            // open, close the widget\n            const type = 'configuration editor widget(s)'\n            callbacks.push(() => this.hideWidget(node))\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          }\n          if (!dereferenced) {\n            throw new Error(\n              `Error when closing this connection, the following node is still referring to a track configuration: ${JSON.stringify(\n                getSnapshot(node),\n              )}`,\n            )\n          }\n        })\n      },\n\n      prepareToBreakConnection(configuration: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: Function[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (connection) {\n          connection.tracks.forEach((track: any) => {\n            const referring = self.getReferring(track)\n            this.removeReferring(\n              referring,\n              track,\n              callbacksToDereferenceTrack,\n              dereferenceTypeCount,\n            )\n          })\n          const safelyBreakConnection = () => {\n            callbacksToDereferenceTrack.forEach(cb => cb())\n            this.breakConnection(configuration)\n          }\n          return [safelyBreakConnection, dereferenceTypeCount]\n        }\n        return undefined\n      },\n\n      breakConnection(configuration: AnyConfigurationModel) {\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        self.connectionInstances.remove(connection)\n      },\n\n      deleteConnection(configuration: AnyConfigurationModel) {\n        let deletedConn\n        if (self.adminMode) {\n          deletedConn = getParent(self).jbrowse.deleteConnectionConf(\n            configuration,\n          )\n        }\n        if (!deletedConn) {\n          const { connectionId } = configuration\n          const idx = self.sessionConnections.findIndex(\n            c => c.connectionId === connectionId,\n          )\n          if (idx === -1) {\n            return undefined\n          }\n          return self.sessionConnections.splice(idx, 1)\n        }\n        return deletedConn\n      },\n\n      updateDrawerWidth(drawerWidth: number) {\n        if (drawerWidth === self.drawerWidth) {\n          return self.drawerWidth\n        }\n        let newDrawerWidth = drawerWidth\n        if (newDrawerWidth < minDrawerWidth) {\n          newDrawerWidth = minDrawerWidth\n        }\n        self.drawerWidth = newDrawerWidth\n        return newDrawerWidth\n      },\n\n      resizeDrawer(distance: number) {\n        const oldDrawerWidth = self.drawerWidth\n        const newDrawerWidth = this.updateDrawerWidth(oldDrawerWidth - distance)\n        const actualDistance = oldDrawerWidth - newDrawerWidth\n        return actualDistance\n      },\n\n      addView(typeName: string, initialState = {}) {\n        const typeDefinition = pluginManager.getElementType('view', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown view type ${typeName}`)\n        }\n\n        const length = self.views.push({\n          ...initialState,\n          type: typeName,\n        })\n        return self.views[length - 1]\n      },\n\n      removeView(view: any) {\n        for (const [, widget] of self.activeWidgets) {\n          if (widget.view && widget.view.id === view.id) {\n            this.hideWidget(widget)\n          }\n        }\n        self.views.remove(view)\n      },\n\n      addAssemblyConf(assemblyConf: AnyConfigurationModel) {\n        return getParent(self).jbrowse.addAssemblyConf(assemblyConf)\n      },\n\n      addTrackConf(trackConf: AnyConfigurationModel) {\n        if (self.adminMode) {\n          return getParent(self).jbrowse.addTrackConf(trackConf)\n        }\n        const { trackId, type } = trackConf\n        if (!type) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const track = self.sessionTracks.find((t: any) => t.trackId === trackId)\n        if (track) {\n          return track\n        }\n        const length = self.sessionTracks.push(trackConf)\n        return self.sessionTracks[length - 1]\n      },\n\n      deleteTrackConf(trackConf: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: Function[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const referring = self.getReferring(trackConf)\n        this.removeReferring(\n          referring,\n          trackConf,\n          callbacksToDereferenceTrack,\n          dereferenceTypeCount,\n        )\n        callbacksToDereferenceTrack.forEach(cb => cb())\n        if (self.adminMode) {\n          return getParent(self).jbrowse.deleteTrackConf(trackConf)\n        }\n        const { trackId } = trackConf\n        const idx = self.sessionTracks.findIndex(t => t.trackId === trackId)\n        if (idx === -1) {\n          return undefined\n        }\n        return self.sessionTracks.splice(idx, 1)\n      },\n\n      addConnectionConf(connectionConf: any) {\n        if (self.adminMode) {\n          return getParent(self).jbrowse.addConnectionConf(connectionConf)\n        }\n        const { connectionId, type } = connectionConf\n        if (!type) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const connection = self.sessionTracks.find(\n          (c: any) => c.connectionId === connectionId,\n        )\n        if (connection) {\n          return connection\n        }\n        const length = self.sessionConnections.push(connectionConf)\n        return self.sessionConnections[length - 1]\n      },\n\n      addLinearGenomeViewOfAssembly(assemblyName: string, initialState = {}) {\n        return this.addViewOfAssembly(\n          'LinearGenomeView',\n          assemblyName,\n          initialState,\n        )\n      },\n\n      addViewOfAssembly(\n        viewType: any,\n        assemblyName: string,\n        initialState: any = {},\n      ) {\n        const assembly = self.assemblies.find(\n          (s: AnyConfigurationModel) =>\n            readConfObject(s, 'name') === assemblyName,\n        )\n        if (!assembly) {\n          throw new Error(\n            `Could not add view of assembly \"${assemblyName}\", assembly name not found`,\n          )\n        }\n        initialState.displayRegionsFromAssemblyName = readConfObject(\n          assembly,\n          'name',\n        )\n        return this.addView(viewType, initialState)\n      },\n\n      addViewFromAnotherView(\n        viewType: string,\n        otherView: any,\n        initialState: { displayedRegions?: Region[] } = {},\n      ) {\n        const state = { ...initialState }\n        state.displayedRegions = getSnapshot(otherView.displayedRegions)\n        return this.addView(viewType, state)\n      },\n\n      addWidget(\n        typeName: string,\n        id: string,\n        initialState = {},\n        configuration = { type: typeName },\n      ) {\n        const typeDefinition = pluginManager.getElementType('widget', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown widget type ${typeName}`)\n        }\n        const data = {\n          ...initialState,\n          id,\n          type: typeName,\n          configuration,\n        }\n        self.widgets.set(id, data)\n        return self.widgets.get(id)\n      },\n\n      showWidget(widget: any) {\n        if (self.activeWidgets.has(widget.id)) {\n          self.activeWidgets.delete(widget.id)\n        }\n        self.activeWidgets.set(widget.id, widget)\n        self.minimized = false\n      },\n\n      hasWidget(widget: any) {\n        return self.activeWidgets.has(widget.id)\n      },\n\n      hideWidget(widget: any) {\n        self.activeWidgets.delete(widget.id)\n      },\n      minimizeWidgetDrawer() {\n        self.minimized = true\n      },\n      showWidgetDrawer() {\n        self.minimized = false\n      },\n      hideAllWidgets() {\n        self.activeWidgets.clear()\n      },\n\n      /**\n       * set the global selection, i.e. the globally-selected object.\n       * can be a feature, a view, just about anything\n       * @param thing -\n       */\n      setSelection(thing: any) {\n        self.selection = thing\n      },\n\n      /**\n       * clears the global selection\n       */\n      clearSelection() {\n        self.selection = undefined\n      },\n\n      clearConnections() {\n        self.connectionInstances.length = 0\n      },\n\n      addSavedSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return getParent(self).addSavedSession(sessionSnapshot)\n      },\n\n      removeSavedSession(sessionSnapshot: any) {\n        return getParent(self).removeSavedSession(sessionSnapshot)\n      },\n\n      renameCurrentSession(sessionName: string) {\n        return getParent(self).renameCurrentSession(sessionName)\n      },\n\n      duplicateCurrentSession() {\n        return getParent(self).duplicateCurrentSession()\n      },\n      activateSession(sessionName: any) {\n        return getParent(self).activateSession(sessionName)\n      },\n      setDefaultSession() {\n        return getParent(self).setDefaultSession()\n      },\n      saveSessionToLocalStorage() {\n        return getParent(self).saveSessionToLocalStorage()\n      },\n      loadAutosaveSession() {\n        return getParent(self).loadAutosaveSession()\n      },\n      setSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return getParent(self).setSession(sessionSnapshot)\n      },\n    }))\n    .extend(() => {\n      const snackbarMessages = observable.array()\n\n      return {\n        views: {\n          get snackbarMessages() {\n            return snackbarMessages\n          },\n        },\n        actions: {\n          notify(message: string, level?: NotificationLevel) {\n            return this.pushSnackbarMessage(message, level)\n          },\n\n          pushSnackbarMessage(message: string, level?: NotificationLevel) {\n            return snackbarMessages.push([message, level])\n          },\n\n          popSnackbarMessage() {\n            return snackbarMessages.pop()\n          },\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * opens a configuration editor to configure the given thing,\n       * and sets the current task to be configuring it\n       * @param configuration -\n       */\n      editConfiguration(configuration: AnyConfigurationModel) {\n        if (!isConfigurationModel(configuration)) {\n          throw new Error(\n            'must pass a configuration model to editConfiguration',\n          )\n        }\n        const editableConfigSession = self\n        const editor = editableConfigSession.addWidget(\n          'ConfigurationEditorWidget',\n          'configEditor',\n          { target: configuration },\n        )\n        editableConfigSession.showWidget(editor)\n      },\n      editTrackConfiguration(configuration: AnyConfigurationModel) {\n        if (\n          !self.adminMode &&\n          self.sessionTracks.indexOf(configuration) === -1\n        ) {\n          throw new Error(\"Can't edit the configuration of a non-session track\")\n        }\n        this.editConfiguration(configuration)\n      },\n    }))\n    .views(self => ({\n      getTrackActionMenuItems(config: any) {\n        const session = self\n        const canEdit =\n          session.adminMode ||\n          session.sessionTracks.find(track => {\n            return track.trackId === config.trackId\n          })\n\n        // disable if it is a reference sequence track\n        const isRefSeqTrack =\n          readConfObject(config, 'type') === 'ReferenceSequenceTrack'\n        return [\n          {\n            label: 'About track',\n            onClick: () => {\n              session.setDialogComponent(AboutDialog, { config })\n            },\n            icon: InfoIcon,\n          },\n          {\n            label: 'Settings',\n            disabled: !canEdit,\n            onClick: () => {\n              session.editTrackConfiguration(config)\n            },\n            icon: SettingsIcon,\n          },\n          {\n            label: 'Delete track',\n            disabled: !canEdit || isRefSeqTrack,\n            onClick: () => {\n              session.deleteTrackConf(config)\n            },\n            icon: DeleteIcon,\n          },\n          {\n            label: 'Copy track',\n            disabled: isRefSeqTrack,\n            onClick: () => {\n              const trackSnapshot = JSON.parse(\n                JSON.stringify(getSnapshot(config)),\n              )\n              const now = Date.now()\n              trackSnapshot.trackId += `-${now}`\n              trackSnapshot.displays.forEach(\n                (display: { displayId: string }) => {\n                  display.displayId += `-${now}`\n                },\n              )\n              // the -sessionTrack suffix to trackId is used as metadata for\n              // the track selector to store the track in a special category,\n              // and default category is also cleared\n              if (!session.adminMode) {\n                trackSnapshot.trackId += '-sessionTrack'\n                trackSnapshot.category = undefined\n              }\n              trackSnapshot.name += ' (copy)'\n              session.addTrackConf(trackSnapshot)\n            },\n            icon: CopyIcon,\n          },\n        ]\n      },\n    }))\n\n  return types.snapshotProcessor(sessionModel, {\n    // @ts-ignore\n    preProcessor(snapshot) {\n      if (snapshot) {\n        // @ts-ignore\n        const { connectionInstances, ...rest } = snapshot || {}\n        // connectionInstances schema changed from object to an array, so any\n        // old connectionInstances as object is in snapshot, filter it out\n        // https://github.com/GMOD/jbrowse-components/issues/1903\n        if (!Array.isArray(connectionInstances)) {\n          return rest\n        }\n      }\n      return snapshot\n    },\n  })\n}\n\nexport type SessionStateModel = ReturnType<typeof sessionModelFactory>\nexport type SessionModel = Instance<SessionStateModel>\n\nfunction z(x: Instance<SessionStateModel>): AbstractSessionModel {\n  // this function's sole purpose is to get typescript to check\n  // that the session model implements all of AbstractSessionModel\n  return x\n}\n","import assemblyManagerFactory, {\n  assemblyConfigSchemas as AssemblyConfigSchemasFactory,\n} from '@jbrowse/core/assemblyManager'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport AddIcon from '@material-ui/icons/Add'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport AppsIcon from '@material-ui/icons/Apps'\nimport {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getParent,\n  SnapshotIn,\n  types,\n  IAnyStateTreeNode,\n  Instance,\n  getType,\n  isArrayType,\n  isModelType,\n  isReferenceType,\n  isValidReference,\n  getPropertyMembers,\n  isMapType,\n  getChildType,\n  IAnyType,\n} from 'mobx-state-tree'\nimport { observable, autorun } from 'mobx'\nimport corePlugins from './corePlugins'\nimport jbrowseWebFactory from './jbrowseModel'\n// @ts-ignore\nimport RenderWorker from './rpc.worker'\nimport sessionModelFactory from './sessionModelFactory'\n\n// attempts to remove undefined references from the given MST model. can only actually\n// remove them from arrays and maps. throws MST undefined ref error if it encounters\n// undefined refs in model properties\nfunction filterSessionInPlace(node: IAnyStateTreeNode, nodeType: IAnyType) {\n  type MSTArray = Instance<ReturnType<typeof types.array>>\n  type MSTMap = Instance<ReturnType<typeof types.map>>\n\n  // makes it work with session sharing\n  if (node === undefined) {\n    return\n  }\n  if (isArrayType(nodeType)) {\n    const array = node as MSTArray\n    const childType = getChildType(node)\n    if (isReferenceType(childType)) {\n      // filter array elements\n      for (let i = 0; i < array.length; ) {\n        if (!isValidReference(() => array[i])) {\n          array.splice(i, 1)\n        } else {\n          i += 1\n        }\n      }\n    }\n    array.forEach(el => {\n      filterSessionInPlace(el, childType)\n    })\n  } else if (isMapType(nodeType)) {\n    const map = node as MSTMap\n    const childType = getChildType(map)\n    if (isReferenceType(childType)) {\n      // filter the map members\n      for (const key in map.keys()) {\n        if (!isValidReference(() => map.get(key))) {\n          map.delete(key)\n        }\n      }\n    }\n    map.forEach(child => {\n      filterSessionInPlace(child, childType)\n    })\n  } else if (isModelType(nodeType)) {\n    // iterate over children\n    const { properties } = getPropertyMembers(node)\n\n    Object.entries(properties).forEach(([pname, ptype]) => {\n      // @ts-ignore\n      filterSessionInPlace(node[pname], ptype)\n    })\n  }\n}\n\ninterface Menu {\n  label: string\n  menuItems: MenuItem[]\n}\n\nexport default function RootModel(\n  pluginManager: PluginManager,\n  adminMode = false,\n) {\n  const { assemblyConfigSchemas, dispatcher } = AssemblyConfigSchemasFactory(\n    pluginManager,\n  )\n  const assemblyConfigSchemasType = types.union(\n    { dispatcher },\n    ...assemblyConfigSchemas,\n  )\n  const Session = sessionModelFactory(pluginManager, assemblyConfigSchemasType)\n  const assemblyManagerType = assemblyManagerFactory(\n    assemblyConfigSchemasType,\n    pluginManager,\n  )\n  return types\n    .model('Root', {\n      jbrowse: jbrowseWebFactory(\n        pluginManager,\n        Session,\n        assemblyConfigSchemasType,\n      ),\n      configPath: types.maybe(types.string),\n      session: types.maybe(Session),\n      assemblyManager: assemblyManagerType,\n      version: types.maybe(types.string),\n      isAssemblyEditing: false,\n      isDefaultSessionEditing: false,\n      pluginsUpdated: false,\n    })\n    .volatile(self => ({\n      rpcManager: new RpcManager(\n        pluginManager,\n        self.jbrowse.configuration.rpc,\n        {\n          WebWorkerRpcDriver: { WorkerClass: RenderWorker },\n          MainThreadRpcDriver: {},\n        },\n      ),\n      savedSessionsVolatile: observable.map({}),\n      pluginManager,\n      error: undefined as undefined | Error,\n    }))\n    .views(self => ({\n      get savedSessions() {\n        return Array.from(self.savedSessionsVolatile.values())\n      },\n      localStorageId(name: string) {\n        return `localSaved-${name}-${self.configPath}`\n      },\n      get autosaveId() {\n        return `autosave-${self.configPath}`\n      },\n      get previousAutosaveId() {\n        return `previousAutosave-${self.configPath}`\n      },\n    }))\n    .views(self => ({\n      get savedSessionNames() {\n        return self.savedSessions.map(session => session.name)\n      },\n      get currentSessionId() {\n        const locationUrl = new URL(window.location.href)\n        const params = new URLSearchParams(locationUrl.search)\n        return params?.get('session')?.split('local-')[1]\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        Object.entries(localStorage)\n          .filter(([key, _val]) => key.startsWith('localSaved-'))\n          .filter(\n            ([key, _val]) => key.indexOf(self.configPath || 'undefined') !== -1,\n          )\n          .forEach(([key, val]) => {\n            try {\n              const { session } = JSON.parse(val)\n              self.savedSessionsVolatile.set(key, session)\n            } catch (e) {\n              console.error('bad session encountered', key, val)\n            }\n          })\n        addDisposer(\n          self,\n          autorun(() => {\n            for (const [_, val] of self.savedSessionsVolatile.entries()) {\n              try {\n                const key = self.localStorageId(val.name)\n                localStorage.setItem(key, JSON.stringify({ session: val }))\n              } catch (e) {\n                if (e.code === '22' || e.code === '1024') {\n                  alert(\n                    'Local storage is full! Please use the \"Open sessions\" panel to remove old sessions',\n                  )\n                }\n              }\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.session) {\n                const noSession = { name: 'empty' }\n                const snapshot = getSnapshot(self.session) || noSession\n                sessionStorage.setItem(\n                  'current',\n                  JSON.stringify({ session: snapshot }),\n                )\n\n                localStorage.setItem(\n                  `autosave-${self.configPath}`,\n                  JSON.stringify({\n                    session: {\n                      ...snapshot,\n                      name: `${snapshot.name}-autosaved`,\n                    },\n                  }),\n                )\n                if (self.pluginsUpdated) {\n                  this.setPluginsUpdated(false)\n                  // reload app to get a fresh plugin manager\n                  window.location.reload()\n                }\n              }\n            },\n            { delay: 400 },\n          ),\n        )\n      },\n      setSession(sessionSnapshot?: SnapshotIn<typeof Session>) {\n        const oldSession = self.session\n        self.session = cast(sessionSnapshot)\n        if (self.session) {\n          // validate all references in the session snapshot\n          try {\n            filterSessionInPlace(self.session, getType(self.session))\n          } catch (error) {\n            // throws error if session filtering failed\n            self.session = oldSession\n            throw error\n          }\n        }\n        if (oldSession) {\n          this.setPluginsUpdated(true)\n        }\n      },\n      setAssemblyEditing(flag: boolean) {\n        self.isAssemblyEditing = flag\n      },\n      setDefaultSessionEditing(flag: boolean) {\n        self.isDefaultSessionEditing = flag\n      },\n      setPluginsUpdated(flag: boolean) {\n        self.pluginsUpdated = flag\n      },\n      setDefaultSession() {\n        const { defaultSession } = self.jbrowse\n        const newSession = {\n          ...defaultSession,\n          name: `${defaultSession.name} ${new Date().toLocaleString()}`,\n        }\n\n        this.setSession(newSession)\n      },\n      renameCurrentSession(sessionName: string) {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          snapshot.name = sessionName\n          this.setSession(snapshot)\n        }\n      },\n\n      addSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        self.savedSessionsVolatile.set(key, session)\n      },\n\n      removeSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        localStorage.removeItem(key)\n        self.savedSessionsVolatile.delete(key)\n      },\n\n      duplicateCurrentSession() {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          let newSnapshotName = `${self.session.name} (copy)`\n          if (self.savedSessionNames.includes(newSnapshotName)) {\n            let newSnapshotCopyNumber = 2\n            do {\n              newSnapshotName = `${self.session.name} (copy ${newSnapshotCopyNumber})`\n              newSnapshotCopyNumber += 1\n            } while (self.savedSessionNames.includes(newSnapshotName))\n          }\n          snapshot.name = newSnapshotName\n          this.setSession(snapshot)\n        }\n      },\n      activateSession(name: string) {\n        const localId = self.localStorageId(name)\n        const newSessionSnapshot = localStorage.getItem(localId)\n        if (!newSessionSnapshot) {\n          throw new Error(\n            `Can't activate session ${name}, it is not in the savedSessions`,\n          )\n        }\n\n        this.setSession(JSON.parse(newSessionSnapshot).session)\n      },\n      saveSessionToLocalStorage() {\n        if (self.session) {\n          const key = self.localStorageId(self.session.name)\n          self.savedSessionsVolatile.set(key, getSnapshot(self.session))\n        }\n      },\n      loadAutosaveSession() {\n        const previousAutosave = localStorage.getItem(self.previousAutosaveId)\n        const autosavedSession = previousAutosave\n          ? JSON.parse(previousAutosave).session\n          : {}\n        const { name } = autosavedSession\n        autosavedSession.name = `${name.replace('-autosaved', '')}-restored`\n        this.setSession(autosavedSession)\n      },\n\n      setError(error?: Error) {\n        self.error = error\n      },\n    }))\n    .volatile(self => ({\n      history: {},\n      menus: [\n        {\n          label: 'File',\n          menuItems: [\n            {\n              label: 'New session',\n              icon: AddIcon,\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              onClick: (session: any) => {\n                const lastAutosave = localStorage.getItem(self.autosaveId)\n                if (lastAutosave) {\n                  localStorage.setItem(self.previousAutosaveId, lastAutosave)\n                }\n                session.setDefaultSession()\n              },\n            },\n            {\n              label: 'Return to splash screen',\n              icon: AppsIcon,\n              onClick: () => {\n                self.setSession(undefined)\n              },\n            },\n          ],\n        },\n        ...(adminMode\n          ? [\n              {\n                label: 'Admin',\n                menuItems: [\n                  {\n                    label: 'Open assembly manager',\n                    icon: SettingsIcon,\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    onClick: (session: any) => {\n                      const rootModel = getParent(session)\n                      rootModel.setAssemblyEditing(true)\n                    },\n                  },\n                  {\n                    label: 'Set default session',\n                    icon: SettingsIcon,\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    onClick: (session: any) => {\n                      const rootModel = getParent(session)\n                      rootModel.setDefaultSessionEditing(true)\n                    },\n                  },\n                ],\n              },\n            ]\n          : []),\n      ] as Menu[],\n      adminMode,\n    }))\n    .actions(self => ({\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      setHistory(history: any) {\n        self.history = history\n      },\n      setMenus(newMenus: Menu[]) {\n        self.menus = newMenus\n      },\n      /**\n       * Add a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @returns The new length of the top-level menus array\n       */\n      appendMenu(menuName: string) {\n        return self.menus.push({ label: menuName, menuItems: [] })\n      },\n      /**\n       * Insert a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @param position - Position to insert menu. If negative, counts from th\n       * end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the\n       * second-to-last one.\n       * @returns The new length of the top-level menus array\n       */\n      insertMenu(menuName: string, position: number) {\n        const insertPosition =\n          position < 0 ? self.menus.length + position : position\n        self.menus.splice(insertPosition, 0, { label: menuName, menuItems: [] })\n        return self.menus.length\n      },\n      /**\n       * Add a menu item to a top-level menu\n       * @param menuName - Name of the top-level menu to append to.\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the menu\n       */\n      appendToMenu(menuName: string, menuItem: MenuItem) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        return menu.menuItems.push(menuItem)\n      },\n      /**\n       * Insert a menu item into a top-level menu\n       * @param menuName - Name of the top-level menu to insert into\n       * @param menuItem - Menu item to insert\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the menu\n       */\n      insertInMenu(menuName: string, menuItem: MenuItem, position: number) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        const insertPosition =\n          position < 0 ? menu.menuItems.length + position : position\n        menu.menuItems.splice(insertPosition, 0, menuItem)\n        return menu.menuItems.length\n      },\n      /**\n       * Add a menu item to a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the sub-menu\n       */\n      appendToSubMenu(menuPath: string[], menuItem: MenuItem) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        return subMenu.push(menuItem)\n      },\n      /**\n       * Insert a menu item into a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to insert.\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the sub-menu\n       */\n      insertInSubMenu(\n        menuPath: string[],\n        menuItem: MenuItem,\n        position: number,\n      ) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        subMenu.splice(position, 0, menuItem)\n        return subMenu.length\n      },\n    }))\n}\n\nexport function createTestSession(snapshot = {}, adminMode = false) {\n  const pluginManager = new PluginManager(corePlugins.map(P => new P()))\n  pluginManager.createPluggableElements()\n\n  const JBrowseRootModel = RootModel(pluginManager, adminMode)\n  const root = JBrowseRootModel.create(\n    {\n      jbrowse: {\n        configuration: { rpc: { defaultDriver: 'MainThreadRpcDriver' } },\n      },\n      assemblyManager: {},\n    },\n    { pluginManager },\n  )\n  root.setSession({\n    name: 'testSession',\n    ...snapshot,\n  })\n  // @ts-ignore\n  root.session.views.map(view => view.setWidth(800))\n  pluginManager.setRootModel(root)\n\n  pluginManager.configure()\n  return root.session as AbstractSessionModel\n}\n","export default async function factoryReset() {\n  // @ts-ignore\n  window.location = window.location.pathname\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React, { lazy, useEffect, useState, Suspense } from 'react'\nimport PluginManager, { PluginLoadRecord } from '@jbrowse/core/PluginManager'\nimport PluginLoader, {\n  PluginDefinition,\n  PluginRecord,\n} from '@jbrowse/core/PluginLoader'\nimport { observer } from 'mobx-react'\nimport { inDevelopment, fromUrlSafeB64 } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ErrorBoundary } from 'react-error-boundary'\nimport {\n  StringParam,\n  QueryParamProvider,\n  useQueryParam,\n} from 'use-query-params'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { types, addDisposer, Instance, SnapshotOut } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport { PluginConstructor } from '@jbrowse/core/Plugin'\nimport { FatalErrorDialog } from '@jbrowse/core/ui'\nimport 'fontsource-roboto'\nimport 'requestidlecallback-polyfill'\nimport 'core-js/stable'\nimport queryString from 'query-string'\nimport shortid from 'shortid'\nimport {\n  writeAWSAnalytics,\n  writeGAAnalytics,\n} from '@jbrowse/core/util/analytics'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { readSessionFromDynamo } from './sessionSharing'\nimport Loading from './Loading'\nimport corePlugins from './corePlugins'\nimport JBrowse from './JBrowse'\nimport JBrowseRootModelFactory from './rootModel'\nimport packagedef from '../package.json'\nimport factoryReset from './factoryReset'\n\nconst SessionWarningDialog = lazy(() => import('./SessionWarningDialog'))\nconst ConfigWarningDialog = lazy(() => import('./ConfigWarningDialog'))\nconst StartScreen = lazy(() => import('./StartScreen'))\n\nfunction NoConfigMessage() {\n  const links = [\n    ['test_data/volvox/config.json', 'Volvox sample data'],\n    ['test_data/config.json', 'Human basic'],\n    ['test_data/config_demo.json', 'Human sample data'],\n    ['test_data/tomato/config.json', 'Tomato SVs'],\n    ['test_data/breakpoint/config.json', 'Breakpoint'],\n    ['test_data/config_dotplot.json', 'Grape/Peach dotplot'],\n    ['test_data/config_synteny_grape_peach.json', 'Grape/Peach synteny'],\n    ['test_data/yeast_synteny/config.json', 'Yeast synteny'],\n    ['test_data/config_many_contigs.json', 'Many contigs'],\n    ['test_data/config_honeybee.json', 'Honeybee'],\n    ['test_data/config_wormbase.json', 'Wormbase'],\n    ['test_data/wgbs/config.json', 'WGBS methylation'],\n  ]\n  return (\n    <div>\n      <h4>\n        Configuration not found. You may have arrived here if you requested a\n        config that does not exist or you have not set up your JBrowse yet.\n      </h4>\n\n      <p>\n        If you want to complete your setup, visit our{' '}\n        <a href=\"https://jbrowse.org/jb2/docs/quickstart_web\">\n          Quick start guide\n        </a>\n      </p>\n\n      {inDevelopment ? (\n        <>\n          <div>Sample JBrowse configs:</div>\n          <ul>\n            {links.map(([link, name]) => {\n              const { href, search } = window.location\n              const { config, ...rest } = queryString.parse(search)\n              const root = href.split('?')[0]\n              const params = queryString.stringify({\n                ...rest,\n                config: link,\n              })\n              return (\n                <li key={name}>\n                  <a href={`${root}?${params}`}>{name}</a>\n                </li>\n              )\n            })}\n          </ul>\n        </>\n      ) : (\n        <>\n          <div>Sample JBrowse config:</div>\n          <ul>\n            <li>\n              <a href=\"?config=test_data/volvox/config.json\">\n                Volvox sample data\n              </a>\n            </li>\n          </ul>\n        </>\n      )}\n    </div>\n  )\n}\n\nasync function checkPlugins(pluginsToCheck: { url: string }[]) {\n  const fetchResult = await fetch(\n    'https://jbrowse.org/plugin-store/plugins.json',\n  )\n  if (!fetchResult.ok) {\n    throw new Error('Failed to fetch plugin data')\n  }\n  const array = (await fetchResult.json()) as {\n    plugins: { url: string }[]\n  }\n  const allowedPluginUrls = array.plugins.map(p => p.url)\n  return pluginsToCheck.every(p => allowedPluginUrls.includes(p.url))\n}\n\ntype Config = SnapshotOut<AnyConfigurationModel>\n\nconst SessionLoader = types\n  .model({\n    configPath: types.maybe(types.string),\n    sessionQuery: types.maybe(types.string),\n    password: types.maybe(types.string),\n    adminKey: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    blankSession: false as any,\n    sessionTriaged: undefined as any,\n    shareWarningOpen: false as any,\n    configSnapshot: undefined as any,\n    sessionSnapshot: undefined as any,\n    runtimePlugins: [] as PluginRecord[],\n    sessionPlugins: [] as PluginRecord[],\n    sessionError: undefined as Error | undefined,\n    configError: undefined as Error | undefined,\n    bc1:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_request_session'),\n    bc2:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_respond_session'),\n  }))\n  .views(self => ({\n    get sharedSession() {\n      return self.sessionQuery?.startsWith('share-')\n    },\n\n    get encodedSession() {\n      return self.sessionQuery?.startsWith('encoded-')\n    },\n\n    get jsonSession() {\n      return self.sessionQuery?.startsWith('json-')\n    },\n\n    get localSession() {\n      return self.sessionQuery?.startsWith('local-')\n    },\n\n    get ready() {\n      return this.sessionLoaded && !self.configError\n    },\n\n    get error() {\n      return self.configError || self.sessionError\n    },\n\n    get sessionLoaded() {\n      return (\n        !!self.sessionError || !!self.sessionSnapshot || !!self.blankSession\n      )\n    },\n    get configLoaded() {\n      return !!self.configError || !!self.configSnapshot\n    },\n  }))\n  .actions(self => ({\n    setSessionQuery(session?: any) {\n      self.sessionQuery = session\n    },\n    setConfigError(error: Error) {\n      self.configError = error\n    },\n    setSessionError(error: Error) {\n      self.sessionError = error\n    },\n    setRuntimePlugins(plugins: PluginRecord[]) {\n      self.runtimePlugins = plugins\n    },\n    setSessionPlugins(plugins: PluginRecord[]) {\n      self.sessionPlugins = plugins\n    },\n    setConfigSnapshot(snap: unknown) {\n      self.configSnapshot = snap\n    },\n\n    setBlankSession(flag: boolean) {\n      self.blankSession = flag\n    },\n    setSessionTriaged(args?: {\n      snap: unknown\n      origin: string\n      reason: { url: string }[]\n    }) {\n      self.sessionTriaged = args\n    },\n    setSessionSnapshotSuccess(snap: unknown) {\n      self.sessionSnapshot = snap\n    },\n  }))\n  .actions(self => ({\n    async fetchPlugins(config: { plugins: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(config.plugins)\n        pluginLoader.installGlobalReExports(window)\n        const runtimePlugins = await pluginLoader.load()\n        self.setRuntimePlugins([...runtimePlugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n    async fetchSessionPlugins(snap: { sessionPlugins?: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(snap.sessionPlugins || [])\n        pluginLoader.installGlobalReExports(window)\n        const plugins = await pluginLoader.load()\n        self.setSessionPlugins([...plugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n\n    // passed\n    async setSessionSnapshot(\n      snap: { sessionPlugins?: PluginDefinition[] },\n      userAcceptedConfirmation?: boolean,\n    ) {\n      try {\n        const { sessionPlugins = [] } = snap\n        const sessionPluginsAllowed = sessionPlugins.length\n          ? await checkPlugins(sessionPlugins)\n          : true\n        if (sessionPluginsAllowed || userAcceptedConfirmation) {\n          await this.fetchSessionPlugins(snap)\n          self.setSessionSnapshotSuccess(snap)\n        } else {\n          self.setSessionTriaged({\n            snap,\n            origin: 'session',\n            reason: sessionPlugins,\n          })\n        }\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n\n    async fetchConfig() {\n      const { configPath = 'config.json' } = self\n      const config = JSON.parse(\n        (await openLocation({ uri: configPath }).readFile('utf8')) as string,\n      )\n      const configUri = new URL(configPath, window.location.href)\n      addRelativeUris(config, configUri)\n\n      // cross origin config check\n      if (configUri.hostname !== window.location.hostname) {\n        const configPlugins = config.plugins || []\n        const configPluginsAllowed = configPlugins.length\n          ? await checkPlugins(configPlugins)\n          : true\n        if (!configPluginsAllowed) {\n          self.setSessionTriaged({\n            snap: config,\n            origin: 'config',\n            reason: configPlugins,\n          })\n        } else {\n          await this.fetchPlugins(config)\n          self.setConfigSnapshot(config)\n        }\n      } else {\n        await this.fetchPlugins(config)\n        self.setConfigSnapshot(config)\n      }\n    },\n\n    async fetchSessionStorageSession() {\n      const sessionStr = sessionStorage.getItem('current')\n      const query = (self.sessionQuery as string).replace('local-', '')\n\n      // check if\n      if (sessionStr) {\n        const sessionSnap = JSON.parse(sessionStr).session || {}\n        if (query === sessionSnap.id) {\n          await this.setSessionSnapshot(sessionSnap)\n          return\n        }\n      }\n      if (self.bc1) {\n        self.bc1.postMessage(query)\n        const resultP = new Promise((resolve, reject) => {\n          if (self.bc2) {\n            self.bc2.onmessage = msg => {\n              resolve(msg.data)\n            }\n          }\n          setTimeout(() => reject(), 1000)\n        })\n\n        try {\n          const result = await resultP\n          // @ts-ignore\n          await self.setSessionSnapshot({ ...result, id: shortid() })\n          return\n        } catch (e) {\n          // the broadcast channels did not find the session in another tab\n          // clear session param, so just ignore\n        }\n      }\n      throw new Error('Local storage session not found')\n    },\n\n    async fetchSharedSession() {\n      // raw readConf alternative for before conf is initialized\n      const readConf = (\n        conf: { configuration?: { [key: string]: string } },\n        attr: string,\n        def: string,\n      ) => {\n        return (conf.configuration || {})[attr] || def\n      }\n\n      const defaultURL = 'https://share.jbrowse.org/api/v1/'\n      const decryptedSession = await readSessionFromDynamo(\n        `${readConf(self.configSnapshot, 'shareURL', defaultURL)}load`,\n        self.sessionQuery || '',\n        self.password || '',\n      )\n\n      const session = JSON.parse(fromUrlSafeB64(decryptedSession))\n\n      await this.setSessionSnapshot({ ...session, id: shortid() })\n    },\n\n    async decodeEncodedUrlSession() {\n      const session = JSON.parse(\n        // @ts-ignore\n        fromUrlSafeB64(self.sessionQuery.replace('encoded-', '')),\n      )\n      await this.setSessionSnapshot({ ...session, id: shortid() })\n    },\n\n    async decodeJsonUrlSession() {\n      // @ts-ignore\n      const session = JSON.parse(self.sessionQuery.replace('json-', ''))\n      await this.setSessionSnapshot({ ...session.session, id: shortid() })\n    },\n\n    async afterCreate() {\n      const {\n        localSession,\n        encodedSession,\n        sharedSession,\n        jsonSession,\n        configPath,\n      } = self\n\n      // rename autosave to previousAutosave\n      const lastAutosave = localStorage.getItem(`autosave-${configPath}`)\n      if (lastAutosave) {\n        localStorage.setItem(`previousAutosave-${configPath}`, lastAutosave)\n      }\n\n      try {\n        // fetch config\n        await this.fetchConfig()\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n        return\n      }\n\n      addDisposer(\n        self,\n        autorun(async () => {\n          try {\n            if (self.configSnapshot) {\n              if (sharedSession) {\n                await this.fetchSharedSession()\n              } else if (encodedSession) {\n                await this.decodeEncodedUrlSession()\n              } else if (jsonSession) {\n                await this.decodeJsonUrlSession()\n              } else if (localSession) {\n                await this.fetchSessionStorageSession()\n              } else if (self.sessionQuery) {\n                // if there was a sessionQuery and we don't recognize it\n                throw new Error('unrecognized session format')\n              } else {\n                // placeholder for session loaded, but none found\n                self.setBlankSession(true)\n              }\n              if (self.bc1) {\n                self.bc1.onmessage = msg => {\n                  const ret =\n                    JSON.parse(sessionStorage.getItem('current') || '{}')\n                      .session || {}\n                  if (ret.id === msg.data) {\n                    if (self.bc2) {\n                      self.bc2.postMessage(ret)\n                    }\n                  }\n                }\n              }\n            }\n          } catch (e) {\n            console.error(e)\n            self.setSessionError(e)\n          }\n        }),\n      )\n    },\n  }))\n\nexport function Loader({\n  initialTimestamp = Date.now(),\n}: {\n  initialTimestamp?: number\n}) {\n  // return value if defined, else convert null to undefined for use with\n  // types.maybe\n  const load = (param: string | null | undefined) =>\n    param === null ? undefined : param\n\n  const [config] = useQueryParam('config', StringParam)\n  const [session] = useQueryParam('session', StringParam)\n  const [password] = useQueryParam('password', StringParam)\n  const [adminKey] = useQueryParam('adminKey', StringParam)\n\n  const loader = SessionLoader.create({\n    configPath: load(config),\n    sessionQuery: load(session),\n    password: load(password),\n    adminKey: load(adminKey),\n  })\n\n  return (\n    <Renderer\n      loader={loader}\n      initialTimestamp={initialTimestamp}\n      initialSessionQuery={session}\n    />\n  )\n}\n\nconst Renderer = observer(\n  ({\n    loader,\n    initialTimestamp,\n    initialSessionQuery,\n  }: {\n    loader: Instance<typeof SessionLoader>\n    initialTimestamp: number\n    initialSessionQuery: string | null | undefined\n  }) => {\n    const [, setPassword] = useQueryParam('password', StringParam)\n    const { sessionError, configError, ready, shareWarningOpen } = loader\n    const [pm, setPluginManager] = useState<PluginManager>()\n    const [error, setError] = useState('')\n    const [snapshotError, setSnapshotError] = useState('')\n    // only create the pluginManager/rootModel \"on mount\"\n    useEffect(() => {\n      try {\n        const {\n          runtimePlugins,\n          sessionPlugins,\n          adminKey,\n          configSnapshot,\n          sessionSnapshot,\n          configPath,\n        } = loader\n\n        if (ready) {\n          // it is ready when a session has loaded and when there is no config\n          // error Assuming that the query changes self.sessionError or\n          // self.sessionSnapshot or self.blankSession\n          const pluginManager = new PluginManager([\n            ...corePlugins.map(P => {\n              return {\n                plugin: new P(),\n                metadata: { isCore: true },\n              } as PluginLoadRecord\n            }),\n            ...runtimePlugins.map(({ plugin: P, definition }) => ({\n              plugin: new P(),\n              definition,\n            })),\n            ...sessionPlugins.map(({ plugin: P, definition }) => ({\n              plugin: new P(),\n              definition,\n            })),\n          ])\n          pluginManager.createPluggableElements()\n\n          const JBrowseRootModel = JBrowseRootModelFactory(\n            pluginManager,\n            !!adminKey,\n          )\n\n          if (loader.configSnapshot) {\n            const rootModel = JBrowseRootModel.create(\n              {\n                jbrowse: configSnapshot,\n                assemblyManager: {},\n                version: packagedef.version,\n                configPath,\n              },\n              { pluginManager },\n            )\n            rootModel.jbrowse.configuration.rpc.addDriverConfig(\n              'WebWorkerRpcDriver',\n              { type: 'WebWorkerRpcDriver' },\n            )\n            if (!loader.configSnapshot?.configuration?.rpc?.defaultDriver) {\n              rootModel.jbrowse.configuration.rpc.defaultDriver.set(\n                'WebWorkerRpcDriver',\n              )\n            }\n\n            // in order: saves the previous autosave for recovery, tries to\n            // load the local session if session in query, or loads the default\n            // session\n            if (sessionError) {\n              rootModel.setDefaultSession()\n              // make typescript happy by checking for session after\n              // setDefaultSession, even though we know this exists now\n              if (rootModel.session) {\n                rootModel.session.notify(\n                  `Error loading session: ${sessionError.message}. If you\n                received this URL from another user, request that they send you\n                a session generated with the \"Share\" button instead of copying\n                and pasting their URL`,\n                )\n              }\n            } else if (sessionSnapshot && !shareWarningOpen) {\n              try {\n                rootModel.setSession(loader.sessionSnapshot)\n              } catch (err) {\n                console.error(err)\n                rootModel.setDefaultSession()\n                const errorMessage = (err.message || '')\n                  .replace('[mobx-state-tree] ', '')\n                  .replace(/\\(.+/, '')\n                rootModel.session?.notify(\n                  `Session could not be loaded. ${\n                    errorMessage.length > 1000\n                      ? `${errorMessage.slice(0, 1000)}...see more in console`\n                      : errorMessage\n                  }`,\n                )\n              }\n            } else {\n              const defaultJBrowseSession = rootModel.jbrowse.defaultSession\n              if (defaultJBrowseSession?.views) {\n                if (defaultJBrowseSession.views.length > 0) {\n                  rootModel.setDefaultSession()\n                }\n              }\n            }\n\n            // send analytics\n            if (\n              rootModel &&\n              !readConfObject(\n                rootModel.jbrowse.configuration,\n                'disableAnalytics',\n              )\n            ) {\n              writeAWSAnalytics(\n                rootModel,\n                initialTimestamp,\n                initialSessionQuery,\n              )\n              writeGAAnalytics(rootModel, initialTimestamp)\n            }\n\n            pluginManager.setRootModel(rootModel)\n            pluginManager.configure()\n            setPluginManager(pluginManager)\n\n            // automatically clear password field once loaded\n            setPassword(undefined)\n          }\n        }\n      } catch (e) {\n        const match = e.message.match(\n          /.*at path \"(.*)\" snapshot `(.*)` is not assignable/,\n        )\n        // best effort to make a better error message than the default\n        // mobx-state-tree\n        if (match) {\n          setError(`Failed to load element at ${match[1]}`)\n          setSnapshotError(match[2])\n        } else {\n          setError(e.message.slice(0, 10000))\n        }\n        console.error(e)\n      }\n    }, [\n      loader,\n      shareWarningOpen,\n      ready,\n      sessionError,\n      setPassword,\n      initialTimestamp,\n      initialSessionQuery,\n    ])\n\n    const err = configError || error\n\n    if (err) {\n      return (\n        <div>\n          <NoConfigMessage />\n          {err ? (\n            <div\n              style={{\n                border: '1px solid black',\n                overflow: 'auto',\n                maxHeight: 200,\n                padding: 2,\n                margin: 2,\n                backgroundColor: '#ff8888',\n              }}\n            >\n              {`${err}`}\n              {snapshotError ? (\n                <>\n                  ... Failed element had snapshot:\n                  <pre\n                    style={{\n                      background: 'lightgrey',\n                      border: '1px solid black',\n                      margin: 20,\n                    }}\n                  >\n                    {JSON.stringify(JSON.parse(snapshotError), null, 2)}\n                  </pre>\n                </>\n              ) : null}\n            </div>\n          ) : null}\n        </div>\n      )\n    }\n\n    if (loader.sessionTriaged) {\n      const handleClose = () => {\n        loader.setSessionTriaged(undefined)\n      }\n      return loader.sessionTriaged.origin === 'session' ? (\n        <Suspense fallback={<div />}>\n          <SessionWarningDialog\n            onConfirm={async () => {\n              const session = JSON.parse(\n                JSON.stringify(loader.sessionTriaged.snap),\n              )\n\n              // second param true says we passed user confirmation\n              await loader.setSessionSnapshot(\n                { ...session, id: shortid() },\n                true,\n              )\n              handleClose()\n            }}\n            onCancel={() => {\n              loader.setBlankSession(true)\n              handleClose()\n            }}\n            reason={loader.sessionTriaged.reason}\n          />\n        </Suspense>\n      ) : (\n        <Suspense fallback={<div />}>\n          <ConfigWarningDialog\n            onConfirm={async () => {\n              const session = JSON.parse(\n                JSON.stringify(loader.sessionTriaged.snap),\n              )\n              await loader.fetchPlugins(session)\n              loader.setConfigSnapshot({ ...session, id: shortid() })\n              handleClose()\n            }}\n            onCancel={() => {\n              factoryReset()\n              handleClose()\n            }}\n            reason={loader.sessionTriaged.reason}\n          />\n        </Suspense>\n      )\n    }\n    if (pm) {\n      if (!pm.rootModel?.session) {\n        return (\n          <Suspense fallback={<div>Loading...</div>}>\n            <StartScreen root={pm.rootModel} onFactoryReset={factoryReset} />\n          </Suspense>\n        )\n      }\n      return <JBrowse pluginManager={pm} />\n    }\n    return <Loading />\n  },\n)\n\nfunction addRelativeUris(config: Config, configUri: URL) {\n  if (typeof config === 'object') {\n    for (const key of Object.keys(config)) {\n      if (typeof config[key] === 'object') {\n        addRelativeUris(config[key], configUri)\n      } else if (key === 'uri') {\n        config.baseUri = configUri.href\n      }\n    }\n  }\n}\n\nconst PlatformSpecificFatalErrorDialog = (props: unknown) => {\n  return (\n    <FatalErrorDialog\n      resetButtonText=\"Reset Session\"\n      onFactoryReset={factoryReset}\n      {...props}\n    />\n  )\n}\nconst LoaderWrapper = ({ initialTimestamp }: { initialTimestamp: number }) => {\n  return (\n    <ErrorBoundary FallbackComponent={PlatformSpecificFatalErrorDialog}>\n      <QueryParamProvider>\n        <Loader initialTimestamp={initialTimestamp} />\n      </QueryParamProvider>\n    </ErrorBoundary>\n  )\n}\n\nexport default LoaderWrapper\n\nexport type SessionLoader = Instance<typeof SessionLoader>\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport DisplayType from './DisplayType'\n\nexport default class TrackType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for track ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for track ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import { ComponentType, LazyExoticComponent } from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class WidgetType extends PluggableElementBase {\n  heading?: string\n\n  configSchema: AnyConfigurationSchemaType\n\n  HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ReactComponent: LazyExoticComponent<React.FC<any>> | React.FC<any>\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    heading?: string\n    HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n    configSchema: AnyConfigurationSchemaType\n    stateModel: IAnyModelType\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ReactComponent: LazyExoticComponent<React.FC<any>> | React.FC<any>\n  }) {\n    super(stuff)\n    this.heading = stuff.heading\n    this.HeadingComponent = stuff.HeadingComponent\n    this.configSchema = stuff.configSchema\n    this.stateModel = stuff.stateModel\n    this.ReactComponent = stuff.ReactComponent\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for widget ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for widget ${this.name}`)\n    }\n  }\n}\n","import SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon'\nimport React from 'react'\n\n// Icons below come from https://material.io/resources/icons/?icon=line_style&style=baseline\nexport function ContentCopy(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentCut(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentPaste(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z\" />\n    </SvgIcon>\n  )\n}\n\n//  format-list-checkbox from https://materialdesignicons.com/\nexport function TrackSelector(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z\" />\n    </SvgIcon>\n  )\n}\n","export default abstract class PluggableElementBase {\n  [key: string]: unknown\n\n  name = ''\n\n  constructor({ name }: { name: string }) {\n    this.name = name\n  }\n}\n","import React, { useEffect, useRef, useState } from 'react'\nimport {\n  Divider,\n  Grow,\n  ListItemIcon,\n  ListItemText,\n  ListSubheader,\n  MenuProps as MUIMenuProps,\n  MenuItem,\n  MenuItemProps,\n  MenuList,\n  Paper,\n  Popover,\n  PopoverProps,\n  SvgIconProps,\n  makeStyles,\n} from '@material-ui/core'\n// icons\nimport ArrowRightIcon from '@material-ui/icons/ArrowRight'\nimport CheckBoxIcon from '@material-ui/icons/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank'\nimport RadioButtonCheckedIcon from '@material-ui/icons/RadioButtonChecked'\nimport RadioButtonUncheckedIcon from '@material-ui/icons/RadioButtonUnchecked'\n\n// other\nimport { findLastIndex } from '../util'\n\nconst useStyles = makeStyles({\n  paper: {\n    position: 'fixed',\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    // So we see the popover when it's empty.\n    minWidth: 16,\n    minHeight: 16,\n    maxWidth: 'calc(100% - 32px)',\n    maxHeight: 'calc(100% - 32px)',\n    top: 0,\n    left: 0,\n    // We disable the focus ring for mouse, touch and keyboard users.\n    outline: 0,\n  },\n  menuItemEndDecoration: {\n    position: 'absolute',\n    right: 16,\n    top: '50%',\n    transform: 'translateY(-50%)',\n    padding: 2,\n    marginRight: -12,\n    display: 'inline-flex',\n  },\n})\n\ninterface MenuItemEndDecorationSubMenuProps {\n  type: 'subMenu'\n}\n\ninterface MenuItemEndDecorationSelectorProps {\n  type: 'checkbox' | 'radio'\n  checked: boolean\n  disabled?: boolean\n}\n\ntype MenuItemEndDecorationProps =\n  | MenuItemEndDecorationSubMenuProps\n  | MenuItemEndDecorationSelectorProps\n\nfunction MenuItemEndDecoration(props: MenuItemEndDecorationProps) {\n  const classes = useStyles()\n  const { type } = props\n  let checked\n  let disabled\n  if ('checked' in props) {\n    ;({ checked, disabled } = props)\n  }\n  let icon\n  if (type === 'subMenu') {\n    icon = <ArrowRightIcon color=\"action\" />\n  } else if (type === 'checkbox') {\n    if (checked) {\n      const color = disabled ? 'inherit' : 'secondary'\n      icon = <CheckBoxIcon color={color} />\n    } else {\n      icon = <CheckBoxOutlineBlankIcon color=\"action\" />\n    }\n  } else if (type === 'radio') {\n    if (checked) {\n      const color = disabled ? 'inherit' : 'secondary'\n      icon = <RadioButtonCheckedIcon color={color} />\n    } else {\n      icon = <RadioButtonUncheckedIcon color=\"action\" />\n    }\n  }\n  return <div className={classes.menuItemEndDecoration}>{icon}</div>\n}\n\nexport interface MenuDivider {\n  priority?: number\n  type: 'divider'\n}\n\nexport interface MenuSubHeader {\n  type: 'subHeader'\n  priority?: number\n  label: string\n}\n\nexport interface BaseMenuItem {\n  label: string\n  priority?: number\n  subLabel?: string\n  icon?: React.ComponentType<SvgIconProps>\n  disabled?: boolean\n}\n\nexport interface NormalMenuItem extends BaseMenuItem {\n  type?: 'normal'\n  onClick: Function\n}\n\nexport interface CheckboxMenuItem extends BaseMenuItem {\n  type: 'checkbox'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface RadioMenuItem extends BaseMenuItem {\n  type: 'radio'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface SubMenuItem extends BaseMenuItem {\n  type?: 'subMenu'\n  subMenu: MenuItem[]\n}\n\nexport type MenuItem =\n  | MenuDivider\n  | MenuSubHeader\n  | NormalMenuItem\n  | CheckboxMenuItem\n  | RadioMenuItem\n  | SubMenuItem\n\ntype AnchorElProp = MUIMenuProps['anchorEl']\ntype OpenProp = MUIMenuProps['open']\ntype OnCloseProp = MUIMenuProps['onClose']\n\ninterface MenuPageProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n  anchorEl?: AnchorElProp\n  open: OpenProp\n  onClose: OnCloseProp\n  top?: boolean\n}\n\ntype MenuItemStyleProp = MenuItemProps['style']\n\nfunction findNextValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  const idx = menuItems\n    .slice(currentIdx + 1)\n    .findIndex(\n      menuItem =>\n        menuItem.type !== 'divider' &&\n        menuItem.type !== 'subHeader' &&\n        !menuItem.disabled,\n    )\n  if (idx === -1) {\n    return idx\n  }\n  return currentIdx + 1 + idx\n}\n\nfunction findPreviousValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  return findLastIndex(\n    menuItems.slice(0, currentIdx),\n    menuItem =>\n      menuItem.type !== 'divider' &&\n      menuItem.type !== 'subHeader' &&\n      !menuItem.disabled,\n  )\n}\n\nconst MenuPage = React.forwardRef((props: MenuPageProps, ref) => {\n  const [subMenuAnchorEl, setSubMenuAnchorEl] = useState<HTMLElement>()\n  const [openSubMenuIdx, setOpenSubMenuIdx] = useState<number>()\n  const [isSubMenuOpen, setIsSubMenuOpen] = useState(false)\n  const [selectedMenuItemIdx, setSelectedMenuItemIdx] = useState<number>()\n  const [position, setPosition] = useState<{\n    top?: number\n    left?: number\n  }>()\n  const paperRef = useRef<HTMLDivElement>()\n  const classes = useStyles()\n\n  const {\n    menuItems,\n    onMenuItemClick,\n    open,\n    onClose,\n    anchorEl,\n    top = false,\n  } = props\n\n  useEffect(() => {\n    if (!open) {\n      setSubMenuAnchorEl(undefined)\n      setOpenSubMenuIdx(undefined)\n    }\n  }, [open])\n\n  useEffect(() => {\n    const shouldSubMenuBeOpen = open && Boolean(subMenuAnchorEl)\n    let timer: NodeJS.Timeout\n    if (shouldSubMenuBeOpen && !isSubMenuOpen) {\n      timer = setTimeout(() => {\n        setIsSubMenuOpen(true)\n      }, 300)\n    } else if (!shouldSubMenuBeOpen && isSubMenuOpen) {\n      timer = setTimeout(() => {\n        setIsSubMenuOpen(false)\n      }, 300)\n    }\n    return () => {\n      clearTimeout(timer)\n    }\n  }, [isSubMenuOpen, open, subMenuAnchorEl])\n\n  useEffect(() => {\n    if (anchorEl) {\n      const rect = (anchorEl as HTMLElement).getBoundingClientRect()\n      if (position) {\n        if (\n          rect.top !== position.top ||\n          rect.left + rect.width !== position.left\n        ) {\n          setPosition({ top: rect.top, left: rect.left + rect.width })\n        }\n      } else {\n        setPosition({ top: rect.top, left: rect.left + rect.width })\n      }\n    } else if (!position) {\n      setPosition({})\n    }\n  }, [position, anchorEl])\n\n  const hasEndDecoration = menuItems.some(\n    menuItem =>\n      'subMenu' in menuItem ||\n      menuItem.type === 'checkbox' ||\n      menuItem.type === 'radio',\n  )\n  const hasIcon = menuItems.some(\n    menuItem => 'icon' in menuItem && menuItem.icon,\n  )\n  const menuItemStyle: MenuItemStyleProp = {}\n  if (hasEndDecoration) {\n    menuItemStyle.paddingRight = 48\n  }\n\n  function handleClick(callback: Function) {\n    return (event: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n      onMenuItemClick(event, callback)\n    }\n  }\n\n  const ListContents = (\n    <>\n      <MenuList autoFocusItem={open && !isSubMenuOpen}>\n        {menuItems\n          .sort((a, b) => (b.priority || 0) - (a.priority || 0))\n          .map((menuItem, idx) => {\n            if (menuItem.type === 'divider') {\n              return <Divider key={`divider-${idx}`} component=\"li\" />\n            }\n            if (menuItem.type === 'subHeader') {\n              return (\n                <ListSubheader key={`subHeader-${menuItem.label}-${idx}`}>\n                  {menuItem.label}\n                </ListSubheader>\n              )\n            }\n            let icon = null\n            let endDecoration = null\n            if (menuItem.icon) {\n              const Icon = menuItem.icon\n              icon = (\n                <ListItemIcon>\n                  <Icon />\n                </ListItemIcon>\n              )\n            }\n            if ('subMenu' in menuItem) {\n              endDecoration = <MenuItemEndDecoration type=\"subMenu\" />\n            } else if (\n              menuItem.type === 'checkbox' ||\n              menuItem.type === 'radio'\n            ) {\n              endDecoration = (\n                <MenuItemEndDecoration\n                  type={menuItem.type}\n                  checked={menuItem.checked}\n                  disabled={menuItem.disabled}\n                />\n              )\n            }\n            const onClick =\n              'onClick' in menuItem ? handleClick(menuItem.onClick) : undefined\n            return (\n              <MenuItem\n                key={menuItem.label}\n                style={menuItemStyle}\n                selected={idx === selectedMenuItemIdx}\n                onClick={onClick}\n                onMouseMove={e => {\n                  if (e.currentTarget !== document.activeElement) {\n                    e.currentTarget.focus()\n                    setSelectedMenuItemIdx(idx)\n                  }\n                  if ('subMenu' in menuItem) {\n                    if (openSubMenuIdx !== idx) {\n                      setSubMenuAnchorEl(e.currentTarget)\n                      setOpenSubMenuIdx(idx)\n                    }\n                  } else {\n                    setSubMenuAnchorEl(undefined)\n                    setOpenSubMenuIdx(undefined)\n                  }\n                }}\n                onKeyDown={e => {\n                  if (e.key === 'ArrowLeft' || e.key === 'Escape') {\n                    onClose && onClose(e, 'escapeKeyDown')\n                  } else if (e.key === 'ArrowUp') {\n                    setSelectedMenuItemIdx(findPreviousValidIdx(menuItems, idx))\n                  } else if (e.key === 'ArrowDown') {\n                    const a = findNextValidIdx(menuItems, idx)\n                    setSelectedMenuItemIdx(a)\n                  } else if ('subMenu' in menuItem) {\n                    if (e.key === 'ArrowRight' || e.key === 'Enter') {\n                      setSubMenuAnchorEl(e.currentTarget)\n                      setOpenSubMenuIdx(idx)\n                      setIsSubMenuOpen(true)\n                    }\n                  }\n                }}\n                disabled={Boolean(menuItem.disabled)}\n              >\n                {icon}\n                <ListItemText\n                  primary={menuItem.label}\n                  secondary={menuItem.subLabel}\n                  inset={hasIcon && !menuItem.icon}\n                />\n                {endDecoration}\n              </MenuItem>\n            )\n          })}\n      </MenuList>\n      {menuItems.map((menuItem, idx) => {\n        let subMenu = null\n        if ('subMenu' in menuItem) {\n          subMenu = (\n            <MenuPage\n              key={menuItem.label}\n              anchorEl={subMenuAnchorEl}\n              open={isSubMenuOpen && openSubMenuIdx === idx}\n              onClose={() => {\n                setIsSubMenuOpen(false)\n                setSubMenuAnchorEl(undefined)\n              }}\n              onMenuItemClick={onMenuItemClick}\n              menuItems={menuItem.subMenu}\n            />\n          )\n        }\n        return subMenu\n      })}\n    </>\n  )\n\n  if (top) {\n    return ListContents\n  }\n\n  return (\n    <Grow in={open} style={{ transformOrigin: `0 0 0` }} ref={ref}>\n      <Paper\n        elevation={8}\n        ref={paperRef}\n        className={classes.paper}\n        style={{ ...position }}\n      >\n        {ListContents}\n      </Paper>\n    </Grow>\n  )\n})\n\ninterface MenuProps extends PopoverProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n}\n\nfunction Menu(props: MenuProps) {\n  const { open, onClose, menuItems, onMenuItemClick, ...other } = props\n\n  return (\n    <Popover\n      transitionDuration={0}\n      open={open}\n      onClose={onClose}\n      BackdropProps={{ invisible: true }}\n      {...other}\n    >\n      <MenuPage\n        open={open}\n        onClose={onClose}\n        menuItems={menuItems}\n        onMenuItemClick={onMenuItemClick}\n        top\n      />\n    </Popover>\n  )\n}\n\nexport default Menu\n","export interface Mismatch {\n  qual?: number\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\n\nexport function parseCigar(cigar: string) {\n  return (cigar || '').split(/([MIDNSHPX=])/)\n}\nexport function cigarToMismatches(\n  ops: string[],\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let currOffset = 0\n  let seqOffset = 0\n  const mismatches: Mismatch[] = []\n  for (let i = 0; i < ops.length - 1; i += 2) {\n    const len = +ops[i]\n    const op = ops[i + 1]\n    if (op === 'M' || op === '=' || op === 'E') {\n      seqOffset += len\n    }\n    if (op === 'I') {\n      mismatches.push({\n        start: currOffset,\n        type: 'insertion',\n        base: `${len}`,\n        length: 0,\n      })\n      seqOffset += len\n    } else if (op === 'D') {\n      mismatches.push({\n        start: currOffset,\n        type: 'deletion',\n        base: '*',\n        length: len,\n      })\n    } else if (op === 'N') {\n      mismatches.push({\n        start: currOffset,\n        type: 'skip',\n        base: 'N',\n        length: len,\n      })\n    } else if (op === 'X') {\n      const r = seq.slice(seqOffset, seqOffset + len)\n      const q = qual?.slice(seqOffset, seqOffset + len) || []\n\n      for (let j = 0; j < len; j++) {\n        mismatches.push({\n          start: currOffset + j,\n          type: 'mismatch',\n          base: r[j],\n          qual: q[j],\n          length: 1,\n        })\n      }\n      seqOffset += len\n    } else if (op === 'H') {\n      mismatches.push({\n        start: currOffset,\n        type: 'hardclip',\n        base: `H${len}`,\n        cliplen: len,\n        length: 1,\n      })\n    } else if (op === 'S') {\n      mismatches.push({\n        start: currOffset,\n        type: 'softclip',\n        base: `S${len}`,\n        cliplen: len,\n        length: 1,\n      })\n      seqOffset += len\n    }\n\n    if (op !== 'I' && op !== 'S' && op !== 'H') {\n      currOffset += len\n    }\n  }\n  return mismatches\n}\n\n/**\n * parse a SAM MD tag to find mismatching bases of the template versus the reference\n * @returns array of mismatches and their positions\n */\nexport function mdToMismatches(\n  mdstring: string,\n  cigarOps: string[],\n  cigarMismatches: Mismatch[],\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  const mismatchRecords: Mismatch[] = []\n  let curr: Mismatch = { start: 0, base: '', length: 0, type: 'mismatch' }\n  const skips = cigarMismatches.filter(cigar => cigar.type === 'skip')\n  let lastCigar = 0\n  let lastTemplateOffset = 0\n  let lastRefOffset = 0\n  let lastSkipPos = 0\n\n  // convert a position on the reference sequence to a position\n  // on the template sequence, taking into account hard and soft\n  // clipping of reads\n\n  function nextRecord(): void {\n    mismatchRecords.push(curr)\n\n    // get a new mismatch record ready\n    curr = {\n      start: curr.start + curr.length,\n      length: 0,\n      base: '',\n      type: 'mismatch',\n    }\n  }\n\n  function getTemplateCoordLocal(refCoord: number): number {\n    let templateOffset = lastTemplateOffset\n    let refOffset = lastRefOffset\n    for (\n      let i = lastCigar;\n      i < cigarOps.length && refOffset <= refCoord;\n      i += 2, lastCigar = i\n    ) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        templateOffset += len\n      } else if (op === 'D' || op === 'P' || op === 'N') {\n        refOffset += len\n      } else if (op !== 'H') {\n        templateOffset += len\n        refOffset += len\n      }\n    }\n    lastTemplateOffset = templateOffset\n    lastRefOffset = refOffset\n\n    return templateOffset - (refOffset - refCoord)\n  }\n\n  // now actually parse the MD string\n  const md = mdstring.match(/(\\d+|\\^[a-z]+|[a-z])/gi) || []\n  for (let i = 0; i < md.length; i++) {\n    const token = md[i]\n    if (token.match(/^\\d/)) {\n      curr.start += parseInt(token, 10)\n    } else if (token.match(/^\\^/)) {\n      curr.length = token.length - 1\n      curr.base = '*'\n      curr.type = 'deletion'\n      curr.seq = token.substring(1)\n      nextRecord()\n    } else if (token.match(/^[a-z]/i)) {\n      // mismatch\n      for (let j = 0; j < token.length; j += 1) {\n        curr.length = 1\n\n        while (lastSkipPos < skips.length) {\n          const mismatch = skips[lastSkipPos]\n          if (curr.start >= mismatch.start) {\n            curr.start += mismatch.length\n            lastSkipPos++\n          } else {\n            break\n          }\n        }\n        const s = cigarOps ? getTemplateCoordLocal(curr.start) : curr.start\n        curr.base = seq ? seq.substr(s, 1) : 'X'\n        const qualScore = qual?.slice(s, s + 1)[0]\n        if (qualScore) {\n          curr.qual = qualScore\n        }\n        curr.altbase = token\n        nextRecord()\n      }\n    }\n  }\n  return mismatchRecords\n}\n\nexport function getTemplateCoord(refCoord: number, cigarOps: string[]): number {\n  let templateOffset = 0\n  let refOffset = 0\n  for (let i = 0; i < cigarOps.length && refOffset <= refCoord; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'S' || op === 'I') {\n      templateOffset += len\n    } else if (op === 'D' || op === 'P') {\n      refOffset += len\n    } else if (op !== 'H') {\n      templateOffset += len\n      refOffset += len\n    }\n  }\n  return templateOffset - (refOffset - refCoord)\n}\n\nexport function getMismatches(\n  cigarString: string,\n  mdString: string,\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let mismatches: Mismatch[] = []\n  let cigarOps: string[] = []\n\n  // parse the CIGAR tag if it has one\n  if (cigarString) {\n    cigarOps = parseCigar(cigarString)\n    mismatches = mismatches.concat(cigarToMismatches(cigarOps, seq, qual))\n  }\n\n  // now let's look for CRAM or MD mismatches\n  if (mdString) {\n    mismatches = mismatches.concat(\n      mdToMismatches(mdString, cigarOps, mismatches, seq, qual),\n    )\n  }\n\n  // uniqify the mismatches\n  const seen: { [index: string]: boolean } = {}\n  return mismatches.filter(m => {\n    const key = `${m.type},${m.start},${m.length}`\n    const s = seen[key]\n    seen[key] = true\n    return !s\n  })\n}\n\n// adapted from minimap2 code static void write_MD_core function\nexport function generateMD(target: string, query: string, cigar: string) {\n  let queryOffset = 0\n  let targetOffset = 0\n  let lengthMD = 0\n  if (!target) {\n    console.warn('no ref supplied to generateMD')\n    return ''\n  }\n  const cigarOps = parseCigar(cigar)\n  let str = ''\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'M' || op === 'X' || op === '=') {\n      for (let j = 0; j < len; j++) {\n        if (\n          query[queryOffset + j].toLowerCase() !==\n          target[targetOffset + j].toLowerCase()\n        ) {\n          str += `${lengthMD}${target[targetOffset + j].toUpperCase()}`\n          lengthMD = 0\n        } else {\n          lengthMD++\n        }\n      }\n      queryOffset += len\n      targetOffset += len\n    } else if (op === 'I') {\n      queryOffset += len\n    } else if (op === 'D') {\n      let tmp = ''\n      for (let j = 0; j < len; j++) {\n        tmp += target[targetOffset + j].toUpperCase()\n      }\n      str += `${lengthMD}^${tmp}`\n      lengthMD = 0\n      targetOffset += len\n    } else if (op === 'N') {\n      targetOffset += len\n    } else if (op === 'S') {\n      queryOffset += len\n    }\n  }\n  if (lengthMD > 0) {\n    str += lengthMD\n  }\n  return str\n}\n\n// get relative reference sequence positions for positions given relative to\n// the read sequence\nexport function* getNextRefPos(cigarOps: string[], positions: number[]) {\n  let cigarIdx = 0\n  let readPos = 0\n  let refPos = 0\n\n  for (let i = 0; i < positions.length; i++) {\n    const pos = positions[i]\n    for (; cigarIdx < cigarOps.length && readPos < pos; cigarIdx += 2) {\n      const len = +cigarOps[cigarIdx]\n      const op = cigarOps[cigarIdx + 1]\n      if (op === 'S' || op === 'I') {\n        readPos += len\n      } else if (op === 'D' || op === 'N') {\n        refPos += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        readPos += len\n        refPos += len\n      }\n    }\n\n    yield positions[i] - readPos + refPos\n  }\n}\n\nexport function getModificationPositions(mm: string, seq: string) {\n  const mods = mm.split(';')\n  return mods\n    .filter(mod => !!mod)\n    .map(mod => {\n      const [basemod, ...rest] = mod.split(',')\n\n      // regexes based on parse_mm.pl from hts-specs\n      const matches = basemod.match(/([A-Z])([-+])([^,]+)/)\n      if (!matches) {\n        throw new Error('bad format for MM tag')\n      }\n      const [, base, strand, typestr] = matches\n\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      const types = typestr.split(/(\\d+|.)/).filter(f => !!f)\n\n      if (strand === '-') {\n        console.warn('unsupported negative strand modifications')\n        // make sure to return a somewhat matching type even in this case\n        return { type: 'unsupported', positions: [] }\n      }\n\n      // this logic also based on parse_mm.pl from hts-specs is that in the\n      // sequence of the read, if we have a modification type e.g. C+m;2 and a\n      // sequence ACGTACGTAC we skip the two instances of C and go to the last\n      // C\n      return types.map(type => {\n        let i = 0\n        return {\n          type,\n          positions: rest\n            .map(score => +score)\n            .map(delta => {\n              i++\n              do {\n                if (base === 'N' || base === seq[i]) {\n                  delta--\n                }\n                i++\n              } while (delta >= 0 && i < seq.length)\n              i--\n              return i\n            }),\n        }\n      })\n    })\n    .flat()\n}\n\nexport function getModificationTypes(mm: string) {\n  const mods = mm.split(';')\n  return mods\n    .filter(mod => !!mod)\n    .map(mod => {\n      const [basemod] = mod.split(',')\n\n      const matches = basemod.match(/([A-Z])([-+])([^,]+)/)\n      if (!matches) {\n        throw new Error('bad format for MM tag')\n      }\n      const [, , , typestr] = matches\n\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      return typestr.split(/(\\d+|.)/).filter(f => !!f)\n    })\n    .flat()\n}\n","import { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport DisplayType from './DisplayType'\n\ntype BasicView = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  model: any\n  session?: IAnyStateTreeNode\n}>\ntype ViewReactComponent = React.LazyExoticComponent<BasicView> | BasicView\n\nexport default class ViewType extends PluggableElementBase {\n  ReactComponent: ViewReactComponent\n\n  stateModel: IAnyModelType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: ViewReactComponent\n    stateModel: IAnyModelType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for view ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for view ${this.name}`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import {\n  isStateTreeNode,\n  Instance,\n  SnapshotOut,\n  SnapshotIn,\n  IAnyStateTreeNode,\n} from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\n\nimport assemblyManager from '../../assemblyManager'\nimport { MenuItem } from '../../ui'\nimport {\n  NoAssemblyRegion as MUNoAssemblyRegion,\n  Region as MUIRegion,\n  LocalPathLocation as MULocalPathLocation,\n  UriLocation as MUUriLocation,\n  BlobLocation as MUBlobLocation,\n} from './mst'\nimport RpcManager from '../../rpc/RpcManager'\nimport { Feature } from '../simpleFeature'\n\nexport * from './util'\n\n/** abstract type for a model that contains multiple views */\nexport interface AbstractViewContainer {\n  views: AbstractViewModel[]\n  removeView(view: AbstractViewModel): void\n  addView(typeName: string, initialState: Record<string, unknown>): void\n}\nexport function isViewContainer(\n  thing: unknown,\n): thing is AbstractViewContainer {\n  return (\n    isStateTreeNode(thing) &&\n    'removeView' in thing &&\n    'addView' in thing &&\n    'views' in thing\n  )\n}\n\nexport type NotificationLevel = 'error' | 'info' | 'warning' | 'success'\n\nexport type AssemblyManager = Instance<ReturnType<typeof assemblyManager>>\n\nexport interface BasePlugin {\n  version?: string\n  name: string\n  url?: string\n}\n\nexport interface JBrowsePlugin {\n  name: string\n  authors: string[]\n  description: string\n  location: string\n  url: string\n  license: string\n  image?: string\n}\n\nexport type DialogComponentType =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  | React.LazyExoticComponent<React.FC<any>>\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  | React.FC<any>\n\n/** minimum interface that all session state models must implement */\nexport interface AbstractSessionModel extends AbstractViewContainer {\n  setSelection(feature: Feature): void\n  clearSelection(): void\n  configuration: AnyConfigurationModel\n  rpcManager: RpcManager\n  assemblyNames: string[]\n  assemblies: AnyConfigurationModel[]\n  selection?: unknown\n  duplicateCurrentSession?(): void\n  notify(message: string, level?: NotificationLevel): void\n  assemblyManager: AssemblyManager\n  version: string\n  getTrackActionMenuItems?: Function\n  addAssembly?: Function\n  removeAssembly?: Function\n  connections: AnyConfigurationModel[]\n  deleteConnection?: Function\n  sessionConnections?: AnyConfigurationModel[]\n  connectionInstances?: { name: string }[]\n  makeConnection?: Function\n  adminMode?: boolean\n  showWidget?: Function\n  addWidget?: Function\n\n  addTrackConf?: Function\n  DialogComponent?: DialogComponentType\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  DialogProps: any\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  setDialogComponent: (dlg?: DialogComponentType, props?: any) => void\n}\nexport function isSessionModel(thing: unknown): thing is AbstractSessionModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'rpcManager' in thing &&\n    'configuration' in thing\n  )\n}\n\n/** abstract interface for a session allows editing configurations */\nexport interface SessionWithConfigEditing extends AbstractSessionModel {\n  editConfiguration(configuration: AnyConfigurationModel): void\n}\nexport function isSessionModelWithConfigEditing(\n  thing: unknown,\n): thing is SessionWithConfigEditing {\n  return isSessionModel(thing) && 'editConfiguration' in thing\n}\n\n/** abstract interface for a session that manages widgets */\nexport interface SessionWithWidgets extends AbstractSessionModel {\n  visibleWidget?: { id: string }\n  widgets?: unknown[]\n  addWidget(\n    typeName: string,\n    id: string,\n    initialState?: Record<string, unknown>,\n    configuration?: { type: string },\n  ): void\n  showWidget(widget: unknown): void\n}\nexport function isSessionModelWithWidgets(\n  thing: unknown,\n): thing is SessionWithWidgets {\n  return isSessionModel(thing) && 'widgets' in thing\n}\n\nexport interface SessionWithSessionPlugins extends AbstractSessionModel {\n  sessionPlugins: JBrowsePlugin[]\n  addSessionPlugin: Function\n  removeSessionPlugin: Function\n}\nexport function isSessionWithSessionPlugins(\n  thing: unknown,\n): thing is SessionWithSessionPlugins {\n  return isSessionModel(thing) && 'sessionPlugins' in thing\n}\n\n/** abstract interface for a session that manages a global selection */\nexport interface SelectionContainer extends AbstractSessionModel {\n  selection?: unknown\n  setSelection(thing: unknown): void\n}\nexport function isSelectionContainer(\n  thing: unknown,\n): thing is SelectionContainer {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'selection' in thing &&\n    'setSelection' in thing\n  )\n}\n\n/** minimum interface that all view state models must implement */\nexport interface AbstractViewModel {\n  id: string\n  type: string\n  width: number\n  setWidth(width: number): void\n}\nexport function isViewModel(thing: unknown): thing is AbstractViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'width' in thing &&\n    'setWidth' in thing\n  )\n}\n\ntype AbstractTrackModel = {}\nexport function isTrackModel(thing: unknown): thing is AbstractTrackModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-ignore\n    thing.configuration.trackId\n  )\n}\n\nexport interface AbstractDisplayModel {\n  id: string\n  parentTrack: AbstractTrackModel\n  renderDelay: number\n  rendererType: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  cannotBeRenderedReason?: string\n}\nexport function isDisplayModel(thing: unknown): thing is AbstractDisplayModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-ignore\n    thing.configuration.displayId\n  )\n}\n\nexport interface TrackViewModel extends AbstractViewModel {\n  showTrack(trackId: string): void\n  hideTrack(trackId: string): void\n}\nexport function isTrackViewModel(thing: unknown): thing is TrackViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'showTrack' in thing &&\n    'hideTrack' in thing\n  )\n}\n\n/** minimum interface for the root MST model of a JBrowse app */\nexport interface AbstractRootModel {\n  jbrowse: IAnyStateTreeNode\n  session?: AbstractSessionModel\n  setDefaultSession?(): void\n  adminMode?: boolean\n}\n\n/** root model with more included for the heavier JBrowse web and desktop app */\nexport interface AppRootModel extends AbstractRootModel {\n  isAssemblyEditing: boolean\n  isDefaultSessionEditing: boolean\n  setAssemblyEditing: (arg: boolean) => boolean\n  setDefaultSessionEditing: (arg: boolean) => boolean\n}\n\n/** a root model that manages global menus */\nexport interface AbstractMenuManager {\n  appendMenu(menuName: string): void\n  insertMenu(menuName: string, position: number): number\n  insertInMenu(menuName: string, menuItem: MenuItem, position: number): number\n  appendToMenu(menuName: string, menuItem: MenuItem): number\n  appendToSubMenu(menuPath: string[], menuItem: MenuItem): number\n  insertInSubMenu(\n    menuPath: string[],\n    menuItem: MenuItem,\n    position: number,\n  ): number\n}\nexport function isAbstractMenuManager(\n  thing: unknown,\n): thing is AbstractMenuManager {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'appendMenu' in thing &&\n    'appendToSubMenu' in thing\n  )\n}\n\n// Empty interfaces required by mobx-state-tree\n// See https://mobx-state-tree.js.org/tips/typescript#using-a-mst-type-at-design-time\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nexport interface NoAssemblyRegion\n  extends SnapshotIn<typeof MUNoAssemblyRegion> {}\n\nexport interface Region extends SnapshotIn<typeof MUIRegion> {}\n\nexport interface LocalPathLocation\n  extends SnapshotIn<typeof MULocalPathLocation> {}\n\nexport interface UriLocation extends SnapshotIn<typeof MUUriLocation> {}\n\nexport interface BlobLocation extends SnapshotIn<typeof MUBlobLocation> {}\n\nexport type FileLocation = LocalPathLocation | UriLocation | BlobLocation\n\n/* eslint-enable @typescript-eslint/no-empty-interface */\n\n// These types are slightly different than the MST models representing a\n// location because a blob cannot be stored in a MST, so this is the\n// pre-processed file location\nexport type PreUriLocation = { uri: string }\nexport type PreLocalPathLocation = { localPath: string }\nexport type PreBlobLocation = { blob: File }\nexport type PreFileLocation =\n  | PreUriLocation\n  | PreLocalPathLocation\n  | PreBlobLocation\n","import React, { useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  Checkbox,\n  FormControlLabel,\n  CircularProgress,\n  Typography,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { LinearGenomeViewModel as LGV } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nexport default function ExportSvgDlg({\n  model,\n  handleClose,\n}: {\n  model: LGV\n  handleClose: () => void\n}) {\n  const [rasterizeLayers, setRasterizeLayers] = useState(\n    typeof OffscreenCanvas !== 'undefined',\n  )\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<Error>()\n  const classes = useStyles()\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Export SVG\n        <IconButton className={classes.closeButton} onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {error ? (\n          <div style={{ color: 'red' }}>{`${error}`}</div>\n        ) : loading ? (\n          <div>\n            <CircularProgress size={20} style={{ marginRight: 20 }} />\n            <Typography display=\"inline\">Creating SVG</Typography>\n          </div>\n        ) : null}\n\n        {typeof OffscreenCanvas !== 'undefined' ? (\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={rasterizeLayers}\n                onChange={() => setRasterizeLayers(val => !val)}\n              />\n            }\n            label=\"Rasterize canvas based tracks? File may be much larger if this is turned off\"\n          />\n        ) : (\n          <Typography>\n            Note: rasterizing layers not yet supported in this browser, so SVG\n            size may be large\n          </Typography>\n        )}\n\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          onClick={async () => {\n            setLoading(true)\n            setError(undefined)\n            try {\n              await model.exportSvg({ rasterizeLayers })\n              handleClose()\n            } catch (e) {\n              setError(e)\n            } finally {\n              setLoading(false)\n            }\n          }}\n        >\n          Submit\n        </Button>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  IconButton,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nconst useStyles = makeStyles(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction ReturnToImportFormDialog({\n  model,\n  handleClose,\n}: {\n  model: { clearView: Function }\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  return (\n    <Dialog maxWidth=\"xl\" open onClose={handleClose}>\n      <DialogTitle>\n        Reference sequence\n        {handleClose ? (\n          <IconButton\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n\n      <DialogContent>\n        Are you sure you want to return to the import form? This will lose your\n        current view\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            model.clearView()\n            handleClose()\n          }}\n          variant=\"contained\"\n          color=\"primary\"\n          autoFocus\n        >\n          OK\n        </Button>\n        <Button\n          onClick={() => {\n            handleClose()\n          }}\n          color=\"secondary\"\n          variant=\"contained\"\n          autoFocus\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(ReturnToImportFormDialog)\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { Region } from '@jbrowse/core/util/types'\nimport { ElementId, Region as MUIRegion } from '@jbrowse/core/util/types/mst'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  assembleLocString,\n  clamp,\n  findLastIndex,\n  getContainingView,\n  getSession,\n  isViewContainer,\n  parseLocString,\n  springAnimate,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BlockSet, BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport calculateStaticBlocks from '@jbrowse/core/util/calculateStaticBlocks'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\n// misc\nimport { transaction, autorun } from 'mobx'\nimport {\n  getSnapshot,\n  types,\n  cast,\n  Instance,\n  getRoot,\n  resolveIdentifier,\n  addDisposer,\n} from 'mobx-state-tree'\n\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport SyncAltIcon from '@material-ui/icons/SyncAlt'\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport LabelIcon from '@material-ui/icons/Label'\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen'\nimport clone from 'clone'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { saveAs } from 'file-saver'\nimport { renderToSvg } from './components/LinearGenomeView'\nimport ExportSvgDlg from './components/ExportSvgDialog'\nimport ReturnToImportFormDlg from './components/ReturnToImportFormDialog'\n\nexport { default as ReactComponent } from './components/LinearGenomeView'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n  coord?: number\n  reversed?: boolean\n  assemblyName?: string\n  oob?: boolean\n}\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n}\n\nfunction calculateVisibleLocStrings(contentBlocks: BaseBlock[]) {\n  if (!contentBlocks.length) {\n    return ''\n  }\n  const isSingleAssemblyName = contentBlocks.every(\n    block => block.assemblyName === contentBlocks[0].assemblyName,\n  )\n  const locs = contentBlocks.map(block =>\n    assembleLocString({\n      ...block,\n      start: Math.round(block.start),\n      end: Math.round(block.end),\n      assemblyName: isSingleAssemblyName ? undefined : block.assemblyName,\n    }),\n  )\n  return locs.join(';')\n}\n\nexport interface NavLocation {\n  refName: string\n  start?: number\n  end?: number\n  assemblyName?: string\n}\n\nexport const HEADER_BAR_HEIGHT = 48\nexport const HEADER_OVERVIEW_HEIGHT = 20\nexport const SCALE_BAR_HEIGHT = 17\nexport const RESIZE_HANDLE_HEIGHT = 3\nexport const INTER_REGION_PADDING_WIDTH = 2\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const model = types\n    .model('LinearGenomeView', {\n      id: ElementId,\n      type: types.literal('LinearGenomeView'),\n      offsetPx: 0,\n      bpPerPx: 1,\n      displayedRegions: types.array(MUIRegion),\n      // we use an array for the tracks because the tracks are displayed in a specific\n      // order that we need to keep.\n      tracks: types.array(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n      hideHeader: false,\n      hideHeaderOverview: false,\n      trackSelectorType: types.optional(\n        types.enumeration(['hierarchical']),\n        'hierarchical',\n      ),\n      trackLabels: 'overlapping' as 'overlapping' | 'hidden' | 'offset',\n      showCenterLine: false,\n    })\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      minimumBlockWidth: 3,\n      draggingTrackId: undefined as undefined | string,\n      error: undefined as undefined | Error,\n\n      // array of callbacks to run after the next set of the displayedRegions,\n      // which is basically like an onLoad\n      afterDisplayedRegionsSetCallbacks: [] as Function[],\n      scaleFactor: 1,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      trackRefs: {} as { [key: string]: any },\n      coarseDynamicBlocks: [] as BaseBlock[],\n      coarseTotalBp: 0,\n      leftOffset: undefined as undefined | BpOffset,\n      rightOffset: undefined as undefined | BpOffset,\n    }))\n    .views(self => ({\n      get width(): number {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'width undefined, make sure to check for model.initialized',\n          )\n        }\n        return self.volatileWidth\n      },\n    }))\n    .views(self => ({\n      get initialized() {\n        const { assemblyManager } = getSession(self)\n\n        // if the assemblyManager is tracking a given assembly name, wait for\n        // it to be loaded. this is done by looking in the assemblyManager's\n        // assembly list, and then waiting on it's initialized state which is\n        // updated later\n        const assembliesInitialized = this.assemblyNames.every(assemblyName => {\n          if (\n            assemblyManager.assemblyList\n              ?.map(asm => asm.name)\n              .includes(assemblyName)\n          ) {\n            return (assemblyManager.get(assemblyName) || {}).initialized\n          }\n          return true\n        })\n\n        return self.volatileWidth !== undefined && assembliesInitialized\n      },\n      get hasDisplayedRegions() {\n        return self.displayedRegions.length > 0\n      },\n      get isSeqDialogDisplayed() {\n        return self.leftOffset && self.rightOffset\n      },\n      get scaleBarHeight() {\n        return SCALE_BAR_HEIGHT + RESIZE_HANDLE_HEIGHT\n      },\n      get headerHeight() {\n        if (self.hideHeader) {\n          return 0\n        }\n        if (self.hideHeaderOverview) {\n          return HEADER_BAR_HEIGHT\n        }\n        return HEADER_BAR_HEIGHT + HEADER_OVERVIEW_HEIGHT\n      },\n      get trackHeights() {\n        return self.tracks\n          .map(t => t.displays[0].height)\n          .reduce((a, b) => a + b, 0)\n      },\n\n      get trackHeightsWithResizeHandles() {\n        return this.trackHeights + self.tracks.length * RESIZE_HANDLE_HEIGHT\n      },\n      get height() {\n        return (\n          this.trackHeightsWithResizeHandles +\n          this.headerHeight +\n          this.scaleBarHeight\n        )\n      },\n      get interRegionPaddingWidth() {\n        return INTER_REGION_PADDING_WIDTH\n      },\n      get totalBp() {\n        let totalbp = 0\n        self.displayedRegions.forEach(region => {\n          totalbp += region.end - region.start\n        })\n        return totalbp\n      },\n\n      get maxBpPerPx() {\n        return this.totalBp / (self.width * 0.9)\n      },\n\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      get maxOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const leftPadding = 10\n        return this.displayedRegionsTotalPx - leftPadding\n      },\n      get displayedParentRegions() {\n        const wholeRefSeqs = [] as Region[]\n        const { assemblyManager } = getSession(self)\n        self.displayedRegions.forEach(({ refName, assemblyName }) => {\n          const assembly = assemblyManager.get(assemblyName)\n          const r = assembly && (assembly.regions as Region[])\n          if (r) {\n            const wholeSequence = r.find(\n              sequence => sequence.refName === refName,\n            )\n            const alreadyExists = wholeRefSeqs.find(\n              sequence => sequence.refName === refName,\n            )\n            if (wholeSequence && !alreadyExists) {\n              wholeRefSeqs.push(wholeSequence)\n            }\n          }\n        })\n        return wholeRefSeqs\n      },\n\n      get displayedParentRegionsLength() {\n        return this.displayedParentRegions\n          .map(a => a.end - a.start)\n          .reduce((a, b) => a + b, 0)\n      },\n      get minOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const rightPadding = 30\n        return -self.width + rightPadding\n      },\n\n      get displayedRegionsTotalPx() {\n        return this.totalBp / self.bpPerPx\n      },\n\n      get renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          bpPerPx: self.bpPerPx,\n          highResolutionScaling: getConf(\n            getSession(self),\n            'highResolutionScaling',\n          ),\n        }\n      },\n      get assemblyNames() {\n        return [\n          ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n        ]\n      },\n      parentRegion(assemblyName: string, refName: string) {\n        return this.displayedParentRegions.find(\n          parentRegion =>\n            parentRegion.assemblyName === assemblyName &&\n            parentRegion.refName === refName,\n        )\n      },\n      /**\n       * @param refName - refName of the displayedRegion\n       * @param coord - coordinate at the displayed Region\n       * @param regionNumber - optional param used as identifier when\n       * there are multiple displayedRegions with the same refName\n       * @returns offsetPx of the displayed region that it lands in\n       */\n      bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      }: {\n        refName: string\n        coord: number\n        regionNumber?: number\n      }) {\n        let offsetBp = 0\n\n        const interRegionPaddingBp = this.interRegionPaddingWidth * self.bpPerPx\n        const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n        const index = self.displayedRegions.findIndex((region, idx) => {\n          const len = region.end - region.start\n          if (\n            refName === region.refName &&\n            coord >= region.start &&\n            coord <= region.end\n          ) {\n            if (regionNumber ? regionNumber === idx : true) {\n              offsetBp += region.reversed\n                ? region.end - coord\n                : coord - region.start\n              return true\n            }\n          }\n\n          // add the interRegionPaddingWidth if the boundary is in the screen\n          // e.g. offset>=0 && offset<width\n          if (\n            len > minimumBlockBp &&\n            offsetBp / self.bpPerPx >= 0 &&\n            offsetBp / self.bpPerPx < self.width\n          ) {\n            offsetBp += len + interRegionPaddingBp\n          } else {\n            offsetBp += len\n          }\n          return false\n        })\n        const foundRegion = self.displayedRegions[index]\n        if (foundRegion) {\n          return {\n            index,\n            offsetPx: Math.round(offsetBp / self.bpPerPx),\n          }\n        }\n\n        return undefined\n      },\n      /**\n       *\n       * @param px - px in the view area, return value is the displayed regions\n       * @returns BpOffset of the displayed region that it lands in\n       */\n      pxToBp(px: number) {\n        let bpSoFar = 0\n        const bp = (self.offsetPx + px) * self.bpPerPx\n        const n = self.displayedRegions.length\n        if (bp < 0) {\n          const region = self.displayedRegions[0]\n          const offset = bp\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            offset,\n            index: 0,\n          }\n        }\n\n        const interRegionPaddingBp = this.interRegionPaddingWidth * self.bpPerPx\n        const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n\n        for (let index = 0; index < self.displayedRegions.length; index += 1) {\n          const region = self.displayedRegions[index]\n          const len = region.end - region.start\n          const offset = bp - bpSoFar\n          if (len + bpSoFar > bp && bpSoFar <= bp) {\n            return {\n              ...getSnapshot(region),\n              oob: false,\n              offset,\n              coord: region.reversed\n                ? Math.floor(region.end - offset) + 1\n                : Math.floor(region.start + offset) + 1,\n              index,\n            }\n          }\n\n          // add the interRegionPaddingWidth if the boundary is in the screen\n          // e.g. offset>0 && offset<width\n          if (\n            region.end - region.start > minimumBlockBp &&\n            offset / self.bpPerPx > 0 &&\n            offset / self.bpPerPx < self.width\n          ) {\n            bpSoFar += len + interRegionPaddingBp\n          } else {\n            bpSoFar += len\n          }\n        }\n\n        if (bp >= bpSoFar) {\n          const region = self.displayedRegions[n - 1]\n          const len = region.end - region.start\n          const offset = bp - bpSoFar + len\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            offset,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            index: n - 1,\n          }\n        }\n        return {\n          coord: 0,\n          index: 0,\n          refName: '',\n          oob: true,\n          assemblyName: '',\n          offset: 0,\n          start: 0,\n          end: 0,\n          reversed: false,\n        }\n      },\n\n      getTrack(id: string) {\n        return self.tracks.find(t => t.configuration.trackId === id)\n      },\n\n      // modifies view menu action onClick to apply to all tracks of same type\n      rewriteOnClicks(trackType: string, viewMenuActions: MenuItem[]) {\n        viewMenuActions.forEach((action: MenuItem) => {\n          // go to lowest level menu\n          if ('subMenu' in action) {\n            this.rewriteOnClicks(trackType, action.subMenu)\n          }\n          if ('onClick' in action) {\n            const holdOnClick = action.onClick\n            action.onClick = (...args: unknown[]) => {\n              self.tracks.forEach(track => {\n                if (track.type === trackType) {\n                  holdOnClick.apply(track, [track, ...args])\n                }\n              })\n            }\n          }\n        })\n      },\n\n      get trackTypeActions() {\n        const allActions: Map<string, MenuItem[]> = new Map()\n        self.tracks.forEach(track => {\n          const trackInMap = allActions.get(track.type)\n          if (!trackInMap) {\n            const viewMenuActions = clone(track.viewMenuActions)\n            this.rewriteOnClicks(track.type, viewMenuActions)\n            allActions.set(track.type, viewMenuActions)\n          }\n        })\n\n        return allActions\n      },\n\n      get centerLineInfo() {\n        return self.displayedRegions.length\n          ? this.pxToBp(self.width / 2)\n          : undefined\n      },\n    }))\n    .actions(self => ({\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n      },\n      setError(error: Error | undefined) {\n        self.error = error\n      },\n\n      toggleHeader() {\n        self.hideHeader = !self.hideHeader\n      },\n\n      toggleHeaderOverview() {\n        self.hideHeaderOverview = !self.hideHeaderOverview\n      },\n\n      scrollTo(offsetPx: number) {\n        const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n        self.offsetPx = newOffsetPx\n        return newOffsetPx\n      },\n\n      zoomTo(bpPerPx: number) {\n        const newBpPerPx = clamp(bpPerPx, self.minBpPerPx, self.maxBpPerPx)\n        if (newBpPerPx === self.bpPerPx) {\n          return newBpPerPx\n        }\n        const oldBpPerPx = self.bpPerPx\n        self.bpPerPx = newBpPerPx\n\n        if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n          console.warn('zoomTo bpPerPx rounding error')\n          return oldBpPerPx\n        }\n\n        // tweak the offset so that the center of the view remains at the same coordinate\n        const viewWidth = self.width\n        this.scrollTo(\n          Math.round(\n            ((self.offsetPx + viewWidth / 2) * oldBpPerPx) / newBpPerPx -\n              viewWidth / 2,\n          ),\n        )\n        return newBpPerPx\n      },\n\n      setOffsets(left: undefined | BpOffset, right: undefined | BpOffset) {\n        // sets offsets used in the get sequence dialog\n        self.leftOffset = left\n        self.rightOffset = right\n      },\n\n      setNewView(bpPerPx: number, offsetPx: number) {\n        this.zoomTo(bpPerPx)\n        this.scrollTo(offsetPx)\n      },\n\n      horizontallyFlip() {\n        self.displayedRegions = cast(\n          self.displayedRegions\n            .slice()\n            .reverse()\n            .map(region => ({ ...region, reversed: !region.reversed })),\n        )\n        this.scrollTo(self.totalBp / self.bpPerPx - self.offsetPx - self.width)\n      },\n\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n        return track\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n          'track',\n        )\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n    }))\n    .actions(self => ({\n      moveTrack(movingTrackId: string, targetTrackId: string) {\n        const oldIndex = self.tracks.findIndex(\n          track => track.id === movingTrackId,\n        )\n        if (oldIndex === -1) {\n          throw new Error(`Track ID ${movingTrackId} not found`)\n        }\n        const newIndex = self.tracks.findIndex(\n          track => track.id === targetTrackId,\n        )\n        if (newIndex === -1) {\n          throw new Error(`Track ID ${targetTrackId} not found`)\n        }\n        const track = getSnapshot(self.tracks[oldIndex])\n        self.tracks.splice(oldIndex, 1)\n        self.tracks.splice(newIndex, 0, track)\n      },\n\n      closeView() {\n        const parent = getContainingView(self)\n        if (parent) {\n          // I am embedded in a some other view\n          if (isViewContainer(parent)) {\n            parent.removeView(self)\n          }\n        } else {\n          // I am part of a session\n          getSession(self).removeView(self)\n        }\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = self.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          self.showTrack(trackId)\n        }\n      },\n\n      setTrackLabels(setting: 'overlapping' | 'offset' | 'hidden') {\n        self.trackLabels = setting\n      },\n\n      toggleCenterLine() {\n        self.showCenterLine = !self.showCenterLine\n      },\n\n      setDisplayedRegions(regions: Region[]) {\n        self.displayedRegions = cast(regions)\n        self.zoomTo(self.bpPerPx)\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n      navToLocString(locString: string, optAssemblyName?: string) {\n        const { assemblyManager } = getSession(self)\n        const { isValidRefName } = assemblyManager\n        const locStrings = locString.split(';')\n        if (self.displayedRegions.length > 1) {\n          const locations = locStrings.map(ls =>\n            parseLocString(ls, isValidRefName),\n          )\n          this.navToMultiple(locations)\n          return\n        }\n        let assemblyName = optAssemblyName\n        let defaultRefName = ''\n        if (self.displayedRegions.length !== 0) {\n          // defaults\n          assemblyName = self.displayedRegions[0].assemblyName\n          defaultRefName = self.displayedRegions[0].refName\n        }\n        let assembly = assemblyName && assemblyManager.get(assemblyName)\n        if (!assembly) {\n          throw new Error(`Could not find assembly ${assemblyName}`)\n        }\n        let { regions } = assembly\n        if (!regions) {\n          throw new Error(`Regions for assembly ${assemblyName} not yet loaded`)\n        }\n        if (locStrings.length > 1) {\n          throw new Error(\n            'Navigating to multiple locations is not allowed when viewing a whole chromosome',\n          )\n        }\n        const parsedLocString = parseLocString(locStrings[0], refName =>\n          isValidRefName(refName, assemblyName),\n        )\n        let changedAssembly = false\n        if (\n          parsedLocString.assemblyName &&\n          parsedLocString.assemblyName !== assemblyName\n        ) {\n          const newAssembly = assemblyManager.get(parsedLocString.assemblyName)\n          if (!newAssembly) {\n            throw new Error(\n              `Could not find assembly ${parsedLocString.assemblyName}`,\n            )\n          }\n          assembly = newAssembly\n          changedAssembly = true\n          const newRegions = newAssembly.regions\n          if (!newRegions) {\n            throw new Error(\n              `Regions for assembly ${parsedLocString.assemblyName} not yet loaded`,\n            )\n          }\n          regions = newRegions\n        }\n        const canonicalRefName = assembly.getCanonicalRefName(\n          parsedLocString.refName,\n        )\n\n        if (!canonicalRefName) {\n          throw new Error(\n            `Could not find refName ${parsedLocString.refName} in ${assembly.name}`,\n          )\n        }\n        if (changedAssembly || canonicalRefName !== defaultRefName) {\n          const newDisplayedRegion = regions.find(\n            region => region.refName === canonicalRefName,\n          )\n          if (newDisplayedRegion) {\n            this.setDisplayedRegions([getSnapshot(newDisplayedRegion)])\n          } else {\n            throw new Error(\n              `Could not find refName ${parsedLocString.refName} in ${assembly.name}`,\n            )\n          }\n        }\n        const displayedRegion = regions.find(\n          region => region.refName === canonicalRefName,\n        )\n        if (displayedRegion) {\n          const start = clamp(\n            parsedLocString?.start ?? 0,\n            0,\n            displayedRegion.end,\n          )\n          const end = clamp(\n            parsedLocString?.end ?? displayedRegion.end,\n            0,\n            displayedRegion.end,\n          )\n\n          this.navTo({\n            ...parsedLocString,\n            start,\n            end,\n          })\n        }\n      },\n\n      /**\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Can handle if there are multiple displayedRegions\n       * from same refName. Only navigates to a location if it is entirely\n       * within a displayedRegion. Navigates to the first matching location\n       * encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param location - a proposed location to navigate to\n       */\n      navTo(query: NavLocation) {\n        this.navToMultiple([query])\n      },\n\n      navToMultiple(locations: NavLocation[]) {\n        const firstLocation = locations[0]\n        let { refName } = firstLocation\n        const {\n          start,\n          end,\n          assemblyName = self.assemblyNames[0],\n        } = firstLocation\n\n        if (start !== undefined && end !== undefined && start > end) {\n          throw new Error(`start \"${start + 1}\" is greater than end \"${end}\"`)\n        }\n        const session = getSession(self)\n        const { assemblyManager } = session\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const canonicalRefName = assembly.getCanonicalRefName(refName)\n          if (canonicalRefName) {\n            refName = canonicalRefName\n          }\n        }\n        let s = start\n        let e = end\n        let refNameMatched = false\n        const predicate = (r: Region) => {\n          if (refName === r.refName) {\n            refNameMatched = true\n            if (s === undefined) {\n              s = r.start\n            }\n            if (e === undefined) {\n              e = r.end\n            }\n            if (s >= r.start && s <= r.end && e <= r.end && e >= r.start) {\n              return true\n            }\n            s = start\n            e = end\n          }\n          return false\n        }\n\n        const lastIndex = findLastIndex(self.displayedRegions, predicate)\n        let index\n        while (index !== lastIndex) {\n          try {\n            const previousIndex: number | undefined = index\n            index = self.displayedRegions\n              .slice(previousIndex === undefined ? 0 : previousIndex + 1)\n              .findIndex(predicate)\n            if (previousIndex !== undefined) {\n              index += previousIndex + 1\n            }\n            if (!refNameMatched) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\"`,\n              )\n            }\n            if (s === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained an end position ${e}`,\n              )\n            }\n            if (e === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained a start position ${\n                  s + 1\n                }`,\n              )\n            }\n            if (index === -1) {\n              throw new Error(\n                `could not find a region that completely contained \"${assembleLocString(\n                  firstLocation,\n                )}\"`,\n              )\n            }\n            if (locations.length === 1) {\n              const f = self.displayedRegions[index]\n              this.moveTo(\n                { index, offset: f.reversed ? f.end - e : s - f.start },\n                { index, offset: f.reversed ? f.end - s : e - f.start },\n              )\n              return\n            }\n            let locationIndex = 0\n            let locationStart = 0\n            let locationEnd = 0\n            for (\n              locationIndex;\n              locationIndex < locations.length;\n              locationIndex++\n            ) {\n              const location = locations[locationIndex]\n              const region = self.displayedRegions[index + locationIndex]\n              locationStart = location.start || region.start\n              locationEnd = location.end || region.end\n              if (location.refName !== region.refName) {\n                throw new Error(\n                  `Entered location ${assembleLocString(\n                    location,\n                  )} does not match with displayed regions`,\n                )\n              }\n              if (locationIndex > 0) {\n                // does it reach the left side?\n                const matchesLeft = region.reversed\n                  ? locationEnd === region.end\n                  : locationStart === region.start\n                if (!matchesLeft) {\n                  throw new Error(\n                    `${\n                      region.reversed ? 'End' : 'Start'\n                    } of region ${assembleLocString(\n                      location,\n                    )} should be ${(region.reversed\n                      ? region.end\n                      : region.start + 1\n                    ).toLocaleString('en-US')}, but it is not`,\n                  )\n                }\n              }\n              const isLast = locationIndex === locations.length - 1\n              if (!isLast) {\n                // does it reach the right side?\n                const matchesRight = region.reversed\n                  ? locationStart === region.start\n                  : locationEnd === region.end\n                if (!matchesRight) {\n                  throw new Error(\n                    `${\n                      region.reversed ? 'Start' : 'End'\n                    } of region ${assembleLocString(\n                      location,\n                    )} should be ${(region.reversed\n                      ? region.start + 1\n                      : region.end\n                    ).toLocaleString('en-US')}, but it is not`,\n                  )\n                }\n              }\n            }\n            locationIndex -= 1\n            const startDisplayedRegion = self.displayedRegions[index]\n            const endDisplayedRegion =\n              self.displayedRegions[index + locationIndex]\n            this.moveTo(\n              {\n                index,\n                offset: startDisplayedRegion.reversed\n                  ? startDisplayedRegion.end - e\n                  : s - startDisplayedRegion.start,\n              },\n              {\n                index: index + locationIndex,\n                offset: endDisplayedRegion.reversed\n                  ? endDisplayedRegion.end - locationStart\n                  : locationEnd - endDisplayedRegion.start,\n              },\n            )\n            return\n          } catch (error) {\n            if (index === lastIndex) {\n              throw error\n            }\n          }\n        }\n      },\n\n      /**\n       * Navigate to a location based on user clicking and dragging on the\n       * overview scale bar to select a region to zoom into.\n       * Can handle if there are multiple displayedRegions from same refName.\n       * Only navigates to a location if it is entirely within a displayedRegion.\n       *\n       * @param leftPx- `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightPx- `object as {start, end, index, offset}`, offset = end of user drag\n       */\n      zoomToDisplayedRegions(leftPx: BpOffset, rightPx: BpOffset) {\n        if (leftPx === undefined || rightPx === undefined) {\n          return\n        }\n\n        const singleRefSeq =\n          leftPx.refName === rightPx.refName && leftPx.index === rightPx.index\n        // zooming into one displayed Region\n        if (\n          (singleRefSeq && rightPx.offset < leftPx.offset) ||\n          leftPx.index > rightPx.index\n        ) {\n          ;[leftPx, rightPx] = [rightPx, leftPx]\n        }\n        const startOffset = {\n          start: leftPx.start,\n          end: leftPx.end,\n          index: leftPx.index,\n          offset: leftPx.offset,\n        }\n        const endOffset = {\n          start: rightPx.start,\n          end: rightPx.end,\n          index: rightPx.index,\n          offset: rightPx.offset,\n        }\n        if (startOffset && endOffset) {\n          this.moveTo(startOffset, endOffset)\n        } else {\n          const session = getSession(self)\n          session.notify('No regions found to navigate to', 'warning')\n        }\n      },\n      /**\n       * Helper method for the fetchSequence.\n       * Retrieves the corresponding regions that were selected by the rubberband\n       *\n       * @param leftOffset - `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightOffset - `object as {start, end, index, offset}`, offset = end of user drag\n       * @returns array of Region[]\n       */\n      getSelectedRegions(\n        leftOffset: BpOffset | undefined,\n        rightOffset: BpOffset | undefined,\n      ) {\n        const simView = Base1DView.create({\n          ...getSnapshot(self),\n          interRegionPaddingWidth: self.interRegionPaddingWidth,\n        })\n\n        simView.setVolatileWidth(self.width)\n        simView.zoomToDisplayedRegions(leftOffset, rightOffset)\n\n        return simView.dynamicBlocks.contentBlocks.map(region => {\n          return {\n            ...region,\n            start: Math.floor(region.start),\n            end: Math.ceil(region.end),\n          }\n        })\n      },\n\n      // schedule something to be run after the next time displayedRegions is set\n      afterDisplayedRegionsSet(cb: Function) {\n        self.afterDisplayedRegionsSetCallbacks.push(cb)\n      },\n      /**\n       * offset is the base-pair-offset in the displayed region, index is the index of the\n       * displayed region in the linear genome view\n       *\n       * @param start - object as `{start, end, offset, index}`\n       * @param end - object as `{start, end, offset, index}`\n       */\n      moveTo(start: BpOffset, end: BpOffset) {\n        // find locations in the modellist\n        let bpSoFar = 0\n\n        if (start.index === end.index) {\n          bpSoFar += end.offset - start.offset\n        } else {\n          const s = self.displayedRegions[start.index]\n          bpSoFar += s.end - s.start - start.offset\n          if (end.index - start.index >= 2) {\n            for (let i = start.index + 1; i < end.index; i += 1) {\n              bpSoFar +=\n                self.displayedRegions[i].end - self.displayedRegions[i].start\n            }\n          }\n          bpSoFar += end.offset\n        }\n        const targetBpPerPx =\n          bpSoFar /\n          (self.width -\n            self.interRegionPaddingWidth * (end.index - start.index))\n        const newBpPerPx = self.zoomTo(targetBpPerPx)\n        // If our target bpPerPx was smaller than the allowed minBpPerPx, adjust\n        // the scroll so the requested range is in the middle of the screen\n        let extraBp = 0\n        if (targetBpPerPx < newBpPerPx) {\n          extraBp = ((newBpPerPx - targetBpPerPx) * self.width) / 2\n        }\n\n        let bpToStart = -extraBp\n        for (let i = 0; i < self.displayedRegions.length; i += 1) {\n          const region = self.displayedRegions[i]\n          if (start.index === i) {\n            bpToStart += start.offset\n            break\n          } else {\n            bpToStart += region.end - region.start\n          }\n        }\n        self.scrollTo(\n          Math.round(bpToStart / self.bpPerPx) +\n            self.interRegionPaddingWidth * start.index,\n        )\n      },\n\n      horizontalScroll(distance: number) {\n        const oldOffsetPx = self.offsetPx\n        // newOffsetPx is the actual offset after the scroll is clamped\n        const newOffsetPx = self.scrollTo(self.offsetPx + distance)\n        return newOffsetPx - oldOffsetPx\n      },\n\n      /**\n       * scrolls the view to center on the given bp. if that is not in any\n       * of the displayed regions, does nothing\n       * @param bp - basepair at which you want to center the view\n       * @param refName - refName of the displayedRegion you are centering at\n       * @param regionIndex - index of the displayedRegion\n       */\n      centerAt(bp: number, refName: string, regionIndex: number) {\n        const centerPx = self.bpToPx({\n          refName,\n          coord: bp,\n          regionNumber: regionIndex,\n        })\n        if (centerPx) {\n          self.scrollTo(Math.round(centerPx.offsetPx - self.width / 2))\n        }\n      },\n\n      center() {\n        const centerBp = self.totalBp / 2\n        self.scrollTo(Math.round(centerBp / self.bpPerPx - self.width / 2))\n      },\n\n      showAllRegions() {\n        self.zoomTo(self.maxBpPerPx)\n        this.center()\n      },\n\n      showAllRegionsInAssembly(assemblyName?: string) {\n        const session = getSession(self)\n        const { assemblyManager } = session\n        if (!assemblyName) {\n          const assemblyNames = [\n            ...new Set(\n              self.displayedRegions.map(region => region.assemblyName),\n            ),\n          ]\n          if (assemblyNames.length > 1) {\n            session.notify(\n              `Can't perform this with multiple assemblies currently`,\n            )\n            return\n          }\n\n          ;[assemblyName] = assemblyNames\n        }\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const { regions } = getSnapshot(assembly)\n          if (regions) {\n            this.setDisplayedRegions(regions)\n            self.zoomTo(self.maxBpPerPx)\n            this.center()\n          }\n        }\n      },\n\n      setDraggingTrackId(idx?: string) {\n        self.draggingTrackId = idx\n      },\n\n      setScaleFactor(factor: number) {\n        self.scaleFactor = factor\n      },\n    }))\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function slide(viewWidths: number) {\n        const [animate, cancelAnimation] = springAnimate(\n          self.offsetPx,\n          self.offsetPx + self.width * viewWidths,\n          self.scrollTo,\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { slide }\n    })\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function zoom(targetBpPerPx: number) {\n        self.zoomTo(self.bpPerPx)\n        if (\n          // already zoomed all the way in\n          (targetBpPerPx < self.bpPerPx && self.bpPerPx === self.minBpPerPx) ||\n          // already zoomed all the way out\n          (targetBpPerPx > self.bpPerPx && self.bpPerPx === self.maxBpPerPx)\n        ) {\n          return\n        }\n        const factor = self.bpPerPx / targetBpPerPx\n        const [animate, cancelAnimation] = springAnimate(\n          1,\n          factor,\n          self.setScaleFactor,\n          () => {\n            self.zoomTo(targetBpPerPx)\n            self.setScaleFactor(1)\n          },\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { zoom }\n    })\n    .views(self => {\n      let currentlyCalculatedStaticBlocks: BlockSet | undefined\n      let stringifiedCurrentlyCalculatedStaticBlocks = ''\n      return {\n        get menuItems(): MenuItem[] {\n          const menuItems: MenuItem[] = [\n            {\n              label: 'Return to import form',\n              onClick: () => {\n                getSession(self).setDialogComponent(ReturnToImportFormDlg, {\n                  model: self,\n                })\n              },\n              icon: FolderOpenIcon,\n            },\n            {\n              label: 'Export SVG',\n              onClick: () => {\n                getSession(self).setDialogComponent(ExportSvgDlg, {\n                  model: self,\n                })\n              },\n            },\n            {\n              label: 'Open track selector',\n              onClick: self.activateTrackSelector,\n              icon: TrackSelectorIcon,\n            },\n            {\n              label: 'Horizontally flip',\n              icon: SyncAltIcon,\n              onClick: self.horizontallyFlip,\n            },\n            {\n              label: 'Show all regions in assembly',\n              icon: VisibilityIcon,\n              onClick: self.showAllRegionsInAssembly,\n            },\n            {\n              label: 'Show center line',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showCenterLine,\n              onClick: self.toggleCenterLine,\n            },\n            { type: 'divider' },\n            {\n              label: 'Show header',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: !self.hideHeader,\n              onClick: self.toggleHeader,\n            },\n            {\n              label: 'Show header overview',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: !self.hideHeaderOverview,\n              onClick: self.toggleHeaderOverview,\n              disabled: self.hideHeader,\n            },\n            {\n              label: 'Track labels',\n              icon: LabelIcon,\n              subMenu: [\n                {\n                  label: 'Overlapping',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'overlapping',\n                  onClick: () => self.setTrackLabels('overlapping'),\n                },\n                {\n                  label: 'Offset',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'offset',\n                  onClick: () => self.setTrackLabels('offset'),\n                },\n                {\n                  label: 'Hidden',\n                  icon: VisibilityIcon,\n                  type: 'radio',\n                  checked: self.trackLabels === 'hidden',\n                  onClick: () => self.setTrackLabels('hidden'),\n                },\n              ],\n            },\n          ]\n\n          // add track's view level menu options\n          for (const [key, value] of self.trackTypeActions.entries()) {\n            if (value.length) {\n              menuItems.push(\n                { type: 'divider' },\n                { type: 'subHeader', label: key },\n              )\n              value.forEach(action => {\n                menuItems.push(action)\n              })\n            }\n          }\n\n          return menuItems\n        },\n\n        get staticBlocks() {\n          const ret = calculateStaticBlocks(self)\n          const sret = JSON.stringify(ret)\n          if (stringifiedCurrentlyCalculatedStaticBlocks !== sret) {\n            currentlyCalculatedStaticBlocks = ret\n            stringifiedCurrentlyCalculatedStaticBlocks = sret\n          }\n          return currentlyCalculatedStaticBlocks as BlockSet\n        },\n\n        get dynamicBlocks() {\n          return calculateDynamicBlocks(self)\n        },\n\n        get roundedDynamicBlocks() {\n          return this.dynamicBlocks.contentBlocks.map(block => {\n            return {\n              ...block,\n              start: Math.floor(block.start),\n              end: Math.ceil(block.end),\n            }\n          })\n        },\n        get visibleLocStrings() {\n          return calculateVisibleLocStrings(this.dynamicBlocks.contentBlocks)\n        },\n        get coarseVisibleLocStrings() {\n          return calculateVisibleLocStrings(self.coarseDynamicBlocks)\n        },\n      }\n    })\n    .actions(self => ({\n      // this \"clears the view\" and makes the view return to the import form\n      clearView() {\n        self.setDisplayedRegions([])\n        self.tracks.clear()\n        // it is necessary to run these after setting displayed regions empty\n        // or else model.offsetPx gets set to Infinity and breaks\n        // mobx-state-tree snapshot\n        self.scrollTo(0)\n        self.zoomTo(10)\n      },\n      setCoarseDynamicBlocks(blocks: BlockSet) {\n        self.coarseDynamicBlocks = blocks.contentBlocks\n        self.coarseTotalBp = blocks.totalBp\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.initialized) {\n                this.setCoarseDynamicBlocks(self.dynamicBlocks)\n              }\n            },\n            { delay: 150 },\n          ),\n        )\n      },\n    }))\n    .actions(self => ({\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const html = await renderToSvg(self as any, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, 'image.svg')\n      },\n    }))\n\n  return types.compose(BaseViewModel, model)\n}\n\nexport { renderToSvg }\nexport type LinearGenomeViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearGenomeViewModel = Instance<LinearGenomeViewStateModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, IAnyModelType, IAnyComplexType, getEnv } from 'mobx-state-tree'\nimport { stringToJexlExpression } from '../util/jexlStrings'\nimport { FileLocation } from '../util/types/mst'\n\nfunction isValidColorString(/* str */) {\n  // TODO: check all the crazy cases for whether it's a valid HTML/CSS color string\n  return true\n}\nconst typeModels: { [typeName: string]: any } = {\n  stringArray: types.array(types.string),\n  stringArrayMap: types.map(types.array(types.string)),\n  numberMap: types.map(types.number),\n  boolean: types.boolean,\n  color: types.refinement('Color', types.string, isValidColorString),\n  integer: types.integer,\n  number: types.number,\n  string: types.string,\n  text: types.string,\n  fileLocation: FileLocation,\n  frozen: types.frozen(),\n}\n\n// default values we use if the defaultValue is malformed or does not work\nconst fallbackDefaults: { [typeName: string]: any } = {\n  stringArray: [],\n  stringArrayMap: {},\n  numberMap: {},\n  boolean: true,\n  color: 'black',\n  integer: 1,\n  number: 1,\n  string: '',\n  text: '',\n  fileLocation: { uri: '/path/to/resource.txt' },\n  frozen: {},\n}\n\nconst literalJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return self.value\n    },\n  },\n})\n\nconst objectJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return JSON.stringify(self.value)\n    },\n  },\n})\n\n// custom actions for modifying the value models\nconst typeModelExtensions: { [typeName: string]: (self: any) => any } = {\n  fileLocation: objectJSON,\n  number: literalJSON,\n  integer: literalJSON,\n  boolean: literalJSON,\n  frozen: objectJSON,\n  // special actions for working with stringArray slots\n  stringArray: (self: { value: string[] }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(val: string) {\n        self.value.push(val)\n      },\n      removeAtIndex(idx: number) {\n        self.value.splice(idx, 1)\n      },\n      setAtIndex(idx: number, val: string) {\n        self.value[idx] = val\n      },\n    },\n  }),\n  stringArrayMap: (self: { value: Map<string, string[]> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: any) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n      addToKey(key: string, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.push(val)\n      },\n      removeAtKeyIndex(key: string, idx: number) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.splice(idx, 1)\n      },\n      setAtKeyIndex(key: string, idx: number, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar[idx] = val\n      },\n    },\n  }),\n  numberMap: (self: { value: Map<string, number> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: number) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n    },\n  }),\n}\n\n// const FunctionStringType = types.refinement(\n//   'FunctionString',\n//   types.string,\n//   str => functionRegexp.test(str),\n// )\n\nconst JexlStringType = types.refinement('JexlString', types.string, str =>\n  str.startsWith('jexl:'),\n)\n\nexport interface ConfigSlotDefinition {\n  description?: string\n  /** custom base MST model for the slot's value */\n  model?: IAnyModelType | IAnyComplexType\n  /** name of the type of slot, e.g. \"string\", \"number\", \"stringArray\" */\n  type: string\n  /** default value of the slot */\n  defaultValue: any\n  /** parameter names of the function callback */\n  contextVariable?: string[]\n}\n\n/**\n * builds a MST model for a configuration slot\n *\n * @param slotName -\n * @param  definition -\n */\nexport default function ConfigSlot(\n  slotName: string,\n  {\n    description = '',\n    model,\n    type,\n    defaultValue,\n    contextVariable = [],\n  }: ConfigSlotDefinition,\n) {\n  if (!type) {\n    throw new Error('type name required')\n  }\n  if (!model) {\n    model = typeModels[type]\n  }\n  if (!model) {\n    throw new Error(\n      `no builtin config slot type \"${type}\", and no 'model' param provided`,\n    )\n  }\n\n  if (defaultValue === undefined) {\n    throw new Error(\"no 'defaultValue' provided\")\n  }\n\n  // if the `type` is something like `color`, then the model name\n  // here will be `ColorConfigSlot`\n  const configSlotModelName = `${slotName\n    .charAt(0)\n    .toUpperCase()}${slotName.slice(1)}ConfigSlot`\n  let slot = types\n    .model(configSlotModelName, {\n      name: types.literal(slotName),\n      description: types.literal(description),\n      type: types.literal(type),\n      value: types.optional(types.union(JexlStringType, model), defaultValue),\n    })\n    .volatile(() => ({\n      contextVariable,\n    }))\n    .views(self => ({\n      get isCallback() {\n        return String(self.value).startsWith('jexl:')\n      },\n    }))\n    .views(self => ({\n      get expr() {\n        if (self.isCallback) {\n          // compile as jexl function\n          const { pluginManager } = getEnv(self)\n          if (!pluginManager && typeof jest === 'undefined') {\n            console.warn(\n              'no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)',\n            )\n          }\n          return stringToJexlExpression(String(self.value), pluginManager?.jexl)\n        }\n        return { evalSync: () => self.value }\n      },\n\n      // JS representation of the value of this slot, suitable\n      // for embedding in either JSON or a JS function string.\n      // many of the data types override this in typeModelExtensions\n      get valueJSON(): any[] | Record<string, any> | string | undefined {\n        if (self.isCallback) {\n          return undefined\n        }\n        function json(value: { toJSON: Function } | any) {\n          if (value && value.toJSON) {\n            return value.toJSON()\n          }\n          return `\"${value}\"`\n        }\n        return json(self.value)\n      },\n    }))\n    .preProcessSnapshot(val =>\n      typeof val === 'object' && val.name === slotName\n        ? val\n        : {\n            name: slotName,\n            description,\n            type,\n            value: val,\n          },\n    )\n    .postProcessSnapshot(snap => {\n      if (typeof snap.value === 'object') {\n        return JSON.stringify(snap.value) !== JSON.stringify(defaultValue)\n          ? snap.value\n          : undefined\n      }\n      return snap.value !== defaultValue ? snap.value : undefined\n    })\n    .actions(self => ({\n      set(newVal: any) {\n        self.value = newVal\n      },\n      reset() {\n        self.value = defaultValue\n      },\n      convertToCallback() {\n        if (self.isCallback) {\n          return\n        }\n        self.value = `jexl:${self.valueJSON || \"''\"}`\n      },\n      convertToValue() {\n        if (!self.isCallback) {\n          return\n        }\n        // try calling it with no arguments\n        try {\n          const funcResult = self.expr.evalSync()\n          if (funcResult !== undefined) {\n            self.value = funcResult\n            return\n          }\n        } catch (e) {\n          /* ignore */\n        }\n        self.value = defaultValue\n        // if it is still a callback (happens if the defaultValue is a callback),\n        // then use the last-resort fallback default\n\n        // if defaultValue has jexl: string, run this part\n        if (self.isCallback) {\n          if (!(type in fallbackDefaults)) {\n            throw new Error(`no fallbackDefault defined for type ${type}`)\n          }\n          self.value = fallbackDefaults[type]\n        }\n      },\n    }))\n\n  // if there are any type-specific extensions (views or actions)\n  //  to the slot, add those in\n  if (typeModelExtensions[type]) {\n    slot = slot.extend(typeModelExtensions[type])\n  }\n\n  const completeModel = types.optional(slot, {\n    name: slotName,\n    type,\n    description,\n    value: defaultValue,\n  })\n  const m = completeModel\n  Object.defineProperty(m, 'isJBrowseConfigurationSlot', { value: true })\n  return m\n}\n","import {\n  types,\n  isStateTreeNode,\n  Instance,\n  IAnyType,\n  isType,\n  isLateType,\n  SnapshotOut,\n  ModelPropertiesDeclaration,\n} from 'mobx-state-tree'\n\nimport { ElementId } from '../util/types/mst'\n\nimport ConfigSlot, { ConfigSlotDefinition } from './configurationSlot'\nimport { isConfigurationSchemaType } from './util'\n\nfunction isEmptyObject(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    !Array.isArray(thing) &&\n    thing !== null &&\n    Object.keys(thing).length === 0\n  )\n}\n\nfunction isEmptyArray(thing: unknown) {\n  return Array.isArray(thing) && thing.length === 0\n}\n\nexport interface ConfigurationSchemaDefinition {\n  [n: string]:\n    | ConfigSlotDefinition\n    | ConfigurationSchemaDefinition\n    | string\n    | number\n    | IAnyType\n}\n\ninterface ConfigurationSchemaOptions {\n  explicitlyTyped?: boolean\n  explicitIdentifier?: string\n  implicitIdentifier?: string\n  baseConfiguration?: AnyConfigurationSchemaType\n\n  actions?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  views?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  extend?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  preProcessSnapshot?: (snapshot: {}) => {}\n}\n\nfunction preprocessConfigurationSchemaArguments(\n  modelName: string,\n  inputSchemaDefinition: ConfigurationSchemaDefinition,\n  inputOptions: ConfigurationSchemaOptions = {},\n) {\n  if (typeof modelName !== 'string') {\n    throw new Error(\n      'first arg must be string name of the model that this config schema goes with',\n    )\n  }\n\n  // if we have a base configuration schema that we are\n  // extending, grab the slot definitions from that\n  let schemaDefinition = inputSchemaDefinition\n  let options = inputOptions\n  if (\n    inputOptions.baseConfiguration &&\n    inputOptions.baseConfiguration.jbrowseSchemaDefinition\n  ) {\n    schemaDefinition = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaDefinition,\n      ...schemaDefinition,\n    }\n    options = {\n      ...(inputOptions.baseConfiguration.jbrowseSchemaOptions || {}),\n      ...inputOptions,\n    }\n    delete options.baseConfiguration\n  }\n  return { schemaDefinition, options }\n}\n\nfunction makeConfigurationSchemaModel<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions\n>(modelName: string, schemaDefinition: DEFINITION, options: OPTIONS) {\n  // now assemble the MST model of the configuration schema\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const modelDefinition: Record<string, any> = {}\n  let identifier\n\n  if (options.explicitlyTyped) {\n    modelDefinition.type = types.optional(types.literal(modelName), modelName)\n  }\n\n  if (options.explicitIdentifier && options.implicitIdentifier) {\n    throw new Error(\n      `Cannot have both explicit and implicit identifiers in ${modelName}`,\n    )\n  }\n  if (options.explicitIdentifier) {\n    if (typeof options.explicitIdentifier === 'string') {\n      modelDefinition[options.explicitIdentifier] = types.identifier\n      identifier = options.explicitIdentifier\n    } else {\n      modelDefinition.id = types.identifier\n      identifier = 'id'\n    }\n  } else if (options.implicitIdentifier) {\n    if (typeof options.implicitIdentifier === 'string') {\n      modelDefinition[options.implicitIdentifier] = ElementId\n      identifier = options.implicitIdentifier\n    } else {\n      modelDefinition.id = ElementId\n      identifier = 'id'\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const volatileConstants: Record<string, any> = {\n    isJBrowseConfigurationSchema: true,\n    jbrowseSchema: {\n      modelName,\n      definition: schemaDefinition,\n      options,\n    },\n  }\n  Object.entries(schemaDefinition).forEach(([slotName, slotDefinition]) => {\n    if (\n      (isType(slotDefinition) && isLateType(slotDefinition)) ||\n      isConfigurationSchemaType(slotDefinition)\n    ) {\n      // this is either an MST late() type (which we assume to be a sub-configuration),\n      // or an actual sub-configuration\n      modelDefinition[slotName] = slotDefinition\n    } else if (\n      typeof slotDefinition === 'string' ||\n      typeof slotDefinition === 'number'\n    ) {\n      volatileConstants[slotName] = slotDefinition\n    } else if (typeof slotDefinition === 'object') {\n      // this is a slot definition\n      if (!slotDefinition.type) {\n        throw new Error(`no type set for config slot ${modelName}.${slotName}`)\n      }\n      try {\n        modelDefinition[slotName] = ConfigSlot(\n          slotName,\n          slotDefinition as ConfigSlotDefinition,\n        )\n      } catch (e) {\n        throw new Error(\n          `invalid config slot definition for ${modelName}.${slotName}: ${e.message}`,\n        )\n      }\n    } else {\n      throw new Error(\n        `invalid configuration schema definition, \"${slotName}\" must be either a valid configuration slot definition, a constant, or a nested configuration schema`,\n      )\n    }\n  })\n\n  let completeModel = types\n    .model(`${modelName}ConfigurationSchema`, modelDefinition)\n    .actions(self => ({\n      setSubschema(\n        slotName: string,\n        data: ModelPropertiesDeclaration | AnyConfigurationSchemaType,\n      ) {\n        if (!isConfigurationSchemaType(modelDefinition[slotName])) {\n          throw new Error(`${slotName} is not a subschema, cannot replace`)\n        }\n        const newSchema = isStateTreeNode(data)\n          ? data\n          : modelDefinition[slotName].create(data)\n        self[slotName] = newSchema\n        return newSchema\n      },\n    }))\n\n  if (Object.keys(volatileConstants).length) {\n    completeModel = completeModel.volatile((/* self */) => volatileConstants)\n  }\n  if (options.actions) {\n    completeModel = completeModel.actions(options.actions)\n  }\n  if (options.views) {\n    completeModel = completeModel.views(options.views)\n  }\n  if (options.extend) {\n    completeModel = completeModel.extend(options.extend)\n  }\n  completeModel = completeModel.postProcessSnapshot(snap => {\n    const newSnap: SnapshotOut<typeof completeModel> = {}\n    // let keyCount = 0\n    Object.entries(snap).forEach(([key, value]) => {\n      if (\n        value !== undefined &&\n        volatileConstants[key] === undefined &&\n        !isEmptyObject(value) &&\n        !isEmptyArray(value)\n      ) {\n        // keyCount += 1\n        newSnap[key] = value\n      }\n    })\n    return newSnap\n  })\n\n  if (options.preProcessSnapshot) {\n    completeModel = completeModel.preProcessSnapshot(options.preProcessSnapshot)\n  }\n\n  const identifierDefault = identifier ? { [identifier]: 'placeholderId' } : {}\n  const schemaType = types.optional(\n    completeModel,\n    options.explicitlyTyped\n      ? { type: modelName, ...identifierDefault }\n      : identifierDefault,\n  )\n  return schemaType\n}\n\nexport interface AnyConfigurationSchemaType\n  extends ReturnType<typeof makeConfigurationSchemaModel> {\n  isJBrowseConfigurationSchema: boolean\n  jbrowseSchemaDefinition: ConfigurationSchemaDefinition\n  jbrowseSchemaOptions: ConfigurationSchemaOptions\n}\n\nexport type AnyConfigurationModel = Instance<AnyConfigurationSchemaType>\n\nexport type ConfigurationModel<\n  SCHEMA extends AnyConfigurationSchemaType\n> = Instance<SCHEMA>\n\nexport function ConfigurationSchema<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions\n>(\n  modelName: string,\n  inputSchemaDefinition: DEFINITION,\n  inputOptions?: OPTIONS,\n): AnyConfigurationSchemaType {\n  const { schemaDefinition, options } = preprocessConfigurationSchemaArguments(\n    modelName,\n    inputSchemaDefinition,\n    inputOptions,\n  )\n  const schemaType = makeConfigurationSchemaModel(\n    modelName,\n    schemaDefinition,\n    options,\n  ) as AnyConfigurationSchemaType\n  // saving a couple of jbrowse-specific things in the type object. hope nobody gets mad.\n  schemaType.isJBrowseConfigurationSchema = true\n  schemaType.jbrowseSchemaDefinition = schemaDefinition\n  schemaType.jbrowseSchemaOptions = options\n  return schemaType\n}\n\nexport function ConfigurationReference(schemaType: IAnyType) {\n  return types.union(types.reference(schemaType), schemaType)\n}\n","// from https://www.w3.org/TR/css-color-4/#named-colors\n\nconst colors: Record<string, string> = {\n  aliceblue: '#F0F8FF',\n  antiquewhite: '#FAEBD7',\n  aqua: '#00FFFF',\n  aquamarine: '#7FFFD4',\n  azure: '#F0FFFF',\n  beige: '#F5F5DC',\n  bisque: '#FFE4C4',\n  black: '#000000',\n  blanchedalmond: '#FFEBCD',\n  blue: '#0000FF',\n  blueviolet: '#8A2BE2',\n  brown: '#A52A2A',\n  burlywood: '#DEB887',\n  cadetblue: '#5F9EA0',\n  chartreuse: '#7FFF00',\n  chocolate: '#D2691E',\n  coral: '#FF7F50',\n  cornflowerblue: '#6495ED',\n  cornsilk: '#FFF8DC',\n  crimson: '#DC143C',\n  cyan: '#00FFFF',\n  darkblue: '#00008B',\n  darkcyan: '#008B8B',\n  darkgoldenrod: '#B8860B',\n  darkgray: '#A9A9A9',\n  darkgreen: '#006400',\n  darkgrey: '#A9A9A9',\n  darkkhaki: '#BDB76B',\n  darkmagenta: '#8B008B',\n  darkolivegreen: '#556B2F',\n  darkorange: '#FF8C00',\n  darkorchid: '#9932CC',\n  darkred: '#8B0000',\n  darksalmon: '#E9967A',\n  darkseagreen: '#8FBC8F',\n  darkslateblue: '#483D8B',\n  darkslategray: '#2F4F4F',\n  darkslategrey: '#2F4F4F',\n  darkturquoise: '#00CED1',\n  darkviolet: '#9400D3',\n  deeppink: '#FF1493',\n  deepskyblue: '#00BFFF',\n  dimgray: '#696969',\n  dimgrey: '#696969',\n  dodgerblue: '#1E90FF',\n  firebrick: '#B22222',\n  floralwhite: '#FFFAF0',\n  forestgreen: '#228B22',\n  fuchsia: '#FF00FF',\n  gainsboro: '#DCDCDC',\n  ghostwhite: '#F8F8FF',\n  gold: '#FFD700',\n  goldenrod: '#DAA520',\n  gray: '#808080',\n  green: '#008000',\n  greenyellow: '#ADFF2F',\n  grey: '#808080',\n  honeydew: '#F0FFF0',\n  hotpink: '#FF69B4',\n  indianred: '#CD5C5C',\n  indigo: '#4B0082',\n  ivory: '#FFFFF0',\n  khaki: '#F0E68C',\n  lavender: '#E6E6FA',\n  lavenderblush: '#FFF0F5',\n  lawngreen: '#7CFC00',\n  lemonchiffon: '#FFFACD',\n  lightblue: '#ADD8E6',\n  lightcoral: '#F08080',\n  lightcyan: '#E0FFFF',\n  lightgoldenrodyellow: '#FAFAD2',\n  lightgray: '#D3D3D3',\n  lightgreen: '#90EE90',\n  lightgrey: '#D3D3D3',\n  lightpink: '#FFB6C1',\n  lightsalmon: '#FFA07A',\n  lightseagreen: '#20B2AA',\n  lightskyblue: '#87CEFA',\n  lightslategray: '#778899',\n  lightslategrey: '#778899',\n  lightsteelblue: '#B0C4DE',\n  lightyellow: '#FFFFE0',\n  lime: '#00FF00',\n  limegreen: '#32CD32',\n  linen: '#FAF0E6',\n  magenta: '#FF00FF',\n  maroon: '#800000',\n  mediumaquamarine: '#66CDAA',\n  mediumblue: '#0000CD',\n  mediumorchid: '#BA55D3',\n  mediumpurple: '#9370DB',\n  mediumseagreen: '#3CB371',\n  mediumslateblue: '#7B68EE',\n  mediumspringgreen: '#00FA9A',\n  mediumturquoise: '#48D1CC',\n  mediumvioletred: '#C71585',\n  midnightblue: '#191970',\n  mintcream: '#F5FFFA',\n  mistyrose: '#FFE4E1',\n  moccasin: '#FFE4B5',\n  navajowhite: '#FFDEAD',\n  navy: '#000080',\n  oldlace: '#FDF5E6',\n  olive: '#808000',\n  olivedrab: '#6B8E23',\n  orange: '#FFA500',\n  orangered: '#FF4500',\n  orchid: '#DA70D6',\n  palegoldenrod: '#EEE8AA',\n  palegreen: '#98FB98',\n  paleturquoise: '#AFEEEE',\n  palevioletred: '#DB7093',\n  papayawhip: '#FFEFD5',\n  peachpuff: '#FFDAB9',\n  peru: '#CD853F',\n  pink: '#FFC0CB',\n  plum: '#DDA0DD',\n  powderblue: '#B0E0E6',\n  purple: '#800080',\n  rebeccapurple: '#663399',\n  red: '#FF0000',\n  rosybrown: '#BC8F8F',\n  royalblue: '#4169E1',\n  saddlebrown: '#8B4513',\n  salmon: '#FA8072',\n  sandybrown: '#F4A460',\n  seagreen: '#2E8B57',\n  seashell: '#FFF5EE',\n  sienna: '#A0522D',\n  silver: '#C0C0C0',\n  skyblue: '#87CEEB',\n  slateblue: '#6A5ACD',\n  slategray: '#708090',\n  slategrey: '#708090',\n  snow: '#FFFAFA',\n  springgreen: '#00FF7F',\n  steelblue: '#4682B4',\n  tan: '#D2B48C',\n  teal: '#008080',\n  thistle: '#D8BFD8',\n  tomato: '#FF6347',\n  turquoise: '#40E0D0',\n  violet: '#EE82EE',\n  wheat: '#F5DEB3',\n  white: '#FFFFFF',\n  whitesmoke: '#F5F5F5',\n  yellow: '#FFFF00',\n  yellowgreen: '#9ACD32',\n}\n\nexport function namedColorToHex(name: string): string | undefined {\n  return colors[name]\n}\n\nexport function isNamedColor(name: string): boolean {\n  return !!colors[name]\n}\n","import {\n  darken,\n  emphasize as muiEmphasize,\n  getContrastRatio,\n  getLuminance as muiGetLuminance,\n  lighten,\n} from '@material-ui/core/styles/colorManipulator'\nimport { namedColorToHex, isNamedColor } from './cssColorsLevel4'\n\nexport { namedColorToHex, isNamedColor }\n\n/**\n * Algorithmically pick a contrasting text color that will\n * be visible on top of the given background color. Either\n * black or white.\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns 'black' or 'white'\n */\nexport function contrastingTextColor(color: string): string {\n  const luminance = getLuminance(color)\n  return luminance > 0.5 ? 'black' : 'white'\n}\n\n/**\n * The relative brightness of any point in a color space,\n * normalized to 0 for darkest black and 1 for lightest white.\n * Uses MUI's `getLuminance`, but adds support for named colors\n *\n * Formula: https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns The relative brightness of the color in the range 0 - 1\n */\nfunction getLuminance(color: string): number {\n  const convertedColor = namedColorToHex(color)\n  return muiGetLuminance(convertedColor || color)\n}\n\n/**\n * Darken or lighten a color, depending on its luminance.\n * Light colors are darkened, dark colors are lightened.\n * Uses MUI's `emphasize`, but adds support for named colors\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n * hsl(), hsla(), or named color\n * @param coefficient - multiplier in the range 0 - 1, defaults to 0.15\n * @returns A CSS color string. Hex input values are returned as rgb\n */\nexport function emphasize(color: string, coefficient = 0.15): string {\n  const convertedColor = namedColorToHex(color)\n  return muiEmphasize(convertedColor || color, coefficient)\n}\n\nexport function makeContrasting(\n  foreground: string,\n  background = 'white',\n  minContrastRatio = 3,\n) {\n  let convertedForeground = namedColorToHex(foreground) || foreground\n  const convertedBackground = namedColorToHex(background) || background\n  const backgroundLuminance = getLuminance(convertedBackground)\n  let contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  const originalColor = convertedForeground\n  let coefficient = 0.05\n  while (contrastRatio < minContrastRatio) {\n    convertedForeground =\n      backgroundLuminance > 0.5\n        ? darken(originalColor, coefficient)\n        : lighten(originalColor, coefficient)\n    coefficient += 0.05\n    contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  }\n  return convertedForeground\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  isOptionalType,\n  isUnionType,\n  isArrayType,\n  isMapType,\n  isLateType,\n} from 'mobx-state-tree'\n\n/**\n * get the inner type of an MST optional, array, or late type object\n *\n * @param {IModelType} type\n * @returns {IModelType}\n */\nexport function getSubType(type) {\n  let t\n  if (isOptionalType(type)) {\n    t = type._subtype || type.type\n  } else if (isArrayType(type) || isMapType(type)) {\n    t = type._subtype || type._subType || type.subType\n  } else if (typeof type.getSubType === 'function') {\n    return type.getSubType()\n  } else {\n    throw new TypeError('unsupported mst type')\n  }\n  if (!t) {\n    // debugger\n    throw new Error('failed to get subtype')\n  }\n  return t\n}\n\n/**\n * get the array of\n * @param {MST Union Type obj} unionType\n * @returns {Array<IModelType>}\n */\nexport function getUnionSubTypes(unionType) {\n  if (!isUnionType(unionType)) {\n    throw new TypeError('not an MST union type')\n  }\n  const t =\n    unionType._types ||\n    unionType.types ||\n    getSubType(unionType)._types ||\n    getSubType(unionType).types\n  if (!t) {\n    // debugger\n    throw new Error('failed to extract subtypes from mst union')\n  }\n  return t\n}\n\n/**\n * get the type of one of the properties of the given MST model type\n *\n * @param {IModelType} type\n * @param {string} propertyName\n * @returns {IModelType}\n */\nexport function getPropertyType(type, propertyName) {\n  const propertyType = type.properties[propertyName]\n  return propertyType\n}\n\n/**\n * get the base type from inside an MST optional type\n * @param {*} type\n */\nexport function getDefaultValue(type) {\n  if (!isOptionalType(type)) {\n    throw new TypeError('type must be an optional type')\n  }\n  return type._defaultValue || type.defaultValue\n}\n\n/** get the string values of an MST enumeration type */\nexport function getEnumerationValues(type) {\n  const subtypes = getUnionSubTypes(type)\n  // the subtypes should all be literals with a value member\n  return subtypes.map(t => t.value)\n}\n\nexport function resolveLateType(maybeLate) {\n  if (\n    !isUnionType(maybeLate) &&\n    !isArrayType(maybeLate) &&\n    isLateType(maybeLate)\n  ) {\n    return maybeLate.getSubType()\n  }\n  return maybeLate\n}\n","/**\n * fast low-level intersection of 2 coordinate ranges. assumes interbase coordinates.\n *\n * assumes `left <= right` for both ranges\n *\n * @returns array of [left, right], or [] if the ranges do not intersect. the choice of [] is because it allows destructuring array assignment without check for undefined return\n */\nexport function intersection2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  // this code is verbose because \"if\" statements are faster than Math.min and Math.max\n  if (right1 > left2 && left1 < right2 && right2 - left2 && right1 - left1) {\n    if (left1 > left2) {\n      if (right1 < right2) {\n        // 1     |-------|\n        //     |------------|\n        return [left1, right1]\n      }\n      // 2         |----|\n      //      |------|\n      return [left1, right2]\n    }\n    if (right1 < right2) {\n      // 3  |-----|\n      //       |------|\n      return [left2, right1]\n    }\n    // 4     |------------|\n    //         |-------|\n    return [left2, right2]\n  }\n  return []\n}\n\n/**\n * Return whether 2 interbase coordinate ranges intersect.\n *\n * @param left1 -\n * @param right1 -\n * @param left2 -\n * @param right2 -\n *\n * @returns true if the two ranges intersect\n */\nexport function doesIntersect2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return right1 > left2 && left1 < right2\n}\n\n/**\n * Return whether the first region is completely contained within the second region\n *\n * @param left1 - candidate inner region left\n * @param right1 - candidate inner region right\n * @param left2 - candidate outer region left\n * @param right2 - candidate outer region right\n */\nexport function isContainedWithin(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return left2 <= left1 && right2 >= right1\n}\n","type Func<T> = (value: BaseBlock, index: number, array: BaseBlock[]) => T\n\nexport class BlockSet {\n  blocks: BaseBlock[] = []\n\n  constructor(blocks: BaseBlock[] = []) {\n    this.blocks = blocks\n  }\n\n  push(block: BaseBlock) {\n    if (block instanceof ElidedBlock) {\n      if (this.blocks.length) {\n        const lastBlock = this.blocks[this.blocks.length - 1]\n        if (lastBlock instanceof ElidedBlock) {\n          lastBlock.push(block)\n          return\n        }\n      }\n    }\n\n    this.blocks.push(block)\n  }\n\n  getBlocks() {\n    return this.blocks\n  }\n\n  getRegions() {\n    return this.blocks.map(block => block.toRegion())\n  }\n\n  map<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.map(func, thisarg)\n  }\n\n  forEach<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.forEach(func, thisarg)\n  }\n\n  get length() {\n    return this.blocks.length\n  }\n\n  get totalWidthPx() {\n    return this.blocks.length\n      ? this.blocks.map(blocks => blocks.widthPx).reduce((a, b) => a + b)\n      : 0\n  }\n\n  get totalWidthPxWithoutBorders() {\n    return this.blocks.length\n      ? this.blocks\n          .filter(block => block.variant !== 'boundary')\n          .map(blocks => blocks.widthPx)\n          .reduce((a, b) => a + b)\n      : 0\n  }\n\n  get offsetPx() {\n    return this.blocks.length ? this.blocks[0].offsetPx : 0\n  }\n\n  get contentBlocks() {\n    return this.blocks.filter(block => block instanceof ContentBlock)\n  }\n\n  get totalBp() {\n    return this.contentBlocks\n      .map(block => block.end - block.start)\n      .reduce((a, b) => a + b, 0)\n  }\n}\n\nexport class BaseBlock {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n\n  public refName: string\n\n  public start: number\n\n  public end: number\n\n  public assemblyName: string\n\n  public key: string\n\n  public offsetPx: number\n\n  /**\n   * a block that should be shown as filled with data\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: any) {\n    Object.assign(this, data)\n    this.assemblyName = data.assemblyName\n    this.refName = data.refName\n    this.start = data.start\n    this.end = data.end\n    this.key = data.key\n    this.offsetPx = data.offsetPx\n  }\n\n  /**\n   * rename the reference sequence of this block and return a new one\n   *\n   * @param refName -\n   * @returns either a new block with a renamed reference sequence,\n   * or the same block, if the ref name is not actually different\n   */\n  renameReference(refName: string) {\n    if (this.refName && refName !== this.refName) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return new (this.constructor as any)({ ...this, refName })\n    }\n    return this\n  }\n\n  toRegion() {\n    return {\n      refName: this.refName,\n      start: this.start,\n      end: this.end,\n      assemblyName: this.assemblyName,\n      reversed: this.reversed,\n    }\n  }\n}\n\nexport class ContentBlock extends BaseBlock {}\n\n/**\n * marker block representing one or more blocks that are\n * too small to be shown at the current zoom level\n */\nexport class ElidedBlock extends BaseBlock {\n  public widthPx: number\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: Record<string, any>) {\n    super(data)\n    this.widthPx = data.widthPx\n  }\n\n  push(otherBlock: BaseBlock) {\n    this.elidedBlockCount += 1\n\n    if (otherBlock) {\n      this.refName = ''\n      this.start = 0\n      this.end = 0\n      this.widthPx += otherBlock.widthPx\n    }\n  }\n}\n\n/**\n * marker block that sits between two different displayed regions\n * and provides a thick border between them\n */\nexport class InterRegionPaddingBlock extends BaseBlock {}\n","import { types, cast, getSnapshot, Instance } from 'mobx-state-tree'\nimport { clamp } from './index'\nimport { Feature } from './simpleFeature'\nimport { Region } from './types/mst'\nimport { Region as IRegion } from './types'\nimport calculateDynamicBlocks from './calculateDynamicBlocks'\nimport calculateStaticBlocks from './calculateStaticBlocks'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n}\n\nconst Base1DView = types\n  .model('Base1DView', {\n    displayedRegions: types.array(Region),\n    bpPerPx: 0,\n    offsetPx: 0,\n    interRegionPaddingWidth: types.optional(types.number, 0),\n    minimumBlockWidth: types.optional(types.number, 0),\n  })\n  .volatile(() => ({\n    features: undefined as undefined | Feature[],\n    volatileWidth: 0,\n  }))\n  .actions(self => ({\n    setDisplayedRegions(regions: IRegion[]) {\n      self.displayedRegions = cast(regions)\n    },\n    setBpPerPx(val: number) {\n      self.bpPerPx = val\n    },\n    setVolatileWidth(width: number) {\n      self.volatileWidth = width\n    },\n  }))\n  .views(self => ({\n    get width() {\n      return self.volatileWidth\n    },\n\n    get displayedRegionsTotalPx() {\n      return this.totalBp / self.bpPerPx\n    },\n\n    get maxOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const leftPadding = 10\n      return this.displayedRegionsTotalPx - leftPadding\n    },\n\n    get minOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const rightPadding = 30\n      return -this.width + rightPadding\n    },\n    get totalBp() {\n      return self.displayedRegions\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n\n    /**\n     * calculates the Px at which coord is found.\n     *\n     * @param refName - string, refName of region\n     * @param coord - number, bp to be translated to Px\n     * @param regionNumber - number, index of displayedRegion in displayedRegions array\n     */\n    bpToPx({\n      refName,\n      coord,\n      regionNumber,\n    }: {\n      refName: string\n      coord: number\n      regionNumber?: number\n    }) {\n      let offsetBp = 0\n\n      const interRegionPaddingBp = self.interRegionPaddingWidth * self.bpPerPx\n      const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n      const index = self.displayedRegions.findIndex((region, idx) => {\n        const len = region.end - region.start\n        if (\n          refName === region.refName &&\n          coord >= region.start &&\n          coord <= region.end\n        ) {\n          if (regionNumber ? regionNumber === idx : true) {\n            offsetBp += region.reversed\n              ? region.end - coord\n              : coord - region.start\n            return true\n          }\n        }\n\n        // add the interRegionPaddingWidth if the boundary is in the screen\n        // e.g. offset>0 && offset<width\n        if (\n          region.end - region.start > minimumBlockBp &&\n          offsetBp / self.bpPerPx > 0 &&\n          offsetBp / self.bpPerPx < this.width\n        ) {\n          offsetBp += len + interRegionPaddingBp\n        } else {\n          offsetBp += len\n        }\n        return false\n      })\n\n      const foundRegion = self.displayedRegions[index]\n      if (foundRegion) {\n        return Math.round(offsetBp / self.bpPerPx)\n      }\n\n      return undefined\n    },\n\n    pxToBp(px: number) {\n      let bpSoFar = 0\n      const bp = (self.offsetPx + px) * self.bpPerPx\n      const n = self.displayedRegions.length\n      if (bp < 0) {\n        const region = self.displayedRegions[0]\n        const offset = bp\n        return {\n          ...getSnapshot(region),\n          oob: true,\n          coord: region.reversed\n            ? Math.floor(region.end - offset) + 1\n            : Math.floor(region.start + offset) + 1,\n          offset,\n          index: 0,\n        }\n      }\n\n      const interRegionPaddingBp = self.interRegionPaddingWidth * self.bpPerPx\n      const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n\n      for (let index = 0; index < self.displayedRegions.length; index += 1) {\n        const region = self.displayedRegions[index]\n        const len = region.end - region.start\n        const offset = bp - bpSoFar\n        if (len + bpSoFar > bp && bpSoFar <= bp) {\n          return {\n            ...getSnapshot(region),\n            oob: false,\n            offset,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            index,\n          }\n        }\n\n        // add the interRegionPaddingWidth if the boundary is in the screen\n        // e.g. offset>0 && offset<width\n        if (\n          region.end - region.start > minimumBlockBp &&\n          offset / self.bpPerPx > 0 &&\n          offset / self.bpPerPx < this.width\n        ) {\n          bpSoFar += len + interRegionPaddingBp\n        } else {\n          bpSoFar += len\n        }\n      }\n\n      if (bp >= bpSoFar) {\n        const region = self.displayedRegions[n - 1]\n        const len = region.end - region.start\n        const offset = bp - bpSoFar + len\n        return {\n          ...getSnapshot(region),\n          oob: true,\n          offset,\n          coord: region.reversed\n            ? Math.floor(region.end - offset) + 1\n            : Math.floor(region.start + offset) + 1,\n          index: n - 1,\n        }\n      }\n      return {\n        coord: 0,\n        index: 0,\n        start: 0,\n        refName: '',\n        oob: true,\n        assemblyName: '',\n        offset: 0,\n        reversed: false,\n      }\n    },\n  }))\n  .views(self => ({\n    get dynamicBlocks() {\n      return calculateDynamicBlocks(self)\n    },\n    get staticBlocks() {\n      return calculateStaticBlocks(self)\n    },\n    get currBp() {\n      return this.dynamicBlocks\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n  }))\n  .actions(self => ({\n    setFeatures(features: Feature[]) {\n      self.features = features\n    },\n\n    zoomToDisplayedRegions(\n      leftPx: BpOffset | undefined,\n      rightPx: BpOffset | undefined,\n    ) {\n      if (leftPx === undefined || rightPx === undefined) {\n        return\n      }\n\n      const singleRefSeq =\n        leftPx.refName === rightPx.refName && leftPx.index === rightPx.index\n      // zooming into one displayed Region\n      if (\n        (singleRefSeq && rightPx.offset < leftPx.offset) ||\n        leftPx.index > rightPx.index\n      ) {\n        ;[leftPx, rightPx] = [rightPx, leftPx]\n      }\n      const startOffset = {\n        start: leftPx.start,\n        end: leftPx.end,\n        index: leftPx.index,\n        offset: leftPx.offset,\n      }\n      const endOffset = {\n        start: rightPx.start,\n        end: rightPx.end,\n        index: rightPx.index,\n        offset: rightPx.offset,\n      }\n      if (startOffset && endOffset) {\n        this.moveTo(startOffset, endOffset)\n      } else {\n        throw new Error('regions not found')\n      }\n    },\n\n    // this makes a zoomed out view that shows all displayedRegions\n    // that makes the overview bar square with the scale bar\n    showAllRegions() {\n      self.bpPerPx = self.totalBp / self.width\n      self.offsetPx = 0\n    },\n    /**\n     * offset is the base-pair-offset in the displayed region, index is the index of the\n     * displayed region in the linear genome view\n     *\n     * @param start - object as `{start, end, offset, index}`\n     * @param end - object as `{start, end, offset, index}`\n     */\n    moveTo(start: BpOffset, end: BpOffset) {\n      // find locations in the modellist\n      let bpSoFar = 0\n\n      if (start.index === end.index) {\n        bpSoFar += end.offset - start.offset\n      } else {\n        const s = self.displayedRegions[start.index]\n        bpSoFar += s.end - s.start - start.offset\n        if (end.index - start.index >= 2) {\n          for (let i = start.index + 1; i < end.index; i += 1) {\n            bpSoFar +=\n              self.displayedRegions[i].end - self.displayedRegions[i].start\n          }\n        }\n        bpSoFar += end.offset\n      }\n      this.zoomTo(\n        bpSoFar /\n          (self.width -\n            self.interRegionPaddingWidth * (end.index - start.index)),\n      )\n\n      let bpToStart = 0\n      for (let i = 0; i < self.displayedRegions.length; i += 1) {\n        const region = self.displayedRegions[i]\n        if (start.index === i) {\n          bpToStart += start.offset\n          break\n        } else {\n          bpToStart += region.end - region.start\n        }\n      }\n      self.offsetPx =\n        Math.round(bpToStart / self.bpPerPx) +\n        self.interRegionPaddingWidth * start.index\n    },\n\n    zoomOut() {\n      this.zoomTo(self.bpPerPx * 2)\n    },\n\n    zoomIn() {\n      this.zoomTo(self.bpPerPx / 2)\n    },\n\n    zoomTo(newBpPerPx: number, offset = self.width / 2) {\n      const bpPerPx = newBpPerPx\n      if (bpPerPx === self.bpPerPx) {\n        return\n      }\n      const oldBpPerPx = self.bpPerPx\n      self.bpPerPx = bpPerPx\n\n      // tweak the offset so that the center of the view remains at the same coordinate\n      self.offsetPx = clamp(\n        Math.round(((self.offsetPx + offset) * oldBpPerPx) / bpPerPx - offset),\n        self.minOffset,\n        self.maxOffset,\n      )\n    },\n\n    scroll(distance: number) {\n      const oldOffsetPx = self.offsetPx\n      // the scroll is clamped to keep the linear genome on the main screen\n      const newOffsetPx = clamp(\n        self.offsetPx + distance,\n        self.minOffset,\n        self.maxOffset,\n      )\n      self.offsetPx = newOffsetPx\n      return newOffsetPx - oldOffsetPx\n    },\n  }))\n\nexport type Base1DViewStateModel = typeof Base1DView\nexport type Base1DViewModel = Instance<Base1DViewStateModel>\n\nexport default Base1DView\n","import { ObservableMap } from 'mobx'\nimport { objectFromEntries } from '../index'\nimport {\n  RectTuple,\n  SerializedLayout,\n  Rectangle,\n  BaseLayout,\n} from './BaseLayout'\n\n/**\n * Rectangle-layout manager that lays out rectangles using bitmaps at\n * resolution that, for efficiency, may be somewhat lower than that of\n * the coordinate system for the rectangles being laid out.  `pitchX`\n * and `pitchY` are the ratios of input scale resolution to internal\n * bitmap resolution.\n */\n\n// minimum excess size of the array at which we garbage collect\nconst minSizeToBotherWith = 10000\nconst maxFeaturePitchWidth = 20000\n\nfunction segmentsIntersect(\n  x1: number,\n  x2: number,\n  y1: number,\n  y2: number,\n): boolean {\n  return x2 >= y1 && y2 >= x1\n}\n\ninterface RowState<T> {\n  min: number\n  max: number\n  offset: number\n  bits: (Record<string, T> | boolean | undefined)[]\n}\n// a single row in the layout\nclass LayoutRow<T> {\n  private padding: number\n\n  private allFilled?: Record<string, T> | boolean\n\n  private widthLimit: number\n\n  private rowState?: RowState<T>\n\n  constructor() {\n    this.padding = 1\n    this.widthLimit = 1000000\n\n    // this.rowState.offset is the offset of the bits array relative to the genomic coordinates\n    //      (modified by pitchX, but we don't know that in this class)\n    // this.rowState.bits is the array of items in the layout row, indexed by (x - this.offset)\n    // this.rowState.min is the leftmost edge of all the rectangles we have in the layout\n    // this.rowState.max is the rightmost edge of all the rectangles we have in the layout\n  }\n\n  // log(msg: string): void {\n  //   // if (this.rowNumber === 0)\n  //   // eslint-disable-next-line no-console\n  //   console.log(`r${this.rowNumber}: ${msg}`)\n  // }\n\n  setAllFilled(data: Record<string, T> | boolean): void {\n    this.allFilled = data\n  }\n\n  getItemAt(x: number): Record<string, T> | boolean | undefined {\n    if (this.allFilled) {\n      return this.allFilled\n    }\n    if (!this.rowState) {\n      return undefined\n    }\n\n    if (this.rowState.min === undefined) {\n      return undefined\n    }\n    if (x < this.rowState.min) {\n      return undefined\n    }\n    if (x >= this.rowState.max) {\n      return undefined\n    }\n    const offset = x - this.rowState.offset\n    // if (offset < 0)\n    //     debugger\n    // if (offset >= this.rowState.bits.length)\n    //     debugger\n    return this.rowState.bits[offset]\n  }\n\n  isRangeClear(left: number, right: number): boolean {\n    if (this.allFilled) {\n      return false\n    }\n\n    if (!this.rowState) {\n      return true\n    }\n\n    const { min, max } = this.rowState\n\n    if (right <= min || left >= max) {\n      return true\n    }\n\n    // TODO: check right and middle before looping\n    const maxX = Math.min(max, right)\n    let x = Math.max(min, left)\n    for (; x < right && x < maxX; x += 1) {\n      if (this.getItemAt(x)) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  initialize(left: number, right: number): RowState<T> {\n    // NOTE: this.rowState.min, this.rowState.max, and this.rowState.offset are interbase coordinates\n    const rectWidth = right - left\n    return {\n      offset: left - rectWidth,\n      min: left,\n      max: right,\n      bits: new Array(3 * rectWidth),\n    }\n    // this.log(`initialize ${this.rowState.min} - ${this.rowState.max} (${this.rowState.bits.length})`)\n  }\n\n  addRect(rect: Rectangle<T>, data: Record<string, T> | boolean): void {\n    const left = rect.l\n    const right = rect.r + this.padding // only padding on the right\n    if (!this.rowState) {\n      this.rowState = this.initialize(left, right)\n    }\n\n    // or check if we need to expand to the left and/or to the right\n\n    let oLeft = left - this.rowState.offset\n    let oRight = right - this.rowState.offset\n    const currLength = this.rowState.bits.length\n    // console.log(oRight, this.rowState.bits.length)\n\n    // expand rightward if necessary\n    if (oRight >= this.rowState.bits.length) {\n      const additionalLength = oRight + 1\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n        this.rowState = this.initialize(left, right)\n      } else if (additionalLength > 0) {\n        this.rowState.bits = this.rowState.bits.concat(\n          new Array(additionalLength),\n        )\n      }\n    }\n\n    // expand leftward if necessary\n    if (left < this.rowState.offset) {\n      // use math.min to avoid negative lengths\n      const additionalLength = Math.min(\n        currLength - oLeft,\n        this.rowState.offset,\n      )\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n\n        this.rowState = this.initialize(left, right)\n      } else {\n        this.rowState.bits = new Array(additionalLength).concat(\n          this.rowState.bits,\n        )\n        this.rowState.offset -= additionalLength\n      }\n    }\n    oRight = right - this.rowState.offset\n    oLeft = left - this.rowState.offset\n\n    // set the bits in the bitmask\n    // if (oLeft < 0) debugger\n    // if (oRight < 0) debugger\n    // if (oRight <= oLeft) debugger\n    // if (oRight > this.rowState.bits.length) debugger\n    if (oRight - oLeft > maxFeaturePitchWidth) {\n      console.warn(\n        `Layout X pitch set too low, feature spans ${\n          oRight - oLeft\n        } bits in a single row.`,\n        rect,\n        data,\n      )\n    }\n\n    for (let x = oLeft; x < oRight; x += 1) {\n      // if (this.rowState.bits[x] && this.rowState.bits[x].get('name') !== data.get('name')) debugger\n      this.rowState.bits[x] = data\n    }\n\n    if (left < this.rowState.min) {\n      this.rowState.min = left\n    }\n    if (right > this.rowState.max) {\n      this.rowState.max = right\n    }\n    // // this.log(`added ${leftX} - ${rightX}`)\n  }\n\n  /**\n   *  Given a range of interbase coordinates, deletes all data dealing with that range\n   */\n  discardRange(left: number, right: number): void {\n    if (this.allFilled) {\n      return\n    } // allFilled is irrevocable currently\n\n    // if we have no data, do nothing\n    if (!this.rowState) {\n      return\n    }\n\n    // if doesn't overlap at all, do nothing\n    if (right <= this.rowState.min || left >= this.rowState.max) {\n      return\n    }\n\n    // if completely encloses range, discard everything\n    if (left <= this.rowState.min && right >= this.rowState.max) {\n      this.rowState = undefined\n      return\n    }\n\n    // if overlaps left edge, adjust the min\n    if (right > this.rowState.min && left <= this.rowState.min) {\n      this.rowState.min = right\n    }\n\n    // if overlaps right edge, adjust the max\n    if (left < this.rowState.max && right >= this.rowState.max) {\n      this.rowState.max = left\n    }\n\n    // now trim the left, right, or both sides of the array\n    if (\n      this.rowState.offset < this.rowState.min - minSizeToBotherWith &&\n      this.rowState.bits.length >\n        this.rowState.max + minSizeToBotherWith - this.rowState.offset\n    ) {\n      // trim both sides\n      const leftTrimAmount = this.rowState.min - this.rowState.offset\n      const rightTrimAmount =\n        this.rowState.bits.length -\n        1 -\n        (this.rowState.max - this.rowState.offset)\n      // if (rightTrimAmount <= 0) debugger\n      // if (leftTrimAmount <= 0) debugger\n      // this.log(`trim both sides, ${leftTrimAmount} from left, ${rightTrimAmount} from right`)\n      this.rowState.bits = this.rowState.bits.slice(\n        leftTrimAmount,\n        this.rowState.bits.length - rightTrimAmount,\n      )\n      this.rowState.offset += leftTrimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (this.rowState.offset < this.rowState.min - minSizeToBotherWith) {\n      // trim left side\n      const desiredOffset =\n        this.rowState.min - Math.floor(minSizeToBotherWith / 2)\n      const trimAmount = desiredOffset - this.rowState.offset\n      // this.log(`trim left side by ${trimAmount}`)\n      this.rowState.bits.splice(0, trimAmount)\n      this.rowState.offset += trimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (\n      this.rowState.bits.length >\n      this.rowState.max - this.rowState.offset + minSizeToBotherWith\n    ) {\n      // trim right side\n      const desiredLength =\n        this.rowState.max -\n        this.rowState.offset +\n        1 +\n        Math.floor(minSizeToBotherWith / 2)\n      // this.log(`trim right side by ${this.rowState.bits.length-desiredLength}`)\n      // if (desiredLength > this.rowState.bits.length) debugger\n      this.rowState.bits.length = desiredLength\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    }\n\n    // if (this.rowState.offset > this.rowState.min) debugger\n    // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n\n    // if range now enclosed in the new bounds, loop through and clear the bits\n    const oLeft = Math.max(this.rowState.min, left) - this.rowState.offset\n    // if (oLeft < 0) debugger\n    // if (oLeft >= this.rowState.bits.length) debugger\n    // if (oRight < 0) debugger\n    // if (oRight >= this.rowState.bits.length) debugger\n\n    const oRight = Math.min(right, this.rowState.max) - this.rowState.offset\n    for (let x = oLeft; x >= 0 && x < oRight; x += 1) {\n      this.rowState.bits[x] = undefined\n    }\n  }\n}\n\nexport default class GranularRectLayout<T> implements BaseLayout<T> {\n  private pitchX: number\n\n  private pitchY: number\n\n  private hardRowLimit: number\n\n  private bitmap: LayoutRow<T>[]\n\n  private rectangles: ObservableMap<string, Rectangle<T>>\n\n  public maxHeightReached: boolean\n\n  private maxHeight: number\n\n  private displayMode: string\n\n  private pTotalHeight: number\n\n  constructor({\n    pitchX = 10,\n    pitchY = 10,\n    maxHeight = 10000,\n    hardRowLimit = 3000,\n    displayMode = 'normal',\n  }: {\n    /** layout grid pitch in the X direction */\n    pitchX?: number\n    /** layout grid pitch in the Y direction */\n    pitchY?: number\n    /** maximum layout height, default Infinity (no max) */\n    maxHeight?: number\n    displayMode?: string\n    hardRowLimit?: number\n  } = {}) {\n    this.pitchX = pitchX\n    this.pitchY = pitchY\n    this.hardRowLimit = hardRowLimit\n    this.maxHeightReached = false\n    this.displayMode = displayMode\n\n    // reduce the pitchY to try and pack the features tighter\n    if (this.displayMode === 'compact') {\n      this.pitchY = Math.round(this.pitchY / 4) || 1\n      this.pitchX = Math.round(this.pitchX / 4) || 1\n    }\n\n    this.bitmap = []\n    this.rectangles = new ObservableMap()\n    this.maxHeight = Math.ceil(maxHeight / this.pitchY)\n    this.pTotalHeight = 0 // total height, in units of bitmap squares (px/pitchY)\n  }\n\n  /**\n   * @returns top position for the rect, or Null if laying\n   *  out the rect would exceed maxHeight\n   */\n  addRect(\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data?: Record<string, T>,\n  ): number | null {\n    // if we have already laid it out, return its layout\n    // console.log(`${this.id} add ${id}`)\n    const storedRec = this.rectangles.get(id)\n    if (storedRec) {\n      if (storedRec.top === null) {\n        return null\n      }\n\n      // add it to the bitmap again, since that bitmap range may have been discarded\n      this.addRectToBitmap(storedRec)\n      return storedRec.top * this.pitchY\n    }\n\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const pHeight = Math.ceil(height / this.pitchY)\n\n    // const midX = Math.floor((pLeft + pRight) / 2)\n    const rectangle: Rectangle<T> = {\n      id,\n      l: pLeft,\n      r: pRight,\n      top: null,\n      // mX: midX,\n      h: pHeight,\n      originalHeight: height,\n      data,\n    }\n\n    const maxTop = this.maxHeight - pHeight\n    let top = 0\n    if (this.displayMode !== 'collapse') {\n      for (; top <= maxTop; top += 1) {\n        if (!this.collides(rectangle, top)) {\n          break\n        }\n      }\n\n      if (top > maxTop) {\n        rectangle.top = null\n        this.rectangles.set(id, rectangle)\n        this.maxHeightReached = true\n        return null\n      }\n    }\n    rectangle.top = top\n    this.addRectToBitmap(rectangle)\n    this.rectangles.set(id, rectangle)\n    this.pTotalHeight = Math.max(this.pTotalHeight || 0, top + pHeight)\n    // console.log(`G2 ${data.get('name')} ${top}`)\n    return top * this.pitchY\n  }\n\n  collides(rect: Rectangle<T>, top: number): boolean {\n    const { bitmap } = this\n    // var mY = top + rect.h/2; // Y midpoint: ( top+height  + top ) / 2\n\n    // test exhaustively\n    const maxY = top + rect.h\n    for (let y = top; y < maxY; y += 1) {\n      const row = bitmap[y]\n      if (row && !row.isRangeClear(rect.l, rect.r)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * make a subarray if it does not exist\n   */\n  private autovivifyRow(bitmap: LayoutRow<T>[], y: number): LayoutRow<T> {\n    let row = bitmap[y]\n    if (!row) {\n      if (y > this.hardRowLimit) {\n        throw new Error(\n          `layout hard limit (${\n            this.hardRowLimit * this.pitchY\n          }px) exceeded, aborting layout`,\n        )\n      }\n      row = new LayoutRow()\n      bitmap[y] = row\n    }\n    return row\n  }\n\n  addRectToBitmap(rect: Rectangle<T>): void {\n    if (rect.top === null) {\n      return\n    }\n\n    const data = rect.data || true\n    const { bitmap } = this\n    const yEnd = rect.top + rect.h\n    if (rect.r - rect.l > maxFeaturePitchWidth) {\n      // the rect is very big in relation to the view size, just\n      // pretend, for the purposes of layout, that it extends\n      // infinitely.  this will cause weird layout if a user\n      // scrolls manually for a very, very long time along the\n      // genome at the same zoom level.  but most users will not\n      // do that.  hopefully.\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(bitmap, y).setAllFilled(data)\n      }\n    } else {\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(bitmap, y).addRect(rect, data)\n      }\n    }\n  }\n\n  /**\n   *  Given a range of X coordinates, deletes all data dealing with\n   *  the features.\n   */\n  discardRange(left: number, right: number): void {\n    // console.log( 'discard', left, right );\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const { bitmap } = this\n    for (let y = 0; y < bitmap.length; y += 1) {\n      const row = bitmap[y]\n      if (row) {\n        row.discardRange(pLeft, pRight)\n      }\n    }\n  }\n\n  hasSeen(id: string): boolean {\n    return this.rectangles.has(id)\n  }\n\n  getByCoord(x: number, y: number): Record<string, T> | boolean | undefined {\n    const pY = Math.floor(y / this.pitchY)\n    const row = this.bitmap[pY]\n    if (!row) {\n      return undefined\n    }\n    const pX = Math.floor(x / this.pitchX)\n    return row.getItemAt(pX)\n  }\n\n  getByID(id: string): (Record<string, T> | boolean) | undefined {\n    const r = this.rectangles.get(id)\n    if (r) {\n      return r.data || true\n    }\n    return undefined\n  }\n\n  cleanup(): void {}\n\n  getTotalHeight(): number {\n    return this.pTotalHeight * this.pitchY\n  }\n\n  get totalHeight() {\n    return this.getTotalHeight()\n  }\n\n  getRectangles(): Map<string, RectTuple> {\n    return new Map(\n      Array.from(this.rectangles.entries()).map(([id, rect]) => {\n        const { l, r, originalHeight, top } = rect\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        return [id, [l * this.pitchX, t, r * this.pitchX, b]] // left, top, right, bottom\n      }),\n    )\n  }\n\n  serializeRegion(region: { start: number; end: number }): SerializedLayout {\n    const regionRectangles: { [key: string]: RectTuple } = {}\n    let maxHeightReached = false\n    for (const [id, rect] of this.rectangles.entries()) {\n      const { l, r, originalHeight, top } = rect\n      if (rect.top === null) {\n        maxHeightReached = true\n      } else {\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        const y1 = l * this.pitchX\n        const y2 = r * this.pitchX\n        const x1 = region.start\n        const x2 = region.end\n        // add +/- pitchX to avoid resolution causing errors\n        if (segmentsIntersect(x1, x2, y1 - this.pitchX, y2 + this.pitchX)) {\n          regionRectangles[id] = [y1, t, y2, b]\n        }\n      }\n    }\n    return {\n      rectangles: regionRectangles,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached,\n    }\n  }\n\n  toJSON(): SerializedLayout {\n    const rectangles = objectFromEntries(this.getRectangles())\n    return {\n      rectangles,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached: this.maxHeightReached,\n    }\n  }\n}\n","import { objectFromEntries } from '..'\nimport {\n  RectTuple,\n  SerializedLayout,\n  BaseLayout,\n  Rectangle,\n} from './BaseLayout'\n\nexport default class PrecomputedLayout<T> implements BaseLayout<T> {\n  private rectangles: Map<string, RectTuple>\n\n  private totalHeight: number\n\n  public maxHeightReached: boolean\n\n  constructor({ rectangles, totalHeight, maxHeightReached }: SerializedLayout) {\n    this.rectangles = new Map(Object.entries(rectangles))\n    // rectangles is of the form \"featureId\": [leftPx, topPx, rightPx, bottomPx]\n    this.totalHeight = totalHeight\n    this.maxHeightReached = maxHeightReached\n  }\n\n  addRect(id: string) {\n    const rect = this.rectangles.get(id)\n    if (!rect) {\n      throw new Error(`id ${id} not found in precomputed feature layout`)\n    }\n    // left, top, right, bottom\n    return rect[1]\n  }\n\n  /**\n   * returns a Map of `feature id -> rectangle`\n   */\n  getRectangles(): Map<string, RectTuple> {\n    return this.rectangles\n  }\n\n  getTotalHeight(): number {\n    return this.totalHeight\n  }\n\n  collides(_rect: Rectangle<T>, _top: number): boolean {\n    throw new Error('Method not implemented.')\n  }\n\n  addRectToBitmap(_rect: Rectangle<T>, _data: Record<string, T>): void {\n    throw new Error('Method not implemented.')\n  }\n\n  discardRange(_left: number, _right: number): void {\n    throw new Error('Method not implemented.')\n  }\n\n  serializeRegion(_region: { start: number; end: number }): SerializedLayout {\n    throw new Error('Method not implemented.')\n  }\n\n  toJSON(): SerializedLayout {\n    return {\n      rectangles: objectFromEntries(this.rectangles),\n      totalHeight: this.totalHeight,\n      maxHeightReached: false,\n    }\n  }\n}\n","import deepEqual from 'fast-deep-equal'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\nimport GranularRectLayout from '../../util/layouts/GranularRectLayout'\nimport MultiLayout from '../../util/layouts/MultiLayout'\nimport PrecomputedLayout from '../../util/layouts/PrecomputedLayout'\nimport FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsSerialized as FeatureRenderArgsSerialized,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderResults as FeatureRenderResults,\n  ResultsSerialized as FeatureResultsSerialized,\n  ResultsDeserialized as FeatureResultsDeserialized,\n} from './FeatureRendererType'\nimport { Region } from '../../util/types'\nimport { Feature } from '../../util/simpleFeature'\nimport { SerializedLayout, BaseLayout } from '../../util/layouts/BaseLayout'\nimport { readConfObject, isConfigurationModel } from '../../configuration'\nimport SerializableFilterChain from './util/serializableFilterChain'\nimport RpcManager from '../../rpc/RpcManager'\n\ninterface LayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport class LayoutSession implements LayoutSessionProps {\n  config: AnyConfigurationModel\n\n  bpPerPx: number\n\n  filters: SerializableFilterChain\n\n  constructor(args: LayoutSessionProps) {\n    this.config = args.config\n    if (!isConfigurationModel(this.config)) {\n      throw new Error('configuration required')\n    }\n    this.bpPerPx = args.bpPerPx\n    this.filters = args.filters\n    this.update(args)\n  }\n\n  update(props: LayoutSessionProps) {\n    Object.assign(this, props)\n  }\n\n  makeLayout() {\n    return new MultiLayout(GranularRectLayout, {\n      maxHeight: readConfObject(this.config, 'maxHeight'),\n      displayMode: readConfObject(this.config, 'displayMode'),\n      pitchX: this.bpPerPx,\n      pitchY: readConfObject(this.config, 'noSpacing') ? 1 : 3,\n    })\n  }\n\n  /**\n   * @param layout -\n   * @returns true if the given layout is a valid one to use for this session\n   */\n  cachedLayoutIsValid(cachedLayout: CachedLayout) {\n    return (\n      cachedLayout &&\n      cachedLayout.layout.subLayoutConstructorArgs.pitchX === this.bpPerPx &&\n      deepEqual(readConfObject(this.config), cachedLayout.config) &&\n      deepEqual(this.filters, cachedLayout.filters)\n    )\n  }\n\n  cachedLayout: CachedLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n\n/// *****************************************************************************\n/// *****************************************************************************\n/// *****************************************************************************\n\nexport interface RenderArgs extends FeatureRenderArgs {\n  bpPerPx: number\n}\n\nexport interface RenderArgsSerialized extends FeatureRenderArgsSerialized {\n  bpPerPx: number\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n}\n\nexport interface RenderResults extends FeatureRenderResults {\n  layout: BaseLayout<Feature>\n}\n\nexport interface ResultsSerialized extends FeatureResultsSerialized {\n  maxHeightReached: boolean\n  layout: SerializedLayout\n}\n\nexport interface ResultsDeserialized extends FeatureResultsDeserialized {\n  maxHeightReached: boolean\n  layout: PrecomputedLayout<string>\n}\n\nexport default class BoxRendererType extends FeatureRendererType {\n  sessions: { [sessionId: string]: LayoutSession } = {}\n\n  getWorkerSession(props: LayoutSessionProps & { sessionId: string }) {\n    const { sessionId } = props\n    if (!this.sessions[sessionId]) {\n      this.sessions[sessionId] = this.createSession(props)\n    }\n    const session = this.sessions[sessionId]\n    session.update(props)\n    return session\n  }\n\n  // expands region for glyphs to use\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    if (!region) {\n      return region\n    }\n    const { bpPerPx, config } = renderArgs\n    const maxFeatureGlyphExpansion =\n      config === undefined\n        ? 0\n        : readConfObject(config, 'maxFeatureGlyphExpansion')\n    if (!maxFeatureGlyphExpansion) {\n      return region\n    }\n    const bpExpansion = Math.round(maxFeatureGlyphExpansion * bpPerPx)\n    return {\n      ...region,\n      start: Math.floor(Math.max(region.start - bpExpansion, 0)),\n      end: Math.ceil(region.end + bpExpansion),\n    }\n  }\n\n  createSession(props: LayoutSessionProps) {\n    return new LayoutSession(props)\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const { sessionId, regions } = args\n    let freed = 0\n    const session = this.sessions[sessionId]\n    if (!regions && session) {\n      delete this.sessions[sessionId]\n      freed = 1\n    }\n    if (session && regions) {\n      session.layout.discardRange(\n        regions[0].refName,\n        regions[0].start,\n        regions[0].end,\n      )\n    }\n    return freed + (await super.freeResourcesInClient(rpcManager, args))\n  }\n\n  deserializeLayoutInClient(json: SerializedLayout) {\n    return new PrecomputedLayout(json)\n  }\n\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const layout = this.deserializeLayoutInClient(result.layout)\n    const deserialized = super.deserializeResultsInClient(\n      { ...result, layout } as FeatureResultsSerialized,\n      args,\n    ) as ResultsDeserialized\n\n    // // debugging aid: check if there are features in `features` that are not in the layout\n    // const featureIds1 = iterMap(deserialized.features.values(), f =>\n    //   f.id(),\n    // ).sort()\n    // const featureIds2 = Object.keys(\n    //   deserialized.layout.toJSON().rectangles,\n    // ).sort()\n    // if (\n    //   featureIds1.length > featureIds2.length &&\n    //   !deserialized.layout.maxHeightReached\n    // )\n    //   debugger\n\n    return deserialized\n  }\n\n  createLayoutInWorker(args: RenderArgsDeserialized) {\n    const { regions } = args\n    const session = this.getWorkerSession(args)\n    const subLayout = session.layout.getSublayout(regions[0].refName)\n    return subLayout\n  }\n\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(\n      results,\n      args,\n    ) as ResultsSerialized\n\n    const [region] = args.regions\n    serialized.layout = results.layout.serializeRegion(\n      this.getExpandedRegion(region, args),\n    )\n    if (serialized.layout.rectangles) {\n      serialized.features = serialized.features.filter(f => {\n        return Boolean(serialized.layout.rectangles[f.uniqueId])\n      })\n    }\n\n    serialized.maxHeightReached = serialized.layout.maxHeightReached\n    return serialized\n  }\n\n  /**\n   * gets layout and renders\n   *\n   * @param props - render args\n   */\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const layout =\n      (props.layout as undefined | BaseLayout<unknown>) ||\n      this.createLayoutInWorker(props)\n    const result = await super.render({ ...props, layout })\n    return { ...result, layout }\n  }\n}\n","/* eslint-disable react/prop-types */\nimport React, { useRef, useState, useEffect } from 'react'\nimport { Button, Select, MenuItem, Typography } from '@material-ui/core'\nimport { useInView } from 'react-intersection-observer'\nimport copy from 'copy-to-clipboard'\nimport {\n  defaultCodonTable,\n  generateCodonTable,\n  revcom,\n  getSession,\n} from '../util'\nimport { BaseProps } from './types'\nimport { getConf } from '../configuration'\nimport { Feature, SimpleFeatureSerialized } from '../util/simpleFeature'\n\ninterface Feat {\n  start: number\n  end: number\n  type: string\n}\ninterface ParentFeat extends Feat {\n  strand?: number\n  subfeatures?: Feat[]\n}\n\nfunction stitch(subfeats: Feat[], sequence: string) {\n  return subfeats.map(sub => sequence.slice(sub.start, sub.end)).join('')\n}\n\n// filter if they have the same ID\nfunction filterId(feat: Feat) {\n  return `${feat.start}-${feat.end}`\n}\n\n// filters if successive elements share same start/end\nfunction dedupe(list: Feat[]) {\n  return list.filter(\n    (item, pos, ary) => !pos || filterId(item) !== filterId(ary[pos - 1]),\n  )\n}\n\nfunction revlist(list: Feat[], seqlen: number) {\n  return list\n    .map(sub => ({\n      ...sub,\n      start: seqlen - sub.end,\n      end: seqlen - sub.start,\n    }))\n    .sort((a, b) => a.start - b.start)\n}\n\n// note that these are currently put into the style section instead of being\n// defined in classes to aid copy and paste to an external document e.g. word\nconst proteinColor = 'rgb(220,160,220)'\nconst intronColor = undefined\nconst cdsColor = 'rgb(220,220,180)'\nconst updownstreamColor = 'rgba(250,200,200)'\nconst utrColor = 'rgb(200,240,240)'\n\nfunction GeneCDS(props: { cds: Feat[]; sequence: string }) {\n  const { cds, sequence } = props\n\n  return <span style={{ background: cdsColor }}>{stitch(cds, sequence)}</span>\n}\n\nfunction GeneProtein(props: {\n  cds: Feat[]\n  sequence: string\n  codonTable: { [key: string]: string }\n}) {\n  const { cds, sequence, codonTable } = props\n  const str = stitch(cds, sequence)\n  let protein = ''\n  for (let i = 0; i < str.length; i += 3) {\n    // use & symbol for undefined codon, or partial slice\n    protein += codonTable[str.slice(i, i + 3)] || '&'\n  }\n\n  return <span style={{ background: proteinColor }}>{protein}</span>\n}\n\nfunction GenecDNA(props: {\n  utr: Feat[]\n  cds: Feat[]\n  exons: Feat[]\n  sequence: string\n  upstream?: string\n  downstream?: string\n  includeIntrons?: boolean\n  collapseIntron?: boolean\n}) {\n  const {\n    utr,\n    cds,\n    exons,\n    sequence,\n    upstream,\n    downstream,\n    includeIntrons,\n    collapseIntron,\n  } = props\n  const chunks = cds.length\n    ? [...cds, ...utr].sort((a, b) => a.start - b.start)\n    : exons\n  return (\n    <>\n      {upstream ? (\n        <span style={{ background: updownstreamColor }}>{upstream}</span>\n      ) : null}\n\n      {chunks.map((chunk, index) => {\n        const intron = sequence.slice(chunk.end, chunks[index + 1]?.start)\n        return (\n          <React.Fragment key={JSON.stringify(chunk)}>\n            <span\n              style={{ background: chunk.type === 'CDS' ? cdsColor : utrColor }}\n            >\n              {sequence.slice(chunk.start, chunk.end)}\n            </span>\n            {includeIntrons ? (\n              <span style={{ background: intronColor }}>\n                {collapseIntron && intron.length > 20\n                  ? `${intron.slice(0, 10)}...${intron.slice(-10)}`\n                  : intron}\n              </span>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n\n      {downstream ? (\n        <span style={{ background: updownstreamColor }}>{downstream}</span>\n      ) : null}\n    </>\n  )\n}\n\n// calculates UTRs using impliedUTRs logic\nfunction calculateUTRs(cds: Feat[], exons: Feat[]) {\n  const firstCds = cds[0]\n  const lastCds = cds[cds.length - 1]\n  const firstCdsIdx = exons.findIndex(\n    exon => exon.end >= firstCds.start && exon.start <= firstCds.start,\n  )\n  const lastCdsIdx = exons.findIndex(\n    exon => exon.end >= lastCds.end && exon.start <= lastCds.end,\n  )\n  const lastCdsExon = exons[lastCdsIdx]\n  const firstCdsExon = exons[firstCdsIdx]\n\n  const fiveUTRs = [\n    ...exons.slice(0, firstCdsIdx),\n    { start: firstCdsExon.start, end: firstCds.start },\n  ].map(elt => ({ ...elt, type: 'five_prime_UTR' }))\n\n  const threeUTRs = [\n    { start: lastCds.end, end: lastCdsExon.end },\n    ...exons.slice(lastCdsIdx),\n  ].map(elt => ({ ...elt, type: 'three_prime_UTR' }))\n\n  return [...fiveUTRs, ...threeUTRs]\n}\n\nexport const SequencePanel = React.forwardRef<\n  HTMLDivElement,\n  {\n    sequence: { seq: string; upstream: string; downstream: string }\n    feature: ParentFeat\n    mode: string\n  }\n>((props, ref) => {\n  const { feature, mode } = props\n  let {\n    sequence: { seq: sequence, upstream = '', downstream = '' },\n  } = props\n\n  const { subfeatures } = feature\n  const codonTable = generateCodonTable(defaultCodonTable)\n\n  if (!subfeatures) {\n    return null\n  }\n\n  const children = subfeatures\n    .sort((a, b) => a.start - b.start)\n    .map(sub => {\n      return {\n        ...sub,\n        start: sub.start - feature.start,\n        end: sub.end - feature.start,\n      }\n    })\n\n  // we filter duplicate entries in cds and exon lists duplicate entries may be\n  // rare but was seen in Gencode v36 track NCList, likely a bug on GFF3 or\n  // probably worth ignoring here (produces broken protein translations if\n  // included)\n  //\n  // position 1:224,800,006..225,203,064 gene ENSG00000185842.15 first\n  // transcript ENST00000445597.6\n  //\n  // http://localhost:3000/?config=test_data%2Fconfig.json&session=share-FUl7G1isvF&password=HXh5Y\n\n  let cds = dedupe(children.filter(sub => sub.type === 'CDS'))\n  let utr = dedupe(children.filter(sub => sub.type.match(/utr/i)))\n  let exons = dedupe(children.filter(sub => sub.type === 'exon'))\n\n  if (!utr.length && cds.length && exons.length) {\n    utr = calculateUTRs(cds, exons)\n  }\n\n  if (feature.strand === -1) {\n    // doing this in a single assignment is needed because downstream and\n    // upstream are swapped so this avoids a temp variable\n    ;[sequence, upstream, downstream] = [\n      revcom(sequence),\n      revcom(downstream),\n      revcom(upstream),\n    ]\n    cds = revlist(cds, sequence.length)\n    exons = revlist(exons, sequence.length)\n    utr = revlist(utr, sequence.length)\n  }\n\n  return (\n    <div ref={ref} data-testid=\"sequence_panel\">\n      {mode === 'cds' ? (\n        <GeneCDS cds={cds} sequence={sequence} />\n      ) : mode === 'cdna' ? (\n        <GenecDNA exons={exons} cds={cds} utr={utr} sequence={sequence} />\n      ) : mode === 'protein' ? (\n        <GeneProtein cds={cds} codonTable={codonTable} sequence={sequence} />\n      ) : mode === 'gene' ? (\n        <GenecDNA\n          exons={exons}\n          cds={cds}\n          utr={utr}\n          sequence={sequence}\n          includeIntrons\n        />\n      ) : mode === 'gene_collapsed_intron' ? (\n        <GenecDNA\n          exons={exons}\n          cds={cds}\n          sequence={sequence}\n          utr={utr}\n          includeIntrons\n          collapseIntron\n        />\n      ) : mode === 'gene_updownstream' ? (\n        <GenecDNA\n          exons={exons}\n          cds={cds}\n          sequence={sequence}\n          utr={utr}\n          upstream={upstream}\n          downstream={downstream}\n          includeIntrons\n        />\n      ) : mode === 'gene_updownstream_collapsed_intron' ? (\n        <GenecDNA\n          exons={exons}\n          cds={cds}\n          sequence={sequence}\n          utr={utr}\n          upstream={upstream}\n          downstream={downstream}\n          includeIntrons\n          collapseIntron\n        />\n      ) : (\n        <div>Unknown type</div>\n      )}\n    </div>\n  )\n})\n\n// display the stitched-together sequence of a gene's CDS, cDNA, or protein\n// sequence. this is a best effort and weird genomic phenomena could lead these\n// to not be 100% accurate\nexport default function SequenceFeatureDetails(props: BaseProps) {\n  const { model, feature } = props\n  const parentFeature = (feature as unknown) as ParentFeat\n  const hasCDS = parentFeature.subfeatures?.find(sub => sub.type === 'CDS')\n  const seqPanelRef = useRef<HTMLDivElement>(null)\n\n  const { ref, inView } = useInView()\n  const [sequence, setSequence] = useState<{\n    seq: string\n    upstream: string\n    downstream: string\n  }>()\n  const [error, setError] = useState<string>()\n  const [mode, setMode] = useState(hasCDS ? 'cds' : 'cdna')\n  const [copied, setCopied] = useState(false)\n\n  useEffect(() => {\n    let finished = false\n    if (!model || !inView) {\n      return () => {}\n    }\n    const { assemblyManager, rpcManager } = getSession(model)\n    const [assemblyName] = model.view?.assemblyNames || []\n    async function fetchSeq(start: number, end: number, refName: string) {\n      const assembly = await assemblyManager.waitForAssembly(assemblyName)\n      if (!assembly) {\n        throw new Error('assembly not found')\n      }\n      const sessionId = 'getSequence'\n      const feats = await rpcManager.call(sessionId, 'CoreGetFeatures', {\n        adapterConfig: getConf(assembly, ['sequence', 'adapter']),\n        sessionId,\n        region: {\n          start,\n          end,\n          refName: assembly.getCanonicalRefName(refName),\n        },\n      })\n\n      const [feat] = feats as Feature[]\n      if (!feat) {\n        throw new Error(\n          `sequence not found for feature with refName:${refName}`,\n        )\n      }\n      return feat.get('seq') as string\n    }\n    ;(async () => {\n      try {\n        const {\n          start: s,\n          end: e,\n          refName,\n        } = feature as SimpleFeatureSerialized & {\n          refName: string\n          start: number\n          end: number\n        }\n        const seq = await fetchSeq(s, e, refName)\n        const upstream = await fetchSeq(Math.max(0, s - 500), s, refName)\n        const downstream = await fetchSeq(e, e + 500, refName)\n        if (!finished) {\n          setSequence({ seq, upstream, downstream })\n        }\n      } catch (e) {\n        setError(e)\n      }\n    })()\n\n    return () => {\n      finished = true\n    }\n  }, [feature, inView, model])\n\n  const loading = !sequence\n\n  return (\n    <div ref={ref}>\n      <Select\n        value={mode}\n        onChange={event => setMode(event.target.value as string)}\n      >\n        {hasCDS ? <MenuItem value=\"cds\">CDS</MenuItem> : null}\n        {hasCDS ? <MenuItem value=\"protein\">Protein</MenuItem> : null}\n        <MenuItem value=\"gene\">Gene w/ introns</MenuItem>\n        <MenuItem value=\"gene_collapsed_intron\">\n          Gene w/ 10bp of intron\n        </MenuItem>\n        <MenuItem value=\"gene_updownstream\">\n          Gene w/ 500bp up+down stream\n        </MenuItem>\n        <MenuItem value=\"gene_updownstream_collapsed_intron\">\n          Gene w/ 500bp up+down stream w/ 10bp intron\n        </MenuItem>\n        <MenuItem value=\"cdna\">cDNA</MenuItem>\n      </Select>\n      <Button\n        type=\"button\"\n        variant=\"contained\"\n        onClick={() => {\n          if (seqPanelRef.current) {\n            copy(seqPanelRef.current.innerHTML, { format: 'text/html' })\n            setCopied(true)\n            setTimeout(() => {\n              setCopied(false)\n            }, 1000)\n          }\n        }}\n      >\n        {copied ? 'Copied to clipboard!' : 'Copy'}\n      </Button>\n      <div data-testid=\"feature_sequence\">\n        {error ? (\n          <Typography color=\"error\">{`${error}`}</Typography>\n        ) : loading ? (\n          <div>Loading gene sequence...</div>\n        ) : sequence ? (\n          <div style={{ fontFamily: 'monospace', wordWrap: 'break-word' }}>\n            <SequencePanel\n              ref={seqPanelRef}\n              feature={parentFeature}\n              mode={mode}\n              sequence={sequence}\n            />\n          </div>\n        ) : (\n          <div>No sequence found</div>\n        )}\n      </div>\n    </div>\n  )\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any,react/prop-types */\nimport React from 'react'\nimport { ErrorBoundary } from 'react-error-boundary'\nimport {\n  Accordion,\n  AccordionDetails,\n  AccordionSummary,\n  Typography,\n  Divider,\n  Tooltip,\n} from '@material-ui/core'\nimport ExpandMore from '@material-ui/icons/ExpandMore'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { DataGrid } from '@material-ui/data-grid'\nimport { observer } from 'mobx-react'\nimport clsx from 'clsx'\nimport isObject from 'is-object'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { getConf } from '../configuration'\nimport { measureText, getSession } from '../util'\nimport SanitizedHTML from '../ui/SanitizedHTML'\nimport SequenceFeatureDetails from './SequenceFeatureDetails'\nimport { BaseCardProps, BaseProps } from './types'\nimport { SimpleFeatureSerialized } from '../util/simpleFeature'\n\n// these are always omitted as too detailed\nconst globalOmit = [\n  'length',\n  'position',\n  'subfeatures',\n  'uniqueId',\n  'exonFrames',\n  'parentId',\n  'thickStart',\n  'thickEnd',\n]\n\n// coreDetails are omitted in some circumstances\nconst coreDetails = [\n  'name',\n  'start',\n  'end',\n  'strand',\n  'refName',\n  'description',\n  'type',\n]\n\nexport const useStyles = makeStyles(theme => ({\n  expansionPanelDetails: {\n    display: 'block',\n    padding: theme.spacing(1),\n  },\n  expandIcon: {\n    color: '#FFFFFF',\n  },\n  paperRoot: {\n    background: theme.palette.grey[100],\n  },\n  field: {\n    display: 'flex',\n    flexWrap: 'wrap',\n  },\n  fieldDescription: {\n    '&:hover': {\n      background: 'yellow',\n    },\n  },\n  fieldName: {\n    wordBreak: 'break-all',\n    minWidth: '90px',\n    maxWidth: '150px',\n    borderBottom: '1px solid #0003',\n    background: theme.palette.grey[200],\n    marginRight: theme.spacing(1),\n    padding: theme.spacing(0.5),\n  },\n  fieldValue: {\n    wordBreak: 'break-word',\n    maxHeight: 300,\n    padding: theme.spacing(0.5),\n    overflow: 'auto',\n  },\n  fieldSubvalue: {\n    wordBreak: 'break-word',\n    maxHeight: 300,\n    padding: theme.spacing(0.5),\n    background: theme.palette.grey[100],\n    border: `1px solid ${theme.palette.grey[300]}`,\n    boxSizing: 'border-box',\n    overflow: 'auto',\n  },\n\n  accordionBorder: {\n    marginTop: '4px',\n    border: '1px solid #444',\n  },\n}))\n\nexport function BaseCard({\n  children,\n  title,\n  defaultExpanded = true,\n}: BaseCardProps) {\n  const classes = useStyles()\n  return (\n    <Accordion\n      className={classes.accordionBorder}\n      defaultExpanded={defaultExpanded}\n      TransitionProps={{ unmountOnExit: true }}\n    >\n      <AccordionSummary\n        expandIcon={<ExpandMore className={classes.expandIcon} />}\n      >\n        <Typography variant=\"button\"> {title}</Typography>\n      </AccordionSummary>\n      <AccordionDetails className={classes.expansionPanelDetails}>\n        {children}\n      </AccordionDetails>\n    </Accordion>\n  )\n}\n\nconst FieldName = ({\n  description,\n  name,\n  prefix = [],\n}: {\n  description?: React.ReactNode\n  name: string\n  prefix?: string[]\n}) => {\n  const classes = useStyles()\n  const val = [...prefix, name].join('.')\n  return description ? (\n    <Tooltip title={description} placement=\"left\">\n      <div className={clsx(classes.fieldDescription, classes.fieldName)}>\n        {val}\n      </div>\n    </Tooltip>\n  ) : (\n    <div className={classes.fieldName}>{val}</div>\n  )\n}\n\nconst BasicValue = ({ value }: { value: string | React.ReactNode }) => {\n  const classes = useStyles()\n  return (\n    <div className={classes.fieldValue}>\n      {React.isValidElement(value) ? (\n        value\n      ) : (\n        <SanitizedHTML\n          html={isObject(value) ? JSON.stringify(value) : String(value)}\n        />\n      )}\n    </div>\n  )\n}\nconst SimpleValue = ({\n  name,\n  value,\n  description,\n  prefix,\n}: {\n  description?: React.ReactNode\n  name: string\n  value: any\n  prefix?: string[]\n}) => {\n  const classes = useStyles()\n  return value !== null && value !== undefined ? (\n    <div className={classes.field}>\n      <FieldName prefix={prefix} description={description} name={name} />\n      <BasicValue value={value} />\n    </div>\n  ) : null\n}\n\nconst ArrayValue = ({\n  name,\n  value,\n  description,\n  prefix,\n}: {\n  description?: React.ReactNode\n  name: string\n  value: any[]\n  prefix?: string[]\n}) => {\n  const classes = useStyles()\n  return (\n    <>\n      {value.length === 1 ? (\n        isObject(value[0]) ? (\n          <Attributes attributes={value[0]} prefix={[...prefix, name]} />\n        ) : (\n          <div className={classes.field}>\n            <FieldName prefix={prefix} description={description} name={name} />\n            <BasicValue value={value[0]} />\n          </div>\n        )\n      ) : value.every(val => isObject(val)) ? (\n        value.map((val, i) => (\n          <Attributes attributes={val} prefix={[...prefix, name + '-' + i]} />\n        ))\n      ) : (\n        <div className={classes.field}>\n          <FieldName prefix={prefix} description={description} name={name} />\n          {value.map((val, i) => (\n            <div key={`${name}-${i}`} className={classes.fieldSubvalue}>\n              <BasicValue value={val} />\n            </div>\n          ))}\n        </div>\n      )}\n    </>\n  )\n}\n\nfunction CoreDetails(props: BaseProps) {\n  const { feature } = props\n  const { refName, start, end, strand } = feature as SimpleFeatureSerialized & {\n    start: number\n    end: number\n    strand: number\n    refName: string\n  }\n  const strandMap: Record<string, string> = {\n    '-1': '-',\n    '0': '',\n    '1': '+',\n  }\n  const strandStr = strandMap[strand as number] ? `(${strandMap[strand]})` : ''\n  const displayStart = (start + 1).toLocaleString('en-US')\n  const displayEnd = end.toLocaleString('en-US')\n  const displayRef = refName ? `${refName}:` : ''\n  const displayedDetails: Record<string, any> = {\n    ...feature,\n    length: (end - start).toLocaleString('en-US'),\n    position: `${displayRef}${displayStart}..${displayEnd} ${strandStr}`,\n  }\n\n  const coreRenderedDetails = [\n    'Position',\n    'Description',\n    'Name',\n    'Length',\n    'Type',\n  ]\n  return (\n    <>\n      {coreRenderedDetails.map(key => {\n        const value = displayedDetails[key.toLowerCase()]\n        return value !== null && value !== undefined ? (\n          <SimpleValue key={key} name={key} value={value} />\n        ) : null\n      })}\n    </>\n  )\n}\n\nexport const BaseCoreDetails = (props: BaseProps) => {\n  return (\n    <BaseCard {...props} title=\"Primary data\">\n      <CoreDetails {...props} />\n    </BaseCard>\n  )\n}\n\ninterface AttributeProps {\n  attributes: Record<string, any>\n  omit?: string[]\n  formatter?: (val: unknown, key: string) => JSX.Element\n  descriptions?: Record<string, React.ReactNode>\n  prefix?: string[]\n}\n\nconst DataGridDetails = ({\n  value,\n  prefix,\n  name,\n}: {\n  name: string\n  prefix?: string[]\n  value: Record<string, any>\n}) => {\n  const keys = Object.keys(value[0]).sort()\n  const unionKeys = new Set(keys)\n  value.forEach((val: any) => Object.keys(val).forEach(k => unionKeys.add(k)))\n  if (unionKeys.size < keys.length + 5) {\n    // avoids key 'id' from being used in row data\n    const rows = Object.entries(value).map(([k, val]) => {\n      const { id, ...rest } = val\n      return {\n        id: k, // used by material UI\n        identifier: id, // renamed from id to identifier\n        ...rest,\n      }\n    })\n\n    // avoids key 'id' from being used in column names, and tries\n    // to make it at the start of the colNames array\n    let colNames\n    if (unionKeys.has('id')) {\n      unionKeys.delete('id')\n      colNames = ['identifier', ...unionKeys]\n    } else {\n      colNames = [...unionKeys]\n    }\n\n    const columns = colNames.map(val => ({\n      field: val,\n      width: Math.max(\n        ...rows.map(row => {\n          const result = String(row[val])\n          return Math.min(Math.max(measureText(result, 14) + 50, 80), 1000)\n        }),\n      ),\n    }))\n\n    // disableSelection on click helps avoid\n    // https://github.com/mui-org/material-ui-x/issues/1197\n    return (\n      <>\n        <FieldName prefix={prefix} name={name} />\n        <div\n          style={{\n            height:\n              Math.min(rows.length, 100) * 20 +\n              50 +\n              (rows.length < 100 ? 0 : 50),\n            width: '100%',\n          }}\n        >\n          <DataGrid\n            disableSelectionOnClick\n            rowHeight={20}\n            headerHeight={25}\n            rows={rows}\n            rowsPerPageOptions={[]}\n            hideFooterRowCount\n            hideFooterSelectedRowCount\n            columns={columns}\n            hideFooter={rows.length < 100}\n          />\n        </div>\n      </>\n    )\n  }\n  return null\n}\n\n// arr = ['a','b'], obj = {a:{b:'hello}}, returns hello (with special addition to grab description also)\nfunction accessNested(arr: string[], obj: Record<string, any> = {}) {\n  arr.forEach(elt => {\n    if (obj) {\n      obj = obj[elt]\n    }\n  })\n  return typeof obj === 'string'\n    ? obj\n    : typeof obj?.Description === 'string'\n    ? obj.Description\n    : undefined\n}\n\nexport const Attributes: React.FunctionComponent<AttributeProps> = props => {\n  const {\n    attributes,\n    omit = [],\n    descriptions,\n    formatter = val => val,\n    prefix = [],\n  } = props\n  const omits = [...omit, ...globalOmit]\n\n  return (\n    <>\n      {Object.entries(attributes)\n        .filter(([k, v]) => v !== undefined && !omits.includes(k))\n        .map(([key, value]) => {\n          if (\n            Array.isArray(value) &&\n            value.length > 2 &&\n            value.every(val => isObject(val))\n          ) {\n            return (\n              <DataGridDetails\n                key={key}\n                prefix={prefix}\n                name={key}\n                value={value}\n              />\n            )\n          }\n\n          const description = accessNested([...prefix, key], descriptions)\n          if (Array.isArray(value)) {\n            return (\n              <ArrayValue\n                key={key}\n                name={key}\n                value={value}\n                description={description}\n                prefix={prefix}\n              />\n            )\n          }\n\n          if (isObject(value)) {\n            return (\n              <Attributes\n                omit={omits}\n                key={key}\n                attributes={value}\n                descriptions={descriptions}\n                prefix={[...prefix, key]}\n              />\n            )\n          }\n\n          return (\n            <SimpleValue\n              key={key}\n              name={key}\n              value={formatter(value, key)}\n              description={description}\n              prefix={prefix}\n            />\n          )\n        })}\n    </>\n  )\n}\n\nexport const BaseAttributes = (props: BaseProps) => {\n  const { feature } = props\n  return (\n    <BaseCard {...props} title=\"Attributes\">\n      <Attributes {...props} attributes={feature} />\n    </BaseCard>\n  )\n}\n\nexport interface BaseInputProps extends BaseCardProps {\n  omit?: string[]\n  model: any\n  descriptions?: Record<string, React.ReactNode>\n  formatter?: (val: unknown, key: string) => JSX.Element\n}\n\nfunction isEmpty(obj: Record<string, unknown>) {\n  return Object.keys(obj).length === 0\n}\n\nexport const FeatureDetails = (props: {\n  model: IAnyStateTreeNode\n  feature: SimpleFeatureSerialized & { name?: string; id?: string }\n  depth?: number\n  omit?: string[]\n  formatter?: (val: unknown, key: string) => JSX.Element\n}) => {\n  const { omit = [], model, feature, depth = 0 } = props\n  const { name, id, type = '', subfeatures } = feature\n  const slug = name || id || ''\n  const shortName = slug.length > 20 ? `${slug}...` : slug\n  const title = `${shortName}${type ? ` - ${type}` : ''}`\n  const session = getSession(model)\n  const defSeqTypes = ['mRNA', 'transcript']\n  const sequenceTypes =\n    getConf(session, ['featureDetails', 'sequenceTypes']) || defSeqTypes\n\n  return (\n    <BaseCard title={title}>\n      <div>Core details</div>\n      <CoreDetails {...props} />\n      <Divider />\n      <div>Attributes</div>\n      <Attributes\n        attributes={feature}\n        {...props}\n        omit={[...omit, ...coreDetails]}\n      />\n      {sequenceTypes.includes(feature.type) ? (\n        <ErrorBoundary\n          FallbackComponent={({ error }) => (\n            <Typography color=\"error\">\n              Failed to fetch sequence for feature: {`${error}`}\n            </Typography>\n          )}\n        >\n          <SequenceFeatureDetails {...props} />\n        </ErrorBoundary>\n      ) : null}\n      {subfeatures && subfeatures.length ? (\n        <BaseCard\n          title=\"Subfeatures\"\n          defaultExpanded={!sequenceTypes.includes(feature.type)}\n        >\n          {subfeatures.map((sub: any) => (\n            <FeatureDetails\n              key={JSON.stringify(sub)}\n              feature={sub}\n              model={model}\n              depth={depth + 1}\n            />\n          ))}\n        </BaseCard>\n      ) : null}\n    </BaseCard>\n  )\n}\n\nconst BaseFeatureDetails = observer((props: BaseInputProps) => {\n  const { model } = props\n  const { featureData } = model\n\n  if (!featureData) {\n    return null\n  }\n  const feature = JSON.parse(JSON.stringify(featureData))\n\n  if (isEmpty(feature)) {\n    return null\n  }\n  return <FeatureDetails model={model} feature={feature} />\n})\n\nexport default BaseFeatureDetails\n","import { ThemeProvider } from '@material-ui/core/styles'\nimport React, { useEffect, useRef } from 'react'\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\nimport { createJBrowseTheme } from '../../ui'\nimport { rIC } from '../../util'\nimport { ResultsSerialized, RenderArgs } from './ServerSideRendererType'\n\ninterface ServerSideRenderedContentProps extends ResultsSerialized, RenderArgs {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  RenderingComponent: React.ComponentType<any>\n}\n\nexport default function ServerSideRenderedContent(\n  props: ServerSideRenderedContentProps,\n) {\n  const ssrContainerNode = useRef<HTMLDivElement>(null)\n\n  const { theme, html, RenderingComponent, ...rest } = props\n\n  const jbrowseTheme = createJBrowseTheme(theme)\n\n  useEffect(() => {\n    const domNode = ssrContainerNode.current\n    function doHydrate() {\n      if (domNode) {\n        if (domNode) {\n          unmountComponentAtNode(domNode)\n        }\n        domNode.innerHTML = html\n\n        // defer main-thread rendering and hydration for when\n        // we have some free time. helps keep the framerate up.\n        //\n        // note: the timeout param to rIC below helps when you are doing\n        // a long continuous scroll, it forces it to evaluate because\n        // otherwise the continuous scroll would never give it time to do\n        // so\n        rIC(\n          () => {\n            hydrate(\n              <ThemeProvider theme={jbrowseTheme}>\n                <RenderingComponent {...rest} />\n              </ThemeProvider>,\n              domNode,\n            )\n          },\n          { timeout: 300 },\n        )\n      }\n    }\n\n    doHydrate()\n\n    return () => {\n      if (domNode) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  }, [html, jbrowseTheme, rest])\n\n  return (\n    <div\n      ref={ssrContainerNode}\n      data-html-size={html.length}\n      className=\"ssr-container\"\n    />\n  )\n}\n","import React from 'react'\nimport { ThemeOptions } from '@material-ui/core'\nimport { ThemeProvider } from '@material-ui/core/styles'\nimport { renderToString } from 'react-dom/server'\n\nimport {\n  SnapshotOrInstance,\n  SnapshotIn,\n  getSnapshot,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport { checkAbortSignal, updateStatus } from '../../util'\nimport RendererType, { RenderProps, RenderResults } from './RendererType'\nimport SerializableFilterChain, {\n  SerializedFilterChain,\n} from './util/serializableFilterChain'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\nimport RpcManager from '../../rpc/RpcManager'\nimport { createJBrowseTheme } from '../../ui'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\n\ninterface BaseRenderArgs extends RenderProps {\n  sessionId: string\n  // Note that signal serialization happens after serializeArgsInClient and\n  // deserialization happens before deserializeArgsInWorker\n  signal?: AbortSignal\n  theme: ThemeOptions\n  exportSVG: { rasterizeLayers?: boolean }\n}\n\nexport interface RenderArgs extends BaseRenderArgs {\n  config: SnapshotOrInstance<AnyConfigurationModel>\n  filters: SerializableFilterChain\n}\n\nexport interface RenderArgsSerialized extends BaseRenderArgs {\n  statusCallback?: Function\n  config: SnapshotIn<AnyConfigurationModel>\n  filters: SerializedFilterChain\n}\nexport interface RenderArgsDeserialized extends BaseRenderArgs {\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport type { RenderResults }\n\nexport interface ResultsSerialized extends Omit<RenderResults, 'reactElement'> {\n  html: string\n}\n\nexport type ResultsDeserialized = RenderResults\n\nexport default class ServerSideRenderer extends RendererType {\n  /**\n   * directly modifies the render arguments to prepare them to be serialized and\n   * sent to the worker.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs): RenderArgsSerialized {\n    return {\n      ...args,\n      config: isStateTreeNode(args.config)\n        ? getSnapshot(args.config)\n        : args.config,\n      filters: args.filters && args.filters.toJSON().filters,\n    }\n  }\n\n  /**\n   * Deserialize the render results from the worker in the client. Includes\n   * hydrating of the React HTML string, and not hydrating the result if SVG is\n   * being rendered\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    results: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const { html, ...rest } = results\n\n    // if we are rendering svg, we skip hydration\n    if (args.exportSVG) {\n      // only return the results if the renderer explicitly has\n      // this.supportsSVG support to avoid garbage being rendered in SVG\n      // document\n      return {\n        ...results,\n        html: this.supportsSVG\n          ? results.html\n          : '<text y=\"12\" fill=\"black\">SVG export not supported for this track</text>',\n      }\n    }\n\n    // hydrate results using ServerSideRenderedContent\n    return {\n      ...rest,\n      reactElement: (\n        <ServerSideRenderedContent\n          {...args}\n          {...results}\n          RenderingComponent={this.ReactComponent}\n        />\n      ),\n    }\n  }\n\n  /**\n   * modifies the passed arguments object to inflate arguments as necessary.\n   * called in the worker process.\n   *\n   * @param args - the converted arguments to modify\n   */\n  deserializeArgsInWorker(args: RenderArgsSerialized): RenderArgsDeserialized {\n    const deserialized = ({ ...args } as unknown) as RenderArgsDeserialized\n    const config = this.configSchema.create(args.config || {}, {\n      pluginManager: this.pluginManager,\n    })\n    deserialized.config = config\n    deserialized.filters = new SerializableFilterChain({\n      filters: args.filters,\n    })\n\n    return deserialized\n  }\n\n  /**\n   * Serialize results of the render to send them to the client. Includes\n   * rendering React to an HTML string.\n   *\n   * @param results - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const html = renderToString(\n      <ThemeProvider theme={createJBrowseTheme(args.theme)}>\n        {results.reactElement}\n      </ThemeProvider>,\n    )\n    delete results.reactElement\n    return { ...results, html }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then calls\n   * \"CoreRender\" with the RPC manager.\n   *\n   * @param rpcManager - RPC mananger\n   * @param args - render args\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    return rpcManager.call(args.sessionId, 'CoreRender', args) as Promise<\n      ResultsSerialized\n    >\n  }\n\n  /**\n   * Render method called on the worker. `render` is called here in server-side\n   * rendering\n   *\n   * @param args - serialized render args\n   */\n  async renderInWorker(args: RenderArgsSerialized): Promise<ResultsSerialized> {\n    const { signal, statusCallback = () => {} } = args\n    checkAbortSignal(signal)\n    const deserializedArgs = this.deserializeArgsInWorker(args)\n\n    checkAbortSignal(signal)\n    const results = await updateStatus('Rendering plot', statusCallback, () =>\n      this.render(deserializedArgs),\n    )\n    checkAbortSignal(signal)\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    const serialized = await updateStatus(\n      'Serializing results',\n      statusCallback,\n      () => this.serializeResultsInWorker(results, deserializedArgs),\n    )\n    return serialized\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n\n    const freed = this.freeResources()\n    const freedRpc = (await rpcManager.call(\n      args.sessionId,\n      'CoreFreeResources',\n      serializedArgs,\n    )) as number\n    return freed + freedRpc\n  }\n}\n","import { Observable, fromEvent } from 'rxjs'\n\nclass AbortError extends Error {\n  public code: string | undefined\n}\n\n/**\n * properly check if the given AbortSignal is aborted.\n * per the standard, if the signal reads as aborted,\n * this function throws either a DOMException AbortError, or a regular error\n * with a `code` attribute set to `ERR_ABORTED`.\n *\n * for convenience, passing `undefined` is a no-op\n *\n * @param signal -\n * @returns nothing\n */\nexport function checkAbortSignal(signal?: AbortSignal): void {\n  if (!signal) {\n    return\n  }\n\n  if (!(signal instanceof AbortSignal)) {\n    throw new TypeError('must pass an AbortSignal')\n  }\n\n  if (signal.aborted) {\n    throw makeAbortError()\n  }\n}\n\nfunction timeout(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n/**\n * Skips to the next tick, then runs `checkAbortSignal`.\n * Await this to inside an otherwise synchronous loop to\n * provide a place to break when an abort signal is received.\n */\nexport async function abortBreakPoint(signal?: AbortSignal) {\n  // it was observed that an actual timeout is needed to get the aborting (wrap\n  // hicrenderer in a try catch, console.error the error, and rethrow the error\n  // to see). using await Promise.resolve() did not appear to allow aborting to\n  // occur\n  await timeout(1)\n  checkAbortSignal(signal)\n}\n\nexport function makeAbortError() {\n  if (typeof DOMException !== 'undefined') {\n    return new DOMException('aborted', 'AbortError')\n  }\n  const e = new AbortError('aborted')\n  e.code = 'ERR_ABORTED'\n  return e\n}\n\nexport function observeAbortSignal(signal?: AbortSignal): Observable<Event> {\n  if (!signal) {\n    return Observable.create()\n  }\n  return fromEvent(signal, 'abort')\n}\n\n/**\n * check if the given exception was caused by an operation being intentionally aborted\n * @param exception -\n */\nexport function isAbortException(exception: Error): boolean {\n  return (\n    // DOMException\n    exception.name === 'AbortError' ||\n    // standard-ish non-DOM abort exception\n    (exception as AbortError).code === 'ERR_ABORTED' ||\n    // message contains aborted for bubbling through RPC\n    // things we have seen that we want to catch here\n    // Error: aborted\n    // AbortError: aborted\n    // AbortError: The user aborted a request.\n    !!exception.message.match(/\\b(aborted|AbortError)\\b/i)\n  )\n}\n","import createJexlInstance from './jexl'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst compilationCache: Record<string, any> = {}\n\n// revert function strings back to main, create a different file for jexlStrings.ts\n// pass the jexl property of the pluginManager as a param\n\n/**\n * compile a jexlExpression to a string\n *\n * @param str - string of code like `jexl:...`\n * @param options -\n */\nexport function stringToJexlExpression(\n  str: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  jexl?: any,\n) {\n  const cacheKey = `nosig|${str}`\n  if (!compilationCache[cacheKey]) {\n    const match = str.startsWith('jexl:')\n    if (!match) {\n      throw new Error('string does not appear to be in jexl format')\n    }\n    const code = str.split('jexl:')[1]\n    const compiled = jexl\n      ? jexl.compile(`${code}`)\n      : createJexlInstance().compile(`${code}`)\n    compilationCache[cacheKey] = compiled\n  }\n\n  return compilationCache[cacheKey]\n}\n","import React from 'react'\nimport escapeHTML from 'escape-html'\nimport dompurify from 'dompurify'\n\n// source https://github.com/sindresorhus/html-tags/blob/master/html-tags.json\n// with some random uncommon ones removed. note: we just use this to run the content\n// through dompurify without escaping if we see an htmlTag from this list\n// otherwise we escape angle brackets and things prematurely because it might be\n// something like <TRA> in VCF. Ref #657\nconst htmlTags = [\n  'a',\n  'b',\n  'br',\n  'code',\n  'div',\n  'em',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'i',\n  'img',\n  'li',\n  'p',\n  'pre',\n  'span',\n  'small',\n  'strong',\n  'table',\n  'tbody',\n  'td',\n  'tfoot',\n  'th',\n  'thead',\n  'tr',\n  'u',\n  'ul',\n]\n\n// adapted from is-html https://github.com/sindresorhus/is-html/blob/master/index.js\nconst full = new RegExp(htmlTags.map(tag => `<${tag}\\\\b[^>]*>`).join('|'), 'i')\nexport function isHTML(str: string) {\n  return full.test(str)\n}\n\nexport default function SanitizedHTML({ html }: { html: string }) {\n  const value = isHTML(html) ? html : escapeHTML(html)\n\n  // eslint-disable-next-line react/no-danger\n  return <div dangerouslySetInnerHTML={{ __html: dompurify.sanitize(value) }} />\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport { ElementId } from '../../util/types/mst'\nimport { MenuItem } from '../../ui'\n\nconst BaseViewModel = types\n  .model('BaseView', {\n    id: ElementId,\n    displayName: types.maybe(types.string),\n  })\n  .volatile((/* self */) => ({\n    width: 800,\n  }))\n  .views((/* self */) => ({\n    get menuItems(): MenuItem[] {\n      return []\n    },\n  }))\n  .actions(self => ({\n    setDisplayName(name: string) {\n      self.displayName = name\n    },\n    setWidth(newWidth: number) {\n      self.width = newWidth\n    },\n  }))\n\nexport default BaseViewModel\n// eslint-disable-next-line @typescript-eslint/no-empty-interface,@typescript-eslint/interface-name-prefix\nexport interface IBaseViewModel extends Instance<typeof BaseViewModel> {}\n","import { stringToJexlExpression } from '../../../util/jexlStrings'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype FilterExpression = (...args: Record<string, any>[] | any[]) => boolean\n\ninterface Filter {\n  string: string\n  expr: FilterExpression\n}\n\nexport type SerializedFilterChain = string[]\n\nexport default class SerializableFilterChain {\n  filterChain: Filter[]\n\n  constructor({ filters = [] }: { filters: SerializedFilterChain }) {\n    this.filterChain = filters.map(inputFilter => {\n      if (typeof inputFilter === 'string') {\n        const expr = stringToJexlExpression(inputFilter) as FilterExpression\n        return { expr, string: inputFilter }\n      }\n      throw new Error(`invalid inputFilter string \"${inputFilter}\"`)\n    })\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  passes(...args: any[]) {\n    for (let i = 0; i < this.filterChain.length; i += 1) {\n      if (\n        // @ts-ignore\n        !this.filterChain[i].expr.evalSync({ feature: args[0] })\n      ) {\n        return false\n      }\n    }\n    return true\n  }\n\n  toJSON() {\n    return { filters: this.filterChain.map(f => f.string) }\n  }\n\n  static fromJSON(json: { filters: SerializedFilterChain }) {\n    return new SerializableFilterChain(json)\n  }\n}\n","import { filter, ignoreElements, tap } from 'rxjs/operators'\nimport { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\nimport { checkAbortSignal, iterMap } from '../../util'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '../../util/simpleFeature'\nimport { Region } from '../../util/types'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults as ServerSideRenderResults,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n} from './ServerSideRendererType'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  dataAdapter: BaseFeatureDataAdapter\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderResults extends ServerSideRenderResults {\n  features: Map<string, Feature>\n}\n\nexport interface ResultsSerialized extends ServerSideResultsSerialized {\n  features: SimpleFeatureSerialized[]\n}\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  features: Map<string, Feature>\n  blockKey: string\n}\n\nexport default class FeatureRendererType extends ServerSideRendererType {\n  /**\n   * replaces the `displayModel` param (which on the client is a MST model) with\n   * a stub that only contains the `selectedFeature`, since this is the only\n   * part of the track model that most renderers read. also serializes the\n   * config and regions to JSON from MST objects.\n   *\n   * @param args - the arguments passed to render\n   */\n  serializeArgsInClient(args: RenderArgs) {\n    const { displayModel, regions } = args\n    const serializedArgs = {\n      ...args,\n      displayModel: displayModel && {\n        id: displayModel.id,\n        selectedFeatureId: displayModel.selectedFeatureId,\n      },\n      regions: JSON.parse(JSON.stringify(regions)),\n    }\n    return super.serializeArgsInClient(serializedArgs)\n  }\n\n  /**\n   * Adds feature deserialization to base server-side result deserialization\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserializedFeatures = new Map<string, SimpleFeature>()\n    result.features.forEach(j => {\n      const f = SimpleFeature.fromJSON(j)\n      deserializedFeatures.set(String(f.id()), f)\n    })\n    const deserialized = super.deserializeResultsInClient(\n      {\n        ...result,\n        features: deserializedFeatures,\n      } as ServerSideResultsSerialized,\n      args,\n    )\n    return {\n      ...deserialized,\n      blockKey: args.blockKey,\n      features: deserializedFeatures,\n    }\n  }\n\n  /**\n   * Adds feature serialization to base server-side result serialization\n   *\n   * @param results - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    result: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(result, args)\n    return {\n      ...serialized,\n      features: iterMap(result.features.values(), f => f.toJSON()),\n    }\n  }\n\n  /**\n   * will expand if soft clipping or feature glyphs are shown\n   *\n   * @param region - rendering region\n   * @param _renderArgs - render args, unused, may be used in deriving classes\n   */\n  getExpandedRegion(region: Region, _renderArgs: RenderArgsDeserialized) {\n    return region\n  }\n\n  /**\n   * use the dataAdapter to fetch the features to be rendered\n   *\n   * @param renderArgs -\n   * @returns Map of features as `{ id => feature, ... }`\n   */\n  async getFeatures(\n    renderArgs: RenderArgsDeserialized,\n  ): Promise<Map<string, Feature>> {\n    const { dataAdapter, signal, regions } = renderArgs\n    const features = new Map()\n\n    if (!regions || regions.length === 0) {\n      return features\n    }\n\n    const requestRegions = regions.map((r: Region) => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.ceil(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    const region = requestRegions[0]\n\n    const featureObservable =\n      requestRegions.length === 1\n        ? dataAdapter.getFeatures(\n            this.getExpandedRegion(region, renderArgs),\n            // @ts-ignore\n            renderArgs,\n          )\n        : // @ts-ignore\n          dataAdapter.getFeaturesInMultipleRegions(requestRegions, renderArgs)\n\n    await featureObservable\n      .pipe(\n        tap(() => checkAbortSignal(signal)),\n        filter(feature => this.featurePassesFilters(renderArgs, feature)),\n        tap(feature => {\n          const id = feature.id()\n          if (!id) {\n            throw new Error(`invalid feature id \"${id}\"`)\n          }\n          features.set(id, feature)\n        }),\n        ignoreElements(),\n      )\n      .toPromise()\n\n    return features\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    if (!renderArgs.filters) {\n      return true\n    }\n    return renderArgs.filters.passes(feature, renderArgs)\n  }\n\n  /**\n   * gets features and renders\n   *\n   * @param props - render args\n   */\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const features =\n      (props.features as undefined | Map<string, Feature>) ||\n      (await this.getFeatures(props))\n    const result = await super.render({ ...props, features })\n    return { ...result, features }\n  }\n}\n\nexport class NewFeatureRendererType extends ServerSideRendererType {}\n","/* eslint-disable no-underscore-dangle */\n/**\n * Heavily based on [quick-lru](https://www.npmjs.com/package/quick-lru)\n * (quick-lru didn't work for us because the export wouldn't compile in Webpack\n * properly)\n */\nclass QuickLRU {\n  constructor(options = {}) {\n    if (!(options.maxSize && options.maxSize > 0)) {\n      throw new TypeError('`maxSize` must be a number greater than 0')\n    }\n\n    this.maxSize = options.maxSize\n    this.cache = new Map()\n    this.oldCache = new Map()\n    this._size = 0\n  }\n\n  _set(key, value) {\n    this.cache.set(key, value)\n    this._size += 1\n\n    if (this._size >= this.maxSize) {\n      this._size = 0\n      this.oldCache = this.cache\n      this.cache = new Map()\n    }\n  }\n\n  get(key) {\n    if (this.cache.has(key)) {\n      return this.cache.get(key)\n    }\n\n    if (this.oldCache.has(key)) {\n      const value = this.oldCache.get(key)\n      this.oldCache.delete(key)\n      this._set(key, value)\n      return value\n    }\n\n    return undefined\n  }\n\n  set(key, value) {\n    if (this.cache.has(key)) {\n      this.cache.set(key, value)\n    } else {\n      this._set(key, value)\n    }\n\n    return this\n  }\n\n  has(key) {\n    return this.cache.has(key) || this.oldCache.has(key)\n  }\n\n  peek(key) {\n    if (this.cache.has(key)) {\n      return this.cache.get(key)\n    }\n\n    if (this.oldCache.has(key)) {\n      return this.oldCache.get(key)\n    }\n\n    return undefined\n  }\n\n  delete(key) {\n    const deleted = this.cache.delete(key)\n    if (deleted) {\n      this._size -= 1\n    }\n\n    return this.oldCache.delete(key) || deleted\n  }\n\n  clear() {\n    this.cache.clear()\n    this.oldCache.clear()\n    this._size = 0\n  }\n\n  *keys() {\n    for (const [key] of this) {\n      yield key\n    }\n  }\n\n  *values() {\n    for (const [, value] of this) {\n      yield value\n    }\n  }\n\n  *[Symbol.iterator]() {\n    for (const item of this.cache) {\n      yield item\n    }\n\n    for (const item of this.oldCache) {\n      const [key] = item\n      if (!this.cache.has(key)) {\n        yield item\n      }\n    }\n  }\n\n  get size() {\n    let oldCacheSize = 0\n    for (const key of this.oldCache.keys()) {\n      if (!this.cache.has(key)) {\n        oldCacheSize += 1\n      }\n    }\n\n    return this._size + oldCacheSize\n  }\n}\n\nexport default QuickLRU\n","/**\n * Based on https://material-ui.com/components/autocomplete/#Virtualize.tsx\n * Asynchronous Requests for autocomplete: https://material-ui.com/components/autocomplete/\n */\nimport React, { useMemo } from 'react'\nimport { observer } from 'mobx-react'\nimport { Region } from '@jbrowse/core/util/types'\nimport { getSession } from '@jbrowse/core/util'\n// material ui\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport TextField, { TextFieldProps as TFP } from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport SearchIcon from '@material-ui/icons/Search'\nimport { InputAdornment } from '@material-ui/core'\nimport Autocomplete, {\n  createFilterOptions,\n} from '@material-ui/lab/Autocomplete'\n// other\nimport { LinearGenomeViewModel } from '..'\n\n// filter for options that were fetched\nconst filter = createFilterOptions<Option>({ trim: true, limit: 36 })\n\nexport interface Option {\n  type: string\n  value: string\n  inputValue?: string\n}\n\nfunction RefNameAutocomplete({\n  model,\n  onSelect,\n  assemblyName,\n  style,\n  value,\n  TextFieldProps = {},\n}: {\n  model: LinearGenomeViewModel\n  onSelect: (region: string | undefined) => void\n  assemblyName?: string\n  value?: string\n  style?: React.CSSProperties\n  TextFieldProps?: TFP\n}) {\n  const session = getSession(model)\n  const { assemblyManager } = session\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const regions =\n    (assemblyName && assemblyManager.get(assemblyName)?.regions) ||\n    ([] as Region[])\n\n  const { coarseVisibleLocStrings } = model\n  const loaded = regions.length !== 0\n  const options = useMemo(\n    () =>\n      regions.map(option => ({\n        type: 'reference sequence',\n        value: option.refName,\n      })) as Option[],\n    [regions],\n  )\n\n  function onChange(newRegionName: Option | string) {\n    let newRegionValue: string | undefined\n    if (newRegionName) {\n      if (typeof newRegionName === 'object') {\n        newRegionValue = newRegionName.inputValue || newRegionName.value\n      }\n      if (typeof newRegionName === 'string') {\n        newRegionValue = newRegionName\n      }\n      onSelect(newRegionValue)\n    }\n  }\n\n  return (\n    <Autocomplete\n      id={`refNameAutocomplete-${model.id}`}\n      data-testid=\"autocomplete\"\n      disabled={!assemblyName || !loaded}\n      disableListWrap\n      disableClearable\n      freeSolo\n      includeInputInList\n      clearOnBlur\n      loading={loaded}\n      selectOnFocus\n      style={style}\n      value={coarseVisibleLocStrings || value || ''}\n      options={options}\n      groupBy={option => String(option.type)}\n      filterOptions={(possibleOptions, params) => {\n        const filtered = filter(possibleOptions, params)\n        // creates new option if user input does not match options\n        if (params.inputValue !== '') {\n          const newOption: Option = {\n            type: 'Search',\n            inputValue: params.inputValue,\n            value: params.inputValue,\n          }\n          filtered.push(newOption)\n        }\n        return filtered\n      }}\n      ListboxProps={{ style: { maxHeight: 250 } }}\n      onChange={(_, newRegion) => {\n        onChange(newRegion)\n      }}\n      renderInput={params => {\n        const { helperText, InputProps = {} } = TextFieldProps\n        const TextFieldInputProps = {\n          ...params.InputProps,\n          ...InputProps,\n          endAdornment: (\n            <>\n              {!loaded ? (\n                <CircularProgress color=\"inherit\" size={20} />\n              ) : (\n                <InputAdornment position=\"end\" style={{ marginRight: 7 }}>\n                  <SearchIcon />\n                </InputAdornment>\n              )}\n              {params.InputProps.endAdornment}\n            </>\n          ),\n        }\n        return (\n          <TextField\n            {...params}\n            {...TextFieldProps}\n            helperText={helperText}\n            value={coarseVisibleLocStrings || value || ''}\n            InputProps={TextFieldInputProps}\n            placeholder=\"Search for location\"\n          />\n        )\n      }}\n      renderOption={option => <Typography noWrap>{option.value}</Typography>}\n      getOptionLabel={option => {\n        if (typeof option === 'string') {\n          return option\n        }\n        if (option.inputValue) {\n          return option.inputValue\n        }\n        return option.value\n      }}\n    />\n  )\n}\n\nexport default observer(RefNameAutocomplete)\n","/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  start: number,\n  end: number,\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n\n  let minBase = start\n  let maxBase = end\n  if (minBase === null || maxBase === null) {\n    return []\n  }\n\n  if (bpPerPx < 0) {\n    ;[minBase, maxBase] = [maxBase, minBase]\n  }\n\n  // add 20px additional on the right and left to allow us to draw the ends\n  // of labels that lie a little outside our region\n  minBase -= Math.abs(20 * bpPerPx) - 1\n  maxBase += Math.abs(20 * bpPerPx) + 1\n\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  let index = 0\n  const ticks = []\n  for (\n    let base = Math.ceil(minBase / iterPitch) * iterPitch;\n    base < maxBase;\n    base += iterPitch\n  ) {\n    if (emitMinor && base % (gridPitch.majorPitch * 2)) {\n      ticks.push({ type: 'minor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor && !(base % (gridPitch.majorPitch * 2))) {\n      ticks.push({ type: 'major', base: base - 1, index })\n      index += 1\n    }\n  }\n  return ticks\n}\n","import Popover from '@material-ui/core/Popover'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport { stringify } from '@jbrowse/core/util'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport ReactPropTypes from 'prop-types'\nimport React, { useRef, useEffect, useState } from 'react'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { LinearGenomeViewStateModel, HEADER_OVERVIEW_HEIGHT } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => {\n  const background = theme.palette.tertiary\n    ? fade(theme.palette.tertiary.main, 0.7)\n    : fade(theme.palette.primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: theme.palette.tertiary\n        ? theme.palette.tertiary.contrastText\n        : theme.palette.primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nfunction OverviewRubberBand({\n  model,\n  overview,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [guideX, setGuideX] = useState<number | undefined>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp() {\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX !== undefined\n      ) {\n        if (Math.abs(currentX - startX) > 3) {\n          model.zoomToDisplayedRegions(\n            overview.pxToBp(startX),\n            overview.pxToBp(currentX),\n          )\n        }\n      }\n      /* handling clicking and centering at a specific Bp */\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX === undefined\n      ) {\n        const clickedAt = overview.pxToBp(startX)\n        model.centerAt(\n          Math.round(clickedAt.coord),\n          clickedAt.refName,\n          clickedAt.index,\n        )\n      }\n      setStartX(undefined)\n      setCurrentX(undefined)\n\n      if (startX !== undefined) {\n        setGuideX(undefined)\n      }\n    }\n\n    function globalKeyDown(event: KeyboardEvent) {\n      if (event.key === 'Escape') {\n        setStartX(undefined)\n        setCurrentX(undefined)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      window.addEventListener('keydown', globalKeyDown, true)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n        window.removeEventListener('keydown', globalKeyDown, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, currentX, startX, model, overview])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    if (controlsRef.current) {\n      setStartX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    if (controlsRef.current) {\n      setGuideX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  if (startX === undefined) {\n    return (\n      <div style={{ position: 'relative' }}>\n        {guideX !== undefined ? (\n          <Tooltip\n            open={!mouseDragging}\n            placement=\"top\"\n            title={stringify(overview.pxToBp(guideX))}\n            arrow\n          >\n            <div\n              className={classes.guide}\n              style={{\n                left: guideX,\n              }}\n            />\n          </Tooltip>\n        ) : null}\n        <div\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </div>\n    )\n  }\n\n  let left = startX || 0\n  let width = 0\n  if (startX !== undefined && currentX !== undefined) {\n    left = currentX < startX ? currentX : startX\n    width = currentX - startX\n  }\n  // calculate the start and end bp of drag\n  let leftBpOffset\n  let rightBpOffset\n  if (startX) {\n    leftBpOffset = overview.pxToBp(startX)\n    rightBpOffset = overview.pxToBp(startX + width)\n    if (currentX && currentX < startX) {\n      ;[leftBpOffset, rightBpOffset] = [rightBpOffset, leftBpOffset]\n    }\n  }\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {leftBpOffset ? stringify(leftBpOffset) : ''}\n            </Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {rightBpOffset ? stringify(rightBpOffset) : ''}\n            </Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{\n          left,\n          width: Math.abs(width),\n          height: HEADER_OVERVIEW_HEIGHT,\n        }}\n      />\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n    </div>\n  )\n}\n\nOverviewRubberBand.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  overview: MobxPropTypes.objectOrObservableObject.isRequired,\n  ControlComponent: ReactPropTypes.node,\n}\n\nOverviewRubberBand.defaultProps = {\n  ControlComponent: <div />,\n}\n\nexport default observer(OverviewRubberBand)\n","// import { Region } from '@jbrowse/core/util/types'\n// import { Region as MSTRegion } from '@jbrowse/core/util/types/mst'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { getSession } from '@jbrowse/core/util'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport clsx from 'clsx'\nimport { Typography } from '@material-ui/core'\nimport {\n  LinearGenomeViewStateModel,\n  HEADER_BAR_HEIGHT,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { chooseGridPitch } from '../util'\nimport OverviewRubberBand from './OverviewRubberBand'\n\nconst useStyles = makeStyles(theme => {\n  const scaleBarColor = theme.palette.tertiary\n    ? theme.palette.tertiary.light\n    : theme.palette.primary.light\n  return {\n    scaleBar: {\n      width: '100%',\n      height: HEADER_OVERVIEW_HEIGHT,\n      overflow: 'hidden',\n    },\n    scaleBarContig: {\n      backgroundColor: theme.palette.background.default,\n      position: 'absolute',\n      top: 0,\n      height: HEADER_OVERVIEW_HEIGHT,\n      border: '1px solid',\n      borderBottomColor: 'black',\n    },\n    scaleBarContigForward: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n    scaleBarContigReverse: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n    scaleBarRegionIncompleteLeft: {\n      width: 10,\n      height: 17.5,\n      background: `linear-gradient(-225deg,black 3px, transparent 1px),\n      linear-gradient(45deg, black 3px, transparent 1px)`,\n      backgroundRepeat: 'repeat-y',\n      backgroundSize: '10px 8px',\n      borderTopLeftRadius: '2px',\n      borderBottomLeftRadius: '2px',\n      float: 'left',\n    },\n    scaleBarRegionIncompleteRight: {\n      width: 10,\n      height: 17.5,\n      background: `linear-gradient(225deg, black 3px, transparent 1px),\n      linear-gradient(-45deg, black 3px, transparent 1px)`,\n      backgroundRepeat: 'repeat-y',\n      backgroundSize: '10px 8px',\n      borderTopRightRadius: '2px',\n      borderBottomRightRadius: '2px',\n      float: 'right',\n    },\n    scaleBarRefName: {\n      position: 'absolute',\n      fontWeight: 'bold',\n      lineHeight: 'normal',\n      pointerEvents: 'none',\n      left: 5,\n    },\n    scaleBarLabel: {\n      height: HEADER_OVERVIEW_HEIGHT,\n      width: 1,\n      position: 'absolute',\n      display: 'flex',\n      justifyContent: 'center',\n      pointerEvents: 'none',\n    },\n    scaleBarVisibleRegion: {\n      background: fade(scaleBarColor, 0.3),\n      position: 'absolute',\n      height: HEADER_OVERVIEW_HEIGHT,\n      pointerEvents: 'none',\n      top: -1,\n      zIndex: 100,\n      borderWidth: 1,\n      borderStyle: 'solid',\n      borderColor: fade(scaleBarColor, 0.8),\n      boxSizing: 'content-box',\n    },\n    overview: {\n      height: HEADER_BAR_HEIGHT,\n      position: 'relative',\n    },\n    overviewSvg: { position: 'absolute' },\n  }\n})\n\nconst wholeSeqSpacer = 2\nconst Polygon = observer(\n  ({\n    model,\n    overview,\n  }: {\n    model: LGV\n    overview: Instance<Base1DViewModel>\n  }) => {\n    const theme = useTheme()\n    const classes = useStyles()\n    const {\n      offsetPx,\n      dynamicBlocks: { contentBlocks, totalWidthPxWithoutBorders },\n    } = model\n\n    const polygonColor = theme.palette.tertiary\n      ? theme.palette.tertiary.light\n      : theme.palette.primary.light\n\n    if (!contentBlocks.length) {\n      return null\n    }\n    const firstBlock = contentBlocks[0]\n    const lastBlock = contentBlocks[contentBlocks.length - 1]\n    const topLeft = overview.bpToPx({\n      refName: firstBlock.refName,\n      coord: firstBlock.reversed ? firstBlock.end : firstBlock.start,\n      regionNumber: firstBlock.regionNumber,\n    })\n    const topRight = overview.bpToPx({\n      refName: lastBlock.refName,\n      coord: lastBlock.reversed ? lastBlock.start : lastBlock.end,\n      regionNumber: lastBlock.regionNumber,\n    })\n\n    const startPx = Math.max(0, -offsetPx)\n    const endPx =\n      startPx +\n      totalWidthPxWithoutBorders +\n      (contentBlocks.length * model.interRegionPaddingWidth) / 2\n\n    const points = [\n      [startPx, HEADER_BAR_HEIGHT],\n      [endPx, HEADER_BAR_HEIGHT],\n      [topRight, 0],\n      [topLeft, 0],\n    ]\n\n    return (\n      <svg\n        height={HEADER_BAR_HEIGHT}\n        width=\"100%\"\n        className={classes.overviewSvg}\n      >\n        {points && (\n          <polygon\n            points={points.toString()}\n            fill={fade(polygonColor, 0.3)}\n            stroke={fade(polygonColor, 0.8)}\n          />\n        )}\n      </svg>\n    )\n  },\n)\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst ScaleBar = observer(\n  ({\n    model,\n    scale,\n    overview,\n  }: {\n    model: LGV\n    overview: Base1DViewModel\n    scale: number\n  }) => {\n    const classes = useStyles()\n    const { dynamicBlocks: visibleRegions } = model\n    const { assemblyManager } = getSession(model)\n    const gridPitch = chooseGridPitch(scale, 120, 15)\n    const { dynamicBlocks: overviewVisibleRegions } = overview\n\n    if (!visibleRegions.contentBlocks.length) {\n      return null\n    }\n    const firstBlock = visibleRegions.contentBlocks[0]\n    const firstOverviewPx =\n      overview.bpToPx({\n        refName: firstBlock.refName,\n        regionNumber: firstBlock.regionNumber,\n        coord: firstBlock.reversed ? firstBlock.end : firstBlock.start,\n      }) || 0\n\n    const lastBlock =\n      visibleRegions.contentBlocks[visibleRegions.contentBlocks.length - 1]\n    const lastOverviewPx =\n      overview.bpToPx({\n        refName: lastBlock.refName,\n        coord: lastBlock.reversed ? lastBlock.start : lastBlock.end,\n        regionNumber: lastBlock.regionNumber,\n      }) || 0\n\n    return (\n      <div className={classes.scaleBar}>\n        <div\n          className={classes.scaleBarVisibleRegion}\n          style={{\n            width: lastOverviewPx - firstOverviewPx,\n            left: firstOverviewPx,\n          }}\n        />\n        {/* this is the entire scale bar */}\n        {overviewVisibleRegions.map((seq, idx) => {\n          const assembly = assemblyManager.get(seq.assemblyName)\n          let refNameColor: string | undefined\n          if (assembly) {\n            refNameColor = assembly.getRefNameColor(seq.refName)\n          }\n          const regionLength = seq.end - seq.start\n          const tickLabels = []\n          for (\n            let index = 0;\n            index < Math.floor(regionLength / gridPitch.majorPitch);\n            index++\n          ) {\n            const offsetLabel = (index + 1) * gridPitch.majorPitch\n            tickLabels.push(\n              seq.reversed ? seq.end - offsetLabel : seq.start + offsetLabel,\n            )\n          }\n\n          return !(seq instanceof ContentBlock) ? (\n            <div\n              key={`${JSON.stringify(seq)}-${idx}`}\n              className={classes.scaleBarContig}\n              style={{\n                width: seq.widthPx,\n                left: seq.offsetPx,\n                backgroundColor: '#999',\n                backgroundImage:\n                  'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n              }}\n            />\n          ) : (\n            <div\n              key={`${JSON.stringify(seq)}-${idx}`}\n              className={clsx(\n                classes.scaleBarContig,\n                seq.reversed\n                  ? classes.scaleBarContigReverse\n                  : classes.scaleBarContigForward,\n              )}\n              style={{\n                left: seq.offsetPx,\n                width: seq.widthPx,\n                borderColor: refNameColor,\n              }}\n            >\n              {/* name of sequence */}\n              <Typography\n                style={{ color: refNameColor }}\n                className={classes.scaleBarRefName}\n              >\n                {seq.refName}\n              </Typography>\n\n              {/* the number labels drawn in overview scale bar*/}\n              {tickLabels.map((tickLabel, labelIdx) => (\n                <div\n                  key={`${JSON.stringify(seq)}-${tickLabel}-${labelIdx}`}\n                  className={classes.scaleBarLabel}\n                  style={{\n                    left: ((labelIdx + 1) * gridPitch.majorPitch) / scale,\n                    pointerEvents: 'none',\n                    color: refNameColor,\n                  }}\n                >\n                  {tickLabel.toLocaleString('en-US')}\n                </div>\n              ))}\n            </div>\n          )\n        })}\n      </div>\n    )\n  },\n)\n\nfunction OverviewScaleBar({\n  model,\n  children,\n}: {\n  model: LGV\n  children: React.ReactNode\n}) {\n  const classes = useStyles()\n  const { width, displayedRegions } = model\n\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n  overview.setVolatileWidth(width)\n  overview.showAllRegions()\n\n  const scale =\n    model.totalBp / (width - (displayedRegions.length - 1) * wholeSeqSpacer)\n\n  if (!displayedRegions.length) {\n    return (\n      <>\n        <div className={classes.scaleBar}>\n          <LinearProgress\n            variant=\"indeterminate\"\n            style={{ marginTop: 4, width: '100%' }}\n          />\n        </div>\n        <div>{children}</div>\n      </>\n    )\n  }\n\n  return (\n    <div>\n      <OverviewRubberBand\n        model={model}\n        overview={overview}\n        ControlComponent={\n          <ScaleBar model={model} overview={overview} scale={scale} />\n        }\n      />\n      <div className={classes.overview}>\n        <Polygon model={model} overview={overview} />\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(OverviewScaleBar)\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Slider from '@material-ui/core/Slider'\nimport { makeStyles } from '@material-ui/core/styles'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  slider: {\n    width: 70,\n  },\n})\n\nfunction ZoomControls({ model }: { model: LinearGenomeViewModel }) {\n  const classes = useStyles()\n  const { maxBpPerPx, minBpPerPx, bpPerPx, scaleFactor } = model\n  const [value, setValue] = useState(-Math.log2(bpPerPx) * 100)\n  useEffect(() => {\n    setValue(-Math.log2(bpPerPx) * 100)\n  }, [setValue, bpPerPx])\n  return (\n    <div className={classes.container}>\n      <IconButton\n        data-testid=\"zoom_out\"\n        onClick={() => {\n          model.zoom(bpPerPx * 2)\n        }}\n        disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomOut />\n      </IconButton>\n\n      <Slider\n        className={classes.slider}\n        value={value}\n        min={-Math.log2(maxBpPerPx) * 100}\n        max={-Math.log2(minBpPerPx) * 100}\n        onChange={(_, val) => setValue(val as number)}\n        onChangeCommitted={() => model.zoomTo(2 ** (-value / 100))}\n        disabled={scaleFactor !== 1}\n      />\n      <IconButton\n        data-testid=\"zoom_in\"\n        onClick={() => {\n          model.zoom(model.bpPerPx / 2)\n        }}\n        disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomIn />\n      </IconButton>\n    </div>\n  )\n}\n\nexport default observer(ZoomControls)\n","import { Region } from '@jbrowse/core/util/types'\nimport { getSession } from '@jbrowse/core/util'\nimport Button from '@material-ui/core/Button'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport FormGroup from '@material-ui/core/FormGroup'\nimport Typography from '@material-ui/core/Typography'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React, { useCallback } from 'react'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward'\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport { LinearGenomeViewStateModel, HEADER_BAR_HEIGHT } from '..'\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport OverviewScaleBar from './OverviewScaleBar'\nimport ZoomControls from './ZoomControls'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst WIDGET_HEIGHT = 32\nconst SPACING = 7\n\nconst useStyles = makeStyles(theme => ({\n  headerBar: {\n    height: HEADER_BAR_HEIGHT,\n    display: 'flex',\n  },\n  headerForm: {\n    flexWrap: 'nowrap',\n    marginRight: 7,\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n  input: {},\n  headerRefName: {\n    minWidth: 100,\n  },\n  panButton: {\n    background: fade(theme.palette.background.paper, 0.8),\n    height: WIDGET_HEIGHT,\n    margin: SPACING,\n  },\n  bp: {\n    display: 'flex',\n    alignItems: 'center',\n    marginLeft: 5,\n  },\n  toggleButton: {\n    height: 44,\n    border: 'none',\n    margin: theme.spacing(0.5),\n  },\n  buttonSpacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst Controls = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <Button\n      onClick={model.activateTrackSelector}\n      className={classes.toggleButton}\n      title=\"Open track selector\"\n      value=\"track_select\"\n      color=\"secondary\"\n    >\n      <TrackSelectorIcon className={classes.buttonSpacer} />\n    </Button>\n  )\n})\n\nfunction PanControls({ model }: { model: LGV }) {\n  const classes = useStyles()\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(-0.9)}\n      >\n        <ArrowBackIcon />\n      </Button>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(0.9)}\n      >\n        <ArrowForwardIcon />\n      </Button>\n    </>\n  )\n}\n\nconst RegionWidth = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const { coarseTotalBp } = model\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.bp}>\n      {`${Math.round(coarseTotalBp).toLocaleString('en-US')} bp`}\n    </Typography>\n  )\n})\n\nconst LinearGenomeViewHeader = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const session = getSession(model)\n  const { coarseDynamicBlocks: contentBlocks, displayedRegions } = model\n\n  const setDisplayedRegion = useCallback(\n    (newRegionValue: string | undefined) => {\n      try {\n        if (newRegionValue) {\n          const newRegion: Region | undefined = model.displayedRegions.find(\n            region => newRegionValue === region.refName,\n          )\n          // navigate to region or if region not found try navigating to\n          // locstring. note: we use showAllRegions after setDisplayedRegions\n          // to make the entire region visible, xref #1703\n          if (newRegion) {\n            model.setDisplayedRegions([newRegion])\n\n            model.showAllRegions()\n          } else {\n            newRegionValue && model.navToLocString(newRegionValue)\n          }\n        }\n      } catch (e) {\n        console.warn(e)\n        session.notify(`${e}`, 'warning')\n      }\n    },\n    [model, session],\n  )\n\n  const { assemblyName, refName } = contentBlocks[0] || { refName: '' }\n\n  const controls = (\n    <div className={classes.headerBar}>\n      <Controls model={model} />\n      <div className={classes.spacer} />\n      <FormGroup row className={classes.headerForm}>\n        <PanControls model={model} />\n        <RefNameAutocomplete\n          onSelect={setDisplayedRegion}\n          assemblyName={assemblyName}\n          value={displayedRegions.length > 1 ? '' : refName}\n          model={model}\n          TextFieldProps={{\n            variant: 'outlined',\n            className: classes.headerRefName,\n            style: { margin: SPACING, minWidth: '175px' },\n            InputProps: {\n              style: {\n                padding: 0,\n                height: WIDGET_HEIGHT,\n                background: fade(theme.palette.background.paper, 0.8),\n              },\n            },\n          }}\n        />\n      </FormGroup>\n      <RegionWidth model={model} />\n      <ZoomControls model={model} />\n      <div className={classes.spacer} />\n    </div>\n  )\n\n  if (model.hideHeaderOverview) {\n    return controls\n  }\n\n  return <OverviewScaleBar model={model}>{controls}</OverviewScaleBar>\n})\n\nexport default LinearGenomeViewHeader\n","import { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport IconButton from '@material-ui/core/IconButton'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport Typography from '@material-ui/core/Typography'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport DragIcon from '@material-ui/icons/DragIndicator'\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    background: fade(theme.palette.background.paper, 0.8),\n    '&:hover': {\n      background: theme.palette.background.paper,\n    },\n    transition: theme.transitions.create(['background'], {\n      duration: theme.transitions.duration.shortest,\n    }),\n  },\n  trackName: {\n    margin: '0 auto',\n    width: '90%',\n    fontSize: '0.8rem',\n    pointerEvents: 'none',\n  },\n  dragHandle: {\n    cursor: 'grab',\n    color: '#135560',\n  },\n  dragHandleIcon: {\n    display: 'inline-block',\n    verticalAlign: 'middle',\n    pointerEvents: 'none',\n  },\n  iconButton: {\n    padding: theme.spacing(1),\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst TrackLabel = React.forwardRef(\n  (props: { track: BaseTrackModel; className?: string }, ref) => {\n    const classes = useStyles()\n    const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null)\n    const { track, className } = props\n    const view = getContainingView(track) as LGV\n    const session = getSession(track)\n    const trackConf = track.configuration\n    const trackId = getConf(track, 'trackId')\n\n    const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n      setAnchorEl(event.currentTarget)\n    }\n\n    const handleClose = () => {\n      setAnchorEl(null)\n    }\n\n    const onDragStart = (event: React.DragEvent<HTMLSpanElement>) => {\n      const target = event.target as HTMLElement\n      if (target.parentNode) {\n        event.dataTransfer.setDragImage(\n          target.parentNode as HTMLElement,\n          20,\n          20,\n        )\n        view.setDraggingTrackId(track.id)\n      }\n    }\n\n    const onDragEnd = () => {\n      view.setDraggingTrackId(undefined)\n    }\n\n    let trackName = getConf(track, 'name')\n    if (getConf(track, 'type') === 'ReferenceSequenceTrack') {\n      trackName = 'Reference Sequence'\n      session.assemblies.forEach(assembly => {\n        if (assembly.sequence === trackConf) {\n          trackName = `Reference Sequence (${readConfObject(assembly, 'name')})`\n        }\n      })\n    }\n\n    function handleMenuItemClick(_: unknown, callback: Function) {\n      callback()\n      handleClose()\n    }\n\n    return (\n      <>\n        <Paper ref={ref} className={clsx(className, classes.root)}>\n          <span\n            draggable\n            className={classes.dragHandle}\n            onDragStart={onDragStart}\n            onDragEnd={onDragEnd}\n            data-testid={`dragHandle-${view.id}-${trackId}`}\n          >\n            <DragIcon className={classes.dragHandleIcon} />\n          </span>\n          <IconButton\n            onClick={() => view.hideTrack(trackId)}\n            className={classes.iconButton}\n            title=\"close this track\"\n            color=\"secondary\"\n          >\n            <CloseIcon />\n          </IconButton>\n          <Typography\n            variant=\"body1\"\n            component=\"span\"\n            className={classes.trackName}\n          >\n            {trackName}\n          </Typography>\n          <IconButton\n            aria-controls=\"simple-menu\"\n            aria-haspopup=\"true\"\n            onClick={handleClick}\n            className={classes.iconButton}\n            color=\"secondary\"\n            data-testid=\"track_menu_icon\"\n            disabled={!track.trackMenuItems.length}\n          >\n            <MoreVertIcon />\n          </IconButton>\n        </Paper>\n        <Menu\n          anchorEl={anchorEl}\n          onMenuItemClick={handleMenuItemClick}\n          open={Boolean(anchorEl)}\n          onClose={handleClose}\n          menuItems={[\n            ...(session.getTrackActionMenuItems\n              ? session.getTrackActionMenuItems(trackConf)\n              : []),\n            ...track.trackMenuItems,\n          ].sort((a, b) => (b.priority || 0) - (a.priority || 0))}\n        />\n      </>\n    )\n  },\n)\n\nexport default observer(TrackLabel)\n","import React, { useEffect, useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { useDebouncedCallback, getContainingView } from '@jbrowse/core/util'\nimport clsx from 'clsx'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { LinearGenomeViewModel, RESIZE_HANDLE_HEIGHT } from '..'\nimport TrackLabel from './TrackLabel'\n\nconst useStyles = makeStyles(theme => ({\n  root: {},\n  resizeHandle: {\n    height: RESIZE_HANDLE_HEIGHT,\n    boxSizing: 'border-box',\n    position: 'relative',\n    zIndex: 2,\n  },\n  overlay: {\n    pointerEvents: 'none',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    zIndex: 3,\n    borderRadius: theme.shape.borderRadius,\n  },\n  renderingComponentContainer: {\n    position: 'absolute',\n    // -1 offset because of the 1px border of the Paper\n    left: -1,\n    height: '100%',\n    width: '100%',\n  },\n  trackLabel: {\n    zIndex: 3,\n    margin: theme.spacing(1),\n  },\n  trackLabelInline: {\n    position: 'relative',\n    display: 'inline-block',\n  },\n  trackLabelOverlap: {\n    position: 'absolute',\n  },\n  trackRenderingContainer: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    position: 'relative',\n    background: 'none',\n    zIndex: 2,\n    boxSizing: 'content-box',\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nfunction TrackContainer(props: {\n  model: LinearGenomeViewModel\n  track: BaseTrackModel\n}) {\n  const classes = useStyles()\n  const { model, track } = props\n  const display = track.displays[0]\n  const { horizontalScroll, draggingTrackId, moveTrack } = model\n  const { height } = display\n  const view = getContainingView(display) as LGV\n  const trackId = getConf(track, 'trackId')\n  const ref = useRef(null)\n\n  useEffect(() => {\n    if (ref.current) {\n      model.trackRefs[trackId] = ref.current\n    }\n    return () => {\n      delete model.trackRefs[trackId]\n    }\n  }, [model.trackRefs, trackId])\n  function onDragEnter() {\n    if (\n      draggingTrackId !== undefined &&\n      isAlive(display) &&\n      draggingTrackId !== display.id\n    ) {\n      moveTrack(draggingTrackId, track.id)\n    }\n  }\n  const debouncedOnDragEnter = useDebouncedCallback(onDragEnter, 100)\n  const { RenderingComponent, DisplayBlurb } = display\n  const dimmed = draggingTrackId !== undefined && draggingTrackId !== display.id\n\n  return (\n    <div className={classes.root}>\n      {view.trackLabels !== 'hidden' ? (\n        <TrackLabel\n          track={track}\n          className={clsx(\n            classes.trackLabel,\n            view.trackLabels === 'overlapping'\n              ? classes.trackLabelOverlap\n              : classes.trackLabelInline,\n          )}\n        />\n      ) : null}\n\n      <Paper\n        variant=\"outlined\"\n        className={classes.trackRenderingContainer}\n        style={{ height }}\n        onScroll={event => {\n          const target = event.target as HTMLDivElement\n          display.setScrollTop(target.scrollTop)\n        }}\n        onDragEnter={debouncedOnDragEnter}\n        data-testid={`trackRenderingContainer-${view.id}-${trackId}`}\n        role=\"presentation\"\n      >\n        <div\n          ref={ref}\n          className={classes.renderingComponentContainer}\n          style={{ transform: `scaleX(${model.scaleFactor})` }}\n        >\n          <RenderingComponent\n            model={display}\n            blockState={{}}\n            onHorizontalScroll={horizontalScroll}\n          />\n        </div>\n\n        {DisplayBlurb ? (\n          <div\n            style={{\n              position: 'absolute',\n              left: 0,\n              top: display.height - 20,\n            }}\n          >\n            {' '}\n            <DisplayBlurb model={display} />\n          </div>\n        ) : null}\n      </Paper>\n      <div\n        className={classes.overlay}\n        style={{\n          height: display.height,\n          background: dimmed ? 'rgba(0, 0, 0, 0.4)' : undefined,\n        }}\n        onDragEnter={debouncedOnDragEnter}\n      />\n      <ResizeHandle\n        onDrag={display.resizeHeight}\n        className={classes.resizeHandle}\n      />\n    </div>\n  )\n}\n\nexport default observer(TrackContainer)\n","import React, { useRef, useEffect, useState } from 'react'\nimport ReactPropTypes from 'prop-types'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\n// material ui\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport { Menu } from '@jbrowse/core/ui'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Popover from '@material-ui/core/Popover'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Typography from '@material-ui/core/Typography'\nimport ZoomInIcon from '@material-ui/icons/ZoomIn'\n\nimport { stringify } from '@jbrowse/core/util'\nimport { LinearGenomeViewStateModel } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => {\n  const background = theme.palette.tertiary\n    ? fade(theme.palette.tertiary.main, 0.7)\n    : fade(theme.palette.primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: theme.palette.tertiary\n        ? theme.palette.tertiary.contrastText\n        : theme.palette.primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nconst VerticalGuide = observer(\n  ({ model, coordX }: { model: LGV; coordX: number }) => {\n    const classes = useStyles()\n    return (\n      <Tooltip\n        open\n        placement=\"top\"\n        title={stringify(model.pxToBp(coordX))}\n        arrow\n      >\n        <div\n          className={classes.guide}\n          style={{\n            left: coordX,\n            background: 'red',\n          }}\n        />\n      </Tooltip>\n    )\n  },\n)\n\nfunction RubberBand({\n  model,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n\n  // clientX and clientY used for anchorPosition for menu\n  // offsetX used for calculations about width of selection\n  const [anchorPosition, setAnchorPosition] = useState<{\n    offsetX: number\n    clientX: number\n    clientY: number\n  }>()\n  const [guideX, setGuideX] = useState<number | undefined>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined && anchorPosition === undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp(event: MouseEvent) {\n      if (startX !== undefined && controlsRef.current) {\n        const { clientX, clientY } = event\n        const ref = controlsRef.current\n        const offsetX = clientX - ref.getBoundingClientRect().left\n        // as stated above, store both clientX/Y and offsetX for different\n        // purposes\n        setAnchorPosition({\n          offsetX,\n          clientX,\n          clientY,\n        })\n        setGuideX(undefined)\n      }\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove)\n      window.addEventListener('mouseup', globalMouseUp)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove)\n        window.removeEventListener('mouseup', globalMouseUp)\n      }\n    }\n    return () => {}\n  }, [startX, mouseDragging, anchorPosition])\n\n  useEffect(() => {\n    if (\n      !mouseDragging &&\n      currentX !== undefined &&\n      startX !== undefined &&\n      Math.abs(currentX - startX) <= 3\n    ) {\n      handleClose()\n    }\n  }, [mouseDragging, currentX, startX, model.bpPerPx])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    const relativeX =\n      event.clientX -\n      (event.target as HTMLDivElement).getBoundingClientRect().left\n    setStartX(relativeX)\n    setCurrentX(relativeX)\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    const target = event.target as HTMLDivElement\n    setGuideX(event.clientX - target.getBoundingClientRect().left)\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n    model.setOffsets(undefined, undefined)\n  }\n\n  function zoomToRegion() {\n    if (startX === undefined || anchorPosition === undefined) {\n      return\n    }\n    let leftPx = startX\n    let rightPx = anchorPosition.offsetX\n    if (rightPx < leftPx) {\n      ;[leftPx, rightPx] = [rightPx, leftPx]\n    }\n    const leftOffset = model.pxToBp(leftPx)\n    const rightOffset = model.pxToBp(rightPx)\n    model.moveTo(leftOffset, rightOffset)\n  }\n\n  function getSequence() {\n    if (startX === undefined || anchorPosition === undefined) {\n      return\n    }\n    let leftPx = startX\n    let rightPx = anchorPosition.offsetX\n    // handles clicking and draging to the left\n    if (rightPx < leftPx) {\n      ;[leftPx, rightPx] = [rightPx, leftPx]\n    }\n    const leftOffset = model.pxToBp(leftPx)\n    const rightOffset = model.pxToBp(rightPx)\n    model.setOffsets(leftOffset, rightOffset)\n  }\n\n  function handleClose() {\n    setAnchorPosition(undefined)\n    setStartX(undefined)\n    setCurrentX(undefined)\n  }\n\n  const open = Boolean(anchorPosition)\n\n  function handleMenuItemClick(_: unknown, callback: Function) {\n    callback()\n    handleClose()\n  }\n\n  const menuItems = [\n    {\n      label: 'Zoom to region',\n      icon: ZoomInIcon,\n      onClick: () => {\n        zoomToRegion()\n        handleClose()\n      },\n    },\n    {\n      label: 'Get sequence',\n      disabled:\n        currentX !== undefined &&\n        startX !== undefined &&\n        Math.abs(currentX - startX) * model.bpPerPx > 500_000_000,\n      icon: MenuOpenIcon,\n      onClick: () => {\n        getSequence()\n        handleClose()\n      },\n    },\n  ]\n\n  if (startX === undefined) {\n    return (\n      <>\n        {guideX !== undefined ? (\n          <VerticalGuide model={model} coordX={guideX} />\n        ) : null}\n        <div\n          data-testid=\"rubberBand_controls\"\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </>\n    )\n  }\n\n  /* Calculating Pixels for Mouse Dragging */\n  const right = anchorPosition ? anchorPosition.offsetX : currentX || 0\n  const left = right < startX ? right : startX\n  const width = Math.abs(right - startX)\n  const leftBpOffset = model.pxToBp(left)\n  const rightBpOffset = model.pxToBp(left + width)\n  const numOfBpSelected = Math.ceil(width * model.bpPerPx)\n  return (\n    <>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(leftBpOffset)}</Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(rightBpOffset)}</Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{ left, width }}\n      >\n        <Typography variant=\"h6\" className={classes.rubberBandText}>\n          {numOfBpSelected.toLocaleString('en-US')} bp\n        </Typography>\n      </div>\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={menuItems}\n        />\n      ) : null}\n    </>\n  )\n}\n\nRubberBand.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  ControlComponent: ReactPropTypes.node,\n}\n\nRubberBand.defaultProps = {\n  ControlComponent: <div />,\n}\n\nexport default observer(RubberBand)\n","import {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  scaleBarContainer: {\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  scaleBarZoomContainer: {\n    position: 'relative',\n    zIndex: 1,\n  },\n  scaleBar: {\n    position: 'absolute',\n    display: 'flex',\n    pointerEvents: 'none',\n  },\n  majorTickLabel: {\n    fontSize: '11px',\n    zIndex: 1,\n    background: theme.palette.background.paper,\n    lineHeight: 'normal',\n    pointerEvents: 'none',\n  },\n  tick: {\n    position: 'absolute',\n    width: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  refLabel: {\n    fontSize: '11px',\n    position: 'absolute',\n    left: '2px',\n    top: '-1px',\n    fontWeight: 'bold',\n    lineHeight: 'normal',\n    zIndex: 1,\n    pointerEvents: 'none',\n    background: theme.palette.background.paper,\n  },\n}))\n\nconst RenderedRefNameLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n\n  // find the block that needs pinning to the left side for context\n  let lastLeftBlock = 0\n  model.staticBlocks.forEach((block, i) => {\n    if (block.offsetPx - model.offsetPx < 0) {\n      lastLeftBlock = i\n    }\n  })\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        return block instanceof ContentBlock &&\n          (block.isLeftEndOfDisplayedRegion || index === lastLeftBlock) ? (\n          <Typography\n            key={`refLabel-${block.key}-${index}`}\n            style={{\n              left:\n                index === lastLeftBlock\n                  ? Math.max(0, -model.offsetPx)\n                  : block.offsetPx - model.offsetPx - 1,\n              paddingLeft: index === lastLeftBlock ? 0 : 1,\n            }}\n            className={classes.refLabel}\n            data-testid={`refLabel-${block.refName}`}\n          >\n            {block.refName}\n          </Typography>\n        ) : null\n      })}\n    </>\n  )\n})\n\nconst RenderedScaleBarLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(\n            block.start,\n            block.end,\n            model.bpPerPx,\n            true,\n            false,\n          )\n\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                if (tick.type === 'major') {\n                  const x =\n                    (block.reversed\n                      ? block.end - tick.base\n                      : tick.base - block.start) / model.bpPerPx\n                  const baseNumber = (tick.base + 1).toLocaleString('en-US')\n                  return (\n                    <div\n                      key={tick.base}\n                      className={classes.tick}\n                      style={{ left: x }}\n                    >\n                      {baseNumber ? (\n                        <Typography className={classes.majorTickLabel}>\n                          {baseNumber}\n                        </Typography>\n                      ) : null}\n                    </div>\n                  )\n                }\n                return null\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\n\nconst ScaleBar = React.forwardRef(\n  (\n    {\n      model,\n      style,\n      className,\n      ...other\n    }: { model: LGV; style?: React.CSSProperties; className?: string },\n    ref,\n  ) => {\n    const classes = useStyles()\n\n    const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n    return (\n      <Paper\n        data-resizer=\"true\" // used to avoid click-and-drag scrolls on trackscontainer\n        className={clsx(classes.scaleBarContainer, className)}\n        variant=\"outlined\"\n        ref={ref}\n        style={style}\n        {...other}\n      >\n        <div\n          className={classes.scaleBarZoomContainer}\n          style={{\n            transform:\n              model.scaleFactor !== 1\n                ? `scaleX(${model.scaleFactor})`\n                : undefined,\n          }}\n        >\n          <div\n            className={classes.scaleBar}\n            style={{\n              left: offsetLeft - 1,\n              width: model.staticBlocks.totalWidthPx,\n              ...style,\n            }}\n          >\n            <RenderedScaleBarLabels model={model} />\n          </div>\n        </div>\n        <RenderedRefNameLabels model={model} />\n      </Paper>\n    )\n  },\n)\n\nexport default observer(ScaleBar)\n","import {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\n\nimport { makeTicks } from '../util'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  verticalGuidesZoomContainer: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n  },\n  verticalGuidesContainer: {\n    position: 'absolute',\n    height: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n    display: 'flex',\n  },\n  tick: {\n    position: 'absolute',\n    height: '100%',\n    width: 1,\n  },\n  majorTick: {\n    background: theme.palette.text.hint,\n  },\n  minorTick: {\n    background: theme.palette.divider,\n  },\n}))\nconst RenderedVerticalGuides = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(block.start, block.end, model.bpPerPx)\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                const x =\n                  (block.reversed\n                    ? block.end - tick.base\n                    : tick.base - block.start) / model.bpPerPx\n                return (\n                  <div\n                    key={tick.base}\n                    className={clsx(\n                      classes.tick,\n                      tick.type === 'major' || tick.type === 'labeledMajor'\n                        ? classes.majorTick\n                        : classes.minorTick,\n                    )}\n                    style={{ left: x }}\n                  />\n                )\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\nfunction VerticalGuides({ model }: { model: LGV }) {\n  const classes = useStyles()\n  // find the block that needs pinning to the left side for context\n  const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n  return (\n    <div\n      className={classes.verticalGuidesZoomContainer}\n      style={{\n        transform:\n          model.scaleFactor !== 1 ? `scaleX(${model.scaleFactor})` : undefined,\n      }}\n    >\n      <div\n        className={classes.verticalGuidesContainer}\n        style={{\n          left: offsetLeft,\n          width: model.staticBlocks.totalWidthPx,\n        }}\n      >\n        <RenderedVerticalGuides model={model} />\n      </div>\n    </div>\n  )\n}\n\nexport default observer(VerticalGuides)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useRef } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(() => ({\n  centerLineContainer: {\n    background: 'transparent',\n    height: '100%',\n    zIndex: 5, // above the track but under menu\n    position: 'absolute',\n    border: '1px black dashed',\n    borderTop: 'none',\n    borderBottom: 'none',\n    pointerEvents: 'none',\n  },\n  centerLineText: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    whiteSpace: 'nowrap',\n    fontWeight: 'bold',\n  },\n}))\n\nfunction CenterLine({ model }: { model: LGV }) {\n  const { bpPerPx, centerLineInfo, trackHeights, tracks, width } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const classes = useStyles()\n  const startingPosition = width / 2\n\n  return tracks.length ? (\n    <div\n      data-testid=\"centerline_container\"\n      className={classes.centerLineContainer}\n      role=\"presentation\"\n      ref={ref}\n      style={{\n        left: `${startingPosition}px`,\n        width: Math.max(1 / bpPerPx, 1),\n      }}\n    >\n      {centerLineInfo && (\n        <div\n          // text that indicates what bp is center, positioned\n          // at the bottom right of the center line\n          data-testid=\"centerline_text\"\n          className={classes.centerLineText}\n          role=\"presentation\"\n          style={{\n            left: Math.max(1 / bpPerPx, 1) + 5,\n            top: trackHeights,\n          }}\n        >\n          {/* change bp to refName */}\n          {centerLineInfo.refName}:{' '}\n          {Math.max(Math.round(centerLineInfo.offset) + 1, 0)}\n        </div>\n      )}\n    </div>\n  ) : null\n}\n\nCenterLine.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(CenterLine)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React, { useEffect, useRef, useState } from 'react'\nimport normalizeWheel from 'normalize-wheel'\n\nimport {\n  LinearGenomeViewStateModel,\n  RESIZE_HANDLE_HEIGHT,\n  SCALE_BAR_HEIGHT,\n} from '..'\nimport RubberBand from './RubberBand'\nimport ScaleBar from './ScaleBar'\nimport VerticalGuides from './VerticalGuides'\nimport CenterLine from './CenterLine'\n\nconst useStyles = makeStyles(theme => ({\n  tracksContainer: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    overflow: 'hidden',\n  },\n  spacer: {\n    position: 'relative',\n    height: RESIZE_HANDLE_HEIGHT,\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\ntype Timer = ReturnType<typeof setTimeout>\n\nfunction TracksContainer({\n  children,\n  model,\n}: {\n  children: React.ReactNode\n  model: LGV\n}) {\n  const classes = useStyles()\n  // refs are to store these variables to avoid repeated rerenders associated\n  // with useState/setState\n  const delta = useRef(0)\n  const scheduled = useRef(false)\n  const timeout = useRef<Timer>()\n  const ref = useRef<HTMLDivElement>(null)\n  const prevX = useRef<number>(0)\n\n  const [mouseDragging, setMouseDragging] = useState(false)\n\n  useEffect(() => {\n    let cleanup = () => {}\n\n    function globalMouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const currX = event.clientX\n      const distance = currX - prevX.current\n      if (distance) {\n        // use rAF to make it so multiple event handlers aren't fired per-frame\n        // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n        if (!scheduled.current) {\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(-distance)\n            scheduled.current = false\n            prevX.current = event.clientX\n          })\n        }\n      }\n    }\n\n    function globalMouseUp() {\n      prevX.current = 0\n      if (mouseDragging) {\n        setMouseDragging(false)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      cleanup = () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n      }\n    }\n    return cleanup\n  }, [model, mouseDragging, prevX])\n\n  function mouseDown(event: React.MouseEvent) {\n    // check if clicking a draggable element or a resize handle\n    const target = event.target as HTMLElement\n    if (target.draggable || target.dataset.resizer) {\n      return\n    }\n\n    // otherwise do click and drag scroll\n    if (event.button === 0) {\n      prevX.current = event.clientX\n      setMouseDragging(true)\n    }\n  }\n\n  // this local mouseup is used in addition to the global because sometimes\n  // the global add/remove are not called in time, resulting in issue #533\n  function mouseUp(event: React.MouseEvent) {\n    event.preventDefault()\n    setMouseDragging(false)\n  }\n\n  function mouseLeave(event: React.MouseEvent) {\n    event.preventDefault()\n  }\n\n  useEffect(() => {\n    const curr = ref.current\n    // if ctrl is held down, zoom in with y-scroll\n    // else scroll horizontally with x-scroll\n    function onWheel(origEvent: WheelEvent) {\n      const event = normalizeWheel(origEvent)\n      if (origEvent.ctrlKey === true) {\n        origEvent.preventDefault()\n        delta.current += event.pixelY / 500\n        model.setScaleFactor(\n          delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n        )\n        if (timeout.current) {\n          clearTimeout(timeout.current)\n        }\n        timeout.current = setTimeout(() => {\n          model.setScaleFactor(1)\n          model.zoomTo(\n            delta.current > 0\n              ? model.bpPerPx * (1 + delta.current)\n              : model.bpPerPx / (1 - delta.current),\n          )\n          delta.current = 0\n        }, 300)\n      } else {\n        // this is needed to stop the event from triggering \"back button\n        // action\" on MacOSX etc.  but is a heuristic to avoid preventing the\n        // inner-track scroll behavior\n        if (Math.abs(event.pixelX) > Math.abs(2 * event.pixelY)) {\n          origEvent.preventDefault()\n        }\n        delta.current += event.pixelX\n        if (!scheduled.current) {\n          // use rAF to make it so multiple event handlers aren't fired per-frame\n          // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(delta.current)\n            delta.current = 0\n            scheduled.current = false\n          })\n        }\n      }\n    }\n    if (curr) {\n      curr.addEventListener('wheel', onWheel)\n      return () => {\n        curr.removeEventListener('wheel', onWheel)\n      }\n    }\n    return () => {}\n  }, [model])\n\n  return (\n    <div\n      ref={ref}\n      role=\"presentation\"\n      className={classes.tracksContainer}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseLeave={mouseLeave}\n    >\n      <VerticalGuides model={model} />\n      {model.showCenterLine ? <CenterLine model={model} /> : null}\n\n      <RubberBand\n        model={model}\n        ControlComponent={\n          <ScaleBar\n            model={model}\n            style={{ height: SCALE_BAR_HEIGHT, boxSizing: 'border-box' }}\n          />\n        }\n      />\n      <div className={classes.spacer} />\n      {children}\n    </div>\n  )\n}\n\nexport default observer(TracksContainer)\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\n// material ui\nimport { makeStyles } from '@material-ui/core/styles'\nimport Button from '@material-ui/core/Button'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport TextField from '@material-ui/core/TextField'\nimport Container from '@material-ui/core/Container'\nimport Grid from '@material-ui/core/Grid'\nimport MenuItem from '@material-ui/core/MenuItem'\n// other\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  importFormContainer: {\n    padding: theme.spacing(2),\n  },\n  importFormEntry: {\n    minWidth: 180,\n  },\n  button: {\n    margin: theme.spacing(2),\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nconst ImportForm = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { assemblyNames, assemblyManager } = session\n  const [selectedAssemblyIdx, setSelectedAssemblyIdx] = useState(0)\n  const [selectedRegion, setSelectedRegion] = useState<string | undefined>('')\n  const [assemblyRegions, setAssemblyRegions] = useState<Region[]>([])\n  const error = !assemblyNames.length ? 'No configured assemblies' : ''\n  const hasError = Boolean(error)\n  const assemblyName = assemblyNames[selectedAssemblyIdx]\n  const displayName = assemblyName && !error ? selectedAssemblyIdx : ''\n\n  useEffect(() => {\n    let done = false\n    ;(async () => {\n      if (assemblyName) {\n        const assembly = await assemblyManager.waitForAssembly(assemblyName)\n        if (assembly && assembly.regions) {\n          const regions = getSnapshot(assembly.regions)\n          if (!done && regions) {\n            setSelectedRegion(regions[0].refName)\n            setAssemblyRegions(regions)\n          }\n        }\n      }\n    })()\n    return () => {\n      done = true\n    }\n  }, [assemblyManager, assemblyName])\n\n  function handleSelectedRegion(input: string) {\n    const newRegion = assemblyRegions.find(r => selectedRegion === r.refName)\n    if (newRegion) {\n      model.setDisplayedRegions([newRegion])\n      // we use showAllRegions after setDisplayedRegions to make the entire\n      // region visible, xref #1703\n      model.showAllRegions()\n    } else {\n      try {\n        input && model.navToLocString(input, assemblyName)\n      } catch (e) {\n        console.warn(e)\n        session.notify(`${e}`, 'warning')\n      }\n    }\n  }\n\n  return (\n    <Container className={classes.importFormContainer}>\n      <Grid container spacing={1} justify=\"center\" alignItems=\"center\">\n        <Grid item>\n          <TextField\n            select\n            variant=\"outlined\"\n            value={displayName}\n            onChange={event => {\n              setSelectedAssemblyIdx(Number(event.target.value))\n            }}\n            label=\"Assembly\"\n            helperText={error || 'Select assembly to view'}\n            error={hasError}\n            disabled={hasError}\n            margin=\"normal\"\n            className={classes.importFormEntry}\n          >\n            {assemblyNames.map((name, idx) => (\n              <MenuItem key={name} value={idx}>\n                {name}\n              </MenuItem>\n            ))}\n          </TextField>\n        </Grid>\n        <Grid item>\n          {assemblyName ? (\n            selectedRegion && model.volatileWidth ? (\n              <RefNameAutocomplete\n                model={model}\n                assemblyName={\n                  error ? undefined : assemblyNames[selectedAssemblyIdx]\n                }\n                value={selectedRegion}\n                onSelect={setSelectedRegion}\n                TextFieldProps={{\n                  margin: 'normal',\n                  variant: 'outlined',\n                  className: classes.importFormEntry,\n                  helperText: 'Enter a sequence or locstring',\n                  onBlur: event => {\n                    setSelectedRegion((event.target as HTMLInputElement).value)\n                  },\n                  onKeyPress: event => {\n                    const inputValue = (event.target as HTMLInputElement).value\n                    if (event.key === 'Enter') {\n                      handleSelectedRegion(inputValue)\n                    }\n                  },\n                }}\n              />\n            ) : (\n              <CircularProgress\n                role=\"progressbar\"\n                color=\"inherit\"\n                size={20}\n                disableShrink\n              />\n            )\n          ) : null}\n        </Grid>\n        <Grid item>\n          <Button\n            disabled={!selectedRegion}\n            className={classes.button}\n            onClick={() => {\n              if (selectedRegion) {\n                handleSelectedRegion(selectedRegion)\n              }\n            }}\n            variant=\"contained\"\n            color=\"primary\"\n          >\n            Open\n          </Button>\n          <Button\n            disabled={!selectedRegion}\n            className={classes.button}\n            onClick={() => {\n              model.showAllRegionsInAssembly(assemblyName)\n            }}\n            variant=\"contained\"\n            color=\"secondary\"\n          >\n            Show all regions in assembly\n          </Button>\n        </Grid>\n      </Grid>\n    </Container>\n  )\n})\n\nexport default ImportForm\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport ArrowDown from '@material-ui/icons/KeyboardArrowDown'\nimport Paper from '@material-ui/core/Paper'\nimport Menu from '@jbrowse/core/ui/Menu'\nimport { LinearGenomeViewModel } from '..'\n\nconst MiniControls = observer((props: { model: LinearGenomeViewModel }) => {\n  const { model } = props\n  const { bpPerPx, maxBpPerPx, minBpPerPx, scaleFactor } = model\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n\n  return (\n    <>\n      <Paper style={{ background: '#aaa7' }}>\n        <IconButton\n          color=\"secondary\"\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n        >\n          <ArrowDown />\n        </IconButton>\n\n        <IconButton\n          data-testid=\"zoom_out\"\n          onClick={() => {\n            model.zoom(bpPerPx * 2)\n          }}\n          disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomOut />\n        </IconButton>\n        <IconButton\n          data-testid=\"zoom_in\"\n          onClick={() => {\n            model.zoom(model.bpPerPx / 2)\n          }}\n          disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomIn />\n        </IconButton>\n      </Paper>\n      <Menu\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onMenuItemClick={(_, callback) => {\n          callback()\n          setAnchorEl(undefined)\n        }}\n        onClose={() => {\n          setAnchorEl(undefined)\n        }}\n        menuItems={model.menuItems}\n      />\n    </>\n  )\n})\n\nexport default MiniControls\n","import React, { useEffect, useMemo, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { saveAs } from 'file-saver'\nimport { Region } from '@jbrowse/core/util/types'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport copy from 'copy-to-clipboard'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Container,\n  Typography,\n  Divider,\n  IconButton,\n  TextField,\n} from '@material-ui/core'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport CloseIcon from '@material-ui/icons/Close'\nimport GetAppIcon from '@material-ui/icons/GetApp'\nimport { getSession } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { formatSeqFasta, SeqChunk } from '@jbrowse/core/util/formatFastaStrings'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  loadingMessage: {\n    padding: theme.spacing(5),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n  dialogContent: {\n    width: '80em',\n  },\n  textAreaFont: {\n    fontFamily: 'Courier New',\n  },\n}))\n\n/**\n * Fetches and returns a list features for a given list of regions\n * @param selectedRegions - Region[]\n * @returns Features[]\n */\nasync function fetchSequence(\n  self: LinearGenomeViewModel,\n  selectedRegions: Region[],\n) {\n  const session = getSession(self)\n  const assemblyName =\n    self.leftOffset?.assemblyName || self.rightOffset?.assemblyName || ''\n  const { rpcManager, assemblyManager } = session\n  const assemblyConfig = assemblyManager.get(assemblyName)?.configuration\n\n  // assembly configuration\n  const adapterConfig = readConfObject(assemblyConfig, ['sequence', 'adapter'])\n\n  const sessionId = 'getSequence'\n  const chunks = (await Promise.all(\n    selectedRegions.map(region =>\n      rpcManager.call(sessionId, 'CoreGetFeatures', {\n        adapterConfig,\n        region,\n        sessionId,\n      }),\n    ),\n  )) as Feature[][]\n\n  // assumes that we get whole sequence in a single getFeatures call\n  return chunks.map(chunk => chunk[0])\n}\n\nfunction SequenceDialog({\n  model,\n  handleClose,\n}: {\n  model: LinearGenomeViewModel\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const [error, setError] = useState<Error>()\n  const [sequence, setSequence] = useState('')\n  const loading = Boolean(!sequence) || Boolean(error)\n  const { leftOffset, rightOffset } = model\n\n  // avoid infinite looping of useEffect\n  // random note: the current selected region can't be a computed because it\n  // uses action on base1dview even though it's on the ephemeral base1dview\n  const regionsSelected = useMemo(\n    () => model.getSelectedRegions(leftOffset, rightOffset),\n    [model, leftOffset, rightOffset],\n  )\n\n  useEffect(() => {\n    let active = true\n\n    function formatSequence(seqChunks: Feature[]) {\n      const sequenceChunks: SeqChunk[] = []\n      const incompleteSeqErrs: string[] = []\n      seqChunks.forEach((chunk: Feature) => {\n        const chunkSeq = chunk.get('seq')\n        const chunkRefName = chunk.get('refName')\n        const chunkStart = chunk.get('start') + 1\n        const chunkEnd = chunk.get('end')\n        const chunkLocstring = `${chunkRefName}:${chunkStart}-${chunkEnd}`\n        if (chunkSeq) {\n          sequenceChunks.push({ header: chunkLocstring, seq: chunkSeq })\n          if (chunkSeq.length !== chunkEnd - chunkStart + 1) {\n            incompleteSeqErrs.push(\n              `${chunkLocstring} returned ${chunkSeq.length.toLocaleString()} bases, but should have returned ${(\n                chunkEnd - chunkStart\n              ).toLocaleString()}`,\n            )\n          }\n        }\n      })\n      if (incompleteSeqErrs.length > 0) {\n        session.notify(\n          `Unable to retrieve complete reference sequence from regions:${incompleteSeqErrs.join()}`,\n        )\n      }\n      setSequence(formatSeqFasta(sequenceChunks))\n    }\n\n    ;(async () => {\n      try {\n        if (regionsSelected.length > 0) {\n          const chunks = await fetchSequence(model, regionsSelected)\n          if (active) {\n            formatSequence(chunks)\n          }\n        } else {\n          throw new Error('Selected region is out of bounds')\n        }\n      } catch (e) {\n        console.error(e)\n        if (active) {\n          setError(e)\n        }\n      }\n    })()\n\n    return () => {\n      active = false\n    }\n  }, [model, session, regionsSelected, setSequence])\n\n  const sequenceTooLarge = sequence.length > 1_000_000\n\n  return (\n    <Dialog\n      data-testid=\"sequence-dialog\"\n      maxWidth=\"xl\"\n      open\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">\n        Reference sequence\n        {handleClose ? (\n          <IconButton\n            data-testid=\"close-seqDialog\"\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n              model.setOffsets(undefined, undefined)\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n\n      <DialogContent>\n        {error ? <Typography color=\"error\">{`${error}`}</Typography> : null}\n        {loading && !error ? (\n          <Container>\n            Retrieving reference sequence...\n            <CircularProgress\n              style={{\n                marginLeft: 10,\n              }}\n              size={20}\n              disableShrink\n            />\n          </Container>\n        ) : null}\n        {sequence !== undefined ? (\n          <TextField\n            data-testid=\"rubberband-sequence\"\n            variant=\"outlined\"\n            multiline\n            rows={3}\n            rowsMax={5}\n            disabled={sequenceTooLarge}\n            className={classes.dialogContent}\n            fullWidth\n            value={\n              sequenceTooLarge\n                ? 'Reference sequence too large to display, use the download FASTA button'\n                : sequence\n            }\n            InputProps={{\n              readOnly: true,\n              classes: {\n                input: classes.textAreaFont,\n              },\n            }}\n          />\n        ) : null}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            copy(sequence || '')\n            session.notify('Copied to clipboard', 'success')\n          }}\n          disabled={loading || sequenceTooLarge}\n          color=\"primary\"\n          startIcon={<ContentCopyIcon />}\n        >\n          Copy to clipboard\n        </Button>\n        <Button\n          onClick={() => {\n            const seqFastaFile = new Blob([sequence || ''], {\n              type: 'text/x-fasta;charset=utf-8',\n            })\n            saveAs(seqFastaFile, 'jbrowse_ref_seq.fa')\n          }}\n          disabled={loading}\n          color=\"primary\"\n          startIcon={<GetAppIcon />}\n        >\n          Download FASTA\n        </Button>\n        <Button\n          onClick={() => {\n            handleClose()\n            model.setOffsets(undefined, undefined)\n          }}\n          color=\"primary\"\n          autoFocus\n        >\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(SequenceDialog)\n","export interface SeqChunk {\n  header: string\n  seq: string\n}\n/**\n * Returns sequence with new line every 80 characters\n * ref https://stackoverflow.com/a/51506718/2129219\n *\n * @param seqString -  string\n * @returns formated sequence string\n */\nexport function formatFastaLines(seqString: string) {\n  return seqString.replace(/(.{1,80})/g, '$1\\n').trimEnd()\n}\n/**\n * Formats the sequences chunks into Fasta format\n *\n * @param chunks - array of seq chunks of the form `{ header: string, seq: string }`\n * @returns formatted sequence in fasta format\n */\nexport function formatSeqFasta(chunks: SeqChunk[]) {\n  return chunks\n    .map(chunk => `>${chunk.header}\\n${formatFastaLines(chunk.seq)}`)\n    .join('\\n')\n}\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport { makeTicks } from '../util'\n\nfunction mathPower(num: number): string {\n  if (num < 999) {\n    return String(num)\n  }\n  return `${mathPower(~~(num / 1000))},${`00${~~(num % 1000)}`.substr(-3, 3)}`\n}\n\nconst useStyles = makeStyles((/* theme */) => ({\n  majorTickLabel: {\n    fontSize: '11px',\n    // fill: theme.palette.text.primary,\n  },\n  majorTick: {\n    stroke: '#555',\n    // stroke: theme.palette.text.secondary,\n  },\n  minorTick: {\n    stroke: '#999',\n    // stroke: theme.palette.text.hint,\n  },\n}))\n\nfunction Ruler({\n  start,\n  end,\n  bpPerPx,\n  reversed,\n  major,\n  minor,\n}: {\n  start: number\n  end: number\n  bpPerPx: number\n  reversed?: boolean\n  major: boolean\n  minor: boolean\n}) {\n  const classes = useStyles()\n  const ticks = makeTicks(start, end, bpPerPx, major, minor)\n  return (\n    <>\n      {ticks.map(tick => {\n        const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n        return (\n          <line\n            key={tick.base}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={tick.type === 'major' ? 6 : 4}\n            strokeWidth={1}\n            stroke={tick.type === 'major' ? '#555' : '#999'}\n            className={\n              tick.type === 'major' ? classes.majorTick : classes.minorTick\n            }\n            data-bp={tick.base}\n          />\n        )\n      })}\n      {ticks\n        .filter(tick => tick.type === 'major')\n        .map(tick => {\n          const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n          return (\n            <text\n              x={x - 3}\n              y={7 + 11}\n              key={`label-${tick.base}`}\n              style={{ fontSize: '11px' }}\n              className={classes.majorTickLabel}\n            >\n              {mathPower(tick.base + 1)}\n            </text>\n          )\n        })}\n    </>\n  )\n}\n\nRuler.propTypes = {\n  start: ReactPropTypes.number.isRequired,\n  end: ReactPropTypes.number.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  reversed: ReactPropTypes.bool,\n  major: ReactPropTypes.bool,\n  minor: ReactPropTypes.bool,\n}\n\nRuler.defaultProps = {\n  reversed: false,\n  major: true,\n  minor: true,\n}\n\nexport default observer(Ruler)\n","import React from 'react'\nimport { renderToStaticMarkup } from 'react-dom/server'\n\n// material ui things\nimport { Button, Paper, Typography, makeStyles } from '@material-ui/core'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\n\n// misc\nimport { when } from 'mobx'\nimport { observer } from 'mobx-react'\nimport { getParent, Instance } from 'mobx-state-tree'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\n// locals\nimport { LinearGenomeViewStateModel, ExportSvgOptions } from '..'\nimport Header from './Header'\nimport TrackContainer from './TrackContainer'\nimport TracksContainer from './TracksContainer'\nimport ImportForm from './ImportForm'\nimport MiniControls from './MiniControls'\nimport SequenceDialog from './SequenceDialog'\nimport Ruler from './Ruler'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  errorMessage: {\n    textAlign: 'center',\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n  spacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst LinearGenomeView = observer(({ model }: { model: LGV }) => {\n  const { tracks, error, hideHeader, initialized, hasDisplayedRegions } = model\n  const classes = useStyles()\n\n  if (!initialized) {\n    return null\n  }\n  if (!hasDisplayedRegions) {\n    return <ImportForm model={model} />\n  }\n  return (\n    <div style={{ position: 'relative' }}>\n      {model.isSeqDialogDisplayed ? (\n        <SequenceDialog\n          model={model}\n          handleClose={() => {\n            model.setOffsets(undefined, undefined)\n          }}\n        />\n      ) : null}\n      {!hideHeader ? (\n        <Header model={model} />\n      ) : (\n        <div\n          style={{\n            position: 'absolute',\n            right: 0,\n            zIndex: 1001,\n          }}\n        >\n          <MiniControls model={model} />\n        </div>\n      )}\n      {error ? (\n        <Paper variant=\"outlined\" className={classes.errorMessage}>\n          <Typography color=\"error\">{error.message}</Typography>\n        </Paper>\n      ) : (\n        <>\n          <TracksContainer model={model}>\n            {!tracks.length ? (\n              <Paper variant=\"outlined\" className={classes.errorMessage}>\n                <Typography>No tracks active.</Typography>\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={model.activateTrackSelector}\n                  style={{ zIndex: 1000 }}\n                >\n                  <TrackSelectorIcon className={classes.spacer} />\n                  Open track selector\n                </Button>\n              </Paper>\n            ) : (\n              tracks.map(track => (\n                <TrackContainer key={track.id} model={model} track={track} />\n              ))\n            )}\n          </TracksContainer>\n        </>\n      )}\n    </div>\n  )\n})\n\nexport default LinearGenomeView\n\nfunction ScaleBar({ model, fontSize }: { model: LGV; fontSize: number }) {\n  const {\n    offsetPx,\n    dynamicBlocks: { totalWidthPxWithoutBorders: totalWidthPx, totalBp },\n  } = model\n  let displayBp\n  if (Math.floor(totalBp / 1000000) > 0) {\n    displayBp = `${parseFloat((totalBp / 1000000).toPrecision(3))}Mbp`\n  } else if (Math.floor(totalBp / 1000) > 0) {\n    displayBp = `${parseFloat((totalBp / 1000).toPrecision(3))}Kbp`\n  } else {\n    displayBp = `${Math.floor(totalBp)}bp`\n  }\n  const x0 = Math.max(-offsetPx, 0)\n  const x1 = x0 + totalWidthPx\n  return (\n    <>\n      <line x1={x0} x2={x1} y1={10} y2={10} stroke=\"black\" />\n      <line x1={x0} x2={x0} y1={5} y2={15} stroke=\"black\" />\n      <line x1={x1} x2={x1} y1={5} y2={15} stroke=\"black\" />\n      <text\n        x={x0 + (x1 - x0) / 2}\n        y={fontSize * 2}\n        textAnchor=\"middle\"\n        fontSize={fontSize}\n      >\n        {displayBp}\n      </text>\n    </>\n  )\n}\n\nfunction SVGRuler({\n  model,\n  fontSize,\n  rulerHeight,\n  width,\n}: {\n  model: LGV\n  rulerHeight: number\n  fontSize: number\n  width: number\n}) {\n  const {\n    dynamicBlocks: { contentBlocks },\n    offsetPx: viewOffsetPx,\n    bpPerPx,\n  } = model\n  const renderRuler = contentBlocks.length < 5\n  return (\n    <>\n      <defs>\n        <clipPath id=\"clip-ruler\">\n          <rect x={0} y={0} width={width} height={20} />\n        </clipPath>\n      </defs>\n      {contentBlocks.map(block => {\n        const offsetLeft = block.offsetPx - viewOffsetPx\n        return (\n          <g key={`${block.key}`} transform={`translate(${offsetLeft} 0)`}>\n            <text x={offsetLeft / bpPerPx} y={fontSize} fontSize={fontSize}>\n              {block.refName}\n            </text>\n            {renderRuler ? (\n              <g transform=\"translate(0 20)\" clipPath=\"url(#clip-ruler)\">\n                <Ruler\n                  start={block.start}\n                  end={block.end}\n                  bpPerPx={bpPerPx}\n                  reversed={block.reversed}\n                />\n              </g>\n            ) : (\n              <line\n                strokeWidth={1}\n                stroke=\"black\"\n                x1={block.start / bpPerPx}\n                x2={block.end / bpPerPx}\n                y1={20}\n                y2={20}\n              />\n            )}\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\nconst fontSize = 15\nconst rulerHeight = 50\nconst textHeight = fontSize + 5\nconst paddingHeight = 20\nconst headerHeight = textHeight + 20\n\nconst totalHeight = (tracks: { displays: { height: number }[] }[]) => {\n  return tracks.reduce((accum, track) => {\n    const display = track.displays[0]\n    return accum + display.height + paddingHeight + textHeight\n  }, 0)\n}\n\n// SVG component, ruler and assembly name\nconst SVGHeader = ({ model }: { model: LGV }) => {\n  const { width, assemblyNames } = model\n  const assemblyName = assemblyNames.length > 1 ? '' : assemblyNames[0]\n  return (\n    <g id=\"header\">\n      <text x={0} y={fontSize} fontSize={fontSize}>\n        {assemblyName}\n      </text>\n      <g transform={`translate(0 ${fontSize})`}>\n        <ScaleBar model={model} fontSize={fontSize} />\n      </g>\n      <g transform={`translate(0 ${rulerHeight})`}>\n        <SVGRuler\n          model={model}\n          fontSize={fontSize}\n          rulerHeight={rulerHeight}\n          width={width}\n        />\n      </g>\n    </g>\n  )\n}\n\n// SVG component, region separator\nconst SVGRegionSeparators = ({ model }: { model: LGV }) => {\n  const { dynamicBlocks, tracks } = model\n  const initialOffset = headerHeight + rulerHeight + 20\n  const height = totalHeight(tracks)\n\n  return (\n    <>\n      {dynamicBlocks.contentBlocks.slice(1).map(block => (\n        <line\n          key={block.key}\n          x1={block.offsetPx - model.offsetPx}\n          x2={block.offsetPx - model.offsetPx}\n          y1={initialOffset}\n          y2={height}\n          stroke=\"black\"\n          strokeOpacity={0.3}\n        />\n      ))}\n    </>\n  )\n}\n\n// SVG component, tracks\nfunction SVGTracks({\n  displayResults,\n  model,\n  offset,\n}: {\n  displayResults: {\n    track: {\n      configuration: AnyConfigurationModel\n      displays: { height: number }[]\n    }\n    result: string\n  }[]\n  model: LGV\n  offset: number\n}) {\n  return (\n    <>\n      {displayResults.map(({ track, result }) => {\n        const current = offset\n        const trackName =\n          getConf(track, 'name') ||\n          `Reference sequence (${readConfObject(\n            getParent(track.configuration),\n            'name',\n          )})`\n        const display = track.displays[0]\n        offset += display.height + paddingHeight + textHeight\n        return (\n          <g\n            key={track.configuration.trackId}\n            transform={`translate(0 ${current})`}\n          >\n            <text fontSize={fontSize} x={Math.max(-model.offsetPx, 0)}>\n              {trackName}\n            </text>\n            <g transform={`translate(0 ${textHeight})`}>{result}</g>\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\n// render LGV to SVG\nexport async function renderToSvg(model: LGV, opts: ExportSvgOptions) {\n  await when(() => model.initialized)\n  const { width, tracks } = model\n  const shift = 50\n  const offset = headerHeight + rulerHeight + 20\n  const height = totalHeight(tracks) + offset\n  const displayResults = await Promise.all(\n    tracks.map(async track => {\n      const display = track.displays[0]\n      await when(() => (display.ready !== undefined ? display.ready : true))\n      const result = await display.renderSvg(opts)\n      return { track, result }\n    }),\n  )\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <svg\n      width={width}\n      height={height}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      viewBox={[0, 0, width + shift * 2, height].toString()}\n    >\n      {/* background white */}\n      <rect width={width + shift * 2} height={height} fill=\"white\" />\n\n      <g stroke=\"none\" transform={`translate(${shift} ${fontSize})`}>\n        <SVGHeader model={model} />\n        <SVGTracks\n          model={model}\n          displayResults={displayResults}\n          offset={offset}\n        />\n        <SVGRegionSeparators model={model} />\n      </g>\n    </svg>,\n  )\n}\n","import {\n  isStateTreeNode,\n  getSnapshot,\n  getType,\n  isMapType,\n  isType,\n  isUnionType,\n  isOptionalType,\n  isArrayType,\n  isModelType,\n  isLateType,\n} from 'mobx-state-tree'\n\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from './configurationSchema'\nimport {\n  getUnionSubTypes,\n  getDefaultValue,\n  getSubType,\n  resolveLateType,\n} from '../util/mst-reflection'\n\n/**\n * given a configuration model (an instance of a ConfigurationSchema),\n * read the configuration variable at the given path\n *\n * @param model - instance of ConfigurationSchema\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *  will be sent to each of the slotNames\n */\nexport function readConfObject(\n  confObject: AnyConfigurationModel,\n  slotPath: string[] | string | undefined = undefined,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  args: Record<string, any> = {},\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): any {\n  if (!confObject) {\n    throw new TypeError('must provide conf object to read')\n  }\n  if (!slotPath) {\n    return getSnapshot(confObject)\n  }\n  if (typeof slotPath === 'string') {\n    let slot = confObject[slotPath]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !slot &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      slot = confObject.get(slotPath)\n    }\n    if (!slot) {\n      return undefined\n      // if we want to be very strict about config slots, we could uncomment the below\n      // instead of returning undefine\n      //\n      // const modelType = getType(model)\n      // const schemaType = model.configuration && getType(model.configuration)\n      // throw new Error(\n      //   `no slot \"${slotName}\" found in ${modelType.name} configuration (${\n      //     schemaType.name\n      //   })`,\n      // )\n    }\n\n    if (slot.expr) {\n      const appliedFunc = slot.expr.evalSync(args)\n      if (isStateTreeNode(appliedFunc)) {\n        return getSnapshot(appliedFunc)\n      }\n      return appliedFunc\n    }\n    if (isStateTreeNode(slot)) {\n      return getSnapshot(slot)\n    }\n    return slot\n  }\n\n  const slotName = slotPath[0]\n  if (slotPath.length > 1) {\n    const newPath = slotPath.slice(1)\n    let subConf = confObject[slotName]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !subConf &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      subConf = confObject.get(slotName)\n    }\n    if (!subConf) {\n      return undefined\n    }\n    return readConfObject(subConf, newPath, args)\n  }\n  return readConfObject(confObject, slotName, args)\n}\n\n/**\n * helper method for readConfObject, reads the config from a mst model\n *\n * @param model - object containing a 'configuration' member\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *   will be sent to each of the slotNames\n */\nexport function getConf(\n  model: unknown,\n  slotPath: string[] | string | undefined = undefined,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  args: Record<string, any> = {},\n) {\n  if (!model) {\n    throw new TypeError('must provide a model object')\n  }\n  const { configuration } = model as { configuration: unknown }\n  if (isConfigurationModel(configuration)) {\n    return readConfObject(configuration, slotPath, args)\n  }\n  throw new TypeError('cannot getConf on this model, it has no configuration')\n}\n\n/**\n * given a union of explicitly typed configuration schema types,\n * extract an array of the type names contained in the union\n *\n * @param unionType -\n * @returns Array of type names contained in the union\n */\nexport function getTypeNamesFromExplicitlyTypedUnion(maybeUnionType: unknown) {\n  if (isType(maybeUnionType)) {\n    maybeUnionType = resolveLateType(maybeUnionType)\n    // @ts-ignore\n    if (isUnionType(maybeUnionType)) {\n      const typeNames: string[] = []\n      getUnionSubTypes(maybeUnionType).forEach(type => {\n        type = resolveLateType(type)\n        let typeName = getTypeNamesFromExplicitlyTypedUnion(type)\n        if (!typeName.length) {\n          const def = getDefaultValue(type)\n          typeName = [def.type]\n        }\n        if (!typeName[0]) {\n          // debugger\n          throw new Error(`invalid config schema type ${type}`)\n        }\n        typeNames.push(...typeName)\n      })\n      return typeNames\n    }\n  }\n  return []\n}\n\nexport function isBareConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (isType(thing)) {\n    if (\n      isModelType(thing) &&\n      ('isJBrowseConfigurationSchema' in thing ||\n        thing.name.includes('ConfigurationSchema'))\n    ) {\n      return true\n    }\n    // if it's a late type, assume its a config schema\n    if (isLateType(thing)) {\n      return true\n    }\n  }\n  return false\n}\n\nexport function isConfigurationSchemaType(thing: unknown): boolean {\n  if (!isType(thing)) {\n    return false\n  }\n\n  // written as a series of if-statements instead of a big logical OR\n  // because this construction gives much better debugging backtraces.\n\n  // also, note that the order of these statements matters, because\n  // for example some union types are also optional types\n\n  if (isBareConfigurationSchemaType(thing)) {\n    return true\n  }\n\n  if (isUnionType(thing)) {\n    return getUnionSubTypes(thing).every(\n      t => isConfigurationSchemaType(t) || t.name === 'undefined',\n    )\n  }\n\n  if (isOptionalType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isArrayType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isMapType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  return false\n}\n\nexport function isConfigurationModel(\n  thing: unknown,\n): thing is AnyConfigurationModel {\n  return isStateTreeNode(thing) && isConfigurationSchemaType(getType(thing))\n}\n\nexport function isConfigurationSlotType(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'isJBrowseConfigurationSlot' in thing\n  )\n}\n","import { intersection2 } from './range'\nimport { assembleLocString } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Base1DViewModel } from './calculateStaticBlocks'\n\n/**\n * returns a BlockSet of which the `blocks` attribute is an array of 'dynamic\n * blocks', which are blocks representing only the regions that are visible in\n * the view right now. these are mostly used by tracks for which static blocks\n * are not feasible.\n *\n * each block is a plain JS object like:\n *   `{ refName, start, end, offsetPx, reversed? }`\n *\n * start and end are in bp, and start is always less than end, but if reversed\n * is true, startBp will be on the right side of the visible region.\n *\n * offsetPx is the number of pixels from the left edge of the view to the left\n * edge of the region\n *\n * NOTE: start, end, and offsetPx may all be fractional!\n *\n * @returns BlockSet of `{ refName, startBp, end, offset, reversed? }`\n */\nexport default function calculateDynamicBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    width,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  if (!width) {\n    throw new Error('view has no width, cannot calculate displayed blocks')\n  }\n  const blocks = new BlockSet()\n  let displayedRegionLeftPx = 0\n  const windowLeftPx = offsetPx\n  const windowRightPx = windowLeftPx + width\n  displayedRegions.forEach((region, regionNumber) => {\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const displayedRegionRightPx =\n      displayedRegionLeftPx + (regionEnd - regionStart) / bpPerPx\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    if (\n      displayedRegionLeftPx < windowRightPx &&\n      displayedRegionRightPx > windowLeftPx\n    ) {\n      // this displayed region overlaps the view, so make a record for it\n      const [leftPx, rightPx] = intersection2(\n        windowLeftPx,\n        windowRightPx,\n        displayedRegionLeftPx,\n        displayedRegionRightPx,\n      )\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      let blockOffsetPx: number\n      if (reversed) {\n        start = Math.max(\n          regionStart,\n          regionEnd - (rightPx - displayedRegionLeftPx) * bpPerPx,\n        )\n        end = regionEnd - (leftPx - displayedRegionLeftPx) * bpPerPx\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n        blockOffsetPx = displayedRegionLeftPx + (regionEnd - end) / bpPerPx\n      } else {\n        start = (leftPx - displayedRegionLeftPx) * bpPerPx + regionStart\n        end = Math.min(\n          regionEnd,\n          (rightPx - displayedRegionLeftPx) * bpPerPx + regionStart,\n        )\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n        blockOffsetPx = displayedRegionLeftPx + (start - regionStart) / bpPerPx\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: blockOffsetPx,\n        parentRegion: region,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocString(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && blocks.length === 0 && isLeftEndOfDisplayedRegion) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: -offsetPx,\n            offsetPx: blockData.offsetPx + offsetPx,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n          displayedRegionLeftPx += interRegionPaddingWidth\n        }\n\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          blockOffsetPx = blockData.offsetPx + blockData.widthPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width - blockOffsetPx + offsetPx,\n              offsetPx: blockOffsetPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    displayedRegionLeftPx += (regionEnd - regionStart) / bpPerPx\n  })\n  return blocks\n}\n","import React, { useState } from 'react'\nimport {\n  Button,\n  Grid,\n  FormHelperText,\n  InputLabel,\n  TextField,\n  Typography,\n} from '@material-ui/core'\nimport { ToggleButtonGroup, ToggleButton } from '@material-ui/lab'\nimport { observer } from 'mobx-react'\nimport { isElectron } from '../util'\nimport {\n  PreLocalPathLocation,\n  PreUriLocation,\n  PreBlobLocation,\n  PreFileLocation,\n  LocalPathLocation,\n  UriLocation,\n  FileLocation,\n  BlobLocation,\n} from '../util/types'\nimport { getBlob, storeBlobLocation } from '../util/tracks'\n\nfunction isUriLocation(location: FileLocation): location is UriLocation {\n  return 'uri' in location\n}\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\nconst FileLocationEditor = observer(\n  (props: {\n    location?: FileLocation\n    setLocation: (param: FileLocation) => void\n    name?: string\n    description?: string\n  }) => {\n    const { location, name, description } = props\n    const fileOrUrl = !location || isUriLocation(location) ? 'url' : 'file'\n    const [fileOrUrlState, setFileOrUrlState] = useState(fileOrUrl)\n\n    return (\n      <>\n        <InputLabel shrink htmlFor=\"callback-editor\">\n          {name}\n        </InputLabel>\n        <Grid container spacing={1} direction=\"row\" alignItems=\"center\">\n          <Grid item>\n            <ToggleButtonGroup\n              value={fileOrUrlState}\n              exclusive\n              onChange={(_, newValue) => {\n                if (newValue === 'url') {\n                  setFileOrUrlState('url')\n                } else {\n                  setFileOrUrlState('file')\n                }\n              }}\n              aria-label=\"file or url picker\"\n            >\n              <ToggleButton value=\"file\" aria-label=\"local file\">\n                File\n              </ToggleButton>\n              <ToggleButton value=\"url\" aria-label=\"url\">\n                URL\n              </ToggleButton>\n            </ToggleButtonGroup>\n          </Grid>\n          <Grid item>\n            {fileOrUrlState === 'url' ? (\n              <UrlChooser {...props} />\n            ) : (\n              <LocalFileChooser {...props} />\n            )}\n          </Grid>\n        </Grid>\n        <FormHelperText>{description}</FormHelperText>\n      </>\n    )\n  },\n)\n\nconst UrlChooser = (props: {\n  location?: FileLocation\n  setLocation: Function\n}) => {\n  const { location, setLocation } = props\n\n  return (\n    <TextField\n      fullWidth\n      inputProps={{ 'data-testid': 'urlInput' }}\n      defaultValue={location && isUriLocation(location) ? location.uri : ''}\n      onChange={event => setLocation({ uri: event.target.value })}\n    />\n  )\n}\n\nconst LocalFileChooser = observer(\n  (props: { location?: FileLocation; setLocation: Function }) => {\n    const { location, setLocation } = props\n\n    const filename =\n      location &&\n      ((isBlobLocation(location) && location.name) ||\n        (isLocalPathLocation(location) && location.localPath))\n\n    const needToReload =\n      location && isBlobLocation(location) && !getBlob(location.blobId)\n\n    return (\n      <div style={{ position: 'relative' }}>\n        <Button variant=\"outlined\" component=\"label\">\n          Choose File\n          <input\n            type=\"file\"\n            style={{\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              width: '100%',\n              opacity: 0,\n            }}\n            onChange={({ target }) => {\n              const file = target && target.files && target.files[0]\n              if (file) {\n                if (isElectron) {\n                  setLocation({ localPath: file.path })\n                } else {\n                  setLocation(storeBlobLocation({ blob: file }))\n                }\n              }\n            }}\n          />\n        </Button>\n        {filename ? (\n          <>\n            <Typography\n              style={{ marginLeft: '0.4rem' }}\n              variant=\"body1\"\n              component=\"span\"\n            >\n              {filename}\n            </Typography>\n            {needToReload ? (\n              <Typography color=\"error\">(need to reload)</Typography>\n            ) : null}\n          </>\n        ) : null}\n      </div>\n    )\n  },\n)\n\nexport default FileLocationEditor\n","/* eslint-disable no-restricted-globals */\nimport React from 'react'\nimport Path from 'svg-path-generator'\nimport Color from 'color'\n\n// This is a ponyfill for the HTML5 OffscreenCanvas API.\nexport let createCanvas\nexport let createImageBitmap\nexport let ImageBitmapType\n\n// sniff environments\nconst isElectron = typeof window !== 'undefined' && Boolean(window.electron)\n\nconst weHave = {\n  realOffscreenCanvas:\n    typeof __webpack_require__ === 'function' &&\n    typeof OffscreenCanvas === 'function',\n  node:\n    typeof __webpack_require__ === 'undefined' && typeof process === 'object',\n}\n\nexport class PonyfillOffscreenContext {\n  constructor(width, height) {\n    this.width = width\n    this.height = height\n    this.commands = []\n    this.currentFont = '12px Courier New, monospace'\n  }\n\n  // setters (no getters working)\n  set strokeStyle(style) {\n    if (style !== this.currentStrokeStyle) {\n      this.commands.push({ type: 'strokeStyle', style })\n      this.currentStrokeStyle = style\n    }\n  }\n\n  set fillStyle(style) {\n    if (style !== this.currentFillStyle) {\n      this.commands.push({ type: 'fillStyle', style })\n      this.currentFillStyle = style\n    }\n  }\n\n  set font(style) {\n    this.currentFont = style\n    this.commands.push({ type: 'font', style })\n  }\n\n  // methods\n  arc(...args) {\n    this.commands.push({ type: 'arc', args })\n  }\n\n  arcTo(...args) {\n    this.commands.push({ type: 'arcTo', args })\n  }\n\n  beginPath(...args) {\n    this.commands.push({ type: 'beginPath', args })\n  }\n\n  clearRect(...args) {\n    this.commands.push({ type: 'clearRect', args })\n  }\n\n  clip(...args) {\n    this.commands.push({ type: 'clip', args })\n  }\n\n  closePath(...args) {\n    this.commands.push({ type: 'closePath', args })\n  }\n\n  createLinearGradient(...args) {\n    this.commands.push({ type: 'createLinearGradient', args })\n  }\n\n  createPattern(...args) {\n    this.commands.push({ type: 'createPattern', args })\n  }\n\n  createRadialGradient(...args) {\n    this.commands.push({ type: 'createRadialGradient', args })\n  }\n\n  drawFocusIfNeeded(...args) {\n    this.commands.push({ type: 'drawFocusIfNeeded', args })\n  }\n\n  drawImage(...args) {\n    this.commands.push({ type: 'drawImage', args })\n  }\n\n  ellipse(...args) {\n    this.commands.push({ type: 'ellipse', args })\n  }\n\n  fill(...args) {\n    this.commands.push({ type: 'fill', args })\n  }\n\n  fillRect(...args) {\n    const [x, y, w, h] = args\n    if (x > this.width || x + w < 0) {\n      return\n    }\n    const nx = Math.max(x, 0)\n    const nw = nx + w > this.width ? this.width - nx : w\n    this.commands.push({ type: 'fillRect', args: [nx, y, nw, h] })\n  }\n\n  fillText(...args) {\n    // if (x > this.width || x + 1000 < 0) {\n    //   return\n    // }\n    this.commands.push({ type: 'fillText', args })\n  }\n\n  lineTo(...args) {\n    this.commands.push({ type: 'lineTo', args })\n  }\n\n  measureText(text) {\n    const height = +this.currentFont.match(/\\d+/)[0]\n    return {\n      width: (height / 2) * text.length,\n      height,\n    }\n  }\n\n  moveTo(...args) {\n    this.commands.push({ type: 'moveTo', args })\n  }\n\n  quadraticCurveTo(...args) {\n    this.commands.push({ type: 'quadraticCurveTo', args })\n  }\n\n  rect(...args) {\n    this.commands.push({ type: 'rect', args })\n  }\n\n  restore(...args) {\n    this.commands.push({ type: 'restore', args })\n  }\n\n  rotate(...args) {\n    this.commands.push({ type: 'rotate', args })\n  }\n\n  save(...args) {\n    this.commands.push({ type: 'save', args })\n  }\n\n  setLineDash(...args) {\n    this.commands.push({ type: 'setLineDash', args })\n  }\n\n  setTransform(...args) {\n    this.commands.push({ type: 'setTransform', args })\n  }\n\n  scale(...args) {\n    this.commands.push({ type: 'scale', args })\n  }\n\n  stroke(...args) {\n    this.commands.push({ type: 'stroke', args })\n  }\n\n  strokeRect(...args) {\n    this.commands.push({ type: 'strokeRect', args })\n  }\n\n  strokeText(...args) {\n    this.commands.push({ type: 'strokeText', args })\n  }\n\n  transform(...args) {\n    this.commands.push({ type: 'transform', args })\n  }\n\n  translate(...args) {\n    this.commands.push({ type: 'translate', args })\n  }\n\n  // unsupported\n  //   putImageData(...args)\n  //   createImageData(...args)\n  //   getImageData(...args)\n  //   getLineDash(...args)\n  //   getTransform(...args)\n}\n\nfunction splitColor(color) {\n  const fill = Color(color)\n  return { hex: fill.hex(), opacity: fill.alpha() }\n}\n\n// https://stackoverflow.com/a/5620441/2129219\nfunction parseFont(font) {\n  let fontFamily = null\n  let fontSize = null\n  let fontStyle = 'normal'\n  let fontWeight = 'normal'\n  let fontVariant = 'normal'\n  let lineHeight = 'normal'\n\n  const elements = font.split(/\\s+/)\n  let element\n  outer: while ((element = elements.shift())) {\n    switch (element) {\n      case 'normal':\n        break\n\n      case 'italic':\n      case 'oblique':\n        fontStyle = element\n        break\n\n      case 'small-caps':\n        fontVariant = element\n        break\n\n      case 'bold':\n      case 'bolder':\n      case 'lighter':\n      case '100':\n      case '200':\n      case '300':\n      case '400':\n      case '500':\n      case '600':\n      case '700':\n      case '800':\n      case '900':\n        fontWeight = element\n        break\n\n      default:\n        if (!fontSize) {\n          const parts = element.split('/')\n          fontSize = parts[0]\n          if (parts.length > 1) {\n            lineHeight = parts[1]\n          }\n          break\n        }\n\n        fontFamily = element\n        if (elements.length) {\n          fontFamily += ` ${elements.join(' ')}`\n        }\n        break outer\n    }\n  }\n\n  return {\n    fontStyle,\n    fontVariant,\n    fontWeight,\n    fontSize,\n    lineHeight,\n    fontFamily,\n  }\n}\nexport class PonyfillOffscreenCanvas {\n  constructor(width, height) {\n    this.width = width\n    this.height = height\n  }\n\n  getContext(type) {\n    if (type !== '2d') {\n      throw new Error(`unknown type ${type}`)\n    }\n    this.context = new PonyfillOffscreenContext(this.width, this.height)\n    return this.context\n  }\n\n  getSerializedSvg() {\n    let currentFill\n    let currentStroke\n    let currentPath = []\n    let rotation\n    let font\n\n    const nodes = []\n    this.context.commands.forEach((command, index) => {\n      if (command.type === 'font') {\n        if (command.style) {\n          // stackoverflow.com/questions/5618676\n          // skip lineHeight in the final usage\n          const { fontStyle, fontFamily, fontSize } = parseFont(command.style)\n          font = { fontStyle, fontFamily, fontSize }\n        }\n      }\n      if (command.type === 'fillStyle') {\n        if (command.style) {\n          currentFill = command.style\n        }\n      }\n      if (command.type === 'strokeStyle') {\n        if (command.style) {\n          currentStroke = command.style\n        }\n      }\n      if (command.type === 'fillRect') {\n        const [x, y, w, h] = command.args\n        const { hex, opacity } = splitColor(currentFill)\n        const ny = Math.min(y, y + h)\n        const nh = Math.abs(h)\n        nodes.push(\n          <rect\n            key={index}\n            fill={hex}\n            fillOpacity={opacity !== 1 ? opacity : undefined}\n            x={x.toFixed(3)}\n            y={ny.toFixed(3)}\n            width={w.toFixed(3)}\n            height={nh.toFixed(3)}\n          />,\n        )\n      }\n      if (command.type === 'fillText') {\n        const [text, x, y] = command.args\n        const { hex, opacity } = splitColor(currentFill)\n        nodes.push(\n          <text\n            key={index}\n            fill={hex}\n            fillOpacity={opacity !== 1 ? opacity : undefined}\n            x={x.toFixed(3)}\n            y={y.toFixed(3)}\n            {...font}\n          >\n            {text}\n          </text>,\n        )\n      }\n      if (command.type === 'beginPath') {\n        currentPath = []\n      }\n      if (command.type === 'moveTo') {\n        currentPath.push(command.args)\n      }\n      if (command.type === 'lineTo') {\n        currentPath.push(command.args)\n      }\n      if (command.type === 'closePath') {\n        /* do nothing */\n      }\n      if (command.type === 'fill') {\n        let path = Path().moveTo(...currentPath[0])\n        for (let i = 1; i < currentPath.length; i++) {\n          path = path.lineTo(...currentPath[i])\n        }\n        path.end()\n        const { hex, opacity } = splitColor(currentFill)\n        nodes.push(\n          <path\n            key={index}\n            fill={hex}\n            d={path}\n            fillOpacity={opacity !== 1 ? opacity : undefined}\n          />,\n        )\n      }\n      if (command.type === 'stroke') {\n        let path = Path().moveTo(...currentPath[0])\n        for (let i = 1; i < currentPath.length; i++) {\n          path = path.lineTo(...currentPath[i])\n        }\n        path.end()\n        const { hex, opacity } = splitColor(currentStroke)\n        nodes.push(\n          <path\n            key={index}\n            fill=\"none\"\n            stroke={hex}\n            fillOpacity={opacity !== 1 ? opacity : undefined}\n            d={path}\n          />,\n        )\n      }\n      if (command.type === 'rotate') {\n        rotation = (command.args[0] * 180) / Math.PI\n      }\n    })\n    return rotation ? (\n      <g transform={`rotate(${rotation})`}>{[...nodes]}</g>\n    ) : (\n      <>{[...nodes]}</>\n    )\n  }\n}\n// Electron serializes everything to JSON through the IPC boundary, so we just\n// send the dataURL\nif (isElectron) {\n  createCanvas = (width, height) => {\n    const canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    return canvas\n  }\n  createImageBitmap = async (canvas, ...otherargs) => {\n    if (otherargs.length) {\n      throw new Error(\n        'only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill',\n      )\n    }\n    return { dataURL: canvas.toDataURL() }\n  }\n  ImageBitmapType = Image\n} else if (weHave.realOffscreenCanvas) {\n  createCanvas = (width, height) => new OffscreenCanvas(width, height)\n  createImageBitmap = window.createImageBitmap || self.createImageBitmap\n  ImageBitmapType = window.ImageBitmap || self.ImageBitmap\n} else if (weHave.node) {\n  // use node-canvas if we are running in node (i.e. automated tests)\n  const { createCanvas: nodeCreateCanvas, Image } = require('canvas')\n  createCanvas = nodeCreateCanvas\n  createImageBitmap = async (canvas, ...otherargs) => {\n    if (otherargs.length) {\n      throw new Error(\n        'only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill',\n      )\n    }\n    const dataUri = canvas.toDataURL()\n    const img = new Image()\n    return new Promise((resolve, reject) => {\n      img.onload = () => resolve(img)\n      img.onerror = reject\n      img.src = dataUri\n    })\n  }\n  ImageBitmapType = Image\n} else {\n  createCanvas = (width, height) => {\n    return new PonyfillOffscreenCanvas(width, height)\n  }\n  createImageBitmap = canvas => {\n    return canvas.context\n  }\n  ImageBitmapType = typeof 'StringArray'\n}\n","import { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport React from 'react'\n\nconst useStyles = makeStyles(theme => ({\n  contentBlock: {\n    position: 'relative',\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n  },\n  elidedBlock: {\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    backgroundColor: '#999',\n    backgroundImage:\n      'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n  },\n  interRegionPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.text.primary,\n  },\n  boundaryPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.action.disabledBackground,\n  },\n}))\n\ninterface ContentBlockProps {\n  block: BaseBlock\n  children: React.ReactNode\n}\n\ninterface ElidedBlockProps {\n  width: number\n}\n\ninterface InterRegionPaddingBlockProps {\n  boundary: boolean\n  width: number\n  style?: React.CSSProperties\n}\n\nconst ContentBlock = observer(({ block, children }: ContentBlockProps) => {\n  const classes = useStyles()\n  return (\n    <div\n      style={{\n        width: `${block.widthPx}px`,\n      }}\n      className={classes.contentBlock}\n    >\n      {children}\n    </div>\n  )\n})\n\nfunction ElidedBlock({ width }: ElidedBlockProps) {\n  const classes = useStyles()\n  return <div className={classes.elidedBlock} style={{ width: `${width}px` }} />\n}\n\nfunction InterRegionPaddingBlock({\n  boundary,\n  width,\n  style = {},\n}: InterRegionPaddingBlockProps) {\n  const classes = useStyles()\n  return (\n    <div\n      style={{\n        ...style,\n        width: `${width}px`,\n      }}\n      className={\n        boundary\n          ? classes.boundaryPaddingBlock\n          : classes.interRegionPaddingBlock\n      }\n    />\n  )\n}\n\nexport { ContentBlock, ElidedBlock, InterRegionPaddingBlock }\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\n// get tag from BAM or CRAM feature, where CRAM uses feature.get('tags') and\n// BAM does not\nexport function getTag(feature: Feature, tag: string) {\n  const tags = feature.get('tags')\n  return tags ? tags[tag] : feature.get(tag)\n}\n\n// use fallback alt tag, used in situations where upper case/lower case tags\n// exist e.g. Mm/MM for base modifications\nexport function getTagAlt(feature: Feature, tag: string, alt: string) {\n  return getTag(feature, tag) || getTag(feature, alt)\n}\n\n// orientation definitions from igv.js, see also\n// https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\nexport const orientationTypes = {\n  fr: {\n    F1R2: 'LR',\n    F2R1: 'LR',\n\n    F1F2: 'LL',\n    F2F1: 'LL',\n\n    R1R2: 'RR',\n    R2R1: 'RR',\n\n    R1F2: 'RL',\n    R2F1: 'RL',\n  } as { [key: string]: string },\n\n  rf: {\n    R1F2: 'LR',\n    R2F1: 'LR',\n\n    R1R2: 'LL',\n    R2R1: 'LL',\n\n    F1F2: 'RR',\n    F2F1: 'RR',\n\n    F1R2: 'RL',\n    F2R1: 'RL',\n  } as { [key: string]: string },\n\n  ff: {\n    F2F1: 'LR',\n    R1R2: 'LR',\n\n    F2R1: 'LL',\n    R1F2: 'LL',\n\n    R2F1: 'RR',\n    F1R2: 'RR',\n\n    R2R1: 'RL',\n    F1F2: 'RL',\n  } as { [key: string]: string },\n}\n\nexport function getColorWGBS(strand: number, base: string) {\n  if (strand === 1) {\n    if (base === 'C') {\n      return '#f00'\n    }\n    if (base === 'T') {\n      return '#00f'\n    }\n  } else if (strand === -1) {\n    if (base === 'G') {\n      return '#f00'\n    }\n    if (base === 'A') {\n      return '#00f'\n    }\n  }\n  return '#888'\n}\n","import { useDebounce } from '@jbrowse/core/util'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormHelperText from '@material-ui/core/FormHelperText'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { observer, PropTypes } from 'mobx-react'\nimport React, { useEffect, useState } from 'react'\nimport Editor from 'react-simple-code-editor'\nimport { Light as SyntaxHighlighter } from 'react-syntax-highlighter'\nimport json from 'react-syntax-highlighter/dist/cjs/languages/hljs/json'\nimport a11yDark from 'react-syntax-highlighter/dist/cjs/styles/hljs/a11y-dark'\nimport a11yLight from 'react-syntax-highlighter/dist/cjs/styles/hljs/a11y-light'\n\nSyntaxHighlighter.registerLanguage('json', json)\n\n// fontSize and fontFamily have to match between Editor and SyntaxHighlighter\nconst fontSize = '12px'\n// Optimize by using system default fonts: https://css-tricks.com/snippets/css/font-stacks/\nconst fontFamily =\n  'Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", Monaco, \"Courier New\", Courier, monospace'\n\nconst useStyles = makeStyles({\n  callbackEditor: {\n    fontFamily,\n    fontSize,\n    overflowX: 'auto',\n    marginTop: '16px',\n    borderBottom: '1px solid rgba(0,0,0,0.42)',\n  },\n  syntaxHighlighter: {\n    margin: 0,\n    fontFamily,\n    fontSize,\n  },\n  error: {\n    color: 'red',\n    fontSize: '0.8em',\n  },\n})\n\nfunction JsonEditor({ slot }) {\n  const classes = useStyles()\n  const theme = useTheme()\n  const [contents, setContents] = useState(\n    JSON.stringify(slot.value, null, '  '),\n  )\n  const [error, setError] = useState()\n  const debouncedJson = useDebounce(contents, 400)\n\n  useEffect(() => {\n    try {\n      slot.set(JSON.parse(debouncedJson))\n      setError(undefined)\n    } catch (e) {\n      setError(e.message)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [debouncedJson])\n\n  return (\n    <>\n      {error ? <p className={classes.error}>{error}</p> : null}\n      <FormControl error={error}>\n        <InputLabel shrink htmlFor=\"callback-editor\">\n          {slot.name}\n        </InputLabel>\n        <Editor\n          className={classes.callbackEditor}\n          value={contents}\n          onValueChange={setContents}\n          highlight={newCode => (\n            <SyntaxHighlighter\n              language=\"json\"\n              style={theme.palette.type === 'dark' ? a11yDark : a11yLight}\n              className={classes.syntaxHighlighter}\n              // override some inline style stuff that's higher specificity\n              // than className\n              customStyle={{ background: 'none', padding: 0 }}\n            >\n              {newCode}\n            </SyntaxHighlighter>\n          )}\n          padding={10}\n          style={{}}\n        />\n        <FormHelperText>{slot.description}</FormHelperText>\n      </FormControl>\n    </>\n  )\n}\n\nJsonEditor.propTypes = {\n  slot: PropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(JsonEditor)\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\n\n/* eslint-disable no-underscore-dangle */\n\n/**\n * VCF Feature creation with lazy genotype evaluation.\n */\ninterface Samples {\n  [key: string]: {\n    [key: string]: { values: string[] | number[] | null }\n  }\n}\nexport interface Breakend {\n  MateDirection: string\n  Replacement: string\n  MatePosition: string\n  Join: string\n}\ninterface FeatureData {\n  [key: string]: unknown\n  refName: string\n  start: number\n  end: number\n  description?: string\n  type?: string\n  name?: string\n  aliases?: string[]\n  samples?: Samples\n}\n\nexport default class VCFFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private variant: any\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private parser: any\n\n  private data: FeatureData\n\n  private _id: string\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(args: { variant: any; parser: any; id: string }) {\n    this.variant = args.variant\n    this.parser = args.parser\n    this.data = this.dataFromVariant(this.variant)\n    this._id = args.id\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    if (field === 'samples') {\n      return this.variant.SAMPLES\n    }\n    return this.data[field] || this.variant[field]\n  }\n\n  set(): void {}\n\n  parent(): undefined {\n    return undefined\n  }\n\n  children(): undefined {\n    return undefined\n  }\n\n  tags(): string[] {\n    const t = [\n      ...Object.keys(this.data),\n      ...Object.keys(this.variant),\n      'samples',\n    ]\n    return t\n  }\n\n  id(): string {\n    return this._id\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  dataFromVariant(variant: any): FeatureData {\n    const { REF, ALT, POS, CHROM, INFO, ID } = variant\n    const start = POS - 1\n    const [SO_term, description] = this._getSOTermAndDescription(REF, ALT)\n    const isTRA = ALT && ALT.some((f: string | Breakend) => f === '<TRA>')\n    const isSymbolic =\n      ALT &&\n      ALT.some(\n        (f: string | Breakend) =>\n          typeof f === 'string' && f.indexOf('<') !== -1,\n      )\n    const featureData: FeatureData = {\n      refName: CHROM,\n      start,\n      end: isSymbolic && INFO.END && !isTRA ? +INFO.END[0] : start + REF.length,\n      description,\n      type: SO_term,\n      name: ID ? ID[0] : undefined,\n      aliases: ID && ID.length > 1 ? variant.ID.slice(1) : undefined,\n    }\n\n    return featureData\n  }\n\n  /**\n   * Get a sequence ontology (SO) term that describes the variant type\n   */\n  _getSOTermAndDescription(\n    ref: string,\n    alt: string[],\n  ): [string, string] | [undefined, undefined] {\n    // it's just a remark if there are no alternate alleles\n    if (!alt || alt === []) {\n      return ['remark', 'no alternative alleles']\n    }\n\n    const soTerms: Set<string> = new Set()\n    let descriptions: Set<string> = new Set()\n    alt.forEach(a => {\n      let [soTerm, description] = this._getSOAndDescFromAltDefs(ref, a)\n      if (!soTerm) {\n        ;[soTerm, description] = this._getSOAndDescByExamination(ref, a)\n      }\n      if (soTerm && description) {\n        soTerms.add(soTerm)\n        descriptions.add(description)\n      }\n    })\n    // Combine descriptions like [\"SNV G -> A\", \"SNV G -> T\"] to [\"SNV G -> A,T\"]\n    if (descriptions.size > 1) {\n      const prefixes: Set<string> = new Set()\n      descriptions.forEach(desc => {\n        const prefix = /(\\w+? \\w+? -> )(?:<)\\w+(?:>)/.exec(desc)\n        if (prefix && prefix[1]) {\n          prefixes.add(prefix[1])\n        } else {\n          prefixes.add(desc)\n        }\n      })\n      const new_descs: string[] = []\n      ;[...prefixes].forEach((prefix: string) => {\n        const suffixes: string[] = []\n        ;[...descriptions].forEach((desc: string) => {\n          if (desc.startsWith(prefix)) {\n            suffixes.push(desc.slice(prefix.length))\n          }\n        })\n        new_descs.push(prefix + suffixes.join(','))\n      })\n      descriptions = new Set(new_descs)\n    }\n    if (soTerms.size) {\n      return [[...soTerms].join(','), [...descriptions].join(',')]\n    }\n    return [undefined, undefined]\n  }\n\n  static _altTypeToSO: { [key: string]: string | undefined } = {\n    DEL: 'deletion',\n    INS: 'insertion',\n    DUP: 'duplication',\n    INV: 'inversion',\n    INVDUP: 'inverted duplication',\n    CNV: 'copy_number_variation',\n    TRA: 'translocation',\n    'DUP:TANDEM': 'tandem_duplication',\n    NON_REF: 'sequence_variant',\n    '*': 'sequence_variant',\n  }\n\n  _getSOAndDescFromAltDefs(\n    ref: string,\n    alt: string | Breakend,\n  ): [string, string] | [undefined, undefined] {\n    // not a symbolic ALT if doesn't begin with '<', so we'll have no definition\n    if (typeof alt === 'object') {\n      return [\n        'breakend',\n        'A VCF breakend defines one end of a point of structural variation',\n      ]\n    }\n\n    if (typeof alt === 'string' && !alt.startsWith('<')) {\n      return [undefined, undefined]\n    }\n\n    alt = alt.replace(/^<|>$/g, '') // trim off < and >\n\n    // look for a definition with an SO type for this\n    let soTerm = VCFFeature._altTypeToSO[alt]\n    // if no SO term but ALT is in metadata, assume sequence_variant\n    if (!soTerm && this.parser.getMetadata('ALT', alt)) {\n      soTerm = 'sequence_variant'\n    }\n    if (soTerm) {\n      const metaDescription = this.parser.getMetadata('ALT', alt, 'Description')\n      const description = metaDescription\n        ? `${alt} - ${metaDescription}`\n        : this._makeDescriptionString(soTerm, ref, alt)\n      return [soTerm, description]\n    }\n\n    // try to look for a definition for a parent term if we can\n    const modAlt = alt.split(':')\n    if (modAlt.length > 1) {\n      return this._getSOAndDescFromAltDefs(\n        ref,\n        `<${modAlt.slice(0, modAlt.length - 1).join(':')}>`,\n      )\n    }\n    // no parent\n    return [undefined, undefined]\n  }\n\n  _getSOAndDescByExamination(\n    ref: string,\n    alt: string | Breakend,\n  ): [string, string] {\n    if (typeof alt === 'object') {\n      return ['breakend', this._makeDescriptionString('breakend', ref, alt)]\n    }\n    if (ref.length === 1 && alt.length === 1) {\n      // use SNV because SO definition of SNP says abundance must be at\n      // least 1% in population, and can't be sure we meet that\n      return ['SNV', this._makeDescriptionString('SNV', ref, alt)]\n    }\n    if (ref.length === alt.length) {\n      if (ref.split('').reverse().join('') === alt) {\n        return ['inversion', this._makeDescriptionString('inversion', ref, alt)]\n      }\n      return [\n        'substitution',\n        this._makeDescriptionString('substitution', ref, alt),\n      ]\n    }\n\n    if (ref.length <= alt.length) {\n      return ['insertion', this._makeDescriptionString('insertion', ref, alt)]\n    }\n\n    if (ref.length > alt.length) {\n      return ['deletion', this._makeDescriptionString('deletion', ref, alt)]\n    }\n\n    return ['indel', this._makeDescriptionString('indel', ref, alt)]\n  }\n\n  _makeDescriptionString(\n    soTerm: string,\n    ref: string,\n    alt: string | Breakend,\n  ): string {\n    return `${soTerm} ${ref} -> ${alt}`\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  toJSON(): any {\n    return {\n      uniqueId: this._id,\n      ...this.variant,\n      ...this.data,\n      samples: this.variant.SAMPLES,\n    }\n  }\n}\n","export {\n  ConfigurationSchema,\n  ConfigurationReference,\n} from './configurationSchema'\n\nexport * from './util'\n","import { toByteArray, fromByteArray } from 'base64-js'\nimport {\n  getParent,\n  isAlive,\n  IAnyStateTreeNode,\n  getSnapshot,\n  hasParent,\n  addDisposer,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport { reaction, IReactionPublic, IReactionOptions } from 'mobx'\nimport { inflate, deflate } from 'pako'\nimport fromEntries from 'object.fromentries'\nimport { useEffect, useRef, useState } from 'react'\nimport merge from 'deepmerge'\nimport { Feature } from './simpleFeature'\nimport {\n  TypeTestedByPredicate,\n  isSessionModel,\n  isDisplayModel,\n  isViewModel,\n  isTrackModel,\n  Region,\n  AssemblyManager,\n} from './types'\nimport { isAbortException, checkAbortSignal } from './aborting'\n\nexport * from './types'\nexport * from './aborting'\nexport * from './when'\n\nif (!Object.fromEntries) {\n  // @ts-ignore\n  fromEntries.shim()\n}\n\nexport const inDevelopment =\n  typeof process === 'object' &&\n  process.env &&\n  process.env.NODE_ENV === 'development'\nexport const inProduction = !inDevelopment\n\n/**\n * Compress and encode a string as url-safe base64\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param str-  a string to compress and encode\n */\nexport function toUrlSafeB64(str: string): string {\n  const bytes = new TextEncoder().encode(str)\n  const deflated = deflate(bytes)\n  const encoded = fromByteArray(deflated)\n  const pos = encoded.indexOf('=')\n  return pos > 0\n    ? encoded.slice(0, pos).replace(/\\+/g, '-').replace(/\\//g, '_')\n    : encoded.replace(/\\+/g, '-').replace(/\\//g, '_')\n}\n\n/**\n * Decode and inflate a url-safe base64 to a string\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param b64 - a base64 string to decode and inflate\n */\nexport function fromUrlSafeB64(b64: string): string {\n  const originalB64 = b64PadSuffix(b64.replace(/-/g, '+').replace(/_/g, '/'))\n  const bytes = toByteArray(originalB64)\n  const inflated = inflate(bytes)\n  return new TextDecoder().decode(inflated)\n}\n\n/**\n * Pad the end of a base64 string with \"=\" to make it valid\n * @param b64 - unpadded b64 string\n */\nfunction b64PadSuffix(b64: string): string {\n  let num = 0\n  const mo = b64.length % 4\n  switch (mo) {\n    case 3:\n      num = 1\n      break\n    case 2:\n      num = 2\n      break\n    case 0:\n      num = 0\n      break\n    default:\n      throw new Error('base64 not a valid length')\n  }\n  return b64 + '='.repeat(num)\n}\n\nexport function useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n    return () => {\n      clearTimeout(handler)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n\n// https://stackoverflow.com/questions/56283920/how-to-debounce-a-callback-in-functional-component-using-hooks\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function useDebouncedCallback<A extends any[]>(\n  callback: (...args: A) => void,\n  wait = 400,\n) {\n  // track args & timeout handle between calls\n  const argsRef = useRef<A>()\n  const timeout = useRef<ReturnType<typeof setTimeout>>()\n\n  function cleanup() {\n    if (timeout.current) {\n      clearTimeout(timeout.current)\n    }\n  }\n\n  // make sure our timeout gets cleared if our consuming component gets unmounted\n  useEffect(() => cleanup, [])\n\n  return function debouncedCallback(...args: A) {\n    // capture latest args\n    argsRef.current = args\n\n    // clear debounce timer\n    cleanup()\n\n    // start waiting again\n    timeout.current = setTimeout(() => {\n      if (argsRef.current) {\n        callback(...argsRef.current)\n      }\n    }, wait)\n  }\n}\n\n/** find the first node in the hierarchy that matches the given predicate */\nexport function findParentThat(\n  node: IAnyStateTreeNode,\n  predicate: (thing: IAnyStateTreeNode) => boolean,\n) {\n  let currentNode: IAnyStateTreeNode | undefined = node\n  while (currentNode && isAlive(currentNode)) {\n    if (predicate(currentNode)) {\n      return currentNode\n    }\n    if (hasParent(currentNode)) {\n      currentNode = getParent(currentNode)\n    } else {\n      break\n    }\n  }\n  throw new Error('no matching node found')\n}\n\ninterface Animation {\n  lastPosition: number\n  lastTime?: number\n  lastVelocity?: number\n}\n\n// based on https://github.com/react-spring/react-spring/blob/cd5548a987383b8023efd620f3726a981f9e18ea/src/animated/FrameLoop.ts\nexport function springAnimate(\n  fromValue: number,\n  toValue: number,\n  setValue: (value: number) => void,\n  onFinish = () => {},\n  precision = 0,\n  tension = 170,\n  friction = 26,\n) {\n  const mass = 1\n  if (!precision) {\n    precision = Math.abs(toValue - fromValue) / 1000\n  }\n\n  let animationFrameId: number\n\n  function update(animation: Animation) {\n    const time = Date.now()\n    let position = animation.lastPosition\n    let lastTime = animation.lastTime || time\n    let velocity = animation.lastVelocity || 0\n    // If we lost a lot of frames just jump to the end.\n    if (time > lastTime + 64) {\n      lastTime = time\n    }\n    // http://gafferongames.com/game-physics/fix-your-timestep/\n    const numSteps = Math.floor(time - lastTime)\n    for (let i = 0; i < numSteps; ++i) {\n      const force = -tension * (position - toValue)\n      const damping = -friction * velocity\n      const acceleration = (force + damping) / mass\n      velocity += (acceleration * 1) / 1000\n      position += (velocity * 1) / 1000\n    }\n    const isVelocity = Math.abs(velocity) <= precision\n    const isDisplacement =\n      tension !== 0 ? Math.abs(toValue - position) <= precision : true\n    const endOfAnimation = isVelocity && isDisplacement\n    if (endOfAnimation) {\n      setValue(toValue)\n      onFinish()\n    } else {\n      setValue(position)\n      animationFrameId = requestAnimationFrame(() =>\n        update({\n          lastPosition: position,\n          lastTime: time,\n          lastVelocity: velocity,\n        }),\n      )\n    }\n  }\n\n  return [\n    () => update({ lastPosition: fromValue }),\n    () => cancelAnimationFrame(animationFrameId),\n  ]\n}\n\n/** find the first node in the hierarchy that matches the given 'is' typescript type guard predicate */\nexport function findParentThatIs<\n  PREDICATE extends (thing: IAnyStateTreeNode) => boolean\n>(\n  node: IAnyStateTreeNode,\n  predicate: PREDICATE,\n): TypeTestedByPredicate<PREDICATE> & IAnyStateTreeNode {\n  return findParentThat(node, predicate) as TypeTestedByPredicate<PREDICATE> &\n    IAnyStateTreeNode\n}\n\n/** get the current JBrowse session model, starting at any node in the state tree */\nexport function getSession(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isSessionModel)\n  } catch (e) {\n    throw new Error('no session model found!')\n  }\n}\n\n/** get the state model of the view in the state tree that contains the given node */\nexport function getContainingView(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isViewModel)\n  } catch (e) {\n    throw new Error('no containing view found')\n  }\n}\n\n/** get the state model of the view in the state tree that contains the given node */\nexport function getContainingTrack(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isTrackModel)\n  } catch (e) {\n    throw new Error('no containing track found')\n  }\n}\n\nexport function getContainingDisplay(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isDisplayModel)\n  } catch (e) {\n    throw new Error('no containing display found')\n  }\n}\n\n/**\n * Assemble a 1-based \"locString\" from an interbase genomic location\n * @param region - Region\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 })\n * //  '{hg19}chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1' })\n * //  'chr1'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0 })\n * //  'chr1:1..'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 1 })\n * //  'chr1:1'\n * ```\n */\nexport function assembleLocString(region: ParsedLocString): string {\n  const { assemblyName, refName, start, end } = region\n  const assemblyNameString = assemblyName ? `{${assemblyName}}` : ''\n  let startString\n  if (start !== undefined) {\n    startString = `:${(start + 1).toLocaleString('en-US')}`\n  } else if (end !== undefined) {\n    startString = ':1'\n  } else {\n    startString = ''\n  }\n  let endString\n  if (end !== undefined) {\n    endString =\n      start !== undefined && start + 1 === end\n        ? ''\n        : `..${end.toLocaleString('en-US')}`\n  } else {\n    endString = start !== undefined ? '..' : ''\n  }\n  return `${assemblyNameString}${refName}${startString}${endString}`\n}\n\nexport interface ParsedLocString {\n  assemblyName?: string\n  refName: string\n  start?: number\n  end?: number\n}\n\nexport function parseLocStringOneBased(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n): ParsedLocString {\n  if (!locString) {\n    throw new Error('no location string provided, could not parse')\n  }\n  // remove any whitespace\n  locString = locString.replace(/\\s/, '')\n  // refNames can have colons :(\n  // https://samtools.github.io/hts-specs/SAMv1.pdf Appendix A\n  const assemblyMatch = locString.match(/(\\{(.+)\\})?(.+)/)\n  if (!assemblyMatch) {\n    throw new Error(`invalid location string: \"${locString}\"`)\n  }\n  const [, , assemblyName, location] = assemblyMatch\n  const lastColonIdx = location.lastIndexOf(':')\n  if (lastColonIdx === -1) {\n    if (isValidRefName(location, assemblyName)) {\n      return { assemblyName, refName: location }\n    }\n    throw new Error(`Unknown reference sequence \"${location}\"`)\n  }\n  const prefix = location.slice(0, lastColonIdx)\n  const suffix = location.slice(lastColonIdx + 1)\n  if (\n    isValidRefName(prefix, assemblyName) &&\n    isValidRefName(location, assemblyName)\n  ) {\n    throw new Error(`ambiguous location string: \"${locString}\"`)\n  } else if (isValidRefName(prefix, assemblyName)) {\n    if (suffix) {\n      // see if it's a range\n      const rangeMatch = suffix.match(\n        /^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)(-?(\\d+|\\d{1,3}(,\\d{3})*))$/,\n      )\n      // see if it's a single point\n      const singleMatch = suffix.match(/^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)?$/)\n      if (rangeMatch) {\n        const [, start, , , , end] = rangeMatch\n        if (start !== undefined && end !== undefined) {\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +end.replace(/,/g, ''),\n          }\n        }\n      } else if (singleMatch) {\n        const [, start, , , separator] = singleMatch\n        if (start !== undefined) {\n          if (separator) {\n            // indefinite end\n            return {\n              assemblyName,\n              refName: prefix,\n              start: +start.replace(/,/g, ''),\n            }\n          }\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +start.replace(/,/g, ''),\n          }\n        }\n      } else {\n        throw new Error(\n          `could not parse range \"${suffix}\" on location \"${locString}\"`,\n        )\n      }\n    } else {\n      return { assemblyName, refName: prefix }\n    }\n  } else if (isValidRefName(location, assemblyName)) {\n    return { assemblyName, refName: location }\n  }\n  throw new Error(`unknown reference sequence name in location \"${locString}\"`)\n}\n\n/**\n * Parse a 1-based location string into an interbase genomic location\n * @param locString - Location string\n * @param isValidRefName - Function that checks if a refName exists in the set\n * of all known refNames, or in the set of refNames for an assembly if\n * assemblyName is given\n * @example\n * ```ts\n * parseLocString('chr1:1..100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1-100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString(`{hg19}chr1:1..100`, isValidRefName)\n * //  { assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1', isValidRefName)\n * //  { refName: 'chr1' }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 1 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1..', isValidRefName)\n * //  { refName: 'chr1', start: 0}\n * ```\n */\nexport function parseLocString(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const parsed = parseLocStringOneBased(locString, isValidRefName)\n  if (typeof parsed.start === 'number') {\n    parsed.start -= 1\n  }\n  return parsed\n}\n\nexport function compareLocs(locA: ParsedLocString, locB: ParsedLocString) {\n  const assemblyComp =\n    locA.assemblyName || locB.assemblyName\n      ? (locA.assemblyName || '').localeCompare(locB.assemblyName || '')\n      : 0\n  if (assemblyComp) {\n    return assemblyComp\n  }\n\n  const refComp =\n    locA.refName || locB.refName\n      ? (locA.refName || '').localeCompare(locB.refName || '')\n      : 0\n  if (refComp) {\n    return refComp\n  }\n\n  if (locA.start !== undefined && locB.start !== undefined) {\n    const startComp = locA.start - locB.start\n    if (startComp) {\n      return startComp\n    }\n  }\n  if (locA.end !== undefined && locB.end !== undefined) {\n    const endComp = locA.end - locB.end\n    if (endComp) {\n      return endComp\n    }\n  }\n  return 0\n}\n\nexport function compareLocStrings(\n  a: string,\n  b: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const locA = parseLocString(a, isValidRefName)\n  const locB = parseLocString(b, isValidRefName)\n  return compareLocs(locA, locB)\n}\n\n/**\n * Ensure that a number is at least min and at most max.\n *\n * @param num -\n * @param min -\n * @param  max -\n */\nexport function clamp(num: number, min: number, max: number): number {\n  if (num < min) {\n    return min\n  }\n  if (num > max) {\n    return max\n  }\n  return num\n}\n\nfunction roundToNearestPointOne(num: number): number {\n  return Math.round(num * 10) / 10\n}\n\n/**\n * @param bp -\n * @param region -\n * @param bpPerPx -\n */\nexport function bpToPx(\n  bp: number,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): number {\n  if (region.reversed) {\n    return roundToNearestPointOne((region.end - bp) / bpPerPx)\n  }\n  return roundToNearestPointOne((bp - region.start) / bpPerPx)\n}\n\nconst oneEightyOverPi = 180.0 / Math.PI\nconst piOverOneEighty = Math.PI / 180.0\nexport function radToDeg(radians: number): number {\n  return (radians * oneEightyOverPi) % 360\n}\nexport function degToRad(degrees: number): number {\n  return (degrees * piOverOneEighty) % (2 * Math.PI)\n}\n\n/**\n * @returns [x, y]\n */\nexport function polarToCartesian(rho: number, theta: number): [number, number] {\n  return [rho * Math.cos(theta), rho * Math.sin(theta)]\n}\n\n/**\n * @param x - the x\n * @param y - the y\n * @returns [rho, theta]\n */\nexport function cartesianToPolar(x: number, y: number): [number, number] {\n  const rho = Math.sqrt(x * x + y * y)\n  const theta = Math.atan(y / x)\n  return [rho, theta]\n}\n\nexport function featureSpanPx(\n  feature: Feature,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  return bpSpanPx(feature.get('start'), feature.get('end'), region, bpPerPx)\n}\n\nexport function bpSpanPx(\n  leftBp: number,\n  rightBp: number,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  const start = bpToPx(leftBp, region, bpPerPx)\n  const end = bpToPx(rightBp, region, bpPerPx)\n  return region.reversed ? [end, start] : [start, end]\n}\n\nexport const objectFromEntries = Object.fromEntries.bind(Object)\n\n// do an array map of an iterable\nexport function iterMap<T, U>(\n  iterable: Iterable<T>,\n  func: (item: T) => U,\n  sizeHint?: number,\n): U[] {\n  const results = sizeHint ? new Array(sizeHint) : []\n  let counter = 0\n  for (const item of iterable) {\n    results[counter] = func(item)\n    counter += 1\n  }\n  return results\n}\n\ninterface Assembly {\n  name: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\ninterface Track {\n  trackId: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any\n}\ninterface Config {\n  savedSessions: unknown[]\n  assemblies: Assembly[]\n  tracks: Track[]\n  defaultSession?: {}\n}\n// similar to electron.js\nexport function mergeConfigs(A: Config, B: Config) {\n  const merged = merge(A, B)\n  if (B.defaultSession) {\n    merged.defaultSession = B.defaultSession\n  } else if (A.defaultSession) {\n    merged.defaultSession = A.defaultSession\n  }\n  return merged\n}\n\n// https://stackoverflow.com/a/53187807\n/**\n * Returns the index of the last element in the array where predicate is true,\n * and -1 otherwise.\n * @param array - The source array to search in\n * @param predicate - find calls predicate once for each element of the array, in\n * descending order, until it finds one where predicate returns true. If such an\n * element is found, findLastIndex immediately returns that element index.\n * Otherwise, findLastIndex returns -1.\n */\nexport function findLastIndex<T>(\n  array: Array<T>,\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n): number {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l], l, array)) {\n      return l\n    }\n  }\n  return -1\n}\n\n/**\n * makes a mobx reaction with the given functions, that calls actions on the\n * model for each stage of execution, and to abort the reaction function when\n * the model is destroyed.\n *\n * Will call startedFunction(signal), successFunction(result), and\n * errorFunction(error) when the async reaction function starts, completes, and\n * errors respectively.\n *\n * @param self -\n * @param dataFunction -\n * @param asyncReactionFunction -\n * @param reactionOptions -\n * @param startedFunction -\n * @param successFunction -\n * @param errorFunction -\n */\nexport function makeAbortableReaction<T, U, V>(\n  self: T,\n  dataFunction: (arg: T) => U,\n  asyncReactionFunction: (\n    arg: U | undefined,\n    signal: AbortSignal,\n    model: T,\n    handle: IReactionPublic,\n  ) => Promise<V>,\n  reactionOptions: IReactionOptions,\n  startedFunction: (aborter: AbortController) => void,\n  successFunction: (arg: V) => void,\n  errorFunction: (err: Error) => void,\n) {\n  let inProgress: AbortController | undefined\n\n  function handleError(error: Error) {\n    if (!isAbortException(error)) {\n      if (isAlive(self)) {\n        errorFunction(error)\n      } else {\n        console.error(error)\n      }\n    }\n  }\n\n  const reactionDisposer = reaction(\n    () => {\n      try {\n        return dataFunction(self)\n      } catch (error) {\n        handleError(error)\n        return undefined\n      }\n    },\n    async (data, mobxReactionHandle) => {\n      if (inProgress && !inProgress.signal.aborted) {\n        inProgress.abort()\n      }\n\n      if (!isAlive(self)) {\n        return\n      }\n      inProgress = new AbortController()\n\n      const thisInProgress = inProgress\n      startedFunction(thisInProgress)\n      try {\n        const result = await asyncReactionFunction(\n          data,\n          thisInProgress.signal,\n          self,\n          mobxReactionHandle,\n        )\n        checkAbortSignal(thisInProgress.signal)\n        if (isAlive(self)) {\n          successFunction(result)\n        }\n      } catch (error) {\n        if (thisInProgress && !thisInProgress.signal.aborted) {\n          thisInProgress.abort()\n        }\n        handleError(error)\n      }\n    },\n    reactionOptions,\n  )\n\n  addDisposer(self, reactionDisposer)\n  addDisposer(self, () => {\n    if (inProgress && !inProgress.signal.aborted) {\n      inProgress.abort()\n    }\n  })\n}\n\nexport function renameRegionIfNeeded(\n  refNameMap: Record<string, string>,\n  region: Region,\n): Region & { originalRefName?: string } {\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return region\n  }\n  if (region && refNameMap && refNameMap[region.refName]) {\n    // clone the region so we don't modify it\n    if (isStateTreeNode(region)) {\n      region = { ...getSnapshot(region) }\n    } else {\n      region = { ...region }\n    }\n\n    // modify it directly in the container\n    const newRef = refNameMap[region.refName]\n    if (newRef) {\n      return { ...region, refName: newRef, originalRefName: region.refName }\n    }\n  }\n  return region\n}\n\nexport async function renameRegionsIfNeeded<\n  ARGTYPE extends {\n    assemblyName?: string\n    regions?: Region[]\n    signal?: AbortSignal\n    adapterConfig: unknown\n    sessionId: string\n    statusCallback?: Function\n  }\n>(assemblyManager: AssemblyManager, args: ARGTYPE) {\n  const { assemblyName, regions, adapterConfig } = args\n  if (!args.sessionId) {\n    throw new Error('sessionId is required')\n  }\n  const newArgs: ARGTYPE = {\n    ...args,\n    regions: [...(args.regions || [])],\n  }\n\n  if (assemblyName) {\n    const refNameMap = await assemblyManager.getRefNameMapForAdapter(\n      adapterConfig,\n      assemblyName,\n      newArgs,\n    )\n\n    if (refNameMap && regions && newArgs.regions) {\n      for (let i = 0; i < regions.length; i += 1) {\n        newArgs.regions[i] = renameRegionIfNeeded(refNameMap, regions[i])\n      }\n    }\n  }\n  return newArgs\n}\n\nexport function minmax(a: number, b: number) {\n  return [Math.min(a, b), Math.max(a, b)]\n}\n\nexport function stringify({\n  refName,\n  coord,\n  oob,\n}: {\n  coord: number\n  refName: string\n  oob?: boolean\n}) {\n  return `${refName}:${coord.toLocaleString('en-US')}${\n    oob ? ' (out of bounds)' : ''\n  }`\n}\n\nexport const isElectron =\n  typeof window !== 'undefined' && Boolean(window.electron)\n\nexport function revcom(seqString: string) {\n  return complement(seqString).split('').reverse().join('')\n}\n\nexport const complement = (() => {\n  const complementRegex = /[ACGT]/gi\n\n  // from bioperl: tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/\n  // generated with:\n  // perl -MJSON -E '@l = split \"\",\"acgtrymkswhbvdnxACGTRYMKSWHBVDNX\"; print to_json({ map { my $in = $_; tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/; $in => $_ } @l})'\n  const complementTable = {\n    S: 'S',\n    w: 'w',\n    T: 'A',\n    r: 'y',\n    a: 't',\n    N: 'N',\n    K: 'M',\n    x: 'x',\n    d: 'h',\n    Y: 'R',\n    V: 'B',\n    y: 'r',\n    M: 'K',\n    h: 'd',\n    k: 'm',\n    C: 'G',\n    g: 'c',\n    t: 'a',\n    A: 'T',\n    n: 'n',\n    W: 'W',\n    X: 'X',\n    m: 'k',\n    v: 'b',\n    B: 'V',\n    s: 's',\n    H: 'D',\n    c: 'g',\n    D: 'H',\n    b: 'v',\n    R: 'Y',\n    G: 'C',\n  } as { [key: string]: string }\n\n  return (seqString: string) => {\n    return seqString.replace(complementRegex, m => complementTable[m] || '')\n  }\n})()\n\nexport function blobToDataURL(blob: Blob) {\n  const a = new FileReader()\n  return new Promise((resolve, reject) => {\n    a.onload = e => {\n      if (e.target) {\n        resolve(e.target.result)\n      } else {\n        reject(new Error('unknown result reading blob from canvas'))\n      }\n    }\n    a.readAsDataURL(blob)\n  })\n}\n\n// requires immediate execution in jest environment, because (hypothesis) it\n// otherwise listens for prerendered_canvas but reads empty pixels, and doesn't\n// get the contents of the canvas\nexport const rIC =\n  typeof jest === 'undefined'\n    ? // @ts-ignore\n      typeof window !== 'undefined' && window.requestIdleCallback\n      ? // @ts-ignore\n        window.requestIdleCallback\n      : (cb: Function) => setTimeout(() => cb(), 1)\n    : (cb: Function) => cb()\n\n// xref https://gist.github.com/tophtucker/62f93a4658387bb61e4510c37e2e97cf\nexport function measureText(str: string, fontSize = 10) {\n  // prettier-ignore\n  const widths = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2796875,0.2765625,0.3546875,0.5546875,0.5546875,0.8890625,0.665625,0.190625,0.3328125,0.3328125,0.3890625,0.5828125,0.2765625,0.3328125,0.2765625,0.3015625,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.2765625,0.2765625,0.584375,0.5828125,0.584375,0.5546875,1.0140625,0.665625,0.665625,0.721875,0.721875,0.665625,0.609375,0.7765625,0.721875,0.2765625,0.5,0.665625,0.5546875,0.8328125,0.721875,0.7765625,0.665625,0.7765625,0.721875,0.665625,0.609375,0.721875,0.665625,0.94375,0.665625,0.665625,0.609375,0.2765625,0.3546875,0.2765625,0.4765625,0.5546875,0.3328125,0.5546875,0.5546875,0.5,0.5546875,0.5546875,0.2765625,0.5546875,0.5546875,0.221875,0.240625,0.5,0.221875,0.8328125,0.5546875,0.5546875,0.5546875,0.5546875,0.3328125,0.5,0.2765625,0.5546875,0.5,0.721875,0.5,0.5,0.5,0.3546875,0.259375,0.353125,0.5890625]\n  const avg = 0.5279276315789471\n  return (\n    str\n      .split('')\n      .map(c =>\n        c.charCodeAt(0) < widths.length ? widths[c.charCodeAt(0)] : avg,\n      )\n      .reduce((cur, acc) => acc + cur, 0) * fontSize\n  )\n}\n\nexport const defaultStarts = ['ATG']\nexport const defaultStops = ['TAA', 'TAG', 'TGA']\nexport const defaultCodonTable = {\n  TCA: 'S',\n  TCC: 'S',\n  TCG: 'S',\n  TCT: 'S',\n  TTC: 'F',\n  TTT: 'F',\n  TTA: 'L',\n  TTG: 'L',\n  TAC: 'Y',\n  TAT: 'Y',\n  TAA: '*',\n  TAG: '*',\n  TGC: 'C',\n  TGT: 'C',\n  TGA: '*',\n  TGG: 'W',\n  CTA: 'L',\n  CTC: 'L',\n  CTG: 'L',\n  CTT: 'L',\n  CCA: 'P',\n  CCC: 'P',\n  CCG: 'P',\n  CCT: 'P',\n  CAC: 'H',\n  CAT: 'H',\n  CAA: 'Q',\n  CAG: 'Q',\n  CGA: 'R',\n  CGC: 'R',\n  CGG: 'R',\n  CGT: 'R',\n  ATA: 'I',\n  ATC: 'I',\n  ATT: 'I',\n  ATG: 'M',\n  ACA: 'T',\n  ACC: 'T',\n  ACG: 'T',\n  ACT: 'T',\n  AAC: 'N',\n  AAT: 'N',\n  AAA: 'K',\n  AAG: 'K',\n  AGC: 'S',\n  AGT: 'S',\n  AGA: 'R',\n  AGG: 'R',\n  GTA: 'V',\n  GTC: 'V',\n  GTG: 'V',\n  GTT: 'V',\n  GCA: 'A',\n  GCC: 'A',\n  GCG: 'A',\n  GCT: 'A',\n  GAC: 'D',\n  GAT: 'D',\n  GAA: 'E',\n  GAG: 'E',\n  GGA: 'G',\n  GGC: 'G',\n  GGG: 'G',\n  GGT: 'G',\n}\n\n/**\n *  take CodonTable above and generate larger codon table that includes\n *  all permutations of upper and lower case nucleotides\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function generateCodonTable(table: any) {\n  const tempCodonTable: { [key: string]: string } = {}\n  Object.keys(table).forEach(codon => {\n    const aa = table[codon]\n    const nucs: string[][] = []\n    for (let i = 0; i < 3; i++) {\n      const nuc = codon.charAt(i)\n      nucs[i] = []\n      nucs[i][0] = nuc.toUpperCase()\n      nucs[i][1] = nuc.toLowerCase()\n    }\n    for (let i = 0; i < 2; i++) {\n      const n0 = nucs[0][i]\n      for (let j = 0; j < 2; j++) {\n        const n1 = nucs[1][j]\n        for (let k = 0; k < 2; k++) {\n          const n2 = nucs[2][k]\n          const triplet = n0 + n1 + n2\n          tempCodonTable[triplet] = aa\n        }\n      }\n    }\n  })\n  return tempCodonTable\n}\n\n// call statusCallback with current status and clear when finished\nexport async function updateStatus(\n  statusMsg: string,\n  statusCallback: Function,\n  fn: Function,\n) {\n  statusCallback(statusMsg)\n  const result = await fn()\n  statusCallback('')\n  return result\n}\n\nexport function hashCode(str: string) {\n  let hash = 0\n  let i\n  let chr\n  if (str.length === 0) {\n    return hash\n  }\n  for (i = 0; i < str.length; i++) {\n    chr = str.charCodeAt(i)\n    hash = (hash << 5) - hash + chr\n    hash |= 0 // Convert to 32bit integer\n  }\n  return hash\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function objectHash(obj: Record<string, any>) {\n  return `${hashCode(JSON.stringify(obj))}`\n}\n","function findCircleIntersectionX(\n  y: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(y - cy)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([cx, y])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([cx - solution, y])\n  resultArray.push([cx + solution, y])\n}\n\nfunction findCircleIntersectionY(\n  x: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(x - cx)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([x, cy])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([x, cy - solution])\n  resultArray.push([x, cy + solution])\n}\n\nfunction cartesianToTheta(x: number, y: number) {\n  let theta = (Math.atan(y / x) + 2 * Math.PI) % (2 * Math.PI)\n  if (x < 0) {\n    if (y <= 0) {\n      theta += Math.PI\n    } else {\n      theta -= Math.PI\n    }\n  }\n  return theta\n}\n\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  if (rho === 0) {\n    return [0, 0]\n  }\n  const theta = cartesianToTheta(x, y)\n  return [rho, theta]\n}\n\nconst twoPi = 2 * Math.PI\nexport function thetaRangesOverlap(\n  r1start: number,\n  r1length: number,\n  r2start: number,\n  r2length: number,\n) {\n  if (r1length <= 0 || r2length <= 0) {\n    return false\n  }\n  if (r1length + 0.0001 >= twoPi || r2length + 0.0001 >= twoPi) {\n    return true\n  }\n\n  // put both range starts between 2 and 4\n  r1start = (((r1start % twoPi) + twoPi) % twoPi) + twoPi\n  r2start = (((r2start % twoPi) + twoPi) % twoPi) + twoPi\n\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move r2 2 to the left and check\n  r2start -= twoPi\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move it 2 to the right and check\n  r2start += twoPi + twoPi\n  return r1start < r2start + r2length && r1start + r1length > r2start\n}\n\n// return which arc range has any part of the circle visible in the viewport\nexport function viewportVisibleSection(\n  viewSides: [number, number, number, number],\n  circleCenter: [number, number],\n  circleRadius: number,\n) {\n  let [viewL, viewR, viewT, viewB] = viewSides\n  const [cx, cy] = circleCenter\n\n  // transform coordinate system to center of circle\n  viewL -= cx\n  viewR -= cx\n  viewT -= cy\n  viewB -= cy\n\n  const centerIsInsideViewport =\n    viewL < 0 && viewR > 0 && viewT < 0 && viewB > 0\n\n  if (centerIsInsideViewport) {\n    const vertices = [\n      [viewL, viewT],\n      [viewR, viewT],\n      [viewL, viewB],\n      [viewR, viewB],\n    ]\n    let maxRho = -Infinity\n    for (let i = 0; i < vertices.length; i += 1) {\n      const [x, y] = vertices[i]\n      const rho = Math.sqrt(x * x + y * y)\n      if (rho > maxRho) {\n        maxRho = rho\n      }\n    }\n    return {\n      rho: [0, Math.min(circleRadius, maxRho)],\n      theta: [0, 2 * Math.PI],\n    }\n  }\n  // const viewportCompletelyContainsCircle =\n  //   circleCenter[0] - viewL >= circleRadius &&\n  //   viewR - circleCenter[0] >= circleRadius &&\n  //   circleCenter[1] - viewT >= circleRadius &&\n  //   viewB - circleCenter[1] >= circleRadius\n\n  // if (viewportCompletelyContainsCircle) {\n  //   return [0, 2 * Math.PI]\n  // }\n\n  // const distToCenterSquared = ([x, y]) => {\n  //   const [cx, cy] = circleCenter\n  //   const sq = n => n * n\n  //   return sq(x - cx) + sq(y - cy)\n  // }\n  // const circleRadiusSquared = circleRadius * circleRadius\n\n  // const tlInside = distToCenterSquared([viewL, viewT]) <= circleRadiusSquared\n  // const trInside = distToCenterSquared([viewR, viewT]) <= circleRadiusSquared\n  // const blInside = distToCenterSquared([viewL, viewB]) <= circleRadiusSquared\n  // const brInside = distToCenterSquared([viewR, viewB]) <= circleRadiusSquared\n\n  // const noIntersection = !tlInside && !trInside && !blInside && !brInside\n  // if (noIntersection) return undefined\n\n  // const circleCompletelyContainsViewport =\n  //   tlInside && trInside && blInside && brInside\n  // if (circleCompletelyContainsViewport) {\n  //   // viewport is in the circle, but the center is not in it, so take max\n  //   // and min of thetas to the center\n  //   const thetas = [\n  //     Math.atan(viewT / viewL),\n  //     Math.atan(viewT / viewR),\n  //     Math.atan(viewB / viewL),\n  //     Math.atan(viewB / viewR),\n  //   ]\n\n  //   return [Math.min(...thetas), Math.max(...thetas)]\n  // }\n\n  // if we get here, the viewport is partly in, partly out of the circle\n\n  // const viewLIntersects = Math.abs(viewL - circleCenter[0]) <= circleRadius\n  // const viewRIntersects = Math.abs(viewR - circleCenter[0]) <= circleRadius\n  // const viewTIntersects = Math.abs(viewT - circleCenter[1]) <= circleRadius\n  // const viewBIntersects = Math.abs(viewB - circleCenter[1]) <= circleRadius\n\n  // const numIntersectingSides =\n  //   Number(viewLIntersects) +\n  //   Number(viewRIntersects) +\n  //   Number(viewTIntersects) +\n  //   Number(viewBIntersects)\n\n  // if (numIntersectingSides === 4) return [0, 2 * Math.PI]\n  // if (numIntersectingSides === 3) {\n  //   // TODO calculate the thetas of the\n  // } else if (numIntersectingSides === 2) {\n  //   // TODO calculate the thetas of the 2 intersection points\n  // } else if (numIntersectingSides === 1) {\n  //   // TODO calculate the thetas of the 1-2 intersection points of the line, and the angle between\n  // }\n\n  // make a list of vertices-of-interest that lie inside both shapes to examine\n  // to determine the range covered by their intersection\n\n  // transform coordinates to have the circle as the origin and find the intersections\n  // of the circle and the view rectangle\n  const vertices: [number, number][] = [\n    [viewL, viewT],\n    [viewR, viewT],\n    [viewL, viewB],\n    [viewR, viewB],\n  ]\n  findCircleIntersectionY(viewL, 0, 0, circleRadius, vertices)\n  findCircleIntersectionY(viewR, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewT, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewB, 0, 0, circleRadius, vertices)\n\n  // for each edge, also look at the closest point to center if it is inside the circle\n  if (-viewL < circleRadius) {\n    vertices.push([viewL, 0])\n  }\n  if (viewR < circleRadius) {\n    vertices.push([viewR, 0])\n  }\n  if (-viewT < circleRadius) {\n    vertices.push([0, viewT])\n  }\n  if (viewB < circleRadius) {\n    vertices.push([0, viewB])\n  }\n\n  // const verticesOriginal = vertices.map(([x, y]) => [x + cx, y + cy])\n\n  // now convert them all to polar and take the max and min of rho and theta\n\n  // const viewportCenterTheta = cartesianToTheta(viewR + viewL, viewT + viewB)\n  const reflect = viewL >= 0 ? -1 : 1\n  // viewportCenterTheta < Math.PI / 2 || viewportCenterTheta > 1.5 * Math.PI\n  //   ? -1\n  //   : 1\n  let rhoMin = Infinity\n  let rhoMax = -Infinity\n  let thetaMin = Infinity\n  let thetaMax = -Infinity\n  for (let i = 0; i < vertices.length; i += 1) {\n    // ignore vertex if outside the viewport\n    const [vx, vy] = vertices[i]\n    if (vx >= viewL && vx <= viewR && vy >= viewT && vy <= viewB) {\n      const [rho, theta] = cartesianToPolar(vx * reflect, vy * reflect)\n      // ignore vertex if outside the circle\n      if (rho <= circleRadius + 0.001) {\n        // ignore theta if rho is 0\n        if (theta < thetaMin && rho > 0.0001) {\n          thetaMin = theta\n        }\n        if (theta > thetaMax && rho > 0.0001) {\n          thetaMax = theta\n        }\n        if (rho < rhoMin) {\n          rhoMin = rho\n        }\n        if (rho > rhoMax) {\n          rhoMax = rho\n        }\n      }\n    }\n  }\n\n  if (reflect === -1) {\n    thetaMin += Math.PI\n    thetaMax += Math.PI\n  }\n\n  if (thetaMin > 2 * Math.PI && thetaMax > 2 * Math.PI) {\n    thetaMin -= 2 * Math.PI\n    thetaMax -= 2 * Math.PI\n  }\n\n  return {\n    rho: [rhoMin, Math.min(circleRadius, rhoMax)],\n    theta: [thetaMin, thetaMax],\n  }\n}\n","import {\n  polarToCartesian,\n  assembleLocString,\n  objectFromEntries,\n  Region,\n} from '@jbrowse/core/util'\nimport { thetaRangesOverlap } from './viewportVisibleRegion'\n\nexport class Slice {\n  key: string\n\n  region: Region & { widthBp: number; elided: boolean }\n\n  offsetRadians: number\n\n  startRadians: number\n\n  endRadians: number\n\n  bpPerRadian: number\n\n  radianWidth: number\n\n  flipped: boolean\n\n  constructor(\n    view: { bpPerRadian: number },\n    region: Region & { widthBp: number; elided: boolean },\n    currentRadianOffset: number,\n    radianWidth: number,\n  ) {\n    const { bpPerRadian } = view\n    this.key = assembleLocString(region)\n    this.region = region\n    this.offsetRadians = currentRadianOffset\n    this.bpPerRadian = bpPerRadian\n    this.radianWidth = radianWidth\n    this.flipped = false\n\n    this.startRadians = this.offsetRadians\n    this.endRadians = region.widthBp / this.bpPerRadian + this.offsetRadians\n    Object.freeze(this)\n  }\n\n  bpToXY(bp: number, radiusPx: number) {\n    let offsetBp\n    if (this.region.elided) {\n      offsetBp = this.region.widthBp / 2\n    } else if (this.flipped) {\n      offsetBp = this.region.end - bp\n    } else {\n      offsetBp = bp - this.region.start\n    }\n    const totalRadians = offsetBp / this.bpPerRadian + this.offsetRadians\n    return polarToCartesian(radiusPx, totalRadians)\n  }\n\n  toJSON() {\n    return objectFromEntries(Object.entries(this))\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction calculateStaticSlices(self: any) {\n  const slices = []\n  let currentRadianOffset = 0\n  for (const region of self.elidedRegions) {\n    const radianWidth =\n      region.widthBp / self.bpPerRadian + self.spacingPx / self.pxPerRadian\n    slices.push(new Slice(self, region, currentRadianOffset, radianWidth))\n    currentRadianOffset += radianWidth\n  }\n  return slices\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction sliceIsVisible(self: any, slice: Slice) {\n  const {\n    // rho: visibleRhoRange,\n    theta: [visibleThetaMin, visibleThetaMax],\n  } = self.visibleSection\n\n  return thetaRangesOverlap(\n    slice.offsetRadians + self.offsetRadians,\n    slice.radianWidth,\n    visibleThetaMin,\n    visibleThetaMax - visibleThetaMin,\n  )\n}\n\nexport { calculateStaticSlices, sliceIsVisible }\n","import { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  SnapshotOrInstance,\n  Instance,\n  types,\n  getParent,\n  resolveIdentifier,\n  getRoot,\n  cast,\n} from 'mobx-state-tree'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport { transaction } from 'mobx'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  getSession,\n  clamp,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { calculateStaticSlices, sliceIsVisible } from './slices'\n\nimport { viewportVisibleSection } from './viewportVisibleRegion'\n\nexport default function CircularView(pluginManager: PluginManager) {\n  const minHeight = 40\n  const minWidth = 100\n  const defaultHeight = 400\n  return types.compose(\n    BaseViewModel,\n    types\n      .model('CircularView', {\n        type: types.literal('CircularView'),\n        offsetRadians: -Math.PI / 2,\n        bpPerPx: 2000000,\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        hideVerticalResizeHandle: false,\n        hideTrackSelectorButton: false,\n        lockedFitToWindow: true,\n        disableImportForm: false,\n\n        height: types.optional(\n          types.refinement('trackHeight', types.number, n => n >= minHeight),\n          defaultHeight,\n        ),\n        minimumRadiusPx: 25,\n        spacingPx: 10,\n        paddingPx: 80,\n        lockedPaddingPx: 100,\n        minVisibleWidth: 6,\n        minimumBlockWidth: 20,\n        displayedRegions: types.array(Region),\n        scrollX: 0,\n        scrollY: 0,\n        trackSelectorType: 'hierarchical',\n      })\n      .volatile(() => ({\n        width: 800,\n      }))\n      .views(self => ({\n        get staticSlices() {\n          return calculateStaticSlices(self)\n        },\n        get visibleStaticSlices() {\n          return this.staticSlices.filter(sliceIsVisible.bind(this, self))\n        },\n        get visibleSection() {\n          return viewportVisibleSection(\n            [\n              self.scrollX,\n              self.scrollX + self.width,\n              self.scrollY,\n              self.scrollY + self.height,\n            ],\n            this.centerXY,\n            this.radiusPx,\n          )\n        },\n        get circumferencePx() {\n          let elidedBp = 0\n          for (const r of this.elidedRegions) {\n            elidedBp += r.widthBp\n          }\n          return (\n            elidedBp / self.bpPerPx + self.spacingPx * this.elidedRegions.length\n          )\n        },\n        get radiusPx() {\n          return this.circumferencePx / (2 * Math.PI)\n        },\n        get bpPerRadian() {\n          return self.bpPerPx * this.radiusPx\n        },\n        get pxPerRadian() {\n          return this.radiusPx\n        },\n        get centerXY(): [number, number] {\n          return [\n            this.radiusPx + self.paddingPx,\n            this.radiusPx + self.paddingPx,\n          ]\n        },\n        get totalBp() {\n          let total = 0\n          for (const region of self.displayedRegions) {\n            total += region.end - region.start\n          }\n          return total\n        },\n        get maximumRadiusPx() {\n          return self.lockedFitToWindow\n            ? Math.min(self.width, self.height) / 2 - self.lockedPaddingPx\n            : 1000000\n        },\n        get maxBpPerPx() {\n          const minCircumferencePx = 2 * Math.PI * self.minimumRadiusPx\n          return this.totalBp / minCircumferencePx\n        },\n        get minBpPerPx() {\n          // min depends on window dimensions, clamp between old min(0.01) and max\n          const maxCircumferencePx = 2 * Math.PI * this.maximumRadiusPx\n          return clamp(\n            this.totalBp / maxCircumferencePx,\n            0.0000000001,\n            this.maxBpPerPx,\n          )\n        },\n        get atMaxBpPerPx() {\n          return self.bpPerPx >= this.maxBpPerPx\n        },\n        get atMinBpPerPx() {\n          return self.bpPerPx <= this.minBpPerPx\n        },\n        get tooSmallToLock() {\n          return this.minBpPerPx <= 0.0000000001\n        },\n        get figureDimensions() {\n          return [\n            this.radiusPx * 2 + 2 * self.paddingPx,\n            this.radiusPx * 2 + 2 * self.paddingPx,\n          ]\n        },\n        get figureWidth() {\n          return this.figureDimensions[0]\n        },\n        get figureHeight() {\n          return this.figureDimensions[1]\n        },\n        // this is displayedRegions, post-processed to\n        // elide regions that are too small to see reasonably\n        get elidedRegions() {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const visible: any[] = []\n          self.displayedRegions.forEach(region => {\n            const widthBp = region.end - region.start\n            const widthPx = widthBp / self.bpPerPx\n            if (widthPx < self.minVisibleWidth) {\n              // too small to see, collapse into a single elision region\n              const lastVisible = visible[visible.length - 1]\n              if (lastVisible && lastVisible.elided) {\n                lastVisible.regions.push({ ...region })\n                lastVisible.widthBp += widthBp\n              } else {\n                visible.push({\n                  elided: true,\n                  widthBp,\n                  regions: [{ ...region }],\n                })\n              }\n            } else {\n              // big enough to see, display it\n              visible.push({ ...region, widthBp })\n            }\n          })\n\n          // remove any single-region elisions\n          for (let i = 0; i < visible.length; i += 1) {\n            const v = visible[i]\n            if (v.elided && v.regions.length === 1) {\n              delete v.elided\n              visible[i] = { ...v, ...v.regions[0] }\n            }\n          }\n          return visible\n        },\n\n        get assemblyNames() {\n          const assemblyNames: string[] = []\n          self.displayedRegions.forEach(displayedRegion => {\n            if (!assemblyNames.includes(displayedRegion.assemblyName)) {\n              assemblyNames.push(displayedRegion.assemblyName)\n            }\n          })\n          return assemblyNames\n        },\n      }))\n      .volatile(() => ({\n        error: undefined as Error | undefined,\n      }))\n      .actions(self => ({\n        // toggle action with a flag stating which mode it's in\n        setWidth(newWidth: number) {\n          self.width = Math.max(newWidth, minWidth)\n          return self.width\n        },\n        setHeight(newHeight: number) {\n          self.height = Math.max(newHeight, minHeight)\n          return self.height\n        },\n        resizeHeight(distance: number) {\n          const oldHeight = self.height\n          const newHeight = this.setHeight(self.height + distance)\n          this.setModelViewWhenAdjust(!self.tooSmallToLock)\n          return newHeight - oldHeight\n        },\n        resizeWidth(distance: number) {\n          const oldWidth = self.width\n          const newWidth = this.setWidth(self.width + distance)\n          this.setModelViewWhenAdjust(!self.tooSmallToLock)\n          return newWidth - oldWidth\n        },\n        rotateClockwiseButton() {\n          this.rotateClockwise(Math.PI / 6)\n        },\n\n        rotateCounterClockwiseButton() {\n          this.rotateCounterClockwise(Math.PI / 6)\n        },\n\n        rotateClockwise(distance = 0.17) {\n          self.offsetRadians += distance\n        },\n\n        rotateCounterClockwise(distance = 0.17) {\n          self.offsetRadians -= distance\n        },\n\n        zoomInButton() {\n          this.setBpPerPx(self.bpPerPx / 1.4)\n        },\n\n        zoomOutButton() {\n          this.setBpPerPx(self.bpPerPx * 1.4)\n        },\n\n        setBpPerPx(newVal: number) {\n          self.bpPerPx = clamp(newVal, self.minBpPerPx, self.maxBpPerPx)\n        },\n\n        setModelViewWhenAdjust(secondCondition: boolean) {\n          if (self.lockedFitToWindow && secondCondition) {\n            this.setBpPerPx(self.minBpPerPx)\n          }\n        },\n\n        closeView() {\n          getParent(self, 2).removeView(self)\n        },\n\n        setDisplayedRegions(regions: SnapshotOrInstance<typeof Region>[]) {\n          const previouslyEmpty = self.displayedRegions.length === 0\n          self.displayedRegions = cast(regions)\n\n          if (previouslyEmpty) {\n            this.setBpPerPx(self.minBpPerPx)\n          } else {\n            this.setBpPerPx(self.bpPerPx)\n          }\n        },\n\n        activateTrackSelector() {\n          if (self.trackSelectorType === 'hierarchical') {\n            const session = getSession(self)\n            if (isSessionModelWithWidgets(session)) {\n              const selector = session.addWidget(\n                'HierarchicalTrackSelectorWidget',\n                'hierarchicalTrackSelector',\n                { view: self },\n              )\n              session.showWidget(selector)\n              return selector\n            }\n          }\n          throw new Error(\n            `invalid track selector type ${self.trackSelectorType}`,\n          )\n        },\n\n        toggleTrack(trackId: string) {\n          // if we have any tracks with that configuration, turn them off\n          const hiddenCount = this.hideTrack(trackId)\n          // if none had that configuration, turn one on\n          if (!hiddenCount) {\n            this.showTrack(trackId)\n          }\n        },\n\n        setError(error: Error) {\n          self.error = error\n        },\n\n        showTrack(trackId: string, initialSnapshot = {}) {\n          const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n            'track',\n          )\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          const trackType = pluginManager.getTrackType(configuration.type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${configuration.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const supportedDisplays = viewType.displayTypes.map(\n            displayType => displayType.name,\n          )\n          const displayConf = configuration.displays.find(\n            (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n          )\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        addTrackConf(\n          configuration: AnyConfigurationModel,\n          initialSnapshot = {},\n        ) {\n          const { type } = configuration\n          const name = readConfObject(configuration, 'name')\n          const trackType = pluginManager.getTrackType(type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${configuration.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const supportedDisplays = viewType.displayTypes.map(\n            displayType => displayType.name,\n          )\n          const displayConf = configuration.displays.find(\n            (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n          )\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            name,\n            type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        hideTrack(trackId: string) {\n          const trackConfigSchema = pluginManager.pluggableConfigSchemaType(\n            'track',\n          )\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          // if we have any tracks with that configuration, turn them off\n          const shownTracks = self.tracks.filter(\n            t => t.configuration === configuration,\n          )\n          transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n          return shownTracks.length\n        },\n\n        toggleFitToWindowLock() {\n          self.lockedFitToWindow = !self.lockedFitToWindow\n          // when going unlocked -> locked and circle is cut off, set to the locked minBpPerPx\n          this.setModelViewWhenAdjust(self.atMinBpPerPx)\n          return self.lockedFitToWindow\n        },\n      })),\n  )\n}\n\nexport type CircularViewStateModel = ReturnType<typeof CircularView>\nexport type CircularViewModel = Instance<CircularViewStateModel>\n\n/*\nPLANS\n\n- tracks\n- ruler tick marks\n- set viewport scroll from state snapshot\n\n*/\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const React = lib.react\n  const { useState, useEffect } = React\n  const { makeStyles } = lib['@material-ui/core/styles']\n  const { observer } = lib['mobx-react']\n\n  const useStyles = makeStyles(theme => {\n    const offset = 2\n    const duration = 1.4\n    return {\n      path: {\n        strokeDasharray: 187,\n        strokeDashoffset: 50,\n        animation: `$dash ${duration}s ease-in-out infinite, $colors ${\n          duration * 4\n        }s ease-in-out infinite`,\n      },\n      '@keyframes colors': {\n        '0%': {\n          stroke: theme.palette.primary.light,\n        },\n        '25%': {\n          stroke: theme.palette.secondary.light,\n        },\n        '50%': {\n          stroke: theme.palette.tertiary.light,\n        },\n        '75%': {\n          stroke: theme.palette.quaternary.light,\n        },\n        '100%': {\n          stroke: theme.palette.primary.light,\n        },\n      },\n      '@keyframes dash': {\n        '0%': {\n          strokeDashoffset: offset,\n        },\n        '50%': {\n          strokeDashoffset: offset / 4,\n          transform: 'rotate(135deg)',\n        },\n        '100%': {\n          strokeDashoffset: offset,\n          transform: 'rotate(720deg)',\n        },\n      },\n    }\n  })\n\n  // 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n  const Loading = observer(\n    ({\n      model: {\n        renderProps: { radius },\n      },\n    }: {\n      model: { renderProps: { radius: number } }\n    }) => {\n      const classes = useStyles()\n\n      // only show the loading message after 400ms to prevent excessive flickering\n      const [shown, setShown] = useState(false)\n      useEffect(() => {\n        const timeout = setTimeout(() => setShown(true), 400)\n        return () => clearTimeout(timeout)\n      })\n\n      return !shown ? null : (\n        <g>\n          <defs>\n            <pattern\n              id=\"diagonalHatch\"\n              width=\"10\"\n              height=\"10\"\n              patternTransform=\"rotate(45 0 0)\"\n              patternUnits=\"userSpaceOnUse\"\n            >\n              <line\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"10\"\n                style={{ stroke: 'rgba(255,255,255,0.5)', strokeWidth: 10 }}\n              />\n            </pattern>\n          </defs>\n          <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#f1f1f1\" />\n          <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n          <text\n            x=\"0\"\n            y=\"0\"\n            transform=\"rotate(90 0 0)\"\n            dominantBaseline=\"middle\"\n            textAnchor=\"middle\"\n          >\n            Loading&hellip;\n          </text>\n          <circle\n            className={classes.path}\n            fill=\"none\"\n            strokeWidth=\"4\"\n            strokeLinecap=\"round\"\n            cx=\"0\"\n            cy=\"0\"\n            r=\"60\"\n          />\n        </g>\n      )\n    },\n  )\n\n  return Loading\n}\n","export default ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const { observer } = jbrequire('mobx-react')\n\n  const useStyles = makeStyles({\n    errorMessage: {},\n    errorBackground: {},\n    errorText: {},\n  })\n\n  // 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n  const DisplayError = observer(\n    ({\n      model: {\n        renderProps: { radius },\n        error,\n      },\n    }) => {\n      const classes = useStyles()\n      return (\n        <g className={classes.errorMessage}>\n          <defs>\n            <pattern\n              id=\"diagonalHatch\"\n              width=\"10\"\n              height=\"10\"\n              patternTransform=\"rotate(45 0 0)\"\n              patternUnits=\"userSpaceOnUse\"\n            >\n              <line\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"10\"\n                style={{ stroke: 'rgba(255,0,0,0.5)', strokeWidth: 10 }}\n              />\n            </pattern>\n          </defs>\n          <circle\n            className={classes.errorBackground}\n            cx=\"0\"\n            cy=\"0\"\n            r={radius}\n            fill=\"#ffb4b4\"\n          />\n          <circle\n            className={classes.errorPattern}\n            cx=\"0\"\n            cy=\"0\"\n            r={radius}\n            fill=\"url(#diagonalHatch)\"\n          />\n          <text\n            className={classes.errorText}\n            x=\"0\"\n            y=\"0\"\n            transform=\"rotate(90 0 0)\"\n            dominantBaseline=\"middle\"\n            textAnchor=\"middle\"\n          >\n            {String(error)}\n          </text>\n        </g>\n      )\n    },\n  )\n\n  return DisplayError\n}\n","export default ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { isAlive } = jbrequire('mobx-state-tree')\n  const { useEffect, useRef } = React\n  const { observer, PropTypes: MobxPropTypes } = jbrequire('mobx-react')\n  const { unmountComponentAtNode, hydrate } = jbrequire('react-dom')\n  const { rIC } = jbrequire('@jbrowse/core/util')\n\n  function RpcRenderedSvgGroup({ model }) {\n    const { data, html, filled, renderProps, renderingComponent } = model\n\n    const ssrContainerNode = useRef(null)\n\n    useEffect(() => {\n      const domNode = ssrContainerNode.current\n      function doHydrate() {\n        if (domNode && filled) {\n          if (domNode && domNode.innerHTML) {\n            domNode.style.display = 'none'\n            unmountComponentAtNode(domNode)\n          }\n          domNode.style.display = 'inline'\n          domNode.innerHTML = html\n          // use requestIdleCallback to defer main-thread rendering\n          // and hydration for when we have some free time. helps\n          // keep the framerate up.\n          rIC(() => {\n            if (!isAlive(model)) {\n              return\n            }\n            const mainThreadRendering = React.createElement(\n              renderingComponent,\n              { ...data, ...renderProps },\n              null,\n            )\n            rIC(() => {\n              if (!isAlive(model)) {\n                return\n              }\n              hydrate(mainThreadRendering, domNode)\n            })\n          })\n        }\n      }\n      doHydrate()\n      return () => {\n        if (domNode) {\n          unmountComponentAtNode(domNode)\n        }\n      }\n    })\n\n    return <g ref={ssrContainerNode} />\n  }\n\n  RpcRenderedSvgGroup.propTypes = {\n    model: MobxPropTypes.observableObject.isRequired,\n  }\n\n  return observer(RpcRenderedSvgGroup)\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ChordDisplayLoadingFactory from './Loading'\nimport ChordDisplayErrorFactory from './DisplayError'\nimport RpcRenderedSvgGroupF from './RpcRenderedSvgGroup'\n\nexport default ({ lib, load }: PluginManager) => {\n  const React = lib.react\n  const { observer, PropTypes: MobxPropTypes } = lib['mobx-react']\n\n  const Loading = load(ChordDisplayLoadingFactory)\n  const DisplayError = load(ChordDisplayErrorFactory)\n  const RpcRenderedSvgGroup = load(RpcRenderedSvgGroupF)\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function BaseChordDisplay({ display }: any) {\n    if (display.error) {\n      return <DisplayError model={display} />\n    }\n    if (!display.filled) {\n      return <Loading model={display} />\n    }\n    return <RpcRenderedSvgGroup model={display} />\n  }\n  BaseChordDisplay.propTypes = {\n    display: MobxPropTypes.observableObject.isRequired,\n  }\n  return observer(BaseChordDisplay)\n}\n","export default ({ jbrequire }) => {\n  const { getRpcSessionId } = jbrequire('@jbrowse/core/util/tracks')\n  const { getContainingView } = jbrequire('@jbrowse/core/util')\n  const { getSession } = jbrequire('@jbrowse/core/util')\n\n  function renderReactionData(self) {\n    const display = self\n    const view = getContainingView(display)\n    const { rendererType, renderProps } = display\n    const { rpcManager } = getSession(view)\n\n    const a = {\n      rendererType,\n      rpcManager,\n      renderProps,\n      renderArgs: {\n        // TODO: Figure this out for multiple assembly names\n        assemblyName: view.displayedRegions[0]?.assemblyName,\n        adapterConfig: JSON.parse(JSON.stringify(display.adapterConfig)),\n        rendererType: rendererType.name,\n        regions: JSON.parse(JSON.stringify(view.displayedRegions)),\n        blockDefinitions: view.blockDefinitions,\n        sessionId: getRpcSessionId(display),\n        timeout: 1000000, // 10000,\n      },\n    }\n    return a\n  }\n\n  async function renderReactionEffect(props, signal, self) {\n    if (!props) {\n      throw new Error('cannot render with no props')\n    }\n\n    const {\n      rendererType,\n      rpcManager,\n      cannotBeRenderedReason,\n      renderArgs,\n      renderProps,\n    } = props\n\n    if (cannotBeRenderedReason) {\n      return { message: cannotBeRenderedReason }\n    }\n\n    // don't try to render 0 or NaN radius or no regions\n    if (\n      !props.renderProps.radius ||\n      !props.renderArgs.regions ||\n      !props.renderArgs.regions.length\n    ) {\n      return { message: 'Skipping render' }\n    }\n\n    // check renderertype compatibility\n    if (!self.isCompatibleWithRenderer(rendererType)) {\n      throw new Error(\n        `renderer ${rendererType.name} is not compatible with this display type`,\n      )\n    }\n\n    const { html, ...data } = await rendererType.renderInClient(rpcManager, {\n      ...renderArgs,\n      ...renderProps,\n      signal,\n    })\n\n    return { html, data, renderingComponent: rendererType.ReactComponent }\n  }\n\n  return { renderReactionData, renderReactionEffect }\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport CircularChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport RendererType from '@jbrowse/core/pluggableElementTypes/renderers/RendererType'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n  AnyReactComponentType,\n} from '@jbrowse/core/util'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport { Region } from '@jbrowse/core/util/types'\nimport { getParent, isAlive, types, getEnv } from 'mobx-state-tree'\nimport React from 'react'\nimport renderReactionFactory from './renderReaction'\nimport { CircularViewModel } from '../../CircularView/models/CircularView'\n\nexport const BaseChordDisplayModel = types\n  .compose(\n    'BaseChordDisplay',\n    BaseDisplay,\n    types.model({\n      bezierRadiusRatio: 0.1,\n      assemblyName: types.maybe(types.string),\n    }),\n  )\n  .volatile(() => {\n    return {\n      // NOTE: all this volatile stuff has to be filled in at once\n      // so that it stays consistent\n      filled: false,\n      reactElement: undefined as React.ReactElement | undefined,\n      data: undefined,\n      message: '',\n      error: undefined as Error | undefined,\n      renderingComponent: undefined as undefined | AnyReactComponentType,\n      refNameMap: undefined as Record<string, string> | undefined,\n    }\n  })\n  .actions(self => {\n    const { pluginManager } = getEnv(self)\n    const track = self\n    return {\n      onChordClick(feature: Feature) {\n        getConf(self, 'onChordClick', { feature, track, pluginManager })\n      },\n    }\n  })\n  .views(self => ({\n    get blockDefinitions() {\n      const origSlices = (getContainingView(self) as CircularViewModel)\n        .staticSlices\n      if (!self.refNameMap) {\n        return origSlices\n      }\n\n      const slices = JSON.parse(JSON.stringify(origSlices))\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      slices.forEach((slice: any) => {\n        const regions = slice.region.elided\n          ? slice.region.regions\n          : [slice.region]\n        regions.forEach((region: Region) => {\n          const renamed = self.refNameMap?.[region.refName]\n          if (renamed && region.refName !== renamed) {\n            region.refName = renamed\n          }\n        })\n      })\n      return slices\n    },\n\n    get renderProps() {\n      const view = getContainingView(self) as CircularViewModel\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n        bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n        radius: view.radiusPx,\n        blockDefinitions: this.blockDefinitions,\n        onChordClick: self.onChordClick,\n      }\n    },\n\n    /**\n     * the pluggable element type object for this diplay's\n     * renderer\n     */\n    get rendererType() {\n      const display = self\n      const { pluginManager } = getEnv(self)\n      const ThisRendererType = pluginManager.getRendererType(\n        self.rendererTypeName,\n      )\n      if (!ThisRendererType) {\n        throw new Error(`renderer \"${display.rendererTypeName}\" not found`)\n      }\n      if (!ThisRendererType.ReactComponent) {\n        throw new Error(\n          `renderer ${display.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n        )\n      }\n      return ThisRendererType\n    },\n\n    isCompatibleWithRenderer(renderer: RendererType) {\n      return !!(renderer instanceof CircularChordRendererType)\n    },\n\n    /**\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (!isAlive(self)) {\n        return undefined\n      }\n      const session = getSession(self)\n      if (!session) {\n        return undefined\n      }\n      const { selection } = session\n      // does it quack like a feature?\n      if (isFeature(selection)) {\n        return selection.id()\n      }\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    renderStarted() {\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.data = undefined\n      self.error = undefined\n      self.renderingComponent = undefined\n    },\n    renderSuccess({\n      message,\n      data,\n      reactElement,\n      renderingComponent,\n    }: {\n      message: string\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      data: any\n      reactElement: React.ReactElement\n      renderingComponent: AnyReactComponentType\n    }) {\n      if (message) {\n        self.filled = false\n        self.message = message\n        self.reactElement = undefined\n        self.data = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n      } else {\n        self.filled = true\n        self.message = ''\n        self.reactElement = reactElement\n        self.data = data\n        self.error = undefined\n        self.renderingComponent = renderingComponent\n      }\n    },\n    renderError(error: Error) {\n      console.error(error)\n      // the rendering failed for some reason\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.data = undefined\n      self.error = error\n      self.renderingComponent = undefined\n    },\n\n    setRefNameMap(refNameMap: Record<string, string>) {\n      self.refNameMap = refNameMap\n    },\n    setError(error: Error) {\n      self.error = error\n    },\n  }))\n  .actions(self => {\n    const { pluginManager } = getEnv(self)\n    const {\n      renderReactionData,\n      renderReactionEffect,\n    } = pluginManager.jbrequire(renderReactionFactory)\n    return {\n      afterAttach() {\n        makeAbortableReaction(\n          self,\n          renderReactionData,\n          renderReactionEffect,\n          {\n            name: `${self.type} ${self.id} rendering`,\n            // delay: self.renderDelay || 300,\n            fireImmediately: true,\n          },\n          self.renderStarted,\n          self.renderSuccess,\n          self.renderError,\n        )\n        makeAbortableReaction(\n          self,\n          () => ({\n            assemblyNames: getTrackAssemblyNames(self.parentTrack) as string[],\n            adapter: getConf(getParent(self, 2), 'adapter'),\n            assemblyManager: getSession(self).assemblyManager,\n          }),\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          async ({ assemblyNames, adapter, assemblyManager }: any, signal) => {\n            return assemblyManager.getRefNameMapForAdapter(\n              adapter,\n              assemblyNames[0],\n              { signal, sessionId: getRpcSessionId(self) },\n            )\n          },\n          {\n            name: `${self.type} ${self.id} getting refNames`,\n            fireImmediately: true,\n          },\n          () => {},\n          refNameMap => {\n            self.setRefNameMap(refNameMap)\n          },\n          error => {\n            console.error(error)\n            self.setError(error)\n          },\n        )\n      },\n    }\n  })\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nconst baseChordDisplayConfig = ConfigurationSchema(\n  'BaseChordDisplay',\n  {\n    onChordClick: {\n      type: 'boolean',\n      description:\n        'callback that should be run when a chord in the track is clicked',\n      defaultValue: false,\n      contextVariable: ['feature', 'track', 'pluginManager'],\n    },\n  },\n  { explicitIdentifier: 'displayId' },\n)\n\nexport { baseChordDisplayConfig }\n","import { lazy } from 'react'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport DataUsageIcon from '@material-ui/icons/DataUsage'\nimport stateModelFactory from './CircularView/models/CircularView'\n\nexport default class CircularViewPlugin extends Plugin {\n  name = 'CircularViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          ReactComponent: lazy(\n            () => import('./CircularView/components/CircularView'),\n          ),\n          stateModel: stateModelFactory(pluginManager),\n          name: 'CircularView',\n        }),\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['File', 'Add'], {\n        label: 'Circular view',\n        icon: DataUsageIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('CircularView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseChordDisplayModel,\n  baseChordDisplayConfig,\n  BaseChordDisplayComponentFactory,\n} from './BaseChordDisplay'\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default pluginManager =>\n  types\n    .model('ConfigurationEditorWidget', {\n      id: ElementId,\n      type: types.literal('ConfigurationEditorWidget'),\n      // If you add different types of targets, don't forget to account for that\n      // in the key of ./components/ConfigurationEditor.js\n      target: types.safeReference(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    .actions(self => ({\n      setTarget(newTarget) {\n        self.target = newTarget\n      },\n    }))\n","import { observer } from 'mobx-react'\nimport { isStateTreeNode, getType } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('ConfigurationEditorWidget', {})\nexport const HeadingComponent = observer(({ model }) => {\n  if (model && model.target) {\n    if (model.target.type) {\n      return `${model.target.type} settings`\n    }\n    if (isStateTreeNode(model.target)) {\n      const type = getType(model.target)\n      if (type && type.name) {\n        return `${type.name.replace('ConfigurationSchema', '')} settings`\n      }\n    }\n  }\n  return 'Settings'\n})\n","import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { configSchema as FromConfigAdapterConfigSchema } from './configSchema'\n\n/**\n * Adapter that just returns the features defined in its `features` configuration\n * key, like:\n *   `\"features\": [ { \"refName\": \"ctgA\", \"start\":1, \"end\":20 }, ... ]`\n */\n\nexport default class FromConfigAdapter extends BaseFeatureDataAdapter {\n  protected features: Map<string, Feature[]>\n\n  constructor(\n    config: ConfigurationModel<typeof FromConfigAdapterConfigSchema>,\n  ) {\n    super(config)\n    const features = readConfObject(\n      config,\n      'features',\n    ) as SimpleFeatureSerialized[]\n    this.features = FromConfigAdapter.makeFeatures(features || [])\n  }\n\n  static makeFeatures(fdata: SimpleFeatureSerialized[]) {\n    const features = new Map<string, Feature[]>()\n    for (let i = 0; i < fdata.length; i += 1) {\n      if (fdata[i]) {\n        const f = this.makeFeature(fdata[i])\n        const refName = f.get('refName') as string\n        let bucket = features.get(refName)\n        if (!bucket) {\n          bucket = []\n          features.set(refName, bucket)\n        }\n\n        bucket.push(f)\n      }\n    }\n\n    // sort the features on each reference sequence by start coordinate\n    for (const refFeatures of features.values()) {\n      refFeatures.sort((a, b) => a.get('start') - b.get('start'))\n    }\n\n    return features\n  }\n\n  static makeFeature(data: SimpleFeatureSerialized): SimpleFeature {\n    return new SimpleFeature(data)\n  }\n\n  async getRefNames() {\n    const refNames: Set<string> = new Set()\n    for (const [refName, features] of this.features) {\n      // add the feature's primary refname\n      refNames.add(refName)\n\n      // also look in the features for mate or breakend specifications, and add\n      // the refName targets of those\n      features.forEach(feature => {\n        // get refNames of generic \"mate\" records\n        const mate = feature.get('mate')\n        if (mate && mate.refName) {\n          refNames.add(mate.refName)\n        }\n        // get refNames of VCF BND and TRA records\n        const svType = ((feature.get('INFO') || {}).SVTYPE || [])[0]\n        if (svType === 'BND') {\n          const breakendSpecification = (feature.get('ALT') || [])[0]\n          const matePosition = breakendSpecification.MatePosition.split(':')\n          refNames.add(matePosition[0])\n        } else if (svType === 'TRA') {\n          const chr2 = ((feature.get('INFO') || {}).CHR2 || [])[0]\n          refNames.add(chr2)\n        }\n      })\n    }\n    return Array.from(refNames)\n  }\n\n  async getRefNameAliases() {\n    return Array.from(this.features.values()).map(featureArray => ({\n      refName: featureArray[0].get('refName'),\n      aliases: featureArray[0].get('aliases'),\n    }))\n  }\n\n  getFeatures(region: NoAssemblyRegion) {\n    const { refName, start, end } = region\n\n    return ObservableCreate<Feature>(async observer => {\n      const features = this.features.get(refName) || []\n      for (let i = 0; i < features.length; i += 1) {\n        const f = features[i]\n        if (f.get('end') > start && f.get('start') < end) {\n          observer.next(f)\n        }\n      }\n      observer.complete()\n    })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import {\n  BaseAdapter,\n  RegionsAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { configSchema as FromConfigAdapterConfigSchema } from './configSchema'\nimport FromConfigAdapter from './FromConfigAdapter'\n\n/**\n * Adapter that just returns the features defined in its `features` configuration\n * key, like:\n *   `\"features\": [ { \"refName\": \"ctgA\", \"start\":1, \"end\":20 }, ... ]`\n */\nexport default class FromConfigRegionsAdapter\n  extends BaseAdapter\n  implements RegionsAdapter {\n  private features: Map<string, Feature[]>\n\n  constructor(\n    config: ConfigurationModel<typeof FromConfigAdapterConfigSchema>,\n  ) {\n    super(config)\n    const features = readConfObject(\n      config,\n      'features',\n    ) as SimpleFeatureSerialized[]\n    this.features = FromConfigAdapter.makeFeatures(features || [])\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) {\n            regions.push(currentRegion)\n          }\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) {\n        regions.push(currentRegion)\n      }\n    }\n\n    // sort the regions by refName\n    regions.sort((a, b) => a.refName.localeCompare(b.refName))\n\n    return regions\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { toArray } from 'rxjs/operators'\nimport FromConfigAdapter from './FromConfigAdapter'\n\nexport default class FromSequenceConfigAdapter extends FromConfigAdapter {\n  /**\n   * Fetch features for a certain region\n   * @param region - Region\n   * @returns Observable of Feature objects in the region\n   */\n  getFeatures(region: NoAssemblyRegion) {\n    // TODO: restore commented version below once TSDX supports Rollup v2\n    // xref: https://github.com/rollup/rollup/blob/master/CHANGELOG.md#bug-fixes-45\n    // return ObservableCreate<Feature>(async observer => {\n    //   const feats = await super.getFeatures(region).pipe(toArray()).toPromise()\n    const superGetFeatures = super.getFeatures\n    return ObservableCreate<Feature>(async observer => {\n      const feats = await superGetFeatures\n        .call(this, region)\n        .pipe(toArray())\n        .toPromise()\n      const feat = feats[0]\n      observer.next(\n        new SimpleFeature({\n          ...feat.toJSON(),\n          uniqueId: `${feat.id()}:${region.start}-${region.end}`,\n          end: region.end,\n          start: region.start,\n          seq: feat\n            .get('seq')\n            .slice(\n              Math.max(region.start - feat.get('start'), 0),\n              Math.max(region.end - feat.get('start'), 0),\n            ),\n        }),\n      )\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) {\n            regions.push(currentRegion)\n          }\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) {\n        regions.push(currentRegion)\n      }\n    }\n\n    // sort the regions by refName\n    regions.sort((a, b) => a.refName.localeCompare(b.refName))\n\n    return regions\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const configSchema = ConfigurationSchema(\n  'FromConfigAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport const regionsConfigSchema = ConfigurationSchema(\n  'FromConfigRegionsAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport const sequenceConfigSchema = ConfigurationSchema(\n  'FromConfigSequenceAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  BaseRefNameAliasAdapter,\n  Alias,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nimport { ConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport MyConfigAdapterSchema from './configSchema'\n\nexport default class RefNameAliasAdapter\n  extends BaseAdapter\n  implements BaseRefNameAliasAdapter {\n  private location: GenericFilehandle\n\n  private promise: Promise<Alias[]>\n\n  constructor(config: ConfigurationModel<typeof MyConfigAdapterSchema>) {\n    super(config)\n    this.location = openLocation(readConfObject(config, 'location'))\n    this.promise = this.downloadResults()\n  }\n\n  private async downloadResults() {\n    const results = (await this.location.readFile('utf8')) as string\n    return results\n      .trim()\n      .split('\\n')\n      .map((row: string) => {\n        const [refName, ...aliases] = row.split('\\t')\n        return { refName, aliases }\n      })\n  }\n\n  getRefNameAliases() {\n    return this.promise\n  }\n\n  async freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'RefNameAliasAdapter',\n  {\n    location: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my/aliases.txt' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { lazy } from 'react'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as ConfigurationEditorConfigSchema,\n  HeadingComponent as ConfigurationEditorHeadingComponent,\n  stateModelFactory as ConfigurationEditorStateModelFactory,\n} from './ConfigurationEditorWidget'\nimport {\n  AdapterClass as FromConfigAdapterClass,\n  RegionsAdapterClass as FromConfigRegionsAdapterClass,\n  SequenceAdapterClass as FromConfigSequenceAdapterClass,\n  configSchema as fromConfigAdapterConfigSchema,\n  regionsConfigSchema as fromConfigRegionsAdapterConfigSchema,\n  sequenceConfigSchema as fromConfigSequenceAdapterConfigSchema,\n} from './FromConfigAdapter'\nimport {\n  AdapterClass as RefNameAliasAdapterClass,\n  configSchema as refNameAliasAdapterConfigSchema,\n} from './RefNameAliasAdapter'\n\nconst ConfigurationEditorComponent = lazy(\n  () => import('./ConfigurationEditorWidget/components/ConfigurationEditor'),\n)\n\nexport default class extends Plugin {\n  name = 'ConfigurationPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigAdapter',\n          configSchema: fromConfigAdapterConfigSchema,\n          AdapterClass: FromConfigAdapterClass,\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigRegionsAdapter',\n          configSchema: fromConfigRegionsAdapterConfigSchema,\n          AdapterClass: FromConfigRegionsAdapterClass,\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigSequenceAdapter',\n          configSchema: fromConfigSequenceAdapterConfigSchema,\n          AdapterClass: FromConfigSequenceAdapterClass,\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'RefNameAliasAdapter',\n          configSchema: refNameAliasAdapterConfigSchema,\n          AdapterClass: RefNameAliasAdapterClass,\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ConfigurationEditorWidget',\n        HeadingComponent: ConfigurationEditorHeadingComponent,\n        configSchema: ConfigurationEditorConfigSchema,\n        stateModel: ConfigurationEditorStateModelFactory(pluginManager),\n        ReactComponent: ConfigurationEditorComponent,\n      })\n    })\n  }\n}\n\nexport { default as JsonEditor } from './ConfigurationEditorWidget/components/JsonEditor'\n\nexport { ConfigurationEditorComponent as ConfigurationEditor }\n","import React, { ReactElement } from 'react'\nimport { getDefaultValue } from '../../util/mst-reflection'\nimport PluggableElementBase from '../PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../../util'\nimport PluginManager from '../../PluginManager'\n\nexport type RenderProps = Record<string, unknown>\n\nexport interface RenderResults {\n  reactElement?: ReactElement\n  html?: string\n}\n\nexport default class RendererType extends PluggableElementBase {\n  ReactComponent: AnyReactComponentType\n\n  configSchema: AnyConfigurationSchemaType\n\n  pluginManager: PluginManager\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AnyReactComponentType\n    configSchema: AnyConfigurationSchemaType\n    pluginManager: PluginManager\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.configSchema = stuff.configSchema\n    this.pluginManager = stuff.pluginManager\n\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for renderer ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      throw new Error(\n        `${this.name} config schema ${this.configSchema.name} is not explicitlyTyped`,\n      )\n    }\n    if (!this.pluginManager) {\n      throw new Error(`no plugin manager defined for renderer ${this.name}`)\n    }\n  }\n\n  async render(props: RenderProps): Promise<RenderResults> {\n    return {\n      reactElement: React.createElement(this.ReactComponent, props, null),\n    }\n  }\n\n  /**\n   * frees resources associated with the given range, session, etc.\n   * optionally returns the number of data items deleted\n   */\n  freeResources(/* specification: {} */): number {\n    return 0\n  }\n}\n","import { when as mobxWhen } from 'mobx'\nimport { makeAbortError } from './aborting'\n\ninterface WhenOpts {\n  timeout?: number\n  signal?: AbortSignal\n  name?: string\n}\n\n/**\n * Wrapper for mobx `when` that adds timeout and aborting support.\n */\nexport function when(\n  getter: () => boolean,\n  { timeout, signal, name }: WhenOpts = {},\n) {\n  return new Promise((resolve, reject) => {\n    let finished = false\n\n    const whenPromise = mobxWhen(getter)\n\n    // set up timeout\n    let timeoutId: ReturnType<typeof setTimeout> | undefined\n    let finishTimeout = () => {}\n    if (timeout) {\n      timeoutId = setTimeout(() => {\n        if (!finished) {\n          finished = true\n          whenPromise.cancel()\n          reject(new Error(`timed out waiting for ${name || 'whenPresent'}`))\n        }\n      }, timeout)\n      finishTimeout = () => timeoutId && clearTimeout(timeoutId)\n    }\n\n    // set up aborting\n    if (signal) {\n      signal.addEventListener('abort', () => {\n        if (!finished) {\n          finished = true\n\n          // mobx when supports a cancel method\n          whenPromise.cancel()\n          finishTimeout()\n\n          reject(makeAbortError())\n        }\n      })\n    }\n\n    whenPromise\n      .then(() => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          resolve()\n        }\n      })\n      .catch(err => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          reject(err)\n        }\n      })\n  })\n}\n\n/**\n * Wrapper for mobx `when` that makes a promise for the return value\n * of the given function at the point in time when it becomes not\n * undefined and not null.\n */\nexport async function whenPresent<FUNCTION extends () => unknown>(\n  getter: FUNCTION,\n  opts: WhenOpts = {},\n): Promise<NonNullable<ReturnType<FUNCTION>>> {\n  await when(() => {\n    const val = getter()\n    return val !== undefined && val !== null\n  }, opts)\n\n  return getter() as NonNullable<ReturnType<FUNCTION>>\n}\n","import jexl from 'jexl'\nimport { Feature } from './simpleFeature'\n\ntype JexlWithAddFunction = typeof jexl & {\n  addFunction(name: string, func: Function): void\n}\ntype JexlNonBuildable = Omit<typeof jexl, 'Jexl'>\n\nexport default function (/* config?: any*/): JexlNonBuildable {\n  const j = new jexl.Jexl() as JexlWithAddFunction\n  // someday will make sure all of configs callbacks are added in, including\n  // ones passed in\n\n  // below are core functions\n  j.addFunction('get', (feature: Feature, data: string) => {\n    return feature.get(data)\n  })\n\n  j.addFunction('id', (feature: Feature) => {\n    return feature.id()\n  })\n\n  // let user cast a jexl type into a javascript type\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  j.addFunction('cast', (arg: any) => {\n    return arg\n  })\n\n  // logging\n  j.addFunction('log', (thing: unknown) => {\n    // eslint-disable-next-line no-console\n    console.log(thing)\n    return thing\n  })\n\n  // math\n  // addfunction added in jexl 2.3 but types/jexl still on 2.2\n  j.addFunction('max', Math.max)\n  j.addFunction('min', Math.min)\n  j.addFunction('sqrt', Math.sqrt)\n  j.addFunction('ceil', Math.ceil)\n  j.addFunction('floor', Math.floor)\n  j.addFunction('round', Math.round)\n  j.addFunction('abs', Math.abs)\n  j.addFunction('parseInt', Number.parseInt)\n\n  // string\n  j.addFunction('split', (str: string, char: string) => str.split(char))\n  j.addFunction('charAt', (str: string, index: number) => str.charAt(index))\n  j.addFunction('charCodeAt', (str: string, index: number) =>\n    str.charCodeAt(index),\n  )\n  j.addFunction('codePointAt', (str: string, pos: number) =>\n    str.codePointAt(pos),\n  )\n  j.addFunction(\n    'startsWith',\n    (str: string, searchStr: string, length?: number | undefined) =>\n      str.startsWith(searchStr, length),\n  )\n  j.addFunction(\n    'endsWith',\n    (str: string, searchStr: string, length?: number | undefined) =>\n      str.endsWith(searchStr, length),\n  )\n  j.addFunction(\n    'padEnd',\n    (str: string, targetLength: number, padString?: string | undefined) =>\n      str.padEnd(targetLength, padString),\n  )\n  j.addFunction(\n    'padStart',\n    (str: string, targetLength: number, fillString?: string | undefined) =>\n      str.padStart(targetLength, fillString),\n  )\n  j.addFunction('repeat', (str: string, count: number) => str.repeat(count))\n  j.addFunction('replace', (str: string, match: string, newSubStr: string) =>\n    str.replace(match, newSubStr),\n  )\n  j.addFunction('replaceAll', (str: string, match: string, newSubStr: string) =>\n    str.replaceAll(match, newSubStr),\n  )\n  j.addFunction(\n    'slice',\n    (str: string, start: number, end?: number | undefined) =>\n      str.slice(start, end),\n  )\n  j.addFunction(\n    'startsWith',\n    (str: string, searchStr: string, position?: number | undefined) =>\n      str.startsWith(searchStr, position),\n  )\n  j.addFunction(\n    'substring',\n    (str: string, start: number, end?: number | undefined) =>\n      str.substring(start, end),\n  )\n  j.addFunction('toLowerCase', (str: string) => str.toLowerCase())\n  j.addFunction('toUpperCase', (str: string) => str.toUpperCase())\n  j.addFunction('trim', (str: string) => {\n    str.trim()\n  })\n  j.addFunction('trimEnd', (str: string) => str.trimEnd())\n  j.addFunction('trimStart', (str: string) => str.trimStart())\n\n  j.addFunction('getTag', (feature: Feature, str: string) => {\n    const tags = feature.get('tags')\n    return tags ? tags[str] : feature.get(str)\n  })\n\n  j.addBinaryOp('&', 15, (a: number, b: number) => a & b)\n\n  return j\n}\n","import { Observable } from 'rxjs'\nimport { reduce } from 'rxjs/operators'\nimport { NoAssemblyRegion } from './types'\nimport { Feature } from './simpleFeature'\n\nexport interface UnrectifiedFeatureStats {\n  scoreMin: number\n  scoreMax: number\n  scoreSum: number\n  scoreSumSquares: number\n  featureCount: number\n  basesCovered: number\n}\nexport interface FeatureStats extends UnrectifiedFeatureStats {\n  scoreMean: number\n  scoreStdDev: number\n  featureDensity: number\n}\n\n/*\n * calculate standard deviation using the 'shortcut method' that accepts\n * the sum and the sum squares of the elements\n *\n * @param sum - sum(i, 1..n)\n * @param sumSquares - sum(i^2, 1..n)\n * @param n - number of elements\n * @param population - boolean: use population instead of sample correction\n * @return the estimated std deviation\n */\n\nexport function calcStdFromSums(\n  sum: number,\n  sumSquares: number,\n  n: number,\n  population = false,\n): number {\n  if (n === 0) {\n    return 0\n  }\n  let variance\n  if (population) {\n    variance = sumSquares / n - (sum * sum) / (n * n)\n  } else {\n    // sample correction is n-1\n    variance = sumSquares - (sum * sum) / n\n    if (n > 1) {\n      variance /= n - 1\n    }\n  }\n\n  return variance < 0 ? 0 : Math.sqrt(variance)\n}\n\n/*\n * @param stats - a summary stats object with scoreSum, featureCount, scoreSumSquares, and basesCovered\n * @return - a summary stats object with scoreMean, scoreStdDev, and featureDensity added\n */\nexport function rectifyStats(s: UnrectifiedFeatureStats): FeatureStats {\n  return {\n    ...s,\n    scoreMean: (s.scoreSum || 0) / (s.featureCount || s.basesCovered || 1),\n    scoreStdDev: calcStdFromSums(\n      s.scoreSum,\n      s.scoreSumSquares,\n      s.featureCount || s.basesCovered,\n    ),\n    featureDensity: (s.featureCount || 1) / s.basesCovered,\n  }\n}\n\n/*\n * calculates per-base scores for variable width features over a region\n * @param region - object contains start, end\n * @param features - list of features with start, end, score\n * @return array of numeric scores\n */\nexport function calcPerBaseStats(\n  region: NoAssemblyRegion,\n  features: Feature[],\n): number[] {\n  const { start, end } = region\n  const scores = []\n  const feats = features.sort((a, b) => a.get('start') - b.get('start'))\n  let pos = start\n  let currentFeat = 0\n  let i = 0\n\n  while (pos < end) {\n    while (currentFeat < feats.length && pos >= feats[currentFeat].get('end')) {\n      currentFeat += 1\n    }\n    const f = feats[currentFeat]\n    if (!f) {\n      scores[i] = 0\n    } else if (pos >= f.get('start') && pos < f.get('end')) {\n      scores[i] = f.get('score')\n    } else {\n      scores[i] = 0\n    }\n    i += 1\n    pos += 1\n  }\n  return scores\n}\n\n/*\n * transform a list of scores to summary statistics\n * @param region - object with start, end\n * @param feats - array of features which are possibly summary features\n * @return - object with scoreMax, scoreMin, scoreSum, scoreSumSquares, etc\n */\nexport async function scoresToStats(\n  region: NoAssemblyRegion,\n  features: Observable<Feature>,\n): Promise<FeatureStats> {\n  const { start, end } = region\n\n  const {\n    scoreMin,\n    scoreMax,\n    scoreSum,\n    scoreSumSquares,\n    featureCount,\n  } = await features\n    .pipe(\n      reduce(\n        (\n          seed: {\n            scoreMin: number\n            scoreMax: number\n            scoreSum: number\n            scoreSumSquares: number\n            featureCount: number\n          },\n          f: Feature,\n        ) => {\n          const score = f.get('score')\n          seed.scoreMax = Math.max(\n            seed.scoreMax,\n            f.get('summary') ? f.get('maxScore') : score,\n          )\n          seed.scoreMin = Math.min(\n            seed.scoreMin,\n            f.get('summary') ? f.get('minScore') : score,\n          )\n          seed.scoreSum += score\n          seed.scoreSumSquares += score * score\n          seed.featureCount += 1\n\n          return seed\n        },\n        {\n          scoreMin: Number.MAX_VALUE,\n          scoreMax: Number.MIN_VALUE,\n          scoreSum: 0,\n          scoreSumSquares: 0,\n          featureCount: 0,\n        },\n      ),\n    )\n    .toPromise()\n\n  return rectifyStats({\n    scoreMax,\n    scoreMin,\n    scoreSum,\n    scoreSumSquares,\n    featureCount,\n    basesCovered: end - start + 1,\n  })\n}\n\nexport function blankStats(): FeatureStats {\n  return {\n    scoreMin: 0,\n    scoreMax: 0,\n    scoreMean: 0,\n    scoreStdDev: 0,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n    featureDensity: 0,\n    basesCovered: 0,\n  }\n}\n"],"sourceRoot":""}