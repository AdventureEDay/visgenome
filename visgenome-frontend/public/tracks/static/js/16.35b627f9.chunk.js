(this["webpackJsonp@jbrowse/web"]=this["webpackJsonp@jbrowse/web"]||[]).push([[16],{1013:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(83),a=n(355);function i(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"undefined"!==typeof window&&window.innerWidth||e.width,c=e.offsetPx,s=e.displayedRegions,u=e.bpPerPx,l=e.minimumBlockWidth,d=e.interRegionPaddingWidth,f=c*u,p=(c+o)*u,g=o,m=Math.ceil(g*u),h=0,b=new a.a;return s.forEach((function(e,c){var g=e.assemblyName,v=e.refName,y=e.start,w=e.end,O=e.reversed,j=Math.ceil((w-y)/m),k=Math.floor((p-h)/m)+i;k>=j&&(k=j-1);var x=Math.floor((f-h)/m)-i;x<0&&(x=0);for(var C=(w-y)/u,S=x;S<=k;S+=1){var T=void 0,E=void 0,R=void 0,M=void 0;O?(T=Math.max(y,w-(S+1)*m),R=(E=w-S*m)===w,M=T===y):(R=(T=y+S*m)===y,M=(E=Math.min(w,y+(S+1)*m))===w);var P={assemblyName:g,refName:v,start:T,end:E,reversed:O,offsetPx:(h+S*m)/u,parentRegion:e,regionNumber:c,widthPx:(E-T)/u,isLeftEndOfDisplayedRegion:R,isRightEndOfDisplayedRegion:M,key:""};P.key="".concat(Object(r.assembleLocString)(P),"-").concat(c).concat(O?"-reversed":""),t&&0===c&&0===S&&b.push(new a.d({key:"".concat(P.key,"-beforeFirstRegion"),widthPx:o,offsetPx:P.offsetPx-o,variant:"boundary"})),n&&C<l?b.push(new a.c(P)):b.push(new a.b(P)),t&&(C>=l&&P.isRightEndOfDisplayedRegion&&c<s.length-1&&(h+=d*u,b.push(new a.d({key:"".concat(P.key,"-rightpad"),widthPx:d,offsetPx:P.offsetPx+P.widthPx}))),c===s.length-1&&P.isRightEndOfDisplayedRegion&&(h+=d*u,b.push(new a.d({key:"".concat(P.key,"-afterLastRegion"),widthPx:o,offsetPx:P.offsetPx+P.widthPx,variant:"boundary"}))))}h+=w-y})),b}},1021:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(89),a=n(94),i=n(95),o=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return n}(n(528).a)},1024:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(82),a=n(106),i=n(89),o=n(92),c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,e),this.subLayouts=new Map,this.SubLayoutClass=void 0,this.subLayoutConstructorArgs={},this.subLayouts=new Map,this.SubLayoutClass=t,this.subLayoutConstructorArgs=n}return Object(o.a)(e,[{key:"getSublayout",value:function(e){var t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}},{key:"addRect",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.getSublayout(e).addRect(t,n,r,a,i)}},{key:"discardRange",value:function(e,t,n){var r=this.subLayouts.get(e);return r&&r.discardRange(t,n)}},{key:"toJSON",value:function(){var e,t={},n=Object(a.a)(this.subLayouts.entries());try{for(n.s();!(e=n.n()).done;){var i=Object(r.a)(e.value,2),o=i[0],c=i[1];t[o]=c.toJSON()}}catch(s){n.e(s)}finally{n.f()}return t}}]),e}()},1027:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r=n(88),a=n.n(r),i=n(91),o=n(89),c=n(92),s=("undefined"!==typeof window?window:{}).electron,u=function(){function t(e){var n;if(Object(o.a)(this,t),this.filename=void 0,this.fd=void 0,this.ipcRenderer=void 0,s&&(n=s.ipcRenderer),!n)throw new Error("Cannot use ElectronLocalFile without ipcRenderer from electron");this.ipcRenderer=n,this.filename=e}return Object(c.a)(t,[{key:"getFd",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.filename){e.next=2;break}throw new Error("no file path specified");case 2:return this.fd||(this.fd=this.ipcRenderer.invoke("open",this.filename,"r")),e.abrupt("return",this.fd);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var t=Object(i.a)(a.a.mark((function t(n){var r,i,o,c,s,u,l=arguments;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:0,i=l.length>2?l[2]:void 0,o=l.length>3&&void 0!==l[3]?l[3]:0,c=Math.min(n.length-r,i),t.next=6,this.getFd();case 6:return s=t.sent,t.next=9,this.ipcRenderer.invoke("read",s,n,r,c,o);case 9:return(u=t.sent).buffer=e.from(u.buffer),u.buffer.copy(n),t.abrupt("return",u);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"readFile",value:function(){var t=Object(i.a)(a.a.mark((function t(){var n,r=arguments;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.length>0&&void 0!==r[0]?r[0]:{},this.filename){t.next=3;break}throw new Error("no file path specified");case 3:return t.next=5,this.ipcRenderer.invoke("readFile",this.filename);case 5:return n=t.sent,t.abrupt("return",void 0!==n.byteLength?e.from(n):n);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"stat",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.ipcRenderer,e.next=3,this.getFd();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.invoke.call(e.t0,"stat",e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}()}).call(this,n(109).Buffer)},1058:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,a=n(88),i=n.n(a),o=n(106),c=n(89),s=n(92);r=Symbol.iterator;var u=function(){function e(t){Object(c.a)(this,e),this.submaps=void 0,this.submaps=t}return Object(s.a)(e,[{key:"has",value:function(e){var t,n=Object(o.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){if(t.value.has(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"get",value:function(e){var t,n=Object(o.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.has(e))return r.get(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"values",value:i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(o.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,this.get(r);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"keys",value:i.a.mark((function(){var e,t,n,r,a,c,s,u,l,d;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:e=new Set,t=Object(o.a)(this.submaps.values());try{for(t.s();!(n=t.n()).done;){r=n.value,a=Object(o.a)(r.keys());try{for(a.s();!(c=a.n()).done;)s=c.value,e.add(s)}catch(f){a.e(f)}finally{a.f()}}}catch(f){t.e(f)}finally{t.f()}u=Object(o.a)(e),i.prev=4,u.s();case 6:if((l=u.n()).done){i.next=12;break}return d=l.value,i.next=10,d;case 10:i.next=6;break;case 12:i.next=17;break;case 14:i.prev=14,i.t0=i.catch(4),u.e(i.t0);case 17:return i.prev=17,u.f(),i.finish(17);case 20:case"end":return i.stop()}}),e,this,[[4,14,17,20]])}))},{key:"find",value:function(e){var t,n=Object(o.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var r,a=t.value,i=Object(o.a)(a.values());try{for(i.s();!(r=i.n()).done;){var c=r.value;if(e(c))return c}}catch(s){i.e(s)}finally{i.f()}}}catch(s){n.e(s)}finally{n.f()}}},{key:r,value:i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(o.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,[r,this.get(r)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"entries",value:i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(o.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,[r,this.get(r)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))}]),e}()},1062:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w})),n.d(t,"adapterCapabilities",(function(){return O}));var r=n(90),a=n(88),i=n.n(a),o=n(91),c=n(89),s=n(92),u=n(94),l=n(95),d=n(1063),f=n(136),p=n(139),g=n(147),m=n(142),h=n(520),b=n(199),v=n(81),y=n(995),w=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).bigwig=void 0,r.bigwig=new d.BigWig({filehandle:Object(p.openLocation)(Object(v.readConfObject)(e,"bigWigLocation"))}),r}return Object(s.a)(n,[{key:"setup",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t||{}).statusCallback,(r=void 0===n?function(){}:n)("Downloading bigwig header"),e.next=4,this.bigwig.getHeader(t);case 4:return a=e.sent,r(""),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return n=e.sent,e.abrupt("return",Object.keys(n.refsByName));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refIdToName",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup();case 2:return n=e.sent,e.abrupt("return",(n.refsByNumber[t]||{name:void 0}).name);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlobalStats",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return n=e.sent,e.abrupt("return",Object(y.b)(n.totalSummary));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.refName,c=e.start,s=e.end,u=n.bpPerPx,l=void 0===u?0:u,d=n.signal,f=n.resolution,p=void 0===f?1:f,v=n.statusCallback,y=void 0===v?function(){}:v;return Object(g.ObservableCreate)(function(){var e=Object(o.a)(i.a.mark((function e(o){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("Downloading bigwig data"),e.next=3,t.bigwig.getFeatureStream(a,c,s,Object(r.a)(Object(r.a)({},n),{},{basesPerSpan:l/p}));case 3:e.sent.pipe(Object(h.a)(),Object(b.a)((function(e){return new m.a({id:"".concat(a,":").concat(e.start,"-").concat(e.end),data:Object(r.a)(Object(r.a)({},e),{},{refName:a})})}))).subscribe(o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d)}},{key:"freeResources",value:function(){}}]),n}(f.BaseFeatureDataAdapter);w.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];var O=w.capabilities},114:function(e,t,n){"use strict";n.r(t),n.d(t,"ElementId",(function(){return l})),n.d(t,"PropTypes",(function(){return d})),n.d(t,"NoAssemblyRegion",(function(){return f})),n.d(t,"Region",(function(){return p})),n.d(t,"LocalPathLocation",(function(){return g})),n.d(t,"BlobLocation",(function(){return m})),n.d(t,"UriLocationRaw",(function(){return h})),n.d(t,"UriLocation",(function(){return b})),n.d(t,"FileLocation",(function(){return v}));var r=n(154),a=n(416),i=n.n(a),o=n(87),c=n(11),s=n.n(c),u=n(84),l=o.types.optional(o.types.identifier,i.a.generate),d={Region:s.a.shape({refName:s.a.string.isRequired,start:s.a.number.isRequired,end:s.a.number.isRequired}),ConfigSchema:u.PropTypes.objectOrObservableObject,Feature:s.a.shape({get:s.a.func.isRequired,id:s.a.func.isRequired})},f=o.types.model("NoAssemblyRegion",{refName:o.types.string,start:o.types.number,end:o.types.number,reversed:o.types.optional(o.types.boolean,!1)}).actions((function(e){return{setRefName:function(t){e.refName=t}}})),p=o.types.compose("Region",f,o.types.model({assemblyName:o.types.string})),g=o.types.model("LocalPathLocation",{localPath:o.types.string}),m=o.types.model("BlobLocation",{name:o.types.string,blobId:o.types.string}),h=o.types.model("UriLocation",{uri:o.types.string,baseUri:o.types.maybe(o.types.string)}),b=o.types.snapshotProcessor(h,{postProcessor:function(e){var t=e.baseUri,n=Object(r.a)(e,["baseUri"]);return t?e:n}}),v=o.types.union(g,b,m)},119:function(e,t,n){"use strict";n.r(t),n.d(t,"getTrackAssemblyNames",(function(){return o})),n.d(t,"getRpcSessionId",(function(){return c})),n.d(t,"getParentRenderProps",(function(){return s})),n.d(t,"UNKNOWN",(function(){return u})),n.d(t,"UNSUPPORTED",(function(){return l})),n.d(t,"getBlob",(function(){return f})),n.d(t,"getBlobMap",(function(){return p})),n.d(t,"setBlobMap",(function(){return g})),n.d(t,"storeBlobLocation",(function(){return m})),n.d(t,"guessAdapter",(function(){return h})),n.d(t,"guessTrackType",(function(){return b})),n.d(t,"generateUnsupportedTrackConf",(function(){return v})),n.d(t,"generateUnknownTrackConf",(function(){return y}));var r=n(87),a=n(83),i=n(81);function o(e){var t=e.configuration,n=Object(i.readConfObject)(t,"assemblyNames");if(!n){var a=Object(r.getParent)(e.configuration);if("sequence"in a)return[Object(i.readConfObject)(a,"name")]}return n}function c(e){for(var t,n=e;!Object(r.isRoot)(n);n=Object(r.getParent)(n))"rpcSessionId"in n&&(t=n.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function s(e){for(var t=Object(r.getParent)(e);!Object(r.isRoot)(t);t=Object(r.getParent)(t))if("renderProps"in t)return t.renderProps;return{}}var u="UNKNOWN",l="UNSUPPORTED",d={};function f(e){return d[e]}function p(){return d}function g(e){d=e}function m(e){if(e&&"blob"in e){var t="b".concat(+Date.now());return d[t]=e.blob,{name:null===e||void 0===e?void 0:e.blob.name,blobId:t}}return e}function h(e,t,n,r){function a(e,t){return"uri"in e?{uri:e.uri+t}:"localPath"in e?{localPath:e.localPath+t}:e}var i=n(e),o=t&&n(t);function c(e,t,n){return(null===e||void 0===e?void 0:e.toUpperCase().endsWith(t))?t:n}return/\.bam$/i.test(i)||"BamAdapter"===r?{type:"BamAdapter",bamLocation:e,index:{location:t||a(e,".bai"),indexType:c(o,"CSI","BAI")}}:/\.cram$/i.test(i)||"CramAdapter"===r?{type:"CramAdapter",cramLocation:e,craiLocation:t||a(e,".crai")}:/\.gff3?$/i.test(i)?{type:"UNSUPPORTED"}:/\.gff3?\.b?gz$/i.test(i)||"Gff3TabixAdapter"===r?{type:"Gff3TabixAdapter",gffGzLocation:e,index:{location:t||a(e,".tbi"),indexType:c(o,"CSI","TBI")}}:/\.gtf?$/i.test(i)||/\.vcf$/i.test(i)?{type:"UNSUPPORTED"}:/\.vcf\.b?gz$/i.test(i)||"VcfTabixAdapter"===r?{type:"VcfTabixAdapter",vcfGzLocation:e,index:{location:t||a(e,"tbi"),indexType:c(o,"CSI","TBI")}}:/\.vcf\.idx$/i.test(i)||/\.bed$/i.test(i)?{type:"UNSUPPORTED"}:/\.bed\.b?gz$/i.test(i)||"BedTabixAdapter"===r?{type:"BedTabixAdapter",bedGzLocation:e,index:{location:t||a(e,".tbi"),indexType:c(o,"CSI","TBI")}}:/\.(bb|bigbed)$/i.test(i)||"BigBedAdapter"===r?{type:"BigBedAdapter",bigBedLocation:e}:/\.(bw|bigwig)$/i.test(i)||"BigWigAdapter"===r?{type:"BigWigAdapter",bigWigLocation:e}:/\.(fa|fasta|fas|fna|mfa)$/i.test(i)||"IndexedFastaAdapter"===r?{type:"IndexedFastaAdapter",fastaLocation:e,faiLocation:t||a(e,".fai")}:/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(i)||"BgzipFastaAdapter"===r?{type:"BgzipFastaAdapter",fastaLocation:e,faiLocation:a(e,".fai"),gziLocation:a(e,".gzi")}:/\.2bit$/i.test(i)||"TwoBitAdapter"===r?{type:"TwoBitAdapter",twoBitLocation:e}:/\.sizes$/i.test(i)?{type:"UNSUPPORTED"}:/\/trackData.jsonz?$/i.test(i)||"NCListAdapter"===r?{type:"NCListAdapter",rootUrlTemplate:e}:/\/sparql$/i.test(i)||"SPARQLAdapter"===r?{type:"SPARQLAdapter",endpoint:e}:/\.hic/i.test(i)||"HicAdapter"===r?{type:"HicAdapter",hicLocation:e}:/\.paf/i.test(i)||"PAFAdapter"===r?{type:"PAFAdapter",pafLocation:e}:{type:u}}function b(e){return{BamAdapter:"AlignmentsTrack",CramAdapter:"AlignmentsTrack",BgzipFastaAdapter:"ReferenceSequenceTrack",BigWigAdapter:"QuantitativeTrack",IndexedFastaAdapter:"ReferenceSequenceTrack",TwoBitAdapter:"ReferenceSequenceTrack",VcfTabixAdapter:"VariantTrack",HicAdapter:"HicTrack",PAFAdapter:"SyntenyTrack"}[e]||"FeatureTrack"}function v(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unsupported)"),description:'Support not yet implemented for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=Object(a.objectHash)(r),r}function y(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unknown)"),description:'Could not determine track type for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=Object(a.objectHash)(r),r}},123:function(e,t,n){"use strict";n.r(t),n.d(t,"jbrowseDefaultPalette",(function(){return f})),n.d(t,"createJBrowseDefaultProps",(function(){return p})),n.d(t,"createJBrowseDefaultOverrides",(function(){return g})),n.d(t,"jbrowseBaseTheme",(function(){return m})),n.d(t,"createJBrowseTheme",(function(){return h})),n.d(t,"LogoFull",(function(){return O})),n.d(t,"Logomark",(function(){return w})),n.d(t,"App",(function(){return ke})),n.d(t,"FileSelector",(function(){return xe.a})),n.d(t,"PrerenderedCanvas",(function(){return Ee})),n.d(t,"ResizeHandle",(function(){return $})),n.d(t,"EditableTypography",(function(){return fe})),n.d(t,"FactoryResetDialog",(function(){return Fe})),n.d(t,"Tooltip",(function(){return De})),n.d(t,"FatalErrorDialog",(function(){return We})),n.d(t,"Menu",(function(){return ce.a})),n.d(t,"SanitizedHTML",(function(){return ze.a}));var r=n(90),a=n(25),i=n(24),o=n(1015),c=n(22),s=n(36),u=n(982),l=n.n(u),d=Object(s.a)(),f={primary:{main:"#0D233F"},secondary:{main:"#721E63"},tertiary:d.palette.augmentColor({main:"#135560"}),quaternary:d.palette.augmentColor({main:"#FFB11D"}),stopCodon:"#e22",startCodon:"#3e3",bases:{A:d.palette.augmentColor(a.a),C:d.palette.augmentColor(i.a),G:d.palette.augmentColor(o.a),T:d.palette.augmentColor(c.a)}};function p(){return{MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}}}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=l()(f,e);return{MuiIconButton:{colorSecondary:{color:t.tertiary.main}},MuiButton:{textSecondary:{color:t.tertiary.main}},MuiFab:{secondary:{display:"none",backgroundColor:t.quaternary.main}},MuiLink:{root:{color:t.tertiary.main}},MuiAccordionSummary:{root:{background:t.tertiary.main,"&$expanded":{minHeight:0,margin:0,color:t.tertiary.contrastText},margin:0,minHeight:0,padding:"0px 24px"},content:{"&$expanded":{margin:"8px 0px"},margin:"8px 0px",color:t.tertiary.contrastText},expanded:{}},MuiMenuItem:{root:{paddingTop:3,paddingBottom:3}},MuiListItemIcon:{root:{minWidth:32}},MuiListItemText:{inset:{paddingLeft:32}}}}var m={palette:f,typography:{fontSize:12},spacing:4,props:{MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}},overrides:g()};function h(e){var t,n;return e?((null===(t=e.palette)||void 0===t?void 0:t.tertiary)&&(e=Object(r.a)(Object(r.a)({},e),{},{palette:Object(r.a)(Object(r.a)({},e.palette),{},{tertiary:d.palette.augmentColor(e.palette.tertiary)})})),(null===(n=e.palette)||void 0===n?void 0:n.quaternary)&&(e=Object(r.a)(Object(r.a)({},e),{},{palette:Object(r.a)(Object(r.a)({},e.palette),{},{quaternary:d.palette.augmentColor(e.palette.quaternary)})})),e=Object(r.a)(Object(r.a)({},e),{},{props:l()({MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}},e.props||{}),overrides:l()(g(e.palette),e.overrides||{})}),Object(s.a)(l()(m,e))):Object(s.a)(m)}var b=n(1),v=n.n(b);function y(e){return"black"===e?{midnight:"#808080",forrest:"#666666",grape:"#4d4d4d",mandarin:"#333333",gray:"#1a1a1a"}:"white"===e?{midnight:"#ffffff",forrest:"#e6e6e6",grape:"#cccccc",mandarin:"#b3b3b3",gray:"#999999"}:{midnight:"#0d233f",forrest:"#135560",grape:"#721e63",mandarin:"#ffb11d",gray:"#dadada"}}function w(e){var t=e.variant;return v.a.createElement("svg",{viewBox:"0 0 175 175"},v.a.createElement(j,{variant:t}))}function O(e){var t=e.variant;return v.a.createElement("svg",{display:"none",viewBox:"0 0 641 175"},v.a.createElement(k,{variant:t}),v.a.createElement(j,{variant:t}))}function j(e){var t=y(e.variant);return v.a.createElement(v.a.Fragment,null,v.a.createElement("path",{style:{fill:t.midnight},d:"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z"}),v.a.createElement("path",{style:{fill:t.forrest},d:"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z"}),v.a.createElement("path",{style:{fill:t.grape},d:"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z"}),v.a.createElement("path",{style:{fill:t.mandarin},d:"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z"}),v.a.createElement("path",{style:{fill:t.gray},d:"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z"}))}function k(e){var t=y(e.variant);return v.a.createElement("g",{display:"none","aria-label":"JBrowse",transform:"translate(213.084 144.241)",style:{fill:t.midnight}},v.a.createElement("path",{d:"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z"}),v.a.createElement("path",{d:"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z"}),v.a.createElement("path",{d:"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z"}),v.a.createElement("path",{d:"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z"}),v.a.createElement("path",{d:"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z"}),v.a.createElement("path",{d:"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z"}),v.a.createElement("path",{d:"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z"}))}var x=n(51),C=n(2361),S=n(2357),T=n(2344),E=n(2367),R=n(1572),M=n.n(R),P=n(84),N=n(87),A=n(82),F=n(2460),I=n(2338),B=n(2335),D=n(2362),L=n(2342),V=n(356),W=n.n(V),z=n(134),H=n.n(z),q=n(1566),U=n.n(q),_=n(226),G=n(160),J=n(2332),X=n(154),Y=n(26),Q=Object(x.a)({horizontalHandle:{cursor:"row-resize",width:"100%"},verticalHandle:{cursor:"col-resize",height:"100%"},flexbox_verticalHandle:{cursor:"col-resize",alignSelf:"stretch"},flexbox_horizontalHandle:{cursor:"row-resize",alignSelf:"stretch"}});var $=function(e){var t,n=e.onDrag,r=e.vertical,a=void 0!==r&&r,i=e.flexbox,o=void 0!==i&&i,c=e.className,s=Object(X.a)(e,["onDrag","vertical","flexbox","className"]),u=Object(b.useState)(!1),l=Object(A.a)(u,2),d=l[0],f=l[1],p=Object(b.useRef)(0),g=Q();return Object(b.useEffect)((function(){function e(e){e.preventDefault();var t=e[a?"clientX":"clientY"]-p.current;if(t){var r=n(t);p.current+=r}}function t(){f(!1)}return d?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",t,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",t,!0)}):function(){}}),[d,n,a]),t=o?a?g.flexbox_verticalHandle:g.flexbox_horizontalHandle:a?g.verticalHandle:g.horizontalHandle,v.a.createElement("div",Object.assign({"data-resizer":"true",onMouseDown:function(e){e.preventDefault();var t=e[a?"clientX":"clientY"];p.current=t,f(!0)},role:"presentation",className:Object(Y.a)(t,c)},s))},K=Object(x.a)((function(e){return{paper:{overflowY:"auto",height:"100%",zIndex:e.zIndex.drawer,outline:"none",background:e.palette.background.default},resizeHandle:{width:4,position:"fixed",top:0,zIndex:e.zIndex.drawer+1}}}));function Z(e){var t=e.children,n=e.session,r=K();return v.a.createElement(J.a,{className:r.paper,elevation:16,square:!0},v.a.createElement($,{onDrag:n.resizeDrawer,className:r.resizeHandle,vertical:!0}),t)}Z.defaultProps={children:null};var ee=Object(P.observer)(Z),te=Object(x.a)((function(e){return{drawerActions:{float:"right","&:hover":{backgroundColor:Object(_.fade)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},drawerToolbar:{paddingLeft:e.spacing(2)},spacer:{flexGrow:1},drawerSelect:{color:e.palette.secondary.contrastText},drawerLoading:{margin:e.spacing(2)},dropDownIcon:{color:e.palette.secondary.contrastText}}})),ne=Object(P.observer)((function(e){var t=e.session,n=e.setToolbarHeight,r=t.visibleWidget,a=t.activeWidgets,i=te(),o=Object(G.a)();return v.a.createElement(C.a,{position:"sticky",ref:function(e){return n((null===e||void 0===e?void 0:e.getBoundingClientRect().height)||0)},style:{background:o.palette.secondary.main}},v.a.createElement(S.a,{disableGutters:!0,className:i.drawerToolbar},v.a.createElement(F.a,{value:r||"","data-testid":"widget-drawer-selects",className:i.drawerSelect,classes:{icon:i.dropDownIcon},renderValue:function(e){var n=Object(N.getEnv)(t).pluginManager.getWidgetType(e.type),r=n.HeadingComponent,a=n.heading;return v.a.createElement(I.a,{variant:"h6",color:"inherit"},r?v.a.createElement(r,{model:e}):a||void 0)},onChange:function(e,n){var r;r=n,t.showWidget(r.props.value)}},Array.from(a.values()).map((function(e,n){var r=Object(N.getEnv)(t).pluginManager.getWidgetType(e.type),a=r.HeadingComponent,o=r.heading;return v.a.createElement(B.a,{"data-testid":"widget-drawer-selects-item-".concat(e.type),key:"".concat(e.id,"-").concat(n),value:e},v.a.createElement(I.a,{variant:"h6",color:"inherit"},a?v.a.createElement(a,{model:e}):o||void 0),v.a.createElement(D.a,null,v.a.createElement(L.a,{className:i.drawerCloseButton,"data-testid":"".concat(e.type,"-drawer-delete"),color:"inherit","aria-label":"Delete",onClick:function(){t.hideWidget(e)}},v.a.createElement(W.a,null))))}))),v.a.createElement("div",{className:i.spacer}),v.a.createElement("div",{className:i.drawerCloseButton},v.a.createElement(L.a,{className:i.drawerCloseButton,"data-testid":"drawer-minimize",color:"inherit",onClick:function(){t.minimizeWidgetDrawer()}},v.a.createElement(U.a,null)),v.a.createElement(L.a,{"data-testid":"drawer-close",color:"inherit",onClick:function(){t.hideWidget(r)}},v.a.createElement(H.a,null)))))})),re=Object(P.observer)((function(e){var t=e.session,n=t.visibleWidget,r=t.activeWidgets,a=Object(N.getEnv)(t).pluginManager.getWidgetType(n.type).ReactComponent,i=Object(b.useState)(0),o=Object(A.a)(i,2),c=o[0],s=o[1];return v.a.createElement(ee,{session:t,open:Boolean(r.size)},v.a.createElement(ne,{session:t,setToolbarHeight:s}),v.a.createElement(b.Suspense,{fallback:v.a.createElement("div",null,"Loading...")},v.a.createElement(a,{model:n,session:t,toolbarHeight:c})))})),ae=n(2337),ie=n(689),oe=n.n(ie),ce=n(283),se=Object(x.a)((function(e){return{root:{display:"flex"},buttonRoot:{"&:hover":{backgroundColor:Object(_.fade)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}}));var ue=Object(P.observer)((function(e){var t=e.menuTitle,n=e.session,r=e.menuItems,a=Object(b.useState)(!1),i=Object(A.a)(a,2),o=i[0],c=i[1],s=Object(b.useRef)(null),u=se();function l(){c(!1)}return v.a.createElement("div",{className:u.root},v.a.createElement(ae.a,{ref:s,onClick:function(){c(!o)},color:"inherit","data-testid":"dropDownMenuButton",style:{display:"none"},classes:{root:u.buttonRoot}},t,v.a.createElement(oe.a,null)),v.a.createElement(ce.a,{anchorEl:s.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onMenuItemClick:function(e,t){t(n),l()},open:o,onClose:l,menuItems:r}))})),le=n(2324),de=Object(x.a)((function(e){return{input:{},inputBase:{},typography:{top:6,left:2,position:"absolute",whiteSpace:"nowrap",visibility:"hidden"},inputRoot:{padding:e.spacing(.5)},inputFocused:{borderStyle:"solid",borderRadius:e.shape.borderRadius,borderWidth:2}}})),fe=v.a.forwardRef((function(e,t){var n=e.value,a=e.setValue,i=e.variant,o=Object(X.a)(e,["value","setValue","variant"]),c=Object(b.useState)(),s=Object(A.a)(c,2),u=s[0],l=s[1],d=Object(b.useState)(0),f=Object(A.a)(d,2),p=f[0],g=f[1],m=Object(b.useState)(null),h=Object(A.a)(m,2),y=h[0],w=h[1],O=Object(b.useState)(null),j=Object(A.a)(O,2),k=j[0],x=j[1],C=Object(b.useState)(!1),S=Object(A.a)(C,2),T=S[0],E=S[1];Object(b.useEffect)((function(){T&&(k&&k.blur(),E(!1))}),[T,k]);var R=de(e),M=Object(G.a)(),P=y&&y.clientWidth;P&&P!==p&&g(P);return v.a.createElement("div",Object.assign({},o,{ref:t}),v.a.createElement("div",{style:{position:"relative"}},v.a.createElement(I.a,{ref:function(e){w(e)},component:"span",variant:i,className:R.typography},void 0===u?n:u)),v.a.createElement(le.a,{inputRef:function(e){x(e)},className:R.inputBase,inputProps:{style:Object(r.a)({width:p},i&&"inherit"!==i&&"srOnly"!==i?M.typography[i]:{})},classes:{input:R.input,root:R.inputRoot,focused:R.inputFocused},value:void 0===u?n:u,onChange:function(e){l(e.target.value)},onKeyDown:function(e){"Enter"===e.key?k&&k.blur():"Escape"===e.key&&(l(void 0),E(!0))},onBlur:function(){u&&u!==n&&a(u),l(void 0)}}))})),pe=n(2365),ge=n(2443);var me=Object(P.observer)((function(e){var t=e.session,n=Object(b.useState)(!1),r=Object(A.a)(n,2),a=r[0],i=r[1],o=Object(b.useState)(),c=Object(A.a)(o,2),s=c[0],u=c[1],l=t.popSnackbarMessage,d=t.snackbarMessages,f=d.length?d[d.length-1]:null;Object(b.useEffect)((function(){var e;return s?f?s[0]!==f[0]&&(i(!1),e=setTimeout((function(){u(f),i(!0)}),100)):u(void 0):f&&(u(f),i(!0)),function(){clearTimeout(e)}}),[f,s]);var p=function(e,t){"clickaway"!==t&&(l(),i(!1))},g=s||[],m=Object(A.a)(g,2),h=m[0],y=m[1];return v.a.createElement(pe.a,{open:a&&!!h,onClose:p,action:v.a.createElement(L.a,{"aria-label":"close",color:"inherit",onClick:p},v.a.createElement(H.a,null))},v.a.createElement(ge.a,{onClose:p,severity:y||"warning"},h))})),he=n(1019),be=n.n(he),ve=n(1570),ye=Object(x.a)((function(e){return{viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(.5)},icon:{color:e.palette.secondary.contrastText},grow:{flexGrow:1},iconRoot:{"&:hover":{backgroundColor:Object(_.fade)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},listItemIconRoot:{minWidth:28},listItemInset:{paddingLeft:28},menuItemDense:{paddingLeft:e.spacing(1),paddingRight:26,paddingTop:0,paddingBottom:0},secondaryActionRoot:{right:e.spacing(1)},input:{paddingBottom:0,paddingTop:2},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),we=Object(P.observer)((function(e){var t=e.model,n=e.IconButtonProps,r=e.IconProps,a=Object(b.useState)(),i=Object(A.a)(a,2),o=i[0],c=i[1];return t.menuItems&&t.menuItems.length?v.a.createElement(v.a.Fragment,null,v.a.createElement(L.a,Object.assign({},n,{"aria-label":"more","aria-controls":"view-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},"data-testid":"view_menu_icon"}),v.a.createElement(be.a,r)),v.a.createElement(ce.a,{anchorEl:o,open:Boolean(o),onMenuItemClick:function(e,t){t(),c(void 0)},onClose:function(){c(void 0)},menuItems:t.menuItems})):null})),Oe=Object(ve.a)("bounds")(Object(P.observer)((function(e){var t=e.view,n=e.onClose,a=e.style,i=e.children,o=e.contentRect,c=e.measureRef,s=ye(),u=Object(G.a)().spacing(1),l=0;o.bounds&&(l=o.bounds.width),Object(b.useEffect)((function(){l&&Object(N.isAlive)(t)&&t.setWidth(l-2*u)}),[u,t,l]);var d=Object(b.useRef)(null);return Object(b.useEffect)((function(){var e;(null===d||void 0===d||null===(e=d.current)||void 0===e?void 0:e.scrollIntoView)&&d.current.scrollIntoView({block:"center"})}),[]),v.a.createElement(J.a,{elevation:12,ref:c,className:s.viewContainer,style:Object(r.a)(Object(r.a)({},a),{},{padding:"0px ".concat(u,"px ").concat(u,"px")})},v.a.createElement("div",{ref:d,style:{display:"flex"}},v.a.createElement(we,{model:t,IconButtonProps:{classes:{root:s.iconRoot},edge:"start"},IconProps:{className:s.icon}}),v.a.createElement("div",{className:s.grow}),v.a.createElement(T.a,{title:"Rename view",arrow:!0},v.a.createElement(fe,{value:t.displayName||(t.assemblyNames?t.assemblyNames.join(","):"Untitled view"),setValue:function(e){t.setDisplayName(e)},variant:"body2",classes:{input:s.input,inputBase:s.inputBase,inputRoot:s.inputRoot,inputFocused:s.inputFocused}})),v.a.createElement("div",{className:s.grow}),v.a.createElement(L.a,{"data-testid":"close_view",classes:{root:s.iconRoot},edge:"end",onClick:n},v.a.createElement(H.a,{className:s.icon}))),v.a.createElement(J.a,null,i))}))),je=Object(x.a)((function(e){return{"@global":{html:{"font-family":"Roboto"},"*":{"scrollbar-width":"auto","scrollbar-color":"rgba(0,0,0,.5) rgba(128,128,128)"},"*::-webkit-scrollbar":{"-webkit-appearance":"none",width:"12px"},"*::-webkit-scrollbar-thumb":{"background-color":"rgba(0,0,0,.5)","-webkit-box-shadow":"0 0 1px rgba(255,255,255,.5)"}},root:{display:"grid",height:"100vh",width:"100%"},fab:{float:"right",position:"sticky",marginTop:e.spacing(2),bottom:e.spacing(2),right:e.spacing(2)},menuBarAndComponents:{gridColumn:"main",display:"grid",gridTemplateRows:"[menubar] min-content [components] auto",height:"100vh"},menuBar:{gridRow:"menubar"},components:{overflowY:"auto",gridRow:"components"},appBar:{flexGrow:1},grow:{flexGrow:1},inputBase:{color:e.palette.primary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.primary.light}},inputFocused:{borderColor:e.palette.secondary.main,backgroundColor:e.palette.primary.light}}})),ke=Object(P.observer)((function(e){var t=e.session,n=e.HeaderButtons,r=je(),a=Object(N.getEnv)(t).pluginManager,i=t.visibleWidget,o=t.drawerWidth,c=t.minimized,s=t.activeWidgets,u=t.savedSessionNames,l=t.name,d=t.menus,f=t.views;return v.a.createElement("div",{className:r.root,style:{gridTemplateColumns:"[main] 1fr".concat(i&&!c?" [drawer] ".concat(o,"px"):"")}},t.DialogComponent?v.a.createElement(b.Suspense,{fallback:v.a.createElement("div",null)},v.a.createElement(t.DialogComponent,Object.assign({handleClose:function(){return t.setDialogComponent(void 0,void 0)}},t.DialogProps))):null,v.a.createElement("div",{className:r.menuBarAndComponents},v.a.createElement("div",{className:r.menuBar},v.a.createElement(C.a,{className:r.appBar,position:"static"},v.a.createElement(S.a,null,d.map((function(e){return v.a.createElement(ue,{key:e.label,menuTitle:e.label,menuItems:e.menuItems,session:t})})),v.a.createElement("div",{className:r.grow}),v.a.createElement(T.a,{title:"Rename Session",arrow:!0},v.a.createElement(fe,{value:l,setValue:function(e){u&&u.includes(e)?t.notify('Cannot rename session to "'.concat(e,'", a saved session with that name already exists'),"warning"):t.renameCurrentSession(e)},variant:"body1",classes:{inputBase:r.inputBase,inputRoot:r.inputRoot,inputFocused:r.inputFocused}})),n,v.a.createElement("div",{className:r.grow}),v.a.createElement("div",{style:{display:"none",width:150,maxHeight:48}},v.a.createElement(O,{variant:"white"}))))),v.a.createElement("div",{className:r.components},f.map((function(e){var n=a.getViewType(e.type);if(!n)throw new Error("unknown view type ".concat(e.type));var r=n.ReactComponent;return v.a.createElement(Oe,{key:"view-".concat(e.id),view:e,onClose:function(){return t.removeView(e)}},v.a.createElement(b.Suspense,{fallback:v.a.createElement("div",null,"Loading...")},v.a.createElement(r,{model:e,session:t,getTrackType:a.getTrackType})))})),v.a.createElement("div",{style:{height:300}}))),s.size>0&&c?v.a.createElement("div",{className:r.fab},v.a.createElement(E.a,{color:"primary",size:"small","aria-label":"show","data-testid":"drawer-maximize",style:{float:"right"},onClick:function(){t.showWidgetDrawer()}},v.a.createElement(M.a,null))):null,i&&!c?v.a.createElement(re,{session:t}):null,v.a.createElement(me,{session:t}))})),xe=n(690),Ce=n(102),Se=n(692);function Te(e){var t=e.width,n=e.height,a=e.highResolutionScaling,i=e.style,o=e.imageData,c=e.showSoftClip,s=Object(b.useRef)(null);Object(b.useEffect)((function(){if(o){var e=s.current;if(e){var t=e.getContext("2d");if(t)if(o.commands)o.commands.forEach((function(e){"strokeStyle"===e.type?t.strokeStyle=e.style:"fillStyle"===e.type?t.fillStyle=e.style:"font"===e.type?t.font=e.style:t[e.type].apply(t,Object(Ce.a)(e.args))}));else if(o instanceof Se.a)t.drawImage(o,0,0);else if(o.dataURL){var n=new Image;n.onload=function(){return t.drawImage(n,0,0)},n.src=o.dataURL}}}}),[o]);var u=c?"_softclipped":"";return v.a.createElement("canvas",{"data-testid":"prerendered_canvas".concat(u),ref:s,width:t*a,height:n*a,style:Object(r.a)({width:t,height:n},i)})}Te.defaultProps={imageData:void 0,highResolutionScaling:1,style:{}};var Ee=Te,Re=n(2370),Me=n(2373),Pe=n(2374),Ne=n(2375),Ae=n(2376),Fe=function(e){var t=e.onClose,n=e.open,r=e.onFactoryReset;function a(e){"reset"===e&&r(),t()}return v.a.createElement(Re.a,{open:n,onClose:function(){return a()}},v.a.createElement(Me.a,{id:"alert-dialog-title"},"Reset"),v.a.createElement(Pe.a,null,v.a.createElement(Ne.a,{id:"alert-dialog-description"},"Are you sure you want to reset? This will restore the default configuration.")),v.a.createElement(Ae.a,null,v.a.createElement(ae.a,{onClick:function(){return a()},color:"primary"},"Cancel"),v.a.createElement(ae.a,{onClick:function(){return a("reset")},color:"primary",variant:"contained"},"OK")))},Ie=n(81),Be=Object(x.a)({hoverLabel:{border:"1px solid black",position:"absolute",background:"#fffa",pointerEvents:"none",zIndex:1e4}}),De=Object(P.observer)((function(e){var t=e.offsetX,n=e.offsetY,r=e.configuration,a=e.feature,i=e.timeout,o=void 0===i?300:i,c=Be(),s=Object(b.useState)(!1),u=Object(A.a)(s,2),l=u[0],d=u[1];if(Object(b.useEffect)((function(){var e=setTimeout((function(){return d(!0)}),o);return function(){return clearTimeout(e)}})),a&&l){var f=Object(Ie.readConfObject)(r,"mouseover",{feature:a});return v.a.createElement("div",{className:c.hoverLabel,style:{left:t,top:n}},f)}return null})),Le=function(e){var t=e.onFactoryReset,n=e.resetButtonText,r=Object(b.useState)(!1),a=Object(A.a)(r,2),i=a[0],o=a[1];return v.a.createElement(v.a.Fragment,null,v.a.createElement(ae.a,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:function(){return o(!0)}},n),v.a.createElement(Fe,{onClose:function(){return o(!1)},open:i,onFactoryReset:t}))},Ve=function(e){var t=e.componentStack,n=e.error,r=e.onFactoryReset,a=e.resetButtonText;return v.a.createElement(Re.a,{open:!0},v.a.createElement(Me.a,{style:{backgroundColor:"#e88"}},"Fatal error"),v.a.createElement(Pe.a,null,v.a.createElement("pre",null,n.toString(),t)),v.a.createElement(Ae.a,null,v.a.createElement(ae.a,{color:"secondary",variant:"contained",onClick:function(){return window.location.reload()}},"Refresh"),v.a.createElement(Le,{onFactoryReset:r,resetButtonText:a})))};Ve.defaultProps={error:{message:"No error message provided"},componentStack:"",resetButtonText:"Factory Reset"};var We=Ve,ze=n(521)},1268:function(e,t,n){"use strict";n.d(t,"b",(function(){return D})),n.d(t,"a",(function(){return B.a}));var r=n(89),a=n(92),i=n(94),o=n(95),c=n(1),s=n(81),u=n(185),l=n(223),d=n(153),f=n(252),p=n(253),g=n(133),m=n(140),h=n(852),b=n(90),v=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r=t("@jbrowse/core/configuration"),a=r.ConfigurationSchema,i=r.ConfigurationReference,o=t("@jbrowse/core/util").getContainingView,c=t("@jbrowse/core/util/tracks").getParentRenderProps,s=a("ChordVariantDisplay",{renderer:n.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:h.c,explicitlyTyped:!0});return{stateModel:n.compose("ChordVariantDisplay",h.b,n.model({type:n.literal("ChordVariantDisplay"),configuration:i(s)})).views((function(e){return{get rendererTypeName(){return e.configuration.renderer.type},get renderProps(){var t=o(e);return Object(b.a)(Object(b.a)({},c(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,config:e.configuration.renderer,onChordClick:e.onChordClick})}}})),configSchema:s}},y=function(e){var t=e.lib,n=e.load,r=t["@jbrowse/core/pluggableElementTypes/DisplayType"],a=n(v),i=a.stateModel;return new r({name:"ChordVariantDisplay",configSchema:a.configSchema,stateModel:i,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:Object(h.a)(e)})};var w=n(88),O=n.n(w),j=n(91),k=n(119),x=n(83),C=n(87),S=function(e){return C.types.compose("LinearVariantDisplay",Object(m.f)(e),C.types.model({type:C.types.literal("LinearVariantDisplay"),configuration:Object(s.ConfigurationReference)(e)})).actions((function(e){return{selectFeature:function(t){return Object(j.a)(O.a.mark((function n(){var r,a,i,o,c,u,l;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object(x.getSession)(e),!Object(x.isSessionModelWithWidgets)(r)){n.next=11;break}return a=r.rpcManager,i=Object(k.getRpcSessionId)(e),o=Object(x.getContainingTrack)(e),c=Object(s.getConf)(o,"adapter"),n.next=8,a.call(i,"CoreGetMetadata",{adapterConfig:c});case 8:u=n.sent,l=r.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:Object(x.getContainingView)(e),descriptions:u}),r.showWidget(l);case 11:r.setSelection(t);case 12:case"end":return n.stop()}}),n)})))()}}}))},T=n(106),E=n(102),R=n(82),M=function(e){var t=e.jbrequire,n=t("react"),r=t("react").useMemo,a=t("mobx-react"),i=a.observer,o=(a.PropTypes,t("@jbrowse/core/util").polarToCartesian),c=t("@jbrowse/core/configuration").readConfObject;t("@jbrowse/core/util/types/mst").PropTypes,t("prop-types");function s(e,t){var n=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-n)/e.bpPerRadian+e.startRadians}var u=i((function(e){var t,r,a,i=e.feature,u=e.blocksForRefs,l=e.radius,d=e.config,f=e.bezierRadius,p=e.selected,g=e.onClick,m=u[i.get("refName")];if(!m)return null;if(i.get("INFO")){var h=i.get("INFO").SVTYPE||[];t=Object(R.a)(h,1)[0]}else i.get("mate")&&(t="mate");if("BND"===t){var b=(i.get("ALT")||[])[0].MatePosition.split(":");r=parseInt(b[1],10),a=u[b[0]]}else if("TRA"===t){var v=((i.get("INFO")||{}).CHR2||[])[0],y=((i.get("INFO")||{}).END||[])[0];r=parseInt(y,10),a=u[v]}else if("mate"===t){var w=i.get("mate"),O=w.refName;r=w.start,a=u[O]}if(a){var j,k=i.get("start"),x=s(m,k),C=s(a,r),S=o(l,x),T=o(l,C),M=o(f,(C+x)/2);j=c(d,p?"strokeColorSelected":"strokeColor",{feature:i});var P=c(d,"strokeColorHover",{feature:i});return n.createElement("path",{"data-testid":"chord-".concat(i.id()),d:["M"].concat(Object(E.a)(S),["Q"],Object(E.a)(M),Object(E.a)(T)).join(" "),style:{stroke:j},onClick:function(e){return g(i,m.region,a.region,e)},onMouseOver:function(e){p||(e.target.style.stroke=P)},onMouseOut:function(e){p||(e.target.style.stroke=j)}})}return null}));function l(e){var t,a=e.features,i=e.config,o=e.displayModel,c=e.blockDefinitions,s=e.radius,l=e.bezierRadius,d=e.displayModel.selectedFeatureId,f=e.onChordClick,p=r((function(){var e={};return c.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(n){e[n.refName]=t}))})),e}),[c]),g=[],m=Object(T.a)(a);try{for(m.s();!(t=m.n()).done;){var h=Object(R.a)(t.value,2),b=h[0],v=h[1],y=String(d)===String(v.id());g.push(n.createElement(u,{key:b,feature:v,config:i,displayModel:o,radius:s,bezierRadius:l,blocksForRefs:p,selected:y,onClick:f}))}}catch(O){m.e(O)}finally{m.f()}var w="chords-".concat(o.id);return n.createElement("g",{id:w,"data-testid":"structuralVariantChordRenderer"},n.createElement("style",{dangerouslySetInnerHTML:{__html:"\n          #".concat(w," > path {\n            cursor: crosshair;\n            fill: none;\n          }\n")}}),g)}return l.defaultProps={displayModel:void 0,selectedFeatureId:"",onChordClick:void 0},i(l)},P=function(e){var t=e.jbrequire,n=t("@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType"),r=t("@jbrowse/core/configuration").ConfigurationSchema;return new n({name:"StructuralVariantChordRenderer",ReactComponent:t(M),configSchema:r("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0}),pluginManager:e})},N=n(114),A=Object(s.ConfigurationSchema)("VariantFeatureWidget",{});function F(e){return C.types.model("VariantFeatureWidget",{id:N.ElementId,type:C.types.literal("VariantFeatureWidget"),view:C.types.safeReference(e.pluggableMstType("view","stateModel")),featureData:C.types.frozen(),descriptions:C.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var I=Object(s.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz"}},index:Object(s.ConfigurationSchema)("VcfIndex",{indexType:{model:C.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi"}}})},{explicitlyTyped:!0}),B=n(732),D=function(e){Object(i.a)(g,e);var t=Object(o.a)(g);function g(){var e;Object(r.a)(this,g);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="VariantsPlugin",e}return Object(a.a)(g,[{key:"install",value:function(e){e.addAdapterType((function(){return new u.a({name:"VcfTabixAdapter",configSchema:I,getAdapterClass:function(){return Promise.all([n.e(0),n.e(2),n.e(4),n.e(24)]).then(n.bind(null,2430)).then((function(e){return e.default}))}})})),e.addRendererType((function(){return e.jbrequire(P)})),e.addTrackType((function(){var t=Object(s.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:Object(d.createBaseTrackConfig)(e)});return new f.a({name:"VariantTrack",configSchema:t,stateModel:Object(d.createBaseTrackModel)(e,"VariantTrack",t)})})),e.addDisplayType((function(){return e.jbrequire(y)})),e.addDisplayType((function(){var t=function(e){var t=Object(m.e)(e);return Object(s.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:t,explicitlyTyped:!0})}(e);return new l.a({name:"LinearVariantDisplay",configSchema:t,stateModel:S(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:m.b})})),e.addWidgetType((function(){return new p.a({name:"VariantFeatureWidget",heading:"Feature details",configSchema:A,stateModel:F(e),ReactComponent:Object(c.lazy)((function(){return n.e(71).then(n.bind(null,2457))}))})}))}}]),g}(g.a)},1269:function(e,t,n){"use strict";n.r(t);var r=n(88),a=n.n(r),i=n(91),o=n(82),c=n(1),s=n.n(c),u=n(84),l=n(87),d=n(51),f=n(2338),p=n(2337),g=n(2347),m=n(2387),h=n(2342),b=n(2339),v=n(2341),y=n(1004),w=n.n(y),O=n(439),j=n.n(O),k=n(1715),x=n.n(k),C=n(83),S=n(2334),T=n(2336),E=n(2370),R=n(2373),M=n(2344),P=n(134),N=n.n(P),A=n(1713),F=n.n(A),I=n(312),B=Object(d.a)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15}}}));function D(){return s.a.createElement(M.a,{style:{marginRight:"0.5rem"},title:"This plugin was installed by an admin. It cannot be removed."},s.a.createElement(F.a,null))}var L=Object(u.observer)((function(e){var t=e.plugin,n=e.model,r=B(),a=Object(c.useState)(!1),i=Object(o.a)(a,2),u=i[0],d=i[1],g=Object(C.getSession)(n),m=Object(l.getSnapshot)(g).sessionPlugins,b=null===m||void 0===m?void 0:m.some((function(e){return"".concat(e.name,"Plugin")===t.name})),v=Object(l.getParent)(n,3),y=v.jbrowse,w=v.adminMode;return s.a.createElement(s.a.Fragment,null,s.a.createElement(T.a,{key:t.name},w||b?s.a.createElement(h.a,{"aria-label":"removePlugin","data-testid":"removePlugin-".concat(t.name),onClick:function(){return d(!0)}},s.a.createElement(N.a,null)):s.a.createElement(D,null),s.a.createElement(f.a,null,t.name)),s.a.createElement(E.a,{open:u,onClose:function(){return d(!1)}},s.a.createElement(R.a,null,s.a.createElement(h.a,{className:r.closeDialog,"aria-label":"close-dialog",onClick:function(){return d(!1)}},s.a.createElement(N.a,null))),s.a.createElement("div",{className:r.dialogContainer},s.a.createElement(s.a.Fragment,null,s.a.createElement(f.a,null,"Please confirm that you want to remove ",t.name,":"),s.a.createElement("br",null),s.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},s.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){d(!1),window.setTimeout((function(){w?y.removePlugin(t.name):Object(I.isSessionWithSessionPlugins)(g)&&g.removeSessionPlugin(t.name)}),500)}},"Confirm"))))))}));var V=Object(u.observer)((function(e){var t=e.pluginManager,n=e.model,r=t.plugins,a=r.filter((function(e){var n;return null===(n=t.pluginMetadata[e.name])||void 0===n?void 0:n.isCore})).map((function(e){return e.name})),i=r.filter((function(e){return!a.includes(e.name)}));return s.a.createElement(S.a,null,i.length?i.filter((function(e){return e.name.toLowerCase().includes(n.filterText.toLowerCase())})).map((function(e){return s.a.createElement(L,{key:e.name,plugin:e,model:n})})):s.a.createElement(f.a,null,"No plugins currently installed"))})),W=n(2389),z=n(2378),H=n(2379),q=n(2380),U=n(1714),_=n.n(U),G=n(288),J=n.n(G),X=n(1083),Y=n.n(X),Q=Object(d.a)((function(){return{card:{margin:"1em"},icon:{marginLeft:"0.5em",marginRight:"0.5em"},bold:{fontWeight:600},dataField:{display:"flex",alignItems:"center",margin:"0.4em 0em"}}}));var $=Object(u.observer)((function(e){var t=e.plugin,n=e.model,r=e.adminMode,a=Q(),i=Object(C.getSession)(n),u=Object(l.getEnv)(n).pluginManager.hasPlugin("".concat(t.name,"Plugin")),d=Object(c.useState)(!1),g=Object(o.a)(d,2),m=g[0],h=g[1],b=u||m,v=Object(l.getParent)(n,3).jbrowse;return s.a.createElement(z.a,{variant:"outlined",key:t.name,className:a.card},s.a.createElement(q.a,null,s.a.createElement("div",{className:a.dataField},s.a.createElement(f.a,{variant:"h5"},s.a.createElement(W.a,{href:"".concat(t.location,"#readme"),target:"_blank",rel:"noopener"},t.name))),s.a.createElement("div",{className:a.dataField},s.a.createElement(_.a,{style:{marginRight:"0.5em"}}),s.a.createElement(f.a,null,t.authors.join(", "))),s.a.createElement(f.a,{className:a.bold},"Description:"),s.a.createElement(f.a,null,t.description)),s.a.createElement(H.a,null,s.a.createElement(p.a,{variant:"contained",color:"primary",disabled:b,startIcon:u?s.a.createElement(Y.a,null):s.a.createElement(J.a,null),onClick:function(){r?v.addPlugin({name:t.name,url:t.url}):Object(I.isSessionWithSessionPlugins)(i)&&i.addSessionPlugin(t),h(!0)}},u?"Installed":"Install")))})),K=n(411),Z=n(90),ee=Object(d.a)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15,display:"flex",flexDirection:"column"}}}));var te=Object(u.observer)((function(e){var t=e.open,n=e.onClose,r=e.model,a=ee(),i=Object(c.useState)({name:"",url:""}),u=Object(o.a)(i,2),d=u[0],f=u[1],m=function(e){f(Object(Z.a)(Object(Z.a)({},d),{},Object(K.a)({},e.target.name,e.target.value)))},b=Object(l.getRoot)(r).jbrowse;return s.a.createElement(E.a,{open:t,onClose:function(){return n(!1)}},s.a.createElement(R.a,null,s.a.createElement(h.a,{className:a.closeDialog,"aria-label":"close-dialog",onClick:function(){return n(!1)}},s.a.createElement(N.a,null))),s.a.createElement("div",{className:a.dialogContainer},s.a.createElement(g.a,{id:"name-input",name:"name",label:"Plugin name",variant:"outlined",value:d.name,onChange:m,multiline:!0}),s.a.createElement(g.a,{id:"url-input",name:"url",label:"Plugin URL",variant:"outlined",value:d.url,onChange:m,multiline:!0}),s.a.createElement(p.a,{variant:"contained",color:"primary",style:{marginTop:"1.5rem"},onClick:function(){b.addPlugin({name:d.name,url:d.url})}},"Add plugin")))})),ne=Object(d.a)((function(e){return{accordion:{marginTop:"1em"},expandIcon:{color:"#fff"},searchBox:{marginBottom:e.spacing(2)},adminBadge:{margin:"0.5em",borderRadius:3,backgroundColor:"#FFB11D",padding:"1em",display:"flex",alignContent:"center"},customPluginButton:{margin:"0.5em",display:"flex",justifyContent:"center"}}}));t.default=Object(u.observer)((function(e){var t=e.model,n=ne(),r=Object(c.useState)([]),u=Object(o.a)(r,2),d=u[0],y=u[1],O=Object(c.useState)(!1),k=Object(o.a)(O,2),S=k[0],T=k[1],E=Object(C.getSession)(t).adminMode,R=Object(l.getEnv)(t).pluginManager;return Object(c.useEffect)((function(){var e=!1;return Object(i.a)(a.a.mark((function t(){var n,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://jbrowse.org/plugin-store/plugins.json");case 2:if((n=t.sent).ok){t.next=5;break}throw new Error("Failed to fetch plugin data");case 5:return t.next=7,n.json();case 7:r=t.sent,e||y(r.plugins);case 9:case"end":return t.stop()}}),t)})))(),function(){e=!0}}),[]),s.a.createElement("div",null,E&&s.a.createElement(s.a.Fragment,null,!C.isElectron&&s.a.createElement("div",{className:n.adminBadge},s.a.createElement(x.a,{style:{marginRight:"0.3em"}}),s.a.createElement(f.a,null,"You are using the ",s.a.createElement("code",null,"admin-server"),". Any changes you make will be saved to your configuration file. You also have the ability to add custom plugins that are not in the store.")),s.a.createElement("div",{className:n.customPluginButton},s.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){return T(!0)}},"Add custom plugin")),s.a.createElement(te,{open:S,onClose:T,model:t})),s.a.createElement(g.a,{className:n.searchBox,label:"Filter plugins",value:t.filterText,onChange:function(e){return t.setFilterText(e.target.value)},fullWidth:!0,InputProps:{endAdornment:s.a.createElement(m.a,{position:"end"},s.a.createElement(h.a,{color:"secondary",onClick:function(){return t.clearFilterText()}},s.a.createElement(j.a,null)))}}),s.a.createElement(b.a,{defaultExpanded:!0},s.a.createElement(v.a,{expandIcon:s.a.createElement(w.a,{className:n.expandIcon})},s.a.createElement(f.a,{variant:"h5"},"Installed plugins")),s.a.createElement("div",{style:{margin:"1em"}},s.a.createElement(V,{pluginManager:R,model:t}))),s.a.createElement(b.a,{defaultExpanded:!0},s.a.createElement(v.a,{expandIcon:s.a.createElement(w.a,{className:n.expandIcon})},s.a.createElement(f.a,{variant:"h5"},"Available plugins")),d.filter((function(e){return e.name.toLowerCase().includes(t.filterText.toLowerCase())})).map((function(e){return s.a.createElement($,{key:e.name,plugin:e,model:t,adminMode:!!E})}))))}))},1270:function(e,t,n){"use strict";var r={};n.r(r),n.d(r,"red",(function(){return be.a})),n.d(r,"pink",(function(){return ye.a})),n.d(r,"purple",(function(){return Oe.a})),n.d(r,"deepPurple",(function(){return ke.a})),n.d(r,"indigo",(function(){return Ce.a})),n.d(r,"blue",(function(){return Te.a})),n.d(r,"lightBlue",(function(){return Re.a})),n.d(r,"cyan",(function(){return Pe.a})),n.d(r,"teal",(function(){return Ae.a})),n.d(r,"green",(function(){return Ie.a})),n.d(r,"lightGreen",(function(){return De.a})),n.d(r,"lime",(function(){return Ve.a})),n.d(r,"yellow",(function(){return ze.a})),n.d(r,"amber",(function(){return qe.a})),n.d(r,"orange",(function(){return _e.a})),n.d(r,"deepOrange",(function(){return Je.a})),n.d(r,"brown",(function(){return Ye.a})),n.d(r,"grey",(function(){return $e.a})),n.d(r,"blueGrey",(function(){return Ze.a}));var a=n(1),i=n.n(a),o=n(31),c=n(112),s=n(87),u=n(84),l=n(11),d=n.n(l),f=n(65),p=n(99),g=n(110),m=n(2326),h=n(1265),b=n(685),v=n(851),y=n(2337),w=n(2377),O=n(2378),j=n(2380),k=n(2445),x=n(2383),C=n(2370),S=n(2349),T=n(1008),E=n(2353),R=n(2385),M=n(2368),P=n(2386),N=n(2342),A=n(2387),F=n(2388),I=n(2355),B=n(2364),D=n(1558),L=n(2335),V=n(2446),W=n(1053),z=n(2460),H=n(2365),q=n(2366),U=n(2347),_=n(2344),G=n(2338),J=n(2369),X=n(2463),Y=n(136),Q=n(475),$=n(426),K=n(309),Z=n(185),ee=n(223),te=n(252),ne=n(253),re=n(153),ae=n(476),ie=n(1021),oe=n(474),ce=n(81),se=n(133),ue=n(123),le=n(83),de=n(336),fe=n(119),pe=n(139),ge=n(345),me=n(147),he=n(1033),be=n.n(he),ve=n(1034),ye=n.n(ve),we=n(1035),Oe=n.n(we),je=n(1036),ke=n.n(je),xe=n(1037),Ce=n.n(xe),Se=n(1038),Te=n.n(Se),Ee=n(1039),Re=n.n(Ee),Me=n(1040),Pe=n.n(Me),Ne=n(1041),Ae=n.n(Ne),Fe=n(1042),Ie=n.n(Fe),Be=n(1043),De=n.n(Be),Le=n(1044),Ve=n.n(Le),We=n(1045),ze=n.n(We),He=n(1046),qe=n.n(He),Ue=n(1047),_e=n.n(Ue),Ge=n(1048),Je=n.n(Ge),Xe=n(1049),Ye=n.n(Xe),Qe=n(1050),$e=n.n(Qe),Ke=n(1051),Ze=n.n(Ke),et=n(114),tt={mobx:c,"mobx-state-tree":s,react:i.a,"react-dom":o,"mobx-react":u,"prop-types":d.a,"@material-ui/core":p,"@material-ui/core/SvgIcon":m.a,"@material-ui/core/utils":g,"@material-ui/lab":h,"@material-ui/data-grid":b,"@material-ui/core/colors":r,"@material-ui/core/styles":f,"@material-ui/core/Box":v.a,"@material-ui/core/Button":y.a,"@material-ui/core/ButtonGroup":w.a,"@material-ui/core/Card":O.a,"@material-ui/core/CardContent":j.a,"@material-ui/core/Container":x.a,"@material-ui/core/Checkbox":k.a,"@material-ui/core/Dialog":C.a,"@material-ui/core/FormGroup":R.a,"@material-ui/core/FormLabel":S.a,"@material-ui/core/FormControl":T.a,"@material-ui/core/FormControlLabel":E.a,"@material-ui/core/Grid":M.a,"@material-ui/core/Icon":P.a,"@material-ui/core/IconButton":N.a,"@material-ui/core/InputAdornment":A.a,"@material-ui/core/LinearProgress":F.a,"@material-ui/core/ListItemIcon":I.a,"@material-ui/core/ListItemText":B.a,"@material-ui/core/Menu":D.a,"@material-ui/core/MenuItem":L.a,"@material-ui/core/RadioGroup":W.a,"@material-ui/core/Radio":V.a,"@material-ui/core/Select":z.a,"@material-ui/core/Snackbar":H.a,"@material-ui/core/SnackbarContent":q.a,"@material-ui/core/TextField":U.a,"@material-ui/core/Tooltip":_.a,"@material-ui/core/Typography":G.a,"@material-ui/lab/ToggleButton":J.a,"@material-ui/lab/ToggleButtonGroup":X.a,"@jbrowse/core/Plugin":se.a,"@jbrowse/core/pluggableElementTypes/ViewType":K.a,"@jbrowse/core/pluggableElementTypes/AdapterType":Z.a,"@jbrowse/core/pluggableElementTypes/DisplayType":ee.a,"@jbrowse/core/pluggableElementTypes/TrackType":te.a,"@jbrowse/core/pluggableElementTypes/WidgetType":ne.a,"@jbrowse/core/pluggableElementTypes/models":re,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":ae.a,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":ie.a,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":oe.b,"@jbrowse/core/configuration":ce,"@jbrowse/core/util/types/mst":et,"@jbrowse/core/ui":ue,"@jbrowse/core/util":le,"@jbrowse/core/util/color":de,"@jbrowse/core/util/tracks":fe,"@jbrowse/core/util/Base1DViewModel":$.a,"@jbrowse/core/util/io":pe,"@jbrowse/core/util/mst-reflection":ge,"@jbrowse/core/util/rxjs":me,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":Q,"@jbrowse/core/data_adapters/BaseAdapter":Y};["mobx","mobx-state-tree","react","react-dom","mobx-react","prop-types","@material-ui/core","@material-ui/core/SvgIcon","@material-ui/core/utils","@material-ui/lab","@material-ui/data-grid","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"].forEach((function(e){if(!(e in tt))throw new Error("ReExports/modules is missing ".concat(e))}));var nt=tt;t.a=nt},133:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(89),a=n(92),i=function(){function e(){Object(r.a)(this,e),this.name=void 0,this.url=void 0,this.version=void 0,this.configurationSchema=void 0}return Object(a.a)(e,[{key:"install",value:function(e){}},{key:"configure",value:function(e){}}]),e}()},136:function(e,t,n){"use strict";n.r(t),n.d(t,"BaseAdapter",(function(){return y})),n.d(t,"BaseFeatureDataAdapter",(function(){return w})),n.d(t,"isSequenceAdapter",(function(){return O})),n.d(t,"isRegionsAdapter",(function(){return j})),n.d(t,"isFeatureAdapter",(function(){return k})),n.d(t,"isRefNameAliasAdapter",(function(){return x}));var r=n(102),a=n(88),i=n.n(a),o=n(91),c=n(92),s=n(94),u=n(95),l=n(89),d=n(679),f=n(991),p=n(87),g=n(147),m=n(83),h=n(335),b=n(995);function v(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Object.keys(e),r=0;r<n.length;r++){var a=n[r];if(t.length>5e3)break;"object"===typeof e[a]&&e[a]?t+=v(e[a],t):t+="".concat(a,"-").concat(e[a],";")}return Object(m.hashCode)(t)}var y=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(h.b)("empty",{}).create(),n=arguments.length>1?arguments[1]:void 0;if(Object(l.a)(this,e),this.id=void 0,this.config=void 0,this.getSubAdapter=void 0,this.config=t,this.getSubAdapter=n,"undefined"===typeof jest){var r=Object(p.isStateTreeNode)(t)?Object(p.getSnapshot)(t):t;this.id="".concat(v(r))}else this.id="test"};y.capabilities=[];var w=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"getHeader",value:function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeaturesInRegion",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(g.ObservableCreate)(function(){var r=Object(o.a)(i.a.mark((function r(a){var o;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.hasDataForRefName(e.refName,n);case 2:o=r.sent,Object(m.checkAbortSignal)(n.signal),o?t.getFeatures(e,n).pipe(Object(f.a)(Object(m.observeAbortSignal)(n.signal))).subscribe(a):a.complete();case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"getFeaturesInMultipleRegions",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=d.a.apply(void 0,Object(r.a)(e.map((function(e){return Object(g.ObservableCreate)(function(){var r=Object(o.a)(i.a.mark((function r(a){var o;return i.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.hasDataForRefName(e.refName,n);case 2:o=r.sent,Object(m.checkAbortSignal)(n.signal),o?t.getFeatures(e,n).subscribe(a):a.complete();case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}))));return n.signal?a.pipe(Object(f.a)(Object(m.observeAbortSignal)(n.signal))):a}},{key:"hasDataForRefName",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:return r=e.sent,e.abrupt("return",r.includes(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRegionStats",value:function(){var e=Object(o.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getFeatures(t,n),e.abrupt("return",Object(b.c)(t,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMultiRegionStats",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,n,r,a,o,c,s,u,l,d=this,f=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:[],n=f.length>1?f[1]:void 0,t.length){e.next=4;break}return e.abrupt("return",Object(b.a)());case 4:return e.next=6,Promise.all(t.map((function(e){return d.getRegionStats(e,n)})));case 6:return r=e.sent,a=r.map((function(e){return e.scoreMax})).reduce((function(e,t){return Math.max(e,t)})),o=r.map((function(e){return e.scoreMin})).reduce((function(e,t){return Math.min(e,t)})),c=r.map((function(e){return e.scoreSum})).reduce((function(e,t){return e+t}),0),s=r.map((function(e){return e.scoreSumSquares})).reduce((function(e,t){return e+t}),0),u=r.map((function(e){return e.featureCount})).reduce((function(e,t){return e+t}),0),l=r.map((function(e){return e.basesCovered})).reduce((function(e,t){return e+t}),0),e.abrupt("return",Object(b.b)({scoreMin:o,scoreMax:a,featureCount:u,basesCovered:l,scoreSumSquares:s,scoreSum:c}));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(y);function O(e){return"getRegions"in e&&"getFeatures"in e}function j(e){return"getRegions"in e}function k(e){return"getFeatures"in e}function x(e){return"getRefNameAliases"in e}},139:function(e,t,n){"use strict";n.r(t),n.d(t,"openUrl",(function(){return O})),n.d(t,"openLocation",(function(){return x}));var r=n(357),a=n(1027),i=n(1590),o=n(88),c=n.n(o),s=n(82),u=n(106),l=n(91),d=n(90),f=n(1592),p=n(109);function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,Object(d.a)({method:"GET",credentials:"same-origin"},t))}function m(){return(m=Object(l.a)(c.a.mark((function e(t,n,r){var a,i,o,l,f,m,h,b,v,y,w,O,j=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=j.length>3&&void 0!==j[3]?j[3]:{},i=new Date,o=Object(d.a)(Object(d.a)({},a.headers),{},{range:"bytes=".concat(n,"-").concat(r)}),e.next=5,g(t,Object(d.a)(Object(d.a)({},a),{},{headers:o}));case 5:if(l=e.sent,f=new Date,206===l.status||200===l.status){e.next=9;break}throw new Error("HTTP ".concat(l.status," when fetching ").concat(t," bytes ").concat(n,"-").concat(r));case 9:m={},h=Object(u.a)(l.headers.entries());try{for(h.s();!(b=h.n()).done;)v=Object(s.a)(b.value,2),y=v[0],w=v[1],m[y]=w}catch(c){h.e(c)}finally{h.f()}if(200!==l.status){e.next=14;break}throw new Error("HTTP ".concat(l.status," when fetching ").concat(t," bytes ").concat(n,"-").concat(r));case 14:return e.next=16,l.arrayBuffer();case 16:return O=e.sent,e.abrupt("return",{headers:m,requestDate:i,responseDate:f,buffer:p.Buffer.from(O)});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=new f.HttpRangeFetcher({fetch:function(e,t,n){return m.apply(this,arguments)},size:524288e3,chunkSize:Math.pow(2,17),maxFetchSize:104857600,minimumTTL:3e8});function b(e,t){return v.apply(this,arguments)}function v(){return(v=Object(l.a)(c.a.mark((function e(t,n){var r,a,i,o,u,l,d,f,p,m,b,v;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=n&&n.headers)&&(r instanceof Headers?a=r.get("range"):Array.isArray(r)?(i=r.find((function(e){return"range"===Object(s.a)(e,1)[0]}))||[void 0,void 0],o=Object(s.a)(i,2),a=o[1]):a=r.range),!a){e.next=13;break}if(!(u=/bytes=(\d+)-(\d+)/.exec(a))){e.next=13;break}return l=Object(s.a)(u,3),d=l[1],f=l[2],p=parseInt(d,10),m=parseInt(f,10),e.next=10,h.getRange(t,p,m-p+1,{signal:n&&n.signal});case 10:return b=e.sent,v=b.headers,e.abrupt("return",new Response(b.buffer,{status:206,headers:v}));case 13:return e.abrupt("return",g(t,n));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=n(119),w=/electron/i.test("undefined"!==typeof navigator?navigator.userAgent:""),O=function(e){return w?new i.a(e):(t=e,new r.RemoteFile(String(t),{fetch:b}));var t};function j(e){return"uri"in e}function k(e){return"localPath"in e}function x(e){if(!e)throw new Error("must provide a location to openLocation");if(w){if(j(e))return new i.a(e.uri);if(k(e))return new a.a(e.localPath)}else{if(j(e))return O(e.baseUri?new URL(e.uri,e.baseUri).href:e.uri);if(k(e))return new r.LocalFile(e.localPath)}if(function(e){return"blobId"in e}(e)){var t=Object(y.getBlob)(e.blobId);if(!t)throw new Error('file ("'.concat(e.name,'") was opened locally from a previous session. To restore it, go to track settings and reopen the file'));return new r.BlobFile(t)}throw new Error("invalid fileLocation")}},140:function(e,t,n){"use strict";n.d(t,"d",(function(){return ye})),n.d(t,"b",(function(){return Q})),n.d(t,"a",(function(){return le})),n.d(t,"c",(function(){return v})),n.d(t,"e",(function(){return ve})),n.d(t,"f",(function(){return be}));var r=n(89),a=n(92),i=n(94),o=n(95),c=n(1),s=n.n(c),u=n(81),l=n(153),d=n(252),f=n(223),p=n(309),g=n(133),m=n(83),h=n(1643),b=n.n(h),v=Object(u.ConfigurationSchema)("BaseLinearDisplay",{maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:Number.MAX_VALUE}},{explicitIdentifier:"displayId"}),y=n(154),w=n(88),O=n.n(w),j=n(91),k=n(90),x=n(102),C=n(82),S=n(106),T=n(1058),E=n(142),R=n(119),M=n(2337),P=n(2338),N=n(697),A=n.n(N),F=n(112),I=n(87),B=n(1630),D=n.n(B),L=n(123),V=n(51),W=n(160),z=n(84),H=n(2344),q=n(355),U=n(696),_=Object(V.a)({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),G=Object(z.observer)((function(e){var t=e.model,n=_(),r=t.blockDefinitions,a=t.blockState;return s.a.createElement(s.a.Fragment,null,r.map((function(e){if(e instanceof q.b){var r=a.get(e.key);return s.a.createElement(U.a,{block:e,key:"".concat(t.id,"-").concat(e.key)},r&&r.ReactComponent?s.a.createElement(r.ReactComponent,{model:r}):null,r&&r.maxHeightReached?s.a.createElement("div",{className:n.heightOverflowed,style:{top:r.layout.getTotalHeight()-16,pointerEvents:"none",height:16}},"Max height reached"):null)}if(e instanceof q.c)return s.a.createElement(U.b,{key:"".concat(t.id,"-").concat(e.key),width:e.widthPx});if(e instanceof q.d)return s.a.createElement(U.c,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant});throw new Error("invalid block type ".concat(typeof e))})))}));var J=Object(z.observer)((function(e){var t=e.model,n=_(),r=t.blockDefinitions,a=Object(m.getContainingView)(t);return s.a.createElement("div",{"data-testid":"Blockset",className:n.linearBlocks,style:{left:r.offsetPx-a.offsetPx}},s.a.createElement(G,{model:t}))})),X=Object(V.a)({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),Y=Object(z.observer)((function(e){var t=e.model,n=e.mouseCoord,r=t.featureUnderMouse,a=r?Object(u.getConf)(t,"mouseover",{feature:r}):void 0;return a?s.a.createElement(H.a,{title:a,open:!0,placement:"right"},s.a.createElement("div",{style:{position:"absolute",left:n[0],top:n[1]}}," ")):null})),Q=Object(z.observer)((function(e){var t=X(),n=Object(W.a)(),r=Object(c.useState)([0,0]),a=Object(C.a)(r,2),i=a[0],o=a[1],l=Object(c.useState)(),d=Object(C.a)(l,2),f=d[0],p=d[1],g=Object(c.useRef)(null),m=e.model,h=e.children,b=m.TooltipComponent,v=m.DisplayMessageComponent,y=m.contextMenuItems,w=m.height,O=m.setContextMenuFeature;return s.a.createElement("div",{ref:g,"data-testid":"display-".concat(Object(u.getConf)(m,"displayId")),className:t.display,onContextMenu:function(e){e.preventDefault(),f?p(void 0):g.current&&p([e.clientX,e.clientY])},onMouseMove:function(e){if(g.current){var t=g.current.getBoundingClientRect();o([e.clientX-t.left,e.clientY-t.top])}},role:"presentation"},v?s.a.createElement(v,{model:m}):s.a.createElement(J,e),h,s.a.createElement(b,{model:m,height:w,mouseCoord:i}),s.a.createElement(L.Menu,{open:Boolean(f)&&Boolean(y.length),onMenuItemClick:function(e,t){t(),p(void 0)},onClose:function(){p(void 0),O(void 0)},onExit:function(){p(void 0),O(void 0)},anchorReference:"anchorPosition",anchorPosition:f?{top:f[1],left:f[0]}:void 0,style:{zIndex:n.zIndex.tooltip},menuItems:y,"data-testid":"base_linear_display_context_menu"}))})),$=n(114),K=n(1631),Z=n.n(K),ee=Object(V.a)((function(e){return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.action.disabledBackground,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"},blockMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),pointerEvents:"none",textAlign:"center"},blockError:{padding:e.spacing(2),width:"100%",whiteSpace:"normal",color:e.palette.error.main,overflowY:"auto"},blockReactNodeMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),textAlign:"center"},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}}}));function te(e){var t=e.children;return s.a.createElement("div",{style:{display:"flex"}},t,t)}var ne=Object(z.observer)((function(e){var t=e.model,n=Object(c.useState)(!1),r=Object(C.a)(n,2),a=r[0],i=r[1],o=ee();Object(c.useEffect)((function(){var e=!1,t=setTimeout((function(){e||i(!0)}),300);return function(){clearTimeout(t),e=!0}}),[]);var u=t.status,l=Object(I.getParent)(t,2).message||u;return s.a.createElement(s.a.Fragment,null,a?s.a.createElement("div",{className:o.loading},s.a.createElement("div",{className:o.dots},l?"".concat(l):"Loading")):null)}));function re(e){var t=e.messageContent,n=ee();return"string"===typeof t?s.a.createElement(P.a,{variant:"body2",className:n.blockMessage},t):s.a.createElement("div",{className:n.blockReactNodeMessage},t)}function ae(e){var t=e.error,n=e.reload,r=e.displayHeight,a=ee();return s.a.createElement("div",{className:a.blockError,style:{height:r}},n?s.a.createElement(s.a.Fragment,null,s.a.createElement(M.a,{"data-testid":"reload_button",onClick:n,startIcon:s.a.createElement(Z.a,null)},"Reload"),"".concat(t)):s.a.createElement(P.a,{color:"error",variant:"body2"},"".concat(t)))}var ie=Object(z.observer)((function(e){var t=e.model;return t.error?s.a.createElement(te,null,s.a.createElement(ae,{error:t.error,reload:t.reload,displayHeight:Object(R.getParentRenderProps)(t).displayModel.height})):t.message?s.a.createElement(te,null,s.a.createElement(re,{messageContent:t.message})):t.filled?t.reactElement:s.a.createElement(te,null,s.a.createElement(ne,{model:t}))})),oe=I.types.model("BlockState",{key:I.types.string,region:$.Region,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((function(){return{renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:ie,renderProps:void 0}})).actions((function(e){var t;return{afterAttach:function(){var t=Object(m.getContainingDisplay)(e);Object(m.makeAbortableReaction)(e,ce,se,{name:"".concat(t.id,"/").concat(Object(m.assembleLocString)(e.region)," rendering"),delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setStatus:function(t){e.status=t},setLoading:function(n){void 0!==t&&(t.signal.aborted||t.abort()),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered:function(n){if(n){var r=n.reactElement,a=n.features,i=n.layout,o=n.maxHeightReached,c=n.renderProps;e.filled=!0,e.message=void 0,e.reactElement=r,e.features=a,e.layout=i,e.error=void 0,e.maxHeightReached=o,e.renderProps=c,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=n,e.renderProps=void 0,t=void 0},reload:function(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=ie,e.renderProps=void 0,Object(I.getParent)(e,2).reload()},beforeDestroy:function(){t&&!t.signal.aborted&&t.abort();var n=Object(m.getContainingDisplay)(e),r=Object(m.getSession)(e).rpcManager,a=n.rendererType,i=ce(Object(I.cast)(e)).renderArgs;i&&a.freeResourcesInClient(r,JSON.parse(JSON.stringify(i))).catch((function(e){console.warn("Error while destroying block",e)}))}}}));function ce(e,t){try{var n=t||Object(m.getContainingDisplay)(e),r=Object(m.getSession)(n),a=r.assemblyManager,i=r.rpcManager,o=n.adapterConfig,c=n.renderProps,s=n.rendererType,l=n.error,d=n.parentTrack,f=Object(R.getTrackAssemblyNames)(d),p=e.region.assemblyName;if(!f.includes(p)&&!f.find((function(e){var t;return null===(t=a.get(e))||void 0===t?void 0:t.hasName(p)})))throw new Error("region assembly (".concat(p,") does not match track assemblies (").concat(f,")"));var g=c.config;Object(u.readConfObject)(g);var h=Object(R.getRpcSessionId)(n);return{rendererType:s,rpcManager:i,renderProps:c,cannotBeRenderedReason:n.regionCannotBeRendered(e.region),displayError:l,renderArgs:{statusCallback:function(t){Object(I.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:o,rendererType:s.name,sessionId:h,blockKey:e.key,timeout:1e6}}}catch(b){return{displayError:b}}}function se(e,t,n){return ue.apply(this,arguments)}function ue(){return(ue=Object(j.a)(O.a.mark((function e(t,n,r){var a,i,o,c,s,u,l,d,f,p,g,m;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(a=t).rendererType,o=a.renderProps,c=a.rpcManager,s=a.renderArgs,u=a.cannotBeRenderedReason,l=a.displayError,Object(I.isAlive)(r)){e.next=3;break}return e.abrupt("return",void 0);case 3:if(!l){e.next=6;break}return r.setError(l),e.abrupt("return",void 0);case 6:if(!u){e.next=9;break}return r.setMessage(u),e.abrupt("return",void 0);case 9:if(!o.notReady){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,i.renderInClient(c,Object(k.a)(Object(k.a)(Object(k.a)({},s),o),{},{signal:n}));case 13:return d=e.sent,f=d.reactElement,p=d.features,g=d.layout,m=d.maxHeightReached,e.abrupt("return",{reactElement:f,features:p,layout:g,maxHeightReached:m});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=I.types.compose("BaseLinearDisplay",l.BaseDisplay,I.types.model({height:I.types.optional(I.types.refinement("displayHeight",I.types.number,(function(e){return e>=20})),100),blockState:I.types.map(oe),userBpPerPxLimit:I.types.maybe(I.types.number)})).volatile((function(){return{message:"",featureIdUnderMouse:void 0,contextMenuFeature:void 0,additionalContextMenuItemCallbacks:[],scrollTop:0}})).views((function(e){return{get blockType(){return"staticBlocks"},get blockDefinitions(){var t=this.blockType,n=Object(m.getContainingView)(e);if(!n.initialized)throw new Error("view not initialized yet");return n[t]}}})).views((function(e){return{get maxViewBpPerPx(){return e.userBpPerPxLimit||Object(u.getConf)(e,"maxDisplayedBpPerPx")},get renderDelay(){return 50},get TooltipComponent(){return Y},get selectedFeatureId(){if(Object(I.isAlive)(e)){var t=Object(m.getSession)(e).selection;if(Object(E.b)(t))return t.id()}},get DisplayMessageComponent(){}}})).views((function(e){var t=!1,n={};return{get features(){var n,r=[],a=Object(S.a)(e.blockState.values());try{for(a.s();!(n=a.n()).done;){var i=n.value;i&&i.features&&r.push(i.features)}}catch(o){a.e(o)}finally{a.f()}return t=!0,new T.a(r)},get featureUnderMouse(){return e.featureIdUnderMouse?this.features.get(e.featureIdUnderMouse):void 0},get blockLayoutFeatures(){var n,r=new Map,a=Object(S.a)(e.blockState.values());try{for(a.s();!(n=a.n()).done;){var i=n.value;i&&i.layout&&i.layout.rectangles&&r.set(i.key,i.layout.getRectangles())}}catch(o){a.e(o)}finally{a.f()}return t=!0,r},get layoutFeatures(){var n,r=[],a=Object(S.a)(e.blockState.values());try{for(a.s();!(n=a.n()).done;){var i=n.value;i&&i.layout&&i.layout.rectangles&&r.push(i.layout.getRectangles())}}catch(o){a.e(o)}finally{a.f()}return t=!0,new T.a(r)},get rtree(){if(t){n={};var e,r=Object(S.a)(this.blockLayoutFeatures);try{for(r.s();!(e=r.n()).done;){var a=Object(C.a)(e.value,2),i=a[0],o=a[1];n[i]=new D.a;var c,s=n[i],u=Object(S.a)(o);try{for(u.s();!(c=u.n()).done;){var l=Object(C.a)(c.value,2),d=l[0],f=l[1];s.insert({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],name:d})}}catch(p){u.e(p)}finally{u.f()}}}catch(p){r.e(p)}finally{r.f()}t=!1}return n},getFeatureOverlapping:function(e,t,n){var r={minX:t,minY:n,maxX:t+1,maxY:n+1},a=this.rtree[e];return a&&a.collides(r)?a.search(r):[]}}})).actions((function(e){return{afterAttach:function(){var t=this,n=Object(F.autorun)((function(){var n={};Object(m.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((function(r){n[r.key]=!0,e.blockState.has(r.key)||t.addBlock(r.key,r)})),e.blockState.forEach((function(e,r){n[r]||t.deleteBlock(r)})))}));Object(I.addDisposer)(e,n)},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},setScrollTop:function(t){e.scrollTop=t},setUserBpPerPxLimit:function(t){e.userBpPerPxLimit=t},setMessage:function(t){e.message=t},addBlock:function(t,n){e.blockState.set(t,oe.create({key:t,region:n.toRegion()}))},deleteBlock:function(t){e.blockState.delete(t)},selectFeature:function(t){var n=Object(m.getSession)(e);if(Object(m.isSessionModelWithWidgets)(n)){var r=n.addWidget("BaseFeatureWidget","baseFeature",{featureData:t.toJSON(),view:Object(m.getContainingView)(e)});n.showWidget(r)}Object(m.isSelectionContainer)(n)&&n.setSelection(t)},clearFeatureSelection:function(){Object(m.getSession)(e).clearSelection()},setFeatureIdUnderMouse:function(t){e.featureIdUnderMouse=t},reload:function(){var t=JSON.parse(JSON.stringify(e.blockState));Object.keys(t).forEach((function(e){t[e].key+="-reload"})),e.blockState=t},addAdditionalContextMenuItemCallback:function(t){e.additionalContextMenuItemCallbacks.push(t)},setContextMenuFeature:function(t){e.contextMenuFeature=t}}})).views((function(e){return{regionCannotBeRenderedText:function(t){var n=Object(m.getContainingView)(e);return n&&n.bpPerPx>e.maxViewBpPerPx?"Zoom in to see features":""},regionCannotBeRendered:function(t){var n=Object(m.getContainingView)(e);if(n&&n.bpPerPx>e.maxViewBpPerPx)return s.a.createElement(s.a.Fragment,null,s.a.createElement(P.a,{component:"span",variant:"body2"},"Zoom in to see features or"," "),s.a.createElement(M.a,{"data-testid":"reload_button",onClick:function(){e.setUserBpPerPxLimit(n.bpPerPx),e.reload()},variant:"outlined"},"Force Load"),s.a.createElement(P.a,{component:"span",variant:"body2"},"(force load may be slow)"))},get trackMenuItems(){return[]},get composedTrackMenuItems(){return[]},get contextMenuItems(){var t=Object(I.getEnv)(e).pluginManager,n=e.contextMenuFeature?[{label:"Open feature details",icon:A.a,onClick:function(){e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[];return e.additionalContextMenuItemCallbacks.forEach((function(r){var a=r(e.contextMenuFeature,e,t);n.push.apply(n,Object(x.a)(a))})),n},get composedRenderProps(){return Object(k.a)(Object(k.a)({},Object(R.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick:function(t,n){var r=n||e.featureIdUnderMouse;if(r){var a=e.features.get(r);e.selectFeature(a)}else e.clearFeatureSelection()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,n){var r=n||e.featureIdUnderMouse;r?e.setContextMenuFeature(e.features.get(r)):e.clearFeatureSelection()},onMouseMove:function(t,n){e.setFeatureIdUnderMouse(n)},onMouseLeave:function(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu:function(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})},get renderProps(){return this.composedRenderProps}}})).actions((function(e){return{renderSvg:function(t){return Object(j.a)(O.a.mark((function n(){var r,a,i,o,c,u,l,d;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height,a=e.id,i=t.overrideHeight,o=Object(m.getContainingView)(e),c=o.offsetPx,u=o.roundedDynamicBlocks,l=o.width,n.next=6,Promise.all(u.map((function(n){var r=oe.create({key:n.key,region:n}),a=e.regionCannotBeRenderedText(n)||e.regionCannotBeRendered(n);if(a)return{reactElement:s.a.createElement(s.a.Fragment,null,s.a.createElement("rect",{x:0,y:0,width:l,height:20,fill:"#aaa"}),s.a.createElement("text",{x:0,y:15},a))};var i=ce(r,e),o=i.rpcManager,c=i.renderArgs,u=i.renderProps;return i.rendererType.renderInClient(o,Object(k.a)(Object(k.a)(Object(k.a)({},c),u),{},{exportSVG:t}))})));case 6:return d=n.sent,n.abrupt("return",s.a.createElement(s.a.Fragment,null,d.map((function(e,t){var n=u[t].offsetPx-c,o="clip-".concat("undefined"===typeof jest?a:"jest","-").concat(t);return s.a.createElement(s.a.Fragment,{key:"frag-".concat(t)},s.a.createElement("defs",null,s.a.createElement("clipPath",{id:o},s.a.createElement("rect",{x:0,y:0,width:l,height:i||r}))),s.a.createElement("g",{transform:"translate(".concat(n," 0)")},s.a.createElement("g",{clipPath:"url(#".concat(o,")")},s.a.isValidElement(e.reactElement)?e.reactElement:s.a.createElement("g",{dangerouslySetInnerHTML:{__html:e.html}}))))}))));case 8:case"end":return n.stop()}}),n)})))()}}})).postProcessSnapshot((function(e){e.blockState;return Object(y.a)(e,["blockState"])}));var de=n(335);function fe(e){return I.types.compose("LinearBareDisplay",le,I.types.model({type:I.types.literal("LinearBareDisplay"),configuration:Object(de.a)(e)})).views((function(e){return{get renderProps(){return Object(k.a)(Object(k.a)(Object(k.a)({},e.composedRenderProps),Object(R.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var pe=n(334),ge=n(700),me=n.n(ge),he=Object(c.lazy)((function(){return n.e(64).then(n.bind(null,2407))})),be=function(e){return I.types.compose("LinearBasicDisplay",le,I.types.model({type:I.types.literal("LinearBasicDisplay"),trackShowLabels:I.types.maybe(I.types.boolean),trackDisplayMode:I.types.maybe(I.types.string),trackMaxHeight:I.types.maybe(I.types.number),configuration:Object(u.ConfigurationReference)(e)})).views((function(e){return{get rendererTypeName(){return Object(u.getConf)(e,["renderer","type"])},get showLabels(){var t=Object(u.getConf)(e,["renderer","showLabels"]);return void 0!==e.trackShowLabels?e.trackShowLabels:t},get maxHeight(){var t=Object(u.getConf)(e,["renderer","maxHeight"]);return void 0!==e.trackMaxHeight?e.trackMaxHeight:t},get displayMode(){var t=Object(u.getConf)(e,["renderer","displayMode"]);return void 0!==e.trackDisplayMode?e.trackDisplayMode:t},get rendererConfig(){var t=Object(u.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create(Object(k.a)(Object(k.a)({},t),{},{showLabels:this.showLabels,displayMode:this.displayMode,maxHeight:this.maxHeight}),Object(I.getEnv)(e))}}})).actions((function(e){return{toggleShowLabels:function(){e.trackShowLabels=!e.showLabels},setDisplayMode:function(t){e.trackDisplayMode=t},setMaxHeight:function(t){e.trackMaxHeight=t}}})).views((function(e){var t=e.trackMenuItems;return{get renderProps(){var t=e.rendererConfig;return Object(k.a)(Object(k.a)(Object(k.a)({},e.composedRenderProps),Object(R.getParentRenderProps)(e)),{},{config:t})},get trackMenuItems(){return[].concat(Object(x.a)(t),[{label:"Show labels",icon:me.a,type:"checkbox",checked:e.showLabels,onClick:function(){e.toggleShowLabels()}},{label:"Display mode",icon:me.a,subMenu:["compact","reducedRepresentation","normal","collapse"].map((function(t){return{label:t,onClick:function(){e.setDisplayMode(t)}}}))},{label:"Set max height",onClick:function(){Object(m.getSession)(e).setDialogComponent(he,{model:e})}}])}}}))};function ve(e){return Object(u.ConfigurationSchema)("LinearBasicDisplay",{mouseover:{type:"string",description:"what to display in a given mouseover",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},renderer:e.pluggableConfigSchemaType("renderer"),maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:1e3}},{baseConfiguration:v,explicitlyTyped:!0})}var ye=function(e){Object(i.a)(s,e);var t=Object(o.a)(s);function s(){var e;Object(r.a)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="LinearGenomeViewPlugin",e.exports={BaseLinearDisplayComponent:Q,BaseLinearDisplay:le,baseLinearDisplayConfigSchema:v},e}return Object(a.a)(s,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(u.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:Object(l.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new d.a({name:"FeatureTrack",configSchema:t,stateModel:Object(l.createBaseTrackModel)(e,"FeatureTrack",t)})})),e.addTrackType((function(){var t=Object(u.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:Object(l.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new d.a({name:"BasicTrack",configSchema:t,stateModel:Object(l.createBaseTrackModel)(e,"BasicTrack",t)})})),e.addDisplayType((function(){var t=function(e){return Object(u.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:v,explicitlyTyped:!0})}(e);return new f.a({name:"LinearBareDisplay",configSchema:t,stateModel:fe(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:Q})})),e.addDisplayType((function(){var t=ve(e);return new f.a({name:"LinearBasicDisplay",configSchema:t,stateModel:be(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:Q})})),e.addViewType((function(){return new p.a({name:"LinearGenomeView",stateModel:Object(pe.e)(e),ReactComponent:Object(c.lazy)((function(){return Promise.resolve().then(n.bind(null,604))}))})}))}},{key:"configure",value:function(e){Object(m.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Linear genome view",icon:b.a,onClick:function(e){e.addView("LinearGenomeView",{})}})}}]),s}(g.a)},142:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var r=n(90),a=n(89),i=n(92);function o(e){return"object"===typeof e&&null!==e&&"function"===typeof e.get&&"function"===typeof e.id}function c(e){return"uniqueId"in e&&"object"!==typeof e.data}var s=function(){function e(t){Object(a.a)(this,e),this.data=void 0,this.parentHandle=void 0,this.uniqueId=void 0,c(t)?this.data=t:(this.data=t.data||{},this.parentHandle=t.parent);var n=c(t)?t.uniqueId:t.id;if(void 0===n||null===n)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(n),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));var r=this.data.subfeatures;if(r)for(var i=0;i<r.length;i+=1)"function"!==typeof r[i].get&&(r[i].strand=r[i].strand||this.data.strand,r[i]=new e({id:r[i].uniqueId||"".concat(n,"-").concat(i),data:r[i],parent:this}))}return Object(i.a)(e,[{key:"get",value:function(e){return this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=Object(r.a)(Object(r.a)({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e(Object(r.a)({},t))}}]),e}()},147:function(e,t,n){"use strict";n.r(t),n.d(t,"ObservableCreate",(function(){return o}));var r=n(115),a=n(991),i=n(83);function o(e,t){return r.a.create((function(t){try{var n=e(t);n&&n.catch&&n.catch((function(e){return t.error(e)}))}catch(r){t.error(r)}})).pipe(Object(a.a)(Object(i.observeAbortSignal)(t)))}},1493:function(e,t){},153:function(e,t,n){"use strict";n.r(t),n.d(t,"baseConnectionConfig",(function(){return a})),n.d(t,"BaseConnectionModelFactory",(function(){return c})),n.d(t,"BaseViewModel",(function(){return s.a})),n.d(t,"BaseDisplay",(function(){return f})),n.d(t,"createBaseTrackModel",(function(){return b})),n.d(t,"createBaseTrackConfig",(function(){return v}));var r=n(81),a=Object(r.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"}),i=n(102),o=n(87),c=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{afterAttach:function(){e.tracks.length||e.connect(e.configuration)},addTrackConf:function(t){var n=e.tracks.push(t);return e.tracks[n-1]},addTrackConfs:function(t){var n,r=(n=e.tracks).push.apply(n,Object(i.a)(t));return e.tracks.slice(r-1-t.length,r-1)},setTrackConfs:function(t){return e.tracks=t,e.tracks},clear:function(){}}}))},s=n(524),u=n(90),l=n(119),d=n(114),f=o.types.model("BaseDisplay",{id:d.ElementId,type:o.types.string,rpcDriverName:o.types.maybe(o.types.string)}).volatile((function(){return{rendererTypeName:"",error:void 0}})).views((function(e){return{get RenderingComponent(){return Object(o.getEnv)(e).pluginManager.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return Object(r.getConf)(this.parentTrack,"adapter")},get parentTrack(){for(var t=Object(o.getParent)(e);!t.configuration||!Object(r.getConf)(t,"trackId");){if(Object(o.isRoot)(t))throw new Error("No parent track found for ".concat(e.type," ").concat(e.id));t=Object(o.getParent)(t)}return t},get renderProps(){return Object(u.a)(Object(u.a)({},Object(l.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e})},get rendererType(){var t=Object(o.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!t)throw new Error('renderer "'.concat(e.rendererTypeName,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return t},get DisplayMessageComponent(){},get trackMenuItems(){return[]},get viewMenuActions(){return[]},regionCannotBeRendered:function(){}}})).actions((function(e){return{setError:function(t){e.error=t},setRpcDriverName:function(t){e.rpcDriverName=t},reload:function(){}}})),p=n(112),g=n(335),m=n(83),h=n(312);function b(e,t,n){return o.types.model(t,{id:d.ElementId,type:o.types.literal(t),configuration:Object(g.a)(n),displays:o.types.array(e.pluggableMstType("display","stateModel"))}).views((function(e){return{get rpcSessionId(){return e.configuration.trackId},get name(){return Object(r.getConf)(e,"name")},get adapterType(){var t=Object(r.getConf)(e,"adapter"),n=Object(o.getEnv)(e).pluginManager;if(!t)throw new Error("no adapter configuration provided for ".concat(e.type));var a=n.getAdapterType(t.type);if(!a)throw new Error("unknown adapter type ".concat(t.type));return a},get viewMenuActions(){var t=[];return e.displays.forEach((function(e){t.push.apply(t,Object(i.a)(e.viewMenuActions))})),t},get canConfigure(){var t=Object(m.getSession)(e);return Object(h.isSessionModelWithConfigEditing)(t)&&(t.adminMode||t.sessionTracks.find((function(t){return t.trackId===e.configuration.trackId})))},get composedTrackMenuItems(){return[]}}})).actions((function(t){return{activateConfigurationUI:function(){var e=Object(m.getSession)(t),n=Object(m.getContainingView)(t);if(Object(h.isSessionModelWithConfigEditing)(e)){var r=e.editTrackConfiguration(t.configuration);r&&r!==t.configuration&&(n.hideTrack(t.configuration),n.showTrack(r))}},showDisplay:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("display"),i=Object(o.resolveIdentifier)(a,Object(o.getRoot)(t),n),c=e.getDisplayType(i.type);if(!c)throw new Error("unknown display type ".concat(i.type));var s=c.stateModel.create(Object(u.a)(Object(u.a)({},r),{},{type:i.type,configuration:i}));t.displays.push(s)},hideDisplay:function(n){var r=e.pluggableConfigSchemaType("display"),a=Object(o.resolveIdentifier)(r,Object(o.getRoot)(t),n),i=t.displays.filter((function(e){return e.configuration===a}));return Object(p.transaction)((function(){return i.forEach((function(e){return t.displays.remove(e)}))})),i.length},replaceDisplay:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.displays.findIndex((function(e){return e.configuration.displayId===n}));if(-1===i)throw new Error("could not find display id ".concat(n," to replace"));var c=e.pluggableConfigSchemaType("display"),s=Object(o.resolveIdentifier)(c,Object(o.getRoot)(t),r),l=e.getDisplayType(s.type);if(!l)throw new Error("unknown display type ".concat(s.type));t.displays.splice(i,1,Object(u.a)(Object(u.a)({},a),{},{type:s.type,configuration:s}))}}})).views((function(t){return{get trackMenuItems(){var n=[];t.displays.forEach((function(e){n.push.apply(n,Object(i.a)(e.trackMenuItems))}));var r=[],a=Object(m.getContainingView)(t),o=e.getViewType(a.type).displayTypes.map((function(e){return e.name})),c=t.configuration.displays.filter((function(e){return o.includes(e.type)})),s=t.displays[0].configuration.displayId;return c.length>1&&(r.push({type:"divider"},{type:"subHeader",label:"Display types"}),c.forEach((function(e){r.push({type:"radio",label:"".concat(e.type),onClick:function(){t.replaceDisplay(s,e.displayId)},checked:e.displayId===s})}))),[].concat(n,r)}}}))}function v(e){return Object(r.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),displays:o.types.array(e.pluggableConfigSchemaType("display"))},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),r=new Set,a=n.displays,i=void 0===a?[]:a;"placeholderId"!==n.trackId&&(i.forEach((function(e){return e&&r.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){r.has(e.name)||i.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})})));return Object(u.a)(Object(u.a)({},n),{},{displays:i})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}},1590:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var r=n(90),a=n(88),i=n.n(a),o=n(91),c=n(92),s=n(89),u=n(94),l=n(95),d=n(1272),f=n(1591),p=n.n(f),g=n(1027),m=n(83),h=("undefined"!==typeof window?window:{}).electron,b=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).status=void 0,e}return n}(Object(d.a)(Error)),v=function(){function t(e){var n,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(s.a)(this,t),this.url=void 0,this._stat=void 0,this.fetch=void 0,this.baseOverrides={},this.nodeFetchFallback=!1,this.ipcRenderer=void 0,this.nodeFetch=function(){var e=Object(o.a)(i.a.mark((function e(t,n){var a,o,c,s,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n&&(n.signal=void 0),e.next=3,r.ipcRenderer.invoke("fetch",t,n);case 3:return a=e.sent,o=a.buffer,c=a.headers,s=a.status,u=a.statusText,l=new Response(o,{status:s,statusText:u,headers:c}),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h&&(n=h.ipcRenderer),!n)throw new Error("Cannot use ElectronLocalFile without ipcRenderer from electron");if(this.ipcRenderer=n,this.url=e,e.startsWith("file://")){var c=p()(e);if(!c)throw new TypeError("invalid file url");var u=new g.a(c);return this.read=u.read.bind(u),this.readFile=u.readFile.bind(u),void(this.stat=u.stat.bind(u))}var l=a.fetch||window.fetch;if(!fetch)throw new TypeError("no fetch function supplied, and none found in global environment");this.fetch=l,a.overrides&&(this.baseOverrides=a.overrides)}return Object(c.a)(t,[{key:"getBufferFromResponse",value:function(){var t=Object(o.a)(i.a.mark((function t(n){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!==typeof n.buffer){t.next=2;break}return t.abrupt("return",n.buffer());case 2:if("function"!==typeof n.arrayBuffer){t.next=7;break}return t.next=5,n.arrayBuffer();case 5:return r=t.sent,t.abrupt("return",e.from(r));case 7:throw new TypeError("invalid HTTP response object, has no buffer method, and no arrayBuffer method");case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"getFetch",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n,a,o,c,s,u,l,d,f,p,g;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.fetch){e.next=2;break}throw new Error("a fetch function must be available unless using a file:// url");case 2:if(this.url){e.next=4;break}throw new Error("no URL specified");case 4:return n=this.nodeFetchFallback?this.nodeFetch:this.fetch,a=t.headers,o=void 0===a?{}:a,c=t.signal,s=t.overrides,u=void 0===s?{}:s,l=Object(r.a)(Object(r.a)({headers:o,method:"GET",redirect:"follow",mode:"cors",signal:c},this.baseOverrides),u),e.prev=7,e.next=10,n(this.url,l);case 10:d=e.sent,e.next=22;break;case 13:if(e.prev=13,e.t0=e.catch(7),Object(m.isAbortException)(e.t0)){e.next=21;break}if(!this.nodeFetchFallback){e.next=18;break}throw e.t0;case 18:return console.warn("received error, falling back to node-fetch",e.t0),this.nodeFetchFallback=!0,e.abrupt("return",this.getFetch(t));case 21:throw e.t0;case 22:return this._stat||(l.headers&&l.headers.range?(f=d.headers.get("content-range"),(p=/\/(\d+)$/.exec(f||""))&&p[1]&&(this._stat={size:parseInt(p[1],10)})):(g=d.headers.get("content-length"))&&(this._stat={size:parseInt(g,10)})),e.abrupt("return",d);case 24:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"headFetch",value:function(){var e=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getFetch({overrides:{method:"HEAD"}}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n,r,a,o,c,s,u,l=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:0,r=l.length>2?l[2]:void 0,a=l.length>3&&void 0!==l[3]?l[3]:0,(o=l.length>4&&void 0!==l[4]?l[4]:{}).headers=o.headers||{},r<1/0?o.headers.range="bytes=".concat(a,"-").concat(a+r):r===1/0&&0!==a&&(o.headers.range="bytes=".concat(a,"-")),e.next=8,this.getFetch(o);case 8:if((200!==(c=e.sent).status||0!==a)&&206!==c.status){e.next=15;break}return e.next=12,this.getBufferFromResponse(c);case 12:return s=e.sent,u=s.copy(t,n,0,Math.min(r,s.length)),e.abrupt("return",{bytesRead:u,buffer:t});case 15:throw new Error("HTTP ".concat(c.status," fetching ").concat(this.url));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readFile",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,n,r,a,o,c=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"===typeof(t=c.length>0&&void 0!==c[0]?c[0]:{})?(n=t,r={}):(n=t.encoding,delete(r=t).encoding),e.next=4,this.getFetch(r);case 4:if(200===(a=e.sent).status){e.next=9;break}throw(o=new b("HTTP ".concat(a.status," fetching ").concat(this.url))).status=a.status,o;case 9:if("utf8"!==n){e.next=11;break}return e.abrupt("return",a.text());case 11:if(!n){e.next=13;break}throw new Error("unsupported encoding: ".concat(n));case 13:return e.abrupt("return",this.getBufferFromResponse(a));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stat",value:function(){var t=Object(o.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._stat){t.next=3;break}return t.next=3,this.headFetch();case 3:if(this._stat){t.next=6;break}return t.next=6,this.read(e.allocUnsafe(10),0,10,0);case 6:if(this._stat){t.next=8;break}throw new Error("unable to determine size of file at ".concat(this.url));case 8:return t.abrupt("return",this._stat);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}()}).call(this,n(109).Buffer)},1608:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var r=n(82),a=n(88),i=n.n(a),o=n(91),c=n(89),s=n(92),u=n(429),l=n.n(u),d=n(1614),f=n.n(d),p=n(81),g=n(1270),m=(Object(p.ConfigurationSchema)("PluginSource",{name:{type:"string",defaultValue:""},url:{type:"string",defaultValue:""}}),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(c.a)(this,t),this.definitions=[],this.definitions=JSON.parse(JSON.stringify(e))}return Object(s.a)(t,[{key:"loadScript",value:function(e){if(document&&document.getElementsByTagName)return f()(e);if(self&&self.importScripts)return new Promise((function(t,n){try{self.importScripts(e)}catch(r){return void n(r||new Error("failed to load ".concat(e)))}t()}));throw new Error("cannot figure out how to load external JS scripts in this environment")}},{key:"loadPlugin",value:function(){var t=Object(o.a)(i.a.mark((function t(n){var r,a,o,c,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=l.a.parse(n.url)).protocol&&"http:"!==r.protocol&&"https:"!==r.protocol){t.next=11;break}return t.next=4,this.loadScript(n.url);case 4:if(a=n.name,o="JBrowsePlugin".concat(a),c="object"===typeof self&&self.self===self&&self||"object"===typeof e&&e.global===e&&e||this,s=c[o]){t.next=10;break}throw new Error("plugin ".concat(a," failed to load, ").concat(c.constructor.name,".").concat(o," is undefined"));case 10:return t.abrupt("return",s.default);case 11:throw new Error('cannot load plugins using protocol "'.concat(r.protocol,'"'));case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"installGlobalReExports",value:function(e){e.JBrowseExports={},Object.entries(g.a).forEach((function(t){var n=Object(r.a)(t,2),a=n[0],i=n[1];e.JBrowseExports[a]=i}))}},{key:"load",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(this.definitions.map(function(){var e=Object(o.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadPlugin(n);case 2:return e.t0=e.sent,e.t1=n,e.abrupt("return",{plugin:e.t0,definition:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}())}).call(this,n(143))},1650:function(e,t){},1652:function(e,t){},1675:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return C})),n.d(t,"capabilities",(function(){return S}));var r=n(106),a=n(82),i=n(88),o=n.n(i),c=n(91),s=n(89),u=n(92),l=n(94),d=n(95),f=n(136),p=n(142),g=n(81),m=n(147),h=n(316),b=n(1055),v=n(418),y=n(720),w=n(287);function O(e){return j(e.type)?1:e.length}function j(e){return"softclip"===e||"hardclip"===e||"insertion"===e}function k(e,t,n,r){e[n][r]||(e[n][r]={total:0,strands:{"-1":0,0:0,1:0}}),e[n][r].total++,e[n][r].strands[t]++}function x(e,t,n,r){e[n][r]||(e[n][r]={total:0,strands:{"-1":0,0:0,1:0}}),e[n][r].total--,e[n][r].strands[t]--}var C=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"configure",value:function(){var e=Object(c.a)(o.a.mark((function e(){var t,n,r,a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.readConfObject)(this.config,"subadapter"),a=Object(g.readConfObject)(this.config,["subadapter","sequenceAdapter"]),e.next=4,null===(t=this.getSubAdapter)||void 0===t?void 0:t.call(this,r);case 4:if(i=e.sent,!a){e.next=11;break}return e.next=8,null===(n=this.getSubAdapter)||void 0===n?void 0:n.call(this,a);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=void 0;case 12:if(c=e.t0,i){e.next=15;break}throw new Error("Failed to get subadapter");case 15:return e.abrupt("return",{subadapter:i.dataAdapter,sequenceAdapter:null===c||void 0===c?void 0:c.dataAdapter});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.ObservableCreate)(function(){var r=Object(c.a)(o.a.mark((function r(a){var i,c,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.configure();case 2:return i=r.sent,c=i.subadapter,s=c.getFeatures(e,n),n.filters&&(u=n.filters,s=s.pipe(Object(h.a)((function(e){return u.passes(e,n)})))),r.next=8,t.generateCoverageBins(s,e,n);case 8:r.sent.forEach((function(n,r){n.total&&a.next(new p.a({id:"".concat(t.id,"-").concat(e.start,"-").concat(r),data:{score:n.total,snpinfo:n,start:e.start+r,end:e.start+r+1,refName:e.refName}}))})),a.complete();case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),n.signal)}},{key:"getRefNames",value:function(){var e=Object(c.a)(o.a.mark((function e(){var t,n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},e.next=3,this.configure();case 3:return n=e.sent,r=n.subadapter,e.abrupt("return",r.getRefNames(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}},{key:"generateCoverageBins",value:function(){var e=Object(c.a)(o.a.mark((function e(t,n,i){var c,s,u,l,d,f,p,g,m,h,C,S;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=i.colorBy,e.next=3,this.configure();case 3:if(s=e.sent,u=s.sequenceAdapter,l=n.refName,d=n.start,f=n.end,p=Math.ceil(n.end-n.start),g=Array.from({length:p},(function(){return{total:0,lowqual:{},cov:{},delskips:{},noncov:{},ref:{}}})),!u){e.next=15;break}return e.next=11,u.getFeatures({refName:l,start:d,end:f+1,assemblyName:"na"}).pipe(Object(b.a)()).toPromise();case 11:h=e.sent,C=Object(a.a)(h,1),S=C[0],m=null===S||void 0===S?void 0:S.get("seq");case 15:return e.abrupt("return",t.pipe(Object(v.a)((function(e,t){for(var a=t.get("CIGAR"),i=t.get("start"),o=t.get("end"),s=t.get("strand"),u=Object(w.parseCigar)(a),l=i;l<o;l++){var d=l-n.start;if(d>=0&&d<e.length){var f=e[d];f.total++,k(f,s,"ref","ref")}}if("modifications"===(null===c||void 0===c?void 0:c.type)){var p=t.get("seq"),g=Object(y.a)(t,"MM","Mm")||"",h=Object(y.a)(t,"ML","Ml")||[],b=h?("string"===typeof h?h.split(",").map((function(e){return+e})):h).map((function(e){return e/255})):Object(y.a)(t,"MP","Mp").split("").map((function(e){return e.charCodeAt(0)-33})).map((function(e){return Math.min(1,e/50)})),v=0;Object(w.getModificationPositions)(g,p).forEach((function(t){var a,c=t.type,l=t.positions,d="mod_".concat(c),f=Object(r.a)(Object(w.getNextRefPos)(u,l));try{for(f.s();!(a=f.n()).done;){var p=a.value,g=p+i-n.start;if(g>=0&&g<e.length&&p+i<o){var m=e[g];b[v]>.5?k(m,s,"cov",d):k(m,s,"lowqual",d)}v++}}catch(h){f.e(h)}finally{f.f()}}))}else if("methylation"===(null===c||void 0===c?void 0:c.type)){if(!m)throw new Error("no region sequence detected, need sequenceAdapter configuration");var C=t.get("seq"),S=Object(y.a)(t,"MM","Mm")||"",T=new Array(n.end-n.start).fill(0);Object(w.getModificationPositions)(S,C).forEach((function(e){var t=e.type,a=e.positions;if("m"===t){var o,c=Object(r.a)(Object(w.getNextRefPos)(u,a));try{for(c.s();!(o=c.n()).done;){var s=o.value+i-n.start;s>=0&&s<T.length&&(T[s]=1)}}catch(l){c.e(l)}finally{c.f()}}}));for(var E=i;E<o;E++){var R=E-n.start;if(R>=0&&R<e.length){var M=m[R+1],P=m[R],N=e[R];"C"===P.toUpperCase()&&"G"===M.toUpperCase()&&(T[R]?(k(N,s,"cov","meth"),x(N,s,"ref","ref")):(k(N,s,"cov","unmeth"),x(N,s,"ref","ref")))}}}else for(var A=t.get("mismatches"),F=0;F<(null===A||void 0===A?void 0:A.length);F++)for(var I=A[F],B=i+I.start,D=B;D<B+O(I);D++){var L=D-n.start;if(L>=0&&L<e.length){var V=e[L],W=I.base,z=I.type,H=j(z);H?k(V,s,"noncov",z):x(V,s,"ref","ref"),"deletion"===z||"skip"===z?(k(V,s,"delskips",z),V.total--):H||k(V,s,"cov",W)}}return e}),g)).toPromise());case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(f.BaseFeatureDataAdapter),S=C.capabilities},1732:function(e,t,n){e.exports=function(){return new Worker(n.p+"81539e22f8620ca5f799.worker.js")}},1734:function(e){e.exports=JSON.parse('{"name":"@jbrowse/web","version":"1.3.0","license":"Apache-2.0","homepage":".","main":"build","dir":"src","scripts":{"start":"rescripts --max-http-header-size=100000 start","build":"cross-env NODE_OPTIONS=\'--max-old-space-size=7000\' rescripts build","test":"rescripts test","eject":"rescripts eject","checktypes":"tsc --noEmit","jtest":"jest --config ../../jest.config.js --roots products/jbrowse-web/","lint":"eslint --ext .js,.ts,.jsx,.tsx src"},"dependencies":{"@jbrowse/core":"^1.3.0","@jbrowse/plugin-alignments":"^1.3.0","@jbrowse/plugin-bed":"^1.2.0","@jbrowse/plugin-breakpoint-split-view":"^1.3.0","@jbrowse/plugin-circular-view":"^1.3.0","@jbrowse/plugin-config":"^1.3.0","@jbrowse/plugin-data-management":"^1.3.0","@jbrowse/plugin-dotplot-view":"^1.3.0","@jbrowse/plugin-filtering":"^1.3.0","@jbrowse/plugin-gff3":"^1.3.0","@jbrowse/plugin-hic":"^1.3.0","@jbrowse/plugin-legacy-jbrowse":"^1.3.0","@jbrowse/plugin-linear-comparative-view":"^1.3.0","@jbrowse/plugin-linear-genome-view":"^1.3.0","@jbrowse/plugin-lollipop":"^1.3.0","@jbrowse/plugin-menus":"^1.3.0","@jbrowse/plugin-rdf":"^1.3.0","@jbrowse/plugin-sequence":"^1.3.0","@jbrowse/plugin-spreadsheet-view":"^1.3.0","@jbrowse/plugin-sv-inspector":"^1.3.0","@jbrowse/plugin-svg":"^1.3.0","@jbrowse/plugin-trackhub-registry":"^1.3.0","@jbrowse/plugin-variants":"^1.3.0","@jbrowse/plugin-wiggle":"^1.3.0","@librpc/web":"rbuels/librpc-web#737bb9706762a52a87169a12c9b59fb241febab0","@material-ui/core":"^4.9.5","@material-ui/data-grid":"^4.0.0-alpha.27","@material-ui/icons":"^4.0.0","@material-ui/lab":"^4.0.0-alpha.56","clsx":"^1.0.4","copy-to-clipboard":"^3.3.1","core-js":"^3.2.1","crypto-js":"^3.0.0","fontsource-roboto":"3.0.3","json-stable-stringify":"^1.0.1","merge-deep":"^3.0.2","mobx":"^5.10.1","mobx-react":"^6.0.0","mobx-state-tree":"3.14.1","prop-types":"^15.7.2","query-string":"^6.9.0","raf":"^3.4.1","react":"^17.0.0","react-dom":"^17.0.0","react-error-boundary":"^3.0.0","react-sizeme":"^2.6.7","requestidlecallback-polyfill":"^1.0.2","rxjs":"^6.5.2","shortid":"^2.2.15","use-query-params":"1.1.3"},"devDependencies":{"jest":"26.6.0"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"license":"Apache-2.0","development":["last 1 chrome version"]},"private":true}')},185:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(89),a=n(94),i=n(95),o=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e){var a;if(Object(r.a)(this,n),(a=t.call(this,e)).AdapterClass=void 0,a.getAdapterClass=void 0,a.configSchema=void 0,a.adapterCapabilities=void 0,"AdapterClass"in e)a.AdapterClass=e.AdapterClass;else{if(!("getAdapterClass"in e))throw new Error("no AdapterClass or getAdapterClass is defined for adapter type ".concat(a.name));a.getAdapterClass=e.getAdapterClass}return a.configSchema=e.configSchema,a.adapterCapabilities=e.adapterCapabilities||[],a}return n}(n(276).a)},223:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(89),a=n(94),i=n(95),o=n(276),c=n(345),s=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e){var a;if(Object(r.a)(this,n),(a=t.call(this,e)).stateModel=void 0,a.configSchema=void 0,a.ReactComponent=void 0,a.trackType=void 0,a.viewType=void 0,a.stateModel=e.stateModel,a.configSchema=e.configSchema,a.ReactComponent=e.ReactComponent,a.trackType=e.trackType,a.viewType=e.viewType,!a.stateModel)throw new Error("no stateModel defined for display ".concat(a.name));if(!a.configSchema)throw new Error("no configSchema provided for display ".concat(a.name));if(!a.ReactComponent)throw new Error("no ReactComponent provided for display ".concat(a.name));if(!a.trackType)throw new Error("no trackType provided for display ".concat(a.name));if(!a.viewType)throw new Error("no viewType provided for display ".concat(a.name));if(!Object(c.getDefaultValue)(a.configSchema).type){var i=a.configSchema?a.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return a}return n}(o.a)},2436:function(e,t,n){"use strict";n.r(t),n.d(t,"Loader",(function(){return Zl}));var r={};n.r(r),n.d(r,"CoreGetRefNames",(function(){return $})),n.d(r,"CoreGetFileInfo",(function(){return K})),n.d(r,"CoreGetMetadata",(function(){return Z})),n.d(r,"CoreGetFeatures",(function(){return ee})),n.d(r,"CoreFreeResources",(function(){return te})),n.d(r,"CoreRender",(function(){return ne}));var a={};n.r(a),n.d(a,"getScale",(function(){return $e})),n.d(a,"getOrigin",(function(){return Ke})),n.d(a,"getNiceDomain",(function(){return Ze}));n(1281),n(1282),n(1283),n(1284),n(1285),n(1286),n(1287),n(1288),n(1289),n(1290),n(1291),n(1292),n(1293),n(1294),n(1295),n(1296),n(1297),n(1298),n(1299),n(1300),n(1301),n(1302),n(1303),n(1304),n(1305),n(499),n(1306),n(1307),n(1308),n(1309),n(1310),n(1311),n(1312),n(1313),n(1314),n(1315),n(1316),n(1317),n(1318),n(1319),n(1321),n(1322),n(1324),n(1325),n(1326),n(1327),n(1328),n(1329),n(1330),n(1331),n(1332),n(1333),n(1334),n(1335),n(1337),n(1338),n(1339),n(1340),n(1341),n(1342),n(1343),n(1344),n(1345),n(1346),n(1347),n(1348),n(1350),n(1351),n(1352),n(1353),n(1354),n(1355),n(1356),n(1357),n(1359),n(1360),n(1361),n(1362),n(1363),n(1364),n(1365),n(1366),n(1367),n(1368),n(1369),n(1370),n(1371),n(1372),n(1373),n(1374),n(1375),n(1376),n(1377),n(1378),n(1379),n(1381),n(1382),n(1383),n(1384),n(1387),n(1388),n(1389),n(1391),n(1392),n(1393),n(1394),n(1395),n(1396),n(1397),n(1398),n(1399),n(1400),n(1401),n(943),n(1402),n(1403),n(1404),n(1405),n(1406),n(1407),n(1408),n(946),n(1409),n(1410),n(1411),n(1412),n(1413),n(1414),n(1415),n(1416),n(1417),n(1418),n(1419),n(1420),n(1421),n(1422),n(1423),n(1424),n(1425),n(1426),n(1427),n(1428),n(1429),n(1430),n(1431),n(1432),n(1433),n(1434),n(1436),n(1437),n(1438),n(1439),n(1440),n(1441),n(1442),n(1443),n(1444),n(1445),n(1446),n(1447),n(1448),n(1449),n(1450),n(1451),n(1452),n(1453),n(1454),n(1455),n(1456),n(1457),n(1458),n(1459),n(1460),n(1461),n(1462),n(1463),n(1464),n(1465),n(1466),n(1467),n(1468),n(1469),n(1470),n(1471),n(1473),n(1474),n(1475),n(1476),n(1479),n(954);var i=n(88),o=n.n(i),c=n(102),s=n(91),u=n(90),l=n(154),d=n(82),f=n(1),p=n.n(f),g=n(89),m=n(92),h=n(87),b=n(960),v=n(185),y=n(252),w=n(223),O=n(309),j=n(253),k=n(94),x=n(95),C=n(276),S=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e){var r;if(Object(g.a)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.displayName=void 0,r.description=void 0,r.url=void 0,r.configEditorComponent=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,r.displayName=e.displayName,r.description=e.description,r.url=e.url,r.configEditorComponent=e.configEditorComponent,!r.stateModel)throw new Error("no stateModel defined for connection ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema defined for connection ".concat(r.name));return r}return n}(C.a),T=n(119),E=0,R=new WeakMap;var M=new Map;function P(e){var t=e.abortSignalId,n=M.get(t);return n||(n=new AbortController,M.set(t,n)),n.signal}var N=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,{name:""})).pluginManager=void 0,r.name="UNKNOWN",r.pluginManager=e,r}return Object(m.a)(n,[{key:"serializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(T.getBlobMap)(),e.abrupt("return",Object(u.a)(Object(u.a)({},t),{},{blobMap:r}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.blobMap&&Object(T.setBlobMap)(t.blobMap),!(r=t.signal)||("object"!==typeof(n=r)||null===n||!("abortSignalId"in n)||"number"!==typeof n.abortSignalId)){e.next=4;break}return e.abrupt("return",Object(u.a)(Object(u.a)({},t),{},{signal:P(r)}));case 4:return e.abrupt("return",Object(u.a)(Object(u.a)({},t),{},{signal:void 0}));case 5:case"end":return e.stop()}var n}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeReturn",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(C.a),A=n(81),F=n(133),I=n(1270),B=n(114),D=Object(A.ConfigurationSchema)("BaseFeatureWidget",{});function L(e){return h.types.model("BaseFeatureWidget",{id:B.ElementId,type:h.types.literal("BaseFeatureWidget"),featureData:h.types.frozen(),view:h.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var V=n(1055),W=n(1054),z=n.n(W);function H(e){return"".concat(z()(e))}var q={};function U(e,t,n){return _.apply(this,arguments)}function _(){return(_=Object(s.a)(o.a.mark((function e(t,n,r){var a,i,c,s,u,l,d,f,p,g;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=H(r),q[a]){e.next=21;break}if(i=(r||{}).type){e.next=5;break}throw new Error("could not determine adapter type from adapter config snapshot");case 5:if(c=t.getAdapterType(i)){e.next=8;break}throw new Error("unknown data adapter type ".concat(i));case 8:if(s=c.configSchema.create(r,{pluginManager:t}),u=U.bind(null,t,n),l=c.AdapterClass,d=c.getAdapterClass,e.t0=l,e.t0){e.next=16;break}return e.next=15,d();case 15:e.t0=e.sent;case 16:if(f=e.t0){e.next=19;break}throw new Error("Failed to get adapter");case 19:p=new f(s,u),q[a]={dataAdapter:p,sessionIds:new Set([n])};case 21:return(g=q[a]).sessionIds.add(n),e.abrupt("return",g);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){var t=0,n=Object.keys(e);if(1===n.length&&"sessionId"===n[0]){var r=e.sessionId;Object.entries(q).forEach((function(e){var n=Object(d.a)(e,2),a=n[0],i=n[1];i.sessionIds.delete(r),0===i.sessionIds.size&&(t+=1,delete q[a])}))}else Object.values(q).forEach((function(t){t.dataAdapter.freeResources?(e.regions||(e.region?[e.region]:[])).forEach((function(e){void 0!==e.refName&&t.dataAdapter.freeResources(e)})):console.warn(t.dataAdapter,"does not implement freeResources")}));return t}var J=n(476),X=n(136),Y=n(83),Q=n(142),$=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetRefNames",e}return Object(m.a)(n,[{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,i=r.adapterConfig,e.next=6,U(this.pluginManager,a,i);case 6:if(c=e.sent,!((s=c.dataAdapter)instanceof X.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",s.getRefNames(r));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),K=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetInfo",e}return Object(m.a)(n,[{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,i=r.adapterConfig,e.next=6,U(this.pluginManager,a,i);case 6:return c=e.sent,s=c.dataAdapter,e.abrupt("return",Object(X.isFeatureAdapter)(s)?s.getHeader(r):null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),Z=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetMetadata",e}return Object(m.a)(n,[{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,i=r.adapterConfig,e.next=6,U(this.pluginManager,a,i);case 6:return c=e.sent,s=c.dataAdapter,e.abrupt("return",Object(X.isFeatureAdapter)(s)?s.getMetadata(r):null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),ee=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetFeatures",e}return Object(m.a)(n,[{key:"deserializeReturn",value:function(){var e=Object(s.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.map((function(e){return new Q.a(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,u,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,i=r.adapterConfig,c=r.region,e.next=6,U(this.pluginManager,a,i);case 6:if(s=e.sent,u=s.dataAdapter,!Object(X.isFeatureAdapter)(u)){e.next=14;break}return l=u.getFeatures(c),e.next=12,l.pipe(Object(V.a)()).toPromise();case 12:return d=e.sent,e.abrupt("return",d.map((function(e){return e.toJSON()})));case 14:return e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),te=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CoreFreeResources",e}return Object(m.a)(n,[{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,n+=G(t),this.pluginManager.getRendererTypes().forEach((function(e){var t=e.freeResources();t&&(n+=t)})),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(N),ne=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CoreRender",e}return Object(m.a)(n,[{key:"serializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=null===(r=this.pluginManager.rootModel)||void 0===r||null===(a=r.session)||void 0===a?void 0:a.assemblyManager)){e.next=7;break}return e.next=4,Object(Y.renameRegionsIfNeeded)(i,t);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=t;case 8:if(c=e.t0,"MainThreadRpcDriver"!==n){e.next=11;break}return e.abrupt("return",c);case 11:return s=t.rendererType,u=re(s,this.pluginManager.getRendererType(s)),e.abrupt("return",u.serializeArgsInClient(c));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,l,d,f,p,g,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(i=(a=r).sessionId,c=a.adapterConfig,s=a.rendererType,l=a.signal,i){e.next=8;break}throw new Error("must pass a unique session id");case 8:return Object(Y.checkAbortSignal)(l),e.next=11,U(this.pluginManager,i,c);case 11:if(d=e.sent,(f=d.dataAdapter)instanceof X.BaseFeatureDataAdapter){e.next=15;break}throw new Error("CoreRender cannot handle this type of data adapter ".concat(f));case 15:if(p=re(s,this.pluginManager.getRendererType(s)),g=Object(u.a)(Object(u.a)({},r),{},{dataAdapter:f}),"MainThreadRpcDriver"!==n){e.next=23;break}return e.next=20,p.render(g);case 20:e.t0=e.sent,e.next=26;break;case 23:return e.next=25,p.renderInWorker(g);case 25:e.t0=e.sent;case 26:return m=e.t0,Object(Y.checkAbortSignal)(l),e.abrupt("return",m);case 29:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("MainThreadRpcDriver"!==r){e.next=2;break}return e.abrupt("return",t);case 2:return a=n.rendererType,i=re(a,this.pluginManager.getRendererType(a)),e.abrupt("return",i.deserializeResultsInClient(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(N);function re(e,t){if(!t)throw new Error('renderer "'.concat(e,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e," has no ReactComponent, it may not be completely implemented yet"));if(!(t instanceof J.a))throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}var ae=function(e){Object(k.a)(a,e);var t=Object(x.a)(a);function a(){var e;Object(g.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="CorePlugin",e}return Object(m.a)(a,[{key:"install",value:function(e){Object.values(r).forEach((function(t){e.addRpcMethod((function(){return new t(e)}))})),e.addWidgetType((function(){return new j.a({name:"BaseFeatureWidget",heading:"Feature details",configSchema:D,stateModel:L(e),ReactComponent:Object(f.lazy)((function(){return Promise.resolve().then(n.bind(null,475))}))})}))}}]),a}(F.a),ie=n(987),oe=function(){function e(){Object(g.a)(this,e),this.phaseCallbacks=new Map,this.phaseOrder=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.phaseOrder=n}return Object(m.a)(e,[{key:"add",value:function(e,t){if(!this.phaseOrder.includes(e))throw new Error("unknown phase ".concat(e));var n=this.phaseCallbacks.get(e);n||(n=[],this.phaseCallbacks.set(e,n)),n.push(t)}},{key:"run",value:function(){var e=this;this.phaseOrder.forEach((function(t){var n=e.phaseCallbacks.get(t);n&&n.forEach((function(e){return e()}))}))}}]),e}(),ce=function(){function e(t,n){Object(g.a)(this,e),this.registeredTypes={},this.baseClass=void 0,this.typeName=void 0,this.typeName=t,this.baseClass=n}return Object(m.a)(e,[{key:"add",value:function(e,t){this.registeredTypes[e]=t}},{key:"has",value:function(e){return e in this.registeredTypes}},{key:"get",value:function(e){if(!this.has(e))throw new Error("".concat(this.typeName," '").concat(e,"' not found, perhaps its plugin is not loaded or its plugin has not added it."));return this.registeredTypes[e]}},{key:"all",value:function(){return Object.values(this.registeredTypes)}}]),e}(),se=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(g.a)(this,e),this.plugins=[],this.jexl=Object(ie.a)(),this.pluginMetadata={},this.runtimePluginDefinitions=[],this.elementCreationSchedule=new oe("renderer","adapter","display","track","connection","view","widget","rpc method"),this.rendererTypes=new ce("RendererType",b.a),this.adapterTypes=new ce("AdapterType",v.a),this.trackTypes=new ce("TrackType",y.a),this.displayTypes=new ce("DisplayType",w.a),this.connectionTypes=new ce("ConnectionType",S),this.viewTypes=new ce("ViewType",O.a),this.widgetTypes=new ce("WidgetType",j.a),this.rpcMethods=new ce("RpcMethodType",N),this.configured=!1,this.rootModel=void 0,this.jbrequireCache=new Map,this.lib=I.a,this.load=function(e){return t.jbrequireCache.has(e)||t.jbrequireCache.set(e,e(t)),t.jbrequireCache.get(e)},this.jbrequire=function(e){if("string"===typeof e){var n=t.lib[e];if(!n)throw new TypeError("No jbrequire re-export defined for package '".concat(e,"'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally."));return n}if("function"===typeof e)return t.load(e);if(e.default)return t.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")},this.addPlugin({plugin:new ae,metadata:{isCore:!0}}),n.forEach((function(e){t.addPlugin(e)}))}return Object(m.a)(e,[{key:"pluginConfigurationSchemas",value:function(){var e={};return this.plugins.forEach((function(t){t.configurationSchema&&(e[t.name]=t.configurationSchema)})),e}},{key:"addPlugin",value:function(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");var t=e instanceof F.a?[e,{}]:[e.plugin,e.metadata],n=Object(d.a)(t,2),r=n[0],a=n[1],i=void 0===a?{}:a;if(this.plugins.includes(r))throw new Error("plugin already installed");return this.pluginMetadata[r.name]=i,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),r.install(this),this.plugins.push(r),this}},{key:"getPlugin",value:function(e){return this.plugins.find((function(t){return t.name===e}))}},{key:"hasPlugin",value:function(e){return void 0!==this.getPlugin(e)}},{key:"createPluggableElements",value:function(){return this.elementCreationSchedule.run(),delete this.elementCreationSchedule,this}},{key:"setRootModel",value:function(e){this.rootModel=e}},{key:"configure",value:function(){var e=this;if(this.configured)throw new Error("already configured");return this.plugins.forEach((function(t){return t.configure(e)})),this.configured=!0,this}},{key:"getElementTypeRecord",value:function(e){switch(e){case"adapter":return this.adapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;default:throw new Error("invalid element type '".concat(e,"'"))}}},{key:"addElementType",value:function(e,t){var n=this;if("function"!==typeof t)throw new Error("must provide a callback function that returns the new type object");var r=this.getElementTypeRecord(e);return this.elementCreationSchedule.add(e,(function(){var a=t(n);if(!a.name)throw new Error("cannot add a ".concat(e," with no name"));if(r.has(a.name))throw new Error("".concat(e," ").concat(a.name," already registered, cannot register it again"));r.add(a.name,a)})),this}},{key:"getElementType",value:function(e,t){return this.getElementTypeRecord(e).get(t)}},{key:"getElementTypesInGroup",value:function(e){return this.getElementTypeRecord(e).all()}},{key:"pluggableMstType",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.types.maybe(h.types.null),r=[];return this.getElementTypeRecord(e).all().forEach((function(e){var n=e[t];Object(h.isType)(n)&&Object(h.isModelType)(n)&&r.push(n)})),0===r.length?(console.warn("No JBrowse pluggable types found matching ('".concat(e,"','").concat(t,"')")),n):h.types.union.apply(h.types,r)}},{key:"pluggableConfigSchemaType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"configSchema",n=[];return this.getElementTypeRecord(e).all().forEach((function(e){var r=e[t];Object(A.isBareConfigurationSchemaType)(r)&&n.push(r)})),0===n.length&&n.push(Object(A.ConfigurationSchema)("Null",{})),h.types.union.apply(h.types,n)}},{key:"getRendererType",value:function(e){return this.rendererTypes.get(e)}},{key:"getRendererTypes",value:function(){return this.rendererTypes.all()}},{key:"getAdapterType",value:function(e){return this.adapterTypes.get(e)}},{key:"getTrackType",value:function(e){return this.trackTypes.get(e)}},{key:"getDisplayType",value:function(e){return this.displayTypes.get(e)}},{key:"getViewType",value:function(e){return this.viewTypes.get(e)}},{key:"getWidgetType",value:function(e){return this.widgetTypes.get(e)}},{key:"getConnectionType",value:function(e){return this.connectionTypes.get(e)}},{key:"getRpcMethodType",value:function(e){return this.rpcMethods.get(e)}},{key:"addRendererType",value:function(e){return this.addElementType("renderer",e)}},{key:"addAdapterType",value:function(e){return this.addElementType("adapter",e)}},{key:"addTrackType",value:function(e){var t=this;return this.addElementType("track",(function(){var n=e(t);return t.getElementTypesInGroup("display").forEach((function(e){e.trackType!==n.name||n.displayTypes.includes(e)||n.addDisplayType(e)})),n}))}},{key:"addDisplayType",value:function(e){return this.addElementType("display",e)}},{key:"addViewType",value:function(e){var t=this;return this.addElementType("view",(function(){var n=e(t);return t.getElementTypesInGroup("display").forEach((function(e){e.viewType!==n.name||n.displayTypes.includes(e)||n.addDisplayType(e)})),n}))}},{key:"addWidgetType",value:function(e){return this.addElementType("widget",e)}},{key:"addConnectionType",value:function(e){return this.addElementType("connection",e)}},{key:"addRpcMethod",value:function(e){return this.addElementType("rpc method",e)}}]),e}(),ue=n(1608),le=n(84),de=n(139),fe=n(1012),pe=n(1266),ge=n(112),me=n(123),he=(n(1621),n(1622),n(537)),be=n.n(he),ve=n(416),ye=n.n(ve);function we(){return(we=Object(s.a)(o.a.mark((function e(t,n,r){var a,i,c,s,u,l,d,f,p,g;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://analytics.jbrowse.org/api/v1",a=t.jbrowse.tracks.filter((function(e){return(Object(A.readConfObject)(e,"assemblyNames")||[]).length>1})).length,i=Object.keys(localStorage).filter((function(e){return e.includes("localSaved-")})).length,c=t.jbrowse,s=t.session,u=t.version,l=c.tracks,d=c.assemblies,f=c.plugins,p={ver:u,"plugins-count":(null===f||void 0===f?void 0:f.length)||0,"plugin-names":null===f||void 0===f?void 0:f.map((function(e){return e.name})).join(","),"assemblies-count":d.length,"tracks-count":l.length,"session-tracks-count":(null===s||void 0===s?void 0:s.sessionTracks.length)||0,"open-views":(null===s||void 0===s?void 0:s.views.length)||0,"synteny-tracks-count":a,"saved-sessions-count":i,"existing-session-param-type":(null===r||void 0===r?void 0:r.split("-")[0])||"none","scn-h":window.screen.height,"scn-w":window.screen.width,"win-h":window.innerHeight,"win-w":window.innerWidth,electron:"undefined"!==typeof window&&Boolean(window.electron),loadTime:(Date.now()-n)/1e3,jb2:!0},l.forEach((function(e){p["track-types-".concat(e.type)]=p["track-types-".concat(e.type)]+1||1})),null===s||void 0===s||s.sessionTracks.forEach((function(e){p["sessionTrack-types-".concat(e.type)]=p["sessionTrack-types-".concat(e.type)]+1||1})),g=Object.keys(p).map((function(e){return"".concat(e,"=").concat(p[e])})).join("&"),e.abrupt("return",fetch("".concat("https://analytics.jbrowse.org/api/v1","?").concat(g)));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(){return(Oe=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"UA-7115575-5",a={"tracks-count":t.jbrowse.tracks.length,ver:t.version,electron:"undefined"!==typeof window&&Boolean(window.electron),loadTime:Date.now()-n,pluginNames:(null===(r=t.jbrowse.plugins)||void 0===r?void 0:r.map((function(e){return e.name})))||""},i="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){",i+="(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),",i+="m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)",i+="})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');",i+="ga('create', '".concat("UA-7115575-5","', 'auto', 'jbrowseTracker');"),c={},"tracks-count ver electron loadTime pluginNames","tracks-count ver electron loadTime pluginNames".split(/\s+/).forEach((function(e,t){c["dimension".concat(t+1)]=a[e]})),c.metric1=Math.round(a.loadTime),i+="ga('jbrowseTracker.send', 'pageview',".concat(JSON.stringify(c),");"),(s=document.createElement("script")).innerHTML=i,document.getElementsByTagName("head")[0].appendChild(s);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je=n(1623),ke=n.n(je),xe=n(1629),Ce=n.n(xe);function Se(e){return window.btoa(Array.from(window.crypto.getRandomValues(new Uint8Array(2*e))).map((function(e){return String.fromCharCode(e)})).join("")).replace(/[+/]/g,"").substring(0,e)}var Te=function(e,t){return ke.a.encrypt(e,t).toString()},Ee=function(e,t){return ke.a.decrypt(e,t).toString(Ce.a)};function Re(e){try{return JSON.parse(e).message}catch(t){return e}}function Me(e,t,n){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(s.a)(o.a.mark((function e(t,n,r){var a,i,c,s,u,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(Object(Y.toUrlSafeB64)(JSON.stringify(t))),i=Se(5),c=Te(a,i),(s=new FormData).append("session",c),s.append("dateShared","".concat(Date.now())),s.append("referer",r),e.next=9,fetch("".concat(n,"share"),{method:"POST",mode:"cors",body:s});case 9:if((u=e.sent).ok){e.next=15;break}return e.next=13,u.text();case 13:throw l=e.sent,new Error(Re(l));case 15:return e.next=17,u.json();case 17:return d=e.sent,e.abrupt("return",{json:d,encryptedSession:c,password:i});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e,t,n,r){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(s.a)(o.a.mark((function e(t,n,r,a){var i,c,s,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.split("share-")[1],c="".concat(t,"?sessionId=").concat(i),e.next=4,fetch(c,{signal:a});case 4:if((s=e.sent).ok){e.next=10;break}return e.next=8,s.text();case 8:throw u=e.sent,new Error(Re(u));case 10:return e.next=12,s.json();case 12:return l=e.sent,e.abrupt("return",Ee(l.session,r));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Fe=n(37),Ie=n(153),Be=n(140),De=n(206),Le=n(167),Ve=n(528),We=n(692);function ze(e,t,n,r){return He.apply(this,arguments)}function He(){return(He=Object(s.a)(o.a.mark((function e(t,n,r,a){var i,c,s,u,l,d,f,g,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.exportSVG,c=r.highResolutionScaling,s=void 0===c?1:c,!i||i.rasterizeLayers){e.next=7;break}return u=new We.b(t,n),l=u.getContext("2d"),e.next=6,a(l);case 6:return e.abrupt("return",{reactElement:u.getSerializedSvg()});case 7:if(!i||!i.rasterizeLayers){e.next=32;break}return 4,d=Object(We.c)(Math.ceil(4*t),4*n),(f=d.getContext("2d")).scale(4,4),e.next=14,a(f);case 14:if(e.t0=p.a,e.t1=t,e.t2=n,!d.convertToBlob){e.next=27;break}return e.t4=Y.blobToDataURL,e.next=21,d.convertToBlob({type:"image/png"});case 21:return e.t5=e.sent,e.next=24,(0,e.t4)(e.t5);case 24:e.t3=e.sent,e.next=28;break;case 27:e.t3=d.toDataURL();case 28:return e.t6=e.t3,e.t7={width:e.t1,height:e.t2,xlinkHref:e.t6},e.t8=e.t0.createElement.call(e.t0,"image",e.t7),e.abrupt("return",{reactElement:e.t8});case 32:return g=Object(We.c)(Math.ceil(t*s),n*s),(m=g.getContext("2d")).scale(s,s),e.next=37,a(m);case 37:return e.next=39,Object(We.d)(g);case 39:return e.t9=e.sent,e.abrupt("return",{imageData:e.t9});case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var qe=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(m.a)(n,[{key:"render",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var r,a,i,c,s,l,f,p,g,m=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFeatures(t);case 2:return r=e.sent,a=t.height,i=t.regions,c=t.bpPerPx,s=Object(d.a)(i,1),l=s[0],f=(l.end-l.start)/c,e.next=8,ze(f,a,t,(function(e){return m.draw(e,Object(u.a)(Object(u.a)({},t),{},{features:r}))}));case 8:return p=e.sent,e.next=11,Object(De.a)(Object(Le.a)(n.prototype),"render",this).call(this,Object(u.a)(Object(u.a)(Object(u.a)({},t),p),{},{features:r,height:a,width:f}));case 11:return g=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)(Object(u.a)({},g),p),{},{features:r,height:a,width:f}));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Ve.a),Ue=n(106);var _e=Object(le.observer)((function(e){var t=e.regions,n=e.features,r=e.bpPerPx,a=e.width,i=e.height,o=e.onMouseLeave,c=void 0===o?function(){}:o,s=e.onMouseMove,u=void 0===s?function(){}:s,l=e.onFeatureClick,g=void 0===l?function(){}:l,m=Object(d.a)(t,1)[0],h=Object(f.useRef)(null);function b(e){var t=0;h.current&&(t=h.current.getBoundingClientRect().left);var i,o,c=e-t,s=m.reversed?a-c:c,u=m.start+r*s,l=Object(Ue.a)(n.values());try{for(l.s();!(o=l.n()).done;){var d=o.value;if(u<=d.get("end")&&u>=d.get("start")){i=d;break}}}catch(f){l.e(f)}finally{l.f()}return i}return p.a.createElement("div",{ref:h,"data-testid":"wiggle-rendering-test",onMouseMove:function(e){var t=b(e.clientX);u(e,t?t.id():void 0)},onClick:function(e){var t=b(e.clientX);g(e,t?t.id():void 0)},onMouseLeave:function(e){return c(e)},role:"presentation",className:"WiggleRendering",style:{overflow:"visible",position:"relative",height:i}},p.a.createElement(me.PrerenderedCanvas,e))})),Ge=Object(A.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw"}}},{explicitlyTyped:!0}),Je=n(1062),Xe=n(2313),Ye=n(2467),Qe=n(2403);function $e(e){var t,n=e.domain,r=void 0===n?[]:n,a=e.range,i=void 0===a?[]:a,o=e.scaleType,c=e.pivotValue,s=e.inverted,u=Object(d.a)(r,2),l=u[0],f=u[1];if(void 0===l||void 0===f)throw new Error("invalid domain");if("linear"===o)t=Object(Xe.a)();else if("log"===o)(t=Object(Ye.a)()).base(2);else{if("quantize"!==o)throw new Error("undefined scaleType");t=Object(Qe.a)()}t.domain(void 0!==c?[l,c,f]:[l,f]),t.nice();var p=Object(d.a)(i,2),g=p[0],m=p[1];if(void 0===g||void 0===m)throw new Error("invalid range");return t.range(s?i.slice().reverse():i),t}function Ke(e){return"log"===e?1:0}function Ze(e){var t=e.scaleType,n=e.domain,r=e.bounds,a=Object(d.a)(r,2),i=a[0],o=a[1],c=Object(d.a)(n,2),s=c[0],u=c[1];if("linear"===t&&(u<0&&(u=0),s>0&&(s=0)),"log"===t&&(0===s||s>1)&&(s=1),void 0===s||void 0===u)throw new Error("invalid domain");void 0!==i&&i!==Number.MIN_VALUE&&(s=i),void 0!==o&&o!==Number.MAX_VALUE&&(u=o);var l=function(e){if("linear"===e)return Object(Xe.a)();if("log"===e){var t=Object(Ye.a)();return t.base(2),t}if("quantize"===e)return Object(Qe.a)();throw new Error("undefined scaleType ".concat(e))}(t);return l.domain([s,u]),l.nice(),l.domain()}var et=Object(A.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},highlightColor:{type:"color",description:"the color of highlights over the wiggle track",defaultValue:"rgba(255,255,0,0.5)"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},renderType:{type:"stringEnum",model:h.types.enumeration("Rendering type",["xyplot","density","line"]),description:"The type of rendering for wiggle data to use",defaultValue:"xyplot"},filled:{type:"boolean",description:"fill in histogram",defaultValue:!0},bicolorPivot:{type:"stringEnum",model:h.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"},summaryScoreMode:{type:"stringEnum",model:h.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{explicitlyTyped:!0}),tt=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"draw",value:function(e,t){var n,r,a=t.features,i=t.regions,o=t.bpPerPx,c=t.scaleOpts,s=t.height,l=t.config,f=Object(d.a)(i,1)[0],p=Object(A.readConfObject)(l,"bicolorPivot"),g=Object(A.readConfObject)(l,"bicolorPivotValue"),m=Object(A.readConfObject)(l,"negColor"),h=Object(A.readConfObject)(l,"posColor");"#f0f"===Object(A.readConfObject)(l,"color")?(r=$e("none"!==p?Object(u.a)(Object(u.a)({},c),{},{pivotValue:g,range:[m,"white",h]}):Object(u.a)(Object(u.a)({},c),{},{range:["white",h]})),n=function(e){return r(e.get("score"))}):n=function(e){return Object(A.readConfObject)(l,"color",{feature:e})};var b,v=Object(Ue.a)(a.values());try{for(v.s();!(b=v.n()).done;){var y=b.value,w=Object(Y.featureSpanPx)(y,f,o),O=Object(d.a)(w,2),j=O[0],k=O[1]-j+.3;e.fillStyle=n(y),e.fillRect(j,0,k,s)}}catch(x){v.e(x)}finally{v.f()}}}]),n}(qe),nt=Object(A.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:et,explicitlyTyped:!0});var rt=n(1075),at=n(2344),it=n(51),ot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return parseFloat(e.toPrecision(6))},ct=Object(it.a)((function(e){return{popper:{fontSize:"0.8em",zIndex:e.zIndex.tooltip,pointerEvents:"none"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:0,cursor:"default",position:"absolute",pointerEvents:"none"}}}));function st(e){var t=e.feature,n=t.get("refName"),r="".concat(n?"".concat(n,":"):""),a=(t.get("start")+1).toLocaleString("en-US"),i=t.get("end").toLocaleString("en-US"),o=a===i?a:"".concat(a,"..").concat(i),c="".concat(r).concat(o);return void 0!==t.get("summary")?p.a.createElement("div",null,c,p.a.createElement("br",null),"Max: ",ot(t.get("maxScore")),p.a.createElement("br",null),"Avg: ",ot(t.get("score")),p.a.createElement("br",null),"Min: ",ot(t.get("minScore"))):p.a.createElement("div",null,c,p.a.createElement("br",null),"".concat(ot(t.get("score"))))}var ut=Object(le.observer)((function(e){var t=e.model,n=e.height,r=e.mouseCoord,a=t.featureUnderMouse,i=ct();return a?p.a.createElement(p.a.Fragment,null,p.a.createElement(at.a,{placement:"right-start",className:i.popper,open:!0,title:p.a.createElement(st,{feature:a})},p.a.createElement("div",{style:{position:"absolute",left:r[0],top:5}}," ")),p.a.createElement("div",{className:i.hoverVertical,style:{left:r[0],height:n-2*gt}})):null})),lt=Object(le.observer)((function(e){var t=e.model,n=e.orientation,r=t.ticks;return p.a.createElement(rt.Axis,Object.assign({},r,{format:function(e){return e},style:{orient:"left"===n?rt.LEFT:rt.RIGHT}}))})),dt=Object(le.observer)((function(e){var t=e.model,n=t.ready,r=t.stats,a=t.height,i=t.needsScalebar;return p.a.createElement("div",null,p.a.createElement(Be.b,e),n&&r&&i?p.a.createElement("svg",{style:{position:"absolute",top:0,left:10,pointerEvents:"none",height:a,width:50}},p.a.createElement(lt,{model:t})):null)})),ft=Object(f.lazy)((function(){return n.e(73).then(n.bind(null,2408))})),pt=Object(f.lazy)((function(){return Promise.all([n.e(5),n.e(72)]).then(n.bind(null,2409))})),gt=5,mt=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]);function ht(e,t){return Math.log(t)/Math.log(e)}function bt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5;return(e>=0?1:-1)*Math.pow(t,1+Math.floor(ht(t,Math.abs(e))))}var vt=function(e,t){return h.types.compose("LinearWiggleDisplay",Be.a,h.types.model({type:h.types.literal("LinearWiggleDisplay"),configuration:Object(A.ConfigurationReference)(t),selectedRendering:h.types.optional(h.types.string,""),resolution:h.types.optional(h.types.number,1),fill:h.types.maybe(h.types.boolean),color:h.types.maybe(h.types.string),summaryScoreMode:h.types.maybe(h.types.string),rendererTypeNameState:h.types.maybe(h.types.string),scale:h.types.maybe(h.types.string),autoscale:h.types.maybe(h.types.string),displayCrossHatches:h.types.maybe(h.types.boolean),constraints:h.types.optional(h.types.model({max:h.types.maybe(h.types.number),min:h.types.maybe(h.types.number)}),{})})).volatile((function(){return{ready:!1,message:void 0,stats:Object(ge.observable)({scoreMin:0,scoreMax:50}),statsFetchInProgress:void 0}})).actions((function(e){return{updateStats:function(t){e.stats.scoreMin=t.scoreMin,e.stats.scoreMax=t.scoreMax,e.ready=!0},setColor:function(t){e.color=t},setLoading:function(t){var n=e.statsFetchInProgress;void 0===n||n.signal.aborted||n.abort(),e.statsFetchInProgress=t},selectFeature:function(t){var n=Object(Y.getSession)(e);Object(Y.isSelectionContainer)(n)&&n.setSelection(t)},setResolution:function(t){e.resolution=t},setFill:function(t){e.fill=t},toggleLogScale:function(){"log"!==e.scale?e.scale="log":e.scale="linear"},setScaleType:function(t){e.scale=t},setSummaryScoreMode:function(t){e.summaryScoreMode=t},setAutoscale:function(t){e.autoscale=t},setMaxScore:function(t){e.constraints.max=t},setRendererType:function(t){e.rendererTypeNameState=t},setMinScore:function(t){e.constraints.min=t},toggleCrossHatches:function(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches:function(t){e.displayCrossHatches=t}}})).views((function(e){return{get TooltipComponent(){return ut},get adapterTypeName(){return e.adapterConfig.type},get rendererTypeName(){var t=e.rendererTypeNameState||Object(A.getConf)(e,"defaultRendering"),n=mt.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},get filters(){},get scaleType(){return e.scale||Object(A.getConf)(e,"scaleType")},get filled(){return"undefined"!==typeof e.fill?e.fill:Object(A.readConfObject)(this.rendererConfig,"filled")},get maxScore(){var t=e.constraints.max;return void 0!==t?t:Object(A.getConf)(e,"maxScore")},get minScore(){var t=e.constraints.min;return void 0!==t?t:Object(A.getConf)(e,"minScore")},get rendererConfig(){var t=Object(A.getConf)(e,["renderers",this.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(u.a)(Object(u.a)({},t),{},{filled:e.fill,scaleType:this.scaleType,displayCrossHatches:e.displayCrossHatches,summaryScoreMode:e.summaryScoreMode,color:e.color}),Object(h.getEnv)(e))}}})).views((function(e){var t=[0,0];return{get summaryScoreModeSetting(){return e.summaryScoreMode||Object(A.readConfObject)(e.rendererConfig,"summaryScoreMode")},get domain(){var n=e.stats,r=e.scaleType,a=e.minScore,i=e.maxScore,o=Ze({domain:[n.scoreMin,n.scoreMax],bounds:[a,i],scaleType:r}),c=Object(A.getConf)(e,"headroom")||0;return"log"===r&&o[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(i===Number.MAX_VALUE&&o[1]>1&&(o[1]=bt(o[1]+c)),a===Number.MIN_VALUE&&o[0]<-1&&(o[0]=bt(o[0]-c)),JSON.stringify(t)!==JSON.stringify(o)&&(t=o),t)},get needsScalebar(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get scaleOpts(){return{domain:this.domain,stats:e.stats,autoscaleType:this.autoscaleType,scaleType:e.scaleType,inverted:Object(A.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get autoscaleType(){return e.autoscale||Object(A.getConf)(e,"autoscale")},get displayCrossHatchesSetting(){return e.displayCrossHatches||Object(A.readConfObject)(e.rendererConfig,"displayCrossHatches")}}})).views((function(t){var n=t.trackMenuItems;return{get ticks(){var e=t.scaleType,n=t.domain,r=t.height,a=$e({scaleType:e,domain:n,range:[r-gt,gt],inverted:Object(A.getConf)(t,"inverted")}),i=r<50?2:4;return Object(rt.axisPropsFromTickScale)(a,i)},get renderProps(){return Object(u.a)(Object(u.a)(Object(u.a)({},t.composedRenderProps),Object(T.getParentRenderProps)(t)),{},{notReady:!t.ready,rpcDriverName:t.rpcDriverName,displayModel:t,config:t.rendererConfig,scaleOpts:t.scaleOpts,resolution:t.resolution,height:t.height,ticks:this.ticks,displayCrossHatches:t.displayCrossHatches,filters:t.filters})},get adapterCapabilities(){return e.getAdapterType(t.adapterTypeName).adapterCapabilities},get hasResolution(){return this.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return this.adapterCapabilities.includes("hasGlobalStats")},get composedTrackMenuItems(){return[].concat(Object(c.a)(this.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){t.setResolution(5*t.resolution)}},{label:"Coarser resolution",onClick:function(){t.setResolution(t.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((function(e){return{label:e,onClick:function(){return t.setSummaryScoreMode(e)}}}))}]:[]),Object(c.a)(t.canHaveFill?[{label:t.filled?"Turn off histogram fill":"Turn on histogram fill",onClick:function(){t.setFill(!t.filled)}}]:[]),[{label:"log"===t.scaleType?"Set linear scale":"Set log scale",onClick:function(){t.toggleLogScale()}},{type:"checkbox",label:"Draw cross hatches",checked:t.displayCrossHatchesSetting,onClick:function(){t.toggleCrossHatches()}}],Object(c.a)(Object.keys(Object(A.getConf)(t,"renderers")||{}).length>1?[{label:"Renderer type",subMenu:Object(c.a)(mt.keys()).map((function(e){return{label:e,onClick:function(){return t.setRendererType(e)}}}))}]:[]),[{label:"Autoscale type",subMenu:[["local","Local"]].concat(Object(c.a)(this.hasGlobalStats?[["global","Global"],["globalsd","Global \xb1 3\u03c3"]]:[]),[["localsd","Local \xb1 3\u03c3"]]).map((function(e){var n=Object(d.a)(e,2),r=n[0];return{label:n[1],onClick:function(){t.setAutoscale(r)}}}))},{label:"Set min/max score",onClick:function(){Object(Y.getSession)(t).setDialogComponent(ft,{model:t})}},{label:"Set color",onClick:function(){Object(Y.getSession)(t).setDialogComponent(pt,{model:t})}}])},get trackMenuItems(){return[].concat(Object(c.a)(n),Object(c.a)(this.composedTrackMenuItems))}}})).actions((function(e){var t=e.reload,n=e.renderSvg;function r(e){return a.apply(this,arguments)}function a(){return(a=Object(s.a)(o.a.mark((function t(n){var r,a,i,c,s,l,d,f,p,g,m,b,v,y,w,O,j,k;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object(Y.getSession)(e),a=r.rpcManager,i=Object(A.getConf)(e,"numStdDev")||3,c=e.adapterConfig,s=e.autoscaleType,l=Object(T.getRpcSessionId)(e),d=Object(u.a)({sessionId:l,adapterConfig:c,statusCallback:function(t){Object(h.isAlive)(e)&&e.setMessage(t)}},n),"global"!==s&&"globalsd"!==s){t.next=11;break}return t.next=8,a.call(l,"WiggleGetGlobalStats",d);case 8:return f=t.sent,p=f.scoreMin,g=f.scoreMean,m=f.scoreStdDev,t.abrupt("return","globalsd"===s?Object(u.a)(Object(u.a)({},f),{},{scoreMin:p>=0?0:g-i*m,scoreMax:g+i*m}):f);case 11:if("local"!==s&&"localsd"!==s){t.next=18;break}return b=Object(Y.getContainingView)(e),v=b.dynamicBlocks,y=b.bpPerPx,t.next=15,a.call(l,"WiggleGetMultiRegionStats",Object(u.a)(Object(u.a)({},d),{},{assemblyName:Object(T.getTrackAssemblyNames)(e.parentTrack)[0],regions:JSON.parse(JSON.stringify(v.contentBlocks.map((function(e){var t=e.start,n=e.end;return Object(u.a)(Object(u.a)({},e),{},{start:Math.floor(t),end:Math.ceil(n)})})))),bpPerPx:y}));case 15:return w=t.sent,O=w.scoreMin,j=w.scoreMean,k=w.scoreStdDev,t.abrupt("return","localsd"===s?Object(u.a)(Object(u.a)({},w),{},{scoreMin:O>=0?0:j-i*k,scoreMax:j+i*k}):w);case 18:if("zscale"!==s){t.next=20;break}return t.abrupt("return",a.call(l,"WiggleGetGlobalStats",d));case 20:throw new Error("invalid autoscaleType '".concat(s,"'"));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{reload:function(){return Object(s.a)(o.a.mark((function n(){var a,i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.setError(),a=new AbortController,n.next=4,r({signal:a.signal,filters:e.filters});case 4:i=n.sent,Object(h.isAlive)(e)&&(e.updateStats(i),t());case 6:case"end":return n.stop()}}),n)})))()},afterAttach:function(){Object(h.addDisposer)(e,Object(ge.autorun)(Object(s.a)(o.a.mark((function t(){var n,a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=new AbortController,a=Object(Y.getContainingView)(e),e.setLoading(n),a.initialized){t.next=6;break}return t.abrupt("return");case 6:if(!(a.bpPerPx>e.maxViewBpPerPx)){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,r({signal:n.signal,filters:e.filters});case 10:i=t.sent,Object(h.isAlive)(e)&&e.updateStats(i),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),!Object(Y.isAbortException)(t.t0)&&Object(h.isAlive)(e)&&e.setError(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])}))),{delay:1e3}))},renderSvg:function(t){return Object(s.a)(o.a.mark((function r(){var a,i,c,s;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(ge.when)((function(){return e.ready&&!!e.regionCannotBeRenderedText}));case 2:return a=e.needsScalebar,i=e.stats,c=Object(Y.getContainingView)(e),s=c.offsetPx,r.t0=p.a,r.t1=p.a.Fragment,r.t2=p.a,r.t3={id:"snpcov"},r.next=10,n(t);case 10:return r.t4=r.sent,r.t5=r.t2.createElement.call(r.t2,"g",r.t3,r.t4),r.t6=a&&i?p.a.createElement("g",{transform:"translate(".concat(Math.max(-s,0),")")},p.a.createElement(lt,{model:e,orientation:"left"})):null,r.abrupt("return",r.t0.createElement.call(r.t0,r.t1,null,r.t5,r.t6));case 14:case"end":return r.stop()}}),r)})))()}}}))},yt=n(527),wt=n.n(yt),Ot=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"draw",value:function(e,t){var n=t.features,r=t.bpPerPx,a=t.regions,i=t.scaleOpts,o=t.height,c=t.config,s=t.ticks.values,l=t.displayCrossHatches,f=Object(d.a)(a,1)[0],p=(f.end-f.start)/r,g=gt,m=o-2*g,h=Object(A.readConfObject)(c,"bicolorPivotValue"),b=Object(A.readConfObject)(c,"negColor"),v=Object(A.readConfObject)(c,"posColor"),y=Object(A.readConfObject)(c,"filled"),w=Object(A.readConfObject)(c,"clipColor"),O=Object(A.readConfObject)(c,"highlightColor"),j=Object(A.readConfObject)(c,"summaryScoreMode"),k=$e(Object(u.a)(Object(u.a)({},i),{},{range:[0,m]})),x=Ke(i.scaleType),C=k.domain(),S=Object(d.a)(C,2),T=S[0],E=S[1],R=function(e){return m-k(e)+g},M=function(e){return R(x)-R(e)},P="#f0f"===Object(A.readConfObject)(c,"color")?function(e,t){return t<h?b:v}:function(e,t){return Object(A.readConfObject)(c,"color",{feature:e})};e.strokeStyle="grey",e.moveTo(0,R(0)),e.lineTo(p,R(0)),e.stroke();var N,F=T<h&&E>h,I=Object(Ue.a)(n.values());try{for(I.s();!(N=I.n()).done;){var B=N.value,D=Object(Y.featureSpanPx)(B,f,r),L=Object(d.a)(D,2),V=L[0],W=L[1],z=B.get("score"),H=B.get("maxScore"),q=B.get("minScore"),U=z<T,_=z>E,G=W-V+.4,J=B.get("summary");if("max"===j)z=J?H:z,e.fillStyle=P(B,z),e.fillRect(V,R(z),G,y?M(z):1);else if("min"===j)z=J?q:z,e.fillStyle=P(B,z),e.fillRect(V,R(z),G,y?M(z):1);else if("whiskers"===j){var X=P(B,z);J&&(e.fillStyle=F?P(B,H):wt()(X).lighten(.6).toString(),e.fillRect(V,R(H),G,y?M(H)-M(z):1)),e.fillStyle=F&&J?wt()(P(B,H)).mix(wt()(P(B,q))):X,e.fillRect(V,R(z),G,y?M(z)-(J?M(q):0):1),J&&(e.fillStyle=F?P(B,q):wt()(X).darken(.6).toString(),e.fillRect(V,R(q),G,y?M(q):1))}else e.fillStyle=P(B,z),e.fillRect(V,R(z),G,y?M(z):1);_?(e.fillStyle=w,e.fillRect(V,0,G,4)):U&&"log"!==i.scaleType&&(e.fillStyle=w,e.fillRect(V,o-4,G,4)),B.get("highlighted")&&(e.fillStyle=O,e.fillRect(V,0,G,m))}}catch(Q){I.e(Q)}finally{I.f()}l&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",s.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(R(t))),e.lineTo(p,Math.round(R(t))),e.stroke()})))}}]),n}(qe),jt=Object(A.ConfigurationSchema)("XYPlotRenderer",{},{baseConfiguration:et,explicitlyTyped:!0}),kt=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"draw",value:function(e,t){var n,r=t.features,a=t.regions,i=t.bpPerPx,o=t.scaleOpts,c=t.height,s=t.ticks.values,l=t.displayCrossHatches,f=t.config,p=Object(d.a)(a,1)[0],g=(p.end-p.start)/i,m=gt,h=c-2*m,b=Object(A.readConfObject)(f,"clipColor"),v=Object(A.readConfObject)(f,"highlightColor"),y=$e(Object(u.a)(Object(u.a)({},o),{},{range:[0,h]})),w=y.domain(),O=Object(d.a)(w,2),j=O[0],k=O[1],x=function(e){return h-y(e)+m},C="#f0f"===Object(A.readConfObject)(f,"color")?function(){return"grey"}:function(e){return Object(A.readConfObject)(f,"color",{feature:e})};e.strokeStyle="grey",e.moveTo(0,x(0)),e.lineTo(g,x(0)),e.stroke();var S,T=Object(Ue.a)(r.values());try{for(T.s();!(S=T.n()).done;){var E=S.value,R=Object(Y.featureSpanPx)(E,p,i),M=Object(d.a)(R,2),P=M[0],N=M[1],F=E.get("score"),I=F<j,B=F>k,D=N-P+.3,L=C(E);e.strokeStyle=L,e.beginPath(),p.reversed?(e.moveTo(N,x("undefined"!==typeof n?n:F)),e.lineTo(N,x(F)),e.lineTo(P,x(F))):(e.moveTo(P,x("undefined"!==typeof n?n:F)),e.lineTo(P,x(F)),e.lineTo(N,x(F))),e.stroke(),n=F,B?(e.fillStyle=b,e.fillRect(P,0,D,4)):I&&"log"!==o.scaleType&&(e.fillStyle=b,e.fillRect(P,h-4,D,h)),E.get("highlighted")&&(e.fillStyle=v,e.fillRect(P,0,D,h))}}catch(V){T.e(V)}finally{T.f()}l&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",s.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(x(t))),e.lineTo(g,Math.round(x(t))),e.stroke()})))}}]),n}(qe),xt=Object(A.ConfigurationSchema)("LinePlotRenderer",{},{baseConfiguration:et,explicitlyTyped:!0}),Ct=n(525),St=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="WiggleGetGlobalStats",e}return Object(m.a)(n,[{key:"deserializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(De.a)(Object(Le.a)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)({},a),{},{filters:t.filters?new Ct.a({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,e.next=6,U(this.pluginManager,i,a);case 6:if(c=e.sent,!((s=c.dataAdapter)instanceof X.BaseFeatureDataAdapter)){e.next=12;break}if(!s.capabilities.includes("hasGlobalStats")){e.next=11;break}return e.abrupt("return",s.getGlobalStats(r));case 11:throw new Error("Data adapter does not support global stats");case 12:throw new Error("Data adapter not found");case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),Tt=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="WiggleGetMultiRegionStats",e}return Object(m.a)(n,[{key:"deserializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t,r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(De.a)(Object(Le.a)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)({},a),{},{filters:t.filters?new Ct.a({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(n=this.pluginManager.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",Object(Y.renameRegionsIfNeeded)(a,Object(u.a)(Object(u.a)({},t),{},{filters:t.filters&&t.filters.toJSON().filters})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.regions,i=r.adapterConfig,c=r.sessionId,e.next=6,U(this.pluginManager,c,i);case 6:if(s=e.sent,!((u=s.dataAdapter)instanceof X.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",u.getMultiRegionStats(a,r));case 10:throw new Error("Data adapter not found");case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),Et=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="WigglePlugin",e.exports={LinearWiggleDisplayReactComponent:dt,XYPlotRendererReactComponent:_e,XYPlotRenderer:Ot,xyPlotRendererConfigSchema:jt,utils:a,WiggleBaseRenderer:qe,linearWiggleDisplayModelFactory:vt},e}return Object(m.a)(r,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(A.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:Object(Ie.createBaseTrackConfig)(e)});return new y.a({name:"QuantitativeTrack",configSchema:t,stateModel:Object(Ie.createBaseTrackModel)(e,"QuantitativeTrack",t)})})),e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return Object(A.ConfigurationSchema)("LinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:h.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:h.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:h.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:Object(A.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:Be.c,explicitlyTyped:!0})}(e);return new w.a({name:"LinearWiggleDisplay",configSchema:t,stateModel:vt(e,t),trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:dt})})),e.addAdapterType((function(){return new v.a({name:"BigWigAdapter",configSchema:Ge,adapterCapabilities:Je.adapterCapabilities,getAdapterClass:function(){return Promise.resolve().then(n.bind(null,1062)).then((function(e){return e.default}))}})})),e.addRendererType((function(){return new tt({name:"DensityRenderer",ReactComponent:_e,configSchema:nt,pluginManager:e})})),e.addRendererType((function(){return new kt({name:"LinePlotRenderer",ReactComponent:_e,configSchema:xt,pluginManager:e})})),e.addRendererType((function(){return new Ot({name:"XYPlotRenderer",ReactComponent:_e,configSchema:jt,pluginManager:e})})),e.addRpcMethod((function(){return new St(e)})),e.addRpcMethod((function(){return new Tt(e)}))}}]),r}(F.a),Rt=Object(A.ConfigurationSchema)("AlignmentsFeatureWidget",{});function Mt(e){return h.types.model("AlignmentsFeatureWidget",{id:B.ElementId,type:h.types.literal("AlignmentsFeatureWidget"),featureData:h.types.frozen(),view:h.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var Pt=h.types.late((function(){return Object(A.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam"}},index:Object(A.ConfigurationSchema)("BamIndex",{indexType:{model:h.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai"}}}),chunkSizeLimit:{type:"number",defaultValue:1e8},fetchSizeLimit:{type:"number",defaultValue:5e8},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),Nt=function(){return{configSchema:Pt,getAdapterClass:function(){return Promise.all([n.e(0),n.e(3),n.e(6),n.e(46)]).then(n.bind(null,1274)).then((function(e){return e.default}))}}},At=n(287),Ft=function(e){return e.lib["mobx-state-tree"].types.late((function(){return Object(A.ConfigurationSchema)("CramAdapter",{cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai"}},sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})}))},It=function(e){return{configSchema:e.load(Ft),getAdapterClass:function(){return Promise.all([n.e(3),n.e(15),n.e(47)]).then(n.bind(null,2458)).then((function(e){return e.default}))}}},Bt=h.types.late((function(){return Object(A.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",defaultValue:""},htsgetTrackId:{type:"string",defaultValue:""},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),Dt=function(){return{configSchema:Bt,getAdapterClass:function(){return Promise.all([n.e(0),n.e(3),n.e(6),n.e(36)]).then(n.bind(null,2410)).then((function(e){return e.default}))}}},Lt=function(e){var t=e.getDisplayType("LinearPileupDisplay").configSchema,n=e.getDisplayType("LinearSNPCoverageDisplay").configSchema;return Object(A.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:t,snpCoverageDisplay:n},{baseConfiguration:Be.c,explicitlyTyped:!0})},Vt=n(693),Wt=n.n(Vt),zt=function(e,t){return h.types.compose("LinearAlignmentsDisplay",Ie.BaseDisplay,h.types.model({PileupDisplay:h.types.maybe(e.getDisplayType("LinearPileupDisplay").stateModel),SNPCoverageDisplay:h.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:h.types.literal("LinearAlignmentsDisplay"),configuration:Object(A.ConfigurationReference)(t),height:250,showCoverage:!0,showPileup:!0})).volatile((function(){return{scrollTop:0}})).actions((function(e){return{toggleCoverage:function(){e.showCoverage=!e.showCoverage},togglePileup:function(){e.showPileup=!e.showPileup},setScrollTop:function(t){e.scrollTop=t},setSNPCoverageHeight:function(t){e.snpCovHeight=t}}})).views((function(e){var t=e.trackMenuItems;return{get pileupDisplayConfig(){var t=Object(A.getConf)(e,"pileupDisplay"),n=Object(Y.getContainingTrack)(e);return Object(u.a)(Object(u.a)({},t),{},{type:"LinearPileupDisplay",name:"".concat(Object(A.getConf)(n,"name")," pileup"),displayId:"".concat(e.configuration.displayId,"_pileup_xyz")})},get layoutFeatures(){return e.PileupDisplay.layoutFeatures},get features(){return e.PileupDisplay.features},get DisplayBlurb(){var t;return null===(t=e.PileupDisplay)||void 0===t?void 0:t.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get sortedByPosition(){return e.PileupDisplay.sortedByPosition},get sortedByRefName(){return e.PileupDisplay.sortedByRefName},get snpCoverageDisplayConfig(){var t=Object(A.getConf)(e,"snpCoverageDisplay"),n=Object(Y.getContainingTrack)(e);return Object(u.a)(Object(u.a)({},t),{},{type:"LinearSNPCoverageDisplay",name:"".concat(Object(A.getConf)(n,"name")," snp coverage"),displayId:"".concat(e.configuration.displayId,"_snpcoverage_xyz")})},get trackMenuItems(){return[].concat(Object(c.a)(t),[{type:"subMenu",label:"Pileup settings",subMenu:e.PileupDisplay.composedTrackMenuItems},{type:"subMenu",label:"SNPCoverage settings",subMenu:[].concat(Object(c.a)(e.SNPCoverageDisplay.composedTrackMenuItems),Object(c.a)(e.SNPCoverageDisplay.extraTrackMenuItems))}])}}})).actions((function(e){return{setSNPCoverageDisplay:function(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setUserBpPerPxLimit:function(t){e.PileupDisplay.setUserBpPerPxLimit(t),e.SNPCoverageDisplay.setUserBpPerPxLimit(t)},setPileupDisplay:function(t){e.PileupDisplay={type:"LinearPileupDisplay",configuration:t}},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n}}})).actions((function(e){return{afterAttach:function(){Object(h.addDisposer)(e,Object(ge.autorun)((function(){e.SNPCoverageDisplay?Wt()(e.snpCoverageDisplayConfig,Object(h.getSnapshot)(e.SNPCoverageDisplay.configuration))||(e.SNPCoverageDisplay.setHeight(e.snpCovHeight),e.SNPCoverageDisplay.setConfig(e.snpCoverageDisplayConfig)):e.setSNPCoverageDisplay(e.snpCoverageDisplayConfig),e.PileupDisplay?Wt()(e.pileupDisplayConfig,Object(h.getSnapshot)(e.PileupDisplay.configuration))||e.PileupDisplay.setConfig(e.pileupDisplayConfig):e.setPileupDisplay(e.pileupDisplayConfig),e.PileupDisplay.filterBy&&!Wt()(Object(h.getSnapshot)(e.PileupDisplay.filterBy),Object(h.getSnapshot)(e.SNPCoverageDisplay.filterBy))&&e.SNPCoverageDisplay.setFilterBy(Object(h.getSnapshot)(e.PileupDisplay.filterBy)),e.PileupDisplay.colorBy&&!Wt()(Object(h.getSnapshot)(e.PileupDisplay.colorBy),e.SNPCoverageDisplay.colorBy?Object(h.getSnapshot)(e.SNPCoverageDisplay.colorBy):{})&&e.SNPCoverageDisplay.setColorBy(Object(h.getSnapshot)(e.PileupDisplay.colorBy))}))),Object(h.addDisposer)(e,Object(ge.autorun)((function(){e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)})))},renderSvg:function(t){return Object(s.a)(o.a.mark((function n(){var r;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height-e.SNPCoverageDisplay.height,n.next=3,Object(ge.when)((function(){return e.PileupDisplay.ready}));case 3:return n.t0=p.a,n.t1=p.a.Fragment,n.t2=p.a,n.next=8,e.SNPCoverageDisplay.renderSvg(t);case 8:return n.t3=n.sent,n.t4=n.t2.createElement.call(n.t2,"g",null,n.t3),n.t5=p.a,n.t6={transform:"translate(0 ".concat(e.SNPCoverageDisplay.height,")")},n.next=14,e.PileupDisplay.renderSvg(Object(u.a)(Object(u.a)({},t),{},{overrideHeight:r}));case 14:return n.t7=n.sent,n.t8=n.t5.createElement.call(n.t5,"g",n.t6,n.t7),n.abrupt("return",n.t0.createElement.call(n.t0,n.t1,null,n.t4,n.t8));case 17:case"end":return n.stop()}}),n)})))()}}}))};var Ht=Object(le.observer)((function(e){var t=e.model,n=t.PileupDisplay,r=t.SNPCoverageDisplay,a=t.showPileup,i=t.showCoverage;return p.a.createElement("div",{"data-testid":"display-".concat(Object(A.getConf)(t,"displayId")),style:{position:"relative"}},p.a.createElement("div",{"data-testid":"Blockset-snpcoverage"},i?p.a.createElement(r.RenderingComponent,{model:r}):null),p.a.createElement(me.ResizeHandle,{onDrag:function(e){return r?(r.setHeight(r.height+e),e):0},style:{position:"absolute",top:i?r.height+2:0,height:3}}),p.a.createElement("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:i?r.height+5:0,height:3}},a?p.a.createElement(n.RenderingComponent,{model:n}):null))}));var qt=function(e){var t=e.getRendererType("PileupRenderer").configSchema,n=e.getRendererType("SvgFeatureRenderer").configSchema;return Object(A.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:h.types.enumeration("Rendering",["pileup","svg"]),defaultValue:"pileup"},renderers:Object(A.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:t,SvgFeatureRenderer:n}),renderer:"",maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:100},colorScheme:{type:"stringEnum",model:h.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:Object(Be.e)(e),explicitlyTyped:!0})},Ut=n(700),_t=n.n(Ut),Gt=n(255),Jt=n(420),Xt=n.n(Jt),Yt=n(697),Qt=n.n(Yt),$t=n(1076),Kt=n.n($t),Zt=n(1673),en=n.n(Zt),tn=n(1674),nn=n.n(tn),rn=n(2338);var an=Object(le.observer)((function(e){var t=e.model,n=t.sortedBy;return n?p.a.createElement("div",{"data-testid":"blurb-".concat(t.sortedBy),style:{backgroundColor:"white"}},p.a.createElement(rn.a,{color:"secondary",variant:"caption"},t.sortedBy?"Sorted by ".concat(n.type.toLowerCase()," at ").concat(n.refName,":").concat(n.pos):null)):null}));function on(e,t,n,r){return cn.apply(this,arguments)}function cn(){return(cn=Object(s.a)(o.a.mark((function e(t,n,r,a){var i,c,s,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(Y.getSession)(t),c=i.rpcManager,s=t.adapterConfig,l=Object(T.getRpcSessionId)(t),e.next=5,c.call(Object(T.getRpcSessionId)(t),"PileupGetGlobalValueForTag",Object(u.a)({adapterConfig:s,tag:n.tag,sessionId:l,regions:r.contentBlocks},a));case 5:return d=e.sent,e.abrupt("return",d);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sn(e,t,n,r,a){return un.apply(this,arguments)}function un(){return(un=Object(s.a)(o.a.mark((function e(t,n,r,a,i){var c,s,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object(Y.getSession)(t),s=c.rpcManager,l=Object(T.getRpcSessionId)(t),e.next=4,s.call(l,"PileupGetVisibleModifications",Object(u.a)({adapterConfig:n,tag:r.tag,sessionId:l,regions:a.contentBlocks},i));case 4:return d=e.sent,e.abrupt("return",d);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ln=Object(f.lazy)((function(){return n.e(49).then(n.bind(null,2411))})),dn=Object(f.lazy)((function(){return n.e(50).then(n.bind(null,2412))})),fn=Object(f.lazy)((function(){return n.e(53).then(n.bind(null,2413))})),pn=Object(f.lazy)((function(){return n.e(51).then(n.bind(null,2414))})),gn=Object(f.lazy)((function(){return n.e(52).then(n.bind(null,2415))})),mn=Object(f.lazy)((function(){return n.e(48).then(n.bind(null,2416))})),hn=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]),bn=function(e,t){return h.types.compose("LinearPileupDisplay",Be.a,h.types.model({type:h.types.literal("LinearPileupDisplay"),configuration:Object(A.ConfigurationReference)(t),showSoftClipping:!1,featureHeight:h.types.maybe(h.types.number),noSpacing:h.types.maybe(h.types.boolean),fadeLikelihood:h.types.maybe(h.types.boolean),trackMaxHeight:h.types.maybe(h.types.number),mismatchAlpha:h.types.maybe(h.types.boolean),sortedBy:h.types.maybe(h.types.model({type:h.types.string,pos:h.types.number,tag:h.types.maybe(h.types.string),refName:h.types.string,assemblyName:h.types.string})),colorBy:h.types.maybe(h.types.model({type:h.types.string,tag:h.types.maybe(h.types.string),extra:h.types.frozen()})),filterBy:h.types.optional(h.types.model({flagInclude:h.types.optional(h.types.number,0),flagExclude:h.types.optional(h.types.number,1536),readName:h.types.maybe(h.types.string),tagFilter:h.types.maybe(h.types.model({tag:h.types.string,value:h.types.string}))}),{})})).volatile((function(){return{colorTagMap:ge.observable.map({}),modificationTagMap:ge.observable.map({}),ready:!1,currBpPerPx:0}})).actions((function(e){return{setReady:function(t){e.ready=t},setCurrBpPerPx:function(t){e.currBpPerPx=t},setMaxHeight:function(t){e.trackMaxHeight=t},setFeatureHeight:function(t){e.featureHeight=t},setNoSpacing:function(t){e.noSpacing=t},setColorScheme:function(t){e.colorTagMap=ge.observable.map({}),e.colorBy=Object(h.cast)(t),e.ready=!1},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"];t.forEach((function(t){if(!e.modificationTagMap.has(t)){var r=Object(c.a)(e.modificationTagMap.keys()).length,a=n[r];e.modificationTagMap.set(t,a)}}))},updateColorTagMap:function(t){var n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((function(t){if(!e.colorTagMap.has(t)){var r=Object(c.a)(e.colorTagMap.keys()).length,a=n[r];e.colorTagMap.set(t,a)}}))}}})).actions((function(e){return{afterAttach:function(){Object(h.addDisposer)(e,Object(ge.autorun)(Object(s.a)(o.a.mark((function t(){var n,r,a,i,c,s,l,d,f,p,g,m;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=Object(Y.getSession)(e),r=n.rpcManager,a=e.sortedBy,i=e.colorBy,c=e.renderProps,s=Object(Y.getContainingView)(e),!(null===i||void 0===i?void 0:i.tag)){t.next=9;break}return t.next=7,on(e,i,s.staticBlocks);case 7:l=t.sent,e.updateColorTagMap(l);case 9:if("modifications"!==(null===i||void 0===i?void 0:i.type)){t.next=14;break}return t.next=12,sn(e,Object(A.getConf)(e.parentTrack,["adapter"]),i,s.staticBlocks);case 12:d=t.sent,e.updateModificationColorMap(d);case 14:if(!a){t.next=23;break}return f=a.pos,p=a.refName,g=a.assemblyName,m={start:f,end:(f||0)+1,refName:p,assemblyName:g},t.next=19,e.rendererType.renderInClient(r,Object(u.a)({assemblyName:g,regions:[m],adapterConfig:e.adapterConfig,rendererType:e.rendererType.name,sessionId:Object(T.getRpcSessionId)(e),timeout:1e6},c));case 19:e.setReady(!0),e.setCurrBpPerPx(s.bpPerPx),t.next=24;break;case 23:e.setReady(!0);case 24:t.next=30;break;case 26:t.prev=26,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 30:case"end":return t.stop()}}),t,null,[[0,26]])}))),{delay:1e3}))},selectFeature:function(t){var n=Object(Y.getSession)(e);if(Object(Y.isSessionModelWithWidgets)(n)){var r=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:Object(Y.getContainingView)(e)});n.showWidget(r)}n.setSelection(t)},clearSelected:function(){e.sortedBy=void 0},copyFeatureToClipboard:function(t){var n=t.toJSON();delete n.uniqueId;var r=Object(Y.getSession)(e);Xt()(JSON.stringify(n,null,4)),r.notify("Copied to clipboard","success")},toggleSoftClipping:function(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha:function(){e.mismatchAlpha=!e.mismatchAlpha},setConfig:function(t){e.configuration=t},setSortedBy:function(t,n){var r=Object(Y.getContainingView)(e).centerLineInfo;if(r){var a=r.refName,i=r.assemblyName,o=r.offset,c=Math.round(o)+1,s=a;c<0||(e.sortedBy={type:t,pos:c,refName:s,assemblyName:i,tag:n},e.ready=!1)}},setFilterBy:function(t){e.filterBy=Object(h.cast)(t)}}})).actions((function(e){var t=e.reload;return{reload:function(){e.clearSelected(),t()}}})).views((function(e){return{get maxHeight(){var t=Object(A.getConf)(e,["renderers",e.rendererTypeName])||{};return void 0!==e.trackMaxHeight?e.trackMaxHeight:t.maxHeight},get rendererConfig(){var t=Object(A.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(u.a)(Object(u.a)({},t),{},{height:e.featureHeight,noSpacing:e.noSpacing,maxHeight:this.maxHeight,mismatchAlpha:e.mismatchAlpha}),Object(h.getEnv)(e))},get featureHeightSetting(){return e.featureHeight||Object(A.readConfObject)(this.rendererConfig,"height")},get mismatchAlphaSetting(){return void 0!==e.mismatchAlpha?e.mismatchAlpha:Object(A.readConfObject)(this.rendererConfig,"mismatchAlpha")}}})).views((function(t){var n=t.trackMenuItems;return{get rendererTypeName(){var e=Object(A.getConf)(t,"defaultRendering"),n=hn.get(e);if(!n)throw new Error("unknown alignments view name ".concat(e));return n},get contextMenuItems(){var n=t.contextMenuFeature,r=n?[{label:"Open feature details",icon:Qt.a,onClick:function(){t.clearFeatureSelection(),n&&t.selectFeature(n)}},{label:"Copy info to clipboard",icon:Gt.a,onClick:function(){n&&t.copyFeatureToClipboard(n)}}]:[];return t.additionalContextMenuItemCallbacks.forEach((function(a){var i=a(n,t,e);r.push.apply(r,Object(c.a)(i))})),r},get DisplayBlurb(){return an},get filters(){var e=[];if(t.filterBy){var n=t.filterBy,r=n.flagInclude,a=n.flagExclude;if(e=["jexl:((get(feature,'flags')&".concat(r,")==").concat(r,") && !(get(feature,'flags')&").concat(a,")")],t.filterBy.tagFilter){var i=t.filterBy.tagFilter,o=i.tag,c=i.value;e.push('jexl:"'.concat(c,"\" =='*' ? getTag(feature,\"").concat(o,'") != undefined : getTag(feature,"').concat(o,'") == "').concat(c,'"'))}if(t.filterBy.readName){var s=t.filterBy.readName;e.push("jexl:get(feature,'name') == \"".concat(s,'"'))}}return new Ct.a({filters:e})},get renderProps(){var e=Object(Y.getContainingView)(t);return Object(u.a)(Object(u.a)(Object(u.a)({},t.composedRenderProps),Object(T.getParentRenderProps)(t)),{},{notReady:!t.ready||t.sortedBy&&t.currBpPerPx!==e.bpPerPx,rpcDriverName:t.rpcDriverName,displayModel:t,sortedBy:t.sortedBy,colorBy:t.colorBy,colorTagMap:JSON.parse(JSON.stringify(t.colorTagMap)),modificationTagMap:JSON.parse(JSON.stringify(t.modificationTagMap)),filters:this.filters,showSoftClip:t.showSoftClipping,config:t.rendererConfig})},get composedTrackMenuItems(){return[{label:"Show soft clipping",icon:_t.a,type:"checkbox",checked:t.showSoftClipping,onClick:function(){t.toggleSoftClipping(),t.showSoftClipping&&t.clearSelected()}},{label:"Sort by",icon:Kt.a,disabled:t.showSoftClipping,subMenu:[].concat(Object(c.a)(["Start location","Read strand","Base pair"].map((function(e){return{label:e,onClick:function(){return t.setSortedBy(e)}}}))),[{label:"Sort by tag...",onClick:function(){return Object(Y.getSession)(t).setDialogComponent(fn,{model:t})}},{label:"Clear sort",onClick:function(){return t.clearSelected()}}])},{label:"Color scheme",icon:en.a,subMenu:[{label:"Normal",onClick:function(){t.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:function(){t.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:function(){t.setColorScheme({type:"strand"})}},{label:"Pair orientation",onClick:function(){t.setColorScheme({type:"pairOrientation"})}},{label:"Per-base quality",onClick:function(){t.setColorScheme({type:"perBaseQuality"})}},{label:"Modifications or methylation",onClick:function(){Object(Y.getSession)(t).setDialogComponent(mn,{model:t})}},{label:"Insert size",onClick:function(){t.setColorScheme({type:"insertSize"})}},{label:"Stranded paired-end",onClick:function(){t.setColorScheme({type:"reverseTemplate"})}},{label:"Color by tag...",onClick:function(){Object(Y.getSession)(t).setDialogComponent(ln,{model:t})}}]},{label:"Filter by",icon:nn.a,onClick:function(){Object(Y.getSession)(t).setDialogComponent(dn,{model:t})}},{label:"Set feature height",onClick:function(){Object(Y.getSession)(t).setDialogComponent(pn,{model:t})}},{label:"Set max height",onClick:function(){Object(Y.getSession)(t).setDialogComponent(gn,{model:t})}},{label:"Fade mismatches by quality",type:"checkbox",checked:t.mismatchAlphaSetting,onClick:function(){t.toggleMismatchAlpha()}}]},get trackMenuItems(){return[].concat(Object(c.a)(n),Object(c.a)(this.composedTrackMenuItems))}}}))};var vn=Object(it.a)((function(e){return{popper:{fontSize:"0.8em",zIndex:e.zIndex.tooltip,pointerEvents:"none"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:0,cursor:"default",position:"absolute",pointerEvents:"none"}}}));function yn(e){var t=e.feature,n=t.get("refName"),r=(t.get("start")+1).toLocaleString("en-US"),a=t.get("end").toLocaleString("en-US"),i="".concat(n?"".concat(n,":"):"").concat(r===a?r:"".concat(r,"..").concat(a)),o=t.get("snpinfo"),c=o.total,s=o.ref,u=o.cov,l=o.noncov,f=o.lowqual,g=o.delskips;return p.a.createElement("div",null,p.a.createElement("table",null,p.a.createElement("caption",null,i),p.a.createElement("thead",null,p.a.createElement("tr",null,p.a.createElement("th",null,"Base"),p.a.createElement("th",null,"Count"),p.a.createElement("th",null,"% of Total"),p.a.createElement("th",null,"Strands"),p.a.createElement("th",null,"Source"))),p.a.createElement("tbody",null,p.a.createElement("tr",null,p.a.createElement("td",null,"Total"),p.a.createElement("td",null,c),p.a.createElement("td",null)),Object.entries({ref:s,cov:u,noncov:l,delskips:g,lowqual:f}).map((function(e){var t=Object(d.a)(e,2),n=t[0],r=t[1];return p.a.createElement(p.a.Fragment,{key:n},Object.entries(r).map((function(e){var t=Object(d.a)(e,2),r=t[0],a=t[1],i=a.strands;return p.a.createElement("tr",{key:r},p.a.createElement("td",null,r.toUpperCase()),p.a.createElement("td",null,a.total),p.a.createElement("td",null,"total"===r?"---":"".concat(Math.floor(a.total/c*100),"%")),p.a.createElement("td",null,i[-1]?"".concat(i[-1],"(-)"):"",i[1]?"".concat(i[1],"(+)"):""),p.a.createElement("td",null,n))})))})))))}var wn=Object(le.observer)((function(e){var t=e.model,n=e.height,r=e.mouseCoord,a=t.featureUnderMouse,i=vn();return a?p.a.createElement(p.a.Fragment,null,p.a.createElement(at.a,{placement:"right-start",className:i.popper,open:!0,title:p.a.createElement(yn,{feature:a})},p.a.createElement("div",{style:{position:"absolute",left:r[0],top:0}}," ")),p.a.createElement("div",{className:i.hoverVertical,style:{left:r[0],height:n}})):null})),On=new Map([["snpcoverage","SNPCoverageRenderer"]]),jn=function(e,t){return h.types.compose("LinearSNPCoverageDisplay",vt(e,t),h.types.model({type:h.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:h.types.maybe(h.types.boolean),drawIndicators:h.types.maybe(h.types.boolean),filterBy:h.types.optional(h.types.model({flagInclude:h.types.optional(h.types.number,0),flagExclude:h.types.optional(h.types.number,1536),readName:h.types.maybe(h.types.string),tagFilter:h.types.maybe(h.types.model({tag:h.types.string,value:h.types.string}))}),{}),colorBy:h.types.maybe(h.types.model({type:h.types.string,tag:h.types.maybe(h.types.string)}))})).volatile((function(){return{modificationTagMap:ge.observable.map({})}})).actions((function(e){return{setConfig:function(t){e.configuration=t},setFilterBy:function(t){e.filterBy=Object(h.cast)(t)},setColorBy:function(t){e.colorBy=Object(h.cast)(t)},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"],r=0;t.forEach((function(t){if(!e.modificationTagMap.has(t)){var a=n[r++];e.modificationTagMap.set(t,a)}}))}}})).views((function(e){return{get rendererConfig(){var t=Object(A.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(u.a)(Object(u.a)({},t),{},{drawInterbaseCounts:void 0===e.drawInterbaseCounts?t.drawInterbaseCounts:e.drawInterbaseCounts,drawIndicators:void 0===e.drawIndicators?t.drawIndicators:e.drawIndicators}),Object(h.getEnv)(e))},get drawInterbaseCountsSetting(){return void 0!==e.drawInterbaseCounts?e.drawInterbaseCounts:Object(A.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){return void 0!==e.drawIndicators?e.drawIndicators:Object(A.readConfObject)(this.rendererConfig,"drawIndicators")},get modificationsReady(){var t;return"modifications"!==(null===(t=e.colorBy)||void 0===t?void 0:t.type)||Object.keys(JSON.parse(JSON.stringify(e.modificationTagMap))).length>0},get renderProps(){return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(T.getParentRenderProps)(e)),{},{notReady:!e.ready||!this.modificationsReady,rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig,scaleOpts:e.scaleOpts,resolution:e.resolution,height:e.height,ticks:e.ticks,displayCrossHatches:e.displayCrossHatches,filters:e.filters,modificationTagMap:JSON.parse(JSON.stringify(e.modificationTagMap)),colorBy:e.colorBy?Object(h.getSnapshot)(e.colorBy):void 0})}}})).actions((function(e){return{toggleDrawIndicators:function(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts:function(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting},afterAttach:function(){Object(h.addDisposer)(e,Object(ge.autorun)(Object(s.a)(o.a.mark((function t(){var n,r,a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.colorBy,r=Object(Y.getContainingView)(e),a=r.staticBlocks,"modifications"!==(null===n||void 0===n?void 0:n.type)){t.next=8;break}return t.next=6,sn(e,Object(A.getConf)(e.parentTrack,"adapter"),n,a);case 6:i=t.sent,e.updateModificationColorMap(i);case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,10]])}))),{delay:1e3}))}}})).views((function(e){var t=e.trackMenuItems;return{get TooltipComponent(){return wn},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:Object(A.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return On.get("snpcoverage")},get needsScalebar(){return!0},get contextMenuItems(){return[]},get extraTrackMenuItems(){return[{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:function(){e.toggleDrawIndicators()}},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:function(){e.toggleDrawInterbaseCounts()}}]},get trackMenuItems(){return[].concat(Object(c.a)(t),Object(c.a)(e.composedTrackMenuItems),Object(c.a)(this.extraTrackMenuItems))},get filters(){var t=[];if(e.filterBy){var n=e.filterBy,r=n.flagInclude,a=n.flagExclude;if(t=["jexl:get(feature,'snpinfo') != undefined ? true : "+"((get(feature,'flags')&".concat(r,")==").concat(r,") && ")+"!((get(feature,'flags')&".concat(a,"))")],e.filterBy.tagFilter){var i=e.filterBy.tagFilter,o=i.tag,c=i.value;t.push("jexl:get(feature,'snpinfo') != undefined ? true : "+'"'.concat(c,"\" =='*' ? getTag(feature,\"").concat(o,'") != undefined : ')+'getTag(feature,"'.concat(o,'") == "').concat(c,'"'))}if(e.filterBy.readName){var s=e.filterBy.readName;t.push("jexl:get(feature,'snpinfo') != undefined ? true : "+"get(feature,'name') == \"".concat(s,'"'))}}return new Ct.a({filters:t})}}}))};var kn=Object(le.observer)((function(e){var t=e.onMouseMove,n=e.blockKey,r=e.displayModel,a=e.width,i=e.height,o=e.regions,c=e.bpPerPx,s=e.sortedBy,u=e.colorBy,l=r||{},g=l.selectedFeatureId,m=l.featureIdUnderMouse,h=l.contextMenuFeature,b=l.blockLayoutFeatures,v=Object(d.a)(o,1)[0],y=Object(f.useRef)(null),w=Object(f.useState)(!1),O=Object(d.a)(w,2),j=O[0],k=O[1],x=Object(f.useState)(!1),C=Object(d.a)(x,2),S=C[0],T=C[1];function E(e){j&&T(!0);var i=0,o=0;y.current&&(i=y.current.getBoundingClientRect().left,o=y.current.getBoundingClientRect().top),i=e.clientX-i,o=e.clientY-o;var s=v.reversed?a-i:i,u=v.start+c*s,l=r.getFeatureOverlapping(n,u,o),d=l.length?l[0].name:void 0;t&&t(e,d)}function R(t,n){var r=e["onFeature".concat(t)],a=e["on".concat(t)];r&&m?r(n,m):a&&a(n,m)}Object(f.useEffect)((function(){var e=y.current;if(e){var t=e.getContext("2d");if(t){var r,a;if(t.clearRect(0,0,e.width,e.height),g&&(a=b.get(n))&&(r=a.get(g))){var i=r,o=Object(d.a)(i,4),s=o[0],u=o[1],l=o[2],f=o[3],p=Object(Y.bpSpanPx)(s,l,v,c),w=Object(d.a)(p,2),O=w[0],j=w[1],k=Math.round(u),x=Math.round(f-u);t.shadowColor="#222266",t.shadowBlur=10,t.lineJoin="bevel",t.lineWidth=2,t.strokeStyle="#00b8ff",t.strokeRect(O-2,k-2,j-O+4,x+4),t.clearRect(O,k,j-O,x)}var C=m||(null===h||void 0===h?void 0:h.id());if(C&&(a=b.get(n))&&(r=a.get(C))){var S=r,T=Object(d.a)(S,4),E=T[0],R=T[1],M=T[2],P=T[3],N=Object(Y.bpSpanPx)(E,M,v,c),A=Object(d.a)(N,2),F=A[0],I=A[1],B=Math.round(R),D=Math.round(P-R);t.fillStyle="#0003",t.fillRect(F,B,I-F,D)}}}}),[c,v,g,m,h,n,b]);var M=Math.ceil(a);return p.a.createElement("div",{className:"PileupRendering","data-testid":"pileup-".concat(s||u?"".concat((null===s||void 0===s?void 0:s.type)||"").concat((null===u||void 0===u?void 0:u.type)||"").concat((null===u||void 0===u?void 0:u.tag)||""):"normal"),style:{position:"relative",width:M,height:i}},p.a.createElement(me.PrerenderedCanvas,Object.assign({},e,{style:{position:"absolute",left:0,top:0}})),p.a.createElement("canvas",{"data-testid":"pileup_overlay_canvas",width:M,height:i,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:y,onMouseDown:function(e){return function(e){k(!0),T(!1),R("MouseDown",e)}(e)},onMouseEnter:function(e){return function(e){R("MouseEnter",e)}(e)},onMouseOut:function(e){return function(e){R("MouseOut",e),R("MouseLeave",e)}(e)},onMouseOver:function(e){return function(e){R("MouseOver",e)}(e)},onMouseUp:function(e){return function(e){k(!1),R("MouseUp",e)}(e)},onMouseLeave:function(e){return function(e){R("MouseOut",e),R("MouseLeave",e)}(e)},onMouseMove:function(e){return E(e)},onClick:function(e){return function(e){S||R("Click",e)}(e)},onContextMenu:function(e){return function(e){R("ContextMenu",e)}(e)},onFocus:function(){},onBlur:function(){}}))})),xn=Object(A.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#c8c8c8",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:h.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orienation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:h.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing mismatch marker widths when zoomed out to e.g. 1px or 0.5px",defaultValue:0},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0}),Cn=n(474),Sn=n(354),Tn=n(720),En=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).sortedBy=void 0,r.showSoftClip=!1,r.cachedLayout=void 0,r.config=e.config,r}return Object(m.a)(n,[{key:"cachedLayoutIsValid",value:function(e){return Object(De.a)(Object(Le.a)(n.prototype),"cachedLayoutIsValid",this).call(this,e)&&this.showSoftClip===e.showSoftClip&&Wt()(this.sortedBy,e.sortedBy)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:Object(A.readConfObject)(this.config),filters:this.filters,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}]),n}(Cn.a);function Rn(e){return{A:e.palette.bases.A.main,C:e.palette.bases.C.main,G:e.palette.bases.G.main,T:e.palette.bases.T.main,deletion:"#808080"}}var Mn={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#999",color_interchrom:"orange",color_longinsert:"red",color_shortinsert:"pink"};function Pn(e){return!["methylation","modifications"].includes(e||"")}var Nn=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(m.a)(n,[{key:"getCharWidthHeight",value:function(e){return{charWidth:e.measureText("A").width,charHeight:e.measureText("M").width}}},{key:"layoutFeature",value:function(e,t,n,r,a,i){var o=0,c=0,s=e.get("mismatches"),u=e.get("seq");if(i&&u)for(var l=0;l<s.length;l+=1){var f=s[l],p=f.type,g=f.start,m=f.cliplen,h=void 0===m?0:m;"softclip"===p&&(0===g?o=h:c=h)}var b=Object(Y.bpSpanPx)(e.get("start")-o,e.get("end")+c,a,r),v=Object(d.a)(b,2),y=v[0],w=v[1],O=Object(A.readConfObject)(n,"height",{feature:e}),j=Object(A.readConfObject)(n,"displayMode",{feature:e});if("compact"===j&&(O/=3),e.get("refName")!==a.refName)throw new Error("feature ".concat(e.id()," is not on the current region's reference sequence ").concat(a.refName));var k=t.addRect(e.id(),e.get("start")-o,e.get("end")+c,O);return null===k?null:{feature:e,leftPx:y,rightPx:w,topPx:"collapse"===j?0:k,heightPx:O}}},{key:"getExpandedRegion",value:function(e,t){var n=t.config,r=t.showSoftClip,a=Object(A.readConfObject)(n,"maxClippingSize"),i=e.start,o=e.end,c=o-i,s=Math.max(c,r?Math.round(a):0);return Object(u.a)(Object(u.a)({},e),{},{start:Math.floor(Math.max(i-s,0)),end:Math.ceil(o+s)})}},{key:"colorByOrientation",value:function(e,t){return Mn[this.getOrientation(e,t)||"color_nostrand"]}},{key:"getOrientation",value:function(e,t){var n=Object(A.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[Tn.b[n][e.get("pair_orientation")]]}},{key:"colorByInsertSize",value:function(e,t){return e.get("is_paired")&&e.get("seq_id")!==e.get("next_seq_id")?"#555":"hsl(".concat(Math.abs(e.get("template_length"))/10,",50%,50%)")}},{key:"colorByStranded",value:function(e,t){var n=e.get("flags"),r=e.get("strand");if(1&n){var a=64&n?-1:1;return 2&n?r*a===1?"color_rev_strand":"color_fwd_strand":e.get("multi_segment_next_segment_unmapped")?r*a===1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("seq_id")===e.get("next_seq_id")?r*a===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return 1===r?"color_fwd_strand":"color_rev_strand"}},{key:"colorByPerBaseQuality",value:function(e,t,n,r,a){for(var i=t.feature,o=t.topPx,c=t.heightPx,s=(i.get("qual")||"").split(" ").map((function(e){return+e})),u=Object(At.parseCigar)(i.get("CIGAR")),l=1/a,f=i.get("start"),p=0,g=0,m=0;m<s.length;p+=2,m++){var h=+u[p],b=u[p+1];if("S"===b||"I"===b)m+=h;else if("D"===b||"N"===b)g+=h;else if("M"===b||"X"===b||"="===b){for(var v=0;v<h;v++){var y=s[m+v];e.fillStyle="hsl(".concat(255===y?150:1.5*y,",55%,50%)");var w=Object(Y.bpSpanPx)(f+g+v,f+g+v+1,r,a),O=Object(d.a)(w,1)[0];e.fillRect(O,o,l+.5,c)}g+=h}}}},{key:"colorByModifications",value:function(e,t,n,r,a,i){var o=t.feature,c=t.topPx,s=t.heightPx,u=i.modificationTagMap,l=void 0===u?{}:u,f=Object(Tn.a)(o,"MM","Mm")||"",p=Object(Tn.a)(o,"ML","Ml")||[],g=p?("string"===typeof p?p.split(",").map((function(e){return+e})):p).map((function(e){return e/255})):Object(Tn.a)(o,"MP","Mp").split("").map((function(e){return e.charCodeAt(0)-33})).map((function(e){return Math.min(1,e/50)})),m=o.get("CIGAR"),h=o.get("start"),b=o.get("end"),v=o.get("seq"),y=Object(At.parseCigar)(m),w=Object(At.getModificationPositions)(f,v),O=0;w.forEach((function(t){var n,i=t.type,o=t.positions,u=l[i]||"black",f=wt()(u),p=Object(Ue.a)(Object(At.getNextRefPos)(y,o));try{for(p.s();!(n=p.n()).done;){var m=n.value;if(m>=0&&h+m<b){var v=Object(Y.bpSpanPx)(h+m,h+m+1,r,a),w=Object(d.a)(v,2),j=w[0],k=w[1];e.fillStyle=f.alpha(g[O]+.1).hsl().string(),e.fillRect(j,c,k-j+.5,s)}O++}}catch(x){p.e(x)}finally{p.f()}}))}},{key:"colorByMethylation",value:function(e,t,n,r,a,i){var o=i.regionSequence,c=t.feature,s=t.topPx,u=t.heightPx,l=Object(Tn.a)(c,"MM","Mm")||"";if(!o)throw new Error("region sequence required for methylation");var f=c.get("CIGAR"),p=c.get("start"),g=c.get("end"),m=c.get("seq"),h=Object(At.parseCigar)(f),b=r.start,v=r.end,y=new Array(v-b).fill(0);Object(At.getModificationPositions)(l,m).forEach((function(e){var t=e.type,n=e.positions;if("m"===t&&n){var r,a=Object(Ue.a)(Object(At.getNextRefPos)(h,n));try{for(a.s();!(r=a.n()).done;){var i=r.value+p-b;i>=0&&i<y.length&&(y[i]=1)}}catch(o){a.e(o)}finally{a.f()}}}));for(var w=p;w<g;w++){var O=w-b;if(O>=0&&O<y.length){var j=o[O+1];if("C"===o[O].toUpperCase()&&"G"===j.toUpperCase()){var k=Object(Y.bpSpanPx)(b+O,b+O+1,r,a),x=Object(d.a)(k,2),C=x[0],S=x[1];y[O]?e.fillStyle="red":e.fillStyle="blue",e.fillRect(C,s,S-C+.5,u)}}}}},{key:"drawRect",value:function(e,t,n){var r=n.regions,a=n.bpPerPx,i=t.heightPx,o=t.topPx,c=t.feature,s=Object(d.a)(r,1)[0],u=Object(Y.bpSpanPx)(c.get("start"),c.get("end"),s,a),l=Object(d.a)(u,2),f=l[0],p=l[1],g=s.reversed?-1:1,m=c.get("strand")*g;a<10?-1===m?(e.beginPath(),e.moveTo(f-5,o+i/2),e.lineTo(f,o+i),e.lineTo(p,o+i),e.lineTo(p,o),e.lineTo(f,o),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(f,o),e.lineTo(f,o+i),e.lineTo(p,o+i),e.lineTo(p+5,o+i/2),e.lineTo(p,o),e.closePath(),e.fill()):e.fillRect(f,o,p-f,i)}},{key:"drawAlignmentRect",value:function(e,t,n){var r=n.config,a=n.bpPerPx,i=n.regions,o=n.colorBy,c=n.colorTagMap,s=void 0===c?{}:c,u=o||{},l=u.tag,d=void 0===l?"":l,f=u.type,p=void 0===f?"":f,g=t.feature,m=i[0];switch(p){case"insertSize":e.fillStyle=this.colorByInsertSize(g,r);break;case"strand":e.fillStyle=-1===g.get("strand")?"#8F8FD8":"#EC8B8B";break;case"mappingQuality":e.fillStyle="hsl(".concat(g.get("mq"),",50%,50%)");break;case"pairOrientation":e.fillStyle=this.colorByOrientation(g,r);break;case"stranded":e.fillStyle=Mn[this.colorByStranded(g,r)];break;case"xs":case"tag":var h=g.get("tags"),b=h?h[d]:g.get(d);if("XS"===d||"TS"===d){e.fillStyle=Mn[{"-":"color_rev_strand","+":"color_fwd_strand"}[b]||"color_nostrand"]}if("ts"===d){var v={"-":-1===g.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===g.get("strand")?"color_rev_strand":"color_fwd_strand"};e.fillStyle=Mn[v[b]||"color_nostrand"]}else{var y=s[b];e.fillStyle=y||"color_nostrand"}break;case"insertSizeAndPairOrientation":break;case"normal":default:e.fillStyle=Object(A.readConfObject)(r,"color",{feature:g})}switch(this.drawRect(e,t,n),p){case"perBaseQuality":this.colorByPerBaseQuality(e,t,r,m,a);break;case"modifications":this.colorByModifications(e,t,r,m,a,n);break;case"methylation":this.colorByMethylation(e,t,r,m,a,n)}}},{key:"drawMismatches",value:function(e,t,n,r,a,i){var o=i.mismatchAlpha,c=i.drawSNPs,s=void 0===c||c,u=i.drawIndels,l=void 0===u||u,f=n.config,p=n.bpPerPx,g=n.regions,m=t.heightPx,h=t.topPx,b=t.feature,v=this.getCharWidthHeight(e),y=v.charWidth,w=v.charHeight,O=Object(d.a)(g,1)[0],j=b.get("start"),k=Object(A.readConfObject)(f,"minSubfeatureWidth"),x=Object(A.readConfObject)(f,"largeInsertionIndicatorScale"),C=Math.min(1/p,2),S=Math.max(k,C),T=b.get("mismatches"),E=w-2;function R(e,t){var n=e;return o&&void 0!==t.qual&&(n=wt()(e).alpha(Math.min(1,t.qual/50)).hsl().string()),n}for(var M=0;M<T.length;M+=1){var P=T[M],N=Object(Y.bpSpanPx)(j+P.start,j+P.start+P.length,O,p),F=Object(d.a)(N,2),I=F[0],B=F[1],D=Math.max(k,Math.abs(I-B));if("mismatch"===P.type&&s){var L=a[P.base]||"#888";e.fillStyle=R(L,P),e.fillRect(I,h,D,m),D>=y&&m>=E&&(e.fillStyle=R(r.palette.getContrastText(L),P),e.fillText(P.base,I+(D-y)/2+1,h+m))}else if("deletion"===P.type&&l){var V=a.deletion;e.fillStyle=V,e.fillRect(I,h,D,m),D>=y&&m>=E&&(e.fillStyle=r.palette.getContrastText(V),e.fillText(P.base,I+(D-y)/2+1,h+m))}else if("insertion"===P.type&&l){e.fillStyle="purple";var W=I-1;(+P.base||P.length)<10&&(e.fillRect(W,h,S,m),1/p>=y&&(e.fillRect(W-S,h,3*S,1),e.fillRect(W-S,h+m-1,3*S,1)),1/p>=y&&m>=E&&e.fillText("(".concat(P.base,")"),I+2,h+m))}else if("hardclip"===P.type||"softclip"===P.type){e.fillStyle="hardclip"===P.type?"red":"blue";var z=I-1;e.fillRect(z,h+1,S,m-2),e.fillRect(z-S,h,3*S,1),e.fillRect(z-S,h+m-1,3*S,1),D>=y&&m>=E&&e.fillText("(".concat(P.base,")"),I+2,h+m)}else"skip"===P.type&&(I+D>0&&e.clearRect(I,h,D-(p>10?1.5:0),m),e.fillStyle="#333",e.fillRect(I,h+m/2,D,2))}if(l)for(var H=0;H<T.length;H+=1){var q=T[H],U=Object(Y.bpSpanPx)(b.get("start")+q.start,b.get("start")+q.start+q.length,O,p),_=Object(d.a)(U,1)[0],G=+q.base||q.length,J="".concat(G);if("insertion"===q.type&&G>=10)if(p>x)e.fillStyle="purple",e.fillRect(_-1,h,2,m);else if(m>w){var X=e.measureText(J);e.fillStyle="purple",e.fillRect(_-X.width/2-5,h,X.width+10,m),e.fillStyle="white",e.fillText(J,_-X.width/2,h+m)}else{e.fillStyle="purple",e.fillRect(_-2,h,4,m)}}}},{key:"drawSoftClipping",value:function(e,t,n,r,a){var i=t.feature,o=t.topPx,c=t.heightPx,s=n.regions,u=n.bpPerPx,l=Object(d.a)(s,1)[0],f=Object(A.readConfObject)(r,"minSubfeatureWidth"),p=i.get("mismatches"),g=i.get("seq"),m=this.getCharWidthHeight(e),h=m.charWidth,b=m.charHeight,v={A:a.palette.bases.A.main,C:a.palette.bases.C.main,G:a.palette.bases.G.main,T:a.palette.bases.T.main,deletion:"#808080"};g&&p.filter((function(e){return"softclip"===e.type})).forEach((function(t){for(var n=t.cliplen||0,r=0===t.start?i.get("start")-n:i.get("start")+t.start,s=0;s<n;s+=1){var p=g.charAt(s+t.start);if(!p)return;var m=Object(Y.bpSpanPx)(r+s,r+s+1,l,u),y=Object(d.a)(m,2),w=y[0],O=y[1],j=Math.max(f,Math.abs(w-O)),k=v[p]||"#000000";e.fillStyle=k,e.fillRect(w,o,j,c),j>=h&&c>=b-5&&(e.fillStyle=a.palette.getContrastText(k),e.fillText(p,w+(j-h)/2+1,o+c))}}))}},{key:"makeImageData",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i,c,s,u,l,d,f,p=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.layout,i=r.config,c=r.showSoftClip,s=r.colorBy,u=r.theme,l=Object(A.readConfObject)(i,"mismatchAlpha"),d=Object(me.createJBrowseTheme)(u),f=Rn(d),a){e.next=6;break}throw new Error("layout required");case 6:if(a.addRect){e.next=8;break}throw new Error("invalid layout object");case 8:t.font="bold 10px Courier New,monospace",n.forEach((function(e){if(null!==e){var n=e.feature,a=e.topPx,o=e.heightPx;t.fillStyle=Object(A.readConfObject)(i,"color",{feature:n}),p.drawAlignmentRect(t,{feature:n,topPx:a,heightPx:o},r),p.drawMismatches(t,e,r,d,f,{mismatchAlpha:l,drawSNPs:Pn(null===s||void 0===s?void 0:s.type),drawIndels:Pn(null===s||void 0===s?void 0:s.type)}),c&&p.drawSoftClipping(t,e,r,i,d)}}));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"layoutFeats",value:function(e){var t=this,n=e.layout,r=e.features,a=e.sortedBy,i=e.config,o=e.bpPerPx,c=e.showSoftClip,s=e.regions,u=Object(d.a)(s,1)[0];if(!n)throw new Error("layout required");if(!n.addRect)throw new Error("invalid layout object");var l=(a&&a.type&&u.start===a.pos?function(e,t){var n=Array.from(e.values()),r=[],a=[],i=t.pos,o=t.type;n.forEach((function(e){var t=e,n=t.get("start"),o=t.get("end");Object(Sn.a)(i-1,i,n,o)?r.push(e):a.push(e)}));var c=!!n.length&&n[0].get("tags");switch(o){case"Start location":r.sort((function(e,t){return e.get("start")-t.get("start")}));break;case"tag":var s=t.tag,u=function(e,t){return c?e.get("tags")[t]:e.get(t)};r[0]&&"string"===typeof u(r[0],s)?r.sort((function(e,t){return u(t,s).localeCompare(u(e,s))})):r.sort((function(e,t){return(u(t,s)||0)-(u(e,s)||0)}));break;case"Base pair":var l=[];r.forEach((function(e){e.get("mismatches").forEach((function(t){var n=e.get("start")+t.start+1,r="insertion"===t.type||"softclip"===t.type?0:t.length;i>=n&&i<n+r&&l.push([e.id(),t])}))}));var d=new Map(l);r.sort((function(e,t){var n=d.get(e.id()),r=d.get(t.id()),a=r&&r.base.toUpperCase(),i=n&&n.base.toUpperCase();return a===i&&"*"===a?n.length-r.length:(a?a.charCodeAt(0):0)-(i?i.charCodeAt(0):0)}));break;case"Read strand":r.sort((function(e,t){return e.get("strand")<=t.get("strand")?1:-1}))}return new Map(r.concat(a).map((function(e){return[e.id(),e]})))}(r,a):null)||r;return Object(Y.iterMap)(l.values(),(function(e){return t.layoutFeature(e,n,i,o,u,c)}),l.size)}},{key:"render",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var r,a,i,c,s,l,f,p,g,m,h,b,v,y,w,O,j,k=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bpPerPx,a=t.regions,e.next=3,this.getFeatures(t);case 3:if(i=e.sent,c=this.createLayoutInWorker(t),s=this.layoutFeats(Object(u.a)(Object(u.a)({},t),{},{features:i,layout:c})),!t.adapterConfig.sequenceAdapter){e.next=12;break}return e.next=9,U(this.pluginManager,t.sessionId,t.adapterConfig.sequenceAdapter);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0={};case 13:if(l=e.t0,f=l.dataAdapter,p=Object(d.a)(a,1),g=p[0],!f){e.next=22;break}return e.next=19,f.getFeatures({start:g.start,end:g.end+1,refName:g.refName,assemblyName:g.assemblyName}).pipe(Object(V.a)()).toPromise();case 19:e.t1=e.sent,e.next=23;break;case 22:e.t1=[];case 23:return m=e.t1,h=Object(d.a)(m,1),b=h[0],v=null===b||void 0===b?void 0:b.get("seq"),y=(g.end-g.start)/r,w=Math.max(c.getTotalHeight(),1),e.next=31,ze(y,w,t,(function(e){return k.makeImageData(e,s,Object(u.a)(Object(u.a)({},t),{},{layout:c,features:i,regionSequence:v}))}));case 31:return O=e.sent,e.next=34,Object(De.a)(Object(Le.a)(n.prototype),"render",this).call(this,Object(u.a)(Object(u.a)(Object(u.a)({},t),O),{},{features:i,layout:c,height:w,width:y}));case 34:return j=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)(Object(u.a)({},j),O),{},{features:i,layout:c,height:w,width:y,maxHeightReached:c.maxHeightReached}));case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSession",value:function(e){return new En(e)}}]),n}(Cn.b),An=function(e){return h.types.late((function(){return Object(A.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})}))},Fn=n(1675),In=function(e){return{getAdapterClass:function(){return Promise.resolve().then(n.bind(null,1675)).then((function(e){return e.default}))},configSchema:An(e),adapterCapabilities:Fn.capabilities}},Bn=Object(A.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.3},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0}},{explicitlyTyped:!0}),Dn=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"draw",value:function(e,t){var n=t.features,r=t.regions,a=t.bpPerPx,i=t.scaleOpts,o=t.height,c=t.theme,s=t.config,l=t.displayCrossHatches,f=t.ticks.values,p=t.modificationTagMap,g=Object(me.createJBrowseTheme)(c),m=Object(d.a)(r,1)[0],h=(m.end-m.start)/a,b=gt,v=o-2*b,y=Object(u.a)(Object(u.a)({},i),{},{range:[0,v]}),w=$e(y),O=$e(Object(u.a)(Object(u.a)({},y),{},{scaleType:"linear"})),j=Ke(i.scaleType),k=Ke("linear"),x=Object(A.readConfObject)(s,"indicatorThreshold"),C=Object(A.readConfObject)(s,"drawInterbaseCounts"),S=Object(A.readConfObject)(s,"drawIndicators"),T=function(e){return v-w(e)+b},E=function(e){return v-O(e)+b},R=function(e){return E(k)-E(e)},M={A:g.palette.bases.A.main,C:g.palette.bases.C.main,G:g.palette.bases.G.main,T:g.palette.bases.T.main,total:"lightgrey",insertion:"purple",softclip:"blue",hardclip:"red",meth:"red",unmeth:"blue",ref:"lightgrey"};e.fillStyle=M.total;var P,N,F=Object(Ue.a)(n.values());try{for(F.s();!(P=F.n()).done;){var I=P.value,B=Object(Y.featureSpanPx)(I,m,a),D=Object(d.a)(B,2),L=D[0],V=D[1]-L+.3,W=I.get("score");e.fillRect(L,T(W),V,(N=W,T(j)-T(N)))}}catch(U){F.e(U)}finally{F.f()}e.fillStyle="grey",e.beginPath(),e.lineTo(0,0),e.moveTo(0,h),e.stroke();var z,H=Object(Ue.a)(n.values());try{var q=function(){var t=z.value,n=Object(Y.featureSpanPx)(t,m,a),r=Object(d.a)(n,2),i=r[0],o=r[1],c=t.get("snpinfo"),s=Math.max(o-i+.3,1),u=c.total;Object.entries(c.cov).sort((function(e,t){var n=Object(d.a)(e,1)[0],r=Object(d.a)(t,1)[0];return n<r?-1:n>r?1:0})).reduce((function(t,n){var r=Object(d.a)(n,2),a=r[0],o=r[1].total;return e.fillStyle=M[a]||p[a.replace("mod_","")]||"red",e.fillRect(i,E(o+t),s,R(o)),t+o}),0);var l=Object.entries(c.noncov);if(C&&l.reduce((function(t,n){var r=Object(d.a)(n,2),a=r[0],o=r[1].total;return e.fillStyle=M[a],e.fillRect(i-.6,4.5+R(t),1.2,R(o)),t+o}),0),S){var f=0,g=0,h="";l.forEach((function(e){var t=Object(d.a)(e,2),n=t[0],r=t[1].total;f+=r,r>g&&(g=r,h=n)})),f>u*x&&u>7&&(e.fillStyle=M[h],e.beginPath(),e.moveTo(i-3,0),e.lineTo(i+3,0),e.lineTo(i,4.5),e.fill())}};for(H.s();!(z=H.n()).done;)q()}catch(U){H.e(U)}finally{H.f()}l&&(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",f.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(T(t))),e.lineTo(h,Math.round(T(t))),e.stroke()})))}}]),n}(qe),Ln=Object(A.ConfigurationSchema)("SNPCoverageRenderer",{},{baseConfiguration:Bn,explicitlyTyped:!0}),Vn=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="PileupGetGlobalValueForTag",e}return Object(m.a)(n,[{key:"serializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.pluginManager.rootModel,a=null===r||void 0===r||null===(n=r.session)||void 0===n?void 0:n.assemblyManager){e.next=4;break}throw new Error("no assembly manager available");case 4:return e.abrupt("return",Object(Y.renameRegionsIfNeeded)(a,t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,s,u,l,d,f,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,s=r.regions,u=r.tag,e.next=6,U(this.pluginManager,i,a);case 6:return l=e.sent.dataAdapter,d=l.getFeaturesInMultipleRegions(s),e.next=10,d.pipe(Object(V.a)()).toPromise();case 10:return f=e.sent,p=new Set,f.forEach((function(e){var t=e.get("tags"),n=t?t[u]:e.get(u);void 0!==n&&p.add("".concat(n))})),e.abrupt("return",Object(c.a)(p));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),Wn=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="PileupGetVisibleModifications",e}return Object(m.a)(n,[{key:"serializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.pluginManager.rootModel,a=null===r||void 0===r||null===(n=r.session)||void 0===n?void 0:n.assemblyManager){e.next=4;break}throw new Error("no assembly manager available");case 4:return e.abrupt("return",Object(Y.renameRegionsIfNeeded)(a,t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,s,u,l,d,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,s=r.regions,e.next=6,U(this.pluginManager,i,a);case 6:return u=e.sent.dataAdapter,l=u.getFeaturesInMultipleRegions(s),e.next=10,l.pipe(Object(V.a)()).toPromise();case 10:return d=e.sent,f=new Set,d.forEach((function(e){var t=Object(Tn.a)(e,"MM","Mm")||"";void 0!==t&&Object(At.getModificationTypes)(t).forEach((function(e){return f.add(e)}))})),e.abrupt("return",Object(c.a)(f));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(N),zn=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="AlignmentsPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(A.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:Object(Ie.createBaseTrackConfig)(e)}),n=new y.a({name:"AlignmentsTrack",configSchema:t,stateModel:Object(Ie.createBaseTrackModel)(e,"AlignmentsTrack",t)}),r=e.getDisplayType("LinearAlignmentsDisplay");return n.addDisplayType(r),n})),e.addDisplayType((function(){var t=qt(e);return new w.a({name:"LinearPileupDisplay",configSchema:t,stateModel:bn(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Be.b})})),e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("SNPCoverageRenderer").configSchema;return Object(A.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:h.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:h.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},maxDisplayedBpPerPx:{type:"number",description:"maximum bpPerPx that is displayed in the view",defaultValue:100},headroom:{type:"number",description:"round the upper value of the domain scale to the nearest N",defaultValue:0},renderers:Object(A.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:t})},{baseConfiguration:Be.c,explicitlyTyped:!0})}(e);return new w.a({name:"LinearSNPCoverageDisplay",configSchema:t,stateModel:jn(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:dt})})),e.addDisplayType((function(){var t=Lt(e);return new w.a({name:"LinearAlignmentsDisplay",configSchema:t,stateModel:zt(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:Ht})})),e.addWidgetType((function(){return new j.a({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:Rt,stateModel:Mt(e),ReactComponent:Object(f.lazy)((function(){return n.e(45).then(n.bind(null,2406))}))})})),e.addAdapterType((function(){return new v.a(Object(u.a)({name:"BamAdapter"},e.load(Nt)))})),e.addAdapterType((function(){return new v.a(Object(u.a)({name:"SNPCoverageAdapter"},e.load(In)))})),e.addAdapterType((function(){return new v.a(Object(u.a)({name:"CramAdapter"},e.load(It)))})),e.addAdapterType((function(){return new v.a(Object(u.a)({name:"HtsgetBamAdapter"},e.load(Dt)))})),e.addRendererType((function(){return new Nn({name:"PileupRenderer",ReactComponent:kn,configSchema:xn,pluginManager:e})})),e.addRendererType((function(){return new Dn({name:"SNPCoverageRenderer",ReactComponent:_e,configSchema:Ln,pluginManager:e})})),e.addRpcMethod((function(){return new Vn(e)})),e.addRpcMethod((function(){return new Wn(e)}))}}]),r}(F.a),Hn=Object(A.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb"}}},{explicitlyTyped:!0}),qn=Object(A.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz"}},index:Object(A.ConfigurationSchema)("TabixIndex",{indexType:{model:h.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0}),Un=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="BedPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new v.a({name:"BigBedAdapter",configSchema:Hn,getAdapterClass:function(){return Promise.all([n.e(9),n.e(38)]).then(n.bind(null,2417)).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new v.a({name:"BedTabixAdapter",configSchema:qn,getAdapterClass:function(){return Promise.all([n.e(0),n.e(2),n.e(4),n.e(9),n.e(37)]).then(n.bind(null,2418)).then((function(e){return e.default}))}})}))}}]),r}(F.a),_n=Object(A.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),Gn=h.types.model("BreakpointAlignmentsWidget",{id:B.ElementId,type:h.types.literal("BreakpointAlignmentsWidget"),featureData:h.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}})),Jn=n(1058),Xn=n(996),Yn=n.n(Xn);function Qn(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.filter((function(e){return t.includes(e)})),r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];return 0===a.length?n:Qn.apply(void 0,[n].concat(a))}function $n(e){var t=e.jbrequire,n=t("mobx-state-tree"),r=n.types,a=n.getParent,i=n.onAction,o=n.addDisposer,s=n.getPath,u=t("@jbrowse/core/pluggableElementTypes/models").BaseViewModel,l=r.model("BreakpointSplitView",{type:h.types.literal("BreakpointSplitView"),headerHeight:0,height:h.types.optional(h.types.refinement("viewHeight",h.types.number,(function(e){return e>=40})),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:h.types.array(e.getViewType("LinearGenomeView").stateModel)}).volatile((function(){return{width:800}})).views((function(e){return{get matchedTracks(){return Qn.apply(void 0,Object(c.a)(e.views.map((function(e){return e.tracks.map((function(e){return e.configuration.trackId}))}))))},get menuItems(){var t=[];return e.views.forEach((function(e,n){e.menuItems&&t.push({label:"View ".concat(n+1," Menu"),subMenu:e.menuItems})})),t},get viewDividerHeight(){return 3},getMatchedTracks:function(t){return e.views.map((function(e){return e.getTrack(t)})).filter((function(e){return!!e}))},hasPairedReads:function(e){return this.getTrackFeatures(e).find((function(e){return 64&e.get("flags")}))},hasTranslocations:function(e){return this.getTrackFeatures(e).find((function(e){return"translocation"===e.get("type")}))},getTrackFeatures:function(e){var t=this.getMatchedTracks(e);return new Jn.a((t||[]).map((function(e){return e.displays[0].features})))},getMatchedTranslocationFeatures:function(e){var t,n=this.getTrackFeatures(e),r=[],a=new Set,i=Object(Ue.a)(n.values());try{for(i.s();!(t=i.n()).done;){var o=t.value;a.has(o.id())||"<TRA>"===o.get("ALT")[0]&&r.push([o]),a.add(o.id())}}catch(c){i.e(c)}finally{i.f()}return r},getMatchedBreakendFeatures:function(e){var t,n=this.getTrackFeatures(e),r={},a=new Set,i=Object(Ue.a)(n.values());try{var o=function(){var e=t.value;a.has(e.id())||"breakend"===e.get("type")&&e.get("ALT").forEach((function(t){var n="".concat(e.get("refName"),":").concat(e.get("start")+1);if(Yn()(t)){var a=t;r[n]?r[n].push(e):r[a.MatePosition]=[e]}})),a.add(e.id())};for(i.s();!(t=i.n()).done;)o()}catch(c){i.e(c)}finally{i.f()}return Object.values(r).filter((function(e){return e.length>1}))},getMatchedAlignmentFeatures:function(e){var t,n=this.getTrackFeatures(e),r={},a=new Set,i=Object(Ue.a)(n.values());try{for(i.s();!(t=i.n()).done;){var o=t.value,c=o.id(),s=4&o.get("flags");if(!a.has(c)&&!s){var u=o.get("name");r[u]||(r[u]=[]),r[u].push(o)}a.add(o.id())}}catch(l){i.e(l)}finally{i.f()}return Object.values(r).filter((function(e){return e.length>1}))},getBadlyPairedAlignments:function(e){var t,n=this.getTrackFeatures(e),r={},a=new Set,i=Object(Ue.a)(n.values());try{for(i.s();!(t=i.n()).done;){var o=t.value,c=o.get("flags"),s=o.id(),u=4&c,l=2&c;if(!a.has(s)&&!l&&!u){var d=o.get("name");r[d]||(r[d]=[]),r[d].push(o)}a.add(o.id())}}catch(f){i.e(f)}finally{i.f()}return Object.values(r).filter((function(e){return e.length>1}))},getMatchedFeaturesInLayout:function(e,t){var n=this.getMatchedTracks(e),r=function(e,t){return e.displays[0].layoutFeatures.get(t.id())};return t.map((function(e){return e.map((function(e){var t=n.findIndex((function(t){return r(t,e)})),a=r(n[t],e);return{feature:e,layout:a,level:t}}))}))}}})).actions((function(e){return{afterAttach:function(){var t=this;o(e,i(e,(function(n){var r=n.name,a=n.path,i=n.args;if(e.linkViews){["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(r)&&a&&t.onSubviewAction(r,a,i)}})))},onSubviewAction:function(t,n,r){e.views.forEach((function(e){var a=s(e);a.lastIndexOf(n)!==a.length-n.length&&e[t](r[0])}))},setWidth:function(t){e.width=t,e.views.forEach((function(e){return e.setWidth(t)}))},removeView:function(t){e.views.remove(t)},closeView:function(){a(e,2).removeView(e)},setHeaderHeight:function(t){e.headerHeight=t},toggleInteract:function(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks:function(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews:function(){e.linkViews=!e.linkViews}}}));return{stateModel:r.compose(u,l)}}var Kn=n(526),Zn=n.n(Kn),er=[0,1,2,3],tr=er[1],nr=er[3];function rr(e,t,n){return((e.bpToPx({refName:t,coord:n})||{}).offsetPx||0)-e.offsetPx}function ar(e,t,n,r,a){var i,o=r[t].displays[0],c=o.height,s=0,u=o.showCoverage,l=o.SNPCoverageDisplay;return l&&u&&(s=l.height+5),Object(Y.clamp)(a[tr]-o.scrollTop+((i=a)[nr]-i[tr])/2+s,0,c)+function(e,t,n){var r=e[n].trackRefs[t];return(null===r||void 0===r?void 0:r.getBoundingClientRect().top)||0}(n,e,t)+o.scrollTop}var ir=function(e){var t=Object(f.useState)(),n=Object(d.a)(t,2)[1];Object(f.useEffect)((function(){n(e)}),[e])},or=[0,1,2,3],cr=or[0],sr=or[2],ur=Object(le.observer)((function(e){var t=e.model,n=e.trackConfigId,r=e.parentRef,a=t.views,i=t.showIntraviewLinks,o=Object(Y.getSession)(t).assemblyManager,c=Object(Y.getSession)(t),s=Object(h.getSnapshot)(t);ir(s);var u=o.get(a[0].assemblyNames[0]);if(!u)return null;var l=t.getTrackFeatures(n),g=t.hasPairedReads(n)?t.getBadlyPairedAlignments(n):t.getMatchedAlignmentFeatures(n),m=t.getMatchedFeaturesInLayout(n,g);m.forEach((function(e){e.sort((function(e,t){return e.feature.get("clipPos")-t.feature.get("clipPos")}))}));var b=Object(f.useState)(),v=Object(d.a)(b,2),y=v[0],w=v[1],O=0;if(r.current){var j=r.current.getBoundingClientRect();O=j.top}return p.a.createElement("g",{stroke:"#333",fill:"none","data-testid":m.length?"".concat(n,"-loaded"):n},m.map((function(e){for(var t=[],r=function(r){var o=e[r],s=o.layout,d=o.feature,f=o.level,g=e[r+1],m=g.layout,h=g.feature,b=g.level;if(!s||!m)return console.warn("received null layout for a overlay feature"),{v:null};if(!i&&f===b)return{v:null};var v=d.get("refName"),j=h.get("refName"),k=u.getCanonicalRefName(v),x=u.getCanonicalRefName(j);if(!k||!x)throw new Error("unable to find ref for ".concat(k||x));var C=rr(a[f],k,s[-1===d.get("strand")?cr:sr]),S=rr(a[b],x,m[-1===h.get("strand")?sr:cr]),T=a[f].pxToBp(C).reversed,E=a[b].pxToBp(S).reversed,R=a.map((function(e){return e.getTrack(n)})),M=ar(n,f,a,R,s)-O,P=ar(n,b,a,R,m)-O,N=Zn()().moveTo(C,M).curveTo(C+200*d.get("strand")*(T?-1:1),M,S-200*h.get("strand")*(E?-1:1),P,S,P).end(),A="".concat(d.id(),"-").concat(h.id());t.push(p.a.createElement("path",{d:N,key:A,"data-testid":"r1",strokeWidth:y===A?5:1,onClick:function(){var e,t,n=null===(e=c.addWidget)||void 0===e?void 0:e.call(c,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(l.get(d.id())||{toJSON:function(){}}).toJSON(),feature2:(l.get(h.id())||{toJSON:function(){}}).toJSON()}});null===(t=c.showWidget)||void 0===t||t.call(c,n)},onMouseOver:function(){return w(A)},onMouseOut:function(){return w(void 0)}}))},o=0;o<e.length-1;o+=1){var s=r(o);if("object"===typeof s)return s.v}return t})))}));var lr=Object(le.observer)((function(e){var t=e.model,n=e.trackConfigId,r=e.parentRef,a=t.views,i=Object(Y.getSession)(t),o=i.assemblyManager,c=t.getTrackFeatures(n),s=t.getMatchedBreakendFeatures(n),u=t.getMatchedFeaturesInLayout(n,s),l=Object(f.useState)(),g=Object(d.a)(l,2),m=g[0],b=g[1],v=Object(h.getSnapshot)(t);ir(v);var y=o.get(a[0].assemblyNames[0]);if(!y)return null;var w=0;if(r.current){var O=r.current.getBoundingClientRect();w=O.top}return p.a.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":u.length?"".concat(n,"-loaded"):n},u.map((function(e){for(var t=[],r=function(r){var o=e[r],s=o.layout,u=o.feature,l=o.level,d=e[r+1],f=d.layout,g=d.feature,h=d.level,v=u.id(),O=function(e,t){var n={};return e.get("ALT").forEach((function(e){n[e.MatePosition]=e})),n["".concat(t.get("refName"),":").concat(t.get("start")+1)]}(u,g);if(!s||!f)return{v:null};var j=u.get("refName"),k=g.get("refName"),x=y.getCanonicalRefName(j),C=y.getCanonicalRefName(k);if(!x||!C)throw new Error("unable to find ref for ".concat(x||C));var S=rr(a[l],x,s[0]),T=rr(a[h],C,f[0]),E=a[l].pxToBp(S).reversed,R=a[h].pxToBp(T).reversed,M=a.map((function(e){return e.getTrack(n)})),P=ar(n,l,a,M,s)-w,N=ar(n,h,a,M,f)-w;if(O){var A=Zn()().moveTo(S-20*("left"===O.Join?-1:1)*(E?-1:1),P).lineTo(S,P).lineTo(T,N).lineTo(T-20*("left"===O.MateDirection?1:-1)*(R?-1:1),N).end();t.push(p.a.createElement("path",{d:A,key:JSON.stringify(A),strokeWidth:v===m?10:5,onClick:function(){var e,t,n=null===(e=i.addWidget)||void 0===e?void 0:e.call(i,"VariantFeatureWidget","variantFeature",{featureData:c.get(v)});null===(t=i.showWidget)||void 0===t||t.call(i,n)},onMouseOver:function(){return b(v)},onMouseOut:function(){return b(void 0)}}))}else console.warn("the relevant ALT allele was not found, cannot render")},o=0;o<e.length-1;o+=1){var s=r(o);if("object"===typeof s)return s.v}return t})))})),dr=n(721),fr=n(2342),pr=n(722),gr=n.n(pr),mr=n(723),hr=n.n(mr),br=n(726),vr=n.n(br),yr=n(727),wr=n.n(yr),Or=n(724),jr=n.n(Or),kr=n(725),xr=n.n(kr),Cr=Object(it.a)((function(e){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},iconButton:{},spacer:{flexGrow:1},emphasis:{background:e.palette.secondary.main,padding:e.spacing(1)},hovered:{background:e.palette.secondary.light},displayName:{background:e.palette.secondary.main,paddingTop:3,paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),Sr=Object(le.observer)((function(e){var t=e.model,n=Cr();return p.a.createElement(fr.a,{onClick:function(){return t.toggleInteract()},className:n.iconButton,title:"Toggle interacting with the overlay"},t.interactToggled?p.a.createElement(gr.a,null):p.a.createElement(hr.a,null))})),Tr=Object(le.observer)((function(e){var t=e.model,n=Cr();return p.a.createElement(fr.a,{onClick:function(){return t.toggleLinkViews()},className:n.iconButton,title:"Toggle linked scrolls and behavior across views"},t.linkViews?p.a.createElement(jr.a,{color:"secondary"}):p.a.createElement(xr.a,{color:"secondary"}))})),Er=Object(le.observer)((function(e){var t=e.model,n=Cr();return p.a.createElement(fr.a,{onClick:t.toggleIntraviewLinks,className:n.iconButton,title:"Toggle rendering intraview links"},t.showIntraviewLinks?p.a.createElement(vr.a,{color:"secondary"}):p.a.createElement(wr.a,{color:"secondary"}))})),Rr=Object(le.observer)((function(e){var t=e.model,n=e.size,r=Cr();return t.setHeaderHeight(n.height),p.a.createElement("div",{className:r.headerBar},p.a.createElement(Tr,{model:t}),p.a.createElement(Sr,{model:t}),p.a.createElement(Er,{model:t}),p.a.createElement("div",{className:r.spacer}))})),Mr=Object(dr.withSize)({monitorHeight:!0})(Rr),Pr=Object(le.observer)((function(e){var t=e.model,n=e.trackConfigId,r=e.parentRef,a=t.views,i=Object(Y.getSession)(t),o=t.getMatchedTranslocationFeatures(n),c=t.getTrackFeatures(n),s=t.getMatchedFeaturesInLayout(n,o),u=Object(f.useState)(),l=Object(d.a)(u,2),g=l[0],m=l[1],b=Object(h.getSnapshot)(t);if(ir(b),!i.assemblyManager.get(a[0].assemblyNames[0]))return null;var v=0;if(r.current){var y=r.current.getBoundingClientRect();v=y.top}return a.length<2?null:p.a.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":s.length?"".concat(n,"-loaded"):n},s.map((function(e){for(var t=[],r=function(r){var o=e[r],s=o.layout,u=o.feature,l=o.level,f=0===l?1:0,h=u.id();if(!s)return{v:null};var b=u.get("INFO"),y=b.CHR2[0],w=b.END[0],O=b.STRANDS[0].split(""),j=Object(d.a)(O,2),k=j[0],x=j[1],C=rr(a[f],y,w);if(C){var S=[C,0,C+1,0],T=rr(a[l],u.get("refName"),s[0]),E=C,R=a[l].pxToBp(T).reversed,M=a[f].pxToBp(E).reversed,P=a.map((function(e){return e.getTrack(n)})),N=ar(n,l,a,P,s)-v,A=ar(n,f,a,P,S)-v,F=Zn()().moveTo(T-20*("+"===k?1:-1)*(R?-1:1),N).lineTo(T,N).lineTo(E,A).lineTo(E-20*("+"===x?1:-1)*(M?-1:1),A).end();t.push(p.a.createElement("path",{d:F,key:JSON.stringify(F),strokeWidth:h===g?10:5,onClick:function(){var e,t,n=null===(e=i.addWidget)||void 0===e?void 0:e.call(i,"VariantFeatureWidget","variantFeature",{featureData:(c.get(h)||{toJSON:function(){}}).toJSON()});null===(t=i.showWidget)||void 0===t||t.call(i,n)},onMouseOver:function(){return m(h)},onMouseOut:function(){return m(void 0)}}))}},o=0;o<e.length;o+=1){var s=r(o);if("object"===typeof s)return s.v}return t})))})),Nr=Object(it.a)((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},breakpointMarker:{position:"absolute",top:0,height:"100%",width:"3px",background:"magenta"},viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}},content:{gridArea:"1/1"}}})),Ar=Object(le.observer)((function(e){var t=e.model,n=e.trackConfigId,r=t.getMatchedTracks(n);return"PileupTrack"===r[0].type||"AlignmentsTrack"===r[0].type?p.a.createElement(ur,e):"VariantTrack"===r[0].type?t.hasTranslocations(n)?p.a.createElement(Pr,e):p.a.createElement(lr,e):null})),Fr=Object(le.observer)((function(e){var t=e.model,n=Nr(),r=t.views,a=Object(h.getEnv)(t).pluginManager,i=Object(f.useRef)(null);return p.a.createElement("div",null,p.a.createElement(Mr,{model:t}),p.a.createElement("div",{className:n.container},p.a.createElement("div",{className:n.content},p.a.createElement("div",{style:{position:"relative"}},r.map((function(e,t){var i=a.getViewType(e.type).ReactComponent,o=p.a.createElement(i,{key:e.id,model:e});return t===r.length-1?o:[o,p.a.createElement("div",{key:"".concat(e.id,"-divider"),className:n.viewDivider})]})))),p.a.createElement("div",{className:n.overlay},p.a.createElement("svg",{ref:i,style:{width:"100%",zIndex:10,pointerEvents:t.interactToggled?void 0:"none"}},t.matchedTracks.map((function(e){return p.a.createElement(Ar,{parentRef:i,key:e,model:t,trackConfigId:e})}))))))})),Ir=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"snapshotFromBreakendFeature",value:function(e,t){var n,r=(e.get("ALT")||[])[0],a=e.get("start"),i=t.displayedRegions[0].assemblyName,o=Object(Y.getSession)(t).assemblyManager.get(i);if(!o)throw new Error("assembly ".concat(i," not found"));if(!o.regions)throw new Error("assembly ".concat(i," regions not loaded"));var c,s=o.getCanonicalRefName,l=s(e.get("refName")),d=o.regions.find((function(e){return e.refName===String(l)})),f=0,p=0;if(r)if("<TRA>"===r){var g=e.get("INFO")||[];n=g.END[0]-1,c=s(g.CHR2[0])}else{var m=r.MatePosition.split(":");n=parseInt(m[1],10)-1,c=s(m[0]),"left"===r.Join&&(f=-1),"left"===r.MateDirection&&(p=-1)}else if(e.get("mate")){var h=e.get("mate");c=s(h.refName),n=h.start}if(!c)return console.warn("unable to resolve mate refName ".concat(c," in reference genome")),{};var b=o.regions.find((function(e){return e.refName===String(c)}));if(!d||!b)return console.warn("unable to find the refName for the top or bottom of the breakpoint view"),{};var v=[Object(u.a)({},d),Object(u.a)({},d)],y=[Object(u.a)({},b),Object(u.a)({},b)];return v[0].end=a+f,v[1].start=a+f,y[0].end=n+p,y[1].start=n+p,{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:v,hideHeader:!0,bpPerPx:10,offsetPx:(d.start+e.get("start"))/10},{type:"LinearGenomeView",displayedRegions:y,hideHeader:!0,bpPerPx:10,offsetPx:(b.start+n)/10}],displayName:"".concat(e.get("name")||e.get("id")||"breakend"," split detail")}}}]),n}(O.a),Br=function(e){var t=(0,e.load)($n).stateModel;return new Ir({name:"BreakpointSplitView",stateModel:t,ReactComponent:Fr})},Dr=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="BreakpointSplitViewPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(Br)})),e.addWidgetType((function(){return new j.a({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:_n,stateModel:Gn,ReactComponent:Object(f.lazy)((function(){return n.e(54).then(n.bind(null,2419))}))})}))}},{key:"configure",value:function(){}}]),r}(F.a),Lr=n(852),Vr=n(853),Wr=n(1716),zr=n.n(Wr),Hr=n(1717),qr=n.n(Hr),Ur=n(1718),_r=n.n(Ur),Gr=Object(A.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:Ie.baseConnectionConfig}),Jr=n(1081);"ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9".split(/\r?\n/);function Xr(){return(Xr=Object(s.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(de.openLocation)(t).readFile("utf8");case 3:return n=e.sent,e.abrupt("return",new Jr.HubFile(n));case 7:throw e.prev=7,e.t0=e.catch(0),new Error("Not a valid hub.txt file, got error: '".concat(e.t0,"'"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function Yr(e){return Qr.apply(this,arguments)}function Qr(){return(Qr=Object(s.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(de.openLocation)(t).readFile("utf8");case 2:return n=e.sent,e.abrupt("return",new Jr.GenomesFile(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $r(e){return Kr.apply(this,arguments)}function Kr(){return(Kr=Object(s.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(de.openLocation)(t).readFile("utf8");case 2:return n=e.sent,e.abrupt("return",new Jr.TrackDbFile(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zr(e,t,n,r){var a=[];return e.forEach((function(i,o){var c=Array.from(i.keys()),s=["superTrack","compositeTrack","container","view"];if(!c.some((function(e){return s.includes(e)}))){var u=[],l=o;do{if(l=e.get(l).get("parent")){var f=l.split(" ");l=Object(d.a)(f,1)[0],u.push(e.get(l))}}while(l);u.reverse();var p=function(e,t,n,r,a){var i=e.get("type");i||(i=r.get(e.get("parent")).get("type"));var o,c,s=i.split(" ")[0];"bam"===s&&e.get("bigDataUrl").toLowerCase().endsWith("cram")&&(s="cram");o=n.uri?{uri:new URL(e.get("bigDataUrl"),n.uri).href}:{localPath:e.get("bigDataUrl")};switch(s){case"bam":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href}:{uri:new URL("".concat(e.get("bigDataUrl"),".bai"),n.uri).href}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex")}:{localPath:"".concat(e.get("bigDataUrl"),".bai")},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BamAdapter",bamLocation:o,index:{location:c}}};case"bed":case"bed5FloatScore":case"bedGraph":case"bedRnaElements":return Object(T.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"bigBarChart":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:o},renderer:{type:"SvgFeatureRenderer"}};case"bigBed":case"bigGenePred":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:o}};case"bigChain":case"bigInteract":case"bigMaf":case"bigPsl":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:o},renderer:{type:"SvgFeatureRenderer"}};case"bigWig":return{type:"QuantitativeTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigWigAdapter",bigWigLocation:o}};case"broadPeak":case"coloredExon":return Object(T.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"cram":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href}:{uri:new URL("".concat(e.get("bigDataUrl"),".crai"),n.uri).href}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex")}:{localPath:"".concat(e.get("bigDataUrl"),".crai")},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"CramAdapter",cramLocation:o,craiLocation:c,sequenceAdapter:a}};case"gvf":case"ld2":case"narrowPeak":return Object(T.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"bigNarrowPeak":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:o}};case"peptideMapping":return Object(T.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"vcfTabix":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href}:{uri:new URL("".concat(e.get("bigDataUrl"),".tbi"),n.uri).href}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex")}:{localPath:"".concat(e.get("bigDataUrl"),".tbi")},{type:"VariantTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"VcfTabixAdapter",vcfGzLocation:o,index:{location:c}}};case"wig":case"wigMaf":return Object(T.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"hic":return{type:"HicTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"HicAdapter",hicLocation:o}};case"halSnake":return Object(T.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);default:return Object(T.generateUnknownTrackConf)(e.get("shortLabel"),s,t)}}(i,u.map((function(e){return e.get("shortLabel")})),t,e,r);p.trackId="ucsc-trackhub-".concat(Object(Y.objectHash)(p)),p.assemblyNames=[n],a.push(p)}})),a}function ea(e){return h.types.compose("UCSCTrackHubConnection",Object(Ie.BaseConnectionModelFactory)(e),h.types.model({configuration:Object(A.ConfigurationReference)(Gr),type:h.types.literal("UCSCTrackHubConnection")}).actions((function(e){return{connect:function(){var t=Object(A.readConfObject)(e.configuration,"name"),n=Object(A.readConfObject)(e.configuration,"hubTxtLocation"),r=Object(Y.getSession)(e);(function(e){return Xr.apply(this,arguments)})(n).then((function(e){var t;return t=n.uri?{uri:new URL(e.get("genomesFile"),n.uri).href}:{localPath:e.get("genomesFile")},Promise.all([e,Yr(t)])})).then((function(a){var i,o=Object(d.a)(a,2),c=o[0],s=o[1],u=[],l=Object(Ue.a)(s);try{var f=function(){var a=Object(d.a)(i.value,2),o=a[0],s=a[1],l=Object(A.readConfObject)(e.configuration,"assemblyNames");if(l.length>0&&!l.includes(o))return"break";var f=r.assemblies.find((function(e){return Object(A.readConfObject)(e,"name")===o}));if(!f)throw new Error('Cannot find assembly for "'.concat(o,'" from the genomes file for connection "').concat(t,'"'));var p=void 0;p=n.uri?{uri:new URL(s.get("trackDb"),new URL(c.get("genomesFile"),n.uri)).href}:{localPath:s.get("trackDb")},u.push(Promise.all([p,$r(p),o,f]))};for(l.s();!(i=l.n()).done;){if("break"===f())break}}catch(p){l.e(p)}finally{l.f()}return Promise.all([].concat(u))})).then((function(t){var n,r=Object(Ue.a)(t);try{for(r.s();!(n=r.n()).done;){var a=Object(d.a)(n.value,4),i=a[0],o=a[1],c=a[2],s=a[3],u=Zr(o,i,c,Object(A.readConfObject)(s,["sequence","adapter"]));e.addTrackConfs(u)}}catch(l){r.e(l)}finally{r.f()}})).catch((function(t){console.error(t),r.notify('There was a problem connecting to the UCSC Track Hub "'.concat(e.name,'". Please make sure you have entered a valid hub.txt file. The error that was thrown is: "').concat(t,'"'),"error"),r.breakConnection(e.configuration)}))}}})))}function ta(e){try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function na(e){var t="uri"in e?e.uri:void 0,n="localPath"in e?e.localPath:void 0,r="blobId"in e?e:void 0;return(null===r||void 0===r?void 0:r.name)||(null===t||void 0===t?void 0:t.slice(t.lastIndexOf("/")+1))||(null===n||void 0===n?void 0:n.slice(n.lastIndexOf("/")+1))||""}function ra(e){return h.types.model("AddTrackModel",{id:B.ElementId,type:h.types.literal("AddTrackWidget"),view:h.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((function(){return{trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:""}})).actions((function(e){return{setAdapterHint:function(t){e.adapterHint=t},setTrackSource:function(t){e.trackSource=t},setTrackData:function(t){e.trackData=t},setIndexTrackData:function(t){e.indexTrackData=t},setAssembly:function(t){e.altAssemblyName=t},setTrackName:function(t){e.altTrackName=t},setTrackType:function(t){e.altTrackType=t},clearData:function(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData={uri:""},e.trackData={uri:""}}}})).views((function(e){return{get trackAdapter(){var t=e.trackData,n=e.indexTrackData,r=e.adapterHint;return t?Object(T.guessAdapter)(t,n,na,r):void 0},get trackName(){return e.altTrackName||(e.trackData?na(e.trackData):"")},get isFtp(){var t=e.trackData,n=e.indexTrackData;return!!(n&&"uri"in n&&n.uri.startsWith("ftp://")||t&&"uri"in t&&t.uri.startsWith("ftp://"))},get isRelativeTrackUrl(){var t=e.trackData;return t&&"uri"in t&&!ta(t.uri)},get isRelativeIndexUrl(){var t=e.indexTrackData;return t&&"uri"in t&&!ta(t.uri)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){var t=e.trackData;return t&&"uri"in t&&t.uri.startsWith("http://")},get indexHttp(){var t=e.indexTrackData;return t&&"uri"in t&&t.uri.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){var e;return(null===(e=this.trackAdapter)||void 0===e?void 0:e.type)===T.UNSUPPORTED},get assembly(){var t;return e.altAssemblyName||(null===(t=e.view.assemblyNames)||void 0===t?void 0:t[0])},get trackType(){return e.altTrackType||(this.trackAdapter?Object(T.guessTrackType)(this.trackAdapter.type):"")}}})).views((function(e){return{get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}}}))}var aa=Object(A.ConfigurationSchema)("AddTrackWidget",{}),ia=h.types.model("AddConnectionModel",{id:B.ElementId,type:h.types.literal("AddConnectionWidget")}),oa=Object(A.ConfigurationSchema)("AddConnectionWidget",{}),ca=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return!!e.find((function(e){return t.includes(e)}))};function sa(e){if(!e.trackId)throw new Error("not a track");return Object(A.readConfObject)(e,"name")||"Reference sequence (".concat(Object(A.readConfObject)(Object(h.getParent)(e),"name"),")")}function ua(e,t,n){var r={children:[]},a=e.filterText,i=e.view;return t.filter((function(e){return function(e,t){var n=sa(t),r=Object(A.readConfObject)(t,"category")||[],a=new RegExp(e,"i");return!!n.match(a)||r.filter((function(e){return!!e.match(a)})).length}(a,e)})).forEach((function(e){var t=Object(c.a)(Object(A.readConfObject)(e,"category")||[]);e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");for(var a=r,o=function(e){var r=t[e],i=a.children.find((function(e){return e.name===r})),o=t.slice(0,e+1).join(",");if(i)a=i;else{var c={children:[],name:r,id:o,state:{expanded:!n.get(o)}};a.children.push(c),a=c}},s=0;s<t.length;s++)o(s);a.children.splice(a.children.findIndex((function(e){return e.children.length})),0,{id:e.trackId,name:sa(e),conf:e,checked:!!i.tracks.find((function(t){return t.configuration===e})),children:[]})})),r.children}var la=function(e){return h.types.model("HierarchicalTrackSelectorWidget",{id:B.ElementId,type:h.types.literal("HierarchicalTrackSelectorWidget"),collapsed:h.types.map(h.types.boolean),filterText:"",view:h.types.safeReference(e.pluggableMstType("view","stateModel")),collapsedCategories:h.types.map(h.types.string,h.types.boolean)}).actions((function(e){return{setView:function(t){e.view=t},toggleCategory:function(t){e.collapsed.set(t,!e.collapsed.get(t))},clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}})).views((function(t){return{getRefSeqTrackConf:function(n){var r=Object(Y.getSession)(t).assemblyManager.get(n),a=null===r||void 0===r?void 0:r.configuration.sequence,i=e.getViewType(t.view.type);if(a){var o,c=Object(Ue.a)(a.displays);try{var s=function(){var e=o.value;if(i.displayTypes.find((function(t){return t.name===e.type})))return{v:a}};for(c.s();!(o=c.n()).done;){var u=s();if("object"===typeof u)return u.v}}catch(l){c.e(l)}finally{c.f()}}},trackConfigurations:function(n){if(!t.view)return[];var r=Object(Y.getSession)(t),a=r.tracks,i=r.assemblyManager.get(n);if(!i)return[];var o=t.getRefSeqTrackConf(n);return(o?[o]:[]).concat(Object(c.a)(a.filter((function(e){var t=Object(A.readConfObject)(e,"assemblyNames"),n=i.allAliases;return ca(n,t)})).filter((function(n){var r=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),a=n.displays.map((function(e){return e.type}));return ca(r,a)}))))},get assemblyNames(){return t.view?t.view.assemblyNames:[]},connectionTrackConfigurations:function(n,r){if(!t.view)return[];var a=r.tracks,i=Object(Y.getSession)(t).assemblyManager.get(n);return i&&i.initialized?a.filter((function(e){var t=Object(A.readConfObject)(e,"assemblyNames"),n=i.allAliases;return ca(n,t)})).filter((function(n){var r=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),a=n.displays.map((function(e){return e.type}));return ca(r,a)})):[]},hierarchy:function(e){var n=this,r=ua(t,t.trackConfigurations(e),t.collapsed),a=Object(Y.getSession)(t),i=a.connectionInstances.filter((function(t){var n=Object(A.readConfObject)(t.configuration,"assemblyNames");return 0===n.length||n.includes(e)})).map((function(t,r){var i=a.connections[r];return{id:i.connectionId,name:Object(A.readConfObject)(i,"name"),children:n.connectionHierarchy(e,t),state:{expanded:!0}}}));return{name:"Root",id:"Root",children:[{name:"Tracks",id:"Tracks",children:r}].concat(Object(c.a)(i))}},connectionHierarchy:function(e,n){return ua(t,t.connectionTrackConfigurations(e,n),t.collapsed)},allTracksInCategoryPath:function(e,n,r){var a=n?t.connectionHierarchy(n):t.hierarchy(r);e.forEach((function(e){a=a.get(e)||new Map}));var i={};return a.forEach((function(n,r){n.trackId?i[n.trackId]=n:i=Object.assign(i,t.allTracksInCategoryPath(e.concat([r])))})),i}}}))},da=Object(A.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{});n(1269);function fa(e){return h.types.model("PluginStoreModel",{id:B.ElementId,type:h.types.literal("PluginStoreWidget"),filterText:"",view:h.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}}))}var pa=Object(A.ConfigurationSchema)("PluginStoreWidget",{}),ga=Object(f.lazy)((function(){return n.e(35).then(n.bind(null,2455))})),ma=Object(f.lazy)((function(){return n.e(28).then(n.bind(null,2441))})),ha=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="DataManagementPlugin",e.exports={AssemblyManager:ma,SetDefaultSession:ga},e}return Object(m.a)(r,[{key:"install",value:function(e){e.addConnectionType((function(){return new S({name:"UCSCTrackHubConnection",configSchema:Gr,stateModel:ea(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})})),e.addWidgetType((function(){return new j.a({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:da,stateModel:la(e),ReactComponent:Object(f.lazy)((function(){return Promise.all([n.e(20),n.e(42)]).then(n.bind(null,2420))}))})})),e.addWidgetType((function(){return new j.a({name:"AddTrackWidget",heading:"Add a track",configSchema:aa,stateModel:ra(e),ReactComponent:Object(f.lazy)((function(){return n.e(55).then(n.bind(null,2449))}))})})),e.addWidgetType((function(){return new j.a({name:"AddConnectionWidget",heading:"Add a connection",configSchema:oa,stateModel:ia,ReactComponent:Object(f.lazy)((function(){return n.e(41).then(n.bind(null,2450))}))})})),e.addWidgetType((function(){return new j.a({name:"PluginStoreWidget",heading:"Plugin store",configSchema:pa,stateModel:fa(e),ReactComponent:Object(f.lazy)((function(){return Promise.resolve().then(n.bind(null,1269))}))})}))}},{key:"configure",value:function(e){Object(Y.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("File",{label:"Open track",icon:zr.a,onClick:function(e){if(0===e.views.length)e.notify("Please open a view to add a track first");else if(e.views.length>=1){var t=e.addWidget("AddTrackWidget","addTrackWidget",{view:e.views[0].id});e.showWidget(t),e.views.length>1&&e.notify("This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right")}}}),e.rootModel.appendToMenu("File",{label:"Open connection",icon:qr.a,onClick:function(e){var t=e.addWidget("AddConnectionWidget","addConnectionWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("File",{label:"Plugin store",icon:_r.a,onClick:function(e){var t=e.addWidget("PluginStoreWidget","pluginStoreWidget");e.showWidget(t)}}))}}]),r}(F.a),ba=n(288),va=n.n(ba),ya=n(1719),wa=n.n(ya),Oa=n(2388),ja=Object(it.a)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",textAlign:"center"},error:{display:"block",color:"red",width:"30em",wordWrap:"normal",whiteSpace:"normal"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function ka(){var e=Object(f.useState)(!1),t=Object(d.a)(e,2),n=t[0],r=t[1],a=ja();return Object(f.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}}),[]),n?p.a.createElement("div",{"data-testid":"loading-synteny",className:a.loading},"Loading \u2026",p.a.createElement(Oa.a,null)):null}function xa(e){var t=e.messageText,n=ja();return p.a.createElement("div",{className:n.blockMessage},t)}function Ca(e){var t=e.error,n=ja();return p.a.createElement("div",{className:n.blockError},t.message)}var Sa=Object(le.observer)((function(e){var t=e.model;return t.error?p.a.createElement(Ca,{error:t.error,"data-testid":"reload_button"}):t.message?p.a.createElement(xa,{messageText:t.message}):t.filled?t.reactElement:p.a.createElement(ka,null)})),Ta=function(e){var t=e.model,n=e.children,r=t.data||{},a=r.offsetX,i=void 0===a?0:a,o=r.offsetY,c=void 0===o?0:o,s=Object(Y.getContainingView)(t),u=s.vview.offsetPx-c,l=-(s.hview.offsetPx-i);return p.a.createElement("div",{style:{position:"relative"}},p.a.createElement("div",{style:{position:"absolute",top:u,left:l}},p.a.createElement(t.ReactComponent2,e),n))};Ta.defaultProps={children:null};var Ea=Object(le.observer)(Ta);function Ra(e){return h.types.compose("DotplotDisplay",Ie.BaseDisplay,h.types.model({type:h.types.literal("DotplotDisplay"),configuration:Object(A.ConfigurationReference)(e)}).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:Sa}}))).views((function(e){return{get rendererTypeName(){return Object(A.getConf)(e,"renderer").type},get renderProps(){return Object(u.a)(Object(u.a)({},Object(T.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}}})).actions((function(e){var t;return{afterAttach:function(){Object(Y.makeAbortableReaction)(e,(function(){return function(e){var t=Object(Y.getSession)(e).rpcManager,n=e.renderProps,r=e.rendererType,a=e.adapterConfig,i=Object(Y.getContainingView)(e);if(Object(A.readConfObject)(e.configuration),Object(h.getSnapshot)(i),i.initialized){var o=i.viewWidth,c=i.viewHeight,s=i.borderSize,l=i.borderX,d=i.borderY;return{rendererType:r,rpcManager:t,renderProps:Object(u.a)(Object(u.a)({},n),{},{view:Object(h.getSnapshot)(i),width:o,height:c,borderSize:s,borderX:l,borderY:d}),renderArgs:{adapterConfig:a,rendererType:r.name,sessionId:Object(T.getRpcSessionId)(e),timeout:1e6}}}return}(e)}),(function(e){return e?function(e){return Ma.apply(this,arguments)}(e):void 0}),{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){if(void 0!==n){var r=n.data,a=n.reactElement,i=n.renderingComponent;e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=i,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function Ma(){return(Ma=Object(s.a)(o.a.mark((function e(t){var n,r,a,i,c,s,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,r=t.rpcManager,a=t.renderArgs,i=t.renderProps,e.next=5,n.renderInClient(r,Object(u.a)(Object(u.a)({},a),i));case 5:return c=e.sent,s=c.reactElement,d=Object(l.a)(c,["reactElement"]),e.abrupt("return",{reactElement:s,data:d,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pa=Object(le.observer)((function(e){return p.a.createElement(me.PrerenderedCanvas,e)})),Na=Object(A.ConfigurationSchema)("DotplotRenderer",{drawMode:{type:"stringEnum",description:"drawing mode",model:h.types.enumeration("Rendering",["normal"]),defaultValue:"normal"},color:{type:"color",description:"the color of each feature in a synteny",defaultValue:"black",contextVariable:["feature"]},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:1.5}},{explicitlyTyped:!0}),Aa=n(316),Fa=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"serializeArgsInClient",value:function(e){var t=Object(u.a)(Object(u.a)({},e),{},{displayModel:{}});return Object(De.a)(Object(Le.a)(n.prototype),"serializeArgsInClient",this).call(this,t)}},{key:"deserializeResultsInClient",value:function(e,t){var r=Object(De.a)(Object(Le.a)(n.prototype),"deserializeResultsInClient",this).call(this,e,t);return Object(u.a)(Object(u.a)({},r),{},{blockKey:t.blockKey})}},{key:"renderInClient",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n.sessionId,"ComparativeRender",n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"getFeatures",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a,i,c,s=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dataAdapter,r=t.signal,a=[],(a=t.regions)&&0!==a.length){e.next=6;break}return console.warn("no regions supplied to comparative renderer"),e.abrupt("return",[]);case 6:return i=a.map((function(e){var t=Object(u.a)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),c=n.getFeaturesInMultipleRegions(i,{signal:r}),e.abrupt("return",c.pipe(Object(Aa.a)((function(e){return s.featurePassesFilters(t,e)})),Object(V.a)()).toPromise());case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(J.a),Ia=n(524),Ba=n(426),Da=n(688);function La(e){return.7*e.length*12}var Va=Ba.a.extend((function(e){var t=ge.observable.box(1);return{views:{get dynamicBlocks(){return Object(Da.a)(e,!1,!1)},get scaleFactor(){return t.get()}},actions:{setScaleFactor:function(e){t.set(e)}}}})),Wa=Va.extend((function(e){return{views:{get width(){return Object(h.getParent)(e).viewWidth}}}})),za=Va.extend((function(e){return{views:{get width(){return Object(h.getParent)(e).viewHeight}}}}));function Ha(e){return h.types.compose(Ia.a,h.types.model("DotplotView",{id:B.ElementId,type:h.types.literal("DotplotView"),headerHeight:0,height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:h.types.array(h.types.string),hview:h.types.optional(Wa,{}),vview:h.types.optional(za,{}),tracks:h.types.array(e.pluggableMstType("track","stateModel")),viewTrackConfigs:h.types.array(e.pluggableConfigSchemaType("track")),viewAssemblyConfigs:h.types.array(h.types.frozen())}).volatile((function(){return{volatileWidth:void 0,error:void 0,borderX:100,borderY:100}})).views((function(e){return{get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}})).views((function(e){return{get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},get renderProps(){return Object(u.a)(Object(u.a)({},Object(T.getParentRenderProps)(e)),{},{highResolutionScaling:Object(A.getConf)(Object(Y.getSession)(e),"highResolutionScaling")})}}})).actions((function(t){return{afterAttach:function(){var e=this,n=Object(Y.getSession)(t);Object(h.addDisposer)(t,Object(ge.autorun)((function(){if(void 0!==t.volatileWidth){var e=[t.viewWidth,t.viewHeight],r=[t.hview,t.vview];t.initialized||t.assemblyNames.forEach((function(t,a){var i=n.assemblyManager.get(t);if(i){var o=i.regions;if(o&&o.length){var c=Object(h.getSnapshot)(o);c&&Object(ge.transaction)((function(){r[a].setDisplayedRegions(c),r[a].setBpPerPx(r[a].totalBp/e[a])}))}}}))}}),{delay:1e3})),Object(h.addDisposer)(t,Object(ge.autorun)((function(){if(void 0!==t.volatileWidth){e.setBorderY(Math.max(t.hview.dynamicBlocks.contentBlocks.reduce((function(e,t){return Math.max(e,La(t.refName.slice(0,30)))}),0)+10,100)),e.setBorderX(Math.max(t.vview.dynamicBlocks.contentBlocks.reduce((function(e,t){return Math.max(e,La(t.refName.slice(0,30)))}),0)+10,100))}})))},setBorderX:function(e){t.borderX=e},setBorderY:function(e){t.borderY=e},setWidth:function(e){t.volatileWidth=e},setHeight:function(e){t.height=e},setError:function(e){t.error=e},closeView:function(){Object(h.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},zoomOutButton:function(){t.hview.zoomOut(),t.vview.zoomOut()},zoomInButton:function(){t.hview.zoomIn(),t.vview.zoomIn()},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=Object(Y.getSession)(t),n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=Object(h.resolveIdentifier)(a,Object(h.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var c=e.getViewType(t.type),s=i.displays.find((function(e){return!!c.displayTypes.find((function(t){return t.name===e.type}))}));if(!s)throw new Error("could not find a compatible display for view type ".concat(t.type));var l=o.stateModel.create(Object(u.a)(Object(u.a)({},r),{},{type:i.type,configuration:i,displays:[{type:s.type,configuration:s}]}));t.tracks.push(l)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(h.resolveIdentifier)(r,Object(h.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return Object(ge.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setAssemblyNames:function(e){t.assemblyNames=Object(h.cast)(e)},setViews:function(e){t.hview=Object(h.cast)(e[0]),t.vview=Object(h.cast)(e[1])},getCoords:function(e,n){var r=Object(Y.minmax)(n[0],e[0]),a=Object(d.a)(r,2),i=a[0],o=a[1],c=Object(Y.minmax)(n[1],e[1]),s=Object(d.a)(c,2),u=s[0],l=s[1];return Math.abs(o-i)>3&&Math.abs(l-u)>3?[t.hview.pxToBp(i),t.hview.pxToBp(o),t.vview.pxToBp(t.viewHeight-u),t.vview.pxToBp(t.viewHeight-l)]:void 0},zoomIn:function(e,n){var r=this.getCoords(e,n);if(r){var a=Object(d.a)(r,4),i=a[0],o=a[1],c=a[2],s=a[3];t.hview.moveTo(i,o),t.vview.moveTo(s,c)}},onDotplotView:function(e,n){var r=this.getCoords(e,n);if(r){var a=Object(d.a)(r,4),i=a[0],o=a[1],c=a[2],s=a[3],l=Object(Y.getSession)(t),f=Va.create(Object(u.a)(Object(u.a)({},Object(h.getSnapshot)(t.hview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0})),p=Va.create(Object(u.a)(Object(u.a)({},Object(h.getSnapshot)(t.vview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0}));f.setVolatileWidth(t.hview.width),p.setVolatileWidth(t.vview.width),f.moveTo(i,o),p.moveTo(s,c),f.zoomTo(f.bpPerPx/(t.width/t.hview.width),0),p.zoomTo(p.bpPerPx/(t.width/t.vview.width),0);var g=[];t.tracks.forEach((function(e){var t=e.configuration,n=t.displays.find((function(e){return"LinearSyntenyDisplay"===e.type}));n&&g.push({type:t.type,configuration:t,displays:[{type:n.type,configuration:n}]})}));var m={type:"LinearSyntenyView",views:[Object(u.a)(Object(u.a)({type:"LinearGenomeView"},Object(h.getSnapshot)(f)),{},{tracks:[],hideHeader:!0}),Object(u.a)(Object(u.a)({type:"LinearGenomeView"},Object(h.getSnapshot)(p)),{},{tracks:[],hideHeader:!0})],tracks:g};l.addView("LinearSyntenyView",m)}}}})).views((function(e){return{get menuItems(){var t=Object(Y.getSession)(e);return Object(Y.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector}]:[]}}})))}var qa=At.parseCigar,Ua=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"makeImageData",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a,i,c,s,u,l,f,p,g,m,h,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.highResolutionScaling,r=void 0===n?1:n,a=t.width,i=t.height,c=t.config,s=t.views,u=Object(We.c)(Math.ceil(a*r),i*r),l=u.getContext("2d"),f=Object(A.readConfObject)(c,"lineWidth"),l.lineWidth=f,l.scale(r,r),l.fillStyle=Object(A.readConfObject)(c,"color"),p=Object(d.a)(s,2),g=p[0],m=p[1],h=g.dynamicBlocks.contentBlocks[0].offsetPx,b=m.dynamicBlocks.contentBlocks[0].offsetPx,(g.features||[]).forEach((function(e){var t=e.get("start"),n=e.get("end"),r=e.get("refName"),a=e.get("mate"),o=a.refName,s=Object(A.readConfObject)(c,"color",{feature:e});l.fillStyle=s,l.strokeStyle=s;var u=g.bpToPx({refName:r,coord:t}),d=g.bpToPx({refName:r,coord:n}),p=m.bpToPx({refName:o,coord:a.start}),v=m.bpToPx({refName:o,coord:a.end});if(void 0!==u&&void 0!==d&&void 0!==p&&void 0!==v){var y=u-h,w=d-h,O=p-b,j=v-b;if(Math.abs(y-w)<3&&Math.abs(O-j)<3)l.fillRect(y-f/2,i-O-f/2,f,f);else{var k=y,x=O,C=e.get("cg")||e.get("CIGAR");if(C){var S=qa(C);l.beginPath();for(var T=0;T<S.length;T+=2){var E=+S[T],R=S[T+1],M=k,P=x;"M"===R||"="===R||"X"===R?(k+=E/g.bpPerPx,x+=E/m.bpPerPx):"D"===R||"N"===R?k+=E/g.bpPerPx:"I"===R&&(x+=E/m.bpPerPx),l.moveTo(M,i-P),l.lineTo(k,i-x)}l.stroke()}else l.beginPath(),l.moveTo(y,i-O),l.lineTo(w,i-j),l.stroke()}}else console.warn("feature at ".concat(r,":").concat(t,"-").concat(n," ").concat(o,":").concat(a.start,"-").concat(a.end," not plotted, fell outside of range ").concat(u," ").concat(d," ").concat(p," ").concat(v))})),e.abrupt("return",Object(We.d)(u));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var r,a,i,c,l,d,f,p,g,m=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.width,a=t.height,i=t.view,c=i.hview,l=i.vview,d=[r,a],f=[c,l].map((function(e,t){var n=Va.create(e);return n.setVolatileWidth(d[t]),n})),e.next=5,Promise.all(f.map(function(){var e=Object(s.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=n,e.next=3,m.getFeatures(Object(u.a)(Object(u.a)({},t),{},{regions:n.dynamicBlocks.contentBlocks}));case 3:e.t1=e.sent,e.t0.setFeatures.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.next=7,this.makeImageData(Object(u.a)(Object(u.a)({},t),{},{views:f}));case 7:return p=e.sent,e.next=10,Object(De.a)(Object(Le.a)(n.prototype),"render",this).call(this,Object(u.a)(Object(u.a)({},t),{},{height:a,width:r,imageData:p}));case 10:return g=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)({},g),{},{imageData:p,height:a,width:r,offsetX:f[0].dynamicBlocks.blocks[0].offsetPx,offsetY:f[1].dynamicBlocks.blocks[0].offsetPx}));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Fa),_a=n(719),Ga=n(147),Ja=n(176),Xa=n.n(Ja),Ya=n(554),Qa=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e){var r;Object(g.a)(this,n),(r=t.call(this,e)).cache=new Xa.a({cache:new Ya.a({maxSize:1}),fill:function(e,t){return r.setup(Object(u.a)(Object(u.a)({},e),{},{signal:t}))}}),r.assemblyNames=void 0,r.pafLocation=void 0;var a=Object(A.readConfObject)(e,"pafLocation"),i=Object(A.readConfObject)(e,"assemblyNames");return r.pafLocation=Object(de.openLocation)(a),r.assemblyNames=i,r}return Object(m.a)(n,[{key:"setup",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pafLocation.readFile(Object(u.a)({encoding:"utf8"},t));case 2:return n=e.sent,r=[],n.split("\n").forEach((function(e,t){if(e.length){var n=e.split("\t"),a=Object(_a.a)(n),i=a[0],o=(a[1],a[2]),c=a[3],s=a[4],l=a[5],d=(a[6],a[7]),f=a[8],p=a[9],g=a[10],m=a[11],h=a.slice(12),b=Object.fromEntries(h.map((function(e){var t=e.indexOf(":");return[e.slice(0,t),e.slice(t+3)]})));r[t]={records:[{refName:i,start:+o,end:+c},{refName:l,start:+d,end:+f}],extra:Object(u.a)({numMatches:+p,blockLen:+g,strand:s,mappingQual:+m},b)}}})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(Ga.ObservableCreate)(function(){var r=Object(s.a)(o.a.mark((function r(a){var i,c,s,l,d,f,p,g,m,h;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.cache.get("initialize",n,n.signal);case 2:if(i=r.sent,-1!==(c=t.assemblyNames.indexOf(e.assemblyName)))for(s=0;s<i.length;s++)l=i[s],d=l.extra,f=l.records,p=f[c],g=p.start,m=p.end,h=p.refName,f[c].refName===e.refName&&Object(Sn.a)(e.start,e.end,g,m)&&a.next(new Q.a(Object(u.a)({uniqueId:"row_".concat(s),start:g,end:m,refName:h,syntenyId:s,mate:{start:f[+!c].start,end:f[+!c].end,refName:f[+!c].refName}},d)));a.complete();case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(X.BaseFeatureDataAdapter);Qa.capabilities=["getFeatures","getRefNames"];var $a=Object(A.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[]},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf"}}},{explicitlyTyped:!0}),Ka=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="ComparativeRender",e}return Object(m.a)(n,[{key:"serializeArguments",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=null===(r=this.pluginManager.rootModel)||void 0===r||null===(a=r.session)||void 0===a?void 0:a.assemblyManager)){e.next=7;break}return e.next=4,Object(Y.renameRegionsIfNeeded)(i,t);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=t;case 8:if(c=e.t0,"MainThreadRpcDriver"!==n){e.next=11;break}return e.abrupt("return",c);case 11:if(s=t.rendererType,(u=this.pluginManager.getRendererType(s))instanceof Fa){e.next=15;break}throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");case 15:return e.abrupt("return",u.serializeArgsInClient(c));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,l,d,f,p,g,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(i=(a=r).sessionId,c=a.adapterConfig,s=a.rendererType,l=a.signal,i){e.next=8;break}throw new Error("must pass a unique session id");case 8:return Object(Y.checkAbortSignal)(l),e.next=11,U(this.pluginManager,i,c);case 11:if(d=e.sent,(f=d.dataAdapter)instanceof X.BaseFeatureDataAdapter){e.next=15;break}throw new Error("ComparativeRender cannot handle this type of data adapter ".concat(f));case 15:if(p=this.pluginManager.getRendererType(s)){e.next=18;break}throw new Error('renderer "'.concat(s,'" not found'));case 18:if(p.ReactComponent){e.next=20;break}throw new Error("renderer ".concat(s," has no ReactComponent, it may not be completely implemented yet"));case 20:if(p instanceof Fa){e.next=22;break}throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");case 22:if(g=Object(u.a)(Object(u.a)({},r),{},{dataAdapter:f}),"MainThreadRpcDriver"!==n){e.next=29;break}return e.next=26,p.render(g);case 26:e.t0=e.sent,e.next=32;break;case 29:return e.next=31,p.renderInWorker(g);case 31:e.t0=e.sent;case 32:return m=e.t0,Object(Y.checkAbortSignal)(l),e.abrupt("return",m);case 35:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("MainThreadRpcDriver"!==r){e.next=2;break}return e.abrupt("return",t);case 2:if(a=n.rendererType,i=this.pluginManager.getRendererType(a)){e.next=6;break}throw new Error('renderer "'.concat(a,'" not found'));case 6:if(i.ReactComponent){e.next=8;break}throw new Error("renderer ".concat(a," has no ReactComponent, it may not be completely implemented yet"));case 8:if(i instanceof Fa){e.next=10;break}throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");case 10:return e.abrupt("return",i.deserializeResultsInClient(t,n));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(N),Za=At.parseCigar;function ei(e){for(var t=Za(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"D"!==i&&"N"!==i&&(n+=a)}return n}function ti(e){for(var t=Za(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"D"!==i&&"N"!==i&&(n+=a)}return n}var ni=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="DotplotPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addViewType((function(){return new O.a({name:"DotplotView",stateModel:Ha(e),ReactComponent:Object(f.lazy)((function(){return n.e(26).then(n.bind(null,2451))}))})})),e.addDisplayType((function(){var t=function(e){return Object(A.ConfigurationSchema)("DotplotDisplay",{renderer:h.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(e);return new w.a({name:"DotplotDisplay",configSchema:t,stateModel:Ra(t),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:Ea})})),e.addRendererType((function(){return new Ua({name:"DotplotRenderer",configSchema:Na,ReactComponent:Pa,pluginManager:e})})),e.addAdapterType((function(){return new v.a({name:"PAFAdapter",configSchema:$a,AdapterClass:Qa})})),e.addRpcMethod((function(){return new Ka(e)}))}},{key:"configure",value:function(e){Object(Y.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Dotplot view",icon:wa.a,onClick:function(e){e.addView("DotplotView",{})}});var t=function(e,t){var n=t.parentTrack;return e?[{label:"Dotplot of read vs ref",icon:va.a,onClick:function(){var r=Object(Y.getSession)(t),a=e.get("clipPos"),i=e.get("CIGAR"),o=e.get("flags"),s=(e.get("tags")?e.get("tags").SA:e.get("SA"))||"",u=e.get("name"),l="".concat(u,"_assembly"),f=Object(A.getConf)(n,"assemblyNames"),p=Object(d.a)(f,1)[0],g=[p,l],m="track-".concat(Date.now()),h="".concat(u,"_vs_").concat(p),b=s.split(";").filter((function(e){return!!e})).map((function(t,n){var r=t.split(","),a=Object(d.a)(r,4),i=a[0],o=a[1],c=a[2],s=a[3],l=function(e){for(var t=Za(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"I"!==i&&(n+=a)}return n}(s),f=ei(s),g=ti(s),m="-"===c?-1:1,h=function(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}(s,m),b=+o-1;return{refName:i,start:b,end:b+l,seqLength:f,clipPos:h,CIGAR:s,assemblyName:p,strand:m,uniqueId:"".concat(e.id(),"_SA").concat(n),mate:{start:h,end:h+g,refName:u}}})),v=e.toJSON();v.mate={refName:u,start:a,end:a+ti(i)};var y=ei(2048&o?b[0].CIGAR:i),w=[v].concat(Object(c.a)(b));w.sort((function(e,t){return e.clipPos-t.clipPos}));var O=w.reduce((function(e,t){return e+t.end-t.start}),0);r.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:O/800,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:w.map((function(e){return{start:e.start,end:e.end,refName:e.refName,assemblyName:p}}))},vview:{offsetPx:0,bpPerPx:y/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:l,start:0,end:y,refName:u}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:g,adapter:{type:"FromConfigAdapter",features:w},trackId:m,name:h}],viewAssemblyConfigs:[{name:l,sequence:{type:"ReferenceSequenceTrack",trackId:"".concat(u,"_").concat(Date.now()),adapter:{type:"FromConfigSequenceAdapter",features:[e.toJSON()]}}}],assemblyNames:g,tracks:[{configuration:m,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:"".concat(m,"-DotplotDisplay")}]}],displayName:"".concat(u," vs ").concat(p)})}}]:[]};function n(e){"LinearGenomeView"===e.type&&e.tracks.forEach((function(e){"AlignmentsTrack"===e.type&&e.displays.forEach((function(e){"LinearPileupDisplay"!==e.type||e.additionalContextMenuItemCallbacks.includes(t)?"LinearAlignmentsDisplay"===e.type&&e.PileupDisplay&&!e.PileupDisplay.additionalContextMenuItemCallbacks.includes(t)&&e.PileupDisplay.addAdditionalContextMenuItemCallback(t):e.addAdditionalContextMenuItemCallback(t)}))}))}Object(ge.autorun)((function(){var t,r=null===(t=e.rootModel)||void 0===t?void 0:t.session;r&&r.views.forEach((function(e){e.views?e.views.forEach((function(e){return n(e)})):n(e)}))}))}}]),r}(F.a);var ri=function(e){return h.types.compose("LinearFilteringDisplay",Be.a,h.types.model({type:h.types.literal("LinearFilteringDisplay"),configuration:Object(A.ConfigurationReference)(e),hideExpressions:h.types.optional(h.types.array(h.types.string),(function(){return[]})),height:193,filterControlsHeight:70,dragHandleHeight:3,filterOut:h.types.map(h.types.map(h.types.boolean))}).views((function(e){return{get renderProps(){var t=function(e){var t,n=[],r=e.filterOut,a=Object(Ue.a)(r.keys());try{for(a.s();!(t=a.n()).done;){var i,o=t.value,c=Object(Ue.a)(r.get(o).keys());try{for(c.s();!(i=c.n()).done;){var s=i.value;r.get(o).get(s)&&n.push("jexl:get(feature,'".concat(o,"') != '").concat(s,"'"))}}catch(u){c.e(u)}finally{c.f()}}}catch(u){a.e(u)}finally{a.f()}return n}(e);return Object(u.a)(Object(u.a)(Object(u.a)({},Object(T.getParentRenderProps)(e)),this.composedRenderProps),{},{rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer,filters:t})},get innerDisplayHeight(){return e.height-e.dragHandleHeight-e.filterControlsHeight},get filterControlsMinHeight(){return Math.min(e.filterControlsMaxHeight,40)},get filterControlsMaxHeight(){return Math.max(e.height-20,0)},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{setFilterControlsHeight:function(t){return t>e.filterControlsMinHeight?t<e.filterControlsMaxHeight?e.filterControlsHeight=t:e.filterControlsHeight=e.filterControlsMaxHeight:e.filterControlsHeight=e.filterControlsMinHeight,e.filterControlsHeight},resizeFilterControls:function(t){return e.filterControlsHeight-e.setFilterControlsHeight(e.filterControlsHeight-t)},toggleFilter:function(t,n,r){e.filterOut.has(t)||e.filterOut.set(t,{}),e.filterOut.get(t).set(String(n),!r)}}})))},ai=n(2445),ii=n(1008),oi=n(2353),ci=n(2385),si=n(2350),ui=n(2349),li=n(29),di=n(11),fi=n.n(di),pi=function(e){return{root:{background:e.palette.background.default,overflow:"auto",paddingTop:0,paddingBottom:e.spacing(1),paddingLeft:e.spacing(1),paddingRight:e.spacing(1),display:"flex",flexWrap:"wrap"},header:{width:"100%"},title:{}}};var gi=Object(li.a)(pi)(Object(le.observer)((function(e){var t=e.attrName,n=e.model,r=e.classes,a=e.values;return p.a.createElement(ii.a,{component:"fieldset",className:r.formControl},p.a.createElement(ui.a,{component:"legend"},t),p.a.createElement(ci.a,{row:!0},a.length?a.map((function(e){return p.a.createElement(oi.a,{key:"".concat(t,"-").concat(e),control:p.a.createElement(ai.a,{checked:!(n.filterOut.has(t)&&n.filterOut.get(t).get(String(e))),onChange:function(r){return n.toggleFilter(t,e,r.target.checked)}}),label:e})})):p.a.createElement(si.a,{style:{marginRight:"1em"}},"no values seen yet")))})));gi.propTypes={attrName:fi.a.string.isRequired,model:le.PropTypes.objectOrObservableObject.isRequired,values:fi.a.arrayOf(fi.a.string).isRequired};var mi=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e){var r;Object(g.a)(this,n),(r=t.call(this,e)).state={seenAttributes:{}};var a=e.model;return r.autorunDisposer=Object(ge.reaction)((function(){var e={};return Object(A.getConf)(a,"filterAttributes").forEach((function(t){e[t]||(e[t]={}),function(e,t){var n,r=e.features,a=e.filterOut,i=new Set,o=Object(Ue.a)(r.values());try{for(o.s();!(n=o.n()).done;){var c=n.value;i.add(c.get(t))}}catch(d){o.e(d)}finally{o.f()}if(a.has(t)){var s,u=Object(Ue.a)(a.get(t).keys());try{for(u.s();!(s=u.n()).done;){var l=s.value;i.add(l)}}catch(d){u.e(d)}finally{u.f()}}return Array.from(i.values()).sort()}(a,t).forEach((function(n){e[t][n]=!0}))})),e}),(function(e){r.setState((function(t){var n={};return Object.keys(e).forEach((function(r){n[r]=Object(u.a)(Object(u.a)({},t.seenAttributes[r]||{}),e[r])})),{seenAttributes:n}}))}),{delay:400}),r}return Object(m.a)(n,[{key:"componentWillUnmount",value:function(){this.autorunDisposer()}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.style,r=e.model,a=this.state.seenAttributes;return p.a.createElement("div",{style:n,className:t.root},p.a.createElement("div",{className:t.header},p.a.createElement(rn.a,{className:t.title,variant:"subtitle2",gutterBottom:!0},"Filters")),Object.keys(a).sort().map((function(e){return p.a.createElement(gi,{key:e,attrName:e,model:r,values:Object.keys(a[e]).sort()})})))}}]),n}(f.Component);mi.defaultProps={style:{}};var hi=Object(li.a)(pi)(Object(le.observer)(mi)),bi=Object(it.a)((function(e){return{display:{background:"white",height:"100%",overflow:"hidden"},innerDisplay:{overflowY:"auto",overflowX:"hidden"},filterControls:{background:e.palette.background.default}}}));var vi=Object(le.observer)((function(e){var t=e.model,n=bi(),r=t.innerDisplayHeight,a=t.filterControlsHeight,i=t.dragHandleHeight;return p.a.createElement("div",{className:n.display},p.a.createElement("div",{className:n.innerDisplay,style:{height:r}},p.a.createElement(Be.b,e)),p.a.createElement(me.ResizeHandle,{onDrag:t.resizeFilterControls,style:{height:i,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}),p.a.createElement(hi,Object.assign({style:{height:a}},e)))}));var yi=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="FilteringTrackPlugin",e}return Object(m.a)(n,[{key:"install",value:function(e){e.addDisplayType((function(){var t=function(e){return Object(A.ConfigurationSchema)("LinearFilteringDisplay",{filterAttributes:{type:"stringArray",defaultValue:["type"],description:"list of feature attributes to use for filtering"}},{baseConfiguration:Object(Be.e)(e),explicitlyTyped:!0})}(e);return new w.a({name:"LinearFilteringDisplay",configSchema:t,stateModel:ri(t),trackType:"FilteringTrack",viewType:"LinearGenomeView",ReactComponent:vi})}))}}]),n}(F.a),wi=Object(A.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz"}},index:Object(A.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:h.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0}),Oi=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="GFF3TabixPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new v.a({name:"Gff3TabixAdapter",configSchema:wi,getAdapterClass:function(){return Promise.all([n.e(0),n.e(2),n.e(4),n.e(14),n.e(60)]).then(n.bind(null,2421)).then((function(e){return e.default}))}})}))}}]),r}(F.a),ji=Object(A.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0}),ki=Object(A.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:Ie.baseConnectionConfig}),xi=n(411),Ci=n(1084),Si=n.n(Ci),Ti=n(1720),Ei=n.n(Ti);function Ri(e){return e&&e.label&&"string"===typeof e.label}function Mi(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?Mi(e[a],t[a]):"undefined"!==typeof e[a]&&"undefined"===typeof t[a]||(e[a]=t[a])}return e}function Pi(e){if(!e||"object"!==typeof e||"[object Function]"===Object.prototype.toString.call(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,n,r;if(Array.isArray(e))for(t=[],n=0,r=e.length;n<r;++n)n in e&&(t[n]=Pi(e[n]));else t=e.constructor?new e.constructor:{};return function(e,t,n){var r,a,i={};for(r in t)a=t[r],r in e&&(e[r]===a||r in i&&i[r]===a)||(e[r]=n?n(a):a);return e}(t,e,Pi)}function Ni(e,t){if("string"===typeof e){var n;try{n=JSON.parse(e)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return Fi(n,t)}return Fi(e,t)}function Ai(e,t){var n;try{n=function(e,t){var n,r,a,i,o=[],c={tracks:{}};function s(){var e;if(void 0!==a)try{var s=a.match(/^json:(.+)/i);if(e=s?JSON.parse(s[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(a)?parseFloat(a.replace(/,/g,"")):a,!n)throw new Error("Error parsing in section ".concat(o.join(" - ")));var u=o.concat(n).join(".");if("+="===r){var l=Si()(c,u);l?Array.isArray(l)||(l=[l]):l=[],l.push(e),e=l}"true"===e&&(e=!0),"false"===e&&(e=!1),Ei()(c,u,e)}catch(d){throw new Error("syntax error".concat(t?" in ".concat(t):"").concat(i?" at line ".concat(i-1):""))}}return e.split("\n").forEach((function(e,t){i=t+1;var c,u=e.replace(/^\s*#.+/,"");if(c=u.match(/^\s*\[([^\]]+)/))s(),n=void 0,a=void 0,1===(o=c[1].trim().split(/\s*\.\s*/)).length&&"general"===o[0].toLowerCase()&&(o=[]);else if(c=u.match(void 0===a?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/)){s(),n=c[1].trim().split(/\s*\.\s*/);var l=c,f=Object(d.a)(l,3);r=f[2],function(e){if("include"===e)return!0;return!1}(o.concat(n).join("."))&&(r="+="),a=c[3].trim()}else void 0!==n&&(c=u.match(/^\s{0,4}\+\s*(.+)/))?(s(),r="+=",a=c[1].trim()):void 0!==a&&(c=u.match(/^\s+(\S.*)/))?a+=a.length?" ".concat(c[1].trim()):c[1].trim():(s(),n=void 0,a=void 0)})),s(),c}(e,t)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return Fi(n,t)}function Fi(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(Ri(e.tracks))e.tracks=[e.tracks];else{for(var n=[],r=0,a=Object.keys(e.tracks);r<a.length;r++){var i=a[r],o=e.tracks[i];Ri(o)?n.push(o):n.push(Object(u.a)({label:i},o))}e.tracks=n}var s,l=e.trackMetadata;if(l&&l.sources){if("string"===typeof l.sources&&(l.sources=[l.sources]),(s=l.sources)&&s.url&&"string"===typeof s.url&&(l.sources=[l.sources]),!Array.isArray(l.sources)){for(var d=[],f=0,p=Object.keys(l.sources);f<p.length;f++){var g=p[f],m=l.sources[g];"name"in m||(m.name=g),d.push(m)}l.sources=d}l.sources=l.sources.map((function(e){if("string"===typeof e){var t={url:e},n=e.match(/\.(\w+)$/);return n&&(t.type=n[1].toLowerCase()),t}return e}))}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){var h=[];e.tracks&&h.push.apply(h,Object(c.a)(e.tracks)),e.stores&&h.push.apply(h,Object(c.a)(Object.values(e.stores))),e.names&&h.push(e.names),h.forEach((function(t){t.baseUrl||(t.baseUrl=e.baseUrl||"/")})),e.refSeqs&&"string"===typeof e.refSeqs&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}return e.stores=e.stores||{},(e.tracks||[]).forEach((function(t){if(t.config){var n=t.config;delete t.config,t=Object(u.a)(Object(u.a)({},n),t)}var r;t.store||(r="FeatureTrack"===t.type?"JBrowse/View/Track/HTMLFeatures":"ImageTrack"===t.type?"JBrowse/View/Track/FixedImage":"ImageTrack.Wiggle"===t.type?"JBrowse/View/Track/FixedImage/Wiggle":"SequenceTrack"===t.type?"JBrowse/View/Track/Sequence":Ii("JBrowse/View/Track",t.type),t.type=r,Bi(e,t),t.histograms&&(t.histograms.baseUrl||(t.histograms.baseUrl=t.baseUrl),Bi(e,t.histograms)))})),e}function Ii(e,t){return t?(t.includes("/")||(t="".concat(e,"/").concat(t)),t=t.replace(/^\//,"")):""}function Bi(e,t){var n,r=t.urlTemplate,a=void 0===r?"":r;if(n=t.storeClass?Ii("JBrowse/Store",t.storeClass):function(e,t){return e?e.type&&e.type.includes("/FixedImage")?"JBrowse/Store/TiledImage/Fixed".concat(0===e.backendVersion?"_v0":""):/\.jsonz?$/i.test(t)?"JBrowse/Store/SeqFeature/NCList".concat(0===e.backendVersion?"_v0":""):/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":e.type&&e.type.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}(t,a)){var i=Object(u.a)(Object(u.a)({},t),{},{type:n});"JBrowse/Store/Sequence/StaticChunked"!==n&&"JBrowse/Store/Sequence/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/BgzipIndexedFasta"!==n&&"JBrowse/Store/SeqFeature/TwoBit"!==n&&"JBrowse/Store/Sequence/TwoBit"!==n&&!t.useAsRefSeqStore||e.stores&&e.stores.refseqs?i.name="store".concat(Object(Y.objectHash)(i)):i.name="refseqs",e.stores||(e.stores={}),e.stores[i.name]=i,t.store=i.name}else console.warn("Unable to determine an appropriate data store to use with track '".concat(t.label,"', please explicitly specify a storeClass in the configuration."))}function Di(e){return void 0!==e.uri}function Li(e){return void 0!==e.localPath}function Vi(){return(Vi=Object(s.a)(o.a.mark((function e(){var t,n,r,a,i,c,s,u,l,d,f,p,g,m,h=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{uri:""},n=h.length>1&&void 0!==h[1]?h[1]:{include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r=h.length>2&&void 0!==h[2]?h[2]:{uri:""},a="uri"in t?"uri":"localPath",i=JSON.parse(JSON.stringify(t)),c="",Di(t)&&(c=t.uri),Li(t)&&(c=t.localPath),c.endsWith("/")&&(i[a]=c.slice(0,c.length-1)),!(Di(r)&&r.uri||Li(r)&&r.localPath)){e.next=35;break}s="uri"in r?"uri":"localPath",u="",Di(r)&&(u=r.uri),Li(r)&&(u=r.localPath),u.endsWith("/")&&(u=u.slice(0,u.length-1)),l={},d=0,f=["jbrowse.conf","jbrowse_conf.json"];case 17:if(!(d<f.length)){e.next=33;break}return p=f[d],g=null,e.prev=20,e.next=23,Hi(Object(xi.a)({},s,"".concat(u,"/").concat(p)));case 23:g=e.sent,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(20),console.error("tried to access ".concat(u,"/").concat(p,", but failed"));case 29:l=_i(l,g)||{};case 30:d++,e.next=17;break;case 33:return i[a]&&(l.dataRoot=i[a]),e.abrupt("return",Wi(l));case 35:return m=Fi(n,window.location.href),i[a]&&(m.dataRoot=i[a]),e.abrupt("return",Wi(m));case 38:case"end":return e.stop()}}),e,null,[[20,26]])})))).apply(this,arguments)}function Wi(e){return zi.apply(this,arguments)}function zi(){return(zi=Object(s.a)(o.a.mark((function e(t){var n,r,a,i=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:$i,r=Mi(Pi(n),t),e.next=4,Ji(r);case 4:return Qi(a=_i(a=e.sent,t)||a,a),Ki(a),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hi(e){return qi.apply(this,arguments)}function qi(){return(qi=Object(s.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(de.openLocation)(t).readFile("utf8");case 2:if("string"===typeof(n=e.sent)){e.next=5;break}throw new Error("Error opening location: ".concat(t));case 5:if(!Di(t)){e.next=7;break}return e.abrupt("return",Ui(n,t.uri));case 7:if(!Li(t)){e.next=9;break}return e.abrupt("return",Ui(n,t.localPath));case 9:return e.abrupt("return",Ui(n));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ui(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.trim().startsWith("{")?Ni(e,t):Ai(e,t)}function _i(e,t){if(null===t)return null;null===e&&(e={});for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if("tracks"===a&&a in e){var i=e[a]||[],o=t[a]||[];if(!Array.isArray(i)||!Array.isArray(o))throw new Error("Track config has not been properly regularized: ".concat(i," ").concat(o));e[a]=Gi(i||[],o||[])}else"datasets"!==a&&a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?e[a]=Mi(e[a],t[a]):"dataRoot"===a?(void 0===e[a]||"data"===e[a]&&void 0!==t[a])&&(e[a]=t[a]):void 0!==e[a]&&void 0===t[a]||(e[a]=t[a])}return e}function Gi(e,t){if(!t.length)return e;var n={};return e.forEach((function(e,t){e.index=t,n[e.label]=e})),t.forEach((function(t){var r=n[t.label];r?_i(r,t):e.push(t)})),e}function Ji(e){return Xi.apply(this,arguments)}function Xi(){return(Xi=Object(s.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return(r=Object(s.a)(o.a.mark((function e(r,a){var i,c,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.sourceUrl||r.baseUrl){e.next=3;break}throw new Error("Could not determine source URL: ".concat(JSON.stringify(r)));case 3:if(c=_i(Pi(a),r)){e.next=6;break}throw new Error("Problem merging configs");case 6:return u=Qi(Yi(r.include||[]),c),delete r.include,l=u.map(function(){var e=Object(s.a)(o.a.mark((function e(r){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.cacheBuster=t.cacheBuster,e.next=3,Hi({uri:new URL(r.url,i).href});case 3:return a=e.sent,e.abrupt("return",n(a,c));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(l);case 11:return e.sent.forEach((function(e){r=_i(r,e)||r})),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)},n=function(e,t){return r.apply(this,arguments)},t=Pi(t),e.abrupt("return",n(t,{}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yi(e){return e?(Array.isArray(e)||(e=[e]),e.map((function(e){return"string"===typeof e&&(e={url:e}),"format"in e||(e.format=e.url.endsWith(".conf")?"conf":"JB_json"),"JB_json"!==e.format||"version"in e||(e.version=1),e}))):[]}function Qi(e,t){if(!e)return e;if(Array.isArray(e))for(var n=0;n<e.length;n+=1)e[n]=Qi(e[n],t);else if("object"===typeof e)for(var r=e,a=0,i=Object.keys(r);a<i.length;a++){var o=i[a];r[o]=Qi(r[o],t)}else if("string"===typeof e)return function(e,t){var n=this;return e.replace(/\{([\w\s.]+)\}/g,(function(e,r){r=r.replace(/\s+/g,"");var a=Si()(t,r);if(void 0!==a)return"function"===typeof a?a(r):a;if(t.callback){var i=t.callback.call(n,r);if(void 0!==i)return i}return e}))}(e,t);return e}var $i={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function Ki(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}function Zi(e,t,n){var r={trackId:Object(Y.objectHash)(e),name:e.key||e.label},a=e.metadata&&(e.metadata.description||e.metadata.Description);a&&(r.description=a);var i=e.category||e.metadata&&e.metadata.category;r.category=i?i.split(/\s*\/\s*/):[];var o=e.storeClass;if(!e.urlTemplate){if(!o||!o.endsWith("FromConfig")){var c=e.key||e.label;return console.warn('Could not import JBrowse1 track "'.concat(c,'" because it does not have a "urlTemplate" or is not a "FromConfig" track')),Object(T.generateUnsupportedTrackConf)(r.name,c,r.category)}return function(e,t){var n=(e.features||[]).map((function(e){var t=JSON.parse(JSON.stringify(e));return t.refName=e.seq_id,t.uniqueId="".concat(e.seq_id,":").concat(e.start,"-").concat(e.end,":").concat(e.name||""),t}));return t.adapter={type:"FromConfigAdapter",features:n},t.type="FeatureTrack",t}(e,r)}var s=function(e){return new URL(e,"".concat(t,"/")).href.replace(/%7B/gi,"{").replace(/%7D/gi,"}")},l=s(e.urlTemplate);if(o){if("JBrowse/Store/SeqFeature/BAM"===o){var d={type:"BamAdapter",bamLocation:{uri:l}};return e.baiUrlTemplate?d.index={location:{uri:s(e.baiUrlTemplate)}}:e.csiUrlTemplate?d.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:d.index={location:{uri:"".concat(l,".bai")}},Object(u.a)(Object(u.a)({},r),{},{type:"AlignmentsTrack",adapter:d})}if("JBrowse/Store/SeqFeature/CRAM"===o){var f={type:"CramAdapter",cramLocation:{uri:l},sequenceAdapter:n};return e.craiUrlTemplate?f.craiLocation={uri:s(e.craiUrlTemplate)}:f.craiLocation={uri:"".concat(l,".crai")},Object(u.a)(Object(u.a)({},r),{},{type:"AlignmentsTrack",adapter:f})}if("JBrowse/Store/SeqFeature/NCList"===o)return Object(u.a)(Object(u.a)({},r),{},{type:"FeatureTrack",adapter:{type:"NCListAdapter",rootUrlTemplate:{uri:l}}});if("JBrowse/Store/SeqFeature/BigWig"===o||"JBrowse/Store/BigWig"===o)return e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density"),Object(u.a)(Object(u.a)({},r),{},{type:"QuantitativeTrack",adapter:{type:"BigWigAdapter",bigWigLocation:{uri:l}}});if("JBrowse/Store/SeqFeature/VCFTabix"===o){var p={type:"VcfTabixAdapter",vcfGzLocation:{uri:l}};return e.tbiUrlTemplate?p.index={location:{uri:s(e.tbiUrlTemplate)}}:e.csiUrlTemplate?p.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:p.index={location:{uri:"".concat(l,".tbi")}},Object(u.a)(Object(u.a)({},r),{},{type:"VariantTrack",adapter:p})}if("JBrowse/Store/SeqFeature/VCFTribble"===o)return Object(T.generateUnsupportedTrackConf)(r.name,"VCFTribble (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/GFF3"===o)return Object(T.generateUnsupportedTrackConf)(r.name,"GFF3 (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/BigBed"===o)return Object(u.a)(Object(u.a)({},r),{},{type:"FeatureTrack",adapter:{type:"BigBedAdapter",bigBedLocation:{uri:l}}});if("JBrowse/Store/SeqFeature/GFF3Tabix"===o){var g={type:"Gff3TabixAdapter",gffGzLocation:{uri:l}};return e.tbiUrlTemplate?g.index={location:{uri:s(e.tbiUrlTemplate)}}:e.csiUrlTemplate?g.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:g.index={location:{uri:"".concat(l,".tbi")}},Object(u.a)(Object(u.a)({},r),{},{type:"FeatureTrack",adapter:g})}if("JBrowse/Store/SeqFeature/BED"===o)return Object(T.generateUnsupportedTrackConf)(r.name,"BED (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/BEDTabix"===o){var m={type:"BedTabixAdapter",bedGzLocation:{uri:l}};return e.tbiUrlTemplate?m.index={location:{uri:s(e.tbiUrlTemplate)}}:e.csiUrlTemplate?m.index={location:{uri:s(e.csiUrlTemplate)},indexType:"CSI"}:m.index={location:{uri:"".concat(l,".tbi")}},Object(u.a)(Object(u.a)({},r),{},{type:"FeatureTrack",adapter:m})}if("JBrowse/Store/SeqFeature/GTF"===o)return Object(T.generateUnsupportedTrackConf)(r.name,"GTF (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/StaticChunked"===o||"JBrowse/Store/Sequence/StaticChunked"===o)return Object(T.generateUnsupportedTrackConf)(r.name,"StaticChunked (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/UnindexedFasta"===o)return Object(T.generateUnsupportedTrackConf)(r.name,"UnindexedFasta (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/IndexedFasta"===o){var h={type:"IndexedFastaAdapter",fastaLocation:{uri:l}};return e.faiUrlTemplate?h.faiLocation={uri:s(e.faiUrlTemplate)}:h.faiLocation={uri:"".concat(l,".fai")},Object(u.a)(Object(u.a)({},r),{},{type:"SequenceTrack",adapter:h})}if("JBrowse/Store/SeqFeature/BgzipIndexedFasta"===o){var b={type:"BgzipFastaAdapter",fastaLocation:{uri:l}};return e.faiUrlTemplate?b.faiLocation={uri:s(e.faiUrlTemplate)}:b.faiLocation={uri:"".concat(l,".fai")},e.gziUrlTemplate?b.gziLocation={uri:s(e.gziUrlTemplate)}:b.gziLocation={uri:"".concat(l,".gzi")},Object(u.a)(Object(u.a)({},r),{},{type:"ReferenceSequenceTrack",adapter:b})}if("JBrowse/Store/SeqFeature/TwoBit"===o)return Object(u.a)(Object(u.a)({},r),{},{type:"ReferenceSequenceTrack",adapter:{type:"TwoBitAdapter",twoBitLocation:{uri:l}}})}if(r.adapter=Object(T.guessAdapter)({uri:l},void 0,(function(){return l})),!r.adapter)throw new Error("Could not determine adapter");return r.adapter.type===T.UNSUPPORTED?Object(T.generateUnsupportedTrackConf)(r.name,l,r.category):r.adapter.type===T.UNKNOWN?Object(T.generateUnknownTrackConf)(r.name,l,r.category):(r.type=Object(T.guessTrackType)(r.adapter.type),"QuantitativeTrack"===r.type&&(e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density")),r)}var eo=function(e){return h.types.compose("JBrowse1Connection",Object(Ie.BaseConnectionModelFactory)(e),h.types.model({configuration:Object(A.ConfigurationReference)(ki),type:h.types.literal("JBrowse1Connection")}).actions((function(e){return{connect:function(){var t=Object(A.readConfObject)(e.configuration,"dataDirLocation"),n=Object(Y.getSession)(e);(function(){return Vi.apply(this,arguments)})(t).then((function(t){var r=Object(A.readConfObject)(e.configuration,"assemblyNames")[0];if(!r)throw new Error("assembly name required for JBrowse 1 connection");var a=n.assemblies.find((function(e){return Object(A.readConfObject)(e,"name")===r})),i=Object(A.readConfObject)(a,["sequence","adapter"]),o=t.tracks.map((function(e){var n=Zi(e,t.dataRoot,i);return n.assemblyNames=[r],n}));e.setTrackConfs(o)})).catch((function(t){console.error(t),n.notify('There was a problem connecting to the JBrowse 1 data directory "'.concat(e.name,'". Please make sure you have entered a valid location. The error that was thrown is: "').concat(t,'"'),"error"),n.breakConnection(e.configuration)}))}}})))},to=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="LegacyJBrowsePlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new v.a({name:"NCListAdapter",configSchema:ji,getAdapterClass:function(){return Promise.all([n.e(2),n.e(18),n.e(62)]).then(n.bind(null,2456)).then((function(e){return e.default}))}})})),e.addConnectionType((function(){return new S({name:"JBrowse1Connection",configSchema:ki,stateModel:eo(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})}))}}]),r}(F.a),no=n(2370),ro=n(2373),ao=n(2374),io=n(63),oo=n(2347),co=n(2337),so=n(134),uo=n.n(so),lo=n(1722),fo=n.n(lo),po=Object(it.a)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",textAlign:"center"},error:{display:"block",color:"red",width:"30em",wordWrap:"normal",whiteSpace:"normal"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function go(){var e=Object(f.useState)(!1),t=Object(d.a)(e,2),n=t[0],r=t[1],a=po();return Object(f.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}})),n?p.a.createElement("div",{"data-testid":"loading-synteny",className:a.loading},"Loading \u2026",p.a.createElement(Oa.a,null)):null}function mo(e){var t=e.messageText,n=po();return p.a.createElement("div",{className:n.blockMessage},t)}function ho(e){var t=e.error,n=po();return p.a.createElement("div",{className:n.blockError},t.message)}var bo=Object(le.observer)((function(e){var t=e.model;return t.error?p.a.createElement(ho,{error:t.error}):t.message?p.a.createElement(mo,{messageText:t.message}):t.filled?t.reactElement:p.a.createElement(go,null)})),vo=function(e){var t=e.model,n=e.children;return p.a.createElement("div",null,p.a.createElement(t.ReactComponent2,e),n)};vo.defaultProps={children:null};var yo=Object(le.observer)(vo);function wo(e){return Object(A.ConfigurationSchema)("LinearComparativeDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:Be.c,explicitlyTyped:!0})}function Oo(e){return h.types.compose("LinearComparativeDisplay",Ie.BaseDisplay,h.types.model({type:h.types.literal("LinearComparativeDisplay"),configuration:Object(A.ConfigurationReference)(e),height:100})).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:bo}})).views((function(e){return{get rendererTypeName(){return Object(A.getConf)(e,"renderer").type},get renderProps(){return{rpcDriverName:e.rpcDriverName,displayModel:e}}}})).actions((function(e){var t;return{afterAttach:function(){Object(Y.makeAbortableReaction)(e,jo,ko,{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){var r=n.data,a=n.reactElement,i=n.renderingComponent;e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=i,t=void 0},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function jo(e){var t=Object(Y.getSession)(e).rpcManager,n=e,r=n.renderProps,a=n.rendererType;Object(A.readConfObject)(e.configuration);var i=e.adapterConfig,o=Object(Y.getContainingView)(e),c=Object(T.getRpcSessionId)(e);return Object(h.getSnapshot)(o),{rendererType:a,rpcManager:t,renderProps:Object(u.a)(Object(u.a)({},r),{},{view:Object(h.getSnapshot)(o)}),renderArgs:{adapterConfig:i,rendererType:a.name,sessionId:c,timeout:1e6}}}function ko(e){return xo.apply(this,arguments)}function xo(){return(xo=Object(s.a)(o.a.mark((function e(t){var n,r,a,i,c,s,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,r=t.rpcManager,a=t.renderProps,i=t.renderArgs,e.next=5,n.renderInClient(r,Object(u.a)(Object(u.a)({},i),a));case 5:return c=e.sent,s=c.reactElement,d=Object(l.a)(c,["reactElement"]),e.abrupt("return",{reactElement:s,data:d,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Co(e){var t=(0,e.jbrequire)("@jbrowse/core/util/types/mst").ElementId;return h.types.compose("LinearComparativeView",Ia.a,h.types.model({id:t,type:h.types.literal("LinearComparativeView"),height:400,trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,tracks:h.types.array(e.pluggableMstType("track","stateModel")),views:h.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:h.types.array(e.pluggableConfigSchemaType("track"))})).volatile((function(){return{headerHeight:0,width:800}})).views((function(e){return{get initialized(){return e.views.length>0},get refNames(){return(e.views||[]).map((function(e){return Object(c.a)(new Set(e.staticBlocks.map((function(e){return e.refName}))))}))},get assemblyNames(){return Object(c.a)(new Set(e.views.map((function(e){return e.assemblyNames})).flat()))}}})).actions((function(t){return{afterAttach:function(){var e=this;Object(h.addDisposer)(t,Object(h.onAction)(t,(function(n){if(t.linkViews){var r=n.name,a=n.path,i=n.args;["horizontalScroll","zoomTo","setScaleFactor","showTrack","hideTrack","toggleTrack"].includes(r)&&a&&e.onSubviewAction(r,a,i)}})))},beforeDestroy:function(){var e=Object(Y.getSession)(t);t.assemblyNames.forEach((function(t){var n;t.endsWith("-temp")&&(null===(n=e.removeAssembly)||void 0===n||n.call(e,t))}))},onSubviewAction:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t.views.forEach((function(t){var a=Object(h.getPath)(t);a.lastIndexOf(n)!==a.length-n.length&&t[e](r[0])}))},setWidth:function(e){t.width=e,t.views.forEach((function(t){return t.setWidth(e)}))},setHeight:function(e){t.height=e},setViews:function(e){t.views=Object(h.cast)(e)},removeView:function(e){t.views.remove(e)},closeView:function(){Object(h.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},toggleInteract:function(){t.interactToggled=!t.interactToggled},toggleIntraviewLinks:function(){t.showIntraviewLinks=!t.showIntraviewLinks},toggleLinkViews:function(){t.linkViews=!t.linkViews},activateTrackSelector:function(){if("hierarchical"!==t.trackSelectorType)throw new Error("invalid track selector type ".concat(t.trackSelectorType));var e=Object(Y.getSession)(t);if(Object(Y.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=Object(h.resolveIdentifier)(a,Object(h.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),l=i.displays.find((function(e){return s.includes(e.type)}));if(!l)throw new Error("could not find a compatible display for view type ".concat(t.type));var d=o.stateModel.create(Object(u.a)(Object(u.a)({},r),{},{type:i.type,configuration:i,displays:[{type:l.type,configuration:l}]}));t.tracks.push(d)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(h.resolveIdentifier)(r,Object(h.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return Object(ge.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length}}})).views((function(e){return{get menuItems(){var t=[];return e.views.forEach((function(e,n){e.menuItems&&t.push({label:"View ".concat(n+1," Menu"),subMenu:e.menuItems})})),t.push({label:"Open track selector",onClick:e.activateTrackSelector,icon:Gt.b}),t}}}))}var So=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearComparativeView",stateModel:t(Co),ReactComponent:Object(f.lazy)((function(){return n.e(63).then(n.bind(null,1275))}))})};function To(e){return h.types.compose("LinearSyntenyDisplay",Oo(e),h.types.model({type:h.types.literal("LinearSyntenyDisplay"),configuration:Object(A.ConfigurationReference)(e)})).views((function(e){return{get highResolutionScaling(){return 1},get renderProps(){var t=Object(Y.getContainingView)(e);return{rpcDriverName:e.rpcDriverName,displayModel:e,config:Object(A.getConf)(e,"renderer"),width:t.width,height:100}},get rendererTypeName(){return e.configuration.renderer.type},get adapterConfig(){return Object(u.a)({name:e.parentTrack.configuration.adapter.type,assemblyNames:Object(A.getConf)(e,"assemblyNames")},Object(A.getConf)(e.parentTrack,"adapter"))},get trackIds(){return Object(A.getConf)(e,"trackIds")}}}))}var Eo=o.a.mark(Mo);function Ro(e,t){return e?5:t-5}function Mo(){var e,t,n,r,a,i,c,s=arguments;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:e=s.length>0&&void 0!==s[0]?s[0]:[],t=s.length>1&&void 0!==s[1]?s[1]:[],n=s.length>2?s[2]:void 0,r=0,a=0;case 5:if(!(r<e.length&&a<t.length)){o.next=22;break}if(i=n(e[r]),c=n(t[a]),!(i<c)){o.next=12;break}r++,o.next=20;break;case 12:if(!(c<i)){o.next=16;break}a++,o.next=20;break;case 16:return o.next=18,[e[r],t[a]];case 18:r++,a++;case 20:o.next=5;break;case 22:case"end":return o.stop()}}),Eo)}var Po=[0,1,2,3],No=Po[0],Ao=Po[2],Fo=At.parseCigar;function Io(e,t){return(e.bpToPx(t)||{}).offsetPx||0}var Bo=Object(le.observer)((function(e){var t=Object(f.useRef)(null),n=e.height,r=e.width,a=e.displayModel,i=void 0===a?{}:a,o=e.highResolutionScaling,c=void 0===o?1:o,s=e.features,u=e.trackIds,l=function(e){for(var t=[],n=0;n<e.length;n++)for(var r=n;r<e.length;r++)if(n!==r){var a,i=Object(Ue.a)(Mo(e[n],e[r],(function(e){return e.get("syntenyId")})));try{for(i.s();!(a=i.n()).done;){var o=Object(d.a)(a.value,2),c=o[0],s=o[1];t.push([{feature:c,level:n,refName:c.get("refName"),layout:[c.get("start"),0,c.get("end"),10]},{feature:s,level:r,refName:s.get("refName"),layout:[s.get("start"),0,s.get("end"),10]}])}}catch(u){i.e(u)}finally{i.f()}}return t}(Object(f.useMemo)((function(){return s.map((function(e){return e.map((function(e){return new Q.a(e)})).sort((function(e,t){return e.get("syntenyId")-t.get("syntenyId")}))}))}),[s])),g=Object(f.useMemo)((function(){try{var e="type"in i?Object(Y.getContainingView)(i):void 0;return null===e||void 0===e?void 0:e.views}catch(t){return console.warn("parent view gone"),null}}),[i]),m=null===g||void 0===g?void 0:g.map((function(e){return e.offsetPx}));return Object(f.useEffect)((function(){if(t.current&&m&&g&&Object(h.isAlive)(i)){var e=t.current.getContext("2d");if(e){e.clearRect(0,0,r,n),e.scale(c,c),e.fillStyle=Object(A.getConf)(i,["renderer","color"]),e.strokeStyle=Object(A.getConf)(i,["renderer","color"]);l.forEach((function(t){for(var r=0;r<t.length-1;r+=1){var a=t[r],i=a.layout,o=a.feature,c=a.level,s=a.refName,u=t[r+1],l=u.layout,d=u.feature,f=u.level,p=u.refName,h=g[c],b=g[f];if(!i||!l)return void console.warn("received null layout for a overlay feature");if(c!==f){var v=o.get("end")-o.get("start"),y=d.get("end")-d.get("start");v<h.bpPerPx||b.bpPerPx,0;var w=Io(h,{refName:s,coord:i[No]})-m[c],O=Io(h,{refName:s,coord:i[Ao]})-m[c],j=Io(b,{refName:p,coord:l[No]})-m[f],k=Io(b,{refName:p,coord:l[Ao]})-m[f],x=Ro(c<f,n),C=Ro(f<c,n);if(v<h.bpPerPx||y<b.bpPerPx)e.beginPath(),e.moveTo(w,x),e.lineTo(j,C),e.stroke();else{var S=w,T=j,E=w<O?1:-1,R=j<k?1:-1,M=o.get("cg")||o.get("CIGAR");if(M)for(var P=Fo(M),N=0;N<P.length;N+=2){var A=+P[N],F=P[N+1],I=S,B=T;"M"===F||"="===F?(e.fillStyle="#f003",S+=A/g[0].bpPerPx*E,T+=A/g[1].bpPerPx*R):"X"===F?(e.fillStyle="brown",S+=A/g[0].bpPerPx*E,T+=A/g[1].bpPerPx*R):"D"===F?(e.fillStyle="#00f3",S+=A/g[0].bpPerPx*E):"N"===F?(e.fillStyle="#0a03",S+=A/g[0].bpPerPx*E):"I"===F&&(e.fillStyle="#ff03",T+=A/g[1].bpPerPx*R),e.beginPath(),e.moveTo(I,x),e.lineTo(S,x),e.lineTo(T,C),e.lineTo(B,C),e.closePath(),e.fill()}else e.beginPath(),e.moveTo(w,x),e.lineTo(O,x),e.lineTo(k,C),e.lineTo(j,C),e.closePath(),e.fill()}}}}))}}}),[i,c,u,r,g,m,n,l]),p.a.createElement("canvas",{ref:t,"data-testid":"synteny_canvas",width:r,height:n})})),Do=Object(A.ConfigurationSchema)("LinearSyntenyRenderer",{color:{type:"color",description:"the color of each feature in a synteny",defaultValue:"rgb(255,100,100,0.3)"}},{explicitlyTyped:!0}),Lo=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"render",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a,i,c,s,l,d=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.width,r=t.view.views,a=r.map((function(e){var t=Ba.a.create(e);return t.setVolatileWidth(n),t})),e.next=4,Promise.all(a.map((function(e){return d.getFeatures(Object(u.a)(Object(u.a)({},t),{},{regions:e.staticBlocks.contentBlocks}))})));case 4:for(i=e.sent,c=JSON.parse(JSON.stringify(i)),s=0;s<c.length;s++)for(l=0;l<c[s].length;l++)c[s][l]._level=s;return e.abrupt("return",{reactElement:p.a.createElement(this.ReactComponent,Object(u.a)(Object(u.a)({},t),{},{features:i})),features:c});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Fa);function Vo(e){return h.types.compose(Co(e),h.types.model("LinearSyntenyView",{type:h.types.literal("LinearSyntenyView")}))}var Wo=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearSyntenyView",stateModel:t(Vo),ReactComponent:Object(f.lazy)((function(){return n.e(39).then(n.bind(null,2459))}))})},zo=n(1022),Ho=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).cache=new Xa.a({cache:new Ya.a({maxSize:1}),fill:function(){return e.setup()}}),e.initialized=!1,e.geneNameToRows={},e.rowToGeneName=[],e.subadapters=void 0,e.assemblyNames=void 0,e.mcscanAnchorsLocation=void 0,e}return Object(m.a)(n,[{key:"configure",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,r=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(A.readConfObject)(this.config,"subadapters"),n=Object(A.readConfObject)(this.config,"assemblyNames"),this.mcscanAnchorsLocation=Object(de.openLocation)(Object(A.readConfObject)(this.config,"mcscanAnchorsLocation")),e.next=5,Promise.all(t.map(function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(a=r.getSubAdapter)||void 0===a?void 0:a.call(r,t);case 2:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===n;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=n.dataAdapter;case 11:if(!((i=e.t2)instanceof X.BaseFeatureDataAdapter)){e.next=14;break}return e.abrupt("return",i);case 14:throw new Error("invalid subadapter type '".concat(r.config.subadapter.type,"'"));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:this.subadapters=e.sent,this.assemblyNames=n;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setup",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=8;break}return e.next=3,this.configure();case 3:return e.next=5,this.mcscanAnchorsLocation.readFile("utf8");case 5:e.sent.split("\n").forEach((function(e,n){if(e.length&&"###"!==e){var r=e.split("\t"),a=Object(d.a)(r,3),i=a[0],o=a[1],c=a[2];void 0===t.geneNameToRows[i]&&(t.geneNameToRows[i]=[]),void 0===t.geneNameToRows[o]&&(t.geneNameToRows[o]=[]),t.geneNameToRows[i].push(n),t.geneNameToRows[o].push(n),t.rowToGeneName[n]={name1:i,name2:o,score:+c}}})),this.initialized=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(Ga.ObservableCreate)(function(){var r=Object(s.a)(o.a.mark((function r(a){var i,c;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.cache.get("initialize",n,n.signal);case 2:if(-1===(i=t.assemblyNames.indexOf(e.assemblyName))){r.next=7;break}return c=t.subadapters[i].getFeatures(e),r.next=7,c.pipe(Object(zo.a)((function(e){(t.geneNameToRows[e.get("name")]||[]).forEach((function(t){a.next(new Q.a(Object(u.a)(Object(u.a)({},e.toJSON()),{},{syntenyId:t})))}))}))).toPromise();case 7:a.complete();case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(X.BaseFeatureDataAdapter);Ho.capabilities=["getFeatures","getRefNames"];var qo=Object(A.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors"}},subadapters:{type:"frozen",defaultValue:[]},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),Uo=At.parseCigar;function _o(e){for(var t=Uo(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"D"!==i&&"N"!==i&&(n+=a)}return n}function Go(e){for(var t=Uo(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"D"!==i&&"N"!==i&&(n+=a)}return n}function Jo(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}var Xo=Object(it.a)((function(e){return{root:{width:300},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Yo(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function Qo(e){var t=Xo(),n=e.track,r=e.feature,a=e.handleClose,i=Object(f.useState)("0"),l=Object(d.a)(i,2),g=l[0],m=l[1],h=Object(f.useState)(),b=Object(d.a)(h,2),v=b[0],y=b[1],w=+g,O=Object(f.useState)(),j=Object(d.a)(O,2),k=j[0],x=j[1],C=Object(f.useState)(!1),S=Object(d.a)(C,2),E=S[0],R=S[1];return Object(f.useEffect)((function(){var e=!1;return Object(s.a)(o.a.mark((function t(){var a,i,c,s,u,l,f,p,g,m,h,b;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(2048&r.get("flags"))){t.next=14;break}return a=Yo(r,"SA")||"",i=a.split(";")[0],c=i.split(","),s=Object(d.a)(c,2),u=s[0],l=s[1],f=Object(Y.getSession)(n),p=f.rpcManager,g=Object(A.getConf)(n,"adapter"),m=Object(T.getRpcSessionId)(n),t.next=9,p.call(m,"CoreGetFeatures",{adapterConfig:g,sessionId:m,region:{refName:u,start:+l-1,end:+l}});case 9:h=t.sent,b=h.find((function(e){return e.get("name")===r.get("name")&&!(2048&e.get("flags"))})),e||x(b),t.next=15;break;case 14:x(r);case 15:case"end":return t.stop()}}),t)})))(),function(){e=!0}}),[r,n]),p.a.createElement(no.a,{open:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},p.a.createElement(ro.a,{id:"alert-dialog-title"},"Set window size",p.a.createElement(fr.a,{"aria-label":"close",className:t.closeButton,onClick:a},p.a.createElement(uo.a,null))),p.a.createElement(ao.a,null,k?p.a.createElement("div",{className:t.root},p.a.createElement(rn.a,null,"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."),v?p.a.createElement(rn.a,{color:"error"},"".concat(v)):null,p.a.createElement(oo.a,{value:g,onChange:function(e){m(e.target.value)},label:"Set window size"}),p.a.createElement(oi.a,{control:p.a.createElement(ai.a,{checked:E,onChange:function(){return R((function(e){return!e}))}}),label:"Show qual track"}),p.a.createElement(co.a,{variant:"contained",color:"primary",style:{marginLeft:20},onClick:function(){try{var e,t=k||r,i=Object(Y.getSession)(n),o=Object(Y.getContainingView)(n),s=t.get("CIGAR"),l=Jo(s,1),f=t.get("flags"),p=t.get("qual"),g=Yo(t,"SA")||"",m=t.get("name"),h="".concat(m,"_assembly-temp"),b=Object(A.getConf)(n,"assemblyNames"),v=Object(d.a)(b,1)[0],O=[v,h],j="track-".concat(Date.now()),x="".concat(m,"_vs_").concat(v),C=i.assemblyManager.get(v),S=g.split(";").filter((function(e){return!!e})).map((function(e,n){var r=e.split(","),a=Object(d.a)(r,4),i=a[0],o=a[1],c=a[2],s=a[3],u=function(e){for(var t=Uo(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"I"!==i&&(n+=a)}return n}(s),l=_o(s),f=Go(s),p="-"===c?-1:1,g=Jo(s,1),h=+o-1;return{refName:i,start:h,end:h+u,seqLength:l,clipPos:g,CIGAR:s,assemblyName:v,strand:p,uniqueId:"".concat(t.id(),"_SA").concat(n),mate:{start:g,end:g+f,refName:m}}})),T=t.toJSON();T.clipPos=l,T.mate={refName:m,start:l,end:l+Go(s)};var R=_o(2048&f?S[0].CIGAR:s),M=[T].concat(Object(c.a)(S));M.forEach((function(e,t){e.refName=(null===C||void 0===C?void 0:C.getCanonicalRefName(e.refName))||e.refName,e.syntenyId=t,e.mate.syntenyId=t,e.mate.uniqueId="".concat(e.uniqueId,"_mate")})),M.sort((function(e,t){return e.clipPos-t.clipPos}));var P=t.get("seq"),N=M.concat(M.map((function(e){return e.mate}))),F=2*w,I=M.reduce((function(e,t){return e+t.end-t.start+F}),0),B="".concat(m,"_").concat(Date.now()),D=Object(A.getConf)(C,"sequence"),L=M.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{start:Math.max(0,e.start-w),end:e.end+w,assemblyName:v})})).sort((function(e,t){return e.clipPos-t.clipPos}));null===(e=i.addAssembly)||void 0===e||e.call(i,{name:"".concat(h),sequence:{type:"ReferenceSequenceTrack",trackId:B,assemblyNames:[h],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:R,seq:P,refName:m,uniqueId:"".concat(Math.random())}]}}}),i.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:I/o.width,displayedRegions:L,tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",assemblyNames:[v],configuration:D.trackId,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!1,showTranslation:!1,height:35,configuration:"".concat(B,"-LinearReferenceSequenceDisplay")}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:R/o.width,displayedRegions:[{assemblyName:h,start:0,end:R,refName:m}],tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",configuration:B,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!1,showTranslation:!1,height:35,configuration:"".concat(B,"-LinearReferenceSequenceDisplay")}]}].concat(Object(c.a)(E?[{id:"".concat(Math.random()),type:"QuantitativeTrack",configuration:{trackId:"qualTrack",assemblyNames:[h],name:"Read quality",type:"QuantitativeTrack",adapter:{type:"FromConfigAdapter",noAssemblyManager:!0,features:p.split(" ").map((function(e,t){return{start:t,end:t+1,refName:m,score:+e,uniqueId:"feat_".concat(t)}}))}},displays:[{id:"".concat(Math.random()),type:"LinearWiggleDisplay",height:100}]}]:[]))}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:O,adapter:{type:"FromConfigAdapter",features:N},trackId:j,name:x}],tracks:[{configuration:j,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:"".concat(j,"-LinearSyntenyDisplay")}]}],displayName:"".concat(m," vs ").concat(v)}),a()}catch(V){console.error(V),y(V)}}},"Submit")):p.a.createElement("div",null,p.a.createElement(rn.a,null,"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."),p.a.createElement(io.a,null))))}var $o=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="LinearComparativeViewPlugin",e}return Object(m.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(So)})),e.addViewType((function(){return e.jbrequire(Wo)})),e.addTrackType((function(){var t=Object(A.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:Object(Ie.createBaseTrackConfig)(e)});return new y.a({name:"SyntenyTrack",configSchema:t,stateModel:Object(Ie.createBaseTrackModel)(e,"SyntenyTrack",t)})})),e.addDisplayType((function(){var t=wo(e);return new w.a({name:"LinearComparativeDisplay",configSchema:t,stateModel:Oo(t),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:yo})})),e.addDisplayType((function(){var t=function(e){return Object(A.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},renderer:h.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"LinearSyntenyRenderer"}),middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:wo(e),explicitlyTyped:!0})}(e);return new w.a({name:"LinearSyntenyDisplay",configSchema:t,stateModel:To(t),trackType:"SyntenyTrack",viewType:"LinearSyntenyView",ReactComponent:yo})})),e.addAdapterType((function(){return new v.a({name:"MCScanAnchorsAdapter",configSchema:qo,AdapterClass:Ho})})),e.addRendererType((function(){return new Lo({name:"LinearSyntenyRenderer",configSchema:Do,ReactComponent:Bo,pluginManager:e})}))}},{key:"configure",value:function(e){Object(Y.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Linear synteny view",icon:fo.a,onClick:function(e){e.addView("LinearSyntenyView",{})}});var t=function(e,t){return e?[{label:"Linear read vs ref",icon:va.a,onClick:function(){Object(Y.getSession)(t).setDialogComponent(Qo,{track:Object(Y.getContainingTrack)(t),feature:e})}}]:[]};function n(e){return e.additionalContextMenuItemCallbacks.includes(t)}function r(e){e.addAdditionalContextMenuItemCallback(t)}function a(e){"LinearGenomeView"===e.type&&e.tracks.forEach((function(e){"AlignmentsTrack"===e.type&&e.displays.forEach((function(e){"LinearPileupDisplay"!==e.type||n(e)?"LinearAlignmentsDisplay"===e.type&&e.PileupDisplay&&!n(e.PileupDisplay)&&r(e.PileupDisplay):r(e)}))}))}Object(ge.autorun)((function(){var t,n=null===(t=e.rootModel)||void 0===t?void 0:t.session;n&&n.views.forEach((function(e){e.views?e.views.forEach((function(e){return a(e)})):a(e)}))}))}}]),n}(F.a);var Ko=n(335);function Zo(e){return h.types.compose("LinearLollipopDisplay",Be.a,h.types.model({type:h.types.literal("LinearLollipopDisplay"),configuration:Object(Ko.a)(e)})).views((function(e){return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},get renderProps(){return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(T.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var ec=n(336);function tc(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.y,i=r.data,o=i.anchorX,c=i.radiusPx,s=i.score,u=Object(A.readConfObject)(n,"innerColor",{feature:t}),l=String(s),d=1.1*(2*c/l.length);return d<12?null:p.a.createElement("text",{style:{fontSize:d,fill:Object(ec.contrastingTextColor)(u)},x:o,y:a+c-d/2.4,textAnchor:"middle",dominantBaseline:"hanging"},l)}function nc(e){var t=function(t){var n=e.onFeatureMouseDown,r=e.feature;if(n)return n(t,r.id())},n=function(t){var n=e.onFeatureMouseEnter,r=e.feature;if(n)return n(t,r.id())},r=function(t){var n=e.onFeatureMouseOut,r=e.feature;if(n)return n(t,r.id())},a=function(t){var n=e.onFeatureMouseOver,r=e.feature;if(n)return n(t,r.id())},i=function(t){var n=e.onFeatureMouseUp,r=e.feature;if(n)return n(t,r.id())},o=function(t){var n=e.onFeatureMouseLeave,r=e.feature;if(n)return n(t,r.id())},c=function(t){var n=e.onFeatureMouseMove,r=e.feature;if(n)return n(t,r.id())},s=function(t){var n=e.onFeatureClick,r=e.feature;if(n)return t.stopPropagation(),n(t,r.id())},u=e.feature,l=e.config,d=e.layoutRecord,f=d.anchorLocation,g=d.y,m=d.data,h=m.radiusPx,b=m.score,v=e.selectedFeatureId,y={fill:Object(A.readConfObject)(l,"strokeColor",{feature:u})};String(v)===String(u.id())&&(y.fill="red");var w={fill:Object(A.readConfObject)(l,"innerColor",{feature:u})},O=Object(A.readConfObject)(l,"strokeWidth",{feature:u});return p.a.createElement("g",{"data-testid":u.id()},p.a.createElement("title",null,Object(A.readConfObject)(l,"caption",{feature:u})),p.a.createElement("circle",{cx:f,cy:g+h,r:h,style:y,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:i,onMouseLeave:o,onMouseMove:c,onClick:s,onFocus:a,onBlur:r}),h-O<=2?null:p.a.createElement("circle",{cx:f,cy:g+h,r:h-O,style:w,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:i,onMouseLeave:o,onMouseMove:c,onClick:s,onFocus:a,onBlur:r}),p.a.createElement(tc,Object.assign({},e,{score:b})))}nc.defaultProps={selectedFeatureId:void 0,onFeatureMouseDown:void 0,onFeatureMouseEnter:void 0,onFeatureMouseOut:void 0,onFeatureMouseOver:void 0,onFeatureMouseUp:void 0,onFeatureMouseLeave:void 0,onFeatureMouseMove:void 0,onFeatureClick:void 0};var rc=Object(le.observer)(nc);function ac(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.anchorLocation,i=r.y,o=r.data.radiusPx,c=e.selectedFeatureId,s={fill:Object(A.readConfObject)(n,"bodyColor",{feature:t})};return String(c)===String(t.id())&&(s.fill="red"),p.a.createElement("line",{x1:a,y1:0,x2:a,y2:i+2*o,stroke:Object(A.readConfObject)(n,"stickColor",{feature:t}),strokeWidth:Object(A.readConfObject)(n,"stickWidth",{feature:t})})}ac.defaultProps={selectedFeatureId:void 0};var ic=Object(le.observer)(ac);function oc(e){var t=function(t){var n=e.onMouseEnter;if(n)return n(t)},n=function(t){var n=e.onMouseLeave;if(n)return n(t)};function r(e){var t=e.feature,n=e.bpPerPx,r=e.region,a=e.layout,i=Math.abs(t.get("end")+t.get("start"))/2,o=Object(Y.bpToPx)(i,r,n),c=Object(A.readConfObject)(e.config,"radius",{feature:t});c||console.error(new Error("lollipop radius ".concat(c," configured for feature ").concat(t.id()))),a.add(t.id(),o,2*c,2*c,{featureId:t.id(),anchorX:o,radiusPx:c,score:Object(A.readConfObject)(e.config,"score",{feature:t})})}var a,i=e.regions,o=e.bpPerPx,c=e.layout,s=e.config,u=e.features,l=e.displayModel.selectedFeatureId,f=Object(d.a)(i,1)[0],g=[],m=[],h=Object(Ue.a)(u.values());try{for(h.s();!(a=h.n()).done;){r({feature:a.value,bpPerPx:o,region:f,config:s,layout:c})}}catch(T){h.e(T)}finally{h.f()}var b,v=Object(Ue.a)(c.getLayout(s).values());try{for(v.s();!(b=v.n()).done;){var y=b.value,w=u.get(y.data.featureId);m.push(p.a.createElement(ic,Object.assign({},e,{layoutRecord:y,feature:w,key:"stick-".concat(w.id()),selectedFeatureId:l})))}}catch(T){v.e(T)}finally{v.f()}var O,j=Object(Ue.a)(c.getLayout(s).values());try{for(j.s();!(O=j.n()).done;){var k=O.value,x=u.get(k.data.featureId);m.push(p.a.createElement(rc,Object.assign({},e,{layoutRecord:k,feature:x,key:"body-".concat(x.id()),selectedFeatureId:l})))}}catch(T){j.e(T)}finally{j.f()}var C=(f.end-f.start)/o,S=c.getTotalHeight();return p.a.createElement("svg",{className:"LollipopRendering",width:C,height:S,style:{position:"relative"},onMouseDown:function(t){var n=e.onMouseDown;if(n)return n(t)},onMouseUp:function(t){var n=e.onMouseUp;if(n)return n(t)},onMouseEnter:t,onMouseLeave:n,onMouseOver:function(t){var n=e.onMouseOver;if(n)return n(t)},onMouseOut:function(t){var n=e.onMouseOut;if(n)return n(t)},onFocus:t,onBlur:n,onClick:function(t){var n=e.onClick;if(n)return n(t)}},g,m)}oc.defaultProps={displayModel:{},features:new Map,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onClick:void 0};var cc=Object(le.observer)(oc),sc=Object(A.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0}),uc=n(1024),lc=function(){function e(t){var n=t.width;if(Object(g.a)(this,e),this.width=void 0,this.totalHeight=0,this.items=[],this.layout=new Map,this.layoutDirty=!1,!n)throw new Error("width required to make a new FloatingLayout");this.width=n}return Object(m.a)(e,[{key:"add",value:function(e,t,n,r,a){this.items.push({uniqueId:e,anchorLocation:t,width:n,height:r,data:a}),this.layoutDirty=!0}},{key:"getLayout",value:function(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");for(var t=Object(A.readConfObject)(e,"minStickLength"),n=this.items.sort((function(e,t){return e.data.score-t.data.score})),r=0,a=Array(n.length),i=0;i<n.length;i+=1){for(var o=n[i],c=o.anchorLocation,s=o.width,l=o.height,f=c-s/2,p=f+s,g=t,m=g+l,h=0;h<i;h+=1){var b=Object(d.a)(a[h],2)[1],v=b.x,y=b.y,w=v+b.width,O=y+b.height;Object(Sn.a)(v,w,f,p)&&Object(Sn.a)(y,O,g,m)&&(m=(g=O)+l,h=-1)}a[i]=[o.uniqueId,Object(u.a)(Object(u.a)({},o),{},{x:f,y:g})],m>r&&(r=m)}return this.totalHeight=r,this.layout=new Map(a),this.layoutDirty=!1,this.layout}},{key:"getTotalHeight",value:function(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}},{key:"serializeRegion",value:function(){return this.toJSON()}},{key:"toJSON",value:function(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:Object(c.a)(this.getLayout()),totalHeight:this.getTotalHeight()}}}],[{key:"fromJSON",value:function(){throw new Error("not supported")}}]),e}(),dc=function(){function e(t){var n=t.pairs,r=t.totalHeight;Object(g.a)(this,e),this.layout=void 0,this.totalHeight=void 0,this.layout=new Map(n),this.totalHeight=r}return Object(m.a)(e,[{key:"add",value:function(e){if(!this.layout.has(e))throw new Error("layout error, precomputed layout is missing ".concat(e))}},{key:"getLayout",value:function(){return this.layout}},{key:"getTotalHeight",value:function(){return this.totalHeight}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}(),fc=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"makeLayout",value:function(){var e=this.regions[0],t=(e.end-e.start)/this.bpPerPx;return new uc.a(lc,{width:t})}},{key:"layoutIsValid",value:function(){return!1}}]),n}(Cn.a),pc=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"createSession",value:function(e){return new fc(e)}},{key:"deserializeLayoutInClient",value:function(e){return new dc(e)}}]),n}(Cn.b),gc=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="LollipopPlugin",e}return Object(m.a)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new pc({name:"LollipopRenderer",ReactComponent:cc,configSchema:sc,pluginManager:e})})),e.addDisplayType((function(){var t=function(e){return Object(A.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:Be.c,explicitlyTyped:!0})}(e);return new w.a({name:"LinearLollipopDisplay",configSchema:t,stateModel:Zo(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:Be.b})}))}}]),n}(F.a),mc=n(1088),hc=n.n(mc),bc=n(539),vc=n.n(bc),yc=n(1061),wc=n.n(yc),Oc=n(1087),jc=n.n(Oc),kc=n(1086),xc=n.n(kc),Cc=n(1723),Sc=n.n(Cc),Tc=n(1724),Ec=n.n(Tc),Rc=n(698),Mc=Object(A.ConfigurationSchema)("AboutWidget",{}),Pc=h.types.model("AboutWidget",{id:B.ElementId,type:h.types.literal("AboutWidget")}),Nc=Object(A.ConfigurationSchema)("HelpWidget",{}),Ac=h.types.model("HelpWidget",{id:B.ElementId,type:h.types.literal("HelpWidget")}),Fc=Object(A.ConfigurationSchema)("ImportSessionWidget",{}),Ic=h.types.model("ImportSessionWidget",{id:B.ElementId,type:h.types.literal("ImportSessionWidget")}),Bc=Object(A.ConfigurationSchema)("SessionManager",{}),Dc=h.types.model("SessionManager",{id:B.ElementId,type:h.types.literal("SessionManager")}),Lc=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="MenusPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addWidgetType((function(){return new j.a({name:"AboutWidget",heading:"About",configSchema:Mc,stateModel:Pc,ReactComponent:Object(f.lazy)((function(){return n.e(65).then(n.bind(null,2422))}))})})),e.addWidgetType((function(){return new j.a({name:"HelpWidget",heading:"Help",configSchema:Nc,stateModel:Ac,ReactComponent:Object(f.lazy)((function(){return n.e(66).then(n.bind(null,2423))}))})})),e.addWidgetType((function(){return new j.a({name:"ImportSessionWidget",heading:"Import session",configSchema:Fc,stateModel:Ic,ReactComponent:Object(f.lazy)((function(){return Promise.all([n.e(25),n.e(43)]).then(n.bind(null,2424))}))})})),e.addWidgetType((function(){return new j.a({name:"SessionManager",heading:"Sessions",configSchema:Bc,stateModel:Dc,ReactComponent:Object(f.lazy)((function(){return n.e(29).then(n.bind(null,2425))}))})}))}},{key:"configure",value:function(e){Object(Y.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:xc.a,onClick:function(e){var t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:jc.a,onClick:function(e){var t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}),e.rootModel.insertInMenu("File",{label:"Export session",icon:wc.a,onClick:function(e){var t=new Blob([JSON.stringify({session:Object(h.getSnapshot)(e)},null,2)],{type:"text/plain;charset=utf-8"});Object(Rc.saveAs)(t,"session.json")}},1),e.rootModel.insertInMenu("File",{label:"Import session\u2026",icon:Sc.a,onClick:function(e){var t=e.addWidget("ImportSessionWidget","importSessionWidget");e.showWidget(t)}},1),e.rootModel.insertInMenu("File",{label:"Open session\u2026",icon:vc.a,onClick:function(e){var t=e.addWidget("SessionManager","sessionManager");e.showWidget(t)}},1),e.rootModel.insertInMenu("File",{label:"Save session",icon:Ec.a,onClick:function(e){e.saveSessionToLocalStorage&&(e.saveSessionToLocalStorage(),e.notify('Saved session "'.concat(e.name,'"'),"success"))}},1),e.rootModel.insertInMenu("File",{label:"Duplicate session",icon:hc.a,onClick:function(e){var t;null===(t=e.duplicateCurrentSession)||void 0===t||t.call(e)}},1))}}]),r}(F.a),Vc=n(1725),Wc=n.n(Vc),zc=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).endpoint=void 0,r.queryTemplate=void 0,r.refNamesQueryTemplate=void 0,r.additionalQueryParams=void 0,r.configRefNames=void 0,r.refNames=void 0,r.endpoint=Object(A.readConfObject)(e,"endpoint").uri,r.queryTemplate=Object(A.readConfObject)(e,"queryTemplate"),r.additionalQueryParams=Object(A.readConfObject)(e,"additionalQueryParams"),r.refNamesQueryTemplate=Object(A.readConfObject)(e,"refNamesQueryTemplate"),r.configRefNames=Object(A.readConfObject)(e,"refNames"),r}return Object(m.a)(n,[{key:"getRefNames",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,r,a,i=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},!this.refNames){e.next=3;break}return e.abrupt("return",this.refNames);case 3:if(n=[],!this.refNamesQueryTemplate){e.next=12;break}return r=encodeURIComponent(this.refNamesQueryTemplate),e.next=8,this.querySparql(r,t);case 8:a=e.sent,n=this.resultsToRefNames(a),e.next=13;break;case 12:this.configRefNames&&(n=this.configRefNames);case 13:return this.refNames=n,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(Ga.ObservableCreate)(function(){var r=Object(s.a)(o.a.mark((function r(a){var i,c,s;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=encodeURIComponent(Wc()(t.queryTemplate,e)),c=e.refName,r.next=4,t.querySparql(i,n);case 4:s=r.sent,t.resultsToFeatures(s,c).forEach((function(e){a.next(e)})),a.complete();case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),n.signal)}},{key:"querySparql",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",this.additionalQueryParams.length&&(r="&".concat(this.additionalQueryParams.join("&"))),a=n&&n.signal,e.next=5,fetch("".concat(this.endpoint,"?query=").concat(t).concat(r),{headers:{accept:"application/json,application/sparql-results+json"},signal:a});case 5:return i=e.sent,e.abrupt("return",i.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"resultsToRefNames",value:function(e){var t=((e||{}).results||{}).bindings||[];if(!t.length)return[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return t.map((function(e){return e.refName.value}))}},{key:"resultsToFeatures",value:function(e,t){var n=((e||{}).results||{}).bindings||[];if(!n.length)return[];var r=e.head.vars;["start","end","uniqueId"].forEach((function(e){r.includes(e)||console.error("Required field ".concat(e," missing from feature data"))}));var a={};n.forEach((function(e){var n=[{}];r.forEach((function(t){if(t in e){for(var r=e[t].value,a=0;t.startsWith("sub_");)t=t.slice(4),a+=1;for(;a>n.length-1;)n.push({});n[a][t]=r}})),n.forEach((function(e,r){var i=e.uniqueId;r<n.length-1&&(n[r+1].parentUniqueId=i),a[i]={data:Object(u.a)(Object(u.a)({},e),{},{uniqueId:i,refName:t,start:parseInt(e.start,10),end:parseInt(e.end,10),strand:parseInt(e.strand,10)||0})}}))}));for(var i=0,o=Object.entries(a);i<o.length;i++){var s=Object(d.a)(o[i],2),l=s[0],f=s[1],p=f.data.parentUniqueId;if(delete f.data.parentUniqueId,p){var g=a[p];if(g)g.data.subfeatures||(g.data.subfeatures=[]),g.data.subfeatures.push(Object(u.a)(Object(u.a)({},f.data),{},{uniqueId:l})),delete a[l];else{var m,h=Object.values(a).map((function(e){return e.data.subfeatures})).filter((function(e){return!!e})).flat(),b=!1,v=Object(Ue.a)(h);try{for(v.s();!(m=v.n()).done;){var y=m.value;if(y&&y.uniqueId===p){y.subfeatures||(y.subfeatures=[]),y.subfeatures.push(Object(u.a)(Object(u.a)({},f.data),{},{uniqueId:l})),delete a[l],b=!0;break}y&&y.subfeatures&&h.push.apply(h,Object(c.a)(y.subfeatures))}}catch(w){v.e(w)}finally{v.f()}b||console.error("Could not find parentID ".concat(p))}}}return Object.keys(a).map((function(e){return new Q.a(Object(u.a)(Object(u.a)({},a[e].data),{},{uniqueId:e,subfeatures:a[e].data.subfeatures}))}))}},{key:"hasDataForRefName",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:if(!(r=e.sent).length||r.includes(t)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(X.BaseFeatureDataAdapter),Hc=Object(A.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0}),qc=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="RdfPlugin",e}return Object(m.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new v.a({name:"SPARQLAdapter",configSchema:Hc,AdapterClass:zc})}))}}]),n}(F.a),Uc=Object(A.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi"}}},{explicitlyTyped:!0}),_c=Object(A.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes"}}},{explicitlyTyped:!0});function Gc(e){for(var t=e.codonTable,n=e.seq,r=e.frame,a=e.bpPerPx,i=e.region,o=e.height,c=e.y,s=e.reverse,u=void 0!==s&&s,l=e.theme,d=a,f=3-i.start%3,g=(r+f+3)%3,m=n.slice(g),h=[],b=0;b<m.length;b+=3){var v=m.slice(b,b+3),y=u?Object(Y.revcom)(v):v,w=t[y]||"";h.push({letter:w,codon:y.toUpperCase()})}var O=1/d*3,j=0===i.start?0:O,k=1/a>=12,x=(i.end-i.start)/a,C=["#d8d8d8","#adadad","#8f8f8f"].reverse();return p.a.createElement(p.a.Fragment,null,h.map((function(e,t){var n=i.reversed?x-(O*(t+1)+g/d-j):O*t+g/d-j,a=e.letter,s=e.codon;return p.a.createElement(p.a.Fragment,{key:"".concat(t,"-").concat(a)},p.a.createElement("rect",{x:n,y:c,width:k?O:O+.7,height:o,stroke:k?"#555":"none",fill:Y.defaultStarts.includes(s)?l.palette.startCodon:Y.defaultStops.includes(s)?l.palette.stopCodon:C[Math.abs(r)]}),k?p.a.createElement("text",{x:n+O/2,y:c+o/2,dominantBaseline:"middle",textAnchor:"middle"},a):null)})))}function Jc(e){var t=e.bpPerPx,n=e.region,r=e.feature,a=e.theme,i=e.height,o=e.seq,c=e.y,s=1/t>=12,u=Object(Y.bpSpanPx)(r.get("start"),r.get("end"),n,t),l=Object(d.a)(u,2),f=l[0],g=l[1],m=n.reversed,h=r.get("end")-r.get("start"),b=Math.max((g-f)/h,.8);return p.a.createElement(p.a.Fragment,null,o.split("").map((function(e,t){var n=a.palette.bases[e.toUpperCase()],r=m?g-(t+1)*b:f+t*b;return p.a.createElement(p.a.Fragment,{key:t},p.a.createElement("rect",{x:r,y:c,width:b,height:i,fill:n?n.main:"#aaa",stroke:s?"#555":"none"}),s?p.a.createElement("text",{x:r+b/2,y:c+i/2,dominantBaseline:"middle",textAnchor:"middle",fill:n?Object(ec.contrastingTextColor)(n.main):"black"},e):null)})))}var Xc=function(e){var t=e.regions,n=e.theme,r=e.features,a=void 0===r?new Map:r,i=e.showReverse,o=e.showForward,s=e.showTranslation,u=e.bpPerPx,l=Object(d.a)(t,1)[0],f=Object(me.createJBrowseTheme)(n),g=Object(Y.generateCodonTable)(Y.defaultCodonTable),m=Object(c.a)(a.values())[0];if(!m)return null;var h=m.get("seq");if(!h)return null;var b=-20;return p.a.createElement(p.a.Fragment,null,s&&(l.reversed?i:o)?[2,1,0].map((function(e){return p.a.createElement(Gc,{key:"translation-".concat(e),seq:h,y:b+=20,codonTable:g,frame:e,bpPerPx:u,region:l,theme:f,height:20,reverse:l.reversed})})):null,o?p.a.createElement(Jc,{height:20,y:b+=20,feature:m,region:l,seq:l.reversed?Object(Y.complement)(h):h,bpPerPx:u,theme:f}):null,i?p.a.createElement(Jc,{height:20,y:b+=20,feature:m,region:l,seq:l.reversed?h:Object(Y.complement)(h),bpPerPx:u,theme:f}):null,s&&(l.reversed?o:i)?[0,-1,-2].map((function(e){return p.a.createElement(Gc,{key:"rev-translation-".concat(e),seq:h,y:b+=20,codonTable:g,frame:e,bpPerPx:u,region:l,theme:f,height:20,reverse:!l.reversed})})):null)},Yc=function(e){var t=e.exportSVG,n=e.width,r=e.totalHeight,a=e.children;return t?p.a.createElement(p.a.Fragment,null,a):p.a.createElement("svg",{width:n,height:r,style:{width:n,height:r}},a)};var Qc=Object(le.observer)((function(e){var t=e.regions,n=e.bpPerPx,r=Object(d.a)(t,1)[0],a=(r.end-r.start)/n;return p.a.createElement(Yc,Object.assign({},e,{totalHeight:200,width:a}),p.a.createElement(Xc,e))})),$c=Object(A.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0}),Kc=Object(A.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai"}}},{explicitlyTyped:!0}),Zc=Object(A.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:$c},{explicitIdentifier:"displayId",explicitlyTyped:!0});var es=Object(A.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit"}}},{explicitlyTyped:!0}),ts=function(e){return Object(A.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})},ns=function(e){return{configSchema:e.load(ts),getAdapterClass:function(){return n.e(69).then(n.bind(null,2429)).then((function(e){return e.default}))}}};var rs=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(m.a)(n,[{key:"getExpandedRegion",value:function(e){return Object(u.a)(Object(u.a)({},e),{},{start:Math.max(e.start-3,0),end:e.end+3})}}]),n}(Ve.a),as=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="SequencePlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new v.a({name:"TwoBitAdapter",configSchema:es,getAdapterClass:function(){return Promise.all([n.e(2),n.e(19),n.e(70)]).then(n.bind(null,2426)).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new v.a({name:"ChromSizesAdapter",configSchema:_c,getAdapterClass:function(){return n.e(68).then(n.bind(null,2427)).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new v.a({name:"IndexedFastaAdapter",configSchema:Kc,getAdapterClass:function(){return Promise.all([n.e(0),n.e(7)]).then(n.bind(null,2296)).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new v.a({name:"BgzipFastaAdapter",configSchema:Uc,getAdapterClass:function(){return Promise.all([n.e(0),n.e(7),n.e(67)]).then(n.bind(null,2428)).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new v.a(Object(u.a)({name:"GCContentAdapter"},e.load(ns)))})),e.addTrackType((function(){var t=function(e){return Object(A.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:h.types.array(e.pluggableConfigSchemaType("display")),metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}}},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),r=new Set,a=n.displays,i=void 0===a?[]:a;return"placeholderId"!==n.trackId&&(i.forEach((function(e){return e&&r.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){r.has(e.name)||i.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})}))),Object(u.a)(Object(u.a)({},n),{},{displays:i})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}(e);return new y.a({name:"ReferenceSequenceTrack",configSchema:t,stateModel:Object(Ie.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})})),e.addDisplayType((function(){var e,t=(e=Zc,h.types.compose("LinearReferenceSequenceDisplay",Be.a,h.types.model({type:h.types.literal("LinearReferenceSequenceDisplay"),configuration:Object(A.ConfigurationReference)(e),showForward:h.types.optional(h.types.boolean,!0),showReverse:h.types.optional(h.types.boolean,!0),showTranslation:h.types.optional(h.types.boolean,!1),height:60})).views((function(e){return{get renderProps(){var t=e.showForward,n=e.showReverse,r=e.showTranslation;return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(T.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer,showForward:t,showReverse:n,showTranslation:r})},regionCannotBeRendered:function(){var t=Object(Y.getContainingView)(e);if(t&&t.bpPerPx>=1)return"Zoom in to see sequence"},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{toggleShowForward:function(){e.showForward=!e.showForward},toggleShowReverse:function(){e.showReverse=!e.showReverse},toggleShowTranslation:function(){e.showTranslation=!e.showTranslation}}})).views((function(e){return{get trackMenuItems(){return[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:function(){e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:function(){e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:function(){e.toggleShowTranslation()}}]}}})));return{name:"LinearReferenceSequenceDisplay",configSchema:Zc,stateModel:t,trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:Be.b}})),e.addRendererType((function(){return new rs({name:"DivSequenceRenderer",ReactComponent:Qc,configSchema:$c,pluginManager:e})}))}}]),r}(F.a),is=function(){function e(t,n,r,a,i,o){if(Object(g.a)(this,e),this.name=void 0,this.left=void 0,this.top=void 0,this.width=void 0,this.height=void 0,this.data=void 0,this.children=void 0,this.absoluteCache=void 0,this.parent=void 0,Y.inDevelopment&&("string"!==typeof t||"number"!==typeof n||Number.isNaN(n)||"number"!==typeof r||Number.isNaN(r)||"number"!==typeof a||Number.isNaN(a)||"number"!==typeof i||Number.isNaN(i)))throw new TypeError("invalid SceneGraph arguments");this.name=t,this.left=n,this.top=r,this.width=a,this.height=i,this.data=o,this.children=new Map,this.absoluteCache={dirty:!0}}return Object(m.a)(e,[{key:"addChild",value:function(t,n,r,a,i,o){var c;if(!((c=t instanceof e?t:new e(t,n,r,a,i,o))instanceof e))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(c.name))throw new Error('child named "'.concat(c.name,'" already exists'));c.parent=this;var s=c.absolute,u=s.left,l=s.right,d=s.top,f=s.bottom;return void 0!==u&&void 0!==l&&void 0!==d&&void 0!==f&&(this.expand(u,l,d,f),this.children.set(c.name,c)),c}},{key:"getSubRecord",value:function(e){return this.children.get(e)}},{key:"expand",value:function(e,t,n,r){var a=this.absolute,i=a.left,o=a.right,c=a.top,s=a.bottom;if(void 0!==i&&e<i){var u=i-e;this.width+=u,this.left-=u}if(void 0!==o&&t>o&&(this.width+=t-o),void 0!==c&&n<c){var l=c-n;this.height+=l,this.top-=l}void 0!==s&&r>s&&(this.height+=r-s),this.parent&&this.parent.expand(e,t,n,r),this.absoluteCache.dirty=!0}},{key:"bottom",get:function(){return this.top+this.height}},{key:"right",get:function(){return this.left+this.width}},{key:"walkParents",value:function(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}},{key:"walkChildren",value:function(e){var t,n=Object(Ue.a)(this.children.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r),r.walkChildren(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"absolute",get:function(){if(this.absoluteCache.dirty){var e=0,t=0;this.walkParents((function(n){e+=n.left,t+=n.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}},{key:"move",value:function(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((function(e){e.absoluteCache.dirty=!0}));var n=this.absolute,r=n.left,a=n.right,i=n.top,o=n.bottom;void 0!==r&&void 0!==a&&void 0!==i&&void 0!==o&&this.expand(r,a,i,o)}}]),e}();function os(e){var t=e.text,n=e.x,r=e.y,a=e.color,i=void 0===a?"black":a,o=e.fontHeight,c=void 0===o?13:o,s=e.featureWidth,u=e.reversed,l=e.allowedWidthExpansion,d=e.fontWidthScaleFactor,f=c*(void 0===d?.6:d),g=s&&l?s+l:1/0;return p.a.createElement("text",{x:u?n+(s||0)-f*t.length:n,y:r+c,style:{fontSize:c,fill:i,cursor:"default"}},f*t.length>g?"".concat(t.slice(0,g/f),"..."):t)}function cs(e){var t=e.feature,n=e.rootLayout,r=e.selected,a=e.config,i=e.name,o=e.shouldShowName,c=e.description,s=e.shouldShowDescription,u=e.fontHeight,l=e.allowedWidthExpansion,d=e.reversed,f=n.getSubRecord(String(t.id())),g=f.data.GlyphComponent,m=[p.a.createElement(g,Object.assign({key:"glyph-".concat(t.id())},e,{feature:t,featureLayout:f,selected:r}))];return o&&m.push(p.a.createElement(os,{key:"glyph-name-".concat(t.id()),text:i,x:n.getSubRecord("nameLabel").absolute.left,y:n.getSubRecord("nameLabel").absolute.top,color:Object(A.readConfObject)(a,["labels","nameColor"],{feature:t}),fontHeight:u,reversed:d,featureWidth:f.width,allowedWidthExpansion:l})),s&&m.push(p.a.createElement(os,{key:"glyph-description-".concat(t.id()),text:c,x:n.getSubRecord("descriptionLabel").absolute.left,y:n.getSubRecord("descriptionLabel").absolute.top,color:Object(A.readConfObject)(a,["labels","descriptionColor"],{feature:t}),fontHeight:u,featureWidth:f.width,reversed:d,allowedWidthExpansion:l})),p.a.createElement("g",null,m)}cs.defaultProps={reversed:!1,selected:!1,name:"",shouldShowName:!1,description:"",shouldShowDescription:!1,fontHeight:void 0,allowedWidthExpansion:void 0};var ss=Object(le.observer)(cs);function us(e){var t=e.rect,n=e.region,r=e.bpPerPx,a=Object(l.a)(e,["rect","region","bpPerPx"]);if(!t)return null;var i=Object(d.a)(t,4),o=i[0],c=i[1],s=i[2],u=i[3],f=Object(Y.bpSpanPx)(o,s,n,r),g=Object(d.a)(f,2),m=g[0],h=g[1],b=Math.round(c),v=(n.end-n.start)/r,y=Math.round(u-c),w=h-m;if(m+w<0)return null;var O=Math.max(m,0),j=O-m,k=Math.max(1,Math.min(w-j,v));return p.a.createElement("rect",Object.assign({x:O-2,y:b-2,width:k+4,height:y+4},a))}var ls=Object(le.observer)((function(e){var t=e.displayModel,n=t.blockLayoutFeatures,r=t.selectedFeatureId,a=t.featureIdUnderMouse,i=t.contextMenuFeature,o=e.blockKey,c=e.region,s=e.bpPerPx,u=e.movedDuringLastMouseDown,d=Object(l.a)(e,["displayModel","blockKey","region","bpPerPx","movedDuringLastMouseDown"]),f=null===n||void 0===n?void 0:n.get(o);if(!f)return null;var g=a||(null===i||void 0===i?void 0:i.id());function m(e){var t=d.onFeatureMouseOut;if(t&&g)return t(e,g)}function h(e){var t=d.onFeatureMouseOver;if(t&&g)return t(e,g)}return p.a.createElement(p.a.Fragment,null,g?p.a.createElement(us,{rect:f.get(g),region:c,bpPerPx:s,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){var t=d.onFeatureMouseDown;if(t&&g)return t(e,g)},onMouseEnter:function(e){var t=d.onFeatureMouseEnter;if(t&&g)return t(e,g)},onMouseOut:m,onMouseOver:h,onMouseUp:function(e){var t=d.onFeatureMouseUp;if(t&&g)return t(e,g)},onMouseLeave:function(e){var t=d.onFeatureMouseLeave;if(t&&g)return t(e,g)},onMouseMove:function(e){var t=d.onFeatureMouseMove;if(t&&g)return t(e,g)},onClick:function(e){if(!u){var t=d.onFeatureClick;if(t&&g)return e.stopPropagation(),t(e,g)}},onContextMenu:function(e){var t=d.onFeatureContextMenu;if(t&&g)return t(e,g)},onFocus:h,onBlur:m,"data-testid":g}):null,r?p.a.createElement(us,{rect:f.get(r),region:c,bpPerPx:s,stroke:"#00b8ff",fill:"none"}):null)}));function ds(e){var t,n=e.feature,r=e.region,a=e.config,i=e.featureLayout,o=e.selected,c=e.bpPerPx,s=(r.end-r.start)/c,u=Object(A.readConfObject)(a,"color1",{feature:n});try{t=Object(ec.emphasize)(u,.3)}catch(w){t=u}var l=Object(A.readConfObject)(a,"color2",{feature:n}),d=i.absolute,f=d.left,g=d.top,m=d.width,h=d.height;if(f+m<0)return null;var b=Math.max(f,0),v=b-f,y=Math.max(1,Math.min(m-v,s));return p.a.createElement("rect",{"data-testid":"box-".concat(n.id()),x:b,y:g,width:y,height:h,fill:o?t:u,stroke:o?l:void 0})}ds.defaultProps={selected:!1};var fs=Object(le.observer)(ds);function ps(e){var t=e.feature,n=e.bpPerPx,r=e.region,a=e.config,i=e.featureLayout,o=e.selected,c=e.reversed,s=(r.end-r.start)/n,u=Math.max(i.absolute.width,1),l=i.absolute.left,d=i.absolute,f=d.top,g=d.height;Es(t)&&(f+=.175*g,g*=.65);var m,h=t.get("strand")*(c?-1:1),b=Es(t)?Object(A.readConfObject)(a,"color3",{feature:t}):Object(A.readConfObject)(a,"color1",{feature:t});try{m=Object(ec.emphasize)(b,.3)}catch(j){m=b}var v=Object(A.readConfObject)(a,"color2",{feature:t});if(l+u<0)return null;var y=Math.max(l,0),w=y-l,O=Math.max(1,Math.min(u-w,s));return p.a.createElement(p.a.Fragment,null,p.a.createElement("rect",{"data-testid":t.id(),stroke:o?v:void 0,fill:o?m:b,x:y,y:f,width:O,height:g}),h<0&&0===w?p.a.createElement("polygon",{stroke:o?v:void 0,fill:o?m:b,points:[[l,f],[l-g/2,f+g/2],[l,f+g]]}):null,h>0&&y+O<s?p.a.createElement("polygon",{stroke:o?v:void 0,fill:o?m:b,points:[[y+O,f],[y+O+g/2,f+g/2],[y+O,f+g]]}):null)}ps.defaultProps={selected:!1,reversed:!1};var gs=Object(le.observer)(ps);function ms(e){var t,n=e.feature,r=e.featureLayout,a=e.selected,i=e.config,o=e.reversed,c=e.subfeatures||n.get("subfeatures"),s=Object(A.readConfObject)(i,"color2",{feature:n});try{t=Object(ec.emphasize)(s,.3)}catch(b){t=s}var u=r.absolute,l=u.left,d=u.top,f=u.width,g=u.height,m=[[l,d+g/2],[l+f,d+g/2]],h=n.get("strand");return h&&m.push([l+f-g/4,d+g/4],[l+f-g/4,d+g/4*3],[l+f,d+g/2]),p.a.createElement(p.a.Fragment,null,p.a.createElement("polyline",{"data-testid":n.id(),transform:h&&(!o&&h<0||o&&h>0)?"rotate(180,".concat(l+f/2,",").concat(d+g/2,")"):void 0,points:m,stroke:a?t:s}),c.map((function(t){var n=String(t.id()),i=r.getSubRecord(n);if(!i)return null;var o=i.data.GlyphComponent;return p.a.createElement(o,Object.assign({key:"glyph-".concat(n)},e,{feature:t,featureLayout:i,selected:a}))})))}ms.defaultProps={selected:!1,reversed:!1};var hs=Object(le.observer)(ms);function bs(e){var t=ws(e.feature,e.config);return p.a.createElement(hs,Object.assign({},e,{subfeatures:t}))}function vs(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"subParts",t=arguments.length>1?arguments[1]:void 0,n=Object(A.readConfObject)(t,e);if("string"==typeof n&&(n=n.split(/\s*,\s*/)),Array.isArray(n)){var r=n.map((function(e){return e.toLowerCase()}));return function(e){return r.includes(e.get("type").toLowerCase())}}return"function"===typeof n?n:function(){return!0}}("subParts",t)(e)}function ys(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function ws(e,t){var n=e.get("subfeatures");if(!n||!n.length)return[];var r=!!n.find((function(e){return ys(e)})),a=["mRNA","transcript"].includes(e.get("type"));return(!r&&a||Object(A.readConfObject)(t,"impliedUTRs"))&&(n=function(e,t){for(var n,r,a=Object(c.a)(t),i=1/0,o=-1/0,s=[],u=0;u<a.length;u++){var l=a[u].get("type");/^cds/i.test(l)?(i>a[u].get("start")&&(i=a[u].get("start")),o<a[u].get("end")&&(o=a[u].get("end"))):/exon/i.test(l)?s.push(a[u]):ys(a[u])&&(n=a[u].get("start")===e.get("start"),r=a[u].get("end")===e.get("end"))}if(!(s.length&&i<1/0&&o>-1/0))return a;s.sort((function(e,t){return e.get("start")-t.get("start")}));var d,f,p=e.get("strand");if(!n)for(var g=0;g<s.length&&!((d=s[g].get("start"))>=i);g++){f=i>s[g].get("end")?s[g].get("end"):i;var m=p>=0?"five_prime_UTR":"three_prime_UTR";a.unshift(new Q.a({parent:e,id:"".concat(e.id(),"_").concat(m,"_").concat(g),data:{start:d,end:f,strand:p,type:m}}))}if(!r)for(var h=s.length-1;h>=0&&!((f=s[h].get("end"))<=o);h--){d=o<s[h].get("start")?s[h].get("start"):o;var b=p>=0?"three_prime_UTR":"five_prime_UTR";a.push(new Q.a({parent:e,id:"".concat(e.id(),"_").concat(b,"_").concat(h),data:{start:d,end:f,strand:p,type:b}}))}return a}(e,n)),n.filter((function(e){return vs(e,t)}))}bs.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=Ss({layout:t,feature:n,bpPerPx:r,reversed:a,config:i});return Ts({layout:o,subfeatures:ws(n,i),bpPerPx:r,reversed:a,config:i}),o};var Os=Object(le.observer)(bs);function js(e){var t=e.feature,n=e.featureLayout,r=e.selected;return p.a.createElement(p.a.Fragment,null,t.get("subfeatures").map((function(t){var a=String(t.id()),i=n.getSubRecord(a),o=i.data.GlyphComponent;return p.a.createElement(o,Object.assign({key:"glyph-".concat(a)},e,{feature:t,featureLayout:i,selected:r}))})))}js.defaultProps={selected:!1,reversed:!1},js.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=Ss({layout:t,feature:n,bpPerPx:r,reversed:a,config:i}),c=Object(A.readConfObject)(i,"displayMode");if("reducedRepresentation"!==c){var s=n.get("subfeatures")||[],u=0;s.forEach((function(e){var t=xs(e),n=Object(A.readConfObject)(i,"height",{feature:e});(t.layOut||Cs)({layout:o,feature:e,bpPerPx:r,reversed:a,config:i}).move(0,u),u+="collapse"===c?0:("compact"===c?n/3:n)+2}))}return o};var ks=Object(le.observer)(js);function xs(e){var t=e.get("type"),n=e.get("strand"),r=e.get("subfeatures");if(r){if(r.find((function(e){return!!e.get("subfeatures")})))return ks;return["mRNA","transcript"].includes(t)&&r.find((function(e){return"CDS"===e.get("type")}))?Os:hs}return[1,-1].includes(n)?gs:fs}function Cs(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=Object(A.readConfObject)(i,"displayMode"),c=Ss({layout:t,feature:n,bpPerPx:r,reversed:a,config:i});return"reducedRepresentation"!==o&&Ts({layout:c,subfeatures:n.get("subfeatures")||[],bpPerPx:r,reversed:a,config:i}),c}function Ss(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=Object(A.readConfObject)(i,"displayMode"),c="reducedRepresentation"===o?gs:xs(n),s=n.parent(),u=0;s&&(u=a?(s.get("end")-n.get("end"))/r:(n.get("start")-s.get("start"))/r);var l=Object(A.readConfObject)(i,"height",{feature:n}),d=(n.get("end")-n.get("start"))/r,f=t.parent,p=f?f.top:0;return t.addChild(String(n.id()),u,"collapse"===o?0:p,d,"compact"===o?l/2:l,{GlyphComponent:c})}function Ts(e){var t=e.layout,n=e.subfeatures,r=e.bpPerPx,a=e.reversed,i=e.config;n.forEach((function(e){(xs(e).layOut||Cs)({layout:t,feature:e,bpPerPx:r,reversed:a,config:i})}))}function Es(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}var Rs={position:"relative"};function Ms(e){var t,n,r,a,i,o,c=e.feature,s=e.bpPerPx,u=e.region,l=e.config,d=e.displayMode,f=e.layout,g=u.reversed,m=c.get(g?"end":"start"),h=Object(Y.bpToPx)(m,u,s),b="compact"!==d&&"collapsed"!==d,v=new is("root",0,0,0,0),y=(xs(c).layOut||Cs)({layout:v,feature:c,bpPerPx:s,reversed:g,config:l});if(b){var w=Object(A.readConfObject)(l,"showLabels");i=Object(A.readConfObject)(l,["labels","fontSize"],{feature:c}),o=Object(A.readConfObject)(l,"maxFeatureGlyphExpansion")||0,r=Object(A.readConfObject)(l,["labels","name"],{feature:c})||"",t=/\S/.test(r)&&w,a=Object(A.readConfObject)(l,["labels","description"],{feature:c})||"",n=/\S/.test(a)&&w;var O=.6*i,j=0;t&&(j=Math.round(Math.min(String(r).length*O,v.width+o)),v.addChild("nameLabel",0,y.bottom+2,j,i));var k=0;if(n){var x=t?v.getSubRecord("nameLabel"):y;k=Math.round(Math.min(String(a).length*O,v.width+o)),v.addChild("descriptionLabel",0,x.bottom+2,k,i)}}var C=f.addRect(c.id(),c.get("start"),c.get("start")+v.width*s,v.height);return null===C?null:(v.move(h,C),p.a.createElement(ss,Object.assign({key:"svg-feature-".concat(c.id()),feature:c,layout:f,rootLayout:v,bpPerPx:s,config:l,name:String(r),shouldShowName:t,description:String(a),shouldShowDescription:n,fontHeight:i,allowedWidthExpansion:o,reversed:u.reversed},e)))}var Ps=Object(le.observer)((function(e){var t,n=e.features,r=[],a=Object(Ue.a)(n.values());try{for(a.s();!(t=a.n()).done;){var i=t.value;r.push(p.a.createElement(Ms,Object.assign({key:i.id(),feature:i},e)))}}catch(o){a.e(o)}finally{a.f()}return p.a.createElement(p.a.Fragment,null,r)}));function Ns(e){var t=e.layout,n=e.blockKey,r=e.regions,a=e.bpPerPx,i=e.features,o=e.config,c=e.displayModel,s=e.exportSVG,u=r||[],l=Object(d.a)(u,1)[0],g=(l.end-l.start)/a,m=Object(A.readConfObject)(o,"displayMode"),h=Object(f.useRef)(),b=Object(f.useState)(!1),v=Object(d.a)(b,2),y=v[0],w=v[1],O=Object(f.useState)(!1),j=Object(d.a)(O,2),k=j[0],x=j[1],C=Object(f.useState)(0),S=Object(d.a)(C,2),T=S[0],E=S[1],R=e.onMouseOut,M=e.onMouseDown,P=e.onMouseLeave,N=e.onMouseEnter,F=e.onMouseOver,I=e.onMouseMove,B=e.onMouseUp,D=e.onClick,L=Object(f.useCallback)((function(e){w(!0),x(!1);if(M)return M(e)}),[M]),V=Object(f.useCallback)((function(e){w(!1);if(B)return B(e)}),[B]),W=Object(f.useCallback)((function(e){if(N)return N(e)}),[N]),z=Object(f.useCallback)((function(e){if(P)return P(e)}),[P]),H=Object(f.useCallback)((function(e){if(F)return F(e)}),[F]),q=Object(f.useCallback)((function(e){if(R)return R(e)}),[R]),U=Object(f.useCallback)((function(e){y&&x(!0);var t=0,r=0;h.current&&(t=h.current.getBoundingClientRect().left,r=h.current.getBoundingClientRect().top),t=e.clientX-t,r=e.clientY-r;var i=l.reversed?g-t:t,o=l.start+a*i,s=c.getFeatureOverlapping(n,o,r),u=s.length?s[0].name:void 0;I&&I(e,u)}),[n,a,y,I,l.reversed,l.start,c,g]),_=Object(f.useCallback)((function(e){k||D&&D(e)}),[k,D]);return Object(f.useEffect)((function(){E(t.getTotalHeight())}),[t]),s?p.a.createElement(Ps,Object.assign({features:i,displayMode:m},e,{region:l})):p.a.createElement("div",{style:Rs},p.a.createElement("svg",{ref:h,className:"SvgFeatureRendering",width:"".concat(g,"px"),height:"".concat(T,"px"),onMouseDown:L,onMouseUp:V,onMouseEnter:W,onMouseLeave:z,onMouseOver:H,onMouseOut:q,onMouseMove:U,onFocus:W,onBlur:z,onClick:_,style:{display:"block"}},p.a.createElement(Ps,Object.assign({features:i,displayMode:m},e,{region:l,movedDuringLastMouseDown:k})),p.a.createElement(ls,Object.assign({},e,{region:l}))))}Ps.propTypes={features:fi.a.oneOfType([fi.a.instanceOf(Map),fi.a.arrayOf(fi.a.shape())]),layout:fi.a.shape({addRect:fi.a.func.isRequired,getTotalHeight:fi.a.func.isRequired}).isRequired},Ps.defaultProps={features:[]},Ns.defaultProps={displayModel:{},exportSVG:void 0,features:new Map,blockKey:void 0,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onMouseMove:void 0,onClick:void 0,onContextMenu:void 0,onFeatureClick:void 0,onFeatureContextMenu:void 0};var As=Object(le.observer)(Ns),Fs=Object(A.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"black",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},labels:Object(A.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"black",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:13,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:h.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:600},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0}),Is=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return n}(Cn.b),Bs=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="SVGPlugin",e}return Object(m.a)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new Is({name:"SvgFeatureRenderer",ReactComponent:As,configSchema:Fs,pluginManager:e})}))}}]),n}(F.a),Ds=Object(A.ConfigurationSchema)("TheTrackHubRegistryConnection",{trackDbId:{type:"string",defaultValue:"",description:"id of the trackDb in The Track Hub Registry"}},{baseConfiguration:Ie.baseConnectionConfig});function Ls(e,t,n){return function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.members)return Object.values(t.members).map((function(r){return e(r,t.shortLabel?n.concat([t.shortLabel]):n)})).flat();return t.categories=n,[t]}({members:e._source.configuration}).map((function(r){var a=function(e,t,n){var r=e.type.split(" ")[0].toLowerCase();"bam"===r&&e.bigDataUrl.toLowerCase().endsWith("cram")&&(r="cram");var a,i=e.bigDataUrl,o={uri:new URL(i,t).href},c=e.categories;switch(r){case"bam":return a=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href}:e.bigDataIndex?{localPath:e.bigDataIndex}:{localPath:"".concat(e.bigDataUrl,".bai")},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BamAdapter",bamLocation:o,index:{location:a}}};case"bed":case"bed5floatscore":case"bedgraph":case"bedrnaelements":case"bigbarchart":return Object(T.generateUnsupportedTrackConf)(e.shortLabel,r,c);case"bigbed":return{type:"FeatureTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BigBedAdapter",bigBedLocation:o}};case"bigchain":case"biginteract":case"bigmaf":case"bigpsl":return Object(T.generateUnsupportedTrackConf)(e.shortLabel,r,c);case"bigwig":return{type:"QuantitativeTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BigWigAdapter",bigWigLocation:o}};case"broadpeak":case"coloredexon":return Object(T.generateUnsupportedTrackConf)(e.shortLabel,r,c);case"cram":return a=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href}:e.bigDataIndex?{localPath:e.bigDataIndex}:{localPath:"".concat(e.bigDataUrl,".bai")},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"CramAdapter",bamLocation:o,index:{location:a},sequenceAdapter:n}};case"gvf":case"ld2":case"narrowpeak":case"peptidemapping":case"vcftabix":case"wig":case"wigmaf":return Object(T.generateUnsupportedTrackConf)(e.shortLabel,r,c);default:throw new Error("Unsupported track type: ".concat(r))}}(r,e._source.hub.url,n);return a.trackId="trackhub-registry-".concat(Object(Y.objectHash)(a)),a.assemblyNames=[t],a}))}var Vs=function(e){return h.types.compose("TheTrackHubRegistryConnection",Object(Ie.BaseConnectionModelFactory)(e),h.types.model({type:h.types.literal("TheTrackHubRegistryConnection"),configuration:Object(A.ConfigurationReference)(Ds)}).actions((function(e){return{connect:function(t){e.clear();var n=Object(A.readConfObject)(t,"trackDbId");fetch("https://www.trackhubregistry.org/api/search/trackdb/".concat(n)).then((function(e){return e.json()})).then((function(t){var n=t._source.assembly.name,r=Object(Y.getSession)(e).assemblyManager.get(n).configuration,a=Object(A.readConfObject)(r,["sequence","adapter"]);e.setTrackConfs(Ls(t,n,a))})).catch((function(e){console.error(e)}))}}})))},Ws=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="TrackHubRegistryPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addConnectionType((function(){return new S({name:"TheTrackHubRegistryConnection",configSchema:Ds,configEditorComponent:Object(f.lazy)((function(){return n.e(33).then(n.bind(null,2452))})),stateModel:Vs(e),displayName:"The Track Hub Registry",description:"A hub from The Track Hub Registry",url:"//trackhubregistry.org/"})}))}}]),r}(F.a),zs=n(1268),Hs=n(1727),qs=n.n(Hs),Us=n(1726),_s=n.n(Us),Gs=n(517),Js=n(439),Xs=n.n(Js),Ys=function(e){var t=(0,e.jbrequire)("mobx-state-tree").types;return function(e,n){var r=n.DataCellReactComponent,a=void 0===r?null:r,i=n.FilterModelType,o=void 0===i?null:i,c=n.compare,s=n.displayName,u=void 0===s?void 0:s,l=n.categoryName,d=void 0===l?void 0:l;return t.model("ColumnDataType".concat(e),{type:t.literal(e)}).volatile((function(){return{DataCellReactComponent:a,FilterModelType:o,displayName:u||e,categoryName:d}})).views((function(){return{compare:c,get hasFilter(){return!!o}}}))}},Qs=function(e){var t=e.jbrequire,n=t("mobx-state-tree"),r=n.types,a=n.getType,i=n.getParent,c=t("mobx-react").observer,u=t("react"),l=t("@jbrowse/core/util/mst-reflection"),d=l.getPropertyType,f=l.getEnumerationValues,p=l.getSubType,g=t("@jbrowse/core/util"),m=g.compareLocs,h=g.getSession,b=g.parseLocString,v=t(Ys),y=t("@material-ui/core/styles").makeStyles,w=t("@material-ui/core/IconButton"),O=t("@material-ui/core/TextField"),j=t("@material-ui/core/MenuItem"),k=t("@material-ui/core/InputAdornment"),x=t("@material-ui/core/Select"),C=y((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),S=c((function(e){var t=e.filterModel,n=C(),r=f(p(d(a(t),"operation")));return u.createElement(u.Fragment,null,u.createElement(x,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},r.map((function(e){return u.createElement(j,{key:e,value:e},e)})))," ",u.createElement(O,{label:"range",placeholder:"chr1:100-200",error:t.locStringIsInvalid,value:t.locString,onChange:function(e){return t.setLocString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:u.createElement(k,{className:n.textFilterControlAdornment,position:"end"},u.createElement(w,{"aria-label":"clear filter",onClick:function(){return t.setLocString("")},color:"secondary"},u.createElement(Xs.a,null)))}}))})),T=["overlaps with","contained within","fully contains","does not overlap","not contained within","does not contain"],E={"overlaps with":function(e,t){return e.refName===t.refName&&Object(Sn.a)(e.start,e.end,t.start,t.end)},"contained within":function(e,t){return e.refName===t.refName&&Object(Sn.c)(e.start,e.end,t.start,t.end)},"fully contains":function(e,t){return e.refName===t.refName&&Object(Sn.c)(t.start,t.end,e.start,e.end)},"does not overlap":function(e,t){return!E["overlaps with"](e,t)},"not contained within":function(e,t){return!E["contained within"](e,t)},"does not contain":function(e,t){return!E["fully contains"](e,t)}};function R(){return(R=Object(s.a)(o.a.mark((function e(t,n,r){var a,c,s,u,l,d,f,p,g,m,v,y;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h(t),c=a.assemblyManager,s=t.assemblyName,u=i(t),l=u.id,e.next=6,c.waitForAssembly(s);case 6:if(d=e.sent,e.prev=7,f=b(r.text,(function(e){return c.isValidRefName(e,t.assemblyName)})),p=f.refName,g=d.getCanonicalRefName(p),m=d.regions.find((function(e){return e.refName===g})),v="".concat(l,"_").concat(s),y=a.views.find((function(e){return e.id===v}))){e.next=19;break}return y=a.addView("LinearGenomeView",{displayName:s,id:v}),e.next=18,Object(Y.when)((function(){return y.initialized}));case 18:y.setDisplayedRegions([JSON.parse(JSON.stringify(m))]);case 19:y.navToLocString(r.text),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),a.notify("".concat(e.t0),"error");case 25:case"end":return e.stop()}}),e,null,[[7,22]])})))).apply(this,arguments)}return v("LocString",{categoryName:"Location",displayName:"Full location",compare:function(e,t){return m(e.extendedData,t.extendedData)},FilterModelType:r.model("ColumnLocStringFilter",{type:r.literal("LocString"),columnNumber:r.integer,locString:"",operation:r.optional(r.enumeration(T),T[0])}).views((function(e){return{get locStringIsInvalid(){if(e.locString){var t=e.parsedLocString;return!t||""===t.refName||"number"!==typeof t.start||"number"!==typeof t.end||t.start>t.end}return!1},get parsedLocString(){var t=h(e),n=i(e,3).spreadsheet.assemblyName;try{return b(e.locString,(function(e){return t.assemblyManager.isValidRefName(e,n)}))}catch(r){return}},get predicate(){if(!e.locString||e.locStringIsInvalid)return function(){return!0};var t=e.parsedLocString,n=e.operation,r=e.columnNumber;return function(e,a){var i=a.cellsWithDerived[r];if(!i||!i.text||!i.extendedData)return!1;var o=i.extendedData;if(!o.refName)return!1;var c=E[n];if(!c)throw new Error('"'.concat(n,'" not implemented in location filter'));return c(o,t)}}}})).actions((function(e){return{setLocString:function(t){e.locString=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:S}})),DataCellReactComponent:c((function(e){var t=e.cell,n=e.columnNumber,r=e.spreadsheet;return u.createElement("a",{onClick:function(e){e.preventDefault(),function(e,t,n){R.apply(this,arguments)}(r,n,t)},title:"open a new linear genome view here",href:"#link"},t.text)}))})},$s=function(e){var t=e.jbrequire,n=t("mobx-state-tree"),r=n.types,a=n.getType,i=t("mobx-react").observer,o=t("react"),c=t("@jbrowse/core/util/mst-reflection"),s=c.getPropertyType,u=c.getEnumerationValues,l=c.getSubType,d=t(Ys),f=["equals","contains","does not contain","does not equal","starts with","ends with"],p={contains:function(e,t){return-1!==e.toLowerCase().indexOf(t)},equals:function(e,t){return e.toLowerCase()===t},"starts with":function(e,t){return 0===e.toLowerCase().indexOf(t)},"ends with":function(e,t){var n=e.toLowerCase().indexOf(t);return-1!==n&&n===e.length-t.length},"does not contain":function(e,t){return!p.contains(e,t)},"does not equal":function(e,t){return!p.equals(e,t)}},g=t("@material-ui/core/styles").makeStyles,m=t("@material-ui/core/IconButton"),h=t("@material-ui/core/TextField"),b=t("@material-ui/core/MenuItem"),v=t("@material-ui/core/InputAdornment"),y=t("@material-ui/core/Select"),w=g((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:0,"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),O=i((function(e){var t=e.filterModel,n=w(),r=u(l(s(a(t),"operation")));return o.createElement(o.Fragment,null,o.createElement(y,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},r.map((function(e){return o.createElement(b,{key:e,value:e},e)})))," ",o.createElement(h,{label:"text",value:t.stringToFind,onChange:function(e){return t.setString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:o.createElement(v,{className:n.textFilterControlAdornment,position:"end"},o.createElement(m,{"aria-label":"clear filter",onClick:function(){return t.setString("")},color:"secondary"},o.createElement(Xs.a,null)))}}))})),j=r.model("ColumnTextFilter",{type:r.literal("Text"),columnNumber:r.integer,stringToFind:"",operation:r.optional(r.enumeration(f),f[0])}).views((function(e){return{get predicate(){var t=e.stringToFind,n=e.columnNumber,r=e.operation;if(!t)return function(){return!0};var a=t.toLowerCase();return function(e,t){var i=t.cellsWithDerived[n];if(!i||!i.text)return!1;var o=p[r];if(!o)throw new Error('"'.concat(r,'" not implemented in location filter'));return o(i.text,a)}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:O}}));return{TextColumn:d("Text",{compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:j}),FilterModelType:j}},Ks=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r=t(Ys),a=t($s).FilterModelType;return r("LocRef",{categoryName:"Location",displayName:"Reference seq",compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:n.compose(a,n.model({type:n.literal("LocRef")}))})},Zs=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r=t("mobx-react").observer,a=t("react"),i=t(Ys),o=t("@material-ui/core/styles").makeStyles,c=t("@material-ui/core/TextField"),s=t("@material-ui/core/MenuItem"),u=t("@material-ui/core/Select"),l=["equals","greater than","less than","between","not between"],d={equals:function(e,t){return e===t},"greater than":function(e,t){return e>t},"less than":function(e,t){return e<t},between:function(e,t,n){return e>t&&e<n},"not between":function(e,t,n){return!d.between(e,t,n)}},f=o((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),p=r((function(e){var t=e.filterModel,n=f(),r=l;return a.createElement(a.Fragment,null,a.createElement(u,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},r.map((function(e){return a.createElement(s,{key:e,value:e},e)})))," ",a.createElement(c,{label:"number",placeholder:"123",type:"number",error:t.firstNumberIsInvalid,defaultValue:t.firstNumber,onChange:function(e){t.setFirstNumber(parseFloat(e.target.value))},className:n.textFilterControl}),"between"!==t.operation&&"not between"!==t.operation?null:a.createElement(a.Fragment,null," and ",a.createElement(c,{label:"number",placeholder:"456",type:"number",error:t.secondNumberIsInvalid,defaultValue:t.secondNumber,onChange:function(e){return t.setSecondNumber(parseFloat(e.target.value))},className:n.textFilterControl})))})),g=n.model("ColumnNumberFilter",{type:n.literal("Number"),columnNumber:n.integer,firstNumber:n.maybe(n.number),secondNumber:n.maybe(n.number),operation:n.optional(n.enumeration(l),l[0])}).views((function(e){return{get predicate(){if("number"!==typeof e.firstNumber)return function(){return!0};var t=e.firstNumber,n=e.secondNumber,r=e.operation,a=e.columnNumber;return function(e,i){var o=i.cellsWithDerived[a];if(!o||!o.text)return!1;var c=parseFloat(o.text);if("number"!==typeof c)return!1;var s=d[r];if(!s)throw new Error('"'.concat(r,'" not implemented in location filter'));return s(c,t,n)}}}})).actions((function(e){return{setFirstNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.firstNumber=void 0:e.firstNumber=t},setSecondNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.secondNumber=void 0:e.secondNumber=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:p}}));return{NumberColumn:i("Number",{compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:g}),FilterModelType:g}},eu=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r=t(Ys),a=t(Zs).FilterModelType;return r("LocStart",{categoryName:"Location",displayName:"Start",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:n.compose(a,n.model({type:n.literal("LocStart")}))})},tu=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r=t(Ys),a=t(Zs).FilterModelType;return r("LocEnd",{categoryName:"Location",displayName:"End",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:n.compose(a,n.model({type:n.literal("LocEnd")}))})},nu=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r={Number:t(Zs).NumberColumn,Text:t($s).TextColumn,LocString:t(Qs),LocRef:t(Ks),LocStart:t(eu),LocEnd:t(tu)},a=Object.values(r),i=n.union.apply(n,Object(c.a)(a));return Object.freeze({ColumnTypes:r,AnyColumnType:i,AnyFilterModelType:n.union.apply(n,Object(c.a)(a.map((function(e){return e.create({type:e.properties.type.value}).FilterModelType})).filter((function(e){return!!e}))))})},ru=function(e){var t=e.lib["mobx-state-tree"],n=t.types,r=t.getParent,a=n.model("SpreadsheetCell",{text:n.string,extendedData:n.maybe(n.frozen())});return n.model("SpreadsheetRow",{id:n.identifier,cells:n.array(a),extendedData:n.maybe(n.frozen()),isSelected:!1}).actions((function(e){return{toggleSelect:function(){e.isSelected=!e.isSelected},unSelect:function(){e.isSelected=!1},select:function(){e.isSelected=!0},setExtendedData:function(t){e.extendedData=t}}})).views((function(e){return{get cellsWithDerived(){var t=r(e,3).columns,n=0;return t.map((function(t){return t.isDerived?t.expr.evalSync({row:e}):e.cells[n++]}))}}}))},au=function(e){var t=e.lib,n=e.load,r=t["mobx-state-tree"],a=r.types,i=r.getParent,o=n(ru);return a.model("StaticRowSet",{isLoaded:a.literal(!0),rows:a.array(o)}).views((function(e){return{get count(){return e.rows.length},get passingFiltersCount(){return this.sortedFilteredRows.length},get selectedCount(){return this.selectedRows.length},get selectedAndPassingFiltersCount(){return this.selectedFilteredRows.length},get sortedRows(){var t=i(e);return e.rows.slice().sort(t.rowSortingComparisonFunction)},get selectedRows(){return e.rows.filter((function(e){return e.isSelected}))},get selectedFilteredRows(){var t=i(e),n=i(t).filterControls;return this.selectedRows.filter((function(e){return n.rowPassesFilters(t,e)}))},get sortedFilteredRows(){var t=i(e),n=i(t).filterControls;return e.rows.filter((function(e){return n.rowPassesFilters(t,e)})).sort(t.rowSortingComparisonFunction)}}})).actions((function(e){return{unselectAll:function(){e.rows.forEach((function(e){return e.unSelect()}))}}}))},iu=function(e){var t=e.lib,n=e.load,r=t["mobx-state-tree"],a=r.types,i=r.getParent,c=n(nu),u=c.ColumnTypes,l=c.AnyColumnType,d=n(au),f=a.model("ColumnDefinition",{name:a.maybe(a.string),dataType:a.optional(l,(function(){return{type:"Text"}})),isDerived:!1,derivationFunctionText:a.maybe(a.string)}).views((function(t){return{get expr(){if(t.isDerived)return Object(Gs.a)(String(t.derivationFunctionText),e.jexl)}}}));return a.model("Spreadsheet",{rowSet:a.optional(d,(function(){return d.create()})),columns:a.array(f),columnDisplayOrder:a.array(a.number),hasColumnNames:!1,sortColumns:a.array(a.model("SortColumns",{columnNumber:a.number,descending:!1}).actions((function(e){return{switchDirection:function(){e.descending=!e.descending}}}))),assemblyName:a.maybe(a.string)}).volatile((function(){return{defaultDataType:u.Text,rowMenuPosition:null,isLoaded:!1}})).views((function(e){return{get initialized(){var t=Object(Y.getSession)(e),n=e.assemblyName;if(n){var r=t.assemblyManager.get(n);return r&&r.initialized}return!0},get hideRowSelection(){return i(e).hideRowSelection},get dataTypeChoices(){return Object.keys(u).map((function(e){var t=u[e].create({type:e});return{typeName:e,displayName:t.displayName,categoryName:t.categoryName}}))},rowSortingComparisonFunction:function(t,n){for(var r=0;r<e.sortColumns.length;r+=1){var a=e.sortColumns[r],i=a.columnNumber,o=a.descending,c=e.columns[i].dataType.compare(t.cellsWithDerived[i],n.cellsWithDerived[i]);if(c)return o?-c:c}return 0}}})).actions((function(e){return{afterAttach:function(){var t=this;Object(h.addDisposer)(e,Object(ge.autorun)(Object(s.a)(o.a.mark((function n(){var r,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object(Y.getSession)(e),a=r.assemblyManager,n.prev=2,!e.assemblyName){n.next=7;break}return n.next=6,a.waitForAssembly(e.assemblyName);case 6:t.setLoaded(!0);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),r.notify("failed to load assembly ".concat(e.assemblyName," ").concat(n.t0),"error");case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))))},setLoaded:function(t){e.isLoaded=t},setRowMenuPosition:function(t){e.rowMenuPosition=t},setSortColumns:function(t){t&&(e.sortColumns=t)},setColumnType:function(t,n){e.columns[t].dataType={type:n}},unselectAll:function(){return e.rowSet.unselectAll()}}}))},ou=3e7,cu=function(e){var t=e.lib,r=t["mobx-state-tree"],a=r.types,i=r.getParent,c=r.getRoot,u=t["@jbrowse/core/util/io"].openLocation,l=t["@jbrowse/core/configuration"].readConfObject,d=["CSV","TSV","VCF","BED","BEDPE","STAR-Fusion"],f={CSV:function(){return Promise.all([n.e(1),n.e(10)]).then(n.bind(null,382)).then((function(e){return e.parseCsvBuffer}))},TSV:function(){return Promise.all([n.e(1),n.e(10)]).then(n.bind(null,382)).then((function(e){return e.parseTsvBuffer}))},VCF:function(){return Promise.all([n.e(1),n.e(21)]).then(n.bind(null,2431)).then((function(e){return e.parseVcfBuffer}))},BED:function(){return Promise.all([n.e(1),n.e(8)]).then(n.bind(null,2432)).then((function(e){return e.parseBedBuffer}))},BEDPE:function(){return Promise.all([n.e(1),n.e(8)]).then(n.bind(null,2432)).then((function(e){return e.parseBedPEBuffer}))},"STAR-Fusion":function(){return Promise.all([n.e(1),n.e(40)]).then(n.bind(null,2433)).then((function(e){return e.parseSTARFusionBuffer}))}},p=new RegExp("\\.(".concat(d.join("|"),")(\\.gz)?$"),"i");return a.model("SpreadsheetImportWizard",{fileType:a.optional(a.enumeration(d),"CSV"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyIdx:0}).volatile((function(){return{fileTypes:d,fileSource:void 0,error:void 0,loading:!1}})).views((function(e){return{get isReadyToOpen(){return!e.error&&e.fileSource&&(e.fileSource.blob||e.fileSource.localPath||e.fileSource.uri)},get canCancel(){return i(e).readyToDisplay},get assemblyChoices(){return c(e).jbrowse.assemblies},get selectedAssemblyName(){var t=c(e).jbrowse.assemblies[e.selectedAssemblyIdx];if(t)return l(t,"name")},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blob&&e.fileSource.blob.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName:function(t,n){return Object(Y.getSession)(e).assemblyManager.isValidRefName(t,n)}}})).actions((function(e){return{setFileSource:function(t){if(e.fileSource=t,e.error=void 0,e.fileSource){var n=e.fileName;if(n){var r=p.exec(n);r&&r[1]&&("tsv"===r[1]&&n.includes("star-fusion")?e.fileType="STAR-Fusion":e.fileType=r[1].toUpperCase())}}},setSelectedAssemblyIdx:function(t){e.selectedAssemblyIdx=t},toggleHasColumnNameLine:function(){e.hasColumnNameLine=!e.hasColumnNameLine},setColumnNameLineNumber:function(t){t>0&&(e.columnNameLineNumber=t)},setFileType:function(t){e.fileType=t},setError:function(t){console.error(t),e.loading=!1,e.error=t},setLoaded:function(){e.loading=!1,e.error=void 0},cancelButton:function(){e.error=void 0,i(e).setDisplayMode()},import:function(){var t=this;return Object(s.a)(o.a.mark((function r(){var a,c,s,l;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,e.fileSource){r.next=3;break}return r.abrupt("return");case 3:if(!e.loading){r.next=5;break}throw new Error("cannot import, load already in progress");case 5:return e.loading=!0,r.next=8,f[e.fileType]();case 8:if(a=r.sent){r.next=11;break}throw new Error("cannot open files of type '".concat(e.fileType,"'"));case 11:return r.next=13,n.e(0).then(n.t.bind(null,328,7));case 13:c=r.sent,s=c.unzip,(l=u(e.fileSource)).stat().then((function(e){if(e.size>ou)throw new Error("File is too big. Tabular files are limited to at most ".concat(3e4.toLocaleString(),"kb."))})).then((function(){return l.readFile()})).then((function(t){return e.requiresUnzip?s(t):t})).then((function(t){return a(t,e)})).then((function(n){t.setLoaded(),i(e).displaySpreadsheet(n)})).catch(t.setError),r.next=22;break;case 19:r.prev=19,r.t0=r.catch(0),t.setError(r.t0);case 22:case"end":return r.stop()}}),r,null,[[0,19]])})))()}}}))},su=function(e){var t=e.lib,n=e.load,r=t["mobx-state-tree"],a=r.types,i=r.getParent,o=n(nu).AnyFilterModelType,s=a.model("RowFullTextFilter",{type:a.literal("RowFullText"),stringToFind:""}).views((function(e){return{get predicate(){var t=e.stringToFind;return t?(t=t.toLowerCase(),function(e,n){for(var r=n.cellsWithDerived,a=0;a<r.length;a+=1){var i=r[a];if(i.text&&i.text.toLowerCase().includes(t))return!0}return!1}):function(){return!0}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},clear:function(){e.stringToFind=""}}}));return a.model("SpreadsheetFilterControls",{rowFullText:a.optional(s,(function(){return{type:"RowFullText",stringToFind:""}})),columnFilters:a.array(o)}).views((function(e){return{get filters(){return[e.rowFullText].concat(Object(c.a)(e.columnFilters)).filter((function(e){return!!e}))},setRowFullTextFilter:function(t){e.rowFullText={type:"RowFullText",stringToFind:t}},rowPassesFilters:function(e,t){for(var n=0;n<this.filters.length;n+=1)if(!this.filters[n].predicate(e,t))return!1;return!0}}})).actions((function(e){return{addBlankColumnFilter:function(t){var n=i(e).spreadsheet.columns[t].dataType;e.columnFilters.push({type:n.type,columnNumber:t})},removeColumnFilter:function(t){return e.columnFilters.remove(t)},clearAllFilters:function(){e.columnFilters.clear(),e.rowFullText.clear()}}}))},uu=[{label:"Toggle select",icon:_s.a,onClick:function(e,t){var n,r=null===(n=t.rowMenuPosition)||void 0===n?void 0:n.rowNumber;void 0!==r&&t.rowSet.rows[r-1].toggleSelect()}}],lu=function(e){var t=e.lib,n=e.load,r=t.mobx,a=t["mobx-state-tree"],i=a.types,o=a.getParent,c=a.getEnv,s=t["@jbrowse/core/pluggableElementTypes/models"].BaseViewModel,u=n(iu),l=n(cu),d=n(su),f=i.model("SpreadsheetView",{type:i.literal("SpreadsheetView"),offsetPx:0,height:i.optional(i.refinement("SpreadsheetViewHeight",i.number,(function(e){return e>=40})),440),hideViewControls:!1,hideVerticalResizeHandle:!1,hideFilterControls:!1,filterControls:i.optional(d,(function(){return d.create({})})),mode:i.optional(i.enumeration("SpreadsheetViewMode",["import","display"]),"import"),importWizard:i.optional(l,(function(){return l.create()})),spreadsheet:i.maybe(u)}).volatile((function(){return{width:400,rowMenuItems:r.observable(uu)}})).views((function(e){return{get readyToDisplay(){return!!e.spreadsheet&&e.spreadsheet.isLoaded},get hideRowSelection(){return!!c(e).hideRowSelection},get outputRows(){if(e.spreadsheet&&e.spreadsheet.rowSet.isLoaded){var t=e.spreadsheet.rowSet.selectedFilteredRows;return t.length?t:e.spreadsheet.rowSet.sortedFilteredRows}},get assembly(){if(e.spreadsheet&&e.spreadsheet.assemblyName){var t=(Object(Y.getSession)(e).assemblies||[]).find((function(t){var n;return Object(A.readConfObject)(t,"name")===(null===(n=e.spreadsheet)||void 0===n?void 0:n.assemblyName)}));if(t)return t}}}})).actions((function(e){return{setRowMenuItems:function(t){e.rowMenuItems.replace(t)},setWidth:function(t){return e.width=t,e.width},setHeight:function(t){return e.height=t>40?t:40,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},resizeWidth:function(t){var n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet:function(t){e.filterControls.clearAllFilters(),e.spreadsheet=t,e.mode="display"},setImportMode:function(){e.mode="import"},setDisplayMode:function(){e.readyToDisplay&&(e.mode="display")},closeView:function(){o(e,2).removeView(e)}}}));return i.compose(s,f)},du=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="SpreadsheetViewPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addViewType((function(){return new O.a({name:"SpreadsheetView",stateModel:lu(e),ReactComponent:Object(f.lazy)((function(){return n.e(22).then(n.bind(null,2438))}))})}))}},{key:"configure",value:function(e){Object(Y.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Spreadsheet view",icon:qs.a,onClick:function(e){e.addView("SpreadsheetView",{})}})}}]),r}(F.a),fu=n(312),pu=n(1728),gu=n.n(pu),mu=function(e){var t=e.jbrequire,n=t("mobx-react"),r=n.observer,a=(n.PropTypes,t("react")),i=t("@material-ui/core/IconButton"),o=t("@material-ui/core/styles").makeStyles,c=t("@material-ui/core/Grid"),s=t("@material-ui/core/FormControlLabel"),u=t("@material-ui/core/Checkbox"),l=t("@jbrowse/core/ui").ResizeHandle,d=t("@material-ui/core/colors").grey,f={width:4,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"},p=o((function(e){return{root:{marginBottom:e.spacing(1),background:"white",overflow:"hidden"},header:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52,background:d[200]},viewControls:{margin:0},viewsContainer:{display:"flex"},spreadsheetViewContainer:{borderRight:[["1px","solid",d[400]]],overflow:"hidden"},circularViewOptions:{padding:e.spacing(1),background:d[200]}}})),g=r((function(e){var t=e.model,n=p();return a.createElement(c,{className:n.viewControls,container:!0,spacing:1,direction:"row",alignItems:"center"},a.createElement(c,{item:!0},a.createElement(i,{onClick:function(){return t.setImportMode()},className:n.iconButton,title:"open a tabular file","data-testid":"sv_inspector_view_open",color:"secondary"},a.createElement(vc.a,null))))})),m=r((function(e){var t=e.svInspector,n=p();return a.createElement(c,{container:!0,className:n.circularViewOptions,style:{height:t.circularViewOptionsBarHeight}},a.createElement(c,{item:!0},a.createElement(s,{control:a.createElement(u,{className:n.rowSelector,checked:t.onlyDisplayRelevantRegionsInCircularView,onClick:function(e){return t.setOnlyDisplayRelevantRegionsInCircularView(e.target.checked)}}),label:"show only regions with data"})))}));return r((function(e){var t=e.model,n=p(),r=t.resizeHeight,i=t.dragHandleHeight,o=t.SpreadsheetViewReactComponent,s=t.CircularViewReactComponent,u=t.showCircularView;return a.createElement("div",{className:n.root,"data-testid":t.id},a.createElement(c,{container:!0,direction:"row",className:n.header},a.createElement(c,{item:!0},a.createElement(g,{model:t}))),a.createElement("div",{className:n.viewsContainer},a.createElement("div",{className:n.spreadsheetViewContainer},a.createElement(o,{model:t.spreadsheetView})),u?a.createElement(a.Fragment,null,a.createElement(l,{onDrag:function(e){var n=t.circularView.resizeWidth(-e);return t.spreadsheetView.resizeWidth(-n)},vertical:!0,flexbox:!0,style:f}),a.createElement("div",{className:n.circularViewContainer,style:{width:t.circularView.width}},a.createElement(m,{svInspector:t}),a.createElement(s,{model:t.circularView}))):null),a.createElement(l,{onDrag:r,style:{height:i,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}))}))},hu=n(733),bu=n.n(hu),vu=function(e){var t=(0,e.jbrequire)("@jbrowse/core/util").parseLocString;function n(e,t,n,r,a,i){var o={};return e.forEach((function(e,r){if(!t.includes(r)){var a=n.cells[r].text;"Number"===e.dataType.type&&(a=parseFloat(a)),o[e.name]=a}})),Object(u.a)(Object(u.a)({},o),{},{uniqueId:"sv-inspector-adhoc-".concat(i),refName:r.refName,start:r.start,end:r.end,mate:{refName:a.refName,start:a.start,end:a.end}})}function r(e,r,a,i,o){var c=t(a.cells[r[0]].text,o),s=t(a.cells[r[1]].text,o);return n(e,[r[0],r[1]],a,c,s,i)}function a(e,t,r,a,i,o){var c=function(e){return i.cells[e].text},s={refName:c(t[0]),start:parseInt(c(r[0]),10)-1,end:parseInt(c(a[0]),10)},u={refName:c(t[1]),start:parseInt(c(r[1]),10)-1,end:parseInt(c(a[1]),10)};return n(e,[t[0],r[0],a[0],t[1],r[1],a[1]],i,s,u,o)}return{makeAdHocSvFeature:function(e,t,n,i){var o=e.columns,c=e.columnDisplayOrder,s={};c.forEach((function(e){var t=o[e];s[t.dataType.type]||(s[t.dataType.type]=[]),s[t.dataType.type].push(e)}));var u=s.LocString||[],l=s.LocStart||[],d=s.LocEnd||[],f=s.LocRef||[];return u.length>=2?r(o,u,n,t,i):f.length>=2&&l.length>=2&&d.length>=2?a(o,f,l,d,n,t):void 0},makeAdHocSvFeatureFromTwoLocations:r,makeAdHocSvFeatureFromTwoRefStartEndSets:a}},yu=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util").getSession,r=t(vu).makeAdHocSvFeature;function a(e,t,n,a){if(n.extendedData){if(n.extendedData.vcfFeature)return n.extendedData.vcfFeature;if(n.extendedData.feature)return n.extendedData.feature}var i=r(t.spreadsheet,a,n,e.assemblyManager.isValidRefName);if(i)return i}function i(t,r,i,o,c){var s=n(r),u=a(s,i,o,c);if(u){var l=new Q.a(u);s.setSelection(l);var d=e.getViewType("BreakpointSplitView"),f=t.circularView;return d.snapshotFromBreakendFeature(l,f)}}return{getSerializedFeatureForRow:a,breakpointSplitViewSnapshotFromTableRow:i,canOpenBreakpointSplitViewFromTableRow:function(e,t,n,r,a){try{var o=i(e,t,n,r,a);return Boolean(o)}catch(c){return!1}},openBreakpointSplitViewFromTableRow:function(e,t,r,a,o){var c=i(e,t,r,a,o);if(c){var s=e.circularView;c.views[0].offsetPx-=s.width/2+100,c.views[1].offsetPx-=s.width/2+100,n(t).addView("BreakpointSplitView",c)}}}};function wu(e,t,n){var r=(0,n.jbrequire)("@jbrowse/core/util"),a=r.getContainingView,i=(0,r.getSession)(t);i.setSelection(e);var o=a(t),c=n.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(e,o);c.views[0].offsetPx-=o.width/2+100,c.views[1].offsetPx-=o.width/2+100,c.featureData=e.data,i.addView("BreakpointSplitView",c)}var Ou=function(e){var t=e.jbrequire,n=e.lib.mobx,r=n.autorun,a=n.reaction,i=e.lib["mobx-state-tree"],o=i.types,c=i.getParent,s=i.addDisposer,u=i.getSnapshot,l=t("@jbrowse/core/pluggableElementTypes/models").BaseViewModel,d=t("@jbrowse/core/util").getSession,f=t("@jbrowse/core/configuration").readConfObject,p=e.getViewType("SpreadsheetView"),g=e.getViewType("CircularView"),m=t(yu),h=m.canOpenBreakpointSplitViewFromTableRow,b=m.openBreakpointSplitViewFromTableRow,v=m.getSerializedFeatureForRow,y=o.model("SvInspectorView",{type:o.literal("SvInspectorView"),dragHandleHeight:4,height:o.optional(o.refinement("SvInspectorViewHeight",o.number,(function(e){return e>=400})),500),onlyDisplayRelevantRegionsInCircularView:!1,mode:o.optional(o.enumeration("SvInspectorViewMode",["import","display"]),"import"),spreadsheetView:o.optional(p.stateModel,(function(){return p.stateModel.create({type:"SpreadsheetView",hideViewControls:!0,hideVerticalResizeHandle:!0})})),circularView:o.optional(g.stateModel,(function(){return g.stateModel.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})}))}).volatile((function(){return{width:800}})).views((function(t){return{get selectedRows(){return t.spreadsheetView.rowSet.selectedRows},get assemblyName(){var e=t.spreadsheetView.assembly;if(e)return f(e,"name")},get showCircularView(){return"display"===t.spreadsheetView.mode},get featuresAdapterConfigSnapshot(){var e=d(t);return{type:"FromConfigAdapter",features:(t.spreadsheetView.outputRows||[]).map((function(n,r){return v(e,t.spreadsheetView,n,r)})).filter((function(e){return Boolean(e)}))}},get featuresRefNamesP(){return new(0,e.getAdapterType("FromConfigAdapter").AdapterClass)(t.featuresAdapterConfigSnapshot).getRefNames()},get featuresCircularTrackConfiguration(){return e.jexl.addFunction("defaultOnChordClick",wu),{type:"VariantTrack",trackId:"sv-inspector-variant-track-".concat(t.id),name:"features from tabular data",adapter:t.featuresAdapterConfigSnapshot,assemblyNames:[t.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:"sv-inspector-variant-track-chord-display-".concat(t.id),onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}})).volatile((function(){return{SpreadsheetViewReactComponent:p.ReactComponent,CircularViewReactComponent:g.ReactComponent,circularViewOptionsBarHeight:52}})).actions((function(e){return{afterAttach:function(){s(e,r((function(){if(e.showCircularView){var t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),s(e,r((function(){e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),s(e,r((function(){var t=e.assemblyName,n=e.onlyDisplayRelevantRegionsInCircularView,r=e.circularView,a=e.featuresRefNamesP,i=r.tracks,o=d(e);if(t){var c=o.assemblyManager.get(t);if(c){var s=c.regions;if(s=s?u(s):[],n){if(1===i.length){var l=o.assemblyManager.get(t).getCanonicalRefName;a.then((function(e){var t=new Set(e.map((function(e){return l(e)||e}))),n=s.filter((function(e){return t.has(e.refName)}));r.setDisplayedRegions(JSON.parse(JSON.stringify(n)))})).catch((function(e){return r.setError(e)}))}}else r.setDisplayedRegions(s)}else r.setDisplayedRegions([])}}),{name:"SvInspectorView displayed regions bind"})),s(e,a((function(){return{generatedTrackConf:e&&e.featuresCircularTrackConfiguration,assemblyName:e&&e.assemblyName}}),(function(t){if(t){var n=t.assemblyName,r=t.generatedTrackConf;e.circularView.tracks.length&&e.circularView.tracks.forEach((function(t){e.circularView.hideTrack(t.configuration.trackId)})),n&&r&&e.circularView.addTrackConf(r,{assemblyName:n})}}),{name:"SvInspectorView track configuration binding",fireImmediately:!0})),s(e,r((function(){e.spreadsheetView.setRowMenuItems([{label:"Open split detail view",icon:bu.a,disabled:function(t,n,r,a){return!h(e,t,n,a,r)},onClick:function(t,n,r,a){b(e,t,n,a,r)}}])})))},setWidth:function(t){e.width=t},setHeight:function(t){return e.height=t>400?t:400,e.height},resizeHeight:function(t){var n=e.height;return e.setHeight(e.height+t)-n},setImportMode:function(){e.spreadsheetView.setImportMode()},setDisplayMode:function(){e.spreadsheetView.setDisplayMode()},closeView:function(){c(e,2).removeView(e)},setDisplayedRegions:function(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView:function(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}}));return{stateModel:o.compose(l,y)}},ju=function(e){var t=e.jbrequire,n=t("@jbrowse/core/pluggableElementTypes/ViewType"),r=t(mu);return new n({name:"SvInspectorView",stateModel:t(Ou).stateModel,ReactComponent:r})},ku=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="SvInspectorViewPlugin",e}return Object(m.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(ju)}))}},{key:"configure",value:function(e){Object(fu.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"SV inspector",icon:gu.a,onClick:function(e){e.addView("SvInspectorView",{})}})}}]),n}(F.a);var xu=Object(le.observer)((function(e){var t=e.width,n=e.height,r=Math.ceil(t);return p.a.createElement("div",{className:"PileupRendering",style:{position:"relative",width:r,height:n}},p.a.createElement(me.PrerenderedCanvas,Object.assign({},e,{style:{position:"absolute",left:0,top:0}})))})),Cu=Object(A.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:baseColor|alpha(min(1,count/(maxScore/20)))|hsl|colorString",contextVariable:["count","maxScore","baseColor"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0}),Su=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(m.a)(n,[{key:"makeImageData",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,u,l,d,f,p,g,m,h,b,v,y,w,O,j,k,x,C,S,T;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.features,a=n.config,i=n.bpPerPx,c=n.signal,s=n.dataAdapter,u=n.resolution,e.next=3,s.getResolution(i/u);case 3:if(l=e.sent,d=l/(i*Math.sqrt(2)),f=wt()(Object(A.readConfObject)(a,"baseColor")),!r.length){e.next=30;break}return p=r[0].bin1,g=0,m=0,h=0,e.next=13,Object(Y.abortBreakPoint)(c);case 13:for(b=0;b<r.length;b++)v=r[b],y=v.bin1,w=v.bin2,O=v.counts,g=Math.max(O,g),m=Math.min(Math.min(y,w),m),h=Math.max(Math.max(y,w),h);return e.next=16,Object(Y.abortBreakPoint)(c);case 16:t.rotate(-Math.PI/4),j=Date.now(),k=0;case 19:if(!(k<r.length)){e.next=30;break}if(x=r[k],C=x.bin1,S=x.bin2,T=x.counts,t.fillStyle=Object(A.readConfObject)(a,"color",{count:T,maxScore:g,baseColor:f}),t.fillRect((C-p)*d,(S-p)*d,d,d),!(+Date.now()-j>400)){e.next=27;break}return e.next=26,Object(Y.abortBreakPoint)(c);case 26:j=+Date.now();case 27:k++,e.next=19;break;case 30:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var r,a,i,c,s,l,f,p,g,m,h=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.config,a=t.regions,i=t.bpPerPx,c=Object(d.a)(a,1),s=c[0],l=(s.end-s.start)/i,f=Object(A.readConfObject)(r,"maxHeight"),e.next=6,this.getFeatures(t);case 6:return p=e.sent,e.next=9,ze(l,f,t,(function(e){return h.makeImageData(e,Object(u.a)(Object(u.a)({},t),{},{features:p}))}));case 9:return g=e.sent,e.next=12,Object(De.a)(Object(Le.a)(n.prototype),"render",this).call(this,Object(u.a)(Object(u.a)(Object(u.a)({},t),g),{},{features:p,region:t.regions[0],height:f,width:l}));case 12:return m=e.sent,e.abrupt("return",Object(u.a)(Object(u.a)(Object(u.a)({},m),g),{},{height:f,width:l}));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataAdapter,r=t.regions,e.next=3,n.getFeatures(r[0],t).pipe(Object(V.a)()).toPromise();case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(J.a),Tu=function(e){var t=e.getRendererType("HicRenderer").configSchema;return Object(A.ConfigurationSchema)("LinearHicDisplay",{renderer:t},{baseConfiguration:Be.c,explicitlyTyped:!0})},Eu=function(e){return h.types.compose("LinearHicDisplay",Be.a,h.types.model({type:h.types.literal("LinearHicDisplay"),configuration:Object(A.ConfigurationReference)(e),resolution:h.types.optional(h.types.number,1)})).views((function(e){return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},get renderProps(){var t=e.rendererType.configSchema.create(Object(A.getConf)(e,"renderer")||{},Object(h.getEnv)(e));return Object(u.a)(Object(u.a)(Object(u.a)({},e.composedRenderProps),Object(T.getParentRenderProps)(e)),{},{config:t,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution})}}})).actions((function(e){return{setResolution:function(t){e.resolution=t}}})).views((function(e){var t=e.trackMenuItems;return{get composedTrackMenuItems(){return[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:function(){e.setResolution(e.resolution/2)}}]}]},get trackMenuItems(){return[].concat(Object(c.a)(t),Object(c.a)(this.composedTrackMenuItems))}}}))},Ru=Object(A.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic"}}},{explicitlyTyped:!0}),Mu=function(e){Object(k.a)(r,e);var t=Object(x.a)(r);function r(){var e;Object(g.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="HicPlugin",e}return Object(m.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new v.a({name:"HicAdapter",configSchema:Ru,getAdapterClass:function(){return Promise.all([n.e(27),n.e(61)]).then(n.bind(null,2434)).then((function(e){return e.default}))}})})),e.addRendererType((function(){return new Su({name:"HicRenderer",ReactComponent:xu,configSchema:Cu,pluginManager:e})})),e.addTrackType((function(){var t=Object(A.ConfigurationSchema)("HicTrack",{},{baseConfiguration:Object(Ie.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new y.a({name:"HicTrack",configSchema:t,stateModel:Object(Ie.createBaseTrackModel)(e,"HicTrack",t)})})),e.addDisplayType((function(){var t=Tu(e);return new w.a({name:"LinearHicDisplay",configSchema:t,stateModel:Eu(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:Be.b})}))}},{key:"configure",value:function(e){e.jexl.addTransform("alpha",(function(e,t){return e.alpha(t)})),e.jexl.addTransform("hsl",(function(e){return e.hsl()})),e.jexl.addTransform("colorString",(function(e){return e.string()}))}}]),r}(F.a),Pu=[Bs,Be.d,zn,Un,Lr.d,Vr.b,ha,ni,yi,Oi,to,$o,gc,Lc,qc,as,Ws,zs.b,Et,du,ku,Dr,Mu],Nu=n(2384),Au=n(2346),Fu=n(1730),Iu=n.n(Fu),Bu=n(2375),Du=n(1053),Lu=n(2446),Vu=n(2360),Wu=n(2376),zu=n(1729),Hu=n.n(zu),qu=n(555),Uu=n.n(qu),_u=n(226),Gu=Object(it.a)((function(e){return{shareDiv:{display:"none",textAlign:"center",paddingLeft:"2px"},shareButton:{"&:hover":{backgroundColor:Object(_u.fade)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),Ju="jbrowse-shareURL";function Xu(e){var t=Gu(),n=e.onClose,r=e.open,a=e.currentSetting,i=Object(f.useState)(a),o=Object(d.a)(i,2),c=o[0],s=o[1],u=Object(f.useState)(!1),l=Object(d.a)(u,2),g=l[0],m=l[1],h=function(){localStorage.setItem(Ju,c),n(c)};return p.a.createElement(p.a.Fragment,null,p.a.createElement(no.a,{onClose:h,open:r},p.a.createElement(ro.a,null,"Configure session sharing",h?p.a.createElement(fr.a,{className:t.closeButton,onClick:h},p.a.createElement(uo.a,null)):null),p.a.createElement(ao.a,null,p.a.createElement(Bu.a,null,"Select between generating long or short URLs for the session sharing",p.a.createElement(fr.a,{onClick:function(){return m(!0)}},p.a.createElement(Hu.a,null))),p.a.createElement(ii.a,{component:"fieldset"},p.a.createElement(Du.a,{value:c,onChange:function(e){var t=e.target.value;s(t)}},p.a.createElement(oi.a,{value:"short",control:p.a.createElement(Lu.a,null),label:"Short URL"}),p.a.createElement(oi.a,{value:"long",control:p.a.createElement(Lu.a,null),label:"Long URL"}))))),p.a.createElement(Yu,{open:g,onClose:function(){m(!1)}}))}function Yu(e){var t=Gu(),n=e.onClose,r=e.open,a=function(){n()};return p.a.createElement(no.a,{onClose:a,open:r},p.a.createElement(ro.a,{id:"simple-dialog-title"},"Info about session URLs",n?p.a.createElement(fr.a,{className:t.closeButton,onClick:a},p.a.createElement(uo.a,null)):null),p.a.createElement(ao.a,null,p.a.createElement(Bu.a,null,"Because everything about the JBrowse session is encoded in the URL (e.g. state of the tracks, views, features selected, etc.) the sessions can get very long. Therefore, we created a URL shortener, both as a convenience and because long URLs can break some programs. Note that both the long and short URLs encode the same data, but due to long URLs causing problems with some programs, we recommend sharing short URLs."),p.a.createElement(Bu.a,null,'We generate the short URLs in a secure manner which involves encrypting the session on the client side with a random password string and uploading them to a central database. Then the random password is added to the URL but is not uploaded to the central database, making these short URLs effectively "end-to-end encrypted"'),p.a.createElement(Bu.a,null,"Only users with a share link can read the session.")))}var Qu=Object(le.observer)((function(e){var t=e.handleClose,n=e.session,r=Gu(),a=Object(f.useState)(""),i=Object(d.a)(a,2),c=i[0],u=i[1],l=Object(f.useState)(!0),g=Object(d.a)(l,2),m=g[0],b=g[1],v=Object(f.useState)(),y=Object(d.a)(v,2),w=y[0],O=y[1],j=Object(f.useState)(!1),k=Object(d.a)(j,2),x=k[0],C=k[1],S=n.shareURL,T=localStorage.getItem(Ju)||"short",E=Object(h.getSnapshot)(n);Object(f.useEffect)((function(){var e=!1;return Object(s.a)(o.a.mark((function t(){var n,r,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("short"!==T){t.next=14;break}return t.prev=1,b(!0),n=new URL(window.location.href),t.next=6,Me(E,S,n.href);case 6:r=t.sent,e||(b(!1),(a=new URLSearchParams(n.search)).set("session","share-".concat(r.json.sessionId)),a.set("password",r.password),n.search=a.toString(),u(n.href)),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),b(!1),O(t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))(),function(){e=!0}}),[T,S,E]);var R="".concat(Object(Y.toUrlSafeB64)(JSON.stringify(Object(h.getSnapshot)(n)))),M=new URL(window.location.href),P=new URLSearchParams(M.search);return P.set("session","encoded-".concat(R)),M.search=P.toString(),p.a.createElement(p.a.Fragment,null,p.a.createElement(no.a,{maxWidth:"xl",open:!0,onClose:t,"data-testid":"share-dialog"},p.a.createElement(ro.a,null,"JBrowse Shareable Link",t?p.a.createElement(fr.a,{className:r.closeButton,onClick:t},p.a.createElement(uo.a,null)):null),p.a.createElement(Vu.a,null),p.a.createElement(p.a.Fragment,null,p.a.createElement(ao.a,null,p.a.createElement(Bu.a,null,"Copy the URL below to share your current JBrowse session.",p.a.createElement(fr.a,{onClick:function(){return C(!0)}},p.a.createElement(Uu.a,null)))),p.a.createElement(ao.a,null,"short"===T?w?p.a.createElement(rn.a,{color:"error"},"".concat(w)):m?p.a.createElement(rn.a,null,"Generating short URL..."):p.a.createElement(oo.a,{label:"URL",value:c,InputProps:{readOnly:!0},inputProps:{"data-testid":"share-url-text"},variant:"filled",style:{width:"100%"},onClick:function(e){e.target.select()},"data-testid":"share-url-field"}):p.a.createElement(oo.a,{label:"URL",value:M.toString(),InputProps:{readOnly:!0},variant:"filled",style:{width:"100%"},onClick:function(e){e.target.select()}}))),p.a.createElement(Wu.a,null,p.a.createElement(co.a,{onClick:function(){Xt()(c||M.toString()),n.notify("Copied to clipboard","success")},color:"primary",startIcon:p.a.createElement(Gt.a,null),disabled:"short"===T&&m},"Copy URL to Clipboard"),p.a.createElement(co.a,{onClick:t,color:"primary",autoFocus:!0},"Close"))),p.a.createElement(Xu,{open:x,onClose:function(){C(!1)},currentSetting:T}))})),$u=Object(le.observer)((function(e){var t=Object(f.useState)(!1),n=Object(d.a)(t,2),r=n[0],a=n[1],i=e.session,c=Gu();return p.a.createElement("div",{className:c.shareDiv},p.a.createElement(co.a,{style:{display:"none"},"data-testid":"share_button",onClick:Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(!0);case 1:case"end":return e.stop()}}),e)}))),size:"small",color:"inherit",startIcon:p.a.createElement(Iu.a,null),classes:{root:c.shareButton}},"Share"),r?p.a.createElement(Qu,{handleClose:function(){a(!1)},session:i}):null)}));var Ku=Object(le.observer)((function(e){var t=e.pluginManager,n=t.rootModel,r=t.getPlugin("DataManagementPlugin");if(!r)throw new Error("Data Management plugin must be installed");var a=r.exports,i=a.AssemblyManager,o=a.SetDefaultSession,c=n,s=c.isAssemblyEditing,u=c.isDefaultSessionEditing,l=c.setDefaultSessionEditing,d=c.setAssemblyEditing,f=c.jbrowse;return p.a.createElement(p.a.Fragment,null,p.a.createElement(i,{rootModel:n,open:s,onClose:function(){d(!1)}}),p.a.createElement(o,{rootModel:n,open:u,onClose:function(){l(!1)},currentDefault:f.defaultSession.name}))}));function Zu(e){if("object"===typeof e)for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];"object"===typeof e[r]?Zu(e[r]):"uri"===r&&delete e.baseUri}}var el=Object(le.observer)((function(e){var t=e.pluginManager,n=Object(pe.c)("adminKey",pe.b),r=Object(d.a)(n,1)[0],a=Object(pe.c)("adminServer",pe.b),i=Object(d.a)(a,1)[0],c=Object(pe.c)("session",pe.b),u=Object(d.a)(c,2)[1],l=t.rootModel,g=l||{},m=g.error,b=g.jbrowse,v=g.session,y=v.id;if(Object(f.useEffect)((function(){u("local-".concat(y)),window.JBrowseRootModel=l,window.JBrowseSession=v}),[y,l,v,u]),Object(f.useEffect)((function(){Object(h.onSnapshot)(b,function(){var e=Object(s.a)(o.a.mark((function e(t){var n,a,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=12;break}return Zu(n=JSON.parse(JSON.stringify(t))),a={adminKey:r,config:n},e.next=6,fetch(i||"/updateConfig",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 6:if((c=e.sent).ok){e.next=12;break}return e.next=10,c.text();case 10:s=e.sent,v.notify("Admin server error: ".concat(c.status," (").concat(c.statusText,") ").concat(s||""));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[b,v,r,i]),m)throw m;var w=Object(A.getConf)(l.jbrowse,"theme");return p.a.createElement(Au.a,{theme:Object(me.createJBrowseTheme)(w)},p.a.createElement(Nu.a,null),p.a.createElement(me.App,{session:v,HeaderButtons:p.a.createElement($u,{session:v})}),r?p.a.createElement(Ku,{pluginManager:t}):null)})),tl=["rgb(153, 102, 0)","rgb(102, 102, 0)","rgb(153, 153, 30)","rgb(204, 0, 0)","rgb(255, 0, 0)","rgb(255, 0, 204)","rgb(165, 132, 132)","rgb(204, 122, 0)","rgb(178, 142, 0)","rgb(153, 153, 0)","rgb(122, 153, 0)","rgb(0, 165, 0)","rgb(53, 128, 0)","rgb(0, 0, 204)","rgb(96, 145, 242)","rgb(107, 142, 178)","rgb(0, 165, 165)","rgb(122, 153, 153)","rgb(153, 0, 204)","rgb(204, 51, 255)","rgb(173, 130, 216)","rgb(102, 102, 102)","rgb(145, 145, 145)","rgb(142, 142, 142)","rgb(142, 142, 107)","rgb(96, 163, 48)"];function nl(e,t,n,r){return rl.apply(this,arguments)}function rl(){return(rl=Object(s.a)(o.a.mark((function e(t,n,r,a){var i,c,s,l,f,p,g,m,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.sessionId,e.next=3,Object(Y.when)((function(){return Boolean(t.regions&&t.refNameAliases)}),{signal:a,name:"when assembly ready"});case 3:return e.next=5,t.rpcManager.call(i,"CoreGetRefNames",Object(u.a)({adapterConfig:n,signal:a},r),{timeout:1e6});case 5:if(c=e.sent,s={},t.refNameAliases){e.next=10;break}throw new Error("error loading assembly ".concat(t.name,"'s refNameAliases"));case 10:for(c.forEach((function(e){al(e);var n=t.getCanonicalRefName(e);n&&(s[n]=e)})),l={},f=0,p=Object.entries(s);f<p.length;f++)g=Object(d.a)(p[f],2),m=g[0],h=g[1],l[h]=m;return e.abrupt("return",{forwardMap:s,reverseMap:l});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function al(e){if(!e.match(/[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*/))throw new Error('Encountered invalid refName: "'.concat(e,'"'))}function il(e,t){var n=new Xa.a({cache:new Ya.a({maxSize:1e3}),fill:function(e,t,n){return Object(s.a)(o.a.mark((function r(){var a,i,c;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.adapterConf,i=e.self,c=e.options,r.abrupt("return",nl(i,a,Object(u.a)(Object(u.a)({},c),{},{statusCallback:n}),t));case 2:case"end":return r.stop()}}),r)})))()}});return h.types.model({configuration:h.types.safeReference(e),regions:h.types.maybe(h.types.array(B.Region)),refNameAliases:h.types.maybe(h.types.map(h.types.string))}).views((function(e){return{get initialized(){return Boolean(e.refNameAliases)},get name(){return Object(A.readConfObject)(e.configuration,"name")},get aliases(){return Object(A.readConfObject)(e.configuration,"aliases")},hasName:function(e){return this.name===e||this.aliases.includes(e)},get allAliases(){return[this.name].concat(Object(c.a)(this.aliases))},get refNames(){return e.regions&&e.regions.map((function(e){return e.refName}))},get allRefNames(){if(e.refNameAliases)return Array.from(e.refNameAliases.keys())},get rpcManager(){return Object(h.getParent)(e,2).rpcManager},get refNameColors(){var t=Object(A.readConfObject)(e.configuration,"refNameColors");return 0===t.length?tl:t}}})).views((function(e){return{getCanonicalRefName:function(t){if(!e.refNameAliases)throw new Error("aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called");return e.refNameAliases.get(t)},getRefNameColor:function(t){var n,r=null===(n=e.refNames)||void 0===n?void 0:n.findIndex((function(e){return e===t}));if(void 0!==r&&-1!==r)return e.refNameColors[r%e.refNameColors.length]},isValidRefName:function(t){if(!e.refNameAliases)throw new Error("isValidRefName cannot be called yet, the assembly has not finished loading");return!!this.getCanonicalRefName(t)}}})).actions((function(e){return{setLoading:function(){},setLoaded:function(e){var t=e.adapterRegionsWithAssembly,n=e.refNameAliases;this.setRegions(t),this.setRefNameAliases(n)},setError:function(t){Object(h.getParent)(e,3).isAssemblyEditing||Object(h.getParent)(e,3).setError(t)},setRegions:function(t){e.regions=Object(h.cast)(t)},setRefNameAliases:function(t){e.refNameAliases=Object(h.cast)(t)},afterAttach:function(){Object(Y.makeAbortableReaction)(e,function(e){return function(t){if(t.configuration){var n,r=t.configuration.sequence.adapter,a=null===(n=t.configuration.refNameAliases)||void 0===n?void 0:n.adapter;return{sequenceAdapterConfig:r,assemblyName:t.name,refNameAliasesAdapterConfig:a,pluginManager:e}}}}(t),ol,{name:"".concat(e.name," assembly loading"),fireImmediately:!0},this.setLoading,this.setLoaded,this.setError)}}})).views((function(e){return{getAdapterMapEntry:function(t,r){var a=r.signal,i=r.statusCallback,o=Object(l.a)(r,["signal","statusCallback"]);if(!r.sessionId)throw new Error("sessionId is required");var c=function(e){return z()(e)}(t);return n.get(c,{adapterConf:t,self:e,options:o},a,i)},getRefNameMapForAdapter:function(e,t){var n=this;return Object(s.a)(o.a.mark((function r(){var a;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&t.sessionId){r.next=2;break}throw new Error("sessionId is required");case 2:return r.next=4,n.getAdapterMapEntry(e,t);case 4:return a=r.sent,r.abrupt("return",a.forwardMap);case 6:case"end":return r.stop()}}),r)})))()},getReverseRefNameMapForAdapter:function(e,t){var n=this;return Object(s.a)(o.a.mark((function r(){var a;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getAdapterMapEntry(e,t);case 2:return a=r.sent,r.abrupt("return",a.reverseMap);case 4:case"end":return r.stop()}}),r)})))()}}}))}function ol(e,t){return cl.apply(this,arguments)}function cl(){return(cl=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,l,d,f,p,g,m,h,b,v,y,w,O;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(r=t.sequenceAdapterConfig,a=t.assemblyName,i=t.refNameAliasesAdapterConfig,c=t.pluginManager,s=c.getAdapterType(r.type),l=s.AdapterClass,d=s.getAdapterClass,e.t0=l,e.t0){e.next=10;break}return e.next=9,null===d||void 0===d?void 0:d();case 9:e.t0=e.sent;case 10:if(f=e.t0){e.next=13;break}throw new Error("Failed to get adapter class");case 13:return p=new f(r),e.next=16,p.getRegions({signal:n});case 16:if(g=e.sent,m=g.map((function(e){return al(e.refName),Object(u.a)(Object(u.a)({},e),{},{assemblyName:a})})),h={},!i){e.next=35;break}if(b=c.getAdapterType(i.type),v=b.AdapterClass,y=b.getAdapterClass,e.t1=v,e.t1){e.next=27;break}return e.next=26,null===y||void 0===y?void 0:y();case 26:e.t1=e.sent;case 27:if(w=e.t1){e.next=30;break}throw new Error("Failed to get REFCLASS");case 30:return O=new w(i),e.next=33,O.getRefNameAliases({signal:n});case 33:e.sent.forEach((function(e){var t=e.refName;e.aliases.forEach((function(e){al(e),h[e]=t}))}));case 35:return m.forEach((function(e){h[e.refName]=e.refName})),e.abrupt("return",{adapterRegionsWithAssembly:m,refNameAliases:h});case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sl(e,t){var n=il(e,t);return h.types.model({assemblies:h.types.array(n)}).views((function(e){return{get:function(t){return e.assemblies.find((function(e){return e.hasName(t)}))},get assemblyList(){return[].concat(Object(c.a)(Object(h.getParent)(e).jbrowse.assemblies),Object(c.a)(Object(h.getParent)(e).session.sessionAssemblies||[]))},get rpcManager(){return Object(h.getParent)(e).rpcManager},get pluginManager(){return Object(h.getParent)(e).pluginManager},get allPossibleRefNames(){var t,n=[],r=Object(Ue.a)(e.assemblies);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(!a.allRefNames)return;n=n.concat(a.allRefNames)}}catch(i){r.e(i)}finally{r.f()}return n}}})).views((function(e){return{waitForAssembly:function(t){return Object(s.a)(o.a.mark((function n(){var r;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}throw new Error("no assembly name supplied to waitForAssembly");case 2:if(!(r=e.get(t))){n.next=7;break}return n.next=6,Object(Y.when)((function(){return Boolean(r.regions&&r.refNameAliases)}));case 6:return n.abrupt("return",r);case 7:return n.abrupt("return",void 0);case 8:case"end":return n.stop()}}),n)})))()},getRefNameMapForAdapter:function(t,n,r){return Object(s.a)(o.a.mark((function a(){var i;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Y.when)((function(){return Boolean(e.get(n))}),{signal:r.signal,name:"when assembly ready"});case 2:if(!(i=e.get(n))){a.next=5;break}return a.abrupt("return",i.getRefNameMapForAdapter(t,r));case 5:return a.abrupt("return",void 0);case 6:case"end":return a.stop()}}),a)})))()},getReverseRefNameMapForAdapter:function(t,n,r){return Object(s.a)(o.a.mark((function a(){var i;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Y.when)((function(){return Boolean(e.get(n))}),{signal:r.signal,name:"when assembly ready"});case 2:if(!(i=e.get(n))){a.next=5;break}return a.abrupt("return",i.getReverseRefNameMapForAdapter(t,r));case 5:return a.abrupt("return",void 0);case 6:case"end":return a.stop()}}),a)})))()},isValidRefName:function(t,n){if(n){var r=e.get(n);if(r)return r.isValidRefName(t);throw new Error("isValidRefName for ".concat(n," failed, assembly does not exist"))}if(!e.allPossibleRefNames)throw new Error("isValidRefName not available, assemblyManager has not yet finished loading. If you are looking for a refname in a specific assembly, pass assembly argument");return e.allPossibleRefNames.includes(t)}}})).actions((function(e){return{removeAssembly:function(t){e.assemblies.remove(t)},afterAttach:function(){var t=this;Object(h.addDisposer)(e,Object(ge.reaction)((function(){return e.assemblyList}),(function(n){e.assemblies.forEach((function(e){e.configuration||t.removeAssembly(e)})),n.forEach((function(n){-1===e.assemblies.findIndex((function(e){return e.name===Object(A.readConfObject)(n,"name")}))&&t.addAssembly(n)}))}),{fireImmediately:!0,name:"assemblyManagerAfterAttach"}))},addAssembly:function(t){e.assemblies.push({configuration:t})},replaceAssembly:function(t,n){e.assemblies[t]=Object(h.cast)({configuration:n})}}}))}var ul=function(e){var t=Object(A.ConfigurationSchema)("BaseAssembly",{aliases:{type:"stringArray",defaultValue:[],description:"Other possible names for the assembly"},sequence:e.getTrackType("ReferenceSequenceTrack").configSchema,refNameColors:{type:"stringArray",defaultValue:[],description:"Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence."}},{explicitIdentifier:"name"}),n=Object(A.ConfigurationSchema)("Assembly",{refNameAliases:Object(A.ConfigurationSchema)("RefNameAliases",{adapter:e.pluggableConfigSchemaType("adapter")})},{baseConfiguration:t});return{assemblyConfigSchemas:[n,t],dispatcher:function(e){return e&&e.refNameAliases?n:t}}},ll=Object(A.ConfigurationSchema)("MainThreadRpcDriver",{},{explicitlyTyped:!0}),dl=Object(A.ConfigurationSchema)("WebWorkerRpcDriver",{},{explicitlyTyped:!0}),fl=Object(A.ConfigurationSchema)("ElectronRpcDriver",{},{explicitlyTyped:!0}),pl=Object(A.ConfigurationSchema)("RpcOptions",{defaultDriver:{type:"string",description:"the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend",defaultValue:"MainThreadRpcDriver"},drivers:h.types.optional(h.types.map(h.types.union(ll,dl,fl)),{MainThreadRpcDriver:{type:"MainThreadRpcDriver"}})},{actions:function(e){return{addDriverConfig:function(t,n){e.drivers.set(t,n)}}}}),gl=n(1731);function ml(e){return"function"!==typeof e&&!(e instanceof Error)}function hl(){return(hl=Object(s.a)(o.a.mark((function e(t,n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.call("ping",[],{timeout:1e8,rpcDriverClassName:r});case 2:return e.abrupt("return",new Promise((function(e,a){!function e(){setTimeout(Object(s.a)(o.a.mark((function i(){return o.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,t.call("ping",[],{timeout:2*n,rpcDriverClassName:r});case 3:e(),i.next=9;break;case 6:i.prev=6,i.t0=i.catch(0),a(i.t0);case 9:case"end":return i.stop()}}),i,null,[[0,6]])}))),n)}()})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var bl=function(){function e(t){Object(g.a)(this,e),this.worker=void 0,this.driver=void 0,this.driver=t}return Object(m.a)(e,[{key:"getWorker",value:function(e,t){var n=this;if(!this.worker){var r=this.driver.makeWorker(e);(function(e,t,n){return hl.apply(this,arguments)})(r,this.driver.maxPingTime,t).catch((function(e){n.worker&&(console.warn("worker did not respond, killing and generating new one ".concat(e)),n.worker.destroy(),n.worker.status="killed",n.worker.error=e,n.worker=void 0)})),this.worker=r}return this.worker}}]),e}(),vl=function(){function e(t){Object(g.a)(this,e),this.name=void 0,this.lastWorkerAssignment=-1,this.workerAssignments=new Map,this.workerCount=0,this.workerPool=void 0,this.maxPingTime=3e4,this.workerCheckFrequency=5e3,this.config=void 0,this.config=t.config}return Object(m.a)(e,[{key:"filterArgs",value:function(e,t,n){var r=this;if(Array.isArray(e))return e.filter(ml).map((function(e){return r.filterArgs(e,t,n)}));if("object"===typeof e&&null!==e){if(e instanceof AbortSignal)return function(e,t){var n=R.get(e);return n||(E+=1,R.set(e,E),n=E,e.addEventListener("abort",(function(){var n=R.get(e);void 0!==n&&t("signalAbort",n)}))),{abortSignalId:n}}(e,this.remoteAbort.bind(this,t,n));if(Object(h.isStateTreeNode)(e)&&!Object(h.isAlive)(e))throw new Error("dead state tree node passed to RPC call");return e instanceof File?e:Object(Y.objectFromEntries)(Object.entries(e).filter((function(e){return ml(e[1])})).map((function(e){var a=Object(d.a)(e,2),i=a[0],o=a[1];return[i,r.filterArgs(o,t,n)]})))}return e}},{key:"remoteAbort",value:function(e,t,n,r){this.getWorker(t,e).call(n,{signalId:r},{timeout:1e6,rpcDriverClassName:this.name})}},{key:"createWorkerPool",value:function(){var e=this,t=function(){var e="undefined"!==typeof window,t=e&&"hardwareConcurrency"in window.navigator;return e&&t?window.navigator.hardwareConcurrency:1}(),n=this.workerCount||Math.max(1,Math.ceil((t-2)/3));return Object(c.a)(new Array(n)).map((function(){return new bl(e)}))}},{key:"getWorkerPool",value:function(){if(!this.workerPool){var e=this.createWorkerPool();return this.workerPool=e,e}return this.workerPool}},{key:"getWorker",value:function(e,t){var n=this.getWorkerPool(),r=this.workerAssignments.get(e);if(void 0===r){var a=(this.lastWorkerAssignment+1)%n.length;this.workerAssignments.set(e,a),this.lastWorkerAssignment=a,r=a}var i=n[r].getWorker(t,this.name);if(!i)throw new Error("no web workers registered for RPC");return i}},{key:"call",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r,a){var i,c,s,l,d,f,p,g,m,h=this,b=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=b.length>4&&void 0!==b[4]?b[4]:{},n){e.next=3;break}throw new TypeError("sessionId is required");case 3:return c=this.getWorker(n,t),s=t.getRpcMethodType(r),e.next=7,s.serializeArguments(a,this.name);case 7:return l=e.sent,d=this.filterArgs(l,t,n),f=c.call(r,d,Object(u.a)({timeout:3e5,statusCallback:a.statusCallback,rpcDriverClassName:this.name},i)),g=new Promise((function(e,t){p=setInterval((function(){"killed"===c.status&&t(new Error("operation timed out, worker process stopped responding, ".concat(c.error)))}),h.workerCheckFrequency)})).finally((function(){clearInterval(p)})),m=Promise.race([f,g]),e.t0=s,e.next=15,m;case 15:return e.t1=e.sent,e.t2=a,e.t3=this.name,e.abrupt("return",e.t0.deserializeReturn.call(e.t0,e.t1,e.t2,e.t3));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),e}(),yl=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"destroy",value:function(){this.workers[0].terminate()}},{key:"call",value:function(){var e=Object(s.a)(o.a.mark((function e(t,r,a){var i,c,s,l,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.statusCallback,c=a.rpcDriverClassName,s="message-".concat(ye.a.generate()),l=function(e){i&&i(e)},this.on(s,l),e.next=6,Object(De.a)(Object(Le.a)(n.prototype),"call",this).call(this,t,Object(u.a)(Object(u.a)({},r),{},{channel:s,rpcDriverClassName:c}),a);case 6:return d=e.sent,this.off(s,l),e.abrupt("return",d);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(gl.a.Client),wl=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e,r){var a;return Object(g.a)(this,n),(a=t.call(this,e)).name="WebWorkerRpcDriver",a.WorkerClass=void 0,a.workerBootConfiguration=void 0,a.WorkerClass=e.WorkerClass,a.workerBootConfiguration=r,a}return Object(m.a)(n,[{key:"makeWorker",value:function(){var e=new yl({workers:[new this.WorkerClass]});return e.workers[0].postMessage(this.workerBootConfiguration),e}}]),n}(vl),Ol=function(){function e(){Object(g.a)(this,e)}return Object(m.a)(e,[{key:"destroy",value:function(){}},{key:"call",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>2&&void 0!==r[2]?r[2]:{},e.abrupt("return",void 0);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),jl=function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).name="MainThreadRpcDriver",r.makeWorker=void 0,r.makeWorker=function(){return new Ol},r}return Object(m.a)(n,[{key:"call",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r,a){var i,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new TypeError("sessionId is required");case 2:return i=t.getRpcMethodType(r),e.next=5,i.serializeArguments(a,this.name);case 5:return c=e.sent,e.next=8,i.execute(c,this.name);case 8:return s=e.sent,e.abrupt("return",i.deserializeReturn(s,a,this.name));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),n}(vl),kl="undefined"!==typeof window?window:{},xl=kl.electronBetterIpc,Cl=void 0===xl?{}:xl,Sl=kl.electron;function Tl(e){return El.apply(this,arguments)}function El(){return(El=Object(s.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Rl=function(){function e(t,n,r){Object(g.a)(this,e),this.ipcRenderer=void 0,this.window=void 0,this.config=void 0,this.ready=!1,this.ipcRenderer=t,this.window=n,this.config=r}return Object(m.a)(e,[{key:"destroy",value:function(){this.window.destroy()}},{key:"setup",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ready){e.next=16;break}t=!1;case 2:if(t){e.next=10;break}return e.next=5,Tl(1e3);case 5:return e.next=7,this.ipcRenderer.callRenderer(this.window,"ready_for_configuration");case 7:t=!!e.sent,e.next=2;break;case 10:return e.next=12,this.ipcRenderer.callRenderer(this.window,"configure",this.config);case 12:if(e.sent){e.next=15;break}throw new Error("failed to configure worker");case 15:this.ready=!0;case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r,a,i,c,s,d=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},e.next=3,this.setup();case 3:return r.statusCallback,a=Object(l.a)(r,["statusCallback"]),i="message-".concat(ye.a.generate()),c=function(e,t){r.statusCallback&&r.statusCallback(t)},this.ipcRenderer.on(i,c),e.next=9,this.ipcRenderer.callRenderer(this.window,"call",t,Object(u.a)(Object(u.a)({},n),{},{channel:i}),a);case 9:return s=e.sent,this.ipcRenderer.removeListener(i,c),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Ml={WebWorkerRpcDriver:wl,MainThreadRpcDriver:jl,ElectronRpcDriver:function(e){Object(k.a)(n,e);var t=Object(x.a)(n);function n(e,r){var a;Object(g.a)(this,n),(a=t.call(this,e)).name="ElectronRpcDriver",a.bootConfig=void 0,a.channel=void 0;var i=e.workerCreationChannel;return a.bootConfig=r,a.channel=i,a}return Object(m.a)(n,[{key:"makeWorker",value:function(){var e=Cl.ipcRenderer;if(!e)throw new Error("Cannot use ElectronRpcDriver without ipcRenderer from electron-better-ipc-extra");if(!Sl)throw new Error("Cannot use ElectronRpcDriver without electron available globally");var t=Sl.remote,n=e.sendSync(this.channel),r=t.BrowserWindow.fromId(n);return new Rl(e,r,this.bootConfig)}},{key:"call",value:function(){var e=Object(s.a)(o.a.mark((function e(t,r,a,i){var c,s,u,l=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=l.length>4&&void 0!==l[4]?l[4]:{},e.next=3,Object(De.a)(Object(Le.a)(n.prototype),"call",this).call(this,t,r,a,i,c);case 3:return"object"===typeof(s=e.sent)&&null!==s&&"imageData"in s&&((u=new Image).src=s.imageData.dataURL,s.imageData=u),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),n}(vl)},Pl=function(){function e(t,n,r){if(Object(g.a)(this,e),this.driverObjects=void 0,this.pluginManager=void 0,this.mainConfiguration=void 0,this.backendConfigurations=void 0,!n)throw new Error("RpcManager requires at least a main configuration");this.pluginManager=t,this.mainConfiguration=n,this.backendConfigurations=r,this.driverObjects=new Map}return Object(m.a)(e,[{key:"getDriver",value:function(e){var t=this.driverObjects.get(e);if(t)return t;var n=this.backendConfigurations[e],r=Ml[e];if(!r)throw new Error('requested RPC driver "'.concat(e,'" is not installed'));if(!n)throw new Error('requested RPC driver "'.concat(e,'" is missing config'));var a=new r(n,{plugins:this.pluginManager.runtimePluginDefinitions});return this.driverObjects.set(e,a),a}},{key:"getDriverForCall",value:function(e,t,n){var r=n.rpcDriverName||Object(A.readConfObject)(this.mainConfiguration,"defaultDriver");return this.getDriver(r)}},{key:"call",value:function(){var e=Object(s.a)(o.a.mark((function e(t,n,r){var a,i=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.length>3&&void 0!==i[3]?i[3]:{},t){e.next=3;break}throw new Error("sessionId is required");case 3:return e.abrupt("return",this.getDriverForCall(t,n,r).call(this.pluginManager,t,n,r,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();Pl.configSchema=pl;var Nl=n(1733),Al=n.n(Nl);function Fl(e,t,n){var r=h.types.model("JBrowseWeb",{configuration:Object(A.ConfigurationSchema)("Root",Object(u.a)({rpc:Pl.configSchema,highResolutionScaling:{type:"number",defaultValue:2},shareURL:{type:"string",defaultValue:"https://share.jbrowse.org/api/v1/"},featureDetails:Object(A.ConfigurationSchema)("FeatureDetails",{sequenceTypes:{type:"stringArray",defaultValue:["mRNA","transcript"]}}),disableAnalytics:{type:"boolean",defaultValue:!1},theme:{type:"frozen",defaultValue:{}}},e.pluginConfigurationSchemas())),plugins:h.types.array(h.types.frozen()),assemblies:h.types.array(n),tracks:h.types.array(e.pluggableConfigSchemaType("track")),connections:h.types.array(e.pluggableConfigSchemaType("connection")),defaultSession:h.types.optional(h.types.frozen(t),{name:"New session"})}).actions((function(e){return{afterCreate:function(){var t=[];e.assemblyNames.forEach((function(e){if(!e)throw new Error('Encountered an assembly with no "name" defined');if(t.includes(e))throw new Error("Found two assemblies with the same name: ".concat(e));t.push(e)}))},addAssemblyConf:function(t){var n=t.name;if(!n)throw new Error('Can\'t add assembly with no "name"');var r=e.assemblies.find((function(e){return e.name===n}));if(r)return r;var a=e.assemblies.push(Object(u.a)(Object(u.a)({},t),{},{sequence:Object(u.a)({type:"ReferenceSequenceTrack",trackId:"".concat(n,"-").concat(Date.now())},t.sequence||{})}));return e.assemblies[a-1]},removeAssemblyConf:function(t){var n=e.assemblies.find((function(e){return e.name===t}));n&&e.assemblies.remove(n)},addTrackConf:function(t){var n=t.type;if(!n)throw new Error("unknown track type ".concat(n));var r=e.tracks.find((function(e){return e.trackId===t.trackId}));if(r)return r;var a=e.tracks.push(t);return e.tracks[a-1]},addDisplayConf:function(t,n){var r=n.type;if(!r)throw new Error("unknown display type ".concat(r));var a=e.tracks.find((function(e){return e.trackId===t}));if(!a)throw new Error("could not find track with id ".concat(t));return a.addDisplayConf(n)},addConnectionConf:function(t){var n=t.type;if(!n)throw new Error("unknown connection type ".concat(n));var r=e.connections.push(t);return e.connections[r-1]},deleteConnectionConf:function(t){var n=e.connections.findIndex((function(e){return e.id===t.id}));if(-1!==n)return e.connections.splice(n,1)},deleteTrackConf:function(t){var n=t.trackId,r=e.tracks.findIndex((function(e){return e.trackId===n}));if(-1!==r)return e.tracks.splice(r,1)},setDefaultSessionConf:function(t){var n,r=(n=Object(h.getParent)(e).session.name===t.name?Object(h.getSnapshot)(t):Object(ge.toJS)(t)).name;if(!r)throw new Error("unable to set default session to ".concat(r));e.defaultSession=n},addPlugin:function(t){e.plugins=[].concat(Object(c.a)(e.plugins),[t]),Object(h.getRoot)(e).setPluginsUpdated(!0)},removePlugin:function(t){e.plugins=e.plugins.filter((function(e){return"".concat(e.name,"Plugin")!==t})),Object(h.getRoot)(e).setPluginsUpdated(!0)}}})).views((function(e){return{get assemblyNames(){return e.assemblies.map((function(e){return Object(A.readConfObject)(e,"name")}))},get rpcManager(){return Object(h.getParent)(e).rpcManager}}}));return h.types.snapshotProcessor(r,{postProcessor:function(e){return function e(t,n){for(var r in t)r===n?delete t[r]:"object"===typeof t[r]&&e(t[r])}(e,"baseUri"),e}})}window.getSnapshot=h.getSnapshot,window.resolveIdentifier=h.resolveIdentifier;var Il=n(1732),Bl=n.n(Il),Dl=n(356),Ll=n.n(Dl),Vl=Object(f.lazy)((function(){return n.e(44).then(n.bind(null,2435))}));function Wl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.types.frozen(),n=128,r=h.types.model("JBrowseWebSessionModel",{id:h.types.optional(h.types.identifier,ye()()),name:h.types.string,margin:0,drawerWidth:h.types.optional(h.types.refinement(h.types.integer,(function(e){return e>=n})),384),views:h.types.array(e.pluggableMstType("view","stateModel")),widgets:h.types.map(e.pluggableMstType("widget","stateModel")),activeWidgets:h.types.map(h.types.safeReference(e.pluggableMstType("widget","stateModel"))),connectionInstances:h.types.array(e.pluggableMstType("connection","stateModel")),sessionTracks:h.types.array(e.pluggableConfigSchemaType("track")),sessionConnections:h.types.array(e.pluggableConfigSchemaType("connection")),sessionAssemblies:h.types.array(t),sessionPlugins:h.types.array(h.types.frozen()),minimized:h.types.optional(h.types.boolean,!1)}).volatile((function(){return{selection:void 0,task:void 0,DialogComponent:void 0,DialogProps:void 0}})).views((function(e){return{get shareURL(){return Object(A.getConf)(Object(h.getParent)(e).jbrowse,"shareURL")},get rpcManager(){return Object(h.getParent)(e).jbrowse.rpcManager},get configuration(){return Object(h.getParent)(e).jbrowse.configuration},get assemblies(){return Object(h.getParent)(e).jbrowse.assemblies},get assemblyNames(){return Object(h.getParent)(e).jbrowse.assemblyNames},get tracks(){return[].concat(Object(c.a)(e.sessionTracks),Object(c.a)(Object(h.getParent)(e).jbrowse.tracks))},get connections(){return[].concat(Object(c.a)(e.sessionConnections),Object(c.a)(Object(h.getParent)(e).jbrowse.connections))},get adminMode(){return Object(h.getParent)(e).adminMode},get savedSessions(){return Object(h.getParent)(e).savedSessions},get previousAutosaveId(){return Object(h.getParent)(e).previousAutosaveId},get savedSessionNames(){return Object(h.getParent)(e).savedSessionNames},get history(){return Object(h.getParent)(e).history},get menus(){return Object(h.getParent)(e).menus},get assemblyManager(){return Object(h.getParent)(e).assemblyManager},get version(){return Object(h.getParent)(e).version},get renderProps(){return{theme:Object(A.readConfObject)(this.configuration,"theme")}},get visibleWidget(){if(Object(h.isAlive)(e))return Array.from(e.activeWidgets.values())[e.activeWidgets.size-1]},getReferring:function(t){var n=[];return Object(h.walk)(Object(h.getParent)(e),(function(e){if(Object(h.isModelType)(Object(h.getType)(e))){var r=Object(h.getMembers)(e);Object.entries(r.properties).forEach((function(r){var a=Object(d.a)(r,2),i=a[0],o=a[1];Object(h.isReferenceType)(o)&&e[i]===t&&n.push({node:e,key:i})}))}})),n}}})).actions((function(t){return{setDialogComponent:function(e,n){t.DialogComponent=e,t.DialogProps=n},setName:function(e){t.name=e},addAssembly:function(e){t.sessionAssemblies.push(e)},addSessionPlugin:function(e){if(t.sessionPlugins.find((function(t){return t.name===e.name})))throw new Error("session plugin cannot be installed twice");t.sessionPlugins.push(e),Object(h.getRoot)(t).setPluginsUpdated(!0)},removeAssembly:function(e){var n=t.sessionAssemblies.findIndex((function(t){return t.name===e}));-1!==n&&t.sessionAssemblies.splice(n,1)},removeSessionPlugin:function(e){var n=t.sessionPlugins.findIndex((function(t){return"".concat(t.name,"Plugin")===e}));-1!==n&&t.sessionPlugins.splice(n,1),Object(h.getRoot)(t).setPluginsUpdated(!0)},makeConnection:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.type;if(!a)throw new Error("track configuration has no `type` listed");var i=Object(A.readConfObject)(n,"name"),o=e.getConnectionType(a);if(!o)throw new Error("unknown connection type ".concat(a));var c=Object(u.a)(Object(u.a)({},r),{},{name:i,type:a,configuration:n}),s=t.connectionInstances.push(c);return t.connectionInstances[s-1]},removeReferring:function(e,n,r,a){var i=this;e.forEach((function(e){var o=e.node,c=!1;try{var s="open track(s)",u=Object(Y.getContainingView)(o);r.push((function(){return u.hideTrack(n.trackId)})),c=!0,a[s]||(a[s]=0),a[s]+=1}catch(d){}if(t.widgets.has(o.id)){var l="configuration editor widget(s)";r.push((function(){return i.hideWidget(o)})),c=!0,a[l]||(a[l]=0),a[l]+=1}if(!c)throw new Error("Error when closing this connection, the following node is still referring to a track configuration: ".concat(JSON.stringify(Object(h.getSnapshot)(o))))}))},prepareToBreakConnection:function(e){var n=this,r=[],a={},i=Object(A.readConfObject)(e,"name"),o=t.connectionInstances.find((function(e){return e.name===i}));if(o){o.tracks.forEach((function(e){var i=t.getReferring(e);n.removeReferring(i,e,r,a)}));return[function(){r.forEach((function(e){return e()})),n.breakConnection(e)},a]}},breakConnection:function(e){var n=Object(A.readConfObject)(e,"name"),r=t.connectionInstances.find((function(e){return e.name===n}));t.connectionInstances.remove(r)},deleteConnection:function(e){var n;if(t.adminMode&&(n=Object(h.getParent)(t).jbrowse.deleteConnectionConf(e)),!n){var r=e.connectionId,a=t.sessionConnections.findIndex((function(e){return e.connectionId===r}));if(-1===a)return;return t.sessionConnections.splice(a,1)}return n},updateDrawerWidth:function(e){if(e===t.drawerWidth)return t.drawerWidth;var r=e;return r<n&&(r=n),t.drawerWidth=r,r},resizeDrawer:function(e){var n=t.drawerWidth;return n-this.updateDrawerWidth(n-e)},addView:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.getElementType("view",n);if(!a)throw new Error("unknown view type ".concat(n));var i=t.views.push(Object(u.a)(Object(u.a)({},r),{},{type:n}));return t.views[i-1]},removeView:function(e){var n,r=Object(Ue.a)(t.activeWidgets);try{for(r.s();!(n=r.n()).done;){var a=Object(d.a)(n.value,2)[1];a.view&&a.view.id===e.id&&this.hideWidget(a)}}catch(i){r.e(i)}finally{r.f()}t.views.remove(e)},addAssemblyConf:function(e){return Object(h.getParent)(t).jbrowse.addAssemblyConf(e)},addTrackConf:function(e){if(t.adminMode)return Object(h.getParent)(t).jbrowse.addTrackConf(e);var n=e.trackId,r=e.type;if(!r)throw new Error("unknown track type ".concat(r));var a=t.sessionTracks.find((function(e){return e.trackId===n}));if(a)return a;var i=t.sessionTracks.push(e);return t.sessionTracks[i-1]},deleteTrackConf:function(e){var n=[],r=t.getReferring(e);if(this.removeReferring(r,e,n,{}),n.forEach((function(e){return e()})),t.adminMode)return Object(h.getParent)(t).jbrowse.deleteTrackConf(e);var a=e.trackId,i=t.sessionTracks.findIndex((function(e){return e.trackId===a}));return-1!==i?t.sessionTracks.splice(i,1):void 0},addConnectionConf:function(e){if(t.adminMode)return Object(h.getParent)(t).jbrowse.addConnectionConf(e);var n=e.connectionId,r=e.type;if(!r)throw new Error("unknown connection type ".concat(r));var a=t.sessionTracks.find((function(e){return e.connectionId===n}));if(a)return a;var i=t.sessionConnections.push(e);return t.sessionConnections[i-1]},addLinearGenomeViewOfAssembly:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addViewOfAssembly("LinearGenomeView",e,t)},addViewOfAssembly:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.assemblies.find((function(e){return Object(A.readConfObject)(e,"name")===n}));if(!a)throw new Error('Could not add view of assembly "'.concat(n,'", assembly name not found'));return r.displayRegionsFromAssemblyName=Object(A.readConfObject)(a,"name"),this.addView(e,r)},addViewFromAnotherView:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object(u.a)({},n);return r.displayedRegions=Object(h.getSnapshot)(t.displayedRegions),this.addView(e,r)},addWidget:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{type:n},o=e.getElementType("widget",n);if(!o)throw new Error("unknown widget type ".concat(n));var c=Object(u.a)(Object(u.a)({},a),{},{id:r,type:n,configuration:i});return t.widgets.set(r,c),t.widgets.get(r)},showWidget:function(e){t.activeWidgets.has(e.id)&&t.activeWidgets.delete(e.id),t.activeWidgets.set(e.id,e),t.minimized=!1},hasWidget:function(e){return t.activeWidgets.has(e.id)},hideWidget:function(e){t.activeWidgets.delete(e.id)},minimizeWidgetDrawer:function(){t.minimized=!0},showWidgetDrawer:function(){t.minimized=!1},hideAllWidgets:function(){t.activeWidgets.clear()},setSelection:function(e){t.selection=e},clearSelection:function(){t.selection=void 0},clearConnections:function(){t.connectionInstances.length=0},addSavedSession:function(e){return Object(h.getParent)(t).addSavedSession(e)},removeSavedSession:function(e){return Object(h.getParent)(t).removeSavedSession(e)},renameCurrentSession:function(e){return Object(h.getParent)(t).renameCurrentSession(e)},duplicateCurrentSession:function(){return Object(h.getParent)(t).duplicateCurrentSession()},activateSession:function(e){return Object(h.getParent)(t).activateSession(e)},setDefaultSession:function(){return Object(h.getParent)(t).setDefaultSession()},saveSessionToLocalStorage:function(){return Object(h.getParent)(t).saveSessionToLocalStorage()},loadAutosaveSession:function(){return Object(h.getParent)(t).loadAutosaveSession()},setSession:function(e){return Object(h.getParent)(t).setSession(e)}}})).extend((function(){var e=ge.observable.array();return{views:{get snackbarMessages(){return e}},actions:{notify:function(e,t){return this.pushSnackbarMessage(e,t)},pushSnackbarMessage:function(t,n){return e.push([t,n])},popSnackbarMessage:function(){return e.pop()}}}})).actions((function(e){return{editConfiguration:function(t){if(!Object(A.isConfigurationModel)(t))throw new Error("must pass a configuration model to editConfiguration");var n=e,r=n.addWidget("ConfigurationEditorWidget","configEditor",{target:t});n.showWidget(r)},editTrackConfiguration:function(t){if(!e.adminMode&&-1===e.sessionTracks.indexOf(t))throw new Error("Can't edit the configuration of a non-session track");this.editConfiguration(t)}}})).views((function(e){return{getTrackActionMenuItems:function(t){var n=e,r=n.adminMode||n.sessionTracks.find((function(e){return e.trackId===t.trackId})),a="ReferenceSequenceTrack"===Object(A.readConfObject)(t,"type");return[{label:"About track",onClick:function(){n.setDialogComponent(Vl,{config:t})},icon:xc.a},{label:"Settings",disabled:!r,onClick:function(){n.editTrackConfiguration(t)},icon:Uu.a},{label:"Delete track",disabled:!r||a,onClick:function(){n.deleteTrackConf(t)},icon:Ll.a},{label:"Copy track",disabled:a,onClick:function(){var e=JSON.parse(JSON.stringify(Object(h.getSnapshot)(t))),r=Date.now();e.trackId+="-".concat(r),e.displays.forEach((function(e){e.displayId+="-".concat(r)})),n.adminMode||(e.trackId+="-sessionTrack",e.category=void 0),e.name+=" (copy)",n.addTrackConf(e)},icon:hc.a}]}}}));return h.types.snapshotProcessor(r,{preProcessor:function(e){if(e){var t=e||{},n=t.connectionInstances,r=Object(l.a)(t,["connectionInstances"]);if(!Array.isArray(n))return r}return e}})}function zl(e,t){if(void 0!==e)if(Object(h.isArrayType)(t))!function(){var t=e,n=Object(h.getChildType)(e);if(Object(h.isReferenceType)(n))for(var r=function(e){Object(h.isValidReference)((function(){return t[e]}))?e+=1:t.splice(e,1),a=e},a=0;a<t.length;)r(a);t.forEach((function(e){zl(e,n)}))}();else if(Object(h.isMapType)(t))!function(){var t=e,n=Object(h.getChildType)(t);if(Object(h.isReferenceType)(n)){var r=function(e){Object(h.isValidReference)((function(){return t.get(e)}))||t.delete(e)};for(var a in t.keys())r(a)}t.forEach((function(e){zl(e,n)}))}();else if(Object(h.isModelType)(t)){var n=Object(h.getPropertyMembers)(e).properties;Object.entries(n).forEach((function(t){var n=Object(d.a)(t,2),r=n[0],a=n[1];zl(e[r],a)}))}}function Hl(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ul(e),r=n.assemblyConfigSchemas,a=n.dispatcher,i=h.types.union.apply(h.types,[{dispatcher:a}].concat(Object(c.a)(r))),o=Wl(e,i),s=sl(i,e);return h.types.model("Root",{jbrowse:Fl(e,o,i),configPath:h.types.maybe(h.types.string),session:h.types.maybe(o),assemblyManager:s,version:h.types.maybe(h.types.string),isAssemblyEditing:!1,isDefaultSessionEditing:!1,pluginsUpdated:!1}).volatile((function(t){return{rpcManager:new Pl(e,t.jbrowse.configuration.rpc,{WebWorkerRpcDriver:{WorkerClass:Bl.a},MainThreadRpcDriver:{}}),savedSessionsVolatile:ge.observable.map({}),pluginManager:e,error:void 0}})).views((function(e){return{get savedSessions(){return Array.from(e.savedSessionsVolatile.values())},localStorageId:function(t){return"localSaved-".concat(t,"-").concat(e.configPath)},get autosaveId(){return"autosave-".concat(e.configPath)},get previousAutosaveId(){return"previousAutosave-".concat(e.configPath)}}})).views((function(e){return{get savedSessionNames(){return e.savedSessions.map((function(e){return e.name}))},get currentSessionId(){var e,t=new URL(window.location.href),n=new URLSearchParams(t.search);return null===n||void 0===n||null===(e=n.get("session"))||void 0===e?void 0:e.split("local-")[1]}}})).actions((function(e){return{afterCreate:function(){var t=this;Object.entries(localStorage).filter((function(e){var t=Object(d.a)(e,2),n=t[0];t[1];return n.startsWith("localSaved-")})).filter((function(t){var n=Object(d.a)(t,2),r=n[0];n[1];return-1!==r.indexOf(e.configPath||"undefined")})).forEach((function(t){var n=Object(d.a)(t,2),r=n[0],a=n[1];try{var i=JSON.parse(a).session;e.savedSessionsVolatile.set(r,i)}catch(o){console.error("bad session encountered",r,a)}})),Object(h.addDisposer)(e,Object(ge.autorun)((function(){var t,n=Object(Ue.a)(e.savedSessionsVolatile.entries());try{for(n.s();!(t=n.n()).done;){var r=Object(d.a)(t.value,2),a=(r[0],r[1]);try{var i=e.localStorageId(a.name);localStorage.setItem(i,JSON.stringify({session:a}))}catch(o){"22"!==o.code&&"1024"!==o.code||alert('Local storage is full! Please use the "Open sessions" panel to remove old sessions')}}}catch(c){n.e(c)}finally{n.f()}}))),Object(h.addDisposer)(e,Object(ge.autorun)((function(){if(e.session){var n=Object(h.getSnapshot)(e.session)||{name:"empty"};sessionStorage.setItem("current",JSON.stringify({session:n})),localStorage.setItem("autosave-".concat(e.configPath),JSON.stringify({session:Object(u.a)(Object(u.a)({},n),{},{name:"".concat(n.name,"-autosaved")})})),e.pluginsUpdated&&(t.setPluginsUpdated(!1),window.location.reload())}}),{delay:400}))},setSession:function(t){var n=e.session;if(e.session=Object(h.cast)(t),e.session)try{zl(e.session,Object(h.getType)(e.session))}catch(r){throw e.session=n,r}n&&this.setPluginsUpdated(!0)},setAssemblyEditing:function(t){e.isAssemblyEditing=t},setDefaultSessionEditing:function(t){e.isDefaultSessionEditing=t},setPluginsUpdated:function(t){e.pluginsUpdated=t},setDefaultSession:function(){var t=e.jbrowse.defaultSession,n=Object(u.a)(Object(u.a)({},t),{},{name:"".concat(t.name," ")});this.setSession(n)},renameCurrentSession:function(t){if(e.session){var n=JSON.parse(JSON.stringify(Object(h.getSnapshot)(e.session)));n.name=t,this.setSession(n)}},addSavedSession:function(t){var n=e.localStorageId(t.name);e.savedSessionsVolatile.set(n,t)},removeSavedSession:function(t){var n=e.localStorageId(t.name);localStorage.removeItem(n),e.savedSessionsVolatile.delete(n)},duplicateCurrentSession:function(){if(e.session){var t=JSON.parse(JSON.stringify(Object(h.getSnapshot)(e.session))),n="".concat(e.session.name," (copy)");if(e.savedSessionNames.includes(n)){var r=2;do{n="".concat(e.session.name," (copy ").concat(r,")"),r+=1}while(e.savedSessionNames.includes(n))}t.name=n,this.setSession(t)}},activateSession:function(t){var n=e.localStorageId(t),r=localStorage.getItem(n);if(!r)throw new Error("Can't activate session ".concat(t,", it is not in the savedSessions"));this.setSession(JSON.parse(r).session)},saveSessionToLocalStorage:function(){if(e.session){var t=e.localStorageId(e.session.name);e.savedSessionsVolatile.set(t,Object(h.getSnapshot)(e.session))}},loadAutosaveSession:function(){var t=localStorage.getItem(e.previousAutosaveId),n=t?JSON.parse(t).session:{},r=n.name;n.name="".concat(r.replace("-autosaved",""),"-restored"),this.setSession(n)},setError:function(t){e.error=t}}})).volatile((function(e){return{history:{},menus:[{label:"File",menuItems:[{label:"New session",icon:va.a,onClick:function(t){var n=localStorage.getItem(e.autosaveId);n&&localStorage.setItem(e.previousAutosaveId,n),t.setDefaultSession()}},{label:"Return to splash screen",icon:Al.a,onClick:function(){e.setSession(void 0)}}]}].concat(Object(c.a)(t?[{label:"Admin",menuItems:[{label:"Open assembly manager",icon:Uu.a,onClick:function(e){Object(h.getParent)(e).setAssemblyEditing(!0)}},{label:"Set default session",icon:Uu.a,onClick:function(e){Object(h.getParent)(e).setDefaultSessionEditing(!0)}}]}]:[])),adminMode:t}})).actions((function(e){return{setHistory:function(t){e.history=t},setMenus:function(t){e.menus=t},appendMenu:function(t){return e.menus.push({label:t,menuItems:[]})},insertMenu:function(t,n){var r=n<0?e.menus.length+n:n;return e.menus.splice(r,0,{label:t,menuItems:[]}),e.menus.length},appendToMenu:function(t,n){var r=e.menus.find((function(e){return e.label===t}));return r?r.menuItems.push(n):(e.menus.push({label:t,menuItems:[n]}),1)},insertInMenu:function(t,n,r){var a=e.menus.find((function(e){return e.label===t}));if(!a)return e.menus.push({label:t,menuItems:[n]}),1;var i=r<0?a.menuItems.length+r:r;return a.menuItems.splice(i,0,n),a.menuItems.length},appendToSubMenu:function(t,n){var r=e.menus.find((function(e){return e.label===t[0]}));if(!r){var a=this.appendMenu(t[0]);r=e.menus[a-1]}var i=r.menuItems,o=[t[0]];return t.slice(1).forEach((function(e){o.push(e);var t=i.find((function(t){return"label"in t&&t.label===e}));if(!t){var n=i.push({label:e,subMenu:[]});t=i[n-1]}if(!("subMenu"in t))throw new Error('"'.concat(e,'" in path "').concat(o,'" is not a subMenu'));i=t.subMenu})),i.push(n)},insertInSubMenu:function(t,n,r){var a=e.menus.find((function(e){return e.label===t[0]}));if(!a){var i=this.appendMenu(t[0]);a=e.menus[i-1]}var o=a.menuItems,c=[t[0]];return t.slice(1).forEach((function(e){c.push(e);var t=o.find((function(t){return"label"in t&&t.label===e}));if(!t){var n=o.push({label:e,subMenu:[]});t=o[n-1]}if(!("subMenu"in t))throw new Error('"'.concat(e,'" in path "').concat(c,'" is not a subMenu'));o=t.subMenu})),o.splice(r,0,n),o.length}}}))}var ql=n(1734);function Ul(){return _l.apply(this,arguments)}function _l(){return(_l=Object(s.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.location=window.location.pathname;case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Gl=Object(f.lazy)((function(){return n.e(31).then(n.bind(null,2404))})),Jl=Object(f.lazy)((function(){return n.e(30).then(n.bind(null,2405))})),Xl=Object(f.lazy)((function(){return n.e(32).then(n.bind(null,2439))}));function Yl(){return p.a.createElement("div",null,p.a.createElement("h4",null,"Configuration not found. You may have arrived here if you requested a config that does not exist or you have not set up your JBrowse yet."),p.a.createElement("p",null,"If you want to complete your setup, visit our"," ",p.a.createElement("a",{href:"https://jbrowse.org/jb2/docs/quickstart_web"},"Quick start guide")),Y.inDevelopment?p.a.createElement(p.a.Fragment,null,p.a.createElement("div",null,"Sample JBrowse configs:"),p.a.createElement("ul",null,[["test_data/volvox/config.json","Volvox sample data"],["test_data/config.json","Human basic"],["test_data/config_demo.json","Human sample data"],["test_data/tomato/config.json","Tomato SVs"],["test_data/breakpoint/config.json","Breakpoint"],["test_data/config_dotplot.json","Grape/Peach dotplot"],["test_data/config_synteny_grape_peach.json","Grape/Peach synteny"],["test_data/yeast_synteny/config.json","Yeast synteny"],["test_data/config_many_contigs.json","Many contigs"],["test_data/config_honeybee.json","Honeybee"],["test_data/config_wormbase.json","Wormbase"],["test_data/wgbs/config.json","WGBS methylation"]].map((function(e){var t=Object(d.a)(e,2),n=t[0],r=t[1],a=window.location,i=a.href,o=a.search,c=be.a.parse(o),s=(c.config,Object(l.a)(c,["config"])),f=i.split("?")[0],g=be.a.stringify(Object(u.a)(Object(u.a)({},s),{},{config:n}));return p.a.createElement("li",{key:r},p.a.createElement("a",{href:"".concat(f,"?").concat(g)},r))})))):p.a.createElement(p.a.Fragment,null,p.a.createElement("div",null,"Sample JBrowse config:"),p.a.createElement("ul",null,p.a.createElement("li",null,p.a.createElement("a",{href:"?config=test_data/volvox/config.json"},"Volvox sample data")))))}function Ql(e){return $l.apply(this,arguments)}function $l(){return($l=Object(s.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://jbrowse.org/plugin-store/plugins.json");case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("Failed to fetch plugin data");case 5:return e.next=7,n.json();case 7:return r=e.sent,a=r.plugins.map((function(e){return e.url})),e.abrupt("return",t.every((function(e){return a.includes(e.url)})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Kl=h.types.model({configPath:h.types.maybe(h.types.string),sessionQuery:h.types.maybe(h.types.string),password:h.types.maybe(h.types.string),adminKey:h.types.maybe(h.types.string)}).volatile((function(){return{blankSession:!1,sessionTriaged:void 0,shareWarningOpen:!1,configSnapshot:void 0,sessionSnapshot:void 0,runtimePlugins:[],sessionPlugins:[],sessionError:void 0,configError:void 0,bc1:window.BroadcastChannel&&new window.BroadcastChannel("jb_request_session"),bc2:window.BroadcastChannel&&new window.BroadcastChannel("jb_respond_session")}})).views((function(e){return{get sharedSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("share-")},get encodedSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("encoded-")},get jsonSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("json-")},get localSession(){var t;return null===(t=e.sessionQuery)||void 0===t?void 0:t.startsWith("local-")},get ready(){return this.sessionLoaded&&!e.configError},get error(){return e.configError||e.sessionError},get sessionLoaded(){return!!e.sessionError||!!e.sessionSnapshot||!!e.blankSession},get configLoaded(){return!!e.configError||!!e.configSnapshot}}})).actions((function(e){return{setSessionQuery:function(t){e.sessionQuery=t},setConfigError:function(t){e.configError=t},setSessionError:function(t){e.sessionError=t},setRuntimePlugins:function(t){e.runtimePlugins=t},setSessionPlugins:function(t){e.sessionPlugins=t},setConfigSnapshot:function(t){e.configSnapshot=t},setBlankSession:function(t){e.blankSession=t},setSessionTriaged:function(t){e.sessionTriaged=t},setSessionSnapshotSuccess:function(t){e.sessionSnapshot=t}}})).actions((function(e){return{fetchPlugins:function(t){return Object(s.a)(o.a.mark((function n(){var r,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,(r=new ue.a(t.plugins)).installGlobalReExports(window),n.next=5,r.load();case 5:a=n.sent,e.setRuntimePlugins(Object(c.a)(a)),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.error(n.t0),e.setConfigError(n.t0);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})))()},fetchSessionPlugins:function(t){return Object(s.a)(o.a.mark((function n(){var r,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,(r=new ue.a(t.sessionPlugins||[])).installGlobalReExports(window),n.next=5,r.load();case 5:a=n.sent,e.setSessionPlugins(Object(c.a)(a)),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.error(n.t0),e.setConfigError(n.t0);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})))()},setSessionSnapshot:function(t,n){var r=this;return Object(s.a)(o.a.mark((function a(){var i,c;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,i=t.sessionPlugins,!(c=void 0===i?[]:i).length){a.next=8;break}return a.next=5,Ql(c);case 5:a.t0=a.sent,a.next=9;break;case 8:a.t0=!0;case 9:if(!a.t0&&!n){a.next=16;break}return a.next=13,r.fetchSessionPlugins(t);case 13:e.setSessionSnapshotSuccess(t),a.next=17;break;case 16:e.setSessionTriaged({snap:t,origin:"session",reason:c});case 17:a.next=23;break;case 19:a.prev=19,a.t1=a.catch(0),console.error(a.t1),e.setConfigError(a.t1);case 23:case"end":return a.stop()}}),a,null,[[0,19]])})))()},fetchConfig:function(){var t=this;return Object(s.a)(o.a.mark((function n(){var r,a,i,c,s;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.configPath,a=void 0===r?"config.json":r,n.t0=JSON,n.next=4,Object(de.openLocation)({uri:a}).readFile("utf8");case 4:if(n.t1=n.sent,i=n.t0.parse.call(n.t0,n.t1),c=new URL(a,window.location.href),td(i,c),c.hostname===window.location.hostname){n.next=27;break}if(!(s=i.plugins||[]).length){n.next=16;break}return n.next=13,Ql(s);case 13:n.t2=n.sent,n.next=17;break;case 16:n.t2=!0;case 17:if(n.t2){n.next=22;break}e.setSessionTriaged({snap:i,origin:"config",reason:s}),n.next=25;break;case 22:return n.next=24,t.fetchPlugins(i);case 24:e.setConfigSnapshot(i);case 25:n.next=30;break;case 27:return n.next=29,t.fetchPlugins(i);case 29:e.setConfigSnapshot(i);case 30:case"end":return n.stop()}}),n)})))()},fetchSessionStorageSession:function(){var t=this;return Object(s.a)(o.a.mark((function n(){var r,a,i,c,s;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=sessionStorage.getItem("current"),a=e.sessionQuery.replace("local-",""),!r){n.next=8;break}if(i=JSON.parse(r).session||{},a!==i.id){n.next=8;break}return n.next=7,t.setSessionSnapshot(i);case 7:return n.abrupt("return");case 8:if(!e.bc1){n.next=22;break}return e.bc1.postMessage(a),c=new Promise((function(t,n){e.bc2&&(e.bc2.onmessage=function(e){t(e.data)}),setTimeout((function(){return n()}),1e3)})),n.prev=11,n.next=14,c;case 14:return s=n.sent,n.next=17,e.setSessionSnapshot(Object(u.a)(Object(u.a)({},s),{},{id:ye()()}));case 17:return n.abrupt("return");case 20:n.prev=20,n.t0=n.catch(11);case 22:throw new Error("Local storage session not found");case 23:case"end":return n.stop()}}),n,null,[[11,20]])})))()},fetchSharedSession:function(){var t=this;return Object(s.a)(o.a.mark((function n(){var r,a,i;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=function(e,t,n){return(e.configuration||{})[t]||n},"https://share.jbrowse.org/api/v1/",n.next=4,Ne("".concat(r(e.configSnapshot,"shareURL","https://share.jbrowse.org/api/v1/"),"load"),e.sessionQuery||"",e.password||"");case 4:return a=n.sent,i=JSON.parse(Object(Y.fromUrlSafeB64)(a)),n.next=8,t.setSessionSnapshot(Object(u.a)(Object(u.a)({},i),{},{id:ye()()}));case 8:case"end":return n.stop()}}),n)})))()},decodeEncodedUrlSession:function(){var t=this;return Object(s.a)(o.a.mark((function n(){var r;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=JSON.parse(Object(Y.fromUrlSafeB64)(e.sessionQuery.replace("encoded-",""))),n.next=3,t.setSessionSnapshot(Object(u.a)(Object(u.a)({},r),{},{id:ye()()}));case 3:case"end":return n.stop()}}),n)})))()},decodeJsonUrlSession:function(){var t=this;return Object(s.a)(o.a.mark((function n(){var r;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=JSON.parse(e.sessionQuery.replace("json-","")),n.next=3,t.setSessionSnapshot(Object(u.a)(Object(u.a)({},r.session),{},{id:ye()()}));case 3:case"end":return n.stop()}}),n)})))()},afterCreate:function(){var t=this;return Object(s.a)(o.a.mark((function n(){var r,a,i,c,u,l;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.localSession,a=e.encodedSession,i=e.sharedSession,c=e.jsonSession,u=e.configPath,(l=localStorage.getItem("autosave-".concat(u)))&&localStorage.setItem("previousAutosave-".concat(u),l),n.prev=3,n.next=6,t.fetchConfig();case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(3),console.error(n.t0),e.setConfigError(n.t0),n.abrupt("return");case 13:Object(h.addDisposer)(e,Object(ge.autorun)(Object(s.a)(o.a.mark((function n(){return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e.configSnapshot){n.next=28;break}if(!i){n.next=7;break}return n.next=5,t.fetchSharedSession();case 5:n.next=27;break;case 7:if(!a){n.next=12;break}return n.next=10,t.decodeEncodedUrlSession();case 10:n.next=27;break;case 12:if(!c){n.next=17;break}return n.next=15,t.decodeJsonUrlSession();case 15:n.next=27;break;case 17:if(!r){n.next=22;break}return n.next=20,t.fetchSessionStorageSession();case 20:n.next=27;break;case 22:if(!e.sessionQuery){n.next=26;break}throw new Error("unrecognized session format");case 26:e.setBlankSession(!0);case 27:e.bc1&&(e.bc1.onmessage=function(t){var n=JSON.parse(sessionStorage.getItem("current")||"{}").session||{};n.id===t.data&&e.bc2&&e.bc2.postMessage(n)});case 28:n.next=34;break;case 30:n.prev=30,n.t0=n.catch(0),console.error(n.t0),e.setSessionError(n.t0);case 34:case"end":return n.stop()}}),n,null,[[0,30]])})))));case 14:case"end":return n.stop()}}),n,null,[[3,8]])})))()}}}));function Zl(e){var t=e.initialTimestamp,n=void 0===t?Date.now():t,r=function(e){return null===e?void 0:e},a=Object(pe.c)("config",pe.b),i=Object(d.a)(a,1)[0],o=Object(pe.c)("session",pe.b),c=Object(d.a)(o,1)[0],s=Object(pe.c)("password",pe.b),u=Object(d.a)(s,1)[0],l=Object(pe.c)("adminKey",pe.b),f=Object(d.a)(l,1)[0],g=Kl.create({configPath:r(i),sessionQuery:r(c),password:r(u),adminKey:r(f)});return p.a.createElement(ed,{loader:g,initialTimestamp:n,initialSessionQuery:c})}var ed=Object(le.observer)((function(e){var t=e.loader,n=e.initialTimestamp,r=e.initialSessionQuery,a=Object(pe.c)("password",pe.b),i=Object(d.a)(a,2)[1],l=t.sessionError,g=t.configError,m=t.ready,h=t.shareWarningOpen,b=Object(f.useState)(),v=Object(d.a)(b,2),y=v[0],w=v[1],O=Object(f.useState)(""),j=Object(d.a)(O,2),k=j[0],x=j[1],C=Object(f.useState)(""),S=Object(d.a)(C,2),T=S[0],E=S[1];Object(f.useEffect)((function(){try{var e=t.runtimePlugins,a=t.sessionPlugins,o=t.adminKey,s=t.configSnapshot,u=t.sessionSnapshot,d=t.configPath;if(m){var f=new se([].concat(Object(c.a)(Pu.map((function(e){return{plugin:new e,metadata:{isCore:!0}}}))),Object(c.a)(e.map((function(e){var t=e.plugin,n=e.definition;return{plugin:new t,definition:n}}))),Object(c.a)(a.map((function(e){var t=e.plugin,n=e.definition;return{plugin:new t,definition:n}})))));f.createPluggableElements();var p=Hl(f,!!o);if(t.configSnapshot){var g,b,v,y=p.create({jbrowse:s,assemblyManager:{},version:ql.version,configPath:d},{pluginManager:f});if(y.jbrowse.configuration.rpc.addDriverConfig("WebWorkerRpcDriver",{type:"WebWorkerRpcDriver"}),(null===(g=t.configSnapshot)||void 0===g||null===(b=g.configuration)||void 0===b||null===(v=b.rpc)||void 0===v?void 0:v.defaultDriver)||y.jbrowse.configuration.rpc.defaultDriver.set("WebWorkerRpcDriver"),l)y.setDefaultSession(),y.session&&y.session.notify("Error loading session: ".concat(l.message,'. If you\n                received this URL from another user, request that they send you\n                a session generated with the "Share" button instead of copying\n                and pasting their URL'));else if(u&&!h)try{y.setSession(t.sessionSnapshot)}catch(M){var O;console.error(M),y.setDefaultSession();var j=(M.message||"").replace("[mobx-state-tree] ","").replace(/\(.+/,"");null===(O=y.session)||void 0===O||O.notify("Session could not be loaded. ".concat(j.length>1e3?"".concat(j.slice(0,1e3),"...see more in console"):j))}else{var k=y.jbrowse.defaultSession;(null===k||void 0===k?void 0:k.views)&&k.views.length>0&&y.setDefaultSession()}y&&!Object(A.readConfObject)(y.jbrowse.configuration,"disableAnalytics")&&(function(e,t,n){we.apply(this,arguments)}(y,n,r),function(e,t){Oe.apply(this,arguments)}(y,n)),f.setRootModel(y),f.configure(),w(f),i(void 0)}}}catch(S){var C=S.message.match(/.*at path "(.*)" snapshot `(.*)` is not assignable/);C?(x("Failed to load element at ".concat(C[1])),E(C[2])):x(S.message.slice(0,1e4)),console.error(S)}}),[t,h,m,l,i,n,r]);var R,M=g||k;if(M)return p.a.createElement("div",null,p.a.createElement(Yl,null),M?p.a.createElement("div",{style:{border:"1px solid black",overflow:"auto",maxHeight:200,padding:2,margin:2,backgroundColor:"#ff8888"}},"".concat(M),T?p.a.createElement(p.a.Fragment,null,"... Failed element had snapshot:",p.a.createElement("pre",{style:{background:"lightgrey",border:"1px solid black",margin:20}},JSON.stringify(JSON.parse(T),null,2))):null):null);if(t.sessionTriaged){var P=function(){t.setSessionTriaged(void 0)};return"session"===t.sessionTriaged.origin?p.a.createElement(f.Suspense,{fallback:p.a.createElement("div",null)},p.a.createElement(Gl,{onConfirm:Object(s.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(JSON.stringify(t.sessionTriaged.snap)),e.next=3,t.setSessionSnapshot(Object(u.a)(Object(u.a)({},n),{},{id:ye()()}),!0);case 3:P();case 4:case"end":return e.stop()}}),e)}))),onCancel:function(){t.setBlankSession(!0),P()},reason:t.sessionTriaged.reason})):p.a.createElement(f.Suspense,{fallback:p.a.createElement("div",null)},p.a.createElement(Jl,{onConfirm:Object(s.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(JSON.stringify(t.sessionTriaged.snap)),e.next=3,t.fetchPlugins(n);case 3:t.setConfigSnapshot(Object(u.a)(Object(u.a)({},n),{},{id:ye()()})),P();case 5:case"end":return e.stop()}}),e)}))),onCancel:function(){Ul(),P()},reason:t.sessionTriaged.reason}))}return y?(null===(R=y.rootModel)||void 0===R?void 0:R.session)?p.a.createElement(el,{pluginManager:y}):p.a.createElement(f.Suspense,{fallback:p.a.createElement("div",null,"Loading...")},p.a.createElement(Xl,{root:y.rootModel,onFactoryReset:Ul})):p.a.createElement(Fe.a,null)}));function td(e,t){if("object"===typeof e)for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n];"object"===typeof e[a]?td(e[a],t):"uri"===a&&(e.baseUri=t.href)}}var nd=function(e){return p.a.createElement(me.FatalErrorDialog,Object.assign({resetButtonText:"Reset Session",onFactoryReset:Ul},e))};t.default=function(e){var t=e.initialTimestamp;return p.a.createElement(fe.ErrorBoundary,{FallbackComponent:nd},p.a.createElement(pe.a,null,p.a.createElement(Zl,{initialTimestamp:t})))}},252:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(89),a=n(92),i=n(94),o=n(95),c=n(276),s=n(345),u=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a;if(Object(r.a)(this,n),(a=t.call(this,e)).stateModel=void 0,a.configSchema=void 0,a.displayTypes=[],a.stateModel=e.stateModel,a.configSchema=e.configSchema,!a.stateModel)throw new Error("no stateModel defined for track ".concat(a.name));if(!a.configSchema)throw new Error("no configSchema provided for track ".concat(a.name));if(!Object(s.getDefaultValue)(a.configSchema).type){var i=a.configSchema?a.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return a}return Object(a.a)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(c.a)},253:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(89),a=n(94),i=n(95),o=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e){var a;if(Object(r.a)(this,n),(a=t.call(this,e)).heading=void 0,a.configSchema=void 0,a.HeadingComponent=void 0,a.ReactComponent=void 0,a.stateModel=void 0,a.heading=e.heading,a.HeadingComponent=e.HeadingComponent,a.configSchema=e.configSchema,a.stateModel=e.stateModel,a.ReactComponent=e.ReactComponent,!a.ReactComponent)throw new Error("no ReactComponent defined for widget ".concat(a.name));if(!a.stateModel)throw new Error("no stateModel defined for widget ".concat(a.name));return a}return n}(n(276).a)},255:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c}));var r=n(2326),a=n(1),i=n.n(a);function o(e){return i.a.createElement(r.a,e,i.a.createElement("path",{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}))}function c(e){return i.a.createElement(r.a,e,i.a.createElement("path",{d:"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"}))}},276:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(89),a=function e(t){var n=t.name;Object(r.a)(this,e),this.name="",this.name=n}},283:function(e,t,n){"use strict";var r=n(154),a=n(90),i=n(82),o=n(1),c=n.n(o),s=n(51),u=n(2333),l=n(2360),d=n(2363),f=n(2355),p=n(2335),g=n(2364),m=n(2329),h=n(2332),b=n(2328),v=n(1016),y=n.n(v),w=n(1567),O=n.n(w),j=n(1568),k=n.n(j),x=n(1569),C=n.n(x),S=n(1017),T=n.n(S),E=n(83),R=Object(s.a)({paper:{position:"fixed",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",top:0,left:0,outline:0},menuItemEndDecoration:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",padding:2,marginRight:-12,display:"inline-flex"}});function M(e){var t,n,r,a=R(),i=e.type;if("checked"in e&&(t=e.checked,n=e.disabled),"subMenu"===i)r=c.a.createElement(y.a,{color:"action"});else if("checkbox"===i)if(t){var o=n?"inherit":"secondary";r=c.a.createElement(O.a,{color:o})}else r=c.a.createElement(k.a,{color:"action"});else if("radio"===i)if(t){var s=n?"inherit":"secondary";r=c.a.createElement(C.a,{color:s})}else r=c.a.createElement(T.a,{color:"action"});return c.a.createElement("div",{className:a.menuItemEndDecoration},r)}var P=c.a.forwardRef((function(e,t){var n=Object(o.useState)(),r=Object(i.a)(n,2),s=r[0],b=r[1],v=Object(o.useState)(),y=Object(i.a)(v,2),w=y[0],O=y[1],j=Object(o.useState)(!1),k=Object(i.a)(j,2),x=k[0],C=k[1],S=Object(o.useState)(),T=Object(i.a)(S,2),N=T[0],A=T[1],F=Object(o.useState)(),I=Object(i.a)(F,2),B=I[0],D=I[1],L=Object(o.useRef)(),V=R(),W=e.menuItems,z=e.onMenuItemClick,H=e.open,q=e.onClose,U=e.anchorEl,_=e.top,G=void 0!==_&&_;Object(o.useEffect)((function(){H||(b(void 0),O(void 0))}),[H]),Object(o.useEffect)((function(){var e,t=H&&Boolean(s);return t&&!x?e=setTimeout((function(){C(!0)}),300):!t&&x&&(e=setTimeout((function(){C(!1)}),300)),function(){clearTimeout(e)}}),[x,H,s]),Object(o.useEffect)((function(){if(U){var e=U.getBoundingClientRect();B&&e.top===B.top&&e.left+e.width===B.left||D({top:e.top,left:e.left+e.width})}else B||D({})}),[B,U]);var J=W.some((function(e){return"subMenu"in e||"checkbox"===e.type||"radio"===e.type})),X=W.some((function(e){return"icon"in e&&e.icon})),Y={};J&&(Y.paddingRight=48);var Q=c.a.createElement(c.a.Fragment,null,c.a.createElement(u.a,{autoFocusItem:H&&!x},W.sort((function(e,t){return(t.priority||0)-(e.priority||0)})).map((function(e,t){if("divider"===e.type)return c.a.createElement(l.a,{key:"divider-".concat(t),component:"li"});if("subHeader"===e.type)return c.a.createElement(d.a,{key:"subHeader-".concat(e.label,"-").concat(t)},e.label);var n=null,r=null;if(e.icon){var a=e.icon;n=c.a.createElement(f.a,null,c.a.createElement(a,null))}"subMenu"in e?r=c.a.createElement(M,{type:"subMenu"}):"checkbox"!==e.type&&"radio"!==e.type||(r=c.a.createElement(M,{type:e.type,checked:e.checked,disabled:e.disabled}));var i,o="onClick"in e?(i=e.onClick,function(e){z(e,i)}):void 0;return c.a.createElement(p.a,{key:e.label,style:Y,selected:t===N,onClick:o,onMouseMove:function(n){n.currentTarget!==document.activeElement&&(n.currentTarget.focus(),A(t)),"subMenu"in e?w!==t&&(b(n.currentTarget),O(t)):(b(void 0),O(void 0))},onKeyDown:function(n){if("ArrowLeft"===n.key||"Escape"===n.key)q&&q(n,"escapeKeyDown");else if("ArrowUp"===n.key)A(function(e,t){return Object(E.findLastIndex)(e.slice(0,t),(function(e){return"divider"!==e.type&&"subHeader"!==e.type&&!e.disabled}))}(W,t));else if("ArrowDown"===n.key){var r=function(e,t){var n=e.slice(t+1).findIndex((function(e){return"divider"!==e.type&&"subHeader"!==e.type&&!e.disabled}));return-1===n?n:t+1+n}(W,t);A(r)}else"subMenu"in e&&("ArrowRight"!==n.key&&"Enter"!==n.key||(b(n.currentTarget),O(t),C(!0)))},disabled:Boolean(e.disabled)},n,c.a.createElement(g.a,{primary:e.label,secondary:e.subLabel,inset:X&&!e.icon}),r)}))),W.map((function(e,t){var n=null;return"subMenu"in e&&(n=c.a.createElement(P,{key:e.label,anchorEl:s,open:x&&w===t,onClose:function(){C(!1),b(void 0)},onMenuItemClick:z,menuItems:e.subMenu})),n})));return G?Q:c.a.createElement(m.a,{in:H,style:{transformOrigin:"0 0 0"},ref:t},c.a.createElement(h.a,{elevation:8,ref:L,className:V.paper,style:Object(a.a)({},B)},Q))}));t.a=function(e){var t=e.open,n=e.onClose,a=e.menuItems,i=e.onMenuItemClick,o=Object(r.a)(e,["open","onClose","menuItems","onMenuItemClick"]);return c.a.createElement(b.a,Object.assign({transitionDuration:0,open:t,onClose:n,BackdropProps:{invisible:!0}},o),c.a.createElement(P,{open:t,onClose:n,menuItems:a,onMenuItemClick:i,top:!0}))}},287:function(e,t,n){"use strict";n.r(t),n.d(t,"parseCigar",(function(){return s})),n.d(t,"cigarToMismatches",(function(){return u})),n.d(t,"mdToMismatches",(function(){return l})),n.d(t,"getTemplateCoord",(function(){return d})),n.d(t,"getMismatches",(function(){return f})),n.d(t,"generateMD",(function(){return p})),n.d(t,"getNextRefPos",(function(){return g})),n.d(t,"getModificationPositions",(function(){return m})),n.d(t,"getModificationTypes",(function(){return h}));var r=n(82),a=n(719),i=n(88),o=n.n(i),c=o.a.mark(g);function s(e){return(e||"").split(/([MIDNSHPX=])/)}function u(e,t,n){for(var r=0,a=0,i=[],o=0;o<e.length-1;o+=2){var c=+e[o],s=e[o+1];if("M"!==s&&"="!==s&&"E"!==s||(a+=c),"I"===s)i.push({start:r,type:"insertion",base:"".concat(c),length:0}),a+=c;else if("D"===s)i.push({start:r,type:"deletion",base:"*",length:c});else if("N"===s)i.push({start:r,type:"skip",base:"N",length:c});else if("X"===s){for(var u=t.slice(a,a+c),l=(null===n||void 0===n?void 0:n.slice(a,a+c))||[],d=0;d<c;d++)i.push({start:r+d,type:"mismatch",base:u[d],qual:l[d],length:1});a+=c}else"H"===s?i.push({start:r,type:"hardclip",base:"H".concat(c),cliplen:c,length:1}):"S"===s&&(i.push({start:r,type:"softclip",base:"S".concat(c),cliplen:c,length:1}),a+=c);"I"!==s&&"S"!==s&&"H"!==s&&(r+=c)}return i}function l(e,t,n,r,a){var i=[],o={start:0,base:"",length:0,type:"mismatch"},c=n.filter((function(e){return"skip"===e.type})),s=0,u=0,l=0,d=0;function f(){i.push(o),o={start:o.start+o.length,length:0,base:"",type:"mismatch"}}function p(e){for(var n=u,r=l,a=s;a<t.length&&r<=e;s=a+=2){var i=+t[a],o=t[a+1];"S"===o||"I"===o?n+=i:"D"===o||"P"===o||"N"===o?r+=i:"H"!==o&&(n+=i,r+=i)}return u=n,l=r,n-(r-e)}for(var g=e.match(/(\d+|\^[a-z]+|[a-z])/gi)||[],m=0;m<g.length;m++){var h=g[m];if(h.match(/^\d/))o.start+=parseInt(h,10);else if(h.match(/^\^/))o.length=h.length-1,o.base="*",o.type="deletion",o.seq=h.substring(1),f();else if(h.match(/^[a-z]/i))for(var b=0;b<h.length;b+=1){for(o.length=1;d<c.length;){var v=c[d];if(!(o.start>=v.start))break;o.start+=v.length,d++}var y=t?p(o.start):o.start;o.base=r?r.substr(y,1):"X";var w=null===a||void 0===a?void 0:a.slice(y,y+1)[0];w&&(o.qual=w),o.altbase=h,f()}}return i}function d(e,t){for(var n=0,r=0,a=0;a<t.length&&r<=e;a+=2){var i=+t[a],o=t[a+1];"S"===o||"I"===o?n+=i:"D"===o||"P"===o?r+=i:"H"!==o&&(n+=i,r+=i)}return n-(r-e)}function f(e,t,n,r){var a=[],i=[];e&&(i=s(e),a=a.concat(u(i,n,r))),t&&(a=a.concat(l(t,i,a,n,r)));var o={};return a.filter((function(e){var t="".concat(e.type,",").concat(e.start,",").concat(e.length),n=o[t];return o[t]=!0,!n}))}function p(e,t,n){var r=0,a=0,i=0;if(!e)return console.warn("no ref supplied to generateMD"),"";for(var o=s(n),c="",u=0;u<o.length;u+=2){var l=+o[u],d=o[u+1];if("M"===d||"X"===d||"="===d){for(var f=0;f<l;f++)t[r+f].toLowerCase()!==e[a+f].toLowerCase()?(c+="".concat(i).concat(e[a+f].toUpperCase()),i=0):i++;r+=l,a+=l}else if("I"===d)r+=l;else if("D"===d){for(var p="",g=0;g<l;g++)p+=e[a+g].toUpperCase();c+="".concat(i,"^").concat(p),i=0,a+=l}else"N"===d?a+=l:"S"===d&&(r+=l)}return i>0&&(c+=i),c}function g(e,t){var n,r,a,i,s,u,l;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=0,r=0,a=0,i=0;case 4:if(!(i<t.length)){o.next=12;break}for(s=t[i];n<e.length&&r<s;n+=2)u=+e[n],"S"===(l=e[n+1])||"I"===l?r+=u:"D"===l||"N"===l?a+=u:"M"!==l&&"X"!==l&&"="!==l||(r+=u,a+=u);return o.next=9,t[i]-r+a;case 9:i++,o.next=4;break;case 12:case"end":return o.stop()}}),c)}function m(e,t){return e.split(";").filter((function(e){return!!e})).map((function(e){var n=e.split(","),i=Object(a.a)(n),o=i[0],c=i.slice(1),s=o.match(/([A-Z])([-+])([^,]+)/);if(!s)throw new Error("bad format for MM tag");var u=Object(r.a)(s,4),l=u[1],d=u[2],f=u[3].split(/(\d+|.)/).filter((function(e){return!!e}));return"-"===d?(console.warn("unsupported negative strand modifications"),{type:"unsupported",positions:[]}):f.map((function(e){var n=0;return{type:e,positions:c.map((function(e){return+e})).map((function(e){n++;do{"N"!==l&&l!==t[n]||e--,n++}while(e>=0&&n<t.length);return--n}))}}))})).flat()}function h(e){return e.split(";").filter((function(e){return!!e})).map((function(e){var t=e.split(","),n=Object(r.a)(t,1)[0].match(/([A-Z])([-+])([^,]+)/);if(!n)throw new Error("bad format for MM tag");return Object(r.a)(n,4)[3].split(/(\d+|.)/).filter((function(e){return!!e}))})).flat()}},309:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(89),a=n(92),i=n(94),o=n(95),c=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a;if(Object(r.a)(this,n),(a=t.call(this,e)).ReactComponent=void 0,a.stateModel=void 0,a.displayTypes=[],a.ReactComponent=e.ReactComponent,a.stateModel=e.stateModel,!a.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(a.name));if(!a.stateModel)throw new Error("no stateModel defined for view ".concat(a.name));return a}return Object(a.a)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(n(276).a)},312:function(e,t,n){"use strict";n.r(t),n.d(t,"isViewContainer",(function(){return o})),n.d(t,"isSessionModel",(function(){return c})),n.d(t,"isSessionModelWithConfigEditing",(function(){return s})),n.d(t,"isSessionModelWithWidgets",(function(){return u})),n.d(t,"isSessionWithSessionPlugins",(function(){return l})),n.d(t,"isSelectionContainer",(function(){return d})),n.d(t,"isViewModel",(function(){return f})),n.d(t,"isTrackModel",(function(){return p})),n.d(t,"isDisplayModel",(function(){return g})),n.d(t,"isTrackViewModel",(function(){return m})),n.d(t,"isAbstractMenuManager",(function(){return h}));var r=n(87),a=n(983);for(var i in a)["default","isViewContainer","isSessionModel","isSessionModelWithConfigEditing","isSessionModelWithWidgets","isSessionWithSessionPlugins","isSelectionContainer","isViewModel","isTrackModel","isDisplayModel","isTrackViewModel","isAbstractMenuManager"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);function o(e){return Object(r.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function c(e){return"object"===typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function s(e){return c(e)&&"editConfiguration"in e}function u(e){return c(e)&&"widgets"in e}function l(e){return c(e)&&"sessionPlugins"in e}function d(e){return"object"===typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function f(e){return"object"===typeof e&&null!==e&&"width"in e&&"setWidth"in e}function p(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function g(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function m(e){return"object"===typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function h(e){return"object"===typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}},334:function(e,t,n){"use strict";n.d(t,"a",(function(){return te})),n.d(t,"b",(function(){return ne})),n.d(t,"d",(function(){return re})),n.d(t,"c",(function(){return ae})),n.d(t,"e",(function(){return ie}));var r=n(88),a=n.n(r),i=n(91),o=n(106),c=n(82),s=n(102),u=n(90),l=n(81),d=n(153),f=n(114),p=n(83),g=n(688),m=n(1013),h=n(119),b=n(112),v=n(87),y=n(426),w=n(255),O=n(1641),j=n.n(O),k=n(700),x=n.n(k),C=n(1642),S=n.n(C),T=n(539),E=n.n(T),R=n(1632),M=n.n(R),P=n(698),N=n(604),A=n(1),F=n.n(A),I=n(51),B=n(2370),D=n(2373),L=n(2342),V=n(2374),W=n(63),z=n(2338),H=n(2353),q=n(2445),U=n(2337),_=n(134),G=n.n(_),J=Object(I.a)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function X(e){var t=e.model,n=e.handleClose,r=Object(A.useState)("undefined"!==typeof OffscreenCanvas),o=Object(c.a)(r,2),s=o[0],u=o[1],l=Object(A.useState)(!1),d=Object(c.a)(l,2),f=d[0],p=d[1],g=Object(A.useState)(),m=Object(c.a)(g,2),h=m[0],b=m[1],v=J();return F.a.createElement(B.a,{open:!0,onClose:n},F.a.createElement(D.a,null,"Export SVG",F.a.createElement(L.a,{className:v.closeButton,onClick:n},F.a.createElement(G.a,null))),F.a.createElement(V.a,null,h?F.a.createElement("div",{style:{color:"red"}},"".concat(h)):f?F.a.createElement("div",null,F.a.createElement(W.a,{size:20,style:{marginRight:20}}),F.a.createElement(z.a,{display:"inline"},"Creating SVG")):null,"undefined"!==typeof OffscreenCanvas?F.a.createElement(H.a,{control:F.a.createElement(q.a,{checked:s,onChange:function(){return u((function(e){return!e}))}}),label:"Rasterize canvas based tracks? File may be much larger if this is turned off"}):F.a.createElement(z.a,null,"Note: rasterizing layers not yet supported in this browser, so SVG size may be large"),F.a.createElement(U.a,{variant:"contained",color:"primary",type:"submit",onClick:Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),b(void 0),e.prev=2,e.next=5,t.exportSvg({rasterizeLayers:s});case 5:n(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),b(e.t0);case 11:return e.prev=11,p(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,8,11,14]])})))},"Submit")))}var Y=n(84),Q=n(2360),$=n(2376),K=Object(I.a)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));var Z=Object(Y.observer)((function(e){var t=e.model,n=e.handleClose,r=K();return F.a.createElement(B.a,{maxWidth:"xl",open:!0,onClose:n},F.a.createElement(D.a,null,"Reference sequence",n?F.a.createElement(L.a,{className:r.closeButton,onClick:function(){n()}},F.a.createElement(G.a,null)):null),F.a.createElement(Q.a,null),F.a.createElement(V.a,null,"Are you sure you want to return to the import form? This will lose your current view"),F.a.createElement($.a,null,F.a.createElement(U.a,{onClick:function(){t.clearView(),n()},variant:"contained",color:"primary",autoFocus:!0},"OK"),F.a.createElement(U.a,{onClick:function(){n()},color:"secondary",variant:"contained",autoFocus:!0},"Cancel")))}));function ee(e){if(!e.length)return"";var t=e.every((function(t){return t.assemblyName===e[0].assemblyName}));return e.map((function(e){return Object(p.assembleLocString)(Object(u.a)(Object(u.a)({},e),{},{start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))})).join(";")}var te=48,ne=20,re=17,ae=3;function ie(e){var t=v.types.model("LinearGenomeView",{id:f.ElementId,type:v.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:v.types.array(f.Region),tracks:v.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,trackSelectorType:v.types.optional(v.types.enumeration(["hierarchical"]),"hierarchical"),trackLabels:"overlapping",showCenterLine:!1}).volatile((function(){return{volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,error:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0}})).views((function(e){return{get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth}}})).views((function(e){return{get initialized(){var t=Object(p.getSession)(e).assemblyManager,n=this.assemblyNames.every((function(e){var n;return!(null===(n=t.assemblyList)||void 0===n?void 0:n.map((function(e){return e.name})).includes(e))||(t.get(e)||{}).initialized}));return void 0!==e.volatileWidth&&n},get hasDisplayedRegions(){return e.displayedRegions.length>0},get isSeqDialogDisplayed(){return e.leftOffset&&e.rightOffset},get scaleBarHeight(){return re+ae},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?te:te+ne},get trackHeights(){return e.tracks.map((function(e){return e.displays[0].height})).reduce((function(e,t){return e+t}),0)},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*ae},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get interRegionPaddingWidth(){return 2},get totalBp(){var t=0;return e.displayedRegions.forEach((function(e){t+=e.end-e.start})),t},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get maxOffset(){return this.displayedRegionsTotalPx-10},get displayedParentRegions(){var t=[],n=Object(p.getSession)(e).assemblyManager;return e.displayedRegions.forEach((function(e){var r=e.refName,a=e.assemblyName,i=n.get(a),o=i&&i.regions;if(o){var c=o.find((function(e){return e.refName===r})),s=t.find((function(e){return e.refName===r}));c&&!s&&t.push(c)}})),t},get displayedParentRegionsLength(){return this.displayedParentRegions.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get renderProps(){return Object(u.a)(Object(u.a)({},Object(h.getParentRenderProps)(e)),{},{bpPerPx:e.bpPerPx,highResolutionScaling:Object(l.getConf)(Object(p.getSession)(e),"highResolutionScaling")})},get assemblyNames(){return Object(s.a)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},parentRegion:function(e,t){return this.displayedParentRegions.find((function(n){return n.assemblyName===e&&n.refName===t}))},bpToPx:function(t){var n=t.refName,r=t.coord,a=t.regionNumber,i=0,o=this.interRegionPaddingWidth*e.bpPerPx,c=e.minimumBlockWidth*e.bpPerPx,s=e.displayedRegions.findIndex((function(t,s){var u=t.end-t.start;return n===t.refName&&r>=t.start&&r<=t.end&&(!a||a===s)?(i+=t.reversed?t.end-r:r-t.start,!0):(u>c&&i/e.bpPerPx>=0&&i/e.bpPerPx<e.width?i+=u+o:i+=u,!1)}));if(e.displayedRegions[s])return{index:s,offsetPx:Math.round(i/e.bpPerPx)}},pxToBp:function(t){var n=0,r=(e.offsetPx+t)*e.bpPerPx,a=e.displayedRegions.length;if(r<0){var i=e.displayedRegions[0],o=r;return Object(u.a)(Object(u.a)({},Object(v.getSnapshot)(i)),{},{oob:!0,coord:i.reversed?Math.floor(i.end-o)+1:Math.floor(i.start+o)+1,offset:o,index:0})}for(var c=this.interRegionPaddingWidth*e.bpPerPx,s=e.minimumBlockWidth*e.bpPerPx,l=0;l<e.displayedRegions.length;l+=1){var d=e.displayedRegions[l],f=d.end-d.start,p=r-n;if(f+n>r&&n<=r)return Object(u.a)(Object(u.a)({},Object(v.getSnapshot)(d)),{},{oob:!1,offset:p,coord:d.reversed?Math.floor(d.end-p)+1:Math.floor(d.start+p)+1,index:l});d.end-d.start>s&&p/e.bpPerPx>0&&p/e.bpPerPx<e.width?n+=f+c:n+=f}if(r>=n){var g=e.displayedRegions[a-1],m=r-n+(g.end-g.start);return Object(u.a)(Object(u.a)({},Object(v.getSnapshot)(g)),{},{oob:!0,offset:m,coord:g.reversed?Math.floor(g.end-m)+1:Math.floor(g.start+m)+1,index:a-1})}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}},getTrack:function(t){return e.tracks.find((function(e){return e.configuration.trackId===t}))},rewriteOnClicks:function(t,n){var r=this;n.forEach((function(n){if("subMenu"in n&&r.rewriteOnClicks(t,n.subMenu),"onClick"in n){var a=n.onClick;n.onClick=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.tracks.forEach((function(e){e.type===t&&a.apply(e,[e].concat(r))}))}}}))},get trackTypeActions(){var t=this,n=new Map;return e.tracks.forEach((function(e){if(!n.get(e.type)){var r=M()(e.viewMenuActions);t.rewriteOnClicks(e.type,r),n.set(e.type,r)}})),n},get centerLineInfo(){return e.displayedRegions.length?this.pxToBp(e.width/2):void 0}}})).actions((function(t){return{setWidth:function(e){t.volatileWidth=e},setError:function(e){t.error=e},toggleHeader:function(){t.hideHeader=!t.hideHeader},toggleHeaderOverview:function(){t.hideHeaderOverview=!t.hideHeaderOverview},scrollTo:function(e){var n=Object(p.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=n,n},zoomTo:function(e){var n=Object(p.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(n===t.bpPerPx)return n;var r=t.bpPerPx;if(t.bpPerPx=n,Math.abs(r-n)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),r;var a=t.width;return this.scrollTo(Math.round((t.offsetPx+a/2)*r/n-a/2)),n},setOffsets:function(e,n){t.leftOffset=e,t.rightOffset=n},setNewView:function(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip:function(){t.displayedRegions=Object(v.cast)(t.displayedRegions.slice().reverse().map((function(e){return Object(u.a)(Object(u.a)({},e),{},{reversed:!e.reversed})}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=Object(v.resolveIdentifier)(a,Object(v.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),l=i.displays.find((function(e){return s.includes(e.type)}));if(!l)throw new Error("could not find a compatible display for view type ".concat(t.type));var d=o.stateModel.create(Object(u.a)(Object(u.a)({},r),{},{type:i.type,configuration:i,displays:[{type:l.type,configuration:l}]}));return t.tracks.push(d),d},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(v.resolveIdentifier)(r,Object(v.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return Object(b.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length}}})).actions((function(e){return{moveTrack:function(t,n){var r=e.tracks.findIndex((function(e){return e.id===t}));if(-1===r)throw new Error("Track ID ".concat(t," not found"));var a=e.tracks.findIndex((function(e){return e.id===n}));if(-1===a)throw new Error("Track ID ".concat(n," not found"));var i=Object(v.getSnapshot)(e.tracks[r]);e.tracks.splice(r,1),e.tracks.splice(a,0,i)},closeView:function(){var t=Object(p.getContainingView)(e);t?Object(p.isViewContainer)(t)&&t.removeView(e):Object(p.getSession)(e).removeView(e)},toggleTrack:function(t){e.hideTrack(t)||e.showTrack(t)},setTrackLabels:function(t){e.trackLabels=t},toggleCenterLine:function(){e.showCenterLine=!e.showCenterLine},setDisplayedRegions:function(t){e.displayedRegions=Object(v.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===e.trackSelectorType){var t=Object(p.getSession)(e);if(Object(p.isSessionModelWithWidgets)(t)){var n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},navToLocString:function(t,n){var r=Object(p.getSession)(e).assemblyManager,a=r.isValidRefName,i=t.split(";");if(e.displayedRegions.length>1){var o=i.map((function(e){return Object(p.parseLocString)(e,a)}));this.navToMultiple(o)}else{var c=n,s="";0!==e.displayedRegions.length&&(c=e.displayedRegions[0].assemblyName,s=e.displayedRegions[0].refName);var l=c&&r.get(c);if(!l)throw new Error("Could not find assembly ".concat(c));var d=l.regions;if(!d)throw new Error("Regions for assembly ".concat(c," not yet loaded"));if(i.length>1)throw new Error("Navigating to multiple locations is not allowed when viewing a whole chromosome");var f=Object(p.parseLocString)(i[0],(function(e){return a(e,c)})),g=!1;if(f.assemblyName&&f.assemblyName!==c){var m=r.get(f.assemblyName);if(!m)throw new Error("Could not find assembly ".concat(f.assemblyName));l=m,g=!0;var h=m.regions;if(!h)throw new Error("Regions for assembly ".concat(f.assemblyName," not yet loaded"));d=h}var b=l.getCanonicalRefName(f.refName);if(!b)throw new Error("Could not find refName ".concat(f.refName," in ").concat(l.name));if(g||b!==s){var y=d.find((function(e){return e.refName===b}));if(!y)throw new Error("Could not find refName ".concat(f.refName," in ").concat(l.name));this.setDisplayedRegions([Object(v.getSnapshot)(y)])}var w=d.find((function(e){return e.refName===b}));if(w){var O,j,k=Object(p.clamp)(null!==(O=null===f||void 0===f?void 0:f.start)&&void 0!==O?O:0,0,w.end),x=Object(p.clamp)(null!==(j=null===f||void 0===f?void 0:f.end)&&void 0!==j?j:w.end,0,w.end);this.navTo(Object(u.a)(Object(u.a)({},f),{},{start:k,end:x}))}}},navTo:function(e){this.navToMultiple([e])},navToMultiple:function(t){var n=t[0],r=n.refName,a=n.start,i=n.end,o=n.assemblyName,c=void 0===o?e.assemblyNames[0]:o;if(void 0!==a&&void 0!==i&&a>i)throw new Error('start "'.concat(a+1,'" is greater than end "').concat(i,'"'));var s=Object(p.getSession)(e).assemblyManager.get(c);if(s){var u=s.getCanonicalRefName(r);u&&(r=u)}for(var l,d=a,f=i,g=!1,m=function(e){if(r===e.refName){if(g=!0,void 0===d&&(d=e.start),void 0===f&&(f=e.end),d>=e.start&&d<=e.end&&f<=e.end&&f>=e.start)return!0;d=a,f=i}return!1},h=Object(p.findLastIndex)(e.displayedRegions,m);l!==h;)try{var b=l;if(l=e.displayedRegions.slice(void 0===b?0:b+1).findIndex(m),void 0!==b&&(l+=b+1),!g)throw new Error('could not find a region with refName "'.concat(r,'"'));if(void 0===d)throw new Error('could not find a region with refName "'.concat(r,'" that contained an end position ').concat(f));if(void 0===f)throw new Error('could not find a region with refName "'.concat(r,'" that contained a start position ').concat(d+1));if(-1===l)throw new Error('could not find a region that completely contained "'.concat(Object(p.assembleLocString)(n),'"'));if(1===t.length){var v=e.displayedRegions[l];return void this.moveTo({index:l,offset:v.reversed?v.end-f:d-v.start},{index:l,offset:v.reversed?v.end-d:f-v.start})}for(var y=0,w=0,O=0;y<t.length;y++){var j=t[y],k=e.displayedRegions[l+y];if(w=j.start||k.start,O=j.end||k.end,j.refName!==k.refName)throw new Error("Entered location ".concat(Object(p.assembleLocString)(j)," does not match with displayed regions"));if(y>0)if(!(k.reversed?O===k.end:w===k.start))throw new Error("".concat(k.reversed?"End":"Start"," of region ").concat(Object(p.assembleLocString)(j)," should be ").concat((k.reversed?k.end:k.start+1).toLocaleString("en-US"),", but it is not"));if(!(y===t.length-1))if(!(k.reversed?w===k.start:O===k.end))throw new Error("".concat(k.reversed?"Start":"End"," of region ").concat(Object(p.assembleLocString)(j)," should be ").concat((k.reversed?k.start+1:k.end).toLocaleString("en-US"),", but it is not"))}y-=1;var x=e.displayedRegions[l],C=e.displayedRegions[l+y];return void this.moveTo({index:l,offset:x.reversed?x.end-f:d-x.start},{index:l+y,offset:C.reversed?C.end-w:O-C.start})}catch(S){if(l===h)throw S}},zoomToDisplayedRegions:function(t,n){if(void 0!==t&&void 0!==n){if(t.refName===n.refName&&t.index===n.index&&n.offset<t.offset||t.index>n.index){var r=[n,t];t=r[0],n=r[1]}var a={start:t.start,end:t.end,index:t.index,offset:t.offset},i={start:n.start,end:n.end,index:n.index,offset:n.offset};if(a&&i)this.moveTo(a,i);else Object(p.getSession)(e).notify("No regions found to navigate to","warning")}},getSelectedRegions:function(t,n){var r=y.a.create(Object(u.a)(Object(u.a)({},Object(v.getSnapshot)(e)),{},{interRegionPaddingWidth:e.interRegionPaddingWidth}));return r.setVolatileWidth(e.width),r.zoomToDisplayedRegions(t,n),r.dynamicBlocks.contentBlocks.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},afterDisplayedRegionsSet:function(t){e.afterDisplayedRegionsSetCallbacks.push(t)},moveTo:function(t,n){var r=0;if(t.index===n.index)r+=n.offset-t.offset;else{var a=e.displayedRegions[t.index];if(r+=a.end-a.start-t.offset,n.index-t.index>=2)for(var i=t.index+1;i<n.index;i+=1)r+=e.displayedRegions[i].end-e.displayedRegions[i].start;r+=n.offset}var o=r/(e.width-e.interRegionPaddingWidth*(n.index-t.index)),c=e.zoomTo(o),s=0;o<c&&(s=(c-o)*e.width/2);for(var u=-s,l=0;l<e.displayedRegions.length;l+=1){var d=e.displayedRegions[l];if(t.index===l){u+=t.offset;break}u+=d.end-d.start}e.scrollTo(Math.round(u/e.bpPerPx)+e.interRegionPaddingWidth*t.index)},horizontalScroll:function(t){var n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},centerAt:function(t,n,r){var a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},center:function(){var t=e.totalBp/2;e.scrollTo(Math.round(t/e.bpPerPx-e.width/2))},showAllRegions:function(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly:function(t){var n=Object(p.getSession)(e),r=n.assemblyManager;if(!t){var a=Object(s.a)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))));if(a.length>1)return void n.notify("Can't perform this with multiple assemblies currently");t=Object(c.a)(a,1)[0]}var i=r.get(t);if(i){var o=Object(v.getSnapshot)(i).regions;o&&(this.setDisplayedRegions(o),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId:function(t){e.draggingTrackId=t},setScaleFactor:function(t){e.scaleFactor=t}}})).actions((function(e){var t=function(){};return{slide:function(n){var r=Object(p.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo),a=Object(c.a)(r,2),i=a[0],o=a[1];t(),t=o,i()}}})).actions((function(e){var t=function(){};return{zoom:function(n){if(e.zoomTo(e.bpPerPx),!(n<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||n>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)){var r=e.bpPerPx/n,a=Object(p.springAnimate)(1,r,e.setScaleFactor,(function(){e.zoomTo(n),e.setScaleFactor(1)})),i=Object(c.a)(a,2),o=i[0],s=i[1];t(),t=s,o()}}}})).views((function(e){var t,n="";return{get menuItems(){var t,n=[{label:"Return to import form",onClick:function(){Object(p.getSession)(e).setDialogComponent(Z,{model:e})},icon:E.a},{label:"Export SVG",onClick:function(){Object(p.getSession)(e).setDialogComponent(X,{model:e})}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:w.b},{label:"Horizontally flip",icon:j.a,onClick:e.horizontallyFlip},{label:"Show all regions in assembly",icon:x.a,onClick:e.showAllRegionsInAssembly},{label:"Show center line",icon:x.a,type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{type:"divider"},{label:"Show header",icon:x.a,type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",icon:x.a,type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Track labels",icon:S.a,subMenu:[{label:"Overlapping",icon:x.a,type:"radio",checked:"overlapping"===e.trackLabels,onClick:function(){return e.setTrackLabels("overlapping")}},{label:"Offset",icon:x.a,type:"radio",checked:"offset"===e.trackLabels,onClick:function(){return e.setTrackLabels("offset")}},{label:"Hidden",icon:x.a,type:"radio",checked:"hidden"===e.trackLabels,onClick:function(){return e.setTrackLabels("hidden")}}]}],r=Object(o.a)(e.trackTypeActions.entries());try{for(r.s();!(t=r.n()).done;){var a=Object(c.a)(t.value,2),i=a[0],s=a[1];s.length&&(n.push({type:"divider"},{type:"subHeader",label:i}),s.forEach((function(e){n.push(e)})))}}catch(u){r.e(u)}finally{r.f()}return n},get staticBlocks(){var r=Object(m.a)(e),a=JSON.stringify(r);return n!==a&&(t=r,n=a),t},get dynamicBlocks(){return Object(g.a)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},get visibleLocStrings(){return ee(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return ee(e.coarseDynamicBlocks)}}})).actions((function(e){return{clearView:function(){e.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setCoarseDynamicBlocks:function(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach:function(){var t=this;Object(v.addDisposer)(e,Object(b.autorun)((function(){e.initialized&&t.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150}))}}})).actions((function(e){return{exportSvg:function(){var t=arguments;return Object(i.a)(a.a.mark((function n(){var r,i,o;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:{},n.next=3,Object(N.renderToSvg)(e,r);case 3:i=n.sent,o=new Blob([i],{type:"image/svg+xml"}),Object(P.saveAs)(o,"image.svg");case 6:case"end":return n.stop()}}),n)})))()}}}));return v.types.compose(d.BaseViewModel,t)}},335:function(e,t,n){"use strict";n.d(t,"b",(function(){return b})),n.d(t,"a",(function(){return v}));var r=n(411),a=n(82),i=n(90),o=n(87),c=n(114),s=n(517);var u={stringArray:o.types.array(o.types.string),stringArrayMap:o.types.map(o.types.array(o.types.string)),numberMap:o.types.map(o.types.number),boolean:o.types.boolean,color:o.types.refinement("Color",o.types.string,(function(){return!0})),integer:o.types.integer,number:o.types.number,string:o.types.string,text:o.types.string,fileLocation:c.FileLocation,frozen:o.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt"},frozen:{}},d=function(e){return{views:{get valueJSON(){return e.value}}}},f=function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}}}},p={fileLocation:f,number:d,integer:d,boolean:d,frozen:f,stringArray:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t){e.value.push(t)},removeAtIndex:function(t){e.value.splice(t,1)},setAtIndex:function(t,n){e.value[t]=n}}}},stringArrayMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)},addToKey:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.push(n)},removeAtKeyIndex:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.splice(n,1)},setAtKeyIndex:function(t,n,r){var a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a[n]=r}}}},numberMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)}}}}},g=o.types.refinement("JexlString",o.types.string,(function(e){return e.startsWith("jexl:")}));var m=n(678);function h(e,t,n){var d,f={};if(n.explicitlyTyped&&(f.type=o.types.optional(o.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error("Cannot have both explicit and implicit identifiers in ".concat(e));n.explicitIdentifier?"string"===typeof n.explicitIdentifier?(f[n.explicitIdentifier]=o.types.identifier,d=n.explicitIdentifier):(f.id=o.types.identifier,d="id"):n.implicitIdentifier&&("string"===typeof n.implicitIdentifier?(f[n.implicitIdentifier]=c.ElementId,d=n.implicitIdentifier):(f.id=c.ElementId,d="id"));var h={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};Object.entries(t).forEach((function(t){var n=Object(a.a)(t,2),r=n[0],i=n[1];if(Object(o.isType)(i)&&Object(o.isLateType)(i)||Object(m.e)(i))f[r]=i;else if("string"===typeof i||"number"===typeof i)h[r]=i;else{if("object"!==typeof i)throw new Error('invalid configuration schema definition, "'.concat(r,'" must be either a valid configuration slot definition, a constant, or a nested configuration schema'));if(!i.type)throw new Error("no type set for config slot ".concat(e,".").concat(r));try{f[r]=function(e,t){var n=t.description,r=void 0===n?"":n,a=t.model,i=t.type,c=t.defaultValue,d=t.contextVariable,f=void 0===d?[]:d;if(!i)throw new Error("type name required");if(a||(a=u[i]),!a)throw new Error('no builtin config slot type "'.concat(i,"\", and no 'model' param provided"));if(void 0===c)throw new Error("no 'defaultValue' provided");var m="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1),"ConfigSlot"),h=o.types.model(m,{name:o.types.literal(e),description:o.types.literal(r),type:o.types.literal(i),value:o.types.optional(o.types.union(g,a),c)}).volatile((function(){return{contextVariable:f}})).views((function(e){return{get isCallback(){return String(e.value).startsWith("jexl:")}}})).views((function(e){return{get expr(){if(e.isCallback){var t=Object(o.getEnv)(e).pluginManager;return t||"undefined"!==typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),Object(s.a)(String(e.value),null===t||void 0===t?void 0:t.jexl)}return{evalSync:function(){return e.value}}},get valueJSON(){var t;if(!e.isCallback)return(t=e.value)&&t.toJSON?t.toJSON():'"'.concat(t,'"')}}})).preProcessSnapshot((function(t){return"object"===typeof t&&t.name===e?t:{name:e,description:r,type:i,value:t}})).postProcessSnapshot((function(e){return"object"===typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0})).actions((function(e){return{set:function(t){e.value=t},reset:function(){e.value=c},convertToCallback:function(){e.isCallback||(e.value="jexl:".concat(e.valueJSON||"''"))},convertToValue:function(){if(e.isCallback){try{var t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(n){}if(e.value=c,e.isCallback){if(!(i in l))throw new Error("no fallbackDefault defined for type ".concat(i));e.value=l[i]}}}}}));p[i]&&(h=h.extend(p[i]));var b=o.types.optional(h,{name:e,type:i,description:r,value:c});return Object.defineProperty(b,"isJBrowseConfigurationSlot",{value:!0}),b}(r,i)}catch(c){throw new Error("invalid config slot definition for ".concat(e,".").concat(r,": ").concat(c.message))}}}));var b=o.types.model("".concat(e,"ConfigurationSchema"),f).actions((function(e){return{setSubschema:function(t,n){if(!Object(m.e)(f[t]))throw new Error("".concat(t," is not a subschema, cannot replace"));var r=Object(o.isStateTreeNode)(n)?n:f[t].create(n);return e[t]=r,r}}}));Object.keys(h).length&&(b=b.volatile((function(){return h}))),n.actions&&(b=b.actions(n.actions)),n.views&&(b=b.views(n.views)),n.extend&&(b=b.extend(n.extend)),b=b.postProcessSnapshot((function(e){var t={};return Object.entries(e).forEach((function(e){var n,r=Object(a.a)(e,2),i=r[0],o=r[1];void 0!==o&&void 0===h[i]&&("object"!==typeof(n=o)||Array.isArray(n)||null===n||0!==Object.keys(n).length)&&!function(e){return Array.isArray(e)&&0===e.length}(o)&&(t[i]=o)})),t})),n.preProcessSnapshot&&(b=b.preProcessSnapshot(n.preProcessSnapshot));var v=d?Object(r.a)({},d,"placeholderId"):{};return o.types.optional(b,n.explicitlyTyped?Object(i.a)({type:e},v):v)}function b(e,t,n){var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!==typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");var r=t,a=n;return n.baseConfiguration&&n.baseConfiguration.jbrowseSchemaDefinition&&(r=Object(i.a)(Object(i.a)({},n.baseConfiguration.jbrowseSchemaDefinition),r),delete(a=Object(i.a)(Object(i.a)({},n.baseConfiguration.jbrowseSchemaOptions||{}),n)).baseConfiguration),{schemaDefinition:r,options:a}}(e,t,n),a=r.schemaDefinition,o=r.options,c=h(e,a,o);return c.isJBrowseConfigurationSchema=!0,c.jbrowseSchemaDefinition=a,c.jbrowseSchemaOptions=o,c}function v(e){return o.types.union(o.types.reference(e),e)}},336:function(e,t,n){"use strict";n.r(t),n.d(t,"namedColorToHex",(function(){return i})),n.d(t,"isNamedColor",(function(){return o})),n.d(t,"contrastingTextColor",(function(){return c})),n.d(t,"emphasize",(function(){return u})),n.d(t,"makeContrasting",(function(){return l}));var r=n(226),a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(e){return a[e]}function o(e){return!!a[e]}function c(e){return s(e)>.5?"black":"white"}function s(e){var t=i(e);return Object(r.getLuminance)(t||e)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15,n=i(e);return Object(r.emphasize)(n||e,t)}function l(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"white",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=i(e)||e,o=i(t)||t,c=s(o),u=Object(r.getContrastRatio)(a,o),l=a,d=.05;u<n;)a=c>.5?Object(r.darken)(l,d):Object(r.lighten)(l,d),d+=.05,u=Object(r.getContrastRatio)(a,o);return a}},345:function(e,t,n){"use strict";n.r(t),n.d(t,"getSubType",(function(){return a})),n.d(t,"getUnionSubTypes",(function(){return i})),n.d(t,"getPropertyType",(function(){return o})),n.d(t,"getDefaultValue",(function(){return c})),n.d(t,"getEnumerationValues",(function(){return s})),n.d(t,"resolveLateType",(function(){return u}));var r=n(87);function a(e){var t;if(Object(r.isOptionalType)(e))t=e._subtype||e.type;else{if(!Object(r.isArrayType)(e)&&!Object(r.isMapType)(e)){if("function"===typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function i(e){if(!Object(r.isUnionType)(e))throw new TypeError("not an MST union type");var t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function o(e,t){return e.properties[t]}function c(e){if(!Object(r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function s(e){return i(e).map((function(e){return e.value}))}function u(e){return Object(r.isUnionType)(e)||Object(r.isArrayType)(e)||!Object(r.isLateType)(e)?e:e.getSubType()}},354:function(e,t,n){"use strict";function r(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}function a(e,t,n,r){return t>n&&e<r}function i(e,t,n,r){return n<=e&&r>=t}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i}))},355:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return f}));var r=n(94),a=n(95),i=n(90),o=n(89),c=n(92),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(o.a)(this,e),this.blocks=[],this.blocks=t}return Object(c.a)(e,[{key:"push",value:function(e){if(e instanceof d&&this.blocks.length){var t=this.blocks[this.blocks.length-1];if(t instanceof d)return void t.push(e)}this.blocks.push(e)}},{key:"getBlocks",value:function(){return this.blocks}},{key:"getRegions",value:function(){return this.blocks.map((function(e){return e.toRegion()}))}},{key:"map",value:function(e,t){return this.blocks.map(e,t)}},{key:"forEach",value:function(e,t){return this.blocks.forEach(e,t)}},{key:"length",get:function(){return this.blocks.length}},{key:"totalWidthPx",get:function(){return this.blocks.length?this.blocks.map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"totalWidthPxWithoutBorders",get:function(){return this.blocks.length?this.blocks.filter((function(e){return"boundary"!==e.variant})).map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"offsetPx",get:function(){return this.blocks.length?this.blocks[0].offsetPx:0}},{key:"contentBlocks",get:function(){return this.blocks.filter((function(e){return e instanceof l}))}},{key:"totalBp",get:function(){return this.contentBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}]),e}(),u=function(){function e(t){Object(o.a)(this,e),this.refName=void 0,this.start=void 0,this.end=void 0,this.assemblyName=void 0,this.key=void 0,this.offsetPx=void 0,Object.assign(this,t),this.assemblyName=t.assemblyName,this.refName=t.refName,this.start=t.start,this.end=t.end,this.key=t.key,this.offsetPx=t.offsetPx}return Object(c.a)(e,[{key:"renameReference",value:function(e){return this.refName&&e!==this.refName?new this.constructor(Object(i.a)(Object(i.a)({},this),{},{refName:e})):this}},{key:"toRegion",value:function(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}]),e}(),l=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return n}(u),d=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).widthPx=void 0,r.widthPx=e.widthPx,r}return Object(c.a)(n,[{key:"push",value:function(e){this.elidedBlockCount+=1,e&&(this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx)}}]),n}(u),f=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return n}(u)},426:function(e,t,n){"use strict";var r=n(90),a=n(87),i=n(83),o=n(114),c=n(688),s=n(1013),u=a.types.model("Base1DView",{displayedRegions:a.types.array(o.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:a.types.optional(a.types.number,0),minimumBlockWidth:a.types.optional(a.types.number,0)}).volatile((function(){return{features:void 0,volatileWidth:0}})).actions((function(e){return{setDisplayedRegions:function(t){e.displayedRegions=Object(a.cast)(t)},setBpPerPx:function(t){e.bpPerPx=t},setVolatileWidth:function(t){e.volatileWidth=t}}})).views((function(e){return{get width(){return e.volatileWidth},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return e.displayedRegions.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},bpToPx:function(t){var n=this,r=t.refName,a=t.coord,i=t.regionNumber,o=0,c=e.interRegionPaddingWidth*e.bpPerPx,s=e.minimumBlockWidth*e.bpPerPx,u=e.displayedRegions.findIndex((function(t,u){var l=t.end-t.start;return r===t.refName&&a>=t.start&&a<=t.end&&(!i||i===u)?(o+=t.reversed?t.end-a:a-t.start,!0):(t.end-t.start>s&&o/e.bpPerPx>0&&o/e.bpPerPx<n.width?o+=l+c:o+=l,!1)}));if(e.displayedRegions[u])return Math.round(o/e.bpPerPx)},pxToBp:function(t){var n=0,i=(e.offsetPx+t)*e.bpPerPx,o=e.displayedRegions.length;if(i<0){var c=e.displayedRegions[0],s=i;return Object(r.a)(Object(r.a)({},Object(a.getSnapshot)(c)),{},{oob:!0,coord:c.reversed?Math.floor(c.end-s)+1:Math.floor(c.start+s)+1,offset:s,index:0})}for(var u=e.interRegionPaddingWidth*e.bpPerPx,l=e.minimumBlockWidth*e.bpPerPx,d=0;d<e.displayedRegions.length;d+=1){var f=e.displayedRegions[d],p=f.end-f.start,g=i-n;if(p+n>i&&n<=i)return Object(r.a)(Object(r.a)({},Object(a.getSnapshot)(f)),{},{oob:!1,offset:g,coord:f.reversed?Math.floor(f.end-g)+1:Math.floor(f.start+g)+1,index:d});f.end-f.start>l&&g/e.bpPerPx>0&&g/e.bpPerPx<this.width?n+=p+u:n+=p}if(i>=n){var m=e.displayedRegions[o-1],h=i-n+(m.end-m.start);return Object(r.a)(Object(r.a)({},Object(a.getSnapshot)(m)),{},{oob:!0,offset:h,coord:m.reversed?Math.floor(m.end-h)+1:Math.floor(m.start+h)+1,index:o-1})}return{coord:0,index:0,start:0,refName:"",oob:!0,assemblyName:"",offset:0,reversed:!1}}}})).views((function(e){return{get dynamicBlocks(){return Object(c.a)(e)},get staticBlocks(){return Object(s.a)(e)},get currBp(){return this.dynamicBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}})).actions((function(e){return{setFeatures:function(t){e.features=t},zoomToDisplayedRegions:function(e,t){if(void 0!==e&&void 0!==t){if(e.refName===t.refName&&e.index===t.index&&t.offset<e.offset||e.index>t.index){var n=[t,e];e=n[0],t=n[1]}var r={start:e.start,end:e.end,index:e.index,offset:e.offset},a={start:t.start,end:t.end,index:t.index,offset:t.offset};if(!r||!a)throw new Error("regions not found");this.moveTo(r,a)}},showAllRegions:function(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},moveTo:function(t,n){var r=0;if(t.index===n.index)r+=n.offset-t.offset;else{var a=e.displayedRegions[t.index];if(r+=a.end-a.start-t.offset,n.index-t.index>=2)for(var i=t.index+1;i<n.index;i+=1)r+=e.displayedRegions[i].end-e.displayedRegions[i].start;r+=n.offset}this.zoomTo(r/(e.width-e.interRegionPaddingWidth*(n.index-t.index)));for(var o=0,c=0;c<e.displayedRegions.length;c+=1){var s=e.displayedRegions[c];if(t.index===c){o+=t.offset;break}o+=s.end-s.start}e.offsetPx=Math.round(o/e.bpPerPx)+e.interRegionPaddingWidth*t.index},zoomOut:function(){this.zoomTo(2*e.bpPerPx)},zoomIn:function(){this.zoomTo(e.bpPerPx/2)},zoomTo:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.width/2,r=t;if(r!==e.bpPerPx){var a=e.bpPerPx;e.bpPerPx=r,e.offsetPx=Object(i.clamp)(Math.round((e.offsetPx+n)*a/r-n),e.minOffset,e.maxOffset)}},scroll:function(t){var n=e.offsetPx,r=Object(i.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}}}));t.a=u},474:function(e,t,n){"use strict";n.d(t,"a",(function(){return T})),n.d(t,"b",(function(){return E}));var r=n(82),a=n(88),i=n.n(a),o=n(91),c=n(90),s=n(206),u=n(167),l=n(94),d=n(95),f=n(89),p=n(92),g=n(693),m=n.n(g),h=n(106),b=n(112),v=n(83),y=1e4;function w(e,t,n,r){return t>=n&&r>=e}var O=function(){function e(){Object(f.a)(this,e),this.padding=void 0,this.allFilled=void 0,this.widthLimit=void 0,this.rowState=void 0,this.padding=1,this.widthLimit=1e6}return Object(p.a)(e,[{key:"setAllFilled",value:function(e){this.allFilled=e}},{key:"getItemAt",value:function(e){if(this.allFilled)return this.allFilled;if(this.rowState&&void 0!==this.rowState.min&&!(e<this.rowState.min)&&!(e>=this.rowState.max)){var t=e-this.rowState.offset;return this.rowState.bits[t]}}},{key:"isRangeClear",value:function(e,t){if(this.allFilled)return!1;if(!this.rowState)return!0;var n=this.rowState,r=n.min,a=n.max;if(t<=r||e>=a)return!0;for(var i=Math.min(a,t),o=Math.max(r,e);o<t&&o<i;o+=1)if(this.getItemAt(o))return!1;return!0}},{key:"initialize",value:function(e,t){var n=t-e;return{offset:e-n,min:e,max:t,bits:new Array(3*n)}}},{key:"addRect",value:function(e,t){var n=e.l,r=e.r+this.padding;this.rowState||(this.rowState=this.initialize(n,r));var a=n-this.rowState.offset,i=r-this.rowState.offset,o=this.rowState.bits.length;if(i>=this.rowState.bits.length){var c=i+1;this.rowState.bits.length+c>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):c>0&&(this.rowState.bits=this.rowState.bits.concat(new Array(c)))}if(n<this.rowState.offset){var s=Math.min(o-a,this.rowState.offset);this.rowState.bits.length+s>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):(this.rowState.bits=new Array(s).concat(this.rowState.bits),this.rowState.offset-=s)}(i=r-this.rowState.offset)-(a=n-this.rowState.offset)>2e4&&console.warn("Layout X pitch set too low, feature spans ".concat(i-a," bits in a single row."),e,t);for(var u=a;u<i;u+=1)this.rowState.bits[u]=t;n<this.rowState.min&&(this.rowState.min=n),r>this.rowState.max&&(this.rowState.max=r)}},{key:"discardRange",value:function(e,t){if(!this.allFilled&&this.rowState&&!(t<=this.rowState.min||e>=this.rowState.max))if(e<=this.rowState.min&&t>=this.rowState.max)this.rowState=void 0;else{if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-y&&this.rowState.bits.length>this.rowState.max+y-this.rowState.offset){var n=this.rowState.min-this.rowState.offset,r=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(n,this.rowState.bits.length-r),this.rowState.offset+=n}else if(this.rowState.offset<this.rowState.min-y){var a=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,a),this.rowState.offset+=a}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+y){var i=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=i}for(var o=Math.max(this.rowState.min,e)-this.rowState.offset,c=Math.min(t,this.rowState.max)-this.rowState.offset,s=o;s>=0&&s<c;s+=1)this.rowState.bits[s]=void 0}}}]),e}(),j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pitchX,r=void 0===n?10:n,a=t.pitchY,i=void 0===a?10:a,o=t.maxHeight,c=void 0===o?1e4:o,s=t.hardRowLimit,u=void 0===s?3e3:s,l=t.displayMode,d=void 0===l?"normal":l;Object(f.a)(this,e),this.pitchX=void 0,this.pitchY=void 0,this.hardRowLimit=void 0,this.bitmap=void 0,this.rectangles=void 0,this.maxHeightReached=void 0,this.maxHeight=void 0,this.displayMode=void 0,this.pTotalHeight=void 0,this.pitchX=r,this.pitchY=i,this.hardRowLimit=u,this.maxHeightReached=!1,this.displayMode=d,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new b.ObservableMap,this.maxHeight=Math.ceil(c/this.pitchY),this.pTotalHeight=0}return Object(p.a)(e,[{key:"addRect",value:function(e,t,n,r,a){var i=this.rectangles.get(e);if(i)return null===i.top?null:(this.addRectToBitmap(i),i.top*this.pitchY);var o=Math.floor(t/this.pitchX),c=Math.floor(n/this.pitchX),s=Math.ceil(r/this.pitchY),u={id:e,l:o,r:c,top:null,h:s,originalHeight:r,data:a},l=this.maxHeight-s,d=0;if("collapse"!==this.displayMode){for(;d<=l&&this.collides(u,d);d+=1);if(d>l)return u.top=null,this.rectangles.set(e,u),this.maxHeightReached=!0,null}return u.top=d,this.addRectToBitmap(u),this.rectangles.set(e,u),this.pTotalHeight=Math.max(this.pTotalHeight||0,d+s),d*this.pitchY}},{key:"collides",value:function(e,t){for(var n=this.bitmap,r=t+e.h,a=t;a<r;a+=1){var i=n[a];if(i&&!i.isRangeClear(e.l,e.r))return!0}return!1}},{key:"autovivifyRow",value:function(e,t){var n=e[t];if(!n){if(t>this.hardRowLimit)throw new Error("layout hard limit (".concat(this.hardRowLimit*this.pitchY,"px) exceeded, aborting layout"));n=new O,e[t]=n}return n}},{key:"addRectToBitmap",value:function(e){if(null!==e.top){var t=e.data||!0,n=this.bitmap,r=e.top+e.h;if(e.r-e.l>2e4)for(var a=e.top;a<r;a+=1)this.autovivifyRow(n,a).setAllFilled(t);else for(var i=e.top;i<r;i+=1)this.autovivifyRow(n,i).addRect(e,t)}}},{key:"discardRange",value:function(e,t){for(var n=Math.floor(e/this.pitchX),r=Math.floor(t/this.pitchX),a=this.bitmap,i=0;i<a.length;i+=1){var o=a[i];o&&o.discardRange(n,r)}}},{key:"hasSeen",value:function(e){return this.rectangles.has(e)}},{key:"getByCoord",value:function(e,t){var n=Math.floor(t/this.pitchY),r=this.bitmap[n];if(r){var a=Math.floor(e/this.pitchX);return r.getItemAt(a)}}},{key:"getByID",value:function(e){var t=this.rectangles.get(e);if(t)return t.data||!0}},{key:"cleanup",value:function(){}},{key:"getTotalHeight",value:function(){return this.pTotalHeight*this.pitchY}},{key:"totalHeight",get:function(){return this.getTotalHeight()}},{key:"getRectangles",value:function(){var e=this;return new Map(Array.from(this.rectangles.entries()).map((function(t){var n=Object(r.a)(t,2),a=n[0],i=n[1],o=i.l,c=i.r,s=i.originalHeight,u=(i.top||0)*e.pitchY,l=u+s;return[a,[o*e.pitchX,u,c*e.pitchX,l]]})))}},{key:"serializeRegion",value:function(e){var t,n={},a=!1,i=Object(h.a)(this.rectangles.entries());try{for(i.s();!(t=i.n()).done;){var o=Object(r.a)(t.value,2),c=o[0],s=o[1],u=s.l,l=s.r,d=s.originalHeight,f=s.top;if(null===s.top)a=!0;else{var p=(f||0)*this.pitchY,g=p+d,m=u*this.pitchX,b=l*this.pitchX;w(e.start,e.end,m-this.pitchX,b+this.pitchX)&&(n[c]=[m,p,b,g])}}}catch(v){i.e(v)}finally{i.f()}return{rectangles:n,totalHeight:this.getTotalHeight(),maxHeightReached:a}}},{key:"toJSON",value:function(){return{rectangles:Object(v.objectFromEntries)(this.getRectangles()),totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}]),e}(),k=n(1024),x=function(){function e(t){var n=t.rectangles,r=t.totalHeight,a=t.maxHeightReached;Object(f.a)(this,e),this.rectangles=void 0,this.totalHeight=void 0,this.maxHeightReached=void 0,this.rectangles=new Map(Object.entries(n)),this.totalHeight=r,this.maxHeightReached=a}return Object(p.a)(e,[{key:"addRect",value:function(e){var t=this.rectangles.get(e);if(!t)throw new Error("id ".concat(e," not found in precomputed feature layout"));return t[1]}},{key:"getRectangles",value:function(){return this.rectangles}},{key:"getTotalHeight",value:function(){return this.totalHeight}},{key:"collides",value:function(e,t){throw new Error("Method not implemented.")}},{key:"addRectToBitmap",value:function(e,t){throw new Error("Method not implemented.")}},{key:"discardRange",value:function(e,t){throw new Error("Method not implemented.")}},{key:"serializeRegion",value:function(e){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{rectangles:Object(v.objectFromEntries)(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1}}}]),e}(),C=n(528),S=n(81),T=function(){function e(t){if(Object(f.a)(this,e),this.config=void 0,this.bpPerPx=void 0,this.filters=void 0,this.cachedLayout=void 0,this.config=t.config,!Object(S.isConfigurationModel)(this.config))throw new Error("configuration required");this.bpPerPx=t.bpPerPx,this.filters=t.filters,this.update(t)}return Object(p.a)(e,[{key:"update",value:function(e){Object.assign(this,e)}},{key:"makeLayout",value:function(){return new k.a(j,{maxHeight:Object(S.readConfObject)(this.config,"maxHeight"),displayMode:Object(S.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:Object(S.readConfObject)(this.config,"noSpacing")?1:3})}},{key:"cachedLayoutIsValid",value:function(e){return e&&e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&m()(Object(S.readConfObject)(this.config),e.config)&&m()(this.filters,e.filters)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:Object(S.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}]),e}(),E=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(f.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).sessions={},e}return Object(p.a)(n,[{key:"getWorkerSession",value:function(e){var t=e.sessionId;this.sessions[t]||(this.sessions[t]=this.createSession(e));var n=this.sessions[t];return n.update(e),n}},{key:"getExpandedRegion",value:function(e,t){if(!e)return e;var n=t.bpPerPx,r=t.config,a=void 0===r?0:Object(S.readConfObject)(r,"maxFeatureGlyphExpansion");if(!a)return e;var i=Math.round(a*n);return Object(c.a)(Object(c.a)({},e),{},{start:Math.floor(Math.max(e.start-i,0)),end:Math.ceil(e.end+i)})}},{key:"createSession",value:function(e){return new T(e)}},{key:"freeResourcesInClient",value:function(){var e=Object(o.a)(i.a.mark((function e(t,r){var a,o,c,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.sessionId,o=r.regions,c=0,l=this.sessions[a],!o&&l&&(delete this.sessions[a],c=1),l&&o&&l.layout.discardRange(o[0].refName,o[0].start,o[0].end),e.t0=c,e.next=8,Object(s.a)(Object(u.a)(n.prototype),"freeResourcesInClient",this).call(this,t,r);case 8:return e.t1=e.sent,e.abrupt("return",e.t0+e.t1);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeLayoutInClient",value:function(e){return new x(e)}},{key:"deserializeResultsInClient",value:function(e,t){var r=this.deserializeLayoutInClient(e.layout);return Object(s.a)(Object(u.a)(n.prototype),"deserializeResultsInClient",this).call(this,Object(c.a)(Object(c.a)({},e),{},{layout:r}),t)}},{key:"createLayoutInWorker",value:function(e){var t=e.regions;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}},{key:"serializeResultsInWorker",value:function(e,t){var a=Object(s.a)(Object(u.a)(n.prototype),"serializeResultsInWorker",this).call(this,e,t),i=Object(r.a)(t.regions,1)[0];return a.layout=e.layout.serializeRegion(this.getExpandedRegion(i,t)),a.layout.rectangles&&(a.features=a.features.filter((function(e){return Boolean(a.layout.rectangles[e.uniqueId])}))),a.maxHeightReached=a.layout.maxHeightReached,a}},{key:"render",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layout||this.createLayoutInWorker(t),e.next=3,Object(s.a)(Object(u.a)(n.prototype),"render",this).call(this,Object(c.a)(Object(c.a)({},t),{},{layout:r}));case 3:return a=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)({},a),{},{layout:r}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(C.a)},475:function(e,t,n){"use strict";n.r(t),n.d(t,"useStyles",(function(){return Y})),n.d(t,"BaseCard",(function(){return Q})),n.d(t,"BaseCoreDetails",(function(){return ne})),n.d(t,"Attributes",(function(){return ae})),n.d(t,"BaseAttributes",(function(){return ie})),n.d(t,"FeatureDetails",(function(){return oe}));var r=n(154),a=n(82),i=n(90),o=n(102),c=n(1),s=n.n(c),u=n(1012),l=n(2339),d=n(2341),f=n(2338),p=n(2343),g=n(2344),m=n(2360),h=n(1004),b=n.n(h),v=n(51),y=n(685),w=n(84),O=n(26),j=n(996),k=n.n(j),x=n(81),C=n(83),S=n(521),T=n(88),E=n.n(T),R=n(91),M=n(2460),P=n(2335),N=n(2337),A=n(1555),F=n(420),I=n.n(F);function B(e,t){return e.map((function(e){return t.slice(e.start,e.end)})).join("")}function D(e){return"".concat(e.start,"-").concat(e.end)}function L(e){return e.filter((function(e,t,n){return!t||D(e)!==D(n[t-1])}))}function V(e,t){return e.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{start:t-e.end,end:t-e.start})})).sort((function(e,t){return e.start-t.start}))}var W="rgb(220,220,180)",z="rgba(250,200,200)";function H(e){var t=e.cds,n=e.sequence;return s.a.createElement("span",{style:{background:W}},B(t,n))}function q(e){for(var t=e.cds,n=e.sequence,r=e.codonTable,a=B(t,n),i="",o=0;o<a.length;o+=3)i+=r[a.slice(o,o+3)]||"&";return s.a.createElement("span",{style:{background:"rgb(220,160,220)"}},i)}function U(e){var t=e.utr,n=e.cds,r=e.exons,a=e.sequence,i=e.upstream,c=e.downstream,u=e.includeIntrons,l=e.collapseIntron,d=n.length?[].concat(Object(o.a)(n),Object(o.a)(t)).sort((function(e,t){return e.start-t.start})):r;return s.a.createElement(s.a.Fragment,null,i?s.a.createElement("span",{style:{background:z}},i):null,d.map((function(e,t){var n,r=a.slice(e.end,null===(n=d[t+1])||void 0===n?void 0:n.start);return s.a.createElement(s.a.Fragment,{key:JSON.stringify(e)},s.a.createElement("span",{style:{background:"CDS"===e.type?W:"rgb(200,240,240)"}},a.slice(e.start,e.end)),u?s.a.createElement("span",{style:{background:undefined}},l&&r.length>20?"".concat(r.slice(0,10),"...").concat(r.slice(-10)):r):null)})),c?s.a.createElement("span",{style:{background:z}},c):null)}var _=s.a.forwardRef((function(e,t){var n=e.feature,r=e.mode,a=e.sequence,c=a.seq,u=a.upstream,l=void 0===u?"":u,d=a.downstream,f=void 0===d?"":d,p=n.subfeatures,g=Object(C.generateCodonTable)(C.defaultCodonTable);if(!p)return null;var m=p.sort((function(e,t){return e.start-t.start})).map((function(e){return Object(i.a)(Object(i.a)({},e),{},{start:e.start-n.start,end:e.end-n.start})})),h=L(m.filter((function(e){return"CDS"===e.type}))),b=L(m.filter((function(e){return e.type.match(/utr/i)}))),v=L(m.filter((function(e){return"exon"===e.type})));if(!b.length&&h.length&&v.length&&(b=function(e,t){var n=e[0],r=e[e.length-1],a=t.findIndex((function(e){return e.end>=n.start&&e.start<=n.start})),c=t.findIndex((function(e){return e.end>=r.end&&e.start<=r.end})),s=t[c],u=t[a],l=[].concat(Object(o.a)(t.slice(0,a)),[{start:u.start,end:n.start}]).map((function(e){return Object(i.a)(Object(i.a)({},e),{},{type:"five_prime_UTR"})})),d=[{start:r.end,end:s.end}].concat(Object(o.a)(t.slice(c))).map((function(e){return Object(i.a)(Object(i.a)({},e),{},{type:"three_prime_UTR"})}));return[].concat(Object(o.a)(l),Object(o.a)(d))}(h,v)),-1===n.strand){var y=[Object(C.revcom)(c),Object(C.revcom)(f),Object(C.revcom)(l)];l=y[1],f=y[2],h=V(h,(c=y[0]).length),v=V(v,c.length),b=V(b,c.length)}return s.a.createElement("div",{ref:t,"data-testid":"sequence_panel"},"cds"===r?s.a.createElement(H,{cds:h,sequence:c}):"cdna"===r?s.a.createElement(U,{exons:v,cds:h,utr:b,sequence:c}):"protein"===r?s.a.createElement(q,{cds:h,codonTable:g,sequence:c}):"gene"===r?s.a.createElement(U,{exons:v,cds:h,utr:b,sequence:c,includeIntrons:!0}):"gene_collapsed_intron"===r?s.a.createElement(U,{exons:v,cds:h,sequence:c,utr:b,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===r?s.a.createElement(U,{exons:v,cds:h,sequence:c,utr:b,upstream:l,downstream:f,includeIntrons:!0}):"gene_updownstream_collapsed_intron"===r?s.a.createElement(U,{exons:v,cds:h,sequence:c,utr:b,upstream:l,downstream:f,includeIntrons:!0,collapseIntron:!0}):s.a.createElement("div",null,"Unknown type"))}));function G(e){var t,n=e.model,r=e.feature,i=r,o=null===(t=i.subfeatures)||void 0===t?void 0:t.find((function(e){return"CDS"===e.type})),u=Object(c.useRef)(null),l=Object(A.a)(),d=l.ref,p=l.inView,g=Object(c.useState)(),m=Object(a.a)(g,2),h=m[0],b=m[1],v=Object(c.useState)(),y=Object(a.a)(v,2),w=y[0],O=y[1],j=Object(c.useState)(o?"cds":"cdna"),k=Object(a.a)(j,2),S=k[0],T=k[1],F=Object(c.useState)(!1),B=Object(a.a)(F,2),D=B[0],L=B[1];Object(c.useEffect)((function(){var e,t=!1;if(!n||!p)return function(){};var i=Object(C.getSession)(n),o=i.assemblyManager,c=i.rpcManager,s=(null===(e=n.view)||void 0===e?void 0:e.assemblyNames)||[],u=Object(a.a)(s,1)[0];function l(e,t,n){return d.apply(this,arguments)}function d(){return(d=Object(R.a)(E.a.mark((function e(t,n,r){var i,s,l,d,f,p;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.waitForAssembly(u);case 2:if(i=e.sent){e.next=5;break}throw new Error("assembly not found");case 5:return s="getSequence",e.next=8,c.call(s,"CoreGetFeatures",{adapterConfig:Object(x.getConf)(i,["sequence","adapter"]),sessionId:s,region:{start:t,end:n,refName:i.getCanonicalRefName(r)}});case 8:if(l=e.sent,d=l,f=Object(a.a)(d,1),p=f[0]){e.next=12;break}throw new Error("sequence not found for feature with refName:".concat(r));case 12:return e.abrupt("return",p.get("seq"));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(R.a)(E.a.mark((function e(){var n,a,i,o,c,s,u;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=(n=r).start,i=n.end,o=n.refName,e.next=4,l(a,i,o);case 4:return c=e.sent,e.next=7,l(Math.max(0,a-500),a,o);case 7:return s=e.sent,e.next=10,l(i,i+500,o);case 10:u=e.sent,t||b({seq:c,upstream:s,downstream:u}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),O(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))(),function(){t=!0}}),[r,p,n]);var V=!h;return s.a.createElement("div",{ref:d},s.a.createElement(M.a,{value:S,onChange:function(e){return T(e.target.value)}},o?s.a.createElement(P.a,{value:"cds"},"CDS"):null,o?s.a.createElement(P.a,{value:"protein"},"Protein"):null,s.a.createElement(P.a,{value:"gene"},"Gene w/ introns"),s.a.createElement(P.a,{value:"gene_collapsed_intron"},"Gene w/ 10bp of intron"),s.a.createElement(P.a,{value:"gene_updownstream"},"Gene w/ 500bp up+down stream"),s.a.createElement(P.a,{value:"gene_updownstream_collapsed_intron"},"Gene w/ 500bp up+down stream w/ 10bp intron"),s.a.createElement(P.a,{value:"cdna"},"cDNA")),s.a.createElement(N.a,{type:"button",variant:"contained",onClick:function(){u.current&&(I()(u.current.innerHTML,{format:"text/html"}),L(!0),setTimeout((function(){L(!1)}),1e3))}},D?"Copied to clipboard!":"Copy"),s.a.createElement("div",{"data-testid":"feature_sequence"},w?s.a.createElement(f.a,{color:"error"},"".concat(w)):V?s.a.createElement("div",null,"Loading gene sequence..."):h?s.a.createElement("div",{style:{fontFamily:"monospace",wordWrap:"break-word"}},s.a.createElement(_,{ref:u,feature:i,mode:S,sequence:h})):s.a.createElement("div",null,"No sequence found")))}var J=["length","position","subfeatures","uniqueId","exonFrames","parentId","thickStart","thickEnd"],X=["name","start","end","strand","refName","description","type"],Y=Object(v.a)((function(e){return{expansionPanelDetails:{display:"block",padding:e.spacing(1)},expandIcon:{color:"#FFFFFF"},paperRoot:{background:e.palette.grey[100]},field:{display:"flex",flexWrap:"wrap"},fieldDescription:{"&:hover":{background:"yellow"}},fieldName:{wordBreak:"break-all",minWidth:"90px",maxWidth:"150px",borderBottom:"1px solid #0003",background:e.palette.grey[200],marginRight:e.spacing(1),padding:e.spacing(.5)},fieldValue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),overflow:"auto"},fieldSubvalue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),background:e.palette.grey[100],border:"1px solid ".concat(e.palette.grey[300]),boxSizing:"border-box",overflow:"auto"},accordionBorder:{marginTop:"4px",border:"1px solid #444"}}}));function Q(e){var t=e.children,n=e.title,r=e.defaultExpanded,a=void 0===r||r,i=Y();return s.a.createElement(l.a,{className:i.accordionBorder,defaultExpanded:a,TransitionProps:{unmountOnExit:!0}},s.a.createElement(d.a,{expandIcon:s.a.createElement(b.a,{className:i.expandIcon})},s.a.createElement(f.a,{variant:"button"}," ",n)),s.a.createElement(p.a,{className:i.expansionPanelDetails},t))}var $=function(e){var t=e.description,n=e.name,r=e.prefix,a=void 0===r?[]:r,i=Y(),c=[].concat(Object(o.a)(a),[n]).join(".");return t?s.a.createElement(g.a,{title:t,placement:"left"},s.a.createElement("div",{className:Object(O.a)(i.fieldDescription,i.fieldName)},c)):s.a.createElement("div",{className:i.fieldName},c)},K=function(e){var t=e.value,n=Y();return s.a.createElement("div",{className:n.fieldValue},s.a.isValidElement(t)?t:s.a.createElement(S.a,{html:k()(t)?JSON.stringify(t):String(t)}))},Z=function(e){var t=e.name,n=e.value,r=e.description,a=e.prefix,i=Y();return null!==n&&void 0!==n?s.a.createElement("div",{className:i.field},s.a.createElement($,{prefix:a,description:r,name:t}),s.a.createElement(K,{value:n})):null},ee=function(e){var t=e.name,n=e.value,r=e.description,a=e.prefix,i=Y();return s.a.createElement(s.a.Fragment,null,1===n.length?k()(n[0])?s.a.createElement(ae,{attributes:n[0],prefix:[].concat(Object(o.a)(a),[t])}):s.a.createElement("div",{className:i.field},s.a.createElement($,{prefix:a,description:r,name:t}),s.a.createElement(K,{value:n[0]})):n.every((function(e){return k()(e)}))?n.map((function(e,n){return s.a.createElement(ae,{attributes:e,prefix:[].concat(Object(o.a)(a),[t+"-"+n])})})):s.a.createElement("div",{className:i.field},s.a.createElement($,{prefix:a,description:r,name:t}),n.map((function(e,n){return s.a.createElement("div",{key:"".concat(t,"-").concat(n),className:i.fieldSubvalue},s.a.createElement(K,{value:e}))}))))};function te(e){var t=e.feature,n=t,r=n.refName,a=n.start,o=n.end,c=n.strand,u={"-1":"-",0:"",1:"+"},l=u[c]?"(".concat(u[c],")"):"",d=(a+1).toLocaleString("en-US"),f=o.toLocaleString("en-US"),p=r?"".concat(r,":"):"",g=Object(i.a)(Object(i.a)({},t),{},{length:(o-a).toLocaleString("en-US"),position:"".concat(p).concat(d,"..").concat(f," ").concat(l)});return s.a.createElement(s.a.Fragment,null,["Position","Description","Name","Length","Type"].map((function(e){var t=g[e.toLowerCase()];return null!==t&&void 0!==t?s.a.createElement(Z,{key:e,name:e,value:t}):null})))}var ne=function(e){return s.a.createElement(Q,Object.assign({},e,{title:"Primary data"}),s.a.createElement(te,e))},re=function(e){var t=e.value,n=e.prefix,c=e.name,u=Object.keys(t[0]).sort(),l=new Set(u);if(t.forEach((function(e){return Object.keys(e).forEach((function(e){return l.add(e)}))})),l.size<u.length+5){var d,f=Object.entries(t).map((function(e){var t=Object(a.a)(e,2),n=t[0],o=t[1],c=o.id,s=Object(r.a)(o,["id"]);return Object(i.a)({id:n,identifier:c},s)}));l.has("id")?(l.delete("id"),d=["identifier"].concat(Object(o.a)(l))):d=Object(o.a)(l);var p=d.map((function(e){return{field:e,width:Math.max.apply(Math,Object(o.a)(f.map((function(t){var n=String(t[e]);return Math.min(Math.max(Object(C.measureText)(n,14)+50,80),1e3)}))))}}));return s.a.createElement(s.a.Fragment,null,s.a.createElement($,{prefix:n,name:c}),s.a.createElement("div",{style:{height:20*Math.min(f.length,100)+50+(f.length<100?0:50),width:"100%"}},s.a.createElement(y.DataGrid,{disableSelectionOnClick:!0,rowHeight:20,headerHeight:25,rows:f,rowsPerPageOptions:[],hideFooterRowCount:!0,hideFooterSelectedRowCount:!0,columns:p,hideFooter:f.length<100})))}return null};var ae=function e(t){var n=t.attributes,r=t.omit,i=void 0===r?[]:r,c=t.descriptions,u=t.formatter,l=void 0===u?function(e){return e}:u,d=t.prefix,f=void 0===d?[]:d,p=[].concat(Object(o.a)(i),J);return s.a.createElement(s.a.Fragment,null,Object.entries(n).filter((function(e){var t=Object(a.a)(e,2),n=t[0];return void 0!==t[1]&&!p.includes(n)})).map((function(t){var n=Object(a.a)(t,2),r=n[0],i=n[1];if(Array.isArray(i)&&i.length>2&&i.every((function(e){return k()(e)})))return s.a.createElement(re,{key:r,prefix:f,name:r,value:i});var u=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.forEach((function(e){n&&(n=n[e])})),"string"===typeof n?n:"string"===typeof(null===(t=n)||void 0===t?void 0:t.Description)?n.Description:void 0}([].concat(Object(o.a)(f),[r]),c);return Array.isArray(i)?s.a.createElement(ee,{key:r,name:r,value:i,description:u,prefix:f}):k()(i)?s.a.createElement(e,{omit:p,key:r,attributes:i,descriptions:c,prefix:[].concat(Object(o.a)(f),[r])}):s.a.createElement(Z,{key:r,name:r,value:l(i,r),description:u,prefix:f})})))},ie=function(e){var t=e.feature;return s.a.createElement(Q,Object.assign({},e,{title:"Attributes"}),s.a.createElement(ae,Object.assign({},e,{attributes:t})))};var oe=function e(t){var n=t.omit,r=void 0===n?[]:n,a=t.model,i=t.feature,c=t.depth,l=void 0===c?0:c,d=i.name,p=i.id,g=i.type,h=void 0===g?"":g,b=i.subfeatures,v=d||p||"",y=v.length>20?"".concat(v,"..."):v,w="".concat(y).concat(h?" - ".concat(h):""),O=Object(C.getSession)(a),j=Object(x.getConf)(O,["featureDetails","sequenceTypes"])||["mRNA","transcript"];return s.a.createElement(Q,{title:w},s.a.createElement("div",null,"Core details"),s.a.createElement(te,t),s.a.createElement(m.a,null),s.a.createElement("div",null,"Attributes"),s.a.createElement(ae,Object.assign({attributes:i},t,{omit:[].concat(Object(o.a)(r),X)})),j.includes(i.type)?s.a.createElement(u.ErrorBoundary,{FallbackComponent:function(e){var t=e.error;return s.a.createElement(f.a,{color:"error"},"Failed to fetch sequence for feature: ","".concat(t))}},s.a.createElement(G,t)):null,b&&b.length?s.a.createElement(Q,{title:"Subfeatures",defaultExpanded:!j.includes(i.type)},b.map((function(t){return s.a.createElement(e,{key:JSON.stringify(t),feature:t,model:a,depth:l+1})}))):null)},ce=Object(w.observer)((function(e){var t=e.model,n=t.featureData;if(!n)return null;var r,a=JSON.parse(JSON.stringify(n));return r=a,0===Object.keys(r).length?null:s.a.createElement(oe,{model:t,feature:a})}));t.default=ce},476:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n(88),a=n.n(r),i=n(91),o=n(154),c=n(90),s=n(89),u=n(92),l=n(94),d=n(95),f=n(1),p=n.n(f),g=n(2346),m=n(1014),h=n(87),b=n(83),v=n(960),y=n(525),w=n(123),O=n(31);function j(e){var t=Object(f.useRef)(null),n=e.theme,r=e.html,a=e.RenderingComponent,i=Object(o.a)(e,["theme","html","RenderingComponent"]),c=Object(w.createJBrowseTheme)(n);return Object(f.useEffect)((function(){var e=t.current;return e&&(e&&Object(O.unmountComponentAtNode)(e),e.innerHTML=r,Object(b.rIC)((function(){Object(O.hydrate)(p.a.createElement(g.a,{theme:c},p.a.createElement(a,i)),e)}),{timeout:300})),function(){e&&Object(O.unmountComponentAtNode)(e)}}),[r,c,i]),p.a.createElement("div",{ref:t,"data-html-size":r.length,className:"ssr-container"})}var k=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"serializeArgsInClient",value:function(e){return Object(c.a)(Object(c.a)({},e),{},{config:Object(h.isStateTreeNode)(e.config)?Object(h.getSnapshot)(e.config):e.config,filters:e.filters&&e.filters.toJSON().filters})}},{key:"deserializeResultsInClient",value:function(e,t){e.html;var n=Object(o.a)(e,["html"]);return t.exportSVG?Object(c.a)(Object(c.a)({},e),{},{html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}):Object(c.a)(Object(c.a)({},n),{},{reactElement:p.a.createElement(j,Object.assign({},t,e,{RenderingComponent:this.ReactComponent}))})}},{key:"deserializeArgsInWorker",value:function(e){var t=Object(c.a)({},e),n=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager});return t.config=n,t.filters=new y.a({filters:e.filters}),t}},{key:"serializeResultsInWorker",value:function(e,t){var n=Object(m.renderToString)(p.a.createElement(g.a,{theme:Object(w.createJBrowseTheme)(t.theme)},e.reactElement));return delete e.reactElement,Object(c.a)(Object(c.a)({},e),{},{html:n})}},{key:"renderInClient",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n.sessionId,"CoreRender",n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renderInWorker",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o,c,s,u=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,r=t.statusCallback,i=void 0===r?function(){}:r,Object(b.checkAbortSignal)(n),o=this.deserializeArgsInWorker(t),Object(b.checkAbortSignal)(n),e.next=6,Object(b.updateStatus)("Rendering plot",i,(function(){return u.render(o)}));case 6:return c=e.sent,Object(b.checkAbortSignal)(n),e.next=10,Object(b.updateStatus)("Serializing results",i,(function(){return u.serializeResultsInWorker(c,o)}));case 10:return s=e.sent,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResourcesInClient",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.serializeArgsInClient(n),i=this.freeResources(),e.next=4,t.call(n.sessionId,"CoreFreeResources",r);case 4:return o=e.sent,e.abrupt("return",i+o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(v.a)},514:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return m})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return v})),n.d(t,"c",(function(){return y}));var r=n(88),a=n.n(r),i=n(91),o=n(89),c=n(94),s=n(95),u=n(1272),l=n(115),d=n(985),f=function(e){Object(c.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).code=void 0,e}return n}(Object(u.a)(Error));function p(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw b()}}function g(e){return new Promise((function(t){return setTimeout(t,e)}))}function m(e){return h.apply(this,arguments)}function h(){return(h=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(1);case 2:p(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){if("undefined"!==typeof DOMException)return new DOMException("aborted","AbortError");var e=new f("aborted");return e.code="ERR_ABORTED",e}function v(e){return e?Object(d.a)(e,"abort"):l.a.create()}function y(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||!!e.message.match(/\b(aborted|AbortError)\b/i)}},517:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(987),a={};function i(e,t){var n="nosig|".concat(e);if(!a[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");var i=e.split("jexl:")[1],o=t?t.compile("".concat(i)):Object(r.a)().compile("".concat(i));a[n]=o}return a[n]}},521:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(1),a=n.n(r),i=n(1553),o=n.n(i),c=n(997),s=n.n(c),u=new RegExp(["a","b","br","code","div","em","h1","h2","h3","h4","h5","h6","i","img","li","p","pre","span","small","strong","table","tbody","td","tfoot","th","thead","tr","u","ul"].map((function(e){return"<".concat(e,"\\b[^>]*>")})).join("|"),"i");function l(e){var t,n=e.html,r=(t=n,u.test(t)?n:o()(n));return a.a.createElement("div",{dangerouslySetInnerHTML:{__html:s.a.sanitize(r)}})}},524:function(e,t,n){"use strict";var r=n(87),a=n(114),i=r.types.model("BaseView",{id:a.ElementId,displayName:r.types.maybe(r.types.string)}).volatile((function(){return{width:800}})).views((function(){return{get menuItems(){return[]}}})).actions((function(e){return{setDisplayName:function(t){e.displayName=t},setWidth:function(t){e.width=t}}}));t.a=i},525:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(89),a=n(92),i=n(517),o=function(){function e(t){var n=t.filters,a=void 0===n?[]:n;Object(r.a)(this,e),this.filterChain=void 0,this.filterChain=a.map((function(e){if("string"===typeof e)return{expr:Object(i.a)(e),string:e};throw new Error('invalid inputFilter string "'.concat(e,'"'))}))}return Object(a.a)(e,[{key:"passes",value:function(){for(var e=0;e<this.filterChain.length;e+=1)if(!this.filterChain[e].expr.evalSync({feature:arguments.length<=0?void 0:arguments[0]}))return!1;return!0}},{key:"toJSON",value:function(){return{filters:this.filterChain.map((function(e){return e.string}))}}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}()},528:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(88),a=n.n(r),i=n(91),o=n(90),c=n(89),s=n(92),u=n(206),l=n(167),d=n(94),f=n(95),p=n(1022),g=n(316),m=n(1023),h=n(83),b=n(142),v=n(476),y=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"serializeArgsInClient",value:function(e){var t=e.displayModel,r=e.regions,a=Object(o.a)(Object(o.a)({},e),{},{displayModel:t&&{id:t.id,selectedFeatureId:t.selectedFeatureId},regions:JSON.parse(JSON.stringify(r))});return Object(u.a)(Object(l.a)(n.prototype),"serializeArgsInClient",this).call(this,a)}},{key:"deserializeResultsInClient",value:function(e,t){var r=new Map;e.features.forEach((function(e){var t=b.a.fromJSON(e);r.set(String(t.id()),t)}));var a=Object(u.a)(Object(l.a)(n.prototype),"deserializeResultsInClient",this).call(this,Object(o.a)(Object(o.a)({},e),{},{features:r}),t);return Object(o.a)(Object(o.a)({},a),{},{blockKey:t.blockKey,features:r})}},{key:"serializeResultsInWorker",value:function(e,t){var r=Object(u.a)(Object(l.a)(n.prototype),"serializeResultsInWorker",this).call(this,e,t);return Object(o.a)(Object(o.a)({},r),{},{features:Object(h.iterMap)(e.features.values(),(function(e){return e.toJSON()}))})}},{key:"getExpandedRegion",value:function(e,t){return e}},{key:"getFeatures",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,c,s,u,l,d=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dataAdapter,r=t.signal,i=t.regions,c=new Map,i&&0!==i.length){e.next=4;break}return e.abrupt("return",c);case 4:return s=i.map((function(e){var t=Object(o.a)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.ceil(t.end)),t})),u=s[0],l=1===s.length?n.getFeatures(this.getExpandedRegion(u,t),t):n.getFeaturesInMultipleRegions(s,t),e.next=9,l.pipe(Object(p.a)((function(){return Object(h.checkAbortSignal)(r)})),Object(g.a)((function(e){return d.featurePassesFilters(t,e)})),Object(p.a)((function(e){var t=e.id();if(!t)throw new Error('invalid feature id "'.concat(t,'"'));c.set(t,e)})),Object(m.a)()).toPromise();case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"render",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.features,e.t0){e.next=5;break}return e.next=4,this.getFeatures(t);case 4:e.t0=e.sent;case 5:return r=e.t0,e.next=8,Object(u.a)(Object(l.a)(n.prototype),"render",this).call(this,Object(o.a)(Object(o.a)({},t),{},{features:r}));case 8:return i=e.sent,e.abrupt("return",Object(o.a)(Object(o.a)({},i),{},{features:r}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(v.a);v.a},554:function(e,t,n){"use strict";var r=n(88),a=n.n(r),i=n(82),o=n(106),c=n(89),s=n(92),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(c.a)(this,e),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=t.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}return Object(s.a)(e,[{key:"_set",value:function(e,t){this.cache.set(e,t),this._size+=1,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}},{key:"get",value:function(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){var t=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,t),t}}},{key:"set",value:function(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}},{key:"has",value:function(e){return this.cache.has(e)||this.oldCache.has(e)}},{key:"peek",value:function(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}},{key:"delete",value:function(e){var t=this.cache.delete(e);return t&&(this._size-=1),this.oldCache.delete(e)||t}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this._size=0}},{key:"keys",value:a.a.mark((function e(){var t,n,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(o.a)(this),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=Object(i.a)(n.value,1),c=r[0],e.next=7,c;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"values",value:a.a.mark((function e(){var t,n,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(o.a)(this),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=Object(i.a)(n.value,2),c=r[1],e.next=7,c;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:Symbol.iterator,value:a.a.mark((function e(){var t,n,r,c,s,u,l,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(o.a)(this.cache),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:c=Object(o.a)(this.oldCache),e.prev=18,c.s();case 20:if((s=c.n()).done){e.next=28;break}if(u=s.value,l=Object(i.a)(u,1),d=l[0],this.cache.has(d)){e.next=26;break}return e.next=26,u;case 26:e.next=20;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(18),c.e(e.t1);case 33:return e.prev=33,c.f(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[1,11,14,17],[18,30,33,36]])}))},{key:"size",get:function(){var e,t=0,n=Object(o.a)(this.oldCache.keys());try{for(n.s();!(e=n.n()).done;){var r=e.value;this.cache.has(r)||(t+=1)}}catch(a){n.e(a)}finally{n.f()}return this._size+t}}]),e}();t.a=u},604:function(e,t,n){"use strict";n.r(t),n.d(t,"renderToSvg",(function(){return Rt}));var r=n(88),a=n.n(r),i=n(91),o=n(1),c=n.n(o),s=n(1014),u=n(51),l=n(2332),d=n(2338),f=n(2337),p=n(255),g=n(112),m=n(84),h=n(87),b=n(81),v=n(83),y=n(160),w=n(226),O=n(2385),j=n(1635),k=n.n(j),x=n(1634),C=n.n(x),S=n(334),T=n(90),E=n(63),R=n(2347),M=n(1633),P=n.n(M),N=n(2387),A=n(1604),F=n(1277),I=Object(A.a)({trim:!0,limit:36});var B=Object(m.observer)((function(e){var t,n=e.model,r=e.onSelect,a=e.assemblyName,i=e.style,s=e.value,u=e.TextFieldProps,l=void 0===u?{}:u,f=Object(v.getSession)(n).assemblyManager,p=a&&(null===(t=f.get(a))||void 0===t?void 0:t.regions)||[],g=n.coarseVisibleLocStrings,m=0!==p.length,h=Object(o.useMemo)((function(){return p.map((function(e){return{type:"reference sequence",value:e.refName}}))}),[p]);return c.a.createElement(F.a,{id:"refNameAutocomplete-".concat(n.id),"data-testid":"autocomplete",disabled:!a||!m,disableListWrap:!0,disableClearable:!0,freeSolo:!0,includeInputInList:!0,clearOnBlur:!0,loading:m,selectOnFocus:!0,style:i,value:g||s||"",options:h,groupBy:function(e){return String(e.type)},filterOptions:function(e,t){var n=I(e,t);if(""!==t.inputValue){var r={type:"Search",inputValue:t.inputValue,value:t.inputValue};n.push(r)}return n},ListboxProps:{style:{maxHeight:250}},onChange:function(e,t){!function(e){var t;e&&("object"===typeof e&&(t=e.inputValue||e.value),"string"===typeof e&&(t=e),r(t))}(t)},renderInput:function(e){var t=l.helperText,n=l.InputProps,r=void 0===n?{}:n,a=Object(T.a)(Object(T.a)(Object(T.a)({},e.InputProps),r),{},{endAdornment:c.a.createElement(c.a.Fragment,null,m?c.a.createElement(N.a,{position:"end",style:{marginRight:7}},c.a.createElement(P.a,null)):c.a.createElement(E.a,{color:"inherit",size:20}),e.InputProps.endAdornment)});return c.a.createElement(R.a,Object.assign({},e,l,{helperText:t,value:g||s||"",InputProps:a,placeholder:"Search for location"}))},renderOption:function(e){return c.a.createElement(d.a,{noWrap:!0},e.value)},getOptionLabel:function(e){return"string"===typeof e?e:e.inputValue?e.inputValue:e.value}})})),D=n(426),L=n(2388),V=n(355),W=n(26);function z(e,t,n){for(var r=t*(e=Math.abs(e)),a=parseInt(Number(r).toExponential().split(/e/i)[1],10),i=Math.pow(10,a);i<r&&!((i*=2)>=r);)i*=2.5;var o=(i=Math.max(i,5))/e,c=0;return!(i%10)&&o/10>=n?c=i/10:!(i%5)&&o/5>=n?c=i/5:!(i%2)&&o/2>=n&&(c=i/2),{majorPitch:i,minorPitch:c}}function H(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=z(n,60,15),o=e,c=t;if(null===o||null===c)return[];if(n<0){var s=[c,o];o=s[0],c=s[1]}o-=Math.abs(20*n)-1,c+=Math.abs(20*n)+1;for(var u=i.minorPitch||i.majorPitch,l=0,d=[],f=Math.ceil(o/u)*u;f<c;f+=u)a&&f%(2*i.majorPitch)?(d.push({type:"minor",base:f-1,index:l}),l+=1):!r||f%(2*i.majorPitch)||(d.push({type:"major",base:f-1,index:l}),l+=1);return d}var q=n(82),U=n(2328),_=n(2344),G=Object(u.a)((function(e){return{rubberBand:{height:"100%",background:e.palette.tertiary?Object(w.fade)(e.palette.tertiary.main,.7):Object(w.fade)(e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}}));function J(e){var t=e.model,n=e.overview,r=e.ControlComponent,a=void 0===r?c.a.createElement("div",null):r,i=Object(o.useState)(),s=Object(q.a)(i,2),u=s[0],l=s[1],f=Object(o.useState)(),p=Object(q.a)(f,2),g=p[0],m=p[1],h=Object(o.useState)(),b=Object(q.a)(h,2),y=b[0],w=b[1],O=Object(o.useRef)(null),j=Object(o.useRef)(null),k=G(),x=void 0!==u;function C(e){e.preventDefault(),e.stopPropagation(),O.current&&l(e.clientX-O.current.getBoundingClientRect().left)}function T(e){O.current&&w(e.clientX-O.current.getBoundingClientRect().left)}function E(){w(void 0)}if(Object(o.useEffect)((function(){function e(e){if(O.current&&x){var t=e.clientX-O.current.getBoundingClientRect().left;m(t)}}function r(){if(O.current&&void 0!==u&&void 0!==g&&Math.abs(g-u)>3&&t.zoomToDisplayedRegions(n.pxToBp(u),n.pxToBp(g)),O.current&&void 0!==u&&void 0===g){var e=n.pxToBp(u);t.centerAt(Math.round(e.coord),e.refName,e.index)}l(void 0),m(void 0),void 0!==u&&w(void 0)}function a(e){"Escape"===e.key&&(l(void 0),m(void 0))}return x?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",r,!0),window.addEventListener("keydown",a,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",r,!0),window.removeEventListener("keydown",a,!0)}):function(){}}),[x,g,u,t,n]),void 0===u)return c.a.createElement("div",{style:{position:"relative"}},void 0!==y?c.a.createElement(_.a,{open:!x,placement:"top",title:Object(v.stringify)(n.pxToBp(y)),arrow:!0},c.a.createElement("div",{className:k.guide,style:{left:y}})):null,c.a.createElement("div",{className:k.rubberBandControl,role:"presentation",ref:O,onMouseDown:C,onMouseOut:E,onMouseMove:T},a));var R,M,P=u||0,N=0;if(void 0!==u&&void 0!==g&&(P=g<u?g:u,N=g-u),u&&(R=n.pxToBp(u),M=n.pxToBp(u+N),g&&g<u)){var A=[M,R];R=A[0],M=A[1]}return c.a.createElement("div",{style:{position:"relative"}},j.current?c.a.createElement(c.a.Fragment,null,c.a.createElement(U.a,{className:k.popover,classes:{paper:k.paper},open:!0,anchorEl:j.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},c.a.createElement(d.a,null,R?Object(v.stringify)(R):"")),c.a.createElement(U.a,{className:k.popover,classes:{paper:k.paper},open:!0,anchorEl:j.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},c.a.createElement(d.a,null,M?Object(v.stringify)(M):""))):null,c.a.createElement("div",{ref:j,className:k.rubberBand,style:{left:P,width:Math.abs(N),height:S.b}}),c.a.createElement("div",{"data-testid":"rubberBand_controls",className:k.rubberBandControl,role:"presentation",ref:O,onMouseDown:C,onMouseOut:E,onMouseMove:T},a))}J.defaultProps={ControlComponent:c.a.createElement("div",null)};var X=Object(m.observer)(J),Y=Object(u.a)((function(e){var t=e.palette.tertiary?e.palette.tertiary.light:e.palette.primary.light;return{scaleBar:{width:"100%",height:S.b,overflow:"hidden"},scaleBarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:S.b,border:"1px solid",borderBottomColor:"black"},scaleBarContigForward:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarContigReverse:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarRegionIncompleteLeft:{width:10,height:17.5,background:"linear-gradient(-225deg,black 3px, transparent 1px),\n      linear-gradient(45deg, black 3px, transparent 1px)",backgroundRepeat:"repeat-y",backgroundSize:"10px 8px",borderTopLeftRadius:"2px",borderBottomLeftRadius:"2px",float:"left"},scaleBarRegionIncompleteRight:{width:10,height:17.5,background:"linear-gradient(225deg, black 3px, transparent 1px),\n      linear-gradient(-45deg, black 3px, transparent 1px)",backgroundRepeat:"repeat-y",backgroundSize:"10px 8px",borderTopRightRadius:"2px",borderBottomRightRadius:"2px",float:"right"},scaleBarRefName:{position:"absolute",fontWeight:"bold",lineHeight:"normal",pointerEvents:"none",left:5},scaleBarLabel:{height:S.b,width:1,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scaleBarVisibleRegion:{background:Object(w.fade)(t,.3),position:"absolute",height:S.b,pointerEvents:"none",top:-1,zIndex:100,borderWidth:1,borderStyle:"solid",borderColor:Object(w.fade)(t,.8),boxSizing:"content-box"},overview:{height:S.a,position:"relative"},overviewSvg:{position:"absolute"}}})),Q=Object(m.observer)((function(e){var t=e.model,n=e.overview,r=Object(y.a)(),a=Y(),i=t.offsetPx,o=t.dynamicBlocks,s=o.contentBlocks,u=o.totalWidthPxWithoutBorders,l=r.palette.tertiary?r.palette.tertiary.light:r.palette.primary.light;if(!s.length)return null;var d=s[0],f=s[s.length-1],p=n.bpToPx({refName:d.refName,coord:d.reversed?d.end:d.start,regionNumber:d.regionNumber}),g=n.bpToPx({refName:f.refName,coord:f.reversed?f.start:f.end,regionNumber:f.regionNumber}),m=Math.max(0,-i),h=m+u+s.length*t.interRegionPaddingWidth/2,b=[[m,S.a],[h,S.a],[g,0],[p,0]];return c.a.createElement("svg",{height:S.a,width:"100%",className:a.overviewSvg},b&&c.a.createElement("polygon",{points:b.toString(),fill:Object(w.fade)(l,.3),stroke:Object(w.fade)(l,.8)}))})),$=Object(m.observer)((function(e){var t=e.model,n=e.scale,r=e.overview,a=Y(),i=t.dynamicBlocks,o=Object(v.getSession)(t).assemblyManager,s=z(n,120,15),u=r.dynamicBlocks;if(!i.contentBlocks.length)return null;var l=i.contentBlocks[0],f=r.bpToPx({refName:l.refName,regionNumber:l.regionNumber,coord:l.reversed?l.end:l.start})||0,p=i.contentBlocks[i.contentBlocks.length-1],g=r.bpToPx({refName:p.refName,coord:p.reversed?p.start:p.end,regionNumber:p.regionNumber})||0;return c.a.createElement("div",{className:a.scaleBar},c.a.createElement("div",{className:a.scaleBarVisibleRegion,style:{width:g-f,left:f}}),u.map((function(e,t){var r,i=o.get(e.assemblyName);i&&(r=i.getRefNameColor(e.refName));for(var u=e.end-e.start,l=[],f=0;f<Math.floor(u/s.majorPitch);f++){var p=(f+1)*s.majorPitch;l.push(e.reversed?e.end-p:e.start+p)}return e instanceof V.b?c.a.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t),className:Object(W.a)(a.scaleBarContig,e.reversed?a.scaleBarContigReverse:a.scaleBarContigForward),style:{left:e.offsetPx,width:e.widthPx,borderColor:r}},c.a.createElement(d.a,{style:{color:r},className:a.scaleBarRefName},e.refName),l.map((function(t,i){return c.a.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t,"-").concat(i),className:a.scaleBarLabel,style:{left:(i+1)*s.majorPitch/n,pointerEvents:"none",color:r}},t.toLocaleString("en-US"))}))):c.a.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(t),className:a.scaleBarContig,style:{width:e.widthPx,left:e.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}})})))}));var K=Object(m.observer)((function(e){var t=e.model,n=e.children,r=Y(),a=t.width,i=t.displayedRegions,o=D.a.create({displayedRegions:JSON.parse(JSON.stringify(i)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth});o.setVolatileWidth(a),o.showAllRegions();var s=t.totalBp/(a-2*(i.length-1));return i.length?c.a.createElement("div",null,c.a.createElement(X,{model:t,overview:o,ControlComponent:c.a.createElement($,{model:t,overview:o,scale:s})}),c.a.createElement("div",{className:r.overview},c.a.createElement(Q,{model:t,overview:o}),n)):c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:r.scaleBar},c.a.createElement(L.a,{variant:"indeterminate",style:{marginTop:4,width:"100%"}})),c.a.createElement("div",null,n))})),Z=n(2342),ee=n(2466),te=n(430),ne=n.n(te),re=n(538),ae=n.n(re),ie=Object(u.a)({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70}});var oe=Object(m.observer)((function(e){var t=e.model,n=ie(),r=t.maxBpPerPx,a=t.minBpPerPx,i=t.bpPerPx,s=t.scaleFactor,u=Object(o.useState)(100*-Math.log2(i)),l=Object(q.a)(u,2),d=l[0],f=l[1];return Object(o.useEffect)((function(){f(100*-Math.log2(i))}),[f,i]),c.a.createElement("div",{className:n.container},c.a.createElement(Z.a,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*i)},disabled:i>=r-1e-4||1!==s,color:"secondary"},c.a.createElement(ae.a,null)),c.a.createElement(ee.a,{className:n.slider,value:d,min:100*-Math.log2(r),max:100*-Math.log2(a),onChange:function(e,t){return f(t)},onChangeCommitted:function(){return t.zoomTo(Math.pow(2,-d/100))},disabled:1!==s}),c.a.createElement(Z.a,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:i<=a+1e-4||1!==s,color:"secondary"},c.a.createElement(ne.a,null)))})),ce=Object(u.a)((function(e){return{headerBar:{height:S.a,display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},input:{},headerRefName:{minWidth:100},panButton:{background:Object(w.fade)(e.palette.background.paper,.8),height:32,margin:7},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",margin:e.spacing(.5)},buttonSpacer:{marginRight:e.spacing(2)}}})),se=Object(m.observer)((function(e){var t=e.model,n=ce();return c.a.createElement(f.a,{onClick:t.activateTrackSelector,className:n.toggleButton,title:"Open track selector",value:"track_select",color:"secondary"},c.a.createElement(p.b,{className:n.buttonSpacer}))}));function ue(e){var t=e.model,n=ce();return c.a.createElement(c.a.Fragment,null,c.a.createElement(f.a,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(-.9)}},c.a.createElement(C.a,null)),c.a.createElement(f.a,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(.9)}},c.a.createElement(k.a,null)))}var le=Object(m.observer)((function(e){var t=e.model,n=ce(),r=t.coarseTotalBp;return c.a.createElement(d.a,{variant:"body2",color:"textSecondary",className:n.bp},"".concat(Math.round(r).toLocaleString("en-US")," bp"))})),de=Object(m.observer)((function(e){var t=e.model,n=ce(),r=Object(y.a)(),a=Object(v.getSession)(t),i=t.coarseDynamicBlocks,s=t.displayedRegions,u=Object(o.useCallback)((function(e){try{if(e){var n=t.displayedRegions.find((function(t){return e===t.refName}));n?(t.setDisplayedRegions([n]),t.showAllRegions()):e&&t.navToLocString(e)}}catch(r){console.warn(r),a.notify("".concat(r),"warning")}}),[t,a]),l=i[0]||{refName:""},d=l.assemblyName,f=l.refName,p=c.a.createElement("div",{className:n.headerBar},c.a.createElement(se,{model:t}),c.a.createElement("div",{className:n.spacer}),c.a.createElement(O.a,{row:!0,className:n.headerForm},c.a.createElement(ue,{model:t}),c.a.createElement(B,{onSelect:u,assemblyName:d,value:s.length>1?"":f,model:t,TextFieldProps:{variant:"outlined",className:n.headerRefName,style:{margin:7,minWidth:"175px"},InputProps:{style:{padding:0,height:32,background:Object(w.fade)(r.palette.background.paper,.8)}}}})),c.a.createElement(le,{model:t}),c.a.createElement(oe,{model:t}),c.a.createElement("div",{className:n.spacer}));return t.hideHeaderOverview?p:c.a.createElement(K,{model:t},p)})),fe=n(123),pe=n(102),ge=n(1059),me=n.n(ge),he=n(1636),be=n.n(he),ve=n(134),ye=n.n(ve),we=Object(u.a)((function(e){return{root:{background:Object(w.fade)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},dragHandle:{cursor:"grab",color:"#135560"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}})),Oe=c.a.forwardRef((function(e,t){var n=we(),r=c.a.useState(null),a=Object(q.a)(r,2),i=a[0],o=a[1],s=e.track,u=e.className,f=Object(v.getContainingView)(s),p=Object(v.getSession)(s),g=s.configuration,m=Object(b.getConf)(s,"trackId"),h=function(){o(null)},y=Object(b.getConf)(s,"name");return"ReferenceSequenceTrack"===Object(b.getConf)(s,"type")&&(y="Reference Sequence",p.assemblies.forEach((function(e){e.sequence===g&&(y="Reference Sequence (".concat(Object(b.readConfObject)(e,"name"),")"))}))),c.a.createElement(c.a.Fragment,null,c.a.createElement(l.a,{ref:t,className:Object(W.a)(u,n.root)},c.a.createElement("span",{draggable:!0,className:n.dragHandle,onDragStart:function(e){var t=e.target;t.parentNode&&(e.dataTransfer.setDragImage(t.parentNode,20,20),f.setDraggingTrackId(s.id))},onDragEnd:function(){f.setDraggingTrackId(void 0)},"data-testid":"dragHandle-".concat(f.id,"-").concat(m)},c.a.createElement(be.a,{className:n.dragHandleIcon})),c.a.createElement(Z.a,{onClick:function(){return f.hideTrack(m)},className:n.iconButton,title:"close this track",color:"secondary"},c.a.createElement(ye.a,null)),c.a.createElement(d.a,{variant:"body1",component:"span",className:n.trackName},y),c.a.createElement(Z.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){o(e.currentTarget)},className:n.iconButton,color:"secondary","data-testid":"track_menu_icon",disabled:!s.trackMenuItems.length},c.a.createElement(me.a,null))),c.a.createElement(fe.Menu,{anchorEl:i,onMenuItemClick:function(e,t){t(),h()},open:Boolean(i),onClose:h,menuItems:[].concat(Object(pe.a)(p.getTrackActionMenuItems?p.getTrackActionMenuItems(g):[]),Object(pe.a)(s.trackMenuItems)).sort((function(e,t){return(t.priority||0)-(e.priority||0)}))}))})),je=Object(m.observer)(Oe),ke=Object(u.a)((function(e){return{root:{},resizeHandle:{height:S.c,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3,borderRadius:e.shape.borderRadius},renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackLabel:{zIndex:3,margin:e.spacing(1)},trackLabelInline:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2,boxSizing:"content-box"}}}));var xe=Object(m.observer)((function(e){var t=ke(),n=e.model,r=e.track,a=r.displays[0],i=n.horizontalScroll,s=n.draggingTrackId,u=n.moveTrack,d=a.height,f=Object(v.getContainingView)(a),p=Object(b.getConf)(r,"trackId"),g=Object(o.useRef)(null);Object(o.useEffect)((function(){return g.current&&(n.trackRefs[p]=g.current),function(){delete n.trackRefs[p]}}),[n.trackRefs,p]);var m=Object(v.useDebouncedCallback)((function(){void 0!==s&&Object(h.isAlive)(a)&&s!==a.id&&u(s,r.id)}),100),y=a.RenderingComponent,w=a.DisplayBlurb,O=void 0!==s&&s!==a.id;return c.a.createElement("div",{className:t.root},"hidden"!==f.trackLabels?c.a.createElement(je,{track:r,className:Object(W.a)(t.trackLabel,"overlapping"===f.trackLabels?t.trackLabelOverlap:t.trackLabelInline)}):null,c.a.createElement(l.a,{variant:"outlined",className:t.trackRenderingContainer,style:{height:d},onScroll:function(e){var t=e.target;a.setScrollTop(t.scrollTop)},onDragEnter:m,"data-testid":"trackRenderingContainer-".concat(f.id,"-").concat(p),role:"presentation"},c.a.createElement("div",{ref:g,className:t.renderingComponentContainer,style:{transform:"scaleX(".concat(n.scaleFactor,")")}},c.a.createElement(y,{model:a,blockState:{},onHorizontalScroll:i})),w?c.a.createElement("div",{style:{position:"absolute",left:0,top:a.height-20}}," ",c.a.createElement(w,{model:a})):null),c.a.createElement("div",{className:t.overlay,style:{height:a.height,background:O?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:m}),c.a.createElement(fe.ResizeHandle,{onDrag:a.resizeHeight,className:t.resizeHandle}))})),Ce=n(1060),Se=n.n(Ce),Te=n(697),Ee=n.n(Te),Re=Object(u.a)((function(e){return{rubberBand:{height:"100%",background:e.palette.tertiary?Object(w.fade)(e.palette.tertiary.main,.7):Object(w.fade)(e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}})),Me=Object(m.observer)((function(e){var t=e.model,n=e.coordX,r=Re();return c.a.createElement(_.a,{open:!0,placement:"top",title:Object(v.stringify)(t.pxToBp(n)),arrow:!0},c.a.createElement("div",{className:r.guide,style:{left:n,background:"red"}}))}));function Pe(e){var t=e.model,n=e.ControlComponent,r=void 0===n?c.a.createElement("div",null):n,a=Object(o.useState)(),i=Object(q.a)(a,2),s=i[0],u=i[1],l=Object(o.useState)(),f=Object(q.a)(l,2),p=f[0],g=f[1],m=Object(o.useState)(),h=Object(q.a)(m,2),b=h[0],y=h[1],w=Object(o.useState)(),O=Object(q.a)(w,2),j=O[0],k=O[1],x=Object(o.useRef)(null),C=Object(o.useRef)(null),S=Re(),T=void 0!==s&&void 0===b;function E(e){e.preventDefault(),e.stopPropagation();var t=e.clientX-e.target.getBoundingClientRect().left;u(t),g(t)}function R(e){var t=e.target;k(e.clientX-t.getBoundingClientRect().left)}function M(){k(void 0),t.setOffsets(void 0,void 0)}function P(){y(void 0),u(void 0),g(void 0)}Object(o.useEffect)((function(){function e(e){if(x.current&&T){var t=e.clientX-x.current.getBoundingClientRect().left;g(t)}}function t(e){if(void 0!==s&&x.current){var t=e.clientX,n=e.clientY,r=t-x.current.getBoundingClientRect().left;y({offsetX:r,clientX:t,clientY:n}),k(void 0)}}return T?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[s,T,b]),Object(o.useEffect)((function(){!T&&void 0!==p&&void 0!==s&&Math.abs(p-s)<=3&&P()}),[T,p,s,t.bpPerPx]);var N=Boolean(b);var A=[{label:"Zoom to region",icon:ne.a,onClick:function(){!function(){if(void 0!==s&&void 0!==b){var e=s,n=b.offsetX;if(n<e){var r=[n,e];e=r[0],n=r[1]}var a=t.pxToBp(e),i=t.pxToBp(n);t.moveTo(a,i)}}(),P()}},{label:"Get sequence",disabled:void 0!==p&&void 0!==s&&Math.abs(p-s)*t.bpPerPx>5e8,icon:Ee.a,onClick:function(){!function(){if(void 0!==s&&void 0!==b){var e=s,n=b.offsetX;if(n<e){var r=[n,e];e=r[0],n=r[1]}var a=t.pxToBp(e),i=t.pxToBp(n);t.setOffsets(a,i)}}(),P()}}];if(void 0===s)return c.a.createElement(c.a.Fragment,null,void 0!==j?c.a.createElement(Me,{model:t,coordX:j}):null,c.a.createElement("div",{"data-testid":"rubberBand_controls",className:S.rubberBandControl,role:"presentation",ref:x,onMouseDown:E,onMouseOut:M,onMouseMove:R},r));var F=b?b.offsetX:p||0,I=F<s?F:s,B=Math.abs(F-s),D=t.pxToBp(I),L=t.pxToBp(I+B),V=Math.ceil(B*t.bpPerPx);return c.a.createElement(c.a.Fragment,null,C.current?c.a.createElement(c.a.Fragment,null,c.a.createElement(U.a,{className:S.popover,classes:{paper:S.paper},open:!0,anchorEl:C.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},c.a.createElement(d.a,null,Object(v.stringify)(D))),c.a.createElement(U.a,{className:S.popover,classes:{paper:S.paper},open:!0,anchorEl:C.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},c.a.createElement(d.a,null,Object(v.stringify)(L)))):null,c.a.createElement("div",{ref:C,className:S.rubberBand,style:{left:I,width:B}},c.a.createElement(d.a,{variant:"h6",className:S.rubberBandText},V.toLocaleString("en-US")," bp")),c.a.createElement("div",{"data-testid":"rubberBand_controls",className:S.rubberBandControl,role:"presentation",ref:x,onMouseDown:E,onMouseOut:M,onMouseMove:R},r),b?c.a.createElement(fe.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:b.clientX,top:b.clientY},onMenuItemClick:function(e,t){t(),P()},open:N,onClose:P,menuItems:A}):null)}Pe.defaultProps={ControlComponent:c.a.createElement("div",null)};var Ne=Object(m.observer)(Pe),Ae=n(154),Fe=n(696),Ie=Object(u.a)((function(e){return{scaleBarContainer:{overflow:"hidden",position:"relative"},scaleBarZoomContainer:{position:"relative",zIndex:1},scaleBar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:"11px",zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:"11px",position:"absolute",left:"2px",top:"-1px",fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}})),Be=Object(m.observer)((function(e){var t=e.model,n=Ie(),r=0;return t.staticBlocks.forEach((function(e,n){e.offsetPx-t.offsetPx<0&&(r=n)})),c.a.createElement(c.a.Fragment,null,t.staticBlocks.map((function(e,a){return e instanceof V.b&&(e.isLeftEndOfDisplayedRegion||a===r)?c.a.createElement(d.a,{key:"refLabel-".concat(e.key,"-").concat(a),style:{left:a===r?Math.max(0,-t.offsetPx):e.offsetPx-t.offsetPx-1,paddingLeft:a===r?0:1},className:n.refLabel,"data-testid":"refLabel-".concat(e.refName)},e.refName):null})))})),De=Object(m.observer)((function(e){var t=e.model,n=Ie();return c.a.createElement(c.a.Fragment,null,t.staticBlocks.map((function(e,r){if(e instanceof V.b){var a=H(e.start,e.end,t.bpPerPx,!0,!1);return c.a.createElement(Fe.a,{key:"".concat(e.key,"-").concat(r),block:e},a.map((function(r){if("major"===r.type){var a=(e.reversed?e.end-r.base:r.base-e.start)/t.bpPerPx,i=(r.base+1).toLocaleString("en-US");return c.a.createElement("div",{key:r.base,className:n.tick,style:{left:a}},i?c.a.createElement(d.a,{className:n.majorTickLabel},i):null)}return null})))}return e instanceof V.c?c.a.createElement(Fe.b,{key:e.key,width:e.widthPx}):e instanceof V.d?c.a.createElement(Fe.c,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant}):null})))})),Le=c.a.forwardRef((function(e,t){var n=e.model,r=e.style,a=e.className,i=Object(Ae.a)(e,["model","style","className"]),o=Ie(),s=n.staticBlocks.offsetPx-n.offsetPx;return c.a.createElement(l.a,Object.assign({"data-resizer":"true",className:Object(W.a)(o.scaleBarContainer,a),variant:"outlined",ref:t,style:r},i),c.a.createElement("div",{className:o.scaleBarZoomContainer,style:{transform:1!==n.scaleFactor?"scaleX(".concat(n.scaleFactor,")"):void 0}},c.a.createElement("div",{className:o.scaleBar,style:Object(T.a)({left:s-1,width:n.staticBlocks.totalWidthPx},r)},c.a.createElement(De,{model:n}))),c.a.createElement(Be,{model:n}))})),Ve=Object(m.observer)(Le),We=Object(u.a)((function(e){return{verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.text.hint},minorTick:{background:e.palette.divider}}})),ze=Object(m.observer)((function(e){var t=e.model,n=We();return c.a.createElement(c.a.Fragment,null,t.staticBlocks.map((function(e,r){if(e instanceof V.b){var a=H(e.start,e.end,t.bpPerPx);return c.a.createElement(Fe.a,{key:"".concat(e.key,"-").concat(r),block:e},a.map((function(r){var a=(e.reversed?e.end-r.base:r.base-e.start)/t.bpPerPx;return c.a.createElement("div",{key:r.base,className:Object(W.a)(n.tick,"major"===r.type||"labeledMajor"===r.type?n.majorTick:n.minorTick),style:{left:a}})})))}return e instanceof V.c?c.a.createElement(Fe.b,{key:e.key,width:e.widthPx}):e instanceof V.d?c.a.createElement(Fe.c,{key:e.key,width:e.widthPx,boundary:"boundary"===e.variant}):null})))}));var He=Object(m.observer)((function(e){var t=e.model,n=We(),r=t.staticBlocks.offsetPx-t.offsetPx;return c.a.createElement("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==t.scaleFactor?"scaleX(".concat(t.scaleFactor,")"):void 0}},c.a.createElement("div",{className:n.verticalGuidesContainer,style:{left:r,width:t.staticBlocks.totalWidthPx}},c.a.createElement(ze,{model:t})))})),qe=Object(u.a)((function(){return{centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px black dashed",borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}}));var Ue=Object(m.observer)((function(e){var t=e.model,n=t.bpPerPx,r=t.centerLineInfo,a=t.trackHeights,i=t.tracks,s=t.width,u=Object(o.useRef)(null),l=qe(),d=s/2;return i.length?c.a.createElement("div",{"data-testid":"centerline_container",className:l.centerLineContainer,role:"presentation",ref:u,style:{left:"".concat(d,"px"),width:Math.max(1/n,1)}},r&&c.a.createElement("div",{"data-testid":"centerline_text",className:l.centerLineText,role:"presentation",style:{left:Math.max(1/n,1)+5,top:a}},r.refName,":"," ",Math.max(Math.round(r.offset)+1,0))):null})),_e=Object(u.a)((function(e){return{tracksContainer:{position:"relative",borderRadius:e.shape.borderRadius,overflow:"hidden"},spacer:{position:"relative",height:S.c}}}));var Ge=Object(m.observer)((function(e){var t=e.children,n=e.model,r=_e(),a=Object(o.useRef)(0),i=Object(o.useRef)(!1),s=Object(o.useRef)(),u=Object(o.useRef)(null),l=Object(o.useRef)(0),d=Object(o.useState)(!1),f=Object(q.a)(d,2),p=f[0],g=f[1];return Object(o.useEffect)((function(){var e=function(){};function t(e){e.preventDefault();var t=e.clientX-l.current;t&&(i.current||(i.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(-t),i.current=!1,l.current=e.clientX}))))}function r(){l.current=0,p&&g(!1)}return p&&(window.addEventListener("mousemove",t,!0),window.addEventListener("mouseup",r,!0),e=function(){window.removeEventListener("mousemove",t,!0),window.removeEventListener("mouseup",r,!0)}),e}),[n,p,l]),Object(o.useEffect)((function(){var e=u.current;function t(e){var t=Se()(e);!0===e.ctrlKey?(e.preventDefault(),a.current+=t.pixelY/500,n.setScaleFactor(a.current<0?1-a.current:1/(1+a.current)),s.current&&clearTimeout(s.current),s.current=setTimeout((function(){n.setScaleFactor(1),n.zoomTo(a.current>0?n.bpPerPx*(1+a.current):n.bpPerPx/(1-a.current)),a.current=0}),300)):(Math.abs(t.pixelX)>Math.abs(2*t.pixelY)&&e.preventDefault(),a.current+=t.pixelX,i.current||(i.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(a.current),a.current=0,i.current=!1}))))}return e?(e.addEventListener("wheel",t),function(){e.removeEventListener("wheel",t)}):function(){}}),[n]),c.a.createElement("div",{ref:u,role:"presentation",className:r.tracksContainer,onMouseDown:function(e){var t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(l.current=e.clientX,g(!0))},onMouseUp:function(e){e.preventDefault(),g(!1)},onMouseLeave:function(e){e.preventDefault()}},c.a.createElement(He,{model:n}),n.showCenterLine?c.a.createElement(Ue,{model:n}):null,c.a.createElement(Ne,{model:n,ControlComponent:c.a.createElement(Ve,{model:n,style:{height:S.d,boxSizing:"border-box"}})}),c.a.createElement("div",{className:r.spacer}),t)})),Je=n(2383),Xe=n(2368),Ye=n(2335),Qe=Object(u.a)((function(e){return{importFormContainer:{padding:e.spacing(2)},importFormEntry:{minWidth:180},button:{margin:e.spacing(2)}}})),$e=Object(m.observer)((function(e){var t=e.model,n=Qe(),r=Object(v.getSession)(t),s=r.assemblyNames,u=r.assemblyManager,l=Object(o.useState)(0),d=Object(q.a)(l,2),p=d[0],g=d[1],m=Object(o.useState)(""),b=Object(q.a)(m,2),y=b[0],w=b[1],O=Object(o.useState)([]),j=Object(q.a)(O,2),k=j[0],x=j[1],C=s.length?"":"No configured assemblies",S=Boolean(C),T=s[p],M=T&&!C?p:"";function P(e){var n=k.find((function(e){return y===e.refName}));if(n)t.setDisplayedRegions([n]),t.showAllRegions();else try{e&&t.navToLocString(e,T)}catch(a){console.warn(a),r.notify("".concat(a),"warning")}}return Object(o.useEffect)((function(){var e=!1;return Object(i.a)(a.a.mark((function t(){var n,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!T){t.next=5;break}return t.next=3,u.waitForAssembly(T);case 3:(n=t.sent)&&n.regions&&(r=Object(h.getSnapshot)(n.regions),!e&&r&&(w(r[0].refName),x(r)));case 5:case"end":return t.stop()}}),t)})))(),function(){e=!0}}),[u,T]),c.a.createElement(Je.a,{className:n.importFormContainer},c.a.createElement(Xe.a,{container:!0,spacing:1,justify:"center",alignItems:"center"},c.a.createElement(Xe.a,{item:!0},c.a.createElement(R.a,{select:!0,variant:"outlined",value:M,onChange:function(e){g(Number(e.target.value))},label:"Assembly",helperText:C||"Select assembly to view",error:S,disabled:S,margin:"normal",className:n.importFormEntry},s.map((function(e,t){return c.a.createElement(Ye.a,{key:e,value:t},e)})))),c.a.createElement(Xe.a,{item:!0},T?y&&t.volatileWidth?c.a.createElement(B,{model:t,assemblyName:C?void 0:s[p],value:y,onSelect:w,TextFieldProps:{margin:"normal",variant:"outlined",className:n.importFormEntry,helperText:"Enter a sequence or locstring",onBlur:function(e){w(e.target.value)},onKeyPress:function(e){var t=e.target.value;"Enter"===e.key&&P(t)}}}):c.a.createElement(E.a,{role:"progressbar",color:"inherit",size:20,disableShrink:!0}):null),c.a.createElement(Xe.a,{item:!0},c.a.createElement(f.a,{disabled:!y,className:n.button,onClick:function(){y&&P(y)},variant:"contained",color:"primary"},"Open"),c.a.createElement(f.a,{disabled:!y,className:n.button,onClick:function(){t.showAllRegionsInAssembly(T)},variant:"contained",color:"secondary"},"Show all regions in assembly"))))})),Ke=n(699),Ze=n.n(Ke),et=n(283),tt=Object(m.observer)((function(e){var t=e.model,n=t.bpPerPx,r=t.maxBpPerPx,a=t.minBpPerPx,i=t.scaleFactor,s=Object(o.useState)(),u=Object(q.a)(s,2),d=u[0],f=u[1];return c.a.createElement(c.a.Fragment,null,c.a.createElement(l.a,{style:{background:"#aaa7"}},c.a.createElement(Z.a,{color:"secondary",onClick:function(e){f(e.currentTarget)}},c.a.createElement(Ze.a,null)),c.a.createElement(Z.a,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*n)},disabled:n>=r-1e-4||1!==i,color:"secondary"},c.a.createElement(ae.a,null)),c.a.createElement(Z.a,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:n<=a+1e-4||1!==i,color:"secondary"},c.a.createElement(ne.a,null))),c.a.createElement(et.a,{anchorEl:d,open:Boolean(d),onMenuItemClick:function(e,t){t(),f(void 0)},onClose:function(){f(void 0)},menuItems:t.menuItems}))})),nt=n(698),rt=n(420),at=n.n(rt),it=n(2370),ot=n(2373),ct=n(2360),st=n(2374),ut=n(2376),lt=n(1061),dt=n.n(lt);var ft=Object(u.a)((function(e){return{loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"}}}));function pt(e,t){return gt.apply(this,arguments)}function gt(){return(gt=Object(i.a)(a.a.mark((function e(t,n){var r,i,o,c,s,u,l,d,f,p,g;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object(v.getSession)(t),s=(null===(r=t.leftOffset)||void 0===r?void 0:r.assemblyName)||(null===(i=t.rightOffset)||void 0===i?void 0:i.assemblyName)||"",u=c.rpcManager,l=c.assemblyManager,d=null===(o=l.get(s))||void 0===o?void 0:o.configuration,f=Object(b.readConfObject)(d,["sequence","adapter"]),p="getSequence",e.next=8,Promise.all(n.map((function(e){return u.call(p,"CoreGetFeatures",{adapterConfig:f,region:e,sessionId:p})})));case 8:return g=e.sent,e.abrupt("return",g.map((function(e){return e[0]})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var mt=Object(m.observer)((function(e){var t=e.model,n=e.handleClose,r=ft(),s=Object(v.getSession)(t),u=Object(o.useState)(),l=Object(q.a)(u,2),g=l[0],m=l[1],h=Object(o.useState)(""),b=Object(q.a)(h,2),y=b[0],w=b[1],O=Boolean(!y)||Boolean(g),j=t.leftOffset,k=t.rightOffset,x=Object(o.useMemo)((function(){return t.getSelectedRegions(j,k)}),[t,j,k]);Object(o.useEffect)((function(){var e=!0;function n(e){var t=[],n=[];e.forEach((function(e){var r=e.get("seq"),a=e.get("refName"),i=e.get("start")+1,o=e.get("end"),c="".concat(a,":").concat(i,"-").concat(o);r&&(t.push({header:c,seq:r}),r.length!==o-i+1&&n.push("".concat(c," returned ").concat(r.length.toLocaleString()," bases, but should have returned ").concat((o-i).toLocaleString())))})),n.length>0&&s.notify("Unable to retrieve complete reference sequence from regions:".concat(n.join())),w(t.map((function(e){return">".concat(e.header,"\n").concat(e.seq.replace(/(.{1,80})/g,"$1\n").trimEnd())})).join("\n"))}return Object(i.a)(a.a.mark((function r(){var i;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(x.length>0)){r.next=8;break}return r.next=4,pt(t,x);case 4:i=r.sent,e&&n(i),r.next=9;break;case 8:throw new Error("Selected region is out of bounds");case 9:r.next=15;break;case 11:r.prev=11,r.t0=r.catch(0),console.error(r.t0),e&&m(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,11]])})))(),function(){e=!1}}),[t,s,x,w]);var C=y.length>1e6;return c.a.createElement(it.a,{"data-testid":"sequence-dialog",maxWidth:"xl",open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},c.a.createElement(ot.a,{id:"alert-dialog-title"},"Reference sequence",n?c.a.createElement(Z.a,{"data-testid":"close-seqDialog",className:r.closeButton,onClick:function(){n(),t.setOffsets(void 0,void 0)}},c.a.createElement(ye.a,null)):null),c.a.createElement(ct.a,null),c.a.createElement(st.a,null,g?c.a.createElement(d.a,{color:"error"},"".concat(g)):null,O&&!g?c.a.createElement(Je.a,null,"Retrieving reference sequence...",c.a.createElement(E.a,{style:{marginLeft:10},size:20,disableShrink:!0})):null,void 0!==y?c.a.createElement(R.a,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,rows:3,rowsMax:5,disabled:C,className:r.dialogContent,fullWidth:!0,value:C?"Reference sequence too large to display, use the download FASTA button":y,InputProps:{readOnly:!0,classes:{input:r.textAreaFont}}}):null),c.a.createElement(ut.a,null,c.a.createElement(f.a,{onClick:function(){at()(y||""),s.notify("Copied to clipboard","success")},disabled:O||C,color:"primary",startIcon:c.a.createElement(p.a,null)},"Copy to clipboard"),c.a.createElement(f.a,{onClick:function(){var e=new Blob([y||""],{type:"text/x-fasta;charset=utf-8"});Object(nt.saveAs)(e,"jbrowse_ref_seq.fa")},disabled:O,color:"primary",startIcon:c.a.createElement(dt.a,null)},"Download FASTA"),c.a.createElement(f.a,{onClick:function(){n(),t.setOffsets(void 0,void 0)},color:"primary",autoFocus:!0},"Close")))}));function ht(e){return e<999?String(e):"".concat(ht(~~(e/1e3)),",").concat("00".concat(~~(e%1e3)).substr(-3,3))}var bt=Object(u.a)((function(){return{majorTickLabel:{fontSize:"11px"},majorTick:{stroke:"#555"},minorTick:{stroke:"#999"}}}));function vt(e){var t=e.start,n=e.end,r=e.bpPerPx,a=e.reversed,i=e.major,o=e.minor,s=bt(),u=H(t,n,r,i,o);return c.a.createElement(c.a.Fragment,null,u.map((function(e){var i=(a?n-e.base:e.base-t)/r;return c.a.createElement("line",{key:e.base,x1:i,x2:i,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:"major"===e.type?"#555":"#999",className:"major"===e.type?s.majorTick:s.minorTick,"data-bp":e.base})})),u.filter((function(e){return"major"===e.type})).map((function(e){var i=(a?n-e.base:e.base-t)/r;return c.a.createElement("text",{x:i-3,y:18,key:"label-".concat(e.base),style:{fontSize:"11px"},className:s.majorTickLabel},ht(e.base+1))})))}vt.defaultProps={reversed:!1,major:!0,minor:!0};var yt=Object(m.observer)(vt),wt=Object(u.a)((function(e){return{errorMessage:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},spacer:{marginRight:e.spacing(2)}}})),Ot=Object(m.observer)((function(e){var t=e.model,n=t.tracks,r=t.error,a=t.hideHeader,i=t.initialized,o=t.hasDisplayedRegions,s=wt();return i?o?c.a.createElement("div",{style:{position:"relative"}},t.isSeqDialogDisplayed?c.a.createElement(mt,{model:t,handleClose:function(){t.setOffsets(void 0,void 0)}}):null,a?c.a.createElement("div",{style:{position:"absolute",right:0,zIndex:1001}},c.a.createElement(tt,{model:t})):c.a.createElement(de,{model:t}),r?c.a.createElement(l.a,{variant:"outlined",className:s.errorMessage},c.a.createElement(d.a,{color:"error"},r.message)):c.a.createElement(c.a.Fragment,null,c.a.createElement(Ge,{model:t},n.length?n.map((function(e){return c.a.createElement(xe,{key:e.id,model:t,track:e})})):c.a.createElement(l.a,{variant:"outlined",className:s.errorMessage},c.a.createElement(d.a,null,"No tracks active."),c.a.createElement(f.a,{variant:"contained",color:"primary",onClick:t.activateTrackSelector,style:{zIndex:1e3}},c.a.createElement(p.b,{className:s.spacer}),"Open track selector"))))):c.a.createElement($e,{model:t}):null}));t.default=Ot;function jt(e){var t,n=e.model,r=e.fontSize,a=n.offsetPx,i=n.dynamicBlocks,o=i.totalWidthPxWithoutBorders,s=i.totalBp;t=Math.floor(s/1e6)>0?"".concat(parseFloat((s/1e6).toPrecision(3)),"Mbp"):Math.floor(s/1e3)>0?"".concat(parseFloat((s/1e3).toPrecision(3)),"Kbp"):"".concat(Math.floor(s),"bp");var u=Math.max(-a,0),l=u+o;return c.a.createElement(c.a.Fragment,null,c.a.createElement("line",{x1:u,x2:l,y1:10,y2:10,stroke:"black"}),c.a.createElement("line",{x1:u,x2:u,y1:5,y2:15,stroke:"black"}),c.a.createElement("line",{x1:l,x2:l,y1:5,y2:15,stroke:"black"}),c.a.createElement("text",{x:u+(l-u)/2,y:2*r,textAnchor:"middle",fontSize:r},t))}function kt(e){var t=e.model,n=e.fontSize,r=(e.rulerHeight,e.width),a=t.dynamicBlocks.contentBlocks,i=t.offsetPx,o=t.bpPerPx,s=a.length<5;return c.a.createElement(c.a.Fragment,null,c.a.createElement("defs",null,c.a.createElement("clipPath",{id:"clip-ruler"},c.a.createElement("rect",{x:0,y:0,width:r,height:20}))),a.map((function(e){var t=e.offsetPx-i;return c.a.createElement("g",{key:"".concat(e.key),transform:"translate(".concat(t," 0)")},c.a.createElement("text",{x:t/o,y:n,fontSize:n},e.refName),s?c.a.createElement("g",{transform:"translate(0 20)",clipPath:"url(#clip-ruler)"},c.a.createElement(yt,{start:e.start,end:e.end,bpPerPx:o,reversed:e.reversed})):c.a.createElement("line",{strokeWidth:1,stroke:"black",x1:e.start/o,x2:e.end/o,y1:20,y2:20}))})))}var xt=15,Ct=function(e){return e.reduce((function(e,t){return e+t.displays[0].height+20+20}),0)},St=function(e){var t=e.model,n=t.width,r=t.assemblyNames,a=r.length>1?"":r[0];return c.a.createElement("g",{id:"header"},c.a.createElement("text",{x:0,y:xt,fontSize:xt},a),c.a.createElement("g",{transform:"translate(0 ".concat(xt,")")},c.a.createElement(jt,{model:t,fontSize:xt})),c.a.createElement("g",{transform:"translate(0 ".concat(50,")")},c.a.createElement(kt,{model:t,fontSize:xt,rulerHeight:50,width:n})))},Tt=function(e){var t=e.model,n=t.dynamicBlocks,r=t.tracks,a=Ct(r);return c.a.createElement(c.a.Fragment,null,n.contentBlocks.slice(1).map((function(e){return c.a.createElement("line",{key:e.key,x1:e.offsetPx-t.offsetPx,x2:e.offsetPx-t.offsetPx,y1:110,y2:a,stroke:"black",strokeOpacity:.3})})))};function Et(e){var t=e.displayResults,n=e.model,r=e.offset;return c.a.createElement(c.a.Fragment,null,t.map((function(e){var t=e.track,a=e.result,i=r,o=Object(b.getConf)(t,"name")||"Reference sequence (".concat(Object(b.readConfObject)(Object(h.getParent)(t.configuration),"name"),")"),s=t.displays[0];return r+=s.height+20+20,c.a.createElement("g",{key:t.configuration.trackId,transform:"translate(0 ".concat(i,")")},c.a.createElement("text",{fontSize:xt,x:Math.max(-n.offsetPx,0)},o),c.a.createElement("g",{transform:"translate(0 ".concat(20,")")},a))})))}function Rt(e,t){return Mt.apply(this,arguments)}function Mt(){return(Mt=Object(i.a)(a.a.mark((function e(t,n){var r,o,u,l,d,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.when)((function(){return t.initialized}));case 2:return r=t.width,o=t.tracks,u=50,l=110,d=Ct(o)+l,e.next=8,Promise.all(o.map(function(){var e=Object(i.a)(a.a.mark((function e(t){var r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.displays[0],e.next=3,Object(g.when)((function(){return void 0===r.ready||r.ready}));case 3:return e.next=5,r.renderSvg(n);case 5:return i=e.sent,e.abrupt("return",{track:t,result:i});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return f=e.sent,e.abrupt("return",Object(s.renderToStaticMarkup)(c.a.createElement("svg",{width:r,height:d,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,r+2*u,d].toString()},c.a.createElement("rect",{width:r+2*u,height:d,fill:"white"}),c.a.createElement("g",{stroke:"none",transform:"translate(".concat(u," ").concat(xt,")")},c.a.createElement(St,{model:t}),c.a.createElement(Et,{model:t,displayResults:f,offset:l}),c.a.createElement(Tt,{model:t})))));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},678:function(e,t,n){"use strict";n.d(t,"g",(function(){return o})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"f",(function(){return f}));var r=n(102),a=n(87),i=n(345);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide conf object to read");if(!t)return Object(a.getSnapshot)(e);if("string"===typeof t){var r=e[t];if(!r&&Object(a.isStateTreeNode)(e)&&Object(a.isMapType)(Object(a.getType)(e))&&(r=e.get(t)),!r)return;if(r.expr){var i=r.expr.evalSync(n);return Object(a.isStateTreeNode)(i)?Object(a.getSnapshot)(i):i}return Object(a.isStateTreeNode)(r)?Object(a.getSnapshot)(r):r}var c=t[0];if(t.length>1){var s=t.slice(1),u=e[c];if(!u&&Object(a.isStateTreeNode)(e)&&Object(a.isMapType)(Object(a.getType)(e))&&(u=e.get(c)),!u)return;return o(u,s,n)}return o(e,c,n)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide a model object");var r=e,a=r.configuration;if(d(a))return o(a,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if(Object(a.isType)(e)&&(e=Object(i.resolveLateType)(e),Object(a.isUnionType)(e))){var t=[];return Object(i.getUnionSubTypes)(e).forEach((function(e){var n=s(e=Object(i.resolveLateType)(e));n.length||(n=[Object(i.getDefaultValue)(e).type]);if(!n[0])throw new Error("invalid config schema type ".concat(e));t.push.apply(t,Object(r.a)(n))})),t}return[]}function u(e){if(Object(a.isType)(e)){if(Object(a.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if(Object(a.isLateType)(e))return!0}return!1}function l(e){return!!Object(a.isType)(e)&&(!!u(e)||(Object(a.isUnionType)(e)?Object(i.getUnionSubTypes)(e).every((function(e){return l(e)||"undefined"===e.name})):!(!Object(a.isOptionalType)(e)||!l(Object(i.getSubType)(e)))||(!(!Object(a.isArrayType)(e)||!l(Object(i.getSubType)(e)))||!(!Object(a.isMapType)(e)||!l(Object(i.getSubType)(e))))))}function d(e){return Object(a.isStateTreeNode)(e)&&l(Object(a.getType)(e))}function f(e){return"object"===typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},688:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(82),a=n(354),i=n(83),o=n(355);function c(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=e.offsetPx,s=e.displayedRegions,u=e.bpPerPx,l=e.width,d=e.minimumBlockWidth,f=e.interRegionPaddingWidth;if(!l)throw new Error("view has no width, cannot calculate displayed blocks");var p=new o.a,g=0,m=c,h=m+l;return s.forEach((function(e,b){var v=e.assemblyName,y=e.refName,w=e.start,O=e.end,j=e.reversed,k=g+(O-w)/u,x=(O-w)/u;if(g<h&&k>m){var C,S,T,E,R,M=Object(a.b)(m,h,g,k),P=Object(r.a)(M,2),N=P[0],A=P[1];j?(C=Math.max(w,O-(A-g)*u),T=(S=O-(N-g)*u)===O,E=C===w,R=g+(O-S)/u):(T=(C=(N-g)*u+w)===w,E=(S=Math.min(O,(A-g)*u+w))===O,R=g+(C-w)/u);var F={assemblyName:v,refName:y,start:C,end:S,reversed:j,offsetPx:R,parentRegion:e,regionNumber:b,widthPx:(S-C)/u,isLeftEndOfDisplayedRegion:T,isRightEndOfDisplayedRegion:E,key:""};F.key="".concat(Object(i.assembleLocString)(F),"-").concat(b).concat(j?"-reversed":""),t&&0===p.length&&T&&p.push(new o.d({key:"".concat(F.key,"-beforeFirstRegion"),widthPx:-c,offsetPx:F.offsetPx+c,variant:"boundary"})),n&&x<d?p.push(new o.c(F)):p.push(new o.b(F)),t&&(x>=d&&F.isRightEndOfDisplayedRegion&&b<s.length-1&&(p.push(new o.d({key:"".concat(F.key,"-rightpad"),widthPx:f,offsetPx:F.offsetPx+F.widthPx})),g+=f),b===s.length-1&&F.isRightEndOfDisplayedRegion&&(R=F.offsetPx+F.widthPx,p.push(new o.d({key:"".concat(F.key,"-afterLastRegion"),widthPx:l-R+c,offsetPx:R,variant:"boundary"}))))}g+=(O-w)/u})),p}},690:function(e,t,n){"use strict";var r=n(82),a=n(1),i=n.n(a),o=n(2348),c=n(2368),s=n(2350),u=n(2347),l=n(2337),d=n(2338),f=n(2463),p=n(2369),g=n(84),m=n(83),h=n(119);function b(e){return"uri"in e}function v(e){return"blobId"in e}var y=Object(g.observer)((function(e){var t=e.location,n=e.name,u=e.description,l=!t||b(t)?"url":"file",d=Object(a.useState)(l),g=Object(r.a)(d,2),m=g[0],h=g[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement(o.a,{shrink:!0,htmlFor:"callback-editor"},n),i.a.createElement(c.a,{container:!0,spacing:1,direction:"row",alignItems:"center"},i.a.createElement(c.a,{item:!0},i.a.createElement(f.a,{value:m,exclusive:!0,onChange:function(e,t){h("url"===t?"url":"file")},"aria-label":"file or url picker"},i.a.createElement(p.a,{value:"file","aria-label":"local file"},"File"),i.a.createElement(p.a,{value:"url","aria-label":"url"},"URL"))),i.a.createElement(c.a,{item:!0},"url"===m?i.a.createElement(w,e):i.a.createElement(O,e))),i.a.createElement(s.a,null,u))})),w=function(e){var t=e.location,n=e.setLocation;return i.a.createElement(u.a,{fullWidth:!0,inputProps:{"data-testid":"urlInput"},defaultValue:t&&b(t)?t.uri:"",onChange:function(e){return n({uri:e.target.value})}})},O=Object(g.observer)((function(e){var t=e.location,n=e.setLocation,r=t&&(v(t)&&t.name||function(e){return"localPath"in e}(t)&&t.localPath),a=t&&v(t)&&!Object(h.getBlob)(t.blobId);return i.a.createElement("div",{style:{position:"relative"}},i.a.createElement(l.a,{variant:"outlined",component:"label"},"Choose File",i.a.createElement("input",{type:"file",style:{position:"absolute",top:0,left:0,width:"100%",opacity:0},onChange:function(e){var t=e.target,r=t&&t.files&&t.files[0];r&&(m.isElectron?n({localPath:r.path}):n(Object(h.storeBlobLocation)({blob:r})))}})),r?i.a.createElement(i.a.Fragment,null,i.a.createElement(d.a,{style:{marginLeft:"0.4rem"},variant:"body1",component:"span"},r),a?i.a.createElement(d.a,{color:"error"},"(need to reload)"):null):null)}));t.a=y},692:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return x}));var r,a,i,o=n(88),c=n.n(o),s=n(91),u=n(102),l=n(82),d=n(89),f=n(92),p=n(1),g=n.n(p),m=n(526),h=n.n(m),b=n(527),v=n.n(b),y="undefined"!==typeof window&&Boolean(window.electron),w="function"===typeof OffscreenCanvas,O=!1,j=function(){function e(t,n){Object(d.a)(this,e),this.width=t,this.height=n,this.commands=[],this.currentFont="12px Courier New, monospace"}return Object(f.a)(e,[{key:"strokeStyle",set:function(e){e!==this.currentStrokeStyle&&(this.commands.push({type:"strokeStyle",style:e}),this.currentStrokeStyle=e)}},{key:"fillStyle",set:function(e){e!==this.currentFillStyle&&(this.commands.push({type:"fillStyle",style:e}),this.currentFillStyle=e)}},{key:"font",set:function(e){this.currentFont=e,this.commands.push({type:"font",style:e})}},{key:"arc",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"arc",args:t})}},{key:"arcTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"arcTo",args:t})}},{key:"beginPath",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"beginPath",args:t})}},{key:"clearRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"clearRect",args:t})}},{key:"clip",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"clip",args:t})}},{key:"closePath",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"closePath",args:t})}},{key:"createLinearGradient",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createLinearGradient",args:t})}},{key:"createPattern",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createPattern",args:t})}},{key:"createRadialGradient",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createRadialGradient",args:t})}},{key:"drawFocusIfNeeded",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"drawFocusIfNeeded",args:t})}},{key:"drawImage",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"drawImage",args:t})}},{key:"ellipse",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"ellipse",args:t})}},{key:"fill",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"fill",args:t})}},{key:"fillRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1],i=t[2],o=t[3];if(!(r>this.width||r+i<0)){var c=Math.max(r,0),s=c+i>this.width?this.width-c:i;this.commands.push({type:"fillRect",args:[c,a,s,o]})}}},{key:"fillText",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"fillText",args:t})}},{key:"lineTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"lineTo",args:t})}},{key:"measureText",value:function(e){var t=+this.currentFont.match(/\d+/)[0];return{width:t/2*e.length,height:t}}},{key:"moveTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"moveTo",args:t})}},{key:"quadraticCurveTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"quadraticCurveTo",args:t})}},{key:"rect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"rect",args:t})}},{key:"restore",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"restore",args:t})}},{key:"rotate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"rotate",args:t})}},{key:"save",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"save",args:t})}},{key:"setLineDash",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"setLineDash",args:t})}},{key:"setTransform",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"setTransform",args:t})}},{key:"scale",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"scale",args:t})}},{key:"stroke",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"stroke",args:t})}},{key:"strokeRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"strokeRect",args:t})}},{key:"strokeText",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"strokeText",args:t})}},{key:"transform",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"transform",args:t})}},{key:"translate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"translate",args:t})}}]),e}();function k(e){var t=v()(e);return{hex:t.hex(),opacity:t.alpha()}}var x=function(){function e(t,n){Object(d.a)(this,e),this.width=t,this.height=n}return Object(f.a)(e,[{key:"getContext",value:function(e){if("2d"!==e)throw new Error("unknown type ".concat(e));return this.context=new j(this.width,this.height),this.context}},{key:"getSerializedSvg",value:function(){var e,t,n,r,a=[],i=[];return this.context.commands.forEach((function(o,c){if("font"===o.type&&o.style){var s=function(e){var t,n=null,r=null,a="normal",i="normal",o="normal",c="normal",s=e.split(/\s+/);e:for(;t=s.shift();)switch(t){case"normal":break;case"italic":case"oblique":a=t;break;case"small-caps":o=t;break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":i=t;break;default:if(!r){var u=t.split("/");r=u[0],u.length>1&&(c=u[1]);break}n=t,s.length&&(n+=" ".concat(s.join(" ")));break e}return{fontStyle:a,fontVariant:o,fontWeight:i,fontSize:r,lineHeight:c,fontFamily:n}}(o.style),d=s.fontStyle,f=s.fontFamily,p=s.fontSize;r={fontStyle:d,fontFamily:f,fontSize:p}}if("fillStyle"===o.type&&o.style&&(e=o.style),"strokeStyle"===o.type&&o.style&&(t=o.style),"fillRect"===o.type){var m=Object(l.a)(o.args,4),b=m[0],v=m[1],y=m[2],w=m[3],O=k(e),j=O.hex,x=O.opacity,C=Math.min(v,v+w),S=Math.abs(w);i.push(g.a.createElement("rect",{key:c,fill:j,fillOpacity:1!==x?x:void 0,x:b.toFixed(3),y:C.toFixed(3),width:y.toFixed(3),height:S.toFixed(3)}))}if("fillText"===o.type){var T=Object(l.a)(o.args,3),E=T[0],R=T[1],M=T[2],P=k(e),N=P.hex,A=P.opacity;i.push(g.a.createElement("text",Object.assign({key:c,fill:N,fillOpacity:1!==A?A:void 0,x:R.toFixed(3),y:M.toFixed(3)},r),E))}if("beginPath"===o.type&&(a=[]),"moveTo"===o.type&&a.push(o.args),"lineTo"===o.type&&a.push(o.args),o.type,"fill"===o.type){for(var F,I=(F=h()()).moveTo.apply(F,Object(u.a)(a[0])),B=1;B<a.length;B++){var D;I=(D=I).lineTo.apply(D,Object(u.a)(a[B]))}I.end();var L=k(e),V=L.hex,W=L.opacity;i.push(g.a.createElement("path",{key:c,fill:V,d:I,fillOpacity:1!==W?W:void 0}))}if("stroke"===o.type){for(var z,H=(z=h()()).moveTo.apply(z,Object(u.a)(a[0])),q=1;q<a.length;q++){var U;H=(U=H).lineTo.apply(U,Object(u.a)(a[q]))}H.end();var _=k(t),G=_.hex,J=_.opacity;i.push(g.a.createElement("path",{key:c,fill:"none",stroke:G,fillOpacity:1!==J?J:void 0,d:H}))}"rotate"===o.type&&(n=180*o.args[0]/Math.PI)})),n?g.a.createElement("g",{transform:"rotate(".concat(n,")")},[].concat(i)):g.a.createElement(g.a.Fragment,null,[].concat(i))}}]),e}();if(y)r=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},a=function(){var e=Object(s.a)(c.a.mark((function e(t){var n=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.length<=1||!(n.length-1)){e.next=2;break}throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");case 2:return e.abrupt("return",{dataURL:t.toDataURL()});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=Image;else if(w)r=function(e,t){return new OffscreenCanvas(e,t)},a=window.createImageBitmap||self.createImageBitmap,i=window.ImageBitmap||self.ImageBitmap;else if(O){var C=n(1582),S=C.createCanvas,T=C.Image;r=S,a=function(){var e=Object(s.a)(c.a.mark((function e(t){var n,r,a=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.length<=1||!(a.length-1)){e.next=2;break}throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");case 2:return n=t.toDataURL(),r=new T,e.abrupt("return",new Promise((function(e,t){r.onload=function(){return e(r)},r.onerror=t,r.src=n})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=T}else r=function(e,t){return new x(e,t)},a=function(e){return e.context},i="string"},696:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d}));var r=n(90),a=n(51),i=n(84),o=n(1),c=n.n(o),s=Object(a.a)((function(e){return{contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.primary},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}})),u=Object(i.observer)((function(e){var t=e.block,n=e.children,r=s();return c.a.createElement("div",{style:{width:"".concat(t.widthPx,"px")},className:r.contentBlock},n)}));function l(e){var t=e.width,n=s();return c.a.createElement("div",{className:n.elidedBlock,style:{width:"".concat(t,"px")}})}function d(e){var t=e.boundary,n=e.width,a=e.style,i=void 0===a?{}:a,o=s();return c.a.createElement("div",{style:Object(r.a)(Object(r.a)({},i),{},{width:"".concat(n,"px")}),className:t?o.boundaryPaddingBlock:o.interRegionPaddingBlock})}},720:function(e,t,n){"use strict";function r(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function a(e,t,n){return r(e,t)||r(e,n)}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var i={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}}},728:function(e,t,n){"use strict";var r=n(82),a=n(83),i=n(1008),o=n(2350),c=n(2348),s=n(51),u=n(160),l=n(84),d=n(1),f=n.n(d),p=n(1079),g=n.n(p),m=n(2447),h=n(1704),b=n.n(h),v=n(1706),y=n.n(v),w=n(1707),O=n.n(w);m.a.registerLanguage("json",b.a);var j="12px",k='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',x=Object(s.a)({callbackEditor:{fontFamily:k,fontSize:j,overflowX:"auto",marginTop:"16px",borderBottom:"1px solid rgba(0,0,0,0.42)"},syntaxHighlighter:{margin:0,fontFamily:k,fontSize:j},error:{color:"red",fontSize:"0.8em"}});t.a=Object(l.observer)((function(e){var t=e.slot,n=x(),s=Object(u.a)(),l=Object(d.useState)(JSON.stringify(t.value,null,"  ")),p=Object(r.a)(l,2),h=p[0],b=p[1],v=Object(d.useState)(),w=Object(r.a)(v,2),j=w[0],k=w[1],C=Object(a.useDebounce)(h,400);return Object(d.useEffect)((function(){try{t.set(JSON.parse(C)),k(void 0)}catch(e){k(e.message)}}),[C]),f.a.createElement(f.a.Fragment,null,j?f.a.createElement("p",{className:n.error},j):null,f.a.createElement(i.a,{error:j},f.a.createElement(c.a,{shrink:!0,htmlFor:"callback-editor"},t.name),f.a.createElement(g.a,{className:n.callbackEditor,value:h,onValueChange:b,highlight:function(e){return f.a.createElement(m.a,{language:"json",style:"dark"===s.palette.type?y.a:O.a,className:n.syntaxHighlighter,customStyle:{background:"none",padding:0}},e)},padding:10,style:{}}),f.a.createElement(o.a,null,t.description)))}))},732:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(90),a=n(82),i=n(102),o=n(89),c=n(92),s=function(){function e(t){Object(o.a)(this,e),this.variant=void 0,this.parser=void 0,this.data=void 0,this._id=void 0,this.variant=t.variant,this.parser=t.parser,this.data=this.dataFromVariant(this.variant),this._id=t.id}return Object(c.a)(e,[{key:"get",value:function(e){return"samples"===e?this.variant.SAMPLES:this.data[e]||this.variant[e]}},{key:"set",value:function(){}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"tags",value:function(){return[].concat(Object(i.a)(Object.keys(this.data)),Object(i.a)(Object.keys(this.variant)),["samples"])}},{key:"id",value:function(){return this._id}},{key:"dataFromVariant",value:function(e){var t=e.REF,n=e.ALT,r=e.POS,i=e.CHROM,o=e.INFO,c=e.ID,s=r-1,u=this._getSOTermAndDescription(t,n),l=Object(a.a)(u,2),d=l[0],f=l[1],p=n&&n.some((function(e){return"<TRA>"===e}));return{refName:i,start:s,end:n&&n.some((function(e){return"string"===typeof e&&-1!==e.indexOf("<")}))&&o.END&&!p?+o.END[0]:s+t.length,description:f,type:d,name:c?c[0]:void 0,aliases:c&&c.length>1?e.ID.slice(1):void 0}}},{key:"_getSOTermAndDescription",value:function(e,t){var n=this;if(!t||t===[])return["remark","no alternative alleles"];var r=new Set,o=new Set;if(t.forEach((function(t){var i=n._getSOAndDescFromAltDefs(e,t),c=Object(a.a)(i,2),s=c[0],u=c[1];if(!s){var l=n._getSOAndDescByExamination(e,t),d=Object(a.a)(l,2);s=d[0],u=d[1]}s&&u&&(r.add(s),o.add(u))})),o.size>1){var c=new Set;o.forEach((function(e){var t=/(\w+? \w+? -> )(?:<)\w+(?:>)/.exec(e);t&&t[1]?c.add(t[1]):c.add(e)}));var s=[];Object(i.a)(c).forEach((function(e){var t=[];Object(i.a)(o).forEach((function(n){n.startsWith(e)&&t.push(n.slice(e.length))})),s.push(e+t.join(","))})),o=new Set(s)}return r.size?[Object(i.a)(r).join(","),Object(i.a)(o).join(",")]:[void 0,void 0]}},{key:"_getSOAndDescFromAltDefs",value:function(t,n){if("object"===typeof n)return["breakend","A VCF breakend defines one end of a point of structural variation"];if("string"===typeof n&&!n.startsWith("<"))return[void 0,void 0];n=n.replace(/^<|>$/g,"");var r=e._altTypeToSO[n];if(!r&&this.parser.getMetadata("ALT",n)&&(r="sequence_variant"),r){var a=this.parser.getMetadata("ALT",n,"Description");return[r,a?"".concat(n," - ").concat(a):this._makeDescriptionString(r,t,n)]}var i=n.split(":");return i.length>1?this._getSOAndDescFromAltDefs(t,"<".concat(i.slice(0,i.length-1).join(":"),">")):[void 0,void 0]}},{key:"_getSOAndDescByExamination",value:function(e,t){return"object"===typeof t?["breakend",this._makeDescriptionString("breakend",e,t)]:1===e.length&&1===t.length?["SNV",this._makeDescriptionString("SNV",e,t)]:e.length===t.length?e.split("").reverse().join("")===t?["inversion",this._makeDescriptionString("inversion",e,t)]:["substitution",this._makeDescriptionString("substitution",e,t)]:e.length<=t.length?["insertion",this._makeDescriptionString("insertion",e,t)]:e.length>t.length?["deletion",this._makeDescriptionString("deletion",e,t)]:["indel",this._makeDescriptionString("indel",e,t)]}},{key:"_makeDescriptionString",value:function(e,t,n){return"".concat(e," ").concat(t," -> ").concat(n)}},{key:"toJSON",value:function(){return Object(r.a)(Object(r.a)(Object(r.a)({uniqueId:this._id},this.variant),this.data),{},{samples:this.variant.SAMPLES})}}]),e}();s._altTypeToSO={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"}},81:function(e,t,n){"use strict";n.r(t);var r=n(335);n.d(t,"ConfigurationSchema",(function(){return r.b})),n.d(t,"ConfigurationReference",(function(){return r.a}));var a=n(678);n.d(t,"readConfObject",(function(){return a.g})),n.d(t,"getConf",(function(){return a.a})),n.d(t,"getTypeNamesFromExplicitlyTypedUnion",(function(){return a.b})),n.d(t,"isBareConfigurationSchemaType",(function(){return a.c})),n.d(t,"isConfigurationSchemaType",(function(){return a.e})),n.d(t,"isConfigurationModel",(function(){return a.d})),n.d(t,"isConfigurationSlotType",(function(){return a.f}))},83:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"inDevelopment",(function(){return k})),n.d(t,"inProduction",(function(){return x})),n.d(t,"toUrlSafeB64",(function(){return C})),n.d(t,"fromUrlSafeB64",(function(){return S})),n.d(t,"useDebounce",(function(){return T})),n.d(t,"useDebouncedCallback",(function(){return E})),n.d(t,"findParentThat",(function(){return R})),n.d(t,"springAnimate",(function(){return M})),n.d(t,"findParentThatIs",(function(){return P})),n.d(t,"getSession",(function(){return N})),n.d(t,"getContainingView",(function(){return A})),n.d(t,"getContainingTrack",(function(){return F})),n.d(t,"getContainingDisplay",(function(){return I})),n.d(t,"assembleLocString",(function(){return B})),n.d(t,"parseLocStringOneBased",(function(){return D})),n.d(t,"parseLocString",(function(){return L})),n.d(t,"compareLocs",(function(){return V})),n.d(t,"compareLocStrings",(function(){return W})),n.d(t,"clamp",(function(){return z})),n.d(t,"bpToPx",(function(){return q})),n.d(t,"radToDeg",(function(){return G})),n.d(t,"degToRad",(function(){return J})),n.d(t,"polarToCartesian",(function(){return X})),n.d(t,"cartesianToPolar",(function(){return Y})),n.d(t,"featureSpanPx",(function(){return Q})),n.d(t,"bpSpanPx",(function(){return $})),n.d(t,"objectFromEntries",(function(){return K})),n.d(t,"iterMap",(function(){return Z})),n.d(t,"mergeConfigs",(function(){return ee})),n.d(t,"findLastIndex",(function(){return te})),n.d(t,"makeAbortableReaction",(function(){return ne})),n.d(t,"renameRegionIfNeeded",(function(){return re})),n.d(t,"renameRegionsIfNeeded",(function(){return ae})),n.d(t,"minmax",(function(){return oe})),n.d(t,"stringify",(function(){return ce})),n.d(t,"isElectron",(function(){return se})),n.d(t,"revcom",(function(){return ue})),n.d(t,"complement",(function(){return le})),n.d(t,"blobToDataURL",(function(){return de})),n.d(t,"rIC",(function(){return fe})),n.d(t,"measureText",(function(){return pe})),n.d(t,"defaultStarts",(function(){return ge})),n.d(t,"defaultStops",(function(){return me})),n.d(t,"defaultCodonTable",(function(){return he})),n.d(t,"generateCodonTable",(function(){return be})),n.d(t,"updateStatus",(function(){return ve})),n.d(t,"hashCode",(function(){return we})),n.d(t,"objectHash",(function(){return Oe}));var r=n(90),a=n(88),i=n.n(a),o=n(91),c=n(106),s=n(102),u=n(82),l=n(962),d=n(87),f=n(112),p=n(963),g=n(1487),m=n.n(g),h=n(1),b=n(982),v=n.n(b),y=n(312),w=n(514);for(var O in y)["default","inDevelopment","inProduction","toUrlSafeB64","fromUrlSafeB64","useDebounce","useDebouncedCallback","findParentThat","springAnimate","findParentThatIs","getSession","getContainingView","getContainingTrack","getContainingDisplay","assembleLocString","parseLocStringOneBased","parseLocString","compareLocs","compareLocStrings","clamp","bpToPx","radToDeg","degToRad","polarToCartesian","cartesianToPolar","featureSpanPx","bpSpanPx","objectFromEntries","iterMap","mergeConfigs","findLastIndex","makeAbortableReaction","renameRegionIfNeeded","renameRegionsIfNeeded","minmax","stringify","isElectron","revcom","complement","blobToDataURL","rIC","measureText","defaultStarts","defaultStops","defaultCodonTable","generateCodonTable","updateStatus","hashCode","objectHash"].indexOf(O)<0&&function(e){n.d(t,e,(function(){return y[e]}))}(O);n.d(t,"checkAbortSignal",(function(){return w.b})),n.d(t,"abortBreakPoint",(function(){return w.a})),n.d(t,"makeAbortError",(function(){return w.d})),n.d(t,"observeAbortSignal",(function(){return w.e})),n.d(t,"isAbortException",(function(){return w.c}));var j=n(986);n.d(t,"when",(function(){return j.a})),n.d(t,"whenPresent",(function(){return j.b})),Object.fromEntries||m.a.shim();var k="object"===typeof e&&Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})&&!1,x=!k;function C(e){var t=(new TextEncoder).encode(e),n=Object(p.deflate)(t),r=Object(l.fromByteArray)(n),a=r.indexOf("=");return a>0?r.slice(0,a).replace(/\+/g,"-").replace(/\//g,"_"):r.replace(/\+/g,"-").replace(/\//g,"_")}function S(e){var t=function(e){var t=0;switch(e.length%4){case 3:t=1;break;case 2:t=2;break;case 0:t=0;break;default:throw new Error("base64 not a valid length")}return e+"=".repeat(t)}(e.replace(/-/g,"+").replace(/_/g,"/")),n=Object(l.toByteArray)(t),r=Object(p.inflate)(n);return(new TextDecoder).decode(r)}function T(e,t){var n=Object(h.useState)(e),r=Object(u.a)(n,2),a=r[0],i=r[1];return Object(h.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),a}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=Object(h.useRef)(),r=Object(h.useRef)();function a(){r.current&&clearTimeout(r.current)}return Object(h.useEffect)((function(){return a}),[]),function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];n.current=o,a(),r.current=setTimeout((function(){n.current&&e.apply(void 0,Object(s.a)(n.current))}),t)}}function R(e,t){for(var n=e;n&&Object(d.isAlive)(n);){if(t(n))return n;if(!Object(d.hasParent)(n))break;n=Object(d.getParent)(n)}throw new Error("no matching node found")}function M(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:170,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:26,s=1;function u(e){var l=Date.now(),d=e.lastPosition,f=e.lastTime||l,p=e.lastVelocity||0;l>f+64&&(f=l);for(var g=Math.floor(l-f),m=0;m<g;++m){d+=1*(p+=1*((-o*(d-t)+-c*p)/s)/1e3)/1e3}var h=Math.abs(p)<=i,b=0===o||Math.abs(t-d)<=i;h&&b?(n(t),a()):(n(d),r=requestAnimationFrame((function(){return u({lastPosition:d,lastTime:l,lastVelocity:p})})))}return i||(i=Math.abs(t-e)/1e3),[function(){return u({lastPosition:e})},function(){return cancelAnimationFrame(r)}]}function P(e,t){return R(e,t)}function N(e){try{return P(e,y.isSessionModel)}catch(t){throw new Error("no session model found!")}}function A(e){try{return P(e,y.isViewModel)}catch(t){throw new Error("no containing view found")}}function F(e){try{return P(e,y.isTrackModel)}catch(t){throw new Error("no containing track found")}}function I(e){try{return P(e,y.isDisplayModel)}catch(t){throw new Error("no containing display found")}}function B(e){var t,n,r=e.assemblyName,a=e.refName,i=e.start,o=e.end,c=r?"{".concat(r,"}"):"";return t=void 0!==i?":".concat((i+1).toLocaleString("en-US")):void 0!==o?":1":"",n=void 0!==o?void 0!==i&&i+1===o?"":"..".concat(o.toLocaleString("en-US")):void 0!==i?"..":"","".concat(c).concat(a).concat(t).concat(n)}function D(e,t){if(!e)throw new Error("no location string provided, could not parse");var n=(e=e.replace(/\s/,"")).match(/(\{(.+)\})?(.+)/);if(!n)throw new Error('invalid location string: "'.concat(e,'"'));var r=Object(u.a)(n,4),a=r[2],i=r[3],o=i.lastIndexOf(":");if(-1===o){if(t(i,a))return{assemblyName:a,refName:i};throw new Error('Unknown reference sequence "'.concat(i,'"'))}var c=i.slice(0,o),s=i.slice(o+1);if(t(c,a)&&t(i,a))throw new Error('ambiguous location string: "'.concat(e,'"'));if(t(c,a)){if(!s)return{assemblyName:a,refName:c};var l=s.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)(-?(\d+|\d{1,3}(,\d{3})*))$/),d=s.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)?$/);if(l){var f=Object(u.a)(l,6),p=f[1],g=f[5];if(void 0!==p&&void 0!==g)return{assemblyName:a,refName:c,start:+p.replace(/,/g,""),end:+g.replace(/,/g,"")}}else{if(!d)throw new Error('could not parse range "'.concat(s,'" on location "').concat(e,'"'));var m=Object(u.a)(d,5),h=m[1],b=m[4];if(void 0!==h)return b?{assemblyName:a,refName:c,start:+h.replace(/,/g,"")}:{assemblyName:a,refName:c,start:+h.replace(/,/g,""),end:+h.replace(/,/g,"")}}}else if(t(i,a))return{assemblyName:a,refName:i};throw new Error('unknown reference sequence name in location "'.concat(e,'"'))}function L(e,t){var n=D(e,t);return"number"===typeof n.start&&(n.start-=1),n}function V(e,t){var n=e.assemblyName||t.assemblyName?(e.assemblyName||"").localeCompare(t.assemblyName||""):0;if(n)return n;var r=e.refName||t.refName?(e.refName||"").localeCompare(t.refName||""):0;if(r)return r;if(void 0!==e.start&&void 0!==t.start){var a=e.start-t.start;if(a)return a}if(void 0!==e.end&&void 0!==t.end){var i=e.end-t.end;if(i)return i}return 0}function W(e,t,n){return V(L(e,n),L(t,n))}function z(e,t,n){return e<t?t:e>n?n:e}function H(e){return Math.round(10*e)/10}function q(e,t,n){return t.reversed?H((t.end-e)/n):H((e-t.start)/n)}var U=180/Math.PI,_=Math.PI/180;function G(e){return e*U%360}function J(e){return e*_%(2*Math.PI)}function X(e,t){return[e*Math.cos(t),e*Math.sin(t)]}function Y(e,t){return[Math.sqrt(e*e+t*t),Math.atan(t/e)]}function Q(e,t,n){return $(e.get("start"),e.get("end"),t,n)}function $(e,t,n,r){var a=q(e,n,r),i=q(t,n,r);return n.reversed?[i,a]:[a,i]}var K=Object.fromEntries.bind(Object);function Z(e,t,n){var r,a=n?new Array(n):[],i=0,o=Object(c.a)(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;a[i]=t(s),i+=1}}catch(u){o.e(u)}finally{o.f()}return a}function ee(e,t){var n=v()(e,t);return t.defaultSession?n.defaultSession=t.defaultSession:e.defaultSession&&(n.defaultSession=e.defaultSession),n}function te(e,t){for(var n=e.length;n--;)if(t(e[n],n,e))return n;return-1}function ne(e,t,n,r,a,c,s){var u;function l(t){Object(w.c)(t)||(Object(d.isAlive)(e)?s(t):console.error(t))}var p=Object(f.reaction)((function(){try{return t(e)}catch(n){return void l(n)}}),function(){var t=Object(o.a)(i.a.mark((function t(r,o){var s,f;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u&&!u.signal.aborted&&u.abort(),Object(d.isAlive)(e)){t.next=3;break}return t.abrupt("return");case 3:return u=new AbortController,a(s=u),t.prev=6,t.next=9,n(r,s.signal,e,o);case 9:f=t.sent,Object(w.b)(s.signal),Object(d.isAlive)(e)&&c(f),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(6),s&&!s.signal.aborted&&s.abort(),l(t.t0);case 18:case"end":return t.stop()}}),t,null,[[6,14]])})));return function(e,n){return t.apply(this,arguments)}}(),r);Object(d.addDisposer)(e,p),Object(d.addDisposer)(e,(function(){u&&!u.signal.aborted&&u.abort()}))}function re(e,t){if(Object(d.isStateTreeNode)(t)&&!Object(d.isAlive)(t))return t;if(t&&e&&e[t.refName]){var n=e[(t=Object(d.isStateTreeNode)(t)?Object(r.a)({},Object(d.getSnapshot)(t)):Object(r.a)({},t)).refName];if(n)return Object(r.a)(Object(r.a)({},t),{},{refName:n,originalRefName:t.refName})}return t}function ae(e,t){return ie.apply(this,arguments)}function ie(){return(ie=Object(o.a)(i.a.mark((function e(t,n){var a,o,c,u,l,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.assemblyName,o=n.regions,c=n.adapterConfig,n.sessionId){e.next=3;break}throw new Error("sessionId is required");case 3:if(u=Object(r.a)(Object(r.a)({},n),{},{regions:Object(s.a)(n.regions||[])}),!a){e.next=9;break}return e.next=7,t.getRefNameMapForAdapter(c,a,u);case 7:if((l=e.sent)&&o&&u.regions)for(d=0;d<o.length;d+=1)u.regions[d]=re(l,o[d]);case 9:return e.abrupt("return",u);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e,t){return[Math.min(e,t),Math.max(e,t)]}function ce(e){var t=e.refName,n=e.coord,r=e.oob;return"".concat(t,":").concat(n.toLocaleString("en-US")).concat(r?" (out of bounds)":"")}var se="undefined"!==typeof window&&Boolean(window.electron);function ue(e){return le(e).split("").reverse().join("")}var le=function(){var e=/[ACGT]/gi,t={S:"S",w:"w",T:"A",r:"y",a:"t",N:"N",K:"M",x:"x",d:"h",Y:"R",V:"B",y:"r",M:"K",h:"d",k:"m",C:"G",g:"c",t:"a",A:"T",n:"n",W:"W",X:"X",m:"k",v:"b",B:"V",s:"s",H:"D",c:"g",D:"H",b:"v",R:"Y",G:"C"};return function(n){return n.replace(e,(function(e){return t[e]||""}))}}();function de(e){var t=new FileReader;return new Promise((function(n,r){t.onload=function(e){e.target?n(e.target.result):r(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)}))}var fe="undefined"===typeof jest?"undefined"!==typeof window&&window.requestIdleCallback?window.requestIdleCallback:function(e){return setTimeout((function(){return e()}),1)}:function(e){return e()};function pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625],r=.5279276315789471;return e.split("").map((function(e){return e.charCodeAt(0)<n.length?n[e.charCodeAt(0)]:r})).reduce((function(e,t){return t+e}),0)*t}var ge=["ATG"],me=["TAA","TAG","TGA"],he={TCA:"S",TCC:"S",TCG:"S",TCT:"S",TTC:"F",TTT:"F",TTA:"L",TTG:"L",TAC:"Y",TAT:"Y",TAA:"*",TAG:"*",TGC:"C",TGT:"C",TGA:"*",TGG:"W",CTA:"L",CTC:"L",CTG:"L",CTT:"L",CCA:"P",CCC:"P",CCG:"P",CCT:"P",CAC:"H",CAT:"H",CAA:"Q",CAG:"Q",CGA:"R",CGC:"R",CGG:"R",CGT:"R",ATA:"I",ATC:"I",ATT:"I",ATG:"M",ACA:"T",ACC:"T",ACG:"T",ACT:"T",AAC:"N",AAT:"N",AAA:"K",AAG:"K",AGC:"S",AGT:"S",AGA:"R",AGG:"R",GTA:"V",GTC:"V",GTG:"V",GTT:"V",GCA:"A",GCC:"A",GCG:"A",GCT:"A",GAC:"D",GAT:"D",GAA:"E",GAG:"E",GGA:"G",GGC:"G",GGG:"G",GGT:"G"};function be(e){var t={};return Object.keys(e).forEach((function(n){for(var r=e[n],a=[],i=0;i<3;i++){var o=n.charAt(i);a[i]=[],a[i][0]=o.toUpperCase(),a[i][1]=o.toLowerCase()}for(var c=0;c<2;c++)for(var s=a[0][c],u=0;u<2;u++)for(var l=a[1][u],d=0;d<2;d++){var f=a[2][d];t[s+l+f]=r}})),t}function ve(e,t,n){return ye.apply(this,arguments)}function ye(){return(ye=Object(o.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(t),e.next=3,r();case 3:return a=e.sent,n(""),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){var t,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}function Oe(e){return"".concat(we(JSON.stringify(e)))}}.call(this,n(174))},852:function(e,t,n){"use strict";n.d(t,"d",(function(){return H})),n.d(t,"b",(function(){return W})),n.d(t,"c",(function(){return z})),n.d(t,"a",(function(){return P}));var r=n(89),a=n(92),i=n(94),o=n(95),c=n(1),s=n(83),u=n(133),l=n(309),d=n(1690),f=n.n(d),p=n(90),g=n(106),m=n(87),h=n(114),b=n(112),v=n(81),y=n(153),w=n(82);function O(e,t,n,r,a){var i=Math.abs(e-n);if(!(i>r)){i===r&&a.push([t,e]);var o=Math.sqrt(r*r-i*i);a.push([t-o,e]),a.push([t+o,e])}}function j(e,t,n,r,a){var i=Math.abs(e-t);if(!(i>r)){i===r&&a.push([e,n]);var o=Math.sqrt(r*r-i*i);a.push([e,n-o]),a.push([e,n+o])}}function k(e,t){var n=Math.sqrt(e*e+t*t);return 0===n?[0,0]:[n,function(e,t){var n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t)]}var x=2*Math.PI;var C=function(){function e(t,n,a,i){Object(r.a)(this,e),this.key=void 0,this.region=void 0,this.offsetRadians=void 0,this.startRadians=void 0,this.endRadians=void 0,this.bpPerRadian=void 0,this.radianWidth=void 0,this.flipped=void 0;var o=t.bpPerRadian;this.key=Object(s.assembleLocString)(n),this.region=n,this.offsetRadians=a,this.bpPerRadian=o,this.radianWidth=i,this.flipped=!1,this.startRadians=this.offsetRadians,this.endRadians=n.widthBp/this.bpPerRadian+this.offsetRadians,Object.freeze(this)}return Object(a.a)(e,[{key:"bpToXY",value:function(e,t){var n=(this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start)/this.bpPerRadian+this.offsetRadians;return Object(s.polarToCartesian)(t,n)}},{key:"toJSON",value:function(){return Object(s.objectFromEntries)(Object.entries(this))}}]),e}();function S(e,t){var n,r,a,i,o=Object(w.a)(e.visibleSection.theta,2),c=o[0],s=o[1];return n=t.offsetRadians+e.offsetRadians,r=t.radianWidth,a=c,i=s-c,!(r<=0||i<=0)&&(r+1e-4>=x||i+1e-4>=x||(n=(n%x+x)%x+x)<(a=(a%x+x)%x+x)+i&&n+r>a||n<(a-=x)+i&&n+r>a||n<(a+=x+x)+i&&n+r>a)}function T(e){return m.types.compose(y.BaseViewModel,m.types.model("CircularView",{type:m.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:2e6,tracks:m.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:m.types.optional(m.types.refinement("trackHeight",m.types.number,(function(e){return e>=40})),400),minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,displayedRegions:m.types.array(h.Region),scrollX:0,scrollY:0,trackSelectorType:"hierarchical"}).volatile((function(){return{width:800}})).views((function(e){return{get staticSlices(){return function(e){var t,n=[],r=0,a=Object(g.a)(e.elidedRegions);try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.widthBp/e.bpPerRadian+e.spacingPx/e.pxPerRadian;n.push(new C(e,i,r,o)),r+=o}}catch(c){a.e(c)}finally{a.f()}return n}(e)},get visibleStaticSlices(){return this.staticSlices.filter(S.bind(this,e))},get visibleSection(){return function(e,t,n){var r=Object(w.a)(e,4),a=r[0],i=r[1],o=r[2],c=r[3],s=Object(w.a)(t,2),u=s[0],l=s[1];if(i-=u,o-=l,c-=l,(a-=u)<0&&i>0&&o<0&&c>0){for(var d=[[a,o],[i,o],[a,c],[i,c]],f=-1/0,p=0;p<d.length;p+=1){var g=Object(w.a)(d[p],2),m=g[0],h=g[1],b=Math.sqrt(m*m+h*h);b>f&&(f=b)}return{rho:[0,Math.min(n,f)],theta:[0,2*Math.PI]}}var v=[[a,o],[i,o],[a,c],[i,c]];j(a,0,0,n,v),j(i,0,0,n,v),O(o,0,0,n,v),O(c,0,0,n,v),-a<n&&v.push([a,0]),i<n&&v.push([i,0]),-o<n&&v.push([0,o]),c<n&&v.push([0,c]);for(var y=a>=0?-1:1,x=1/0,C=-1/0,S=1/0,T=-1/0,E=0;E<v.length;E+=1){var R=Object(w.a)(v[E],2),M=R[0],P=R[1];if(M>=a&&M<=i&&P>=o&&P<=c){var N=k(M*y,P*y),A=Object(w.a)(N,2),F=A[0],I=A[1];F<=n+.001&&(I<S&&F>1e-4&&(S=I),I>T&&F>1e-4&&(T=I),F<x&&(x=F),F>C&&(C=F))}}return-1===y&&(S+=Math.PI,T+=Math.PI),S>2*Math.PI&&T>2*Math.PI&&(S-=2*Math.PI,T-=2*Math.PI),{rho:[x,Math.min(n,C)],theta:[S,T]}}([e.scrollX,e.scrollX+e.width,e.scrollY,e.scrollY+e.height],this.centerXY,this.radiusPx)},get circumferencePx(){var t,n=0,r=Object(g.a)(this.elidedRegions);try{for(r.s();!(t=r.n()).done;){n+=t.value.widthBp}}catch(a){r.e(a)}finally{r.f()}return n/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){var t,n=0,r=Object(g.a)(e.displayedRegions);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=a.end-a.start}}catch(i){r.e(i)}finally{r.f()}return n},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){var t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){var e=2*Math.PI*this.maximumRadiusPx;return Object(s.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){var t=[];e.displayedRegions.forEach((function(n){var r=n.end-n.start;if(r/e.bpPerPx<e.minVisibleWidth){var a=t[t.length-1];a&&a.elided?(a.regions.push(Object(p.a)({},n)),a.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[Object(p.a)({},n)]})}else t.push(Object(p.a)(Object(p.a)({},n),{},{widthBp:r}))}));for(var n=0;n<t.length;n+=1){var r=t[n];r.elided&&1===r.regions.length&&(delete r.elided,t[n]=Object(p.a)(Object(p.a)({},r),r.regions[0]))}return t},get assemblyNames(){var t=[];return e.displayedRegions.forEach((function(e){t.includes(e.assemblyName)||t.push(e.assemblyName)})),t}}})).volatile((function(){return{error:void 0}})).actions((function(t){return{setWidth:function(e){return t.width=Math.max(e,100),t.width},setHeight:function(e){return t.height=Math.max(e,40),t.height},resizeHeight:function(e){var n=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},resizeWidth:function(e){var n=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},rotateClockwiseButton:function(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton:function(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians+=e},rotateCounterClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians-=e},zoomInButton:function(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton:function(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx:function(e){t.bpPerPx=Object(s.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust:function(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},closeView:function(){Object(m.getParent)(t,2).removeView(t)},setDisplayedRegions:function(e){var n=0===t.displayedRegions.length;t.displayedRegions=Object(m.cast)(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=Object(s.getSession)(t);if(Object(s.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setError:function(e){t.error=e},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=Object(m.resolveIdentifier)(a,Object(m.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),u=i.displays.find((function(e){return s.includes(e.type)})),l=o.stateModel.create(Object(p.a)(Object(p.a)({},r),{},{type:i.type,configuration:i,displays:[{type:u.type,configuration:u}]}));t.tracks.push(l)},addTrackConf:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.type,i=Object(v.readConfObject)(n,"name"),o=e.getTrackType(a);if(!o)throw new Error("unknown track type ".concat(n.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),u=n.displays.find((function(e){return s.includes(e.type)})),l=o.stateModel.create(Object(p.a)(Object(p.a)({},r),{},{name:i,type:a,configuration:n,displays:[{type:u.type,configuration:u}]}));t.tracks.push(l)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(m.resolveIdentifier)(r,Object(m.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return Object(b.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length},toggleFitToWindowLock:function(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow}}})))}var E=function(e){var t=e.lib,n=t.react,r=n.useState,a=n.useEffect,i=t["@material-ui/core/styles"].makeStyles,o=t["mobx-react"].observer,c=i((function(e){return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash ".concat(1.4,"s ease-in-out infinite, $colors ").concat(5.6,"s ease-in-out infinite")},"@keyframes colors":{"0%":{stroke:e.palette.primary.light},"25%":{stroke:e.palette.secondary.light},"50%":{stroke:e.palette.tertiary.light},"75%":{stroke:e.palette.quaternary.light},"100%":{stroke:e.palette.primary.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}}));return o((function(e){var t=e.model.renderProps.radius,i=c(),o=r(!1),s=Object(w.a)(o,2),u=s[0],l=s[1];return a((function(){var e=setTimeout((function(){return l(!0)}),400);return function(){return clearTimeout(e)}})),u?n.createElement("g",null,n.createElement("defs",null,n.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},n.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}}))),n.createElement("circle",{cx:"0",cy:"0",r:t,fill:"#f1f1f1"}),n.createElement("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),n.createElement("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},"Loading\u2026"),n.createElement("circle",{className:i.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})):null}))},R=function(e){var t=e.jbrequire,n=t("react"),r=t("@material-ui/core/styles").makeStyles,a=t("mobx-react").observer,i=r({errorMessage:{},errorBackground:{},errorText:{}});return a((function(e){var t=e.model,r=t.renderProps.radius,a=t.error,o=i();return n.createElement("g",{className:o.errorMessage},n.createElement("defs",null,n.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},n.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}}))),n.createElement("circle",{className:o.errorBackground,cx:"0",cy:"0",r:r,fill:"#ffb4b4"}),n.createElement("circle",{className:o.errorPattern,cx:"0",cy:"0",r:r,fill:"url(#diagonalHatch)"}),n.createElement("text",{className:o.errorText,x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},String(a)))}))},M=function(e){var t=e.jbrequire,n=t("react"),r=t("mobx-state-tree").isAlive,a=n.useEffect,i=n.useRef,o=t("mobx-react"),c=o.observer,s=(o.PropTypes,t("react-dom")),u=s.unmountComponentAtNode,l=s.hydrate,d=t("@jbrowse/core/util").rIC;return c((function(e){var t=e.model,o=t.data,c=t.html,s=t.filled,f=t.renderProps,g=t.renderingComponent,m=i(null);return a((function(){var e=m.current;return e&&s&&(e&&e.innerHTML&&(e.style.display="none",u(e)),e.style.display="inline",e.innerHTML=c,d((function(){if(r(t)){var a=n.createElement(g,Object(p.a)(Object(p.a)({},o),f),null);d((function(){r(t)&&l(a,e)}))}}))),function(){e&&u(e)}})),n.createElement("g",{ref:m})}))},P=function(e){var t=e.lib,n=e.load,r=t.react,a=t["mobx-react"],i=a.observer,o=(a.PropTypes,n(E)),c=n(R),s=n(M);return i((function(e){var t=e.display;return t.error?r.createElement(c,{model:t}):t.filled?r.createElement(s,{model:t}):r.createElement(o,{model:t})}))},N=n(88),A=n.n(N),F=n(91),I=n(1021),B=n(142),D=n(119),L=n(154),V=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util/tracks").getRpcSessionId,r=t("@jbrowse/core/util").getContainingView,a=t("@jbrowse/core/util").getSession;function i(){return(i=Object(F.a)(A.a.mark((function e(t,n,r){var a,i,o,c,s,u,l,d;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:if(a=t.rendererType,i=t.rpcManager,o=t.cannotBeRenderedReason,c=t.renderArgs,s=t.renderProps,!o){e.next=5;break}return e.abrupt("return",{message:o});case 5:if(t.renderProps.radius&&t.renderArgs.regions&&t.renderArgs.regions.length){e.next=7;break}return e.abrupt("return",{message:"Skipping render"});case 7:if(r.isCompatibleWithRenderer(a)){e.next=9;break}throw new Error("renderer ".concat(a.name," is not compatible with this display type"));case 9:return e.next=11,a.renderInClient(i,Object(p.a)(Object(p.a)(Object(p.a)({},c),s),{},{signal:n}));case 11:return u=e.sent,l=u.html,d=Object(L.a)(u,["html"]),e.abrupt("return",{html:l,data:d,renderingComponent:a.ReactComponent});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{renderReactionData:function(e){var t,i=e,o=r(i),c=i.rendererType,s=i.renderProps;return{rendererType:c,rpcManager:a(o).rpcManager,renderProps:s,renderArgs:{assemblyName:null===(t=o.displayedRegions[0])||void 0===t?void 0:t.assemblyName,adapterConfig:JSON.parse(JSON.stringify(i.adapterConfig)),rendererType:c.name,regions:JSON.parse(JSON.stringify(o.displayedRegions)),blockDefinitions:o.blockDefinitions,sessionId:n(i),timeout:1e6}}},renderReactionEffect:function(e,t,n){return i.apply(this,arguments)}}},W=m.types.compose("BaseChordDisplay",y.BaseDisplay,m.types.model({bezierRadiusRatio:.1,assemblyName:m.types.maybe(m.types.string)})).volatile((function(){return{filled:!1,reactElement:void 0,data:void 0,message:"",error:void 0,renderingComponent:void 0,refNameMap:void 0}})).actions((function(e){var t=Object(m.getEnv)(e).pluginManager,n=e;return{onChordClick:function(r){Object(v.getConf)(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}})).views((function(e){return{get blockDefinitions(){var t=Object(s.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;var n=JSON.parse(JSON.stringify(t));return n.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(t){var n,r=null===(n=e.refNameMap)||void 0===n?void 0:n[t.refName];r&&t.refName!==r&&(t.refName=r)}))})),n},get renderProps(){var t=Object(s.getContainingView)(e);return Object(p.a)(Object(p.a)({},Object(D.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick})},get rendererType(){var t=e,n=Object(m.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!n)throw new Error('renderer "'.concat(t.rendererTypeName,'" not found'));if(!n.ReactComponent)throw new Error("renderer ".concat(t.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return n},isCompatibleWithRenderer:function(e){return!!(e instanceof I.a)},get selectedFeatureId(){if(Object(m.isAlive)(e)){var t=Object(s.getSession)(e);if(t){var n=t.selection;return Object(B.b)(n)?n.id():void 0}}}}})).actions((function(e){return{renderStarted:function(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess:function(t){var n=t.message,r=t.data,a=t.reactElement,i=t.renderingComponent;n?(e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=i)},renderError:function(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap:function(t){e.refNameMap=t},setError:function(t){e.error=t}}})).actions((function(e){var t=Object(m.getEnv)(e).pluginManager.jbrequire(V),n=t.renderReactionData,r=t.renderReactionEffect;return{afterAttach:function(){Object(s.makeAbortableReaction)(e,n,r,{name:"".concat(e.type," ").concat(e.id," rendering"),fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),Object(s.makeAbortableReaction)(e,(function(){return{assemblyNames:Object(D.getTrackAssemblyNames)(e.parentTrack),adapter:Object(v.getConf)(Object(m.getParent)(e,2),"adapter"),assemblyManager:Object(s.getSession)(e).assemblyManager}}),function(){var t=Object(F.a)(A.a.mark((function t(n,r){var a,i,o;return A.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.assemblyNames,i=n.adapter,o=n.assemblyManager,t.abrupt("return",o.getRefNameMapForAdapter(i,a[0],{signal:r,sessionId:Object(D.getRpcSessionId)(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),{name:"".concat(e.type," ").concat(e.id," getting refNames"),fireImmediately:!0},(function(){}),(function(t){e.setRefNameMap(t)}),(function(t){console.error(t),e.setError(t)}))}}})),z=Object(v.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"}),H=function(e){Object(i.a)(u,e);var t=Object(o.a)(u);function u(){var e;Object(r.a)(this,u);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CircularViewPlugin",e}return Object(a.a)(u,[{key:"install",value:function(e){e.addViewType((function(){return new l.a({ReactComponent:Object(c.lazy)((function(){return n.e(23).then(n.bind(null,2454))})),stateModel:T(e),name:"CircularView"})}))}},{key:"configure",value:function(e){Object(s.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["File","Add"],{label:"Circular view",icon:f.a,onClick:function(e){e.addView("CircularView",{})}})}}]),u}(u.a)},853:function(e,t,n){"use strict";n.d(t,"b",(function(){return z})),n.d(t,"a",(function(){return W}));var r=n(89),a=n(92),i=n(94),o=n(95),c=n(1),s=n(185),u=n(253),l=n(133),d=n(84),f=n(87),p=n(81),g=n(114),m=function(e){return f.types.model("ConfigurationEditorWidget",{id:g.ElementId,type:f.types.literal("ConfigurationEditorWidget"),target:f.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{setTarget:function(t){e.target=t}}}))},h=Object(p.ConfigurationSchema)("ConfigurationEditorWidget",{}),b=Object(d.observer)((function(e){var t=e.model;if(t&&t.target){if(t.target.type)return"".concat(t.target.type," settings");if(Object(f.isStateTreeNode)(t.target)){var n=Object(f.getType)(t.target);if(n&&n.name)return"".concat(n.name.replace("ConfigurationSchema","")," settings")}}return"Settings"})),v=n(88),y=n.n(v),w=n(82),O=n(106),j=n(91),k=n(136),x=n(142),C=n(147),S=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).features=void 0;var i=Object(p.readConfObject)(e,"features");return a.features=n.makeFeatures(i||[]),a}return Object(a.a)(n,[{key:"getRefNames",value:function(){var e=Object(j.a)(y.a.mark((function e(){var t,n,r,a,i,o;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new Set,n=Object(O.a)(this.features);try{for(n.s();!(r=n.n()).done;)a=Object(w.a)(r.value,2),i=a[0],o=a[1],t.add(i),o.forEach((function(e){var n=e.get("mate");n&&n.refName&&t.add(n.refName);var r=((e.get("INFO")||{}).SVTYPE||[])[0];if("BND"===r){var a=(e.get("ALT")||[])[0].MatePosition.split(":");t.add(a[0])}else if("TRA"===r){var i=((e.get("INFO")||{}).CHR2||[])[0];t.add(i)}}))}catch(c){n.e(c)}finally{n.f()}return e.abrupt("return",Array.from(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNameAliases",value:function(){var e=Object(j.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Array.from(this.features.values()).map((function(e){return{refName:e[0].get("refName"),aliases:e[0].get("aliases")}})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=e.refName,r=e.start,a=e.end;return Object(C.ObservableCreate)(function(){var e=Object(j.a)(y.a.mark((function e(i){var o,c,s;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=t.features.get(n)||[],c=0;c<o.length;c+=1)(s=o[c]).get("end")>r&&s.get("start")<a&&i.next(s);i.complete();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}],[{key:"makeFeatures",value:function(e){for(var t=new Map,n=0;n<e.length;n+=1)if(e[n]){var r=this.makeFeature(e[n]),a=r.get("refName"),i=t.get(a);i||(i=[],t.set(a,i)),i.push(r)}var o,c=Object(O.a)(t.values());try{for(c.s();!(o=c.n()).done;){o.value.sort((function(e,t){return e.get("start")-t.get("start")}))}}catch(s){c.e(s)}finally{c.f()}return t}},{key:"makeFeature",value:function(e){return new x.a(e)}}]),n}(k.BaseFeatureDataAdapter),T=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).features=void 0;var i=Object(p.readConfObject)(e,"features");return a.features=S.makeFeatures(i||[]),a}return Object(a.a)(n,[{key:"getRegions",value:function(){var e=Object(j.a)(y.a.mark((function e(){var t,n,r,a,i,o,c,s,u,l;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=Object(O.a)(this.features);try{for(n.s();!(r=n.n()).done;){a=Object(w.a)(r.value,2),i=a[0],o=a[1],c=void 0,s=Object(O.a)(o);try{for(s.s();!(u=s.n()).done;)l=u.value,c&&c.end>=l.get("start")&&c.start<=l.get("end")?c.end=l.get("end"):(c&&t.push(c),c={refName:i,start:l.get("start"),end:l.get("end")})}catch(d){s.e(d)}finally{s.f()}c&&t.push(c)}}catch(d){n.e(d)}finally{n.f()}return t.sort((function(e,t){return e.refName.localeCompare(t.refName)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(k.BaseAdapter),E=n(90),R=n(206),M=n(167),P=n(1055),N=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"getFeatures",value:function(e){var t=this,r=Object(R.a)(Object(M.a)(n.prototype),"getFeatures",this);return Object(C.ObservableCreate)(function(){var n=Object(j.a)(y.a.mark((function n(a){var i,o;return y.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.call(t,e).pipe(Object(P.a)()).toPromise();case 2:i=n.sent,o=i[0],a.next(new x.a(Object(E.a)(Object(E.a)({},o.toJSON()),{},{uniqueId:"".concat(o.id(),":").concat(e.start,"-").concat(e.end),end:e.end,start:e.start,seq:o.get("seq").slice(Math.max(e.start-o.get("start"),0),Math.max(e.end-o.get("start"),0))}))),a.complete();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"getRegions",value:function(){var e=Object(j.a)(y.a.mark((function e(){var t,n,r,a,i,o,c,s,u,l;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=Object(O.a)(this.features);try{for(n.s();!(r=n.n()).done;){a=Object(w.a)(r.value,2),i=a[0],o=a[1],c=void 0,s=Object(O.a)(o);try{for(s.s();!(u=s.n()).done;)l=u.value,c&&c.end>=l.get("start")&&c.start<=l.get("end")?c.end=l.get("end"):(c&&t.push(c),c={refName:i,start:l.get("start"),end:l.get("end")})}catch(d){s.e(d)}finally{s.f()}c&&t.push(c)}}catch(d){n.e(d)}finally{n.f()}return t.sort((function(e,t){return e.refName.localeCompare(t.refName)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(S),A=Object(p.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0}),F=Object(p.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0}),I=Object(p.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0}),B=n(719),D=n(139),L=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).location=void 0,a.promise=void 0,a.location=Object(D.openLocation)(Object(p.readConfObject)(e,"location")),a.promise=a.downloadResults(),a}return Object(a.a)(n,[{key:"downloadResults",value:function(){var e=Object(j.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.location.readFile("utf8");case 2:return t=e.sent,e.abrupt("return",t.trim().split("\n").map((function(e){var t=e.split("\t"),n=Object(B.a)(t);return{refName:n[0],aliases:n.slice(1)}})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNameAliases",value:function(){return this.promise}},{key:"freeResources",value:function(){var e=Object(j.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(k.BaseAdapter),V=Object(p.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt"}}},{explicitlyTyped:!0}),W=(n(728),Object(c.lazy)((function(){return Promise.all([n.e(5),n.e(34)]).then(n.bind(null,2440))}))),z=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="ConfigurationPlugin",e}return Object(a.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.a({name:"FromConfigAdapter",configSchema:A,AdapterClass:S})})),e.addAdapterType((function(){return new s.a({name:"FromConfigRegionsAdapter",configSchema:F,AdapterClass:T})})),e.addAdapterType((function(){return new s.a({name:"FromConfigSequenceAdapter",configSchema:I,AdapterClass:N})})),e.addAdapterType((function(){return new s.a({name:"RefNameAliasAdapter",configSchema:V,AdapterClass:L})})),e.addWidgetType((function(){return new u.a({name:"ConfigurationEditorWidget",HeadingComponent:b,configSchema:h,stateModel:m(e),ReactComponent:W})}))}}]),n}(l.a)},960:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(88),a=n.n(r),i=n(91),o=n(89),c=n(92),s=n(94),u=n(95),l=n(1),d=n.n(l),f=n(345),p=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;if(Object(o.a)(this,n),(r=t.call(this,e)).ReactComponent=void 0,r.configSchema=void 0,r.pluginManager=void 0,r.ReactComponent=e.ReactComponent,r.configSchema=e.configSchema,r.pluginManager=e.pluginManager,!r.ReactComponent)throw new Error("no ReactComponent defined for renderer ".concat(r.name));if(!Object(f.getDefaultValue)(r.configSchema).type)throw new Error("".concat(r.name," config schema ").concat(r.configSchema.name," is not explicitlyTyped"));if(!r.pluginManager)throw new Error("no plugin manager defined for renderer ".concat(r.name));return r}return Object(c.a)(n,[{key:"render",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{reactElement:d.a.createElement(this.ReactComponent,t,null)});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){return 0}}]),n}(n(276).a)},983:function(e,t){},986:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u}));var r=n(88),a=n.n(r),i=n(91),o=n(112),c=n(514);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.timeout,r=t.signal,a=t.name;return new Promise((function(t,i){var s,u=!1,l=Object(o.when)(e),d=function(){};n&&(s=setTimeout((function(){u||(u=!0,l.cancel(),i(new Error("timed out waiting for ".concat(a||"whenPresent"))))}),n),d=function(){return s&&clearTimeout(s)}),r&&r.addEventListener("abort",(function(){u||(u=!0,l.cancel(),d(),i(Object(c.d)()))})),l.then((function(){u||(u=!0,d(),t())})).catch((function(e){u||(u=!0,d(),i(e))}))}))}function u(e){return l.apply(this,arguments)}function l(){return(l=Object(i.a)(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,s((function(){var e=t();return void 0!==e&&null!==e}),n);case 3:return e.abrupt("return",t());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},987:function(e,t,n){"use strict";var r=n(1542),a=n.n(r);t.a=function(){var e=new a.a.Jexl;return e.addFunction("get",(function(e,t){return e.get(t)})),e.addFunction("id",(function(e){return e.id()})),e.addFunction("cast",(function(e){return e})),e.addFunction("log",(function(e){return console.log(e),e})),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("parseInt",Number.parseInt),e.addFunction("split",(function(e,t){return e.split(t)})),e.addFunction("charAt",(function(e,t){return e.charAt(t)})),e.addFunction("charCodeAt",(function(e,t){return e.charCodeAt(t)})),e.addFunction("codePointAt",(function(e,t){return e.codePointAt(t)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("endsWith",(function(e,t,n){return e.endsWith(t,n)})),e.addFunction("padEnd",(function(e,t,n){return e.padEnd(t,n)})),e.addFunction("padStart",(function(e,t,n){return e.padStart(t,n)})),e.addFunction("repeat",(function(e,t){return e.repeat(t)})),e.addFunction("replace",(function(e,t,n){return e.replace(t,n)})),e.addFunction("replaceAll",(function(e,t,n){return e.replaceAll(t,n)})),e.addFunction("slice",(function(e,t,n){return e.slice(t,n)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("substring",(function(e,t,n){return e.substring(t,n)})),e.addFunction("toLowerCase",(function(e){return e.toLowerCase()})),e.addFunction("toUpperCase",(function(e){return e.toUpperCase()})),e.addFunction("trim",(function(e){e.trim()})),e.addFunction("trimEnd",(function(e){return e.trimEnd()})),e.addFunction("trimStart",(function(e){return e.trimStart()})),e.addFunction("getTag",(function(e,t){var n=e.get("tags");return n?n[t]:e.get(t)})),e.addBinaryOp("&",15,(function(e,t){return e&t})),e}},995:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return f}));var r=n(88),a=n.n(r),i=n(91),o=n(90),c=n(418);function s(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return 0===n?0:(a?r=t/n-e*e/(n*n):(r=t-e*e/n,n>1&&(r/=n-1)),r<0?0:Math.sqrt(r))}function u(e){return Object(o.a)(Object(o.a)({},e),{},{scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:s(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered})}function l(e,t){return d.apply(this,arguments)}function d(){return(d=Object(i.a)(a.a.mark((function e(t,n){var r,i,o,s,l,d,f,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.start,i=t.end,e.next=3,n.pipe(Object(c.a)((function(e,t){var n=t.get("score");return e.scoreMax=Math.max(e.scoreMax,t.get("summary")?t.get("maxScore"):n),e.scoreMin=Math.min(e.scoreMin,t.get("summary")?t.get("minScore"):n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,e}),{scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0})).toPromise();case 3:return o=e.sent,s=o.scoreMin,l=o.scoreMax,d=o.scoreSum,f=o.scoreSumSquares,p=o.featureCount,e.abrupt("return",u({scoreMax:l,scoreMin:s,scoreSum:d,scoreSumSquares:f,featureCount:p,basesCovered:i-r+1}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}}}]);
//# sourceMappingURL=16.35b627f9.chunk.js.map